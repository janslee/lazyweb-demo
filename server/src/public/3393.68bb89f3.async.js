(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3393],{64335:function(Fr,fe,Q){"use strict";var Ae=Q(67294),re=(0,Ae.createContext)({});fe.Z=re},21349:function(Fr,fe,Q){"use strict";var Ae=Q(84305),re=Q(39559),y=Q(85893),Se=Q(94184),W=Q.n(Se),ge=Q(67294),ce=Q(64335),Xe=Q(53645),me=Q.n(Xe),qe=function(bt){var Pt=(0,ge.useContext)(ce.Z),ur=bt.children,Nt=bt.contentWidth,pr=bt.className,Xt=bt.style,It=(0,ge.useContext)(re.ZP.ConfigContext),kt=It.getPrefixCls,_r=bt.prefixCls||kt("pro"),J=Nt||Pt.contentWidth,lr="".concat(_r,"-grid-content");return(0,y.jsx)("div",{className:W()(lr,pr,{wide:J==="Fixed"}),style:Xt,children:(0,y.jsx)("div",{className:"".concat(_r,"-grid-content-children"),children:ur})})};fe.Z=qe},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Fr){try{let me=function(){W||(W=!0,y())},qe=function(){try{Se.documentElement.doScroll("left")}catch(lt){return void setTimeout(qe,50)}me()};var ce=me,Xe=qe,fe=(fe=document.getElementsByTagName("script"))[fe.length-1],Q=fe.getAttribute("data-injectcss"),fe=fe.getAttribute("data-disable-injectsvg");if(!fe){var Ae,re,y,Se,W,ge=function(bt,Pt){Pt.parentNode.insertBefore(bt,Pt)};if(Q&&!Fr.__iconfont__svg__cssinject__){Fr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(lt){console&&console.log(lt)}}Ae=function(){var bt,Pt=document.createElement("div");Pt.innerHTML=Fr._iconfont_svg_string_3580659,(Pt=Pt.getElementsByTagName("svg")[0])&&(Pt.setAttribute("aria-hidden","true"),Pt.style.position="absolute",Pt.style.width=0,Pt.style.height=0,Pt.style.overflow="hidden",Pt=Pt,(bt=document.body).firstChild?ge(Pt,bt.firstChild):bt.appendChild(Pt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(Ae,0):(re=function(){document.removeEventListener("DOMContentLoaded",re,!1),Ae()},document.addEventListener("DOMContentLoaded",re,!1)):document.attachEvent&&(y=Ae,Se=Fr.document,W=!1,qe(),Se.onreadystatechange=function(){Se.readyState=="complete"&&(Se.onreadystatechange=null,me())})}}catch(me){}}(window)},46185:function(Fr,fe,Q){"use strict";Q.d(fe,{zP:function(){return HP},JE:function(){return rP},ns:function(){return GP}});var Ae={};Q.r(Ae),Q.d(Ae,{add:function(){return Q0},adjoint:function(){return Cd},clone:function(){return Vp},copy:function(){return Uv},create:function(){return pf},determinant:function(){return Gv},equals:function(){return cp},exactEquals:function(){return Uc},frob:function(){return K0},fromQuat:function(){return Kv},fromQuat2:function(){return vf},fromRotation:function(){return Wv},fromRotationTranslation:function(){return Ad},fromRotationTranslationScale:function(){return qv},fromRotationTranslationScaleOrigin:function(){return fv},fromScaling:function(){return Hv},fromTranslation:function(){return Sh},fromValues:function(){return sv},fromXRotation:function(){return Xv},fromYRotation:function(){return Yv},fromZRotation:function(){return lv},frustum:function(){return Qv},getRotation:function(){return cv},getScaling:function(){return wd},getTranslation:function(){return $v},identity:function(){return uv},invert:function(){return du},lookAt:function(){return Y0},mul:function(){return r0},multiply:function(){return Xs},multiplyScalar:function(){return J0},multiplyScalarAndAdd:function(){return em},ortho:function(){return X0},orthoNO:function(){return Hp},orthoZO:function(){return e0},perspective:function(){return hv},perspectiveFromFieldOfView:function(){return Jv},perspectiveNO:function(){return Td},perspectiveZO:function(){return Gp},rotate:function(){return Eh},rotateX:function(){return df},rotateY:function(){return $f},rotateZ:function(){return qf},scale:function(){return lp},set:function(){return Vv},str:function(){return q0},sub:function(){return Wp},subtract:function(){return t0},targetTo:function(){return $0},translate:function(){return jp},transpose:function(){return jv}});var re=Q(67294),y=(0,re.createContext)({});function Se(){return(0,re.useContext)(y)}var W={},ge={},ce=function(i){return ge[i]},Xe=function(i,r){ge[i]=r},me=function(i){return W[i]},qe=function(i,r){W[i]=r},lt={},bt={},Pt=34,ur=10,Nt=13;function pr(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Xt(e,i){var r=pr(e);return function(n,t){return i(r(n),t,e)}}function It(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function kt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function _r(e){return e<0?"-"+kt(-e,6):e>9999?"+"+kt(e,6):kt(e,4)}function J(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":_r(e.getUTCFullYear(),4)+"-"+kt(e.getUTCMonth()+1,2)+"-"+kt(e.getUTCDate(),2)+(t?"T"+kt(i,2)+":"+kt(r,2)+":"+kt(n,2)+"."+kt(t,3)+"Z":n?"T"+kt(i,2)+":"+kt(r,2)+":"+kt(n,2)+"Z":r||i?"T"+kt(i,2)+":"+kt(r,2)+"Z":"")}function lr(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(S,w){var I,R,O=t(S,function(B,H){if(I)return I(B,H-1);R=B,I=w?Xt(B,w):pr(B)});return O.columns=R||[],O}function t(S,w){var I=[],R=S.length,O=0,B=0,H,ae=R<=0,oe=!1;S.charCodeAt(R-1)===ur&&--R,S.charCodeAt(R-1)===Nt&&--R;function Ie(){if(ae)return bt;if(oe)return oe=!1,lt;var it,At=O,gt;if(S.charCodeAt(At)===Pt){for(;O++<R&&S.charCodeAt(O)!==Pt||S.charCodeAt(++O)===Pt;);return(it=O)>=R?ae=!0:(gt=S.charCodeAt(O++))===ur?oe=!0:gt===Nt&&(oe=!0,S.charCodeAt(O)===ur&&++O),S.slice(At+1,it-1).replace(/""/g,'"')}for(;O<R;){if((gt=S.charCodeAt(it=O++))===ur)oe=!0;else if(gt===Nt)oe=!0,S.charCodeAt(O)===ur&&++O;else if(gt!==r)continue;return S.slice(At,it)}return ae=!0,S.slice(At,R)}for(;(H=Ie())!==bt;){for(var Oe=[];H!==lt&&H!==bt;)Oe.push(H),H=Ie();w&&(Oe=w(Oe,B++))==null||I.push(Oe)}return I}function o(S,w){return S.map(function(I){return w.map(function(R){return x(I[R])}).join(e)})}function u(S,w){return w==null&&(w=It(S)),[w.map(x).join(e)].concat(o(S,w)).join(`
`)}function c(S,w){return w==null&&(w=It(S)),o(S,w).join(`
`)}function p(S){return S.map(v).join(`
`)}function v(S){return S.map(x).join(e)}function x(S){return S==null?"":S instanceof Date?J(S):i.test(S+="")?'"'+S.replace(/"/g,'""')+'"':S}return{parse:n,parseRows:t,format:u,formatBody:c,formatRows:p,formatRow:v,formatValue:x}}var Tt=lr(","),ht=Tt.parse,Wt=Tt.parseRows,mt=Tt.format,fr=Tt.formatBody,Lr=Tt.formatRows,te=Tt.formatRow,Ne=Tt.formatValue,N=Q(85061),U=Q(28991),le=Q(38163),He=Q.n(le),Je=63710088e-1,ft={centimeters:Je*100,centimetres:Je*100,degrees:Je/111325,feet:Je*3.28084,inches:Je*39.37,kilometers:Je/1e3,kilometres:Je/1e3,meters:Je,metres:Je,miles:Je/1609.344,millimeters:Je*1e3,millimetres:Je*1e3,nauticalmiles:Je/1852,radians:1,yards:Je*1.0936},Vt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Je,yards:1.0936133},nr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Zr(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function Dr(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return Xn(i).geometry;case"LineString":return xi(i).geometry;case"Polygon":return Nn(i).geometry;case"MultiPoint":return di(i).geometry;case"MultiLineString":return ki(i).geometry;case"MultiPolygon":return Yn(i).geometry;default:throw new Error(e+" is invalid")}}function Xn(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Qt(e[0])||!Qt(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Zr(n,i,r)}function sn(e,i,r){return r===void 0&&(r={}),Ri(e.map(function(n){return Xn(n,i)}),r)}function Nn(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var c={type:"Polygon",coordinates:e};return Zr(c,i,r)}function ra(e,i,r){return r===void 0&&(r={}),Ri(e.map(function(n){return Nn(n,i)}),r)}function xi(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Zr(n,i,r)}function si(e,i,r){return r===void 0&&(r={}),Ri(e.map(function(n){return xi(n,i)}),r)}function Ri(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function ki(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Zr(n,i,r)}function di(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Zr(n,i,r)}function Yn(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Zr(n,i,r)}function ri(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Zr(n,i,r)}function Ao(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function Na(e,i){i===void 0&&(i="kilometers");var r=ft[i];if(!r)throw new Error(i+" units is invalid");return e*r}function ma(e,i){i===void 0&&(i="kilometers");var r=ft[i];if(!r)throw new Error(i+" units is invalid");return e/r}function wt(e,i){return se(ma(e,i))}function ve(e){var i=e%360;return i<0&&(i+=360),i}function se(e){var i=e%(2*Math.PI);return i*180/Math.PI}function xe(e){var i=e%360;return i*Math.PI/180}function z(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Na(ma(e,i),r)}function et(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=nr[i];if(!n)throw new Error("invalid original units");var t=nr[r];if(!t)throw new Error("invalid final units");return e/n*t}function Qt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function zr(e){return!!e&&e.constructor===Object}function Ke(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Qt(i))throw new Error("bbox must only contain numbers")})}function Rt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function vr(e,i,r){if(e!==null)for(var n,t,o,u,c,p,v,x=0,S=0,w,I=e.type,R=I==="FeatureCollection",O=I==="Feature",B=R?e.features.length:1,H=0;H<B;H++){v=R?e.features[H].geometry:O?e.geometry:e,w=v?v.type==="GeometryCollection":!1,c=w?v.geometries.length:1;for(var ae=0;ae<c;ae++){var oe=0,Ie=0;if(u=w?v.geometries[ae]:v,u!==null){p=u.coordinates;var Oe=u.type;switch(x=r&&(Oe==="Polygon"||Oe==="MultiPolygon")?1:0,Oe){case null:break;case"Point":if(i(p,S,H,oe,Ie)===!1)return!1;S++,oe++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],S,H,oe,Ie)===!1)return!1;S++,Oe==="MultiPoint"&&oe++}Oe==="LineString"&&oe++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-x;t++){if(i(p[n][t],S,H,oe,Ie)===!1)return!1;S++}Oe==="MultiLineString"&&oe++,Oe==="Polygon"&&Ie++}Oe==="Polygon"&&oe++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(Ie=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-x;o++){if(i(p[n][t][o],S,H,oe,Ie)===!1)return!1;S++}Ie++}oe++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(vr(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pr(e,i,r,n){var t=r;return vr(e,function(o,u,c,p,v){u===0&&r===void 0?t=o:t=i(t,o,u,c,p,v)},n),t}function Xr(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function rn(e,i,r){var n=r;return Xr(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function jn(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Zn(e,i,r){var n=r;return jn(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function an(e){var i=[];return vr(e,function(r){i.push(r)}),i}function ui(e,i){var r,n,t,o,u,c,p,v,x,S,w=0,I=e.type==="FeatureCollection",R=e.type==="Feature",O=I?e.features.length:1;for(r=0;r<O;r++){for(c=I?e.features[r].geometry:R?e.geometry:e,v=I?e.features[r].properties:R?e.properties:{},x=I?e.features[r].bbox:R?e.bbox:void 0,S=I?e.features[r].id:R?e.id:void 0,p=c?c.type==="GeometryCollection":!1,u=p?c.geometries.length:1,t=0;t<u;t++){if(o=p?c.geometries[t]:c,o===null){if(i(null,w,v,x,S)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,w,v,x,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],w,v,x,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function fi(e,i,r){var n=r;return ui(e,function(t,o,u,c,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,c,p)}),n}function Hi(e,i){ui(e,function(r,n,t,o,u){var c=r===null?null:r.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return i(Zr(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(c){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<r.coordinates.length;v++){var x=r.coordinates[v],S={type:p,coordinates:x};if(i(Zr(S,t),n,v)===!1)return!1}})}function Aa(e,i,r){var n=r;return Hi(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function Pa(e,i){Hi(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var c,p=0,v=0,x=0;if(vr(r,function(S,w,I,R,O){if(c===void 0||n>p||R>v||O>x){c=S,p=n,v=R,x=O,o=0;return}var B=lineString([c,S],r.properties);if(i(B,n,t,O,o)===!1)return!1;o++,c=S})===!1)return!1}}})}function ba(e,i,r){var n=r,t=!1;return Pa(e,function(o,u,c,p,v){t===!1&&r===void 0?n=o:n=i(n,o,u,c,p,v),t=!0}),n}function Ki(e,i){if(!e)throw new Error("geojson is required");Hi(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var c=0;c<u.length;c++)if(i(lineString(u[c],r.properties),n,t,c)===!1)return!1;break}}})}function q(e,i,r){var n=r;return Ki(e,function(t,o,u,c){o===0&&r===void 0?n=t:n=i(n,t,o,u,c)}),n}function ie(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,c;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,c=e.features[r].geometry;break;case"Feature":u=u||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var p=c.coordinates;switch(c.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function pe(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,c;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,c=e.features[r].geometry;break;case"Feature":u=u||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var p=c.coordinates;switch(c.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}function we(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ze(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function rt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return rt(e[0]);throw new Error("coordinates must only contain numbers")}function _t(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function be(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function We(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function zt(e){return e.type==="Feature"?e.geometry:e}function Rr(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function er(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,c=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(c)return e.filter(function(ae){return ae[c]&&ae[c].type&&ae[c].coordinates&&ae[c].coordinates.length>0}).forEach(function(ae,oe){var Ie=(0,U.Z)({},ae[c]),Oe=He()(Ie,!0);Hi(Oe,function(it){var At=ze(it),gt=(0,U.Z)((0,U.Z)({},ae),{},{_id:oe,coordinates:At});p.push(gt)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],S=[];if(u){var w="Polygon";Array.isArray(u[0])||(w="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(w="LineString");var I={type:w,coordinates:(0,N.Z)(x[u])},R=He()(I,!0);S=R.coordinates}else if(r&&n&&t&&o){var O=[parseFloat(x[r]),parseFloat(x[n])],B=[parseFloat(x[t]),parseFloat(x[o])];S=[O,B]}else r&&n&&(S=[parseFloat(x[r]),parseFloat(x[n])]);var H=(0,U.Z)((0,U.Z)({},x),{},{_id:v,coordinates:S});p.push(H)}return{dataArray:p}}function ar(e,i){var r=ht(e);return er(r,i)}function Or(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function Dn(e,i){return i===void 0?null:i==="id"&&e.id?e.id:e[i]?e[i]:e.properties&&e.properties[i]?Or(e.properties[i]+"")%1000019:null}function In(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),He()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(Hi(e,function(t,o){var u=Dn(t,i==null?void 0:i.featureId);u===null&&(u=o);var c=u,p=ze(t),v=(0,U.Z)((0,U.Z)({},t.properties),{},{coordinates:p,_id:c});r.push(v)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function qt(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function Cn(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var mr=Q(28481),pt=Q(96486),Ei="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function gn(e){this.message=e}gn.prototype=new Error,gn.prototype.name="InvalidCharacterError";function Pi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new gn("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,t,o,u=0;o=i.charAt(u++);~o&&(t=n%4?t*64+o:o,n++%4)?r+=String.fromCharCode(255&t>>(-2*n&6)):0)o=Ei.indexOf(o);return r}function na(e){e=String(e);for(var i,r,n,t,o="",u=0,c=e.length%3;u<e.length;){if((r=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(t=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|t,o+=Ei.charAt(i>>18&63)+Ei.charAt(i>>12&63)+Ei.charAt(i>>6&63)+Ei.charAt(i&63)}return c?o.slice(0,c-3)+"===".substring(c):o}var vt=Q(6610),xt=Q(5991),Ii=function(){function e(i,r){(0,vt.Z)(this,e),this.buffers=i,this.type=r}return(0,xt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,t){throw new Error("not implemented")}}]),e}(),hi,Qi=function(){return hi||(hi=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof Q.g!="undefined"?Q.g:{})};hi=Qi();var Ji;typeof window=="undefined"?Ji={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ji=window;var ia=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Fi=ia?my.getSystemInfoSync().pixelRatio:Ji.devicePixelRatio,sr=Q(10379),xr=Q(46070),je=Q(77608),wa=(0,xt.Z)(function e(i,r){(0,vt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),Le=Q(63349);function As(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=us(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function us(e,i){if(!!e){if(typeof e=="string")return ta(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ta(e,i)}}function ta(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ys=new WeakMap,no=function(){function e(){(0,vt.Z)(this,e),Ys.set(this,{})}return(0,xt.Z)(e,[{key:"addEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Ys.get(this);o||(o={}),o[r]||(o[r]=[]),o[r].push(n),Ys.set(this,o),t.capture,t.once,t.passive}},{key:"removeEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Ys.get(this);if(o){var u=o[r];if(u&&u.length>0){for(var c=u.length;c--;c>0)if(u[c]===n){u.splice(c,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Ys.get(this)[r.type];if(n){var t=As(n),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u(r)}}catch(c){t.e(c)}finally{t.f()}}}}]),e}();function Wa(e){var i=io();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function io(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aa=function(e){(0,sr.Z)(r,e);var i=Wa(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.childNodes=[],n}return(0,xt.Z)(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var o=this.childNodes.findIndex(function(u){return u===t});return o>-1?this.childNodes.splice(o,1):null}}]),r}(no);function jo(e){var i=Qo();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Au=function(e){(0,sr.Z)(r,e);var i=jo(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n}return(0,xt.Z)(r,[{key:"setAttribute",value:function(t,o){this[t]=o}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,o){this[t]=o}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(aa),wo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,To,la,ao,Go;if(wo){var qa=my.getSystemInfoSync();To=qa.screenWidth,la=qa.screenHeight,ao=qa.windowWidth,Go=qa.windowHeight}else{var nu=Ji.innerWidth,Rl=Ji.innerHeight;To=nu,la=Rl,ao=nu,Go=Rl}var Jo={width:To,height:la,availWidth:ao,availHeight:Go,availLeft:0,availTop:0},he=Jo.availWidth,Pe=Jo.availHeight,dt={style:[]};function Jt(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return dt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return dt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function en(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:he+"px",height:Pe+"px",margin:"0px",padding:"0px"})}function Gn(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=he,e.clientHeight=Pe),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Bi(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=he,e.offsetHeight=Pe)}function fo(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=he,e.scrollHeight=Pe)}function za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Ka(e){var i=es();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Oo(){}var go=function(e){(0,sr.Z)(r,e);var i=Ka(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,vt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n.focus=Oo,n.blur=Oo,n.insertBefore=Oo,n.appendChild=Oo,n.removeChild=Oo,n.remove=Oo,n.innerHTML="",n.tagName=t.toUpperCase(),Jt((0,Le.Z)(n),o),en((0,Le.Z)(n)),za((0,Le.Z)(n)),Gn((0,Le.Z)(n)),Bi((0,Le.Z)(n)),fo((0,Le.Z)(n)),n}return(0,xt.Z)(r)}(Au);function ws(e){var i=Ts();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ms=function(e){(0,sr.Z)(r,e);var i=ws(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,xt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(go);function iu(e){var i=vu();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ys=function(e){(0,sr.Z)(r,e);var i=iu(r);function r(){return(0,vt.Z)(this,r),i.call(this,"video")}return(0,xt.Z)(r)}(Ms),zi={},Ia={};function Hc(e,i){zi=e,zi.id=i,"tagName"in zi||(zi.tagName="CANVAS"),zi.type="canvas",Mixin.parentNode(zi),Mixin.style(zi),Mixin.classList(zi),Mixin.clientRegion(zi),Mixin.offsetRegion(zi),zi.focus=function(){},zi.blur=function(){}}function yf(e,i){var r=1024,n=1024;Ia={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in Ia||(Ia.tagName="CANVAS"),Mixin.parentNode(Ia),Mixin.style(Ia),Mixin.classList(Ia),Mixin.clientRegion(Ia),Mixin.offsetRegion(Ia),Ia.getContext=function(t){if(t==="2d")return e},Ia.focus=function(){},Ia.blur=function(){}}function Is(){return zi}function _f(){return Ia}var hl=(0,xt.Z)(function e(){(0,vt.Z)(this,e);var i=Is(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Jt(r),za(r),Object.assign(r,{addEventListener:function(t,o){r["on".concat(t)]=o.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r}),el={href:"",protocol:"",host:""};function au(e){var i=Ol();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b=function(e){(0,sr.Z)(r,e);var i=au(r);function r(){return(0,vt.Z)(this,r),i.call(this,"body",0)}return(0,xt.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o,u){}},{key:"dispatchEvent",value:function(t){}}]),r}(go),M=function(e){(0,sr.Z)(r,e);var i=au(r);function r(){return(0,vt.Z)(this,r),i.call(this,"html",0)}return(0,xt.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o){}},{key:"dispatchEvent",value:function(t){}}]),r}(go),Z={},L={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:el,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new hl:i==="video"?new ys:new go(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){Z[i]||(Z[i]=[]),Z[i].push(r)},removeEventListener:function(i,r){var n=Z[i];if(n&&n.length>0){for(var t=n.length;t--;t>0)if(n[t]===r){n.splice(t,1);break}}},dispatchEvent:function(i){var r=i.type,n=Z[r];if(n)for(var t=0;t<n.length;t++)n[t](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new wa(i)}};L.documentElement=new M,L.head=new go("head"),L.body=new b;var ne=Object,ke=Q(90484),st=function(){function e(){(0,vt.Z)(this,e);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,ke.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,xt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Ft=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Bt,Sr,Br;if(Ft){var Hn=my.getSystemInfoSync();Bt=Hn.system,Sr=Hn.platform,Br=Hn.language}else{var Kn={versions:function(){var e=Ji.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ji.navigator.browserLanguage||Ji.navigator.language).toLowerCase()};Kn.versions.android?Sr="android":Kn.versions.trident?Sr="IE":Kn.versions.presto?Sr="Opera":Kn.versions.webKit?Sr="webKit":Kn.versions.gecko?Sr="Firefox":Kn.versions.mobile?Sr="mobile":Kn.versions.ios?Sr="ios":Kn.versions.iPhone?Sr="iPhone":Kn.versions.iPad?Sr="ipad":Kn.versions.webApp?Sr="webApp":Kn.versions.weixin?Sr="weixin":Kn.versions.qq&&(Sr="qq"),Bt=Ji.navigator.userAgent,Br=Kn.language}var yi=Bt.toLowerCase().indexOf("android")!==-1,$i=yi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ea="Mozilla/5.0 (".concat($i,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Br),La={platform:Sr,language:Br,appVersion:"5.0 (".concat($i,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ea},qi={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},_s=0,mu=0;function pl(e){var i=Date.now(),r=Math.max(_s+23,i);return mu=setTimeout(function(){e(_s=r)},r-i),mu}function xf(e){var i=Is();return i.requestAnimationFrame?i.requestAnimationFrame(e):pl(e)}function dl(e){var i=Is();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Wc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,vt.Z)(this,e),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,xt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],t=r.type,o=Nu(n),u="data:".concat(t,";base64, ");return u+o}}]),e}();function Nu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,t=0;t<n;t++)i+=String.fromCharCode(r[t]);return na(i)}var zu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Zu={};function yo(e){var i=th();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function th(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xc=new Map,xs=new Map,bf=new Map,tl={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function ou(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function rh(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,ou.call(this,"readystatechange",i)}var $s=function(e){(0,sr.Z)(r,e);var i=yo(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Xc.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,xt.Z)(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=bf.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=xs.get("responseHeader");return Object.keys(t).map(function(o){return"".concat(o,": ").concat(t[o])}).join(`
`)}},{key:"getResponseHeader",value:function(t){return xs.get("responseHeader")[t]}},{key:"open",value:function(t,o,u){this._method=t,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(t,o){var u=Xc.get("requestHeader");u[t]=o,Xc.set("requestHeader",u)}},{key:"addEventListener",value:function(t,o){var u=this;typeof o=="function"&&(this["on"+t]=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};c.target=c.target||u,o.call(u,c)})}},{key:"removeEventListener",value:function(t,o){this["on"+t]===o&&(this["on"+t]=null)}}]),r}(no);$s.UNSEND=0,$s.OPENED=1,$s.HEADERS_RECEIVED=2,$s.LOADING=3,$s.DONE=4;function Ta(e){var i=Dl();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Dl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lh=function(e){(0,sr.Z)(r,e);var i=Ta(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.touches=[],t.targetTouches=[],t.changedTouches=[],t.target=Is(),t.currentTarget=Is(),t}return(0,xt.Z)(r)}(wa);function Uu(e){var i=e||{},r=i.x,n=r===void 0?0:r,t=i.y,o=t===void 0?0:t,u=i.clientX,c=u===void 0?0:u,p=i.clientY,v=p===void 0?0:p;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=c,e.y=v)}function Yc(e){return function(i){var r=new Lh(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Uu(n)}),r.touches.forEach(function(n){return Uu(n)}),r.targetTouches.forEach(function(n){return Uu(n)}),L.dispatchEvent(r)}}function Sp(e){return function(i){i.type=e,L.dispatchEvent(i)}}var Cp=Yc("touchstart"),nh=Yc("touchmove"),$c=Yc("touchend"),lc=Sp("mapCameaParams");function Fl(e){var i=Bl();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Bl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vl=function(e){(0,sr.Z)(r,e);var i=Fl(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.target=Is(),t.currentTarget=Is(),t}return(0,xt.Z)(r)}(wa),ml=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],gl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],su="touch";function Ef(e,i,r){for(var n=new vl(e),t=0;t<ml.length;t++){var o=ml[t];n[o]=i[o]||gl[t]}return n.type=e,n.target=Is(),n.currentTarget=Is(),n.buttons=Sf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=yl(i),n.pointerType=su,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Sf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Nl=null;function yl(e){return Nl===e.identifier}function cc(e){Nl===null&&(Nl=e.identifier)}function qc(e){Nl===e.identifier&&(Nl=null)}function fc(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var t=r[n];n===0&&e==="pointerdown"?cc(t):(e==="pointerup"||e==="pointercancel")&&qc(t);var o=Ef(e,t,i);L.dispatchEvent(o)}}}var Cf=fc("pointerdown"),Ap=fc("pointermove"),Af=fc("pointerup");function _l(e){var i=wf();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function wf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ih=function(e){(0,sr.Z)(r,e);var i=_l(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,xt.Z)(r)}(wa);function Vu(e){return function(i){i.type=e,L.dispatchEvent(i)}}var Rh=Vu("mousedown"),Oh=Vu("mousemove"),Dh=Vu("mouseup"),zl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Fh=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ts=zl||Fh,Qa={atob:Pi,btoa:na,devicePixelRatio:Fi,Blob:Ii,document:L,Element:Au,Event:wa,EventTarget:no,HTMLCanvasElement:ne,HTMLElement:go,HTMLMediaElement:Ms,HTMLVideoElement:ys,Image:hl,ImageData:st,navigator:La,Node:aa,requestAnimationFrame:xf,cancelAnimationFrame:dl,screen:Jo,XMLHttpRequest:$s,performance:qi,URL:Wc,WebGLRenderingContext:zu,WebGL2RenderingContext:Zu,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};L.addEventListener(i,r,n)},removeEventListener:function(i,r,n){L.removeEventListener(i,r)},dispatchEvent:function(i){L.dispatchEvent(i)},innerWidth:Jo.availWidth,innerHeight:Jo.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ca=ts?Qa:Ji,Zl=ts?$s:Ji.XMLHttpRequest,rl=ts?el:Ji.location;function Wi(e){var i=e;return typeof e=="string"&&(i=ca.document.getElementById(e)),i}function Ra(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Fs(e){return Ra(e).split(/\s+/)}function Kc(e){var i,r,n=ca==null||(i=ca.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var t in e)if(e[t]&&e[t]in n)return e[t];return e[0]}function Ni(e,i,r){var n=ca.document.createElement(e);return i&&(n.className=i||""),r&&r.appendChild(n),n}function ks(e){var i=e.parentNode;i&&i.removeChild(e)}function wu(e,i){if(e.classList!==void 0)for(var r=Fs(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!Qc(e,i)){var o=Tu(e);hc(e,(o?o+" ":"")+i)}}function Ul(e,i){e.classList!==void 0?e.classList.remove(i):hc(e,Ra((" "+Tu(e)+" ").replace(" "+i+" "," ")))}function Qc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Tu(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function hc(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Tu(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ho(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var pc=Kc(["transform","WebkitTransform"]);function Vl(e,i){e.style[pc]=i}function Mo(){if(typeof Event=="function")ca.dispatchEvent(new Event("resize"));else{var e=ca.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ca,0),ca.dispatchEvent(e)}}function Fn(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function ho(){var e,i=ca.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,mr.Z)(o,1),c=u[0];return c==="initial-scale"});return n?n.split("=")[1]*1:1}var Oa=ho()<1?1:ca.devicePixelRatio;function xl(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function uu(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function qs(e,i){var r,n=uu((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=uu(i),o=pt.pull.apply(void 0,[n].concat((0,N.Z)(t)));e.setAttribute("style",o.join(";"))}function Tf(e){return Object.entries(e).map(function(i){var r=(0,mr.Z)(i,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function dn(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function dc(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function jl(e){e.innerHTML=""}function nl(e){e.setAttribute("draggable","false")}function Va(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Bs(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function vc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function ju(e){if(e.length===0)throw new Error("mean requires at least one data point");return vc(e)/e.length}function Ns(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var gu={min:Bs,max:Va,mean:ju,sum:vc,mode:Ns};function Mf(e,i){return e.map(function(r){return r[i]})}function Jc(e,i){return gu[e](i)}var If=Q(14665);function ah(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var lu=Q(51814);function bs(e,i,r){return(0,lu.Z)()?bs=Reflect.construct.bind():bs=function(t,o,u){var c=[null];c.push.apply(c,o);var p=Function.bind.apply(t,c),v=new p;return u&&(0,If.Z)(v,u.prototype),v},bs.apply(null,arguments)}function Oi(e){var i=typeof Map=="function"?new Map:void 0;return Oi=function(n){if(n===null||!ah(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return bs(n,arguments,(0,je.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,If.Z)(t,n)},Oi(e)}function Mu(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function yu(){return typeof importScripts=="function"}var ls=yu()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function bl(e){var i=El();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function El(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zs=function(e){(0,sr.Z)(r,e);var i=bl(r);function r(n,t,o,u){var c;return(0,vt.Z)(this,r),c=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),c.status=n,c.statusText=t,c.url=o,c.body=u,c}return(0,xt.Z)(r)}(Oi(Error));function Zs(e,i){var r=Array.isArray(e.url)?e.url[0]:e.url,n=new Request(r,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&n.headers.set("Accept","application/json"),fetch(n).then(function(t){return t.ok?(e.type==="arrayBuffer"?t.arrayBuffer():e.type==="json"?t.json():t.text()).then(function(o){i(null,o,t.headers.get("Cache-Control"),t.headers.get("Expires"))}).catch(function(o){i(new Error(o.message))}):t.blob().then(function(o){return i(new zs(t.status,t.statusText,r.toString(),o))})}).catch(function(t){i(new Error(t.message))})}function cu(e,i){var r=new Zl,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(c){return i(c)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new zs(r.status,r.statusText,n.toString(),u))}},r.send(e.body),r}function $n(e){return new Promise(function(i,r){cu(e,function(n,t,o,u,c){n?r({err:n,data:null,xhr:c}):i({err:null,data:t,cacheControl:o,expires:u,xhr:c})})})}function Un(e,i){return cu(e,i)}var kf=function(i,r){return Un(_objectSpread(_objectSpread({},i),{},{type:"json"}),r)},rs=function(i,r){return Un((0,U.Z)((0,U.Z)({},i),{},{type:"arrayBuffer"}),r)},Iu=function(i,r){return Un(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)};function cs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var _u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pf(e,i){var r=new ca.Image,n=ca.URL||ca.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=_u})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):_u}function ef(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var fa=function(i,r){return rs(i,function(n,t){if(n)r(n);else if(t){var o=typeof createImageBitmap=="function";o?ef(t,r):Pf(t,r)}})};function Da(e){return typeof e=="number"}function tf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return vr(e,function(r){i[0]>r[0]&&(i[0]=r[0]),i[1]>r[1]&&(i[1]=r[1]),i[2]<r[0]&&(i[2]=r[0]),i[3]<r[1]&&(i[3]=r[1])}),i}tf.default=tf;var Gl=tf,Ks=2*Math.PI*6378137/2;function ku(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Do(i,n)}),i}function Do(e,i){return Array.isArray(i[0])?i.forEach(function(r){Do(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Sl(e,i){return xu(e,i)}function xu(e,i){return Array.isArray(e[0])?e.map(function(r){return xu(r,i)}):i(e)}function Hl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=yc(e,i);var n=e[0],t=e[1],o=n*Ks/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*Ks/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function mc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/Ks*180,o=n/Ks*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function gc(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Lf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function yc(e,i){if(i===!1)return e;var r=gc(e[0]),n=Lf(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function _o(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var c=.5/Math.PI,p=.5,v=-.5/Math.PI;return t=.5,o=n*(c*o+p),u=n*(v*u+t),[Math.floor(o),Math.floor(u)]}function Bh(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),c=u[0],p=u[1];c=(c/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var v=p/t,x=c/t;return[x,v]}function Wl(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function Xl(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function Rf(e,i,r){var n=xe(i[1]-e[1]),t=xe(i[0]-e[0]),o=xe(e[1]),u=xe(i[1]),c=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Na(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r="meters")}function Yl(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,c=n*Math.log((1+o)/(1-o))/2;return[u,c]}function fs(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function _c(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Cl(e){return[[e[0],e[1]],[e[2],e[3]]]}function Of(e){var i=$l(e,[0,0]);return[e[0]/i,e[1]/i]}function $l(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function f(e,i){return e[0]*i[0]+e[1]*i[1]}function d(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function h(e,i){return Math.acos(f(e,i)/(d(e)*d(i)))*180/Math.PI}function g(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function C(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],c=e[o+1],p=$l(u,c);n+=p;var v=[u[0]-c[0],u[1]-c[1]],x=g(r,v);if(o>0){var S=t[o-1].rotation;S-x>360-S+x&&(x=x+360)}t.push({start:u,end:c,dis:p,rotation:x,duration:0})}return t.map(function(w){w.duration=i*(w.dis/n)}),t}}function T(e){if(Da(e[0]))return e;if(Da(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Da(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function k(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,c=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),r=Math.max(x,r),n=Math.min(v,n),t=Math.min(x,t),o+=v,u+=x,c++)}return{center:[o/c,u/c],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}function D(e){return Gl(Ri([xi(e)]))}var G=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,vt.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,xt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function ee(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var _e=null,Ee=Q(2650);function Ce(e){return typeof e=="string"?!!Ee.ZP(e):!1}function Re(e){var i=Ee.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Ze(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function nt(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Fe(e){var i=ca.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=null;if(e.weights){var t=0;e.weights.map(function(w,I){var R=e.colors[I]||"rgba(0, 0, 0, 0)",O=t+w;r.fillStyle=R,r.fillRect(t*256,0,O*256,1),t=O})}else{for(var o=r.createLinearGradient(0,0,256,1),u=e.positions[0],c=e.positions[e.positions.length-1],p=0;p<e.colors.length;++p){var v=(e.positions[p]-u)/(c-u);o.addColorStop(v,e.colors[p])}r.fillStyle=o,r.fillRect(0,0,256,1)}if(ts)return n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1};n=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),S=0;S<x.data.length;S+=4)x.data[S+0]=n[S+0],x.data[S+1]=n[S+1],x.data[S+2]=n[S+2],x.data[S+3]=n[S+3];return i=null,r=null,x}var at;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right"})(at||(at={}));var yt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ut(e,i,r){var n=e.classList;for(var t in yt)yt.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}function Zt(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Ct=Q(92137),yr=Q(87757),Et=Q.n(yr);function Qr(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var Hr={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},An=Hr.self||Hr.window||{},Qn=Hr.window||Hr.self||{},Jn=Hr.self||Hr.window||{},ni=Hr.document||{},Xi=typeof importScripts=="function",wn=typeof window!="undefined"&&typeof window.orientation!="undefined",Si=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){Qr(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){Qr(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),Ai=Si,vi=new Map;function ai(e){Qr(e.source&&!e.url||!e.source&&e.url);var i=vi.get(e.source||e.url);return i||(e.url&&(i=wi(e.url),vi.set(e.url,i)),e.source&&(i=li(e.source),vi.set(e.source,i))),Qr(i),i}function wi(e){if(!e.startsWith("http"))return e;var i=oi(e);return li(i)}function li(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function oi(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function xo(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(Ja(e))n.add(e);else if(Ja(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)xo(e[t],i,n)}}return r===void 0?Array.from(n):[]}function Ja(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Io=function(){},Wo=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;Qr(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=Io,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Io,this.onError=Io,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||xo(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=ai({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),eo=Wo,to=function(){return to=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},to.apply(this,arguments)},Ps=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(c,p)}v((n=n.apply(e,i||[])).next())})},hs=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Gu=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=to(to({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),Ps(this,void 0,void 0,function(){var t,o=this;return hs(this,function(u){switch(u.label){case 0:return t=new Promise(function(c){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:c}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Ps(this,void 0,void 0,function(){var i,r,n;return hs(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new Ai(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new eo({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return wn?this.maxMobileConcurrency:this.maxConcurrency},e}(),Es=Gu,Ls=function(){return Ls=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},Ls.apply(this,arguments)},Qs=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},xc={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ql=function(){function e(i){this.workerPools=new Map,this.props=Ls({},xc),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return eo.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=Qs(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=Ls(Ls({},this.props),i);try{for(var t=Qs(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new Es({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Hu=ql,il=new Map,bc=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!Al(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=il.get(i);r||(r=function(n){if(!!Al(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=il.get(i);il.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=xo(r);self.postMessage(n,t)}},e}(),Xo=bc;function Al(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function Wu(e){return JSON.parse(ko(e))}function ko(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function al(e){return""+e.name}function wl(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var Xu=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(c,p)}v((n=n.apply(e,i||[])).next())})},oa=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function fu(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function Rs(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),Xu(this,void 0,void 0,function(){var t,o,u,c,p,v,x,S;return oa(this,function(w){switch(w.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),c=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,c.startJob(p,ol.bind(null,n))];case 1:return v=w.sent(),x=removeNontransferableOptions(r),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return S=w.sent(),[2,S.result]}})})}function ol(e,i,r,n){return Xu(this,void 0,void 0,function(){var t,o,u,c,p,v,x;return oa(this,function(S){switch(S.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,c=n.options,S.label=4;case 4:return S.trys.push([4,6,,7]),e.process?[4,e.process(u,c)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=S.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=S.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),S.label=9;case 9:return[2]}})})}var rf=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),nf=rf,Df=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(c,p)}v((n=n.apply(e,i||[])).next())})},hu=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Ec=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(c,p){u=e[o](u),t(c,p,u.done,u.value)})}}function t(o,u,c,p){Promise.resolve(p).then(function(v){o({value:v,done:c})},u)}},bu=0,Pu,Sc;function Lu(e,i){var r=this;if(typeof self!="undefined"){var n={process:Yo};Xo.onmessage=function(t,o){return Df(r,void 0,void 0,function(){var u,c,p,v,x,S,w,I,R,O,B;return hu(this,function(H){switch(H.label){case 0:switch(H.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return c=H.sent(),Xo.postMessage("done",{result:c}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");Pu=new nf,Sc=o.options||{},p=i(Pu,Sc,n),H.label=4;case 4:H.trys.push([4,9,10,15]),v=Ec(p),H.label=5;case 5:return[4,v.next()];case 6:if(x=H.sent(),!!x.done)return[3,8];S=x.value,Xo.postMessage("output-batch",{result:S}),H.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return w=H.sent(),O={error:w},[3,15];case 10:return H.trys.push([10,,13,14]),x&&!x.done&&(B=v.return)?[4,B.call(v)]:[3,12];case 11:H.sent(),H.label=12;case 12:return[3,14];case 13:if(O)throw O.error;return[7];case 14:return[7];case 15:return Xo.postMessage("done",{}),[3,18];case 16:return Pu.push(o.input),[3,18];case 17:return Pu.close(),[3,18];case 18:return[3,20];case 19:return I=H.sent(),R=I instanceof Error?I.message:"",Xo.postMessage("error",{error:R}),[3,20];case 20:return[2]}})})}}}function Yo(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=bu++,o=function(c,p){if(p.id===t)switch(c){case"done":Xo.removeEventListener(o),r(p.result);break;case"error":Xo.removeEventListener(o),n(p.error);break;default:}};Xo.addEventListener(o);var u={id:t,input:e,options:i};Xo.postMessage("process",u)})}var Cc=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(c,p)}v((n=n.apply(e,i||[])).next())})},Ff=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Bf={};function Nh(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),Cc(this,void 0,void 0,function(){return Ff(this,function(n){switch(n.label){case 0:return i&&(e=wp(e,i,r)),Bf[e]=Bf[e]||Tp(e),[4,Bf[e]];case 1:return[2,n.sent()]}})})}function wp(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function Tp(e){return Cc(this,void 0,void 0,function(){var i,r,n;return Ff(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,Ac(n,e)]}})})}function Ac(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var oh="0.0.3",Mp={id:"null",name:"null",module:"web-worker-helper",options:{}};function zh(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function sl(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function wc(e){var i=e.filter;return i?[1]:[0]}function Zh(e,i){return[i]}var $d=Q(9187),Us=Q.n($d),Y=Q(96156),$r=Q(31437),Uh=$r.create(),qd=$r.create(),$o=$r.create(),Tc=$r.create(),ul=$r.create();function Ip(e,i,r,n,t){$r.add(e,r,n),$r.normalize(e,e),i=$r.fromValues(-e[1],e[0]);var o=$r.fromValues(-r[1],r[0]);return[t/$r.dot(i,o),i]}function Xa(e,i){return $r.set(e,-i[1],i[0])}function Kl(e,i,r){return $r.sub(e,i,r),$r.normalize(e,e),e}function Vh(e,i){return e[0]===i[0]&&e[1]===i[1]}function kp(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var jh=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,Y.Z)(this,"lastFlip",-1),(0,Y.Z)(this,"miter",$r.fromValues(0,0)),(0,Y.Z)(this,"started",!1),(0,Y.Z)(this,"dash",!1),(0,Y.Z)(this,"totalDistance",0),(0,Y.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,xt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,v,x,S=r[c-1];S.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var w=n[c-1],I=r[c];I.push((v=n[c][2])!==null&&v!==void 0?v:0);var R=n[c],O=c<r.length-1?[].concat((0,N.Z)(r[c+1]),[(x=n[c+1][2])!==null&&x!==void 0?x:0]):null,B=c<n.length-1?n[c+1]:null,H=this.segment_gaode2(t,u,S,I,O,w,R,B);u+=H}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,v,x,S=r[c-1];S.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var w=n[c-1],I=r[c];I.push((v=n[c][2])!==null&&v!==void 0?v:0);var R=n[c],O=c<r.length-1?[].concat((0,N.Z)(r[c+1]),[(x=n[c+1][2])!==null&&x!==void 0?x:0]):null,B=c<n.length-1?n[c+1]:null,H=this.simpleSegment(t,u,S,I,O,w,R,B);u+=H}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,c,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,c,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,c,p,v){var x=0,S=r.indices,w=r.positions,I=r.normals,R=this.cap==="square",O=this.join==="bevel",B=_o([p[0],p[1]]),H=_o([c[0],c[1]]);Kl($o,o,t);var ae=0;if(this.dash&&(ae=this.lineSegmentDistance(B,H),this.totalDistance+=ae),this.normal||(this.normal=$r.create(),Xa(this.normal,$o)),!this.started)if(this.started=!0,R){var oe=$r.create(),Ie=$r.create();$r.add(oe,this.normal,$o),$r.add(Ie,this.normal,$o),I.push(Ie[0],Ie[1],0),I.push(oe[0],oe[1],0),w.push(t[0],t[1],t[2]|0,this.totalDistance-ae,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),w.push(t[0],t[1],t[2]|0,this.totalDistance-ae,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,I,t,this.normal,this.thickness,this.totalDistance-ae);if(S.push(n+0,n+1,n+2),u){Vh(o,u)&&$r.add(u,o,$r.normalize(u,$r.subtract(u,o,t))),Kl(Tc,u,o);var At=Ip(ul,$r.create(),$o,Tc,this.thickness),gt=(0,mr.Z)(At,2),$t=gt[0],gr=gt[1],dr=$r.dot(ul,this.normal)<0?-1:1,kr=O;if(!kr&&this.join==="miter"){var Sn=$t;Sn>this.miterLimit&&(kr=!0)}kr?(I.push(this.normal[0],this.normal[1],0),I.push(gr[0],gr[1],0),w.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),w.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,N.Z)(this.lastFlip!==-dr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),Xa(Uh,Tc),$r.copy(this.normal,Uh),I.push(this.normal[0],this.normal[1],0),w.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(w,I,o,gr,$t,this.totalDistance),S.push.apply(S,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),dr=-1,$r.copy(this.normal,gr),x+=2),this.lastFlip=dr}else{if(Xa(this.normal,$o),R){var Oe=$r.create(),it=$r.create();$r.sub(it,$o,this.normal),$r.add(Oe,$o,this.normal),I.push(it[0],it[1],0),I.push(Oe[0],Oe[1],0),w.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),w.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,I,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(r,n,t,o,u){var c=0,p=r.indices,v=r.positions,x=r.normals,S=_o([o[0],o[1]]),w=_o([t[0],t[1]]);Kl($o,S,w);var I=0;if(this.dash&&(I=this.lineSegmentDistance(S,w),this.totalDistance+=I),this.normal||(this.normal=$r.create(),Xa(this.normal,$o)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-I)),p.push(n+0,n+1,n+2),!u)Xa(this.normal,$o),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2;else{var R=_o([u[0],u[1]]);Vh(S,R)&&$r.add(R,S,$r.normalize(R,$r.subtract(R,S,w))),Kl(Tc,R,S);var O=Ip(ul,$r.create(),$o,Tc,this.thickness),B=(0,mr.Z)(O,2),H=B[0],ae=B[1],oe=$r.dot(ul,this.normal)<0?-1:1;this.extrusions(v,x,o,ae,H,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),oe=-1,$r.copy(this.normal,ae),c+=2,this.lastFlip=oe}return c}},{key:"segment",value:function(r,n,t,o,u){var c=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",w=this.join==="bevel",I=_o([o[0],o[1]]),R=_o([t[0],t[1]]);Kl($o,I,R);var O=0;if(this.dash&&(O=this.lineSegmentDistance(I,R),this.totalDistance+=O),this.normal||(this.normal=$r.create(),Xa(this.normal,$o)),!this.started)if(this.started=!0,S){var B=$r.create(),H=$r.create();$r.add(B,this.normal,$o),$r.add(H,this.normal,$o),x.push(H[0],H[1],0),x.push(B[0],B[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-O,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-O,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-O);if(p.push(n+0,n+1,n+2),u){var Ie=_o([u[0],u[1]]);Vh(I,Ie)&&$r.add(Ie,I,$r.normalize(Ie,$r.subtract(Ie,I,R))),Kl(Tc,Ie,I);var Oe=Ip(ul,$r.create(),$o,Tc,this.thickness),it=(0,mr.Z)(Oe,2),At=it[0],gt=it[1],$t=$r.dot(ul,this.normal)<0?-1:1,gr=w;if(!gr&&this.join==="miter"){var dr=At;dr>this.miterLimit&&(gr=!0)}gr?(x.push(this.normal[0],this.normal[1],0),x.push(gt[0],gt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,N.Z)(this.lastFlip!==-$t?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Xa(Uh,Tc),$r.copy(this.normal,Uh),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(v,x,o,gt,At,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$t=-1,$r.copy(this.normal,gt),c+=2),this.lastFlip=$t}else{if(Xa(this.normal,$o),S){var ae=$r.create(),oe=$r.create();$r.sub(oe,$o,this.normal),$r.add(ae,$o,this.normal),x.push(oe[0],oe[1],0),x.push(ae[0],ae[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2}return c}},{key:"extrusions",value:function(r,n,t,o,u,c){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,c,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,c,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}();function af(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new jh({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var c=0;c<o.length;c++){var p=o[c],v=u[c];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(w){t.extrude(w)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function of(e){var i=T(e.coordinates);return{vertices:[].concat((0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Nf(e){var i=e.coordinates,r=Us().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Us()(n,o,t),vertices:n,size:t}}var Mc=function(){var e=(0,Ct.Z)(Et().mark(function i(r){var n,t,o,u,c,p,v,x,S;return Et().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,c={a_Color:zh,a_Position:sl,filter:wc,a_vertexId:Zh,a_PickingColor:function(O){var B=O.id;return o?nt(B):[0,0,0]},a_DistanceAndIndex:function(O,B,H,ae,oe,Ie){return Ie===void 0?[H[3],10]:[H[3],Ie]},a_Total_Distance:function(O,B,H){return[H[5]]},a_Size:function(O){var B=O.size,H=B===void 0?1:B;return Array.isArray(H)?[H[0],H[1]]:[H,0]},a_Normal:function(O,B,H,ae,oe){return oe},a_Miter:function(O,B,H){return[H[4]]},a_iconMapUV:function(O){var B=O.texture,H=u[B]||{x:0,y:0},ae=H.x,oe=H.y;return[ae,oe]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(R,O){var B=af(R),H=B.indices,ae=B.vertices,oe=B.normals,Ie=B.size,Oe=B.indexes;H.forEach(function($t){x.push($t+v)}),S=Ie;var it=ae.length/Ie;p.sizePerElement=S,p.elements.push({featureIdx:O,vertices:ae,normals:oe,offset:v}),v+=it;for(var At=function(gr){var dr=(oe==null?void 0:oe.slice(gr*3,gr*3+3))||[],kr=ae.slice(gr*Ie,gr*Ie+Ie),Sn=0;Oe&&Oe[gr]!==void 0&&(Sn=Oe[gr]),n.forEach(function(Vn){if(Vn&&c[Vn.name]){var Vi;(Vi=Vn.buffer.data).push.apply(Vi,(0,N.Z)(c[Vn.name](R,O,kr,gr,dr,Sn)))}})},gt=0;gt<it;gt++)At(gt)}),I.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return I.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),zf=function(){var e=(0,Ct.Z)(Et().mark(function i(r){var n,t,o,u,c,p,v,x,S;return Et().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,c={a_Color:zh,a_Position:sl,filter:wc,a_vertexId:Zh,a_PickingColor:function(O){var B=O.id;return o?nt(B):[0,0,0]},a_Shape:function(O){var B=O.shape,H=B===void 0?2:B,ae=u.indexOf(H);return[ae]},a_Extrude:function(O,B,H,ae){var oe=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ie=ae%4*3;return[oe[Ie],oe[Ie+1],oe[Ie+2]]},a_Size:function(O){var B=O.size,H=B===void 0?5:B;return Array.isArray(H)?[H[0]]:[H]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(R,O){var B=of(R),H=B.indices,ae=B.vertices,oe=B.normals,Ie=B.size,Oe=B.indexes;H.forEach(function($t){x.push($t+v)}),S=Ie;var it=ae.length/Ie;p.sizePerElement=S,p.elements.push({featureIdx:O,vertices:ae,normals:oe,offset:v}),v+=it;for(var At=function(gr){var dr=(oe==null?void 0:oe.slice(gr*3,gr*3+3))||[],kr=ae.slice(gr*Ie,gr*Ie+Ie),Sn=0;Oe&&Oe[gr]!==void 0&&(Sn=Oe[gr]),n.forEach(function(Vn){if(Vn&&c[Vn.name]){var Vi;(Vi=Vn.buffer.data).push.apply(Vi,(0,N.Z)(c[Vn.name](R,O,kr,gr,dr,Sn)))}})},gt=0;gt<it;gt++)At(gt)}),I.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return I.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),sh=function(){var e=(0,Ct.Z)(Et().mark(function i(r){var n,t,o,u,c,p,v,x;return Et().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:zh,a_Position:sl,filter:wc,a_vertexId:Zh,a_PickingColor:function(R){var O=R.id;return o?nt(O):[0,0,0]}},c={sizePerElement:0,elements:[]},p=0,v=[],x=3,t.forEach(function(I,R){var O=Nf(I),B=O.indices,H=O.vertices,ae=O.normals,oe=O.size,Ie=O.indexes;B.forEach(function(gt){v.push(gt+p)}),x=oe;var Oe=H.length/oe;c.sizePerElement=x,c.elements.push({featureIdx:R,vertices:H,normals:ae,offset:p}),p+=Oe;for(var it=function($t){var gr=(ae==null?void 0:ae.slice($t*3,$t*3+3))||[],dr=H.slice($t*oe,$t*oe+oe),kr=0;Ie&&Ie[$t]!==void 0&&(kr=Ie[$t]),n.forEach(function(Sn){if(Sn&&u[Sn.name]){var Vn;(Vn=Sn.buffer.data).push.apply(Vn,(0,N.Z)(u[Sn.name](I,R,dr,$t,gr,kr)))}})},At=0;At<Oe;At++)it(At)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:v});case 8:case"end":return w.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),uh={pointFill:zf,line:Mc,polygonFill:sh},Ql=(0,U.Z)({},uh);function Gh(e){return sf.apply(this,arguments)}function sf(){return sf=(0,Ct.Z)(Et().mark(function e(i){var r,n;return Et().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!Ql[r]){o.next=3;break}return o.abrupt("return",Ql[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),sf.apply(this,arguments)}Lu(Gh);var lh=new Map;function Zf(e,i){lh.set(e,i)}function Uf(e){var i=lh.get(e);return i}var pu=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=f(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function p(){}function v(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&n.call(g,i)&&(d=g);var m=v.prototype=h.prototype=Object.create(d);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=f(t[o],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=f(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,s(m,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,u,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=function(t){return P?L(t):function(){return M.apply(t,arguments)}},C=R({}.toString),N=R("".slice),D=function(t){return N(C(t),8,-1)},F=function(t){if("Function"===D(t))return R(t)},W=function(t){return null==t},z=TypeError,B=function(t){if(W(t))throw z("Can't call method on "+t);return t},U=Object,G=function(t){return U(B(t))},H=F({}.hasOwnProperty),V=Object.hasOwn||function(t,e){return H(G(t),e)},q=0,Z=Math.random(),Y=F(1..toString),$=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Y(++q+Z,36)},K="object"==typeof document&&document.all,Q={all:K,IS_HTMLDDA:void 0===K&&void 0!==K},X=Q.all,J=Q.IS_HTMLDDA?function(t){return"function"==typeof t||t===X}:function(t){return"function"==typeof t},tt=function(t){return J(t)?t:void 0},et=function(t,e){return arguments.length<2?tt(O[t]):O[t]&&O[t][e]},rt=et("navigator","userAgent")||"",nt=O.process,ot=O.Deno,it=nt&&nt.versions||ot&&ot.version,at=it&&it.v8;at&&(E=(w=at.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&rt&&(!(w=rt.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=rt.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var ut=E,st=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ut&&ut<41})),ct=st&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ft=I("wks"),lt=O.Symbol,ht=lt&&lt.for,pt=ct?lt:lt&&lt.withoutSetter||$,vt=function(t){if(!V(ft,t)||!st&&"string"!=typeof ft[t]){var e="Symbol."+t;st&&V(lt,t)?ft[t]=lt[t]:ft[t]=ct&&ht?ht(e):pt(e)}return ft[t]},dt={};dt[vt("toStringTag")]="z";var yt="[object z]"===String(dt),gt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),mt=Q.all,xt=Q.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:J(t)||t===mt}:function(t){return"object"==typeof t?null!==t:J(t)},bt=O.document,wt=xt(bt)&&xt(bt.createElement),Et=function(t){return wt?bt.createElement(t):{}},At=!gt&&!j((function(){return 7!=Object.defineProperty(Et("div"),"a",{get:function(){return 7}}).a})),Ot=gt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),St=String,Tt=TypeError,kt=function(t){if(xt(t))return t;throw Tt(St(t)+" is not an object")},It=Function.prototype.call,jt=P?It.bind(It):function(){return It.apply(It,arguments)},Pt=F({}.isPrototypeOf),_t=Object,Mt=ct?function(t){return"symbol"==typeof t}:function(t){var e=et("Symbol");return J(e)&&Pt(e.prototype,_t(t))},Lt=String,Rt=function(t){try{return Lt(t)}catch(t){return"Object"}},Ct=TypeError,Nt=function(t){if(J(t))return t;throw Ct(Rt(t)+" is not a function")},Dt=function(t,e){var r=t[e];return W(r)?void 0:Nt(r)},Ft=TypeError,Wt=TypeError,zt=vt("toPrimitive"),Bt=function(t,e){if(!xt(t)||Mt(t))return t;var r,n=Dt(t,zt);if(n){if(void 0===e&&(e="default"),r=jt(n,t,e),!xt(r)||Mt(r))return r;throw Wt("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;if(J(r=t.valueOf)&&!xt(n=jt(r,t)))return n;if("string"!==e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;throw Ft("Can't convert object to primitive value")}(t,e)},Ut=function(t){var e=Bt(t,"string");return Mt(e)?e:e+""},Gt=TypeError,Ht=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,qt={f:gt?Ot?function(t,e,r){if(kt(t),e=Ut(e),kt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Vt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ht(t,e,r)}:Ht:function(t,e,r){if(kt(t),e=Ut(e),kt(r),At)try{return Ht(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Gt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Zt=Function.prototype,Yt=gt&&Object.getOwnPropertyDescriptor,$t=V(Zt,"name"),Kt={EXISTS:$t,PROPER:$t&&"something"===function(){}.name,CONFIGURABLE:$t&&(!gt||gt&&Yt(Zt,"name").configurable)},Qt=F(Function.toString);J(k.inspectSource)||(k.inspectSource=function(t){return Qt(t)});var Xt,Jt,te,ee=k.inspectSource,re=O.WeakMap,ne=J(re)&&/native code/.test(String(re)),oe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ie=gt?function(t,e,r){return qt.f(t,e,oe(1,r))}:function(t,e,r){return t[e]=r,t},ae=I("keys"),ue=function(t){return ae[t]||(ae[t]=$(t))},se={},ce=O.TypeError,fe=O.WeakMap;if(ne||k.state){var le=k.state||(k.state=new fe);le.get=le.get,le.has=le.has,le.set=le.set,Xt=function(t,e){if(le.has(t))throw ce("Object already initialized");return e.facade=t,le.set(t,e),e},Jt=function(t){return le.get(t)||{}},te=function(t){return le.has(t)}}else{var he=ue("state");se[he]=!0,Xt=function(t,e){if(V(t,he))throw ce("Object already initialized");return e.facade=t,ie(t,he,e),e},Jt=function(t){return V(t,he)?t[he]:{}},te=function(t){return V(t,he)}}var pe={set:Xt,get:Jt,has:te,enforce:function(t){return te(t)?Jt(t):Xt(t,{})},getterFor:function(t){return function(e){var r;if(!xt(e)||(r=Jt(e)).type!==t)throw ce("Incompatible receiver, "+t+" required");return r}}},ve=b((function(t){var e=Kt.CONFIGURABLE,r=pe.enforce,n=pe.get,o=Object.defineProperty,i=gt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!V(t,"name")||e&&t.name!==n)&&(gt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&V(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&V(u,"constructor")&&u.constructor?gt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return V(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return J(this)&&n(this).source||ee(this)}),"toString")})),de=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(J(r)&&ve(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:qt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},ye=vt("toStringTag"),ge=Object,me="Arguments"==D(function(){return arguments}()),xe=yt?D:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?D(e):"Object"==(n=D(e))&&J(e.callee)?"Arguments":n},be=yt?{}.toString:function(){return"[object "+xe(this)+"]"};yt||de(Object.prototype,"toString",be,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=F("".split),Te=j((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==D(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(B(t))},Ie=Object.getOwnPropertyDescriptor,je={f:gt?Ie:function(t,e){if(t=ke(t),e=Ut(e),At)try{return Ie(t,e)}catch(t){}if(V(t,e))return oe(!jt(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ce=Math.min,Ne=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ce(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ne(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=F([].push),He=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!V(se,r)&&V(n,r)&&Ge(i,r);for(;e.length>o;)V(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},Ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=Ve.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return He(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=F([].concat),Ke=et("Reflect","ownKeys")||function(t){var e=Ze.f(kt(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=qt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];V(t,u)||r&&V(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(J(e)?j(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&ie(i,"sham",!0),de(r,n,i,t)}},ur="process"==D(O.process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=F(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return kt(r),function(t){if("object"==typeof t||J(t))return t;throw cr("Can't set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=qt.f,hr=vt("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!V(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=vt("species"),dr=function(t){var e=et(t),r=qt.f;gt&&e&&!e[vr]&&r(e,vr,{configurable:!0,get:function(){return this}})},yr=TypeError,gr=function(t,e){if(Pt(e,t))return t;throw yr("Incorrect invocation")},mr=function(){},xr=[],br=et("Reflect","construct"),wr=/^\\s*(?:class|function)\\b/,Er=F(wr.exec),Ar=!wr.exec(mr),Or=function(t){if(!J(t))return!1;try{return br(mr,xr,t),!0}catch(t){return!1}},Sr=function(t){if(!J(t))return!1;switch(xe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ar||!!Er(wr,ee(t))}catch(t){return!0}};Sr.sham=!0;var Tr,kr,Ir,jr,Pr=!br||j((function(){var t;return Or(Or.call)||!Or(Object)||!Or((function(){t=!0}))||t}))?Sr:Or,_r=TypeError,Mr=function(t){if(Pr(t))return t;throw _r(Rt(t)+" is not a constructor")},Lr=vt("species"),Rr=function(t,e){var r,n=kt(t).constructor;return void 0===n||W(r=kt(n)[Lr])?e:Mr(r)},Cr=Function.prototype,Nr=Cr.apply,Dr=Cr.call,Fr="object"==typeof Reflect&&Reflect.apply||(P?Dr.bind(Nr):function(){return Dr.apply(Nr,arguments)}),Wr=F(F.bind),zr=function(t,e){return Nt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=et("document","documentElement"),Ur=F([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(rt),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Tr=O.location}catch(t){}var en=function(t){if(V(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Tr.protocol+"//"+Tr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=J(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Fr(e,void 0,r)},kr(Jr),Jr},Zr=function(t){delete tn[t]},ur?kr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?kr=function(t){$r.now(rn(t))}:Qr&&!Vr?(jr=(Ir=new Qr).port2,Ir.port1.onmessage=nn,kr=zr(jr.postMessage,jr)):O.addEventListener&&J(O.postMessage)&&!O.importScripts&&Tr&&"file:"!==Tr.protocol&&!j(on)?(kr=on,O.addEventListener("message",nn,!1)):kr="onreadystatechange"in Et("script")?function(t){Br.appendChild(Et("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(rt)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(rt),gn=je.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ur&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ur||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ur?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,vt("species")),Nn=!1,Dn=J(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:or("Promise",(function(){var t=ee(Mn),e=t!==String(Mn);if(!e&&66===ut)return!0;if(!ut||ut<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Nt(e),this.reject=Nt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=pe.getterFor("Promise"),Zn=pe.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!xt(t)||!J(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?jt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){jt(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ur?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ur||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){jt(Un,O,(function(){var e=t.facade;ur?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{jt(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){gr(this,Kn),Nt(t),jt(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=de(Kn,"then",(function(t,e){var r=qn(this),n=to(Rr(this,$n));return r.parent=!0,n.ok=!J(t)||t,n.fail=J(e)&&e,n.domain=ur?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},J(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||de(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){jt(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}fr&&fr(Yn,Kn)}ar({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),pr($n,"Promise",!1),dr("Promise");var po={},vo=vt("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=vt("iterator"),xo=function(t){if(!W(t))return Dt(t,mo)||Dt(t,"@@iterator")||po[xe(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Nt(r))return kt(jt(r,t));throw bo(Rt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;kt(t);try{if(!(n=Dt(t,"return"))){if("throw"===e)throw r;return r}n=jt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return kt(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(kt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Rt(t)+" is not iterable");if(go(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&Pt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=jt(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Pt(So,u))return u}return new Oo(!1)},ko=vt("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Nt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,jt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ar({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),J(Mn)){var Co=et("Promise").prototype.catch;Ro.catch!==Co&&de(Ro,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Nt(e.resolve);To(t,(function(t){jt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return jt(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;et("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(kt(t),xt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=Et("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==D(t)},gi=vt("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(Pr(e)&&(e===mi||yi(e.prototype))||xt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=F([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=G(s),d=Te(v),y=zr(c,f),g=We(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ie(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ut(e);n in t?qt.f(t,n,oe(0,r)):t[n]=r},ji=vt("species"),Pi=function(t){return ut>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=vt("species"),Li=Array,Ri=Math.max;ar({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ne(t,a),s=Ne(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(Pr(r)&&(r===Li||yi(r.prototype))||xt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=Kt.EXISTS,Ni=qt.f,Di=Function.prototype,Fi=F(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=F(Wi.exec);gt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ar({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return He(t,Ve)},Vi={f:gt&&!Ot?Object.defineProperties:function(t,e){kt(t);for(var r,n=ke(e),o=Hi(e),i=o.length,a=0;i>a;)qt.f(t,r=o[a++],n[r]);return t}},qi=ue("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=Et("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=Ve.length;r--;)delete Ki.prototype[Ve[r]];return Ki()};se[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=kt(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=qt.f,Ji=vt("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ue("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=G(t);if(V(e,aa))return e[aa];var r=e.constructor;return J(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=vt("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!xt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),J(ea[fa])||de(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=Kt.PROPER,ya=Kt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=vt("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:oe(+!n,r)}),pr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(fr?fr(u,ga):J(u[xa])||de(u,xa,ba)),pr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ie(p,"name","values"):(h=!0,d=function(){return jt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&de(p,c,s[c]);else ar({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&de(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=qt.f,Oa=pe.set,Sa=pe.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),gt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=qt.f,La=pe.enforce,Ra=pe.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=vt("toStringTag"),Ha=$("TYPED_ARRAY_TAG"),Va=_a&&!!fr&&"Opera"!==xe(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(xt(e)){var r=Ra(e);return r&&V(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!xt(t))return!1;var e=xe(t);return V(Za,e)||V(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!J(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&fr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&fr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&fr(Fa,za),gt&&!V(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return xt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ie(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if(J(t)&&(!fr||Pt(Wa,t)))return t;throw Ua(Rt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(gt){if(r)for(var o in Za){var i=O[o];if(i&&V(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||de(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(gt){if(fr){if(r)for(n in Za)if((o=O[n])&&V(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return de(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||de(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!xt(t))return!1;var e=xe(t);return"DataView"===e||V(Za,e)||V(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)de(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=G(this),r=We(e),n=arguments.length,o=Ne(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ne(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=We(t),o=Ne(e,n),i=Ne(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=Ze.f,mu=qt.f,xu=Kt.PROPER,bu=Kt.CONFIGURABLE,wu=pe.get,Eu=pe.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=F(pu),Mu=F([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ie(Au,"name","ArrayBuffer");else{(Ou=function(t){return gr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ie(Ou,Vu,Au[Vu]);Su.constructor=Ou}fr&&ca(ku)!==Iu&&fr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=F(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){gr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),gt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){gr(this,ku),gr(t,Su);var n=wu(t).byteLength,o=Le(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:Fe(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),gt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,gt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});pr(Ou,"ArrayBuffer"),pr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!xt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ju("The argument can't be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=F("".slice),ns=function(t){return"Big"===rs(xe(t),0,3)},os=TypeError,is=function(t){var e=Bt(t,"number");if("number"==typeof e)throw os("Can't convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=Mr(this),f=G(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=jt(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=We(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return fr&&J(n=e.constructor)&&n!==r&&xt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},cs=b((function(t){var e=Ze.f,r=Ei.forEach,n=pe.get,o=pe.set,i=pe.enforce,a=qt.f,u=je.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Pt(l,t)||"ArrayBuffer"==(e=xe(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Mt(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ut(e),E(t,e)?oe(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ut(e),!(E(t,e)&&xt(r)&&V(r,"value"))||V(r,"get")||V(r,"set")||r.configurable||V(r,"writable")&&!r.writable||V(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};gt?(p||(je.f=A,qt.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return gr(t,k),ss(xt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):jt(us,T,e):new S(ou(e)),t,T)})),fr&&fr(T,d),r(e(S),(function(t){t in T||ie(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){gr(t,k);var i,a,u,s=0,l=0;if(xt(e)){if(!w(e))return m(e)?x(T,e):jt(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ie(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ie(k,v,b);var P=T!=S;I[b]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ie(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ie(k,"BYTES_PER_ELEMENT",g),dr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Rt(e)+" of "+Rt(t))},hs=Math.min,ps=F([].copyWithin||function(t,e){var r=G(this),n=We(r),o=Ne(t,n),i=Ne(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ne(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=F("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(xe(this),0,3)?is(t):+t;return jt(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Rr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=Be.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=Be.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=vt("iterator"),Ds=O.Uint8Array,Fs=F(Ta.values),Ws=F(Ta.keys),zs=F(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=F([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Fr(Qs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Fr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Nt(r);var i=G(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return jt(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=G(t);if(bc)return jt(gc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=rt.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(rt),Lc=rt.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&F(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(ut)return ut<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Nt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ne(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ne(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Fr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=F([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===xe(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=kt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=pe.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=F("".charAt),mf=F("".indexOf),xf=F("".replace),bf=F("".slice),wf=(tf=/b*/g,jt(df,Jc=/a/,"a"),jt(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=jt(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=jt(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=jt(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&jt(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ar({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=vt("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=vt(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=F(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=F(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));de(String.prototype,t,s[0]),de(kf,o,s[1])}n&&ie(kf[o],"sham",!0)},jf=F("".charAt),Pf=F("".charCodeAt),_f=F("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(B(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=F("".charAt),Ff=F("".replace),Wf=F("".slice),zf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&'\`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=G(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"\`":return Wf(e,0,r);case"'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if(J(r)){var n=jt(r,t,e);return null!==n&&kt(n),n}if("RegExp"===D(t))return jt(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=vt("replace"),qf=Math.max,Zf=Math.min,Yf=F([].concat),$f=F([].push),Kf=F("".indexOf),Qf=F("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=B(this),o=W(t)?void 0:Dt(t,Vf);return o?jt(o,t,n,r):jt(e,rf(n),t,r)},function(t,o){var i=kt(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=J(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Le(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Fr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ar({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=gt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ar({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=G(this),c=We(s),f=Ne(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Le(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=F([].concat),pl=!fl||j((function(){if(gt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=G(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],gt&&!jt(a,s,u)||(r[u]=s[u]);return r}:fl;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ar({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=pe.set,ml=pe.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=Ze.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==D(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(ke(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!xt(t)&&((!El||"ArrayBuffer"!=D(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=qt.f,r=!1,n=$("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=F([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!xt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!V(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!V(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!V(t,n)&&i(t),t}};se[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=F(u[t]);de(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!xt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!J(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){gr(t,u);var r=ss(new a,t,s);return W(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=pe.set,Pl=pe.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=F([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(kt(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&V(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&V(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(xt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=pe.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(ne&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=F(Hl.delete),ql=F(Hl.has),Zl=F(Hl.get),Yl=F(Hl.set);ru(Hl,{delete:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(xt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=vt("iterator"),Kl=vt("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ie(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ie(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ie(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=B(this),n=W(e)?void 0:Dt(e,t);return n?jt(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=kt(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=vt("isConcatSpreadable"),Rh=ut>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!xt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ar({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=G(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=We(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=qt.f,zh=Tl.fastKey,Bh=pe.set,Uh=pe.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),gt||(t.size=0),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),gt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,gt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),gt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),gt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),dr(e)}});var Gh=F([].join),Hh=Te!=Object,Vh=Ai("join",",");ar({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(ke(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ar({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(G(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ar({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=F(1..valueOf),Np=F("".replace),Dp="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(B(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=Ze.f,Gp=je.f,Hp=qt.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=F("".slice),Kp=F("".charCodeAt),Qp=function(t){var e=Bt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Bt(t,"number");if(Mt(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(or("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Pt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=gt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)V(qp,Jp=ev[rv])&&!V(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,de(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=F((function(t){var e=rf(B(this)),r="",n=Le(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=F("".slice),cv=F(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=F("".replace);ar({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(B(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+xv(rf(r),mv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=Kt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&de(RegExp.prototype,"toString",(function(){var t=kt(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||V(t,"flags")||!Pt(bv,t)?e:jt(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});
`,Jl="l7-worker",ch=3,fh=!0;function hh(e){Zf(Jl,e)}function Hh(){var e=Uf(Jl);if(!e)throw new Error("get worker failed by workerName: ".concat(Jl,"."));return e}function Tl(e,i){return ec.apply(this,arguments)}function ec(){return ec=(0,Ct.Z)(Et().mark(function e(i,r){var n,t,o,u,c;return Et().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=Hh(),t=Hu.getWorkerFarm({maxConcurrency:ch,reuseWorkers:fh}),o=t.getWorkerPool({name:Jl,source:n}),v.next=5,o.startJob(Jl,function(x,S,w){return x.done(w)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:r}}),v.next=9,u.result;case 9:return c=v.sent,v.abrupt("return",c.result);case 11:case"end":return v.stop()}},e)})),ec.apply(this,arguments)}hh(pu);var Ic={BACK:1029,FRONT:1028};function kc(e){switch(e){case"GAODE1.x":return Ic.BACK;case"GAODE2.x":return Ic.BACK;case"MAPBOX":return Ic.FRONT;case"SIMPLE":return Ic.FRONT;case"GLOBEL":return Ic.BACK;case"L7MAP":return Ic.FRONT;default:return Ic.FRONT}}function Kd(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Qd(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),c=parseInt(r[1],10);c<=u;c++)i.push(e.replace(r[0],c.toString()));return i}return i.push(e),i}function ph(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=Qd(e),u=Math.abs(r+n)%o.length,c=o[u];return c.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}var Os;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(Os||(Os={}));var Eu;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Eu||(Eu={}));function Wh(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],c=[r,o],p=[t,o],v=[t,n];return Nn([[u,v,p,c,u]],i.properties,{bbox:e,id:i.id})}var uf=0,Yu=1,dh=2;function Jd(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function Ml(e){e.forEach(function(i){i.properties.state=uf}),e.forEach(function(i){i.isCurrent&&!Pc(i)&&Il(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&dh)})}function Vf(e){e.forEach(function(r){r.properties.state=uf}),e.forEach(function(r){r.isCurrent&&Pc(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&dh),r.children.length&&(r.isVisible||r.properties.state&Yu)?r.children.forEach(function(n){n.properties.state=Yu}):r.isCurrent&&Il(r)})}function Pc(e){for(;e;){if(e.isLoaded)return e.properties.state|=dh,!0;e=e.parent}return!1}function Il(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=dh:Il(i)})}var jf,ud=256,vh=[-Infinity,-Infinity,Infinity,Infinity],Pp=.2,Sa=5,Lc=(jf={},(0,Y.Z)(jf,Os.Realtime,Jd),(0,Y.Z)(jf,Os.Overlap,Ml),(0,Y.Z)(jf,Os.Replace,Vf),jf),Fo=function(){};function Vs(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function Lp(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var ld=function(i,r,n){var t=Lp(i,r,n),o=(0,mr.Z)(t,2),u=o[0],c=o[1],p=Lp(i+1,r+1,n),v=(0,mr.Z)(p,2),x=v[0],S=v[1];return[u,S,x,c]};function ev(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,c=e.zoomOffset,p=c===void 0?0:c,v=e.extent,x=v===void 0?vh:v,S=Math.ceil(i)+p;if(Number.isFinite(u)&&S<u)return[];Number.isFinite(t)&&S>t&&(S=t);for(var w=(0,mr.Z)(r,4),I=w[0],R=w[1],O=w[2],B=w[3],H=[Math.max(I,x[0]),Math.max(R,x[1]),Math.min(O,x[2]),Math.min(B,x[3])],ae=[],oe=Vs(H[0],H[1],S),Ie=(0,mr.Z)(oe,2),Oe=Ie[0],it=Ie[1],At=Vs(H[2],H[3],S),gt=(0,mr.Z)(At,2),$t=gt[0],gr=gt[1],dr=Oe;dr<=$t;dr++)for(var kr=gr;kr<=it;kr++)ae.push({x:dr,y:kr,z:S});var Sn=($t+Oe)/2,Vn=(it+gr)/2,Vi=function(mo,Co){return Math.abs(mo-Sn)+Math.abs(Co-Vn)};return ae.sort(function(Ba,mo){return Vi(Ba.x,Ba.y)-Vi(mo.x,mo.y)}),ae}var tv=function(i,r,n){var t=Math.pow(2,n),o=t-1,u=t,c=i,p=r;return c<0?c=c+u:c>o&&(c=c%u),{warpX:c,warpY:p}},Js=Q(26729),Gf=Q.n(Js);function rv(e){var i=nv();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function nv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mh=function(e){(0,sr.Z)(r,e);var i=rv(r);function r(n){var t;(0,vt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,Le.Z)(t),"tileSize",256),(0,Y.Z)((0,Le.Z)(t),"isVisible",!1),(0,Y.Z)((0,Le.Z)(t),"isCurrent",!1),(0,Y.Z)((0,Le.Z)(t),"isVisibleChange",!1),(0,Y.Z)((0,Le.Z)(t),"layerIDList",[]),(0,Y.Z)((0,Le.Z)(t),"loadedLayers",0),(0,Y.Z)((0,Le.Z)(t),"parent",null),(0,Y.Z)((0,Le.Z)(t),"children",[]),(0,Y.Z)((0,Le.Z)(t),"loadedChilds",0),(0,Y.Z)((0,Le.Z)(t),"data",null),(0,Y.Z)((0,Le.Z)(t),"properties",{}),(0,Y.Z)((0,Le.Z)(t),"loadDataId",0);var o=n.x,u=n.y,c=n.z,p=n.tileSize;return t.x=o,t.y=u,t.z=c,t.tileSize=p,t}return(0,xt.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===Eu.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Eu.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Eu.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Eu.Cancelled}},{key:"isDone",get:function(){return[Eu.Loaded,Eu.Cancelled,Eu.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return ld(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,mr.Z)(this.bounds,4),o=t[0],u=t[1],c=t[2],p=t[3],v=[(c-o)/2,(p-u)/2],x=Wh(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R,O,B,H,ae,oe,Ie,Oe,it;return Et().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:return c=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Eu.Loading,S=null,gt.prev=7,I=this.x,R=this.y,O=this.z,B=this.bounds,H=this.tileSize,ae=tv(I,R,O),oe=ae.warpX,Ie=ae.warpY,Oe=this.abortController.signal,it={x:oe,y:Ie,z:O,bounds:B,tileSize:H,signal:Oe},gt.next=14,c(it,this);case 14:S=gt.sent,gt.next=20;break;case 17:gt.prev=17,gt.t0=gt.catch(7),w=gt.t0;case 20:if(x===this.loadDataId){gt.next=22;break}return gt.abrupt("return");case 22:if(!(this.isCancelled&&!S)){gt.next=24;break}return gt.abrupt("return");case 24:if(!(w||!S)){gt.next=28;break}return this.loadStatus=Eu.Failure,v(w,this),gt.abrupt("return");case 28:this.loadStatus=Eu.Loaded,this.data=S,p(this);case 31:case"end":return gt.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Eu.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(Js.EventEmitter),cd=function(i,r){var n=Cl(i),t=fs(n,r),o=360*3-180,u=85.0511287798065,c=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return c},fd=function(i,r){var n=Cl(i),t=Cl(r),o=_c(n,t);return o};function $u(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Za(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function Za(e,i){if(!!e){if(typeof e=="string")return Xh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xh(e,i)}}function Xh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function tc(e){var i=Hf();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rp=function(e){(0,sr.Z)(r,e);var i=tc(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,Le.Z)(t),"currentTiles",[]),(0,Y.Z)((0,Le.Z)(t),"cacheTiles",new Map),(0,Y.Z)((0,Le.Z)(t),"throttleUpdate",(0,pt.throttle)(function(o,u){t.update(o,u)},16)),(0,Y.Z)((0,Le.Z)(t),"onTileLoad",function(o){t.emit("tile-loaded",o),t.updateTileVisible()}),(0,Y.Z)((0,Le.Z)(t),"onTileError",function(o,u){t.emit("tile-error",{error:o,tile:u}),t.updateTileVisible()}),(0,Y.Z)((0,Le.Z)(t),"onTileUnload",function(o){t.emit("tile-unload",o)}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:vh,getTileData:Fo,updateStrategy:Os.Replace},t.updateOptions(n),t}return(0,xt.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,U.Z)((0,U.Z)((0,U.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,c=Math.ceil(t);if(!(this.lastViewStates&&this.lastViewStates.zoom===c&&fd(this.lastViewStates.latLonBoundsBuffer,o))){var p=cd(o,Pp);this.lastViewStates={zoom:c,latLonBounds:o,latLonBoundsBuffer:p};var v=!1,x=this.getTileIndices(c,p);this.currentTiles=x.map(function(S){var w=S.x,I=S.y,R=S.z,O=u.getTile(w,I,R);if(O){var B,H,ae=((B=O)===null||B===void 0?void 0:B.isFailure)||((H=O)===null||H===void 0?void 0:H.isCancelled);return ae&&O.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),O}return O=u.createTile(w,I,R),v=!0,O}),v&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=$u(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,mr.Z)(o.value,2),c=u[0],p=u[1];this.currentTiles.includes(p)||(this.cacheTiles.delete(c),this.onTileUnload(p)),this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){t.e(v)}finally{t.f()}}},{key:"pruneRequests",value:function(){var t=[],o=$u(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;c.isLoading&&!c.isCurrent&&!c.isVisible&&t.push(c)}}catch(v){o.e(v)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var c=this.options.zoomOffset,p=Math.ceil(u)+c,v=Vs(t,o,p),x=this.tiles.filter(function(S){return S.key==="".concat(v[0],",").concat(v[1],",").concat(p)});return x[0]}},{key:"destroy",value:function(){var t=$u(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(c){t.e(c)}finally{t.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=$u(this.cacheTiles.values()),c;try{for(u.s();!(c=u.n()).done;){var p=c.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(R){u.e(R)}finally{u.f()}var v=$u(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.isCurrent=!0,S.isVisible=!0}}catch(R){v.e(R)}finally{v.f()}var w=Array.from(this.cacheTiles.values());typeof t=="function"?t(w):Lc[t](w);var I=!1;Array.from(this.cacheTiles.values()).forEach(function(R){R.isVisible!==o.get(R.key)?(R.isVisibleChange=!0,I=!0):R.isVisibleChange=!1}),I&&this.emit("tile-update")}},{key:"getTileIndices",value:function(t,o){var u=this.options,c=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),S=Math.ceil(this.options.minZoom),w=ev({maxZoom:x,minZoom:S,zoomOffset:v,tileSize:c,zoom:t,latLonBounds:o,extent:p});return w}},{key:"getTileId",value:function(t,o,u){var c="".concat(t,",").concat(o,",").concat(u);return c}},{key:"getTile",value:function(t,o,u){var c=this.getTileId(t,o,u),p=this.cacheTiles.get(c);return p}},{key:"createTile",value:function(t,o,u){var c=this.getTileId(t,o,u),p=new mh({x:t,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(c,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=Sa*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=$u(this.cacheTiles),c;try{for(u.s();!(c=u.n()).done;){var p=(0,mr.Z)(c.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=t)break}}catch(S){u.e(S)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var t=$u(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(S){t.e(S)}finally{t.f()}var c=$u(this.cacheTiles.values()),p;try{for(c.s();!(p=c.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(S){c.e(S)}finally{c.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var c=this.getTile(t,o,u);if(c)return c}return null}}]),r}(Gf()),hd;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(hd||(hd={}));function V(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,c=r;return u&&(c=Math.round(r*(o-1))/(o-1)),n?wr(e,i,c,n,t):wr(e,i,c,.314,t)}function Te(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function $e(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function tr(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=$e(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),c=o+r,p=[u*Math.cos(c)+e[0],u*Math.sin(c)+e[1]];return p}function wr(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),c=tr(o,u,n),p=[o[0],c[0],u[0]],v=[o[1],c[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(Te(p,r),Te(v,r))),[0])}else{var x=tr(e,i,n),S=[e[0],x[0],i[0]],w=[e[1],x[1],i[1]];return[Te(S,r),Te(w,r),0]}}function rr(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,c=r;return u&&(c=Math.round(r*29)/29),jr(e,i,c,t)}function br(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),c=t+o,p=[u*Math.cos(c)+e[0],u*Math.sin(c)+e[1]];return p}function Mr(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Nr(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function jr(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=br(t,o),c=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[Mr(c,r),Mr(p,r),0]}else{var v=Nr(t,o);if(Math.abs(v-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var x=Math.sin((1-r)*v)/Math.sin(v),S=Math.sin(r*v)/Math.sin(v),w=[Math.sin(t[0]),Math.sin(t[1])],I=[Math.cos(t[0]),Math.cos(t[1])],R=[Math.sin(o[0]),Math.sin(o[1])],O=[Math.cos(o[0]),Math.cos(o[1])],B=x*I[1]*I[0]+S*O[1]*O[0],H=x*I[1]*w[0]+S*O[1]*R[0],ae=x*w[1]+S*R[1];return[radiansToDegrees(Math.atan2(H,B)),radiansToDegrees(Math.atan2(ae,Math.sqrt(B*B+H*H)))]}}function qr(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],c=cn(o,u),p=r;r+=c,n.push({p1:o,p2:u,totalDistance:r,distance:c,lastTotalDistance:p})}for(var v=r*i,x,S,w=0;w<n.length;w++){var I=n[w].totalDistance;if(I>v){var R=n[w].p1,O=n[w].p2,B=(v-n[w].lastTotalDistance)/n[w].distance,H=Kr(O,R,B);x=H[0],S=H[1];break}}return{_lng:x,_lat:S,_height:0}}function Kr(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function cn(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Ur(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t._id;return o===r})),n.map(function(t){var o=Lt(t,i);return _objectSpread(_objectSpread({},t),o)})}function Yr(e,i){return new Promise(function(r){e.inited?r(Ur(e,i)):e.once("update",function(){r(Ur(e,i))})})}function Lt(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,c=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,r);var S=x[0],w=x[1],I;typeof t=="string"?I=e[t]||0:I=t;var R;switch(n){case"arc":R=arcLineAtOffset;break;case"greatcircle":R=greatCircleLineAtOffset;break;default:R=arcLineAtOffset}var O=R(S,w,r,I,o,c,v),B=_slicedToArray(O,3),H=B[0],ae=B[1],oe=B[2];return{_lng:H,_lat:ae,_height:oe}}function cr(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||Mu(e)?u([e]):Gr(e,function(c){u(c)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function Gr(e,i){var r=e,n=[];if(typeof r=="string")fa({url:r},function(u,c){c&&(n.push(c),i(n))});else{var t=r.length,o=0;r.forEach(function(u){fa({url:u},function(c,p){o++,p&&n.push(p),o===t&&i(n)})})}return cr}var un=Q(38929),Tr=Q(3614),Jr=Q.n(Tr),yn={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function ei(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var Er=function(){var e=(0,Ct.Z)(Et().mark(function i(r,n,t){var o;return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=ph(r,n),c.abrupt("return",new Promise(function(p){var v=rs({url:o},function(x,S){if(x||!S)p({layers:{}});else{for(var w=new un.VectorTile(new(Jr())(S)),I=0,R=Object.keys(w.layers);I<R.length;I++){for(var O=R[I],B=[],H=w.layers[O],ae=0;ae<w.layers[O].length;ae++){var oe=w.layers[O].feature(ae),Ie=oe.toGeoJSON(n.x,n.y,n.z);B.push(Ie)}H.features=B}p(w)}});t.xhrCancel=function(){return v.abort()}}));case 2:case"end":return c.stop()}},i)}));return function(r,n,t){return e.apply(this,arguments)}}();function Cr(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,c){return Er(r,u,c)},t=(0,U.Z)((0,U.Z)((0,U.Z)({},yn),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function Rn(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,c,p=e[i],v=e[i+1],x=e[r],S=e[r+1],w=i+3;w<r;w+=3){var I=hn(e[w],e[w+1],p,v,x,S);if(I>t)c=w,t=I;else if(I===t){var R=Math.abs(w-o);R<u&&(c=w,u=R)}}t>n&&(c-i>3&&Rn(e,i,c,n),e[c+2]=t,r-c>3&&Rn(e,c,r,n))}function hn(e,i,r,n,t,o){var u=t-r,c=o-n;if(u!==0||c!==0){var p=((e-r)*u+(i-n)*c)/(u*u+c*c);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=c*p)}return u=e-r,c=i-n,u*u+c*c}function Vr(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return vn(t),t}function vn(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")pn(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)pn(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)pn(e,i[n][t])}function pn(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function Mi(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)mi(r,e.features[n],i,n);else e.type==="Feature"?mi(r,e,i):mi(r,{geometry:e},i);return r}function mi(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),c=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")fn(t,c);else if(o==="MultiPoint")for(var v=0;v<t.length;v++)fn(t[v],c);else if(o==="LineString")xn(t,c,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(v=0;v<t.length;v++)c=[],xn(t[v],c,u,!1),e.push(Vr(p,"LineString",c,i.properties));return}else ci(t,c,u,!1);else if(o==="Polygon")ci(t,c,u,!0);else if(o==="MultiPolygon")for(v=0;v<t.length;v++){var x=[];ci(t[v],x,u,!0),c.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)mi(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Vr(p,o,c,i.properties))}}function fn(e,i){i.push(Ci(e[0])),i.push(ji(e[1])),i.push(0)}function xn(e,i,r,n){for(var t,o,u=0,c=0;c<e.length;c++){var p=Ci(e[c][0]),v=ji(e[c][1]);i.push(p),i.push(v),i.push(0),c>0&&(n?u+=(t*v-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(v-o,2))),t=p,o=v}var x=i.length-3;i[2]=1,Rn(i,0,x,r),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function ci(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];xn(e[t],o,r,n),i.push(o)}}function Ci(e){return e/360+.5}function ji(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Ma(e,i,r,n,t,o,u,c){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],S=x.geometry,w=x.type,I=t===0?x.minX:x.minY,R=t===0?x.maxX:x.maxY;if(I>=r&&R<n){p.push(x);continue}else if(R<r||I>=n)continue;var O=[];if(w==="Point"||w==="MultiPoint")bo(S,O,r,n,t);else if(w==="LineString")Zi(S,O,r,n,t,!1,c.lineMetrics);else if(w==="MultiLineString")ja(S,O,r,n,t,!1);else if(w==="Polygon")ja(S,O,r,n,t,!0);else if(w==="MultiPolygon")for(var B=0;B<S.length;B++){var H=[];ja(S[B],H,r,n,t,!0),H.length&&O.push(H)}if(O.length){if(c.lineMetrics&&w==="LineString"){for(B=0;B<O.length;B++)p.push(Vr(x.id,w,O[B],x.tags));continue}(w==="LineString"||w==="MultiLineString")&&(O.length===1?(w="LineString",O=O[0]):w="MultiLineString"),(w==="Point"||w==="MultiPoint")&&(w=O.length===3?"Point":"MultiPoint"),p.push(Vr(x.id,w,O,x.tags))}}return p.length?p:null}function bo(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Zi(e,i,r,n,t,o,u){for(var c=ns(e),p=t===0?Po:is,v=e.start,x,S,w=0;w<e.length-3;w+=3){var I=e[w],R=e[w+1],O=e[w+2],B=e[w+3],H=e[w+4],ae=t===0?I:R,oe=t===0?B:H,Ie=!1;u&&(x=Math.sqrt(Math.pow(I-B,2)+Math.pow(R-H,2))),ae<r?oe>r&&(S=p(c,I,R,B,H,r),u&&(c.start=v+x*S)):ae>n?oe<n&&(S=p(c,I,R,B,H,n),u&&(c.start=v+x*S)):Bo(c,I,R,O),oe<r&&ae>=r&&(S=p(c,I,R,B,H,r),Ie=!0),oe>n&&ae<=n&&(S=p(c,I,R,B,H,n),Ie=!0),!o&&Ie&&(u&&(c.end=v+x*S),i.push(c),c=ns(e)),u&&(v+=x)}var Oe=e.length-3;I=e[Oe],R=e[Oe+1],O=e[Oe+2],ae=t===0?I:R,ae>=r&&ae<=n&&Bo(c,I,R,O),Oe=c.length-3,o&&Oe>=3&&(c[Oe]!==c[0]||c[Oe+1]!==c[1])&&Bo(c,c[0],c[1],c[2]),c.length&&i.push(c)}function ns(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function ja(e,i,r,n,t,o){for(var u=0;u<e.length;u++)Zi(e[u],i,r,n,t,o,!1)}function Bo(e,i,r,n){e.push(i),e.push(r),e.push(n)}function Po(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function is(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function qo(e,i){var r=i.buffer/i.extent,n=e,t=Ma(e,1,-1-r,r,0,-1,2,i),o=Ma(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Ma(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=ps(t,1).concat(n)),o&&(n=n.concat(ps(o,-1)))),n}function ps(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=oo(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var c=0;c<t.geometry.length;c++)u.push(oo(t.geometry[c],i))}else if(o==="MultiPolygon")for(u=[],c=0;c<t.geometry.length;c++){for(var p=[],v=0;v<t.geometry[c].length;v++)p.push(oo(t.geometry[c][v],i));u.push(p)}r.push(Vr(t.id,o,u,t.tags))}return r}function oo(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function Ti(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,c;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(No(v[u],v[u+1],i,r,n,t));else for(u=0;u<v.length;u++){var S=[];for(c=0;c<v[u].length;c+=2)S.push(No(v[u][c],v[u][c+1],i,r,n,t));p.geometry.push(S)}}return e.transformed=!0,e}function No(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function sa(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},c=0;c<e.length;c++){u.numFeatures++,ds(u,e[c],o,t);var p=e[c].minX,v=e[c].minY,x=e[c].maxX,S=e[c].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),S>u.maxY&&(u.maxY=S)}return u}function ds(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var c=0;c<t.length;c+=3)u.push(t[c]),u.push(t[c+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")gi(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(c=0;c<t.length;c++)gi(u,t[c],e,r,o==="Polygon",c===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var v=t[p];for(c=0;c<v.length;c++)gi(u,v[c],e,r,!0,c===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var S in i.tags)x[S]=i.tags[S];x.mapbox_clip_start=t.start/t.size,x.mapbox_clip_end=t.end/t.size}var w={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(w.id=i.id),e.features.push(w)}}function gi(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var c=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,c.push(i[p]),c.push(i[p+1])),r.numPoints++;t&&Gi(c,o),e.push(c)}function Gi(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],c=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=c}}function ga(e,i){return new po(e,i)}function po(e,i){i=this.options=Ue(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Mi(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=qo(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}po.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},po.prototype.splitTile=function(e,i,r,n,t,o,u){for(var c=[e,i,r,n],p=this.options,v=p.debug;c.length;){n=c.pop(),r=c.pop(),i=c.pop(),e=c.pop();var x=1<<i,S=qu(i,r,n),w=this.tiles[S];if(!w&&(v>1&&console.time("creation"),w=this.tiles[S]=sa(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,w.numFeatures,w.numPoints,w.numSimplified),console.timeEnd("creation"));var I="z"+i;this.stats[I]=(this.stats[I]||0)+1,this.total++}if(w.source=e,t){if(i===p.maxZoom||i===t)continue;var R=1<<t-i;if(r!==Math.floor(o/R)||n!==Math.floor(u/R))continue}else if(i===p.indexMaxZoom||w.numPoints<=p.indexMaxPoints)continue;if(w.source=null,e.length!==0){v>1&&console.time("clipping");var O=.5*p.buffer/p.extent,B=.5-O,H=.5+O,ae=1+O,oe,Ie,Oe,it,At,gt;oe=Ie=Oe=it=null,At=Ma(e,x,r-O,r+H,0,w.minX,w.maxX,p),gt=Ma(e,x,r+B,r+ae,0,w.minX,w.maxX,p),e=null,At&&(oe=Ma(At,x,n-O,n+H,1,w.minY,w.maxY,p),Ie=Ma(At,x,n+B,n+ae,1,w.minY,w.maxY,p),At=null),gt&&(Oe=Ma(gt,x,n-O,n+H,1,w.minY,w.maxY,p),it=Ma(gt,x,n+B,n+ae,1,w.minY,w.maxY,p),gt=null),v>1&&console.timeEnd("clipping"),c.push(oe||[],i+1,r*2,n*2),c.push(Ie||[],i+1,r*2,n*2+1),c.push(Oe||[],i+1,r*2+1,n*2),c.push(it||[],i+1,r*2+1,n*2+1)}}},po.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var c=qu(e,i,r);if(this.tiles[c])return Ti(this.tiles[c],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,v=i,x=r,S;!S&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),S=this.tiles[qu(p,v,x)];return!S||!S.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(S.source,p,v,x,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[c]?Ti(this.tiles[c],t):null)};function qu(e,i,r){return((1<<e)*r+i)*32+e}function Ue(e,i){for(var r in i)e[r]=i[r];return e}var or={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Gt(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function Pn(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=Gt(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var Yi=["Unknown","Point","LineString","Polygon"];function De(e,i,r,n,t){var o=t.geometry,u=t.type,c=t.tags,p=t.id,v=e*Math.pow(2,n),x=e*i,S=e*r,w=Yi[u],I,R;function O(ae){for(var oe=0;oe<ae.length;oe++){var Ie=ae[oe];if(Ie[3])break;var Oe=180-(Ie[1]+S)*360/v,it=(Ie[0]+x)*360/v-180,At=360/Math.PI*Math.atan(Math.exp(Oe*Math.PI/180))-90;ae[oe]=[it,At,0,1]}}switch(u){case 1:var B=[];for(I=0;I<o.length;I++)B[I]=o[I][0];o=B,O(o);break;case 2:for(I=0;I<o.length;I++)O(o[I]);break;case 3:for(o=Pn(o),I=0;I<o.length;I++)for(R=0;R<o[I].length;R++)O(o[I][R]);break}o.length===1?o=o[0]:w="Multi"+w;var H={type:"Feature",geometry:{type:w,coordinates:o},properties:c,id:p,tileOrigin:[0,0],coord:""};return H}var ye=function(){var e=(0,Ct.Z)(Et().mark(function i(r,n,t,o){return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(p){var v=n.getTile(r.z,r.x,r.y),x=[];v.features.map(function(w){var I=De(o,t.x,t.y,t.z,w);x.push(I)});var S={layers:{geojsonvt:{features:x}}};p(S)}));case 1:case"end":return c.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function ot(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"||(e.geojsonvtOptions.maxZoom&&(i.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(i.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(i.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(i.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(i.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(i.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(i.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(i.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(i.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(i.debug=e.geojsonvtOptions.debug)),i}function Ot(e,i){var r=ot(i),n=r.extent||4096,t=ga(e,r),o=function(p,v){return ye(v,t,p,n)},u=(0,U.Z)((0,U.Z)((0,U.Z)({},or),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function Kt(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function ct(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(I){return I.rasterData}),u=n*t,c=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),S=Ye(x,o,v);if(typeof S=="number")c.push(S);else{var w=Me(x);c.push(w)}}return c}function Ye(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:Ye(n,i,r)}})}function St(e){var i=(0,mr.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var c=r.replace(/\s+/g,"");return[c,t,u]}function Me(e){var i=St(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=Me(e[1])),Array.isArray(t)&&(t=Me(e[2])),Kt(r,n,t)}function tt(e,i,r){return Be.apply(this,arguments)}function Be(){return Be=(0,Ct.Z)(Et().mark(function e(i,r,n){var t,o,u,c,p,v,x,S,w,I,R,O,B,H;return Et().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(i.length!==0){oe.next=2;break}return oe.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return oe.next=4,Promise.all(i.map(function(Ie){var Oe=Ie.data,it=Ie.bands,At=it===void 0?[0]:it;return r(Oe,At)}));case 4:t=oe.sent,t=t.flat(),o=t[0],u=o.width,c=o.height,v=void 0,x=void 0,S=void 0,oe.t0=(0,ke.Z)(n),oe.next=oe.t0==="function"?13:oe.t0==="object"?15:17;break;case 13:return p=n(t),oe.abrupt("break",18);case 15:return Array.isArray(n)?p=ct(n,t):(w=Dt(n,t),I=Ht(w),R=I.data,O=I.channelRMax,B=I.channelGMax,H=I.channelBMax,p=R,v=O,x=B,S=H),oe.abrupt("break",18);case 17:p=t[0].rasterData;case 18:return oe.abrupt("return",{rasterData:p,width:u,height:c,channelR:v,channelG:x,channelB:S});case 19:case"end":return oe.stop()}},e)})),Be.apply(this,arguments)}function Dt(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=ct(e.r||["band",0],i),n=ct(e.g||["band",0],i),t=ct(e.b||["band",0],i);return[r,n,t]}function Ht(e){for(var i=e[0],r=e[1],n=e[2],t=[],o=-Infinity,u=-Infinity,c=-Infinity,p=0;p<i.length;p++)t.push(i[p]),o=Math.max(o,i[p]),t.push(r[p]),u=Math.max(u,i[p]),t.push(n[p]),c=Math.max(c,i[p]);return{data:t,channelRMax:o,channelGMax:u,channelBMax:c}}function Ir(e,i,r,n){return on.apply(this,arguments)}function on(){return on=(0,Ct.Z)(Et().mark(function e(i,r,n,t){var o,u,c,p,v,x;return Et().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,tt(i,r,n);case 2:o=w.sent,u=o.rasterData,c=o.width,p=o.height,v=0,x=8e3,t(null,{data:u,width:c,height:p,min:v,max:x});case 9:case"end":return w.stop()}},e)})),on.apply(this,arguments)}function ln(e,i){return e.map(function(r){return r[i]*1})}function bn(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function nn(e){return Array.isArray(e)?e.length===0?!1:!!bn(e[0]):!1}function zn(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Tn(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,c=i.format,p=i.operation,v,x,S;if(c===void 0||zn(e))v=Array.from(e),x=n,S=t;else{var w=Array.isArray(e)?e:[e];v=tt(w,c,p)}var I={_id:1,dataArray:[{_id:1,data:v,width:x,height:S,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return I}function Bn(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,c=i.format,p=i.operation,v,x,S;if(c===void 0||zn(e))v=Array.from(e),x=n,S=t;else{var w=Array.isArray(e)?e:[e];v=tt(w,c,p)}var I={_id:1,dataArray:[{_id:1,data:v,width:x,height:S,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return I}var En;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb"})(En||(En={}));function Ln(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return ph(r,i)}):e.map(function(r){return{url:ph(r.url,i),bands:r.bands||[0]}}):ph(e,i)}function pi(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function Ca(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var vs=function(){var e=(0,Ct.Z)(Et().mark(function i(r,n,t,o,u){var c,p,v,x,S,w;return Et().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(c=pi(n.url),!(c.length>1)){R.next=15;break}return R.next=4,Ga(c,n);case 4:if(p=R.sent,v=p.rasterFiles,x=p.xhrList,S=p.errList,Ca(r,x),!(S.length>0)){R.next=12;break}return t(S,null),R.abrupt("return");case 12:Ir(v,o,u,t),R.next=17;break;case 15:w=rs(n,function(O,B){if(O)t(O);else if(B){var H=[{data:B,bands:c[0].bands}];Ir(H,o,u,t)}}),Ca(r,[w]);case 17:case"end":return R.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function Ga(e,i){return ha.apply(this,arguments)}function ha(){return ha=(0,Ct.Z)(Et().mark(function e(i,r){var n,t,o,u,c,p,v,x,S,w,I;return Et().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){O.next=20;break}return c=i[u],p=(0,U.Z)((0,U.Z)({},r),{},{url:c.url}),v=c.bands,O.next=10,$n((0,U.Z)((0,U.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=O.sent,S=x.err,w=x.data,I=x.xhr,S&&o.push(S),t.push(I),n.push({data:w,bands:v});case 17:u++,O.next=4;break;case 20:return O.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return O.stop()}},e)})),ha.apply(this,arguments)}var kl=function(){var e=(0,Ct.Z)(Et().mark(function i(r,n,t,o,u){var c;return Et().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return c={url:Ln(r,n)},v.abrupt("return",new Promise(function(x,S){vs(t,c,function(w,I){w?S(w):I&&x(I)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),Ds=function(){var e=(0,Ct.Z)(Et().mark(function i(r,n,t){var o;return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=ph(Array.isArray(r)?r[0]:r,n),c.abrupt("return",new Promise(function(p,v){var x=fa({url:o},function(S,w){S?v(S):w&&p(w)});t.xhrCancel=function(){return x.abort()}}));case 2:case"end":return c.stop()}},i)}));return function(r,n,t){return e.apply(this,arguments)}}(),ll=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Ru={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Op=[En.ARRAYBUFFER,En.RGB];function Ou(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Rc(e,i){if(Ou(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||En.IMAGE;r===En.RGB&&(r=En.ARRAYBUFFER);var n=function(u,c){switch(r){case En.IMAGE:return Ds(e,u,c);case En.ARRAYBUFFER:return kl(e,u,c,(i==null?void 0:i.format)||ll,i==null?void 0:i.operation);default:return Ds(e,u,c)}},t=(0,U.Z)((0,U.Z)((0,U.Z)({},Ru),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var gh={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Bv=function(){var e=(0,Ct.Z)(Et().mark(function i(r){return Et().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,mr.Z)(r.bounds,4),c=u[0],p=u[1],v=u[2],x=u[3],S={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,textLng:(c+v)/2,textLat:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[c,p],[c,p]]}}]}}};o(S)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function as(e,i){var r=function(o){return Bv(o)},n=(0,U.Z)((0,U.Z)((0,U.Z)({},gh),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var yh=Q(34155);function rc(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(c,p)}v((n=n.apply(e,i||[])).next())})}function Yh(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function _h(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(c){u={error:c}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function $h(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function Wf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nc={exports:{}},Dp={exports:{}},qh={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(qh,qh.exports);var Ku={},os={exports:{}},Oc={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(Oc,Oc.exports);var lf={};Object.defineProperty(lf,"__esModule",{value:!0}),lf.fallback=m,lf.wrap=_;var a=lf.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,s=lf.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,l=lf.hasNextTick=typeof yh=="object"&&typeof yh.nextTick=="function";function m(e){setTimeout(e,0)}function _(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var E;a?E=queueMicrotask:s?E=setImmediate:l?E=yh.nextTick:E=m,lf.default=_(E),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=Oc.exports,n=c(r),t=lf,o=c(t),u=Ku;function c(S){return S&&S.__esModule?S:{default:S}}function p(S){return(0,u.isAsync)(S)?function(){for(var w=[],I=arguments.length;I--;)w[I]=arguments[I];var R=w.pop(),O=S.apply(this,w);return v(O,R)}:(0,n.default)(function(w,I){var R;try{R=S.apply(this,w)}catch(O){return I(O)}if(R&&typeof R.then=="function")return v(R,I);I(null,R)})}function v(S,w){return S.then(function(I){x(w,null,I)},function(I){x(w,I&&I.message?I:new Error(I))})}function x(S,w,I){try{S(w,I)}catch(R){(0,o.default)(function(O){throw O},R)}}e.exports=i.default}(os,os.exports),Object.defineProperty(Ku,"__esModule",{value:!0}),Ku.isAsyncIterable=Ku.isAsyncGenerator=Ku.isAsync=void 0;var A=os.exports,P=F(A);function F(e){return e&&e.__esModule?e:{default:e}}function j(e){return e[Symbol.toStringTag]==="AsyncFunction"}function $(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function K(e){return typeof e[Symbol.asyncIterator]=="function"}function ue(e){if(typeof e!="function")throw new Error("expected a function");return j(e)?(0,P.default)(e):e}Ku.default=ue,Ku.isAsync=j,Ku.isAsyncGenerator=$,Ku.isAsyncIterable=K;var de={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,c=[],p=arguments.length;p--;)c[p]=arguments[p];return typeof c[t-1]=="function"?n.apply(this,c):new Promise(function(v,x){c[t-1]=function(S){for(var w=[],I=arguments.length-1;I-- >0;)w[I]=arguments[I+1];if(S)return x(S);v(w.length>1?w:w[0])},n.apply(u,c)})}return o}e.exports=i.default})(de,de.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=qh.exports,n=p(r),t=Ku,o=p(t),u=de.exports,c=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,c.default)(function(v,x,S){var w=(0,n.default)(x)?[]:{};v(x,function(I,R,O){(0,o.default)(I)(function(B){for(var H,ae=[],oe=arguments.length-1;oe-- >0;)ae[oe]=arguments[oe+1];ae.length<2&&(H=ae,ae=H[0]),w[R]=ae,O(B)})},function(I){return S(I,w)})},3),e.exports=i.default}(Dp,Dp.exports);var Ve={exports:{}},Ge={exports:{}},ut={exports:{}},Qe={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var c=n;n=null,c.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(Qe,Qe.exports);var Mt={exports:{}},jt={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(jt,jt.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=qh.exports,n=u(r),t=jt.exports,o=u(t);function u(S){return S&&S.__esModule?S:{default:S}}function c(S){var w=-1,I=S.length;return function(){return++w<I?{value:S[w],key:w}:null}}function p(S){var w=-1;return function(){var R=S.next();return R.done?null:(w++,{value:R.value,key:w})}}function v(S){var w=S?Object.keys(S):[],I=-1,R=w.length;return function O(){var B=w[++I];return B==="__proto__"?O():I<R?{value:S[B],key:B}:null}}function x(S){if((0,n.default)(S))return c(S);var w=(0,o.default)(S);return w?p(w):v(S)}e.exports=i.default}(Mt,Mt.exports);var ir={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(ir,ir.exports);var hr={exports:{}},Ar={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})(Ar,Ar.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=Ar.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,c,p,v){var x=!1,S=!1,w=!1,I=0,R=0;function O(){I>=c||w||x||(w=!0,u.next().then(function(ae){var oe=ae.value,Ie=ae.done;if(!(S||x)){if(w=!1,Ie){x=!0,I<=0&&v(null);return}I++,p(oe,R,B),R++,O()}}).catch(H))}function B(ae,oe){if(I-=1,!S){if(ae)return H(ae);if(ae===!1){x=!0,S=!0;return}if(oe===n.default||x&&I<=0)return x=!0,v(null);O()}}function H(ae){S||(w=!1,x=!0,v(ae))}O()}e.exports=i.default}(hr,hr.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=Qe.exports,n=I(r),t=Mt.exports,o=I(t),u=ir.exports,c=I(u),p=Ku,v=hr.exports,x=I(v),S=Ar.exports,w=I(S);function I(R){return R&&R.__esModule?R:{default:R}}i.default=function(R){return function(O,B,H){if(H=(0,n.default)(H),R<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!O)return H(null);if((0,p.isAsyncGenerator)(O))return(0,x.default)(O,R,B,H);if((0,p.isAsyncIterable)(O))return(0,x.default)(O[Symbol.asyncIterator](),R,B,H);var ae=(0,o.default)(O),oe=!1,Ie=!1,Oe=0,it=!1;function At($t,gr){if(!Ie)if(Oe-=1,$t)oe=!0,H($t);else if($t===!1)oe=!0,Ie=!0;else{if(gr===w.default||oe&&Oe<=0)return oe=!0,H(null);it||gt()}}function gt(){for(it=!0;Oe<R&&!oe;){var $t=ae();if($t===null){oe=!0,Oe<=0&&H(null);return}Oe+=1,B($t.value,$t.key,(0,c.default)(At))}it=!1}gt()}},e.exports=i.default}(ut,ut.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=ut.exports,n=p(r),t=Ku,o=p(t),u=de.exports,c=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,S,w,I){return(0,n.default)(S)(x,(0,o.default)(w),I)}i.default=(0,c.default)(v,4),e.exports=i.default}(Ge,Ge.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=Ge.exports,n=u(r),t=de.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function c(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(c,3),e.exports=i.default}(Ve,Ve.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=c;var r=Dp.exports,n=u(r),t=Ve.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function c(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(nc,nc.exports);var Wr=Wf(nc.exports),tn=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Wr(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,$h([],_h(n.args),!1)),t(null,i)})},e}(),qn={exports:{}},Mn={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=qh.exports,n=B(r),t=Ar.exports,o=B(t),u=Ge.exports,c=B(u),p=Qe.exports,v=B(p),x=ir.exports,S=B(x),w=Ku,I=B(w),R=de.exports,O=B(R);function B(Ie){return Ie&&Ie.__esModule?Ie:{default:Ie}}function H(Ie,Oe,it){it=(0,v.default)(it);var At=0,gt=0,$t=Ie.length,gr=!1;$t===0&&it(null);function dr(kr,Sn){kr===!1&&(gr=!0),gr!==!0&&(kr?it(kr):(++gt===$t||Sn===o.default)&&it(null))}for(;At<$t;At++)Oe(Ie[At],At,(0,S.default)(dr))}function ae(Ie,Oe,it){return(0,c.default)(Ie,Infinity,Oe,it)}function oe(Ie,Oe,it){var At=(0,n.default)(Ie)?H:ae;return At(Ie,(0,I.default)(Oe),it)}i.default=(0,O.default)(oe,3),e.exports=i.default})(Mn,Mn.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=c;var r=Mn.exports,n=u(r),t=Dp.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function c(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(qn,qn.exports);var ti=Wf(qn.exports),On=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ti(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return rc(n,void 0,void 0,function(){return Yh(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),Di={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=Qe.exports,n=x(r),t=ir.exports,o=x(t),u=Ku,c=x(u),p=de.exports,v=x(p);function x(w){return w&&w.__esModule?w:{default:w}}function S(w,I){if(I=(0,n.default)(I),!Array.isArray(w))return I(new Error("First argument to waterfall must be an array of functions"));if(!w.length)return I();var R=0;function O(H){var ae=(0,c.default)(w[R++]);ae.apply(void 0,H.concat([(0,o.default)(B)]))}function B(H){for(var ae=[],oe=arguments.length-1;oe-- >0;)ae[oe]=arguments[oe+1];if(H!==!1){if(H||R===w.length)return I.apply(void 0,[H].concat(ae));O(ae)}}O([])}i.default=(0,v.default)(S),e.exports=i.default})(Di,Di.exports);var _i=Wf(Di.exports),Wn=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return _i(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,$h([],_h(n),!1));t(o?null:!1,i)})},e}(),Ui=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Wr(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),Li=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Wr(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return rc(n,void 0,void 0,function(){return Yh(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,$h([],_h(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),pa=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Wr(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return rc(n,void 0,void 0,function(){var o;return Yh(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,$h([],_h(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),ii=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return _i(this.tasks)},e.prototype.tapPromise=function(i,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),ya=Q(69848),so=Q.n(ya);function Eo(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,c=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=So(x),e}var S=new(so())({radius:n,minZoom:c,maxZoom:o}),w={type:"FeatureCollection",features:[]};return w.features=e.dataArray.map(function(I){return{type:"Feature",geometry:{type:"Point",coordinates:I.coordinates},properties:(0,U.Z)({},I)}}),S.load(w.features),S}function So(e){return e.map(function(i,r){return(0,U.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function vo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Lo(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function ss(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function ms(e){if(e.length===0)throw new Error("mean requires at least one data point");return ss(e)/e.length}var eu={min:Lo,max:vo,mean:ms,sum:ss};function Ss(e){var i=tu();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zo(e,i){if(Array.isArray(i))return i}var Cs=function(e){(0,sr.Z)(r,e);var i=Ss(r);function r(n,t){var o;return(0,vt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,Le.Z)(o),"type","source"),(0,Y.Z)((0,Le.Z)(o),"inited",!1),(0,Y.Z)((0,Le.Z)(o),"hooks",{init:new tn}),(0,Y.Z)((0,Le.Z)(o),"parser",{type:"geojson"}),(0,Y.Z)((0,Le.Z)(o),"transforms",[]),(0,Y.Z)((0,Le.Z)(o),"cluster",!1),(0,Y.Z)((0,Le.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,Y.Z)((0,Le.Z)(o),"invalidExtent",!1),(0,Y.Z)((0,Le.Z)(o),"dataArrayChanged",!1),(0,Y.Z)((0,Le.Z)(o),"cfg",{}),o.originData=n,o.initCfg(t),o.init(),o}return(0,xt.Z)(r,[{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,c=u.method,p=c===void 0?"sum":c,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,x.forEach(function(S){S.id||(S.properties.point_count=1)}),(v||(0,pt.isFunction)(p))&&(x=x.map(function(S){var w=S.id;if(w){var I=o.clusterIndex.getLeaves(w,Infinity),R=I.map(function(H){return H.properties}),O;if((0,pt.isString)(p)&&v){var B=ln(R,v);O=eu[p](B)}(0,pt.isFunction)(p)&&(O=p(R)),S.properties.stat=O}else S.properties.point_count=1;return S})),this.data=ce("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,c=u===void 0?"geojson":u,p=o.geometry;if(c==="geojson"&&!this.cluster){var v=t<this.originData.features.length?this.originData.features[t]:"null",x=(0,pt.cloneDeep)(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var S=this.data.dataArray.find(function(w){return w._id===t});x.properties=S}return x}else return c==="json"&&p?this.data.dataArray.find(function(w){return w._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,U.Z)((0,U.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(c){return c[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"handleData",value:function(){var t=this;return new Promise(function(o,u){try{t.excuteParser(),t.initCluster(),t.executeTrans(),o({})}catch(c){u(c)}})}},{key:"initCfg",value:function(t){this.cfg=(0,pt.mergeWith)(this.cfg,t,zo);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,U.Z)((0,U.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var t=this;this.inited=!1,this.handleData().then(function(){t.inited=!0,t.emit("update")})}},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=ce(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=ku(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new Rp((0,U.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var c=u.type,p=me(c)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=Eo(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=fs(Cl(this.extent),t)),o[0].concat(o[1])}}]),r}(Js.EventEmitter);function ea(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Ua(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Fa(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function Fa(e,i){if(!!e){if(typeof e=="string")return ua(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ua(e,i)}}function ua(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var js=6378e3;function Gs(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*js)*(256<<20)/2,u=uo(r,t),c=u.gridHash,p=u.gridOffset,v=Dc(c,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function uo(e,i){var r=Infinity,n=-Infinity,t,o=Ua(e),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;t=c.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(oe){o.e(oe)}finally{o.f()}var p=(r+n)/2,v=Ko(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},S=Ua(e),w;try{for(S.s();!(w=S.n()).done;){var I=w.value,R=I.coordinates[1],O=I.coordinates[0];if(Number.isFinite(R)&&Number.isFinite(O)){var B=Math.floor((R+90)/v.yOffset),H=Math.floor((O+180)/v.xOffset),ae="".concat(B,"-").concat(H);x[ae]=x[ae]||{count:0,points:[]},x[ae].count+=1,x[ae].points.push(I)}}}catch(oe){S.e(oe)}finally{S.f()}return{gridHash:x,gridOffset:v}}function Ko(e,i){var r=Hs(e),n=_a(i,e);return{yOffset:r,xOffset:n}}function Hs(e){return e/js*(180/Math.PI)}function _a(e,i){return i/js*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Dc(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),c=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(r.field&&r.method){var x=Mf(e[t].points,r.field);v[r.method]=gu[r.method](x)}return Object.assign(v,{_id:o,coordinates:_o([-180+i.xOffset*(p+.5),-90+i.yOffset*(c+.5)]),rawData:e[t].points,count:e[t].count}),n.push(v),n},[])}var Ws=Math.PI/3,Fc=[0,Ws,2*Ws,3*Ws,4*Ws,5*Ws];function Zo(e){return e[0]}function Bc(e){return e[1]}function Pl(){var e=0,i=0,r=1,n=1,t=Zo,o=Bc,u,c,p;function v(S){var w={},I=[],R,O=S.length;for(R=0;R<O;++R)if(!(isNaN(H=+t.call(null,B=S[R],R,S))||isNaN(ae=+o.call(null,B,R,S)))){var B,H,ae,oe=Math.round(ae=ae/p),Ie=Math.round(H=H/c-(oe&1)/2),Oe=ae-oe;if(Math.abs(Oe)*3>1){var it=H-Ie,At=Ie+(H<Ie?-1:1)/2,gt=oe+(ae<oe?-1:1),$t=H-At,gr=ae-gt;it*it+Oe*Oe>$t*$t+gr*gr&&(Ie=At+(oe&1?1:-1)/2,oe=gt)}var dr=Ie+"-"+oe,kr=w[dr];kr?kr.push(B):(I.push(kr=w[dr]=[B]),kr.x=(Ie+(oe&1)/2)*c,kr.y=oe*p)}return I}function x(S){var w=0,I=0;return Fc.map(function(R){var O=Math.sin(R)*S,B=-Math.cos(R)*S,H=O-w,ae=B-I;return w=O,I=B,[H,ae]})}return v.hexagon=function(S){return"m"+x(S==null?u:+S).join("l")+"z"},v.centers=function(){for(var S=[],w=Math.round(i/p),I=Math.round(e/c),R=w*p;R<n+u;R+=p,++w)for(var O=I*c+(w&1)*c/2;O<r+c/2;O+=c)S.push([O,R]);return S},v.mesh=function(){var S=x(u).slice(0,4).join("l");return v.centers().map(function(w){return"M"+w+"m"+S}).join("")},v.x=function(S){return arguments.length?(t=S,v):t},v.y=function(S){return arguments.length?(o=S,v):o},v.radius=function(S){return arguments.length?(u=+S,c=u*2*Math.sin(Ws),p=u*1.5,v):u},v.size=function(S){return arguments.length?(e=i=0,r=+S[0],n=+S[1],v):[r-e,n-i]},v.extent=function(S){return arguments.length?(e=+S[0][0],i=+S[0][1],r=+S[1][0],n=+S[1][1],v):[[e,i],[r,n]]},v.radius(1)}var Kh=6378e3;function xh(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,c=t/(2*Math.PI*Kh)*(256<<20)/2,p=r.map(function(w){var I=_o(w.coordinates),R=(0,mr.Z)(I,2),O=R[0],B=R[1];return(0,U.Z)((0,U.Z)({},w),{},{coordinates:[O,B]})}),v=Pl().radius(c).x(function(w){return w.coordinates[0]}).y(function(w){return w.coordinates[1]}),x=v(p),S={dataArray:x.map(function(w,I){var R;if(i.field&&u){var O=Mf(w,i.field);w[u]=gu[u](O)}return R={},(0,Y.Z)(R,i.method,w[u]),(0,Y.Z)(R,"count",w.length),(0,Y.Z)(R,"rawData",w),(0,Y.Z)(R,"coordinates",[w.x,w.y]),(0,Y.Z)(R,"_id",I),R}),radius:c,xOffset:c,yOffset:c,type:"hexagon"};return S}function Qh(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var c=u[n];return(0,U.Z)((0,U.Z)({},u),o[c])}),e}function cf(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Xe("rasterTile",Rc),Xe("mvt",Cr),Xe("geojsonvt",Ot),Xe("testTile",as),Xe("geojson",In),Xe("image",cr),Xe("csv",ar),Xe("json",er),Xe("raster",Tn),Xe("rasterRgb",Bn),qe("cluster",Eo),qe("filter",ea),qe("join",Qh),qe("map",cf),qe("grid",Gs),qe("hexagon",xh);var Nc=Cs,iv=Q(28660),_n=Q(86700),Fp=Q(84879),Yt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},pd=Q(31745),ff=Q.n(pd);function Jh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ep(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function ep(e,i){if(!!e){if(typeof e=="string")return hf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hf(e,i)}}function hf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var zc=30;function dd(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,c=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,S=x===void 0?0:x,w=0,I=v;Array.from(i).forEach(function(O,B){if(!c[O]){var H=r(O,B);I+zc>o&&(I=0,w++),c[O]={x:I,y:S+w*zc,width:zc,height:zc,advance:H},I+=zc}});var R=n+t*2;return{mapping:c,xOffset:I,yOffset:S+w*R,canvasHeight:rp(S+(w+1)*R)}}function vd(e,i,r){var n=0,t=0,o=0,u=[],c={},p=Jh(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!c[x.id]){var S=x.size;n+S+i>r&&(tp(c,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+S+i,o=Math.max(o,S)}}}catch(I){p.e(I)}finally{p.f()}u.length>0&&tp(c,u,t);var w=rp(o+t+i);return{mapping:c,canvasHeight:w}}function tp(e,i,r){var n=Jh(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,c=o.xOffset;e[u.id]=(0,U.Z)((0,U.Z)({},u),{},{x:c,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function rp(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Bp,np;function ip(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Np(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function Np(e,i){if(!!e){if(typeof e=="string")return zp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zp(e,i)}}function zp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ap(e){var i=md();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function md(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var op=Uo(),Zp="sans-serif",bh="normal",Up=24,sp=3,av=.25,Nv=8,gd=1024,zv=1,yd=1,W0=3,_d=null;function Uo(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Ll(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Zv(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Xf=(Bp=(0,_n.b2)(),Bp(np=function(e){(0,sr.Z)(r,e);var i=ap(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"fontAtlas",void 0),(0,Y.Z)((0,Le.Z)(n),"iconFontMap",void 0),(0,Y.Z)((0,Le.Z)(n),"iconFontGlyphs",{}),(0,Y.Z)((0,Le.Z)(n),"fontOptions",void 0),(0,Y.Z)((0,Le.Z)(n),"key",void 0),(0,Y.Z)((0,Le.Z)(n),"cache",new G(W0)),n}return(0,xt.Z)(r,[{key:"scale",get:function(){return yd}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Zp,fontWeight:bh,characterSet:op,fontSize:Up,buffer:sp,sdf:!0,cutoff:av,radius:Nv,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,U.Z)((0,U.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var c=this.generateFontAtlas(this.key,o,u);this.fontAtlas=c,this.cache.set(this.key,c)}}},{key:"addFontFace",value:function(t,o){var u=this,c=document.createElement("style");c.type="text/css",c.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),c.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(c)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var c=this.fontOptions,p=c.fontFamily,v=c.fontWeight,x=c.fontSize,S=c.buffer,w=c.sdf,I=c.radius,R=c.cutoff,O=c.iconfont,B=u&&u.data;B||(B=ca.document.createElement("canvas"),B.width=gd);var H=B.getContext("2d");Ll(H,p,x,v);var ae=dd((0,U.Z)({getFontWidth:function(Vo){return H.measureText(Vo).width},fontHeight:x*yd,buffer:S,characterSet:o,maxCanvasWidth:gd},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),oe=ae.mapping,Ie=ae.canvasHeight,Oe=ae.xOffset,it=ae.yOffset,At=H.getImageData(0,0,B.width,B.height);if(B.height=Ie,H.putImageData(At,0,0),Ll(H,p,x,v),w){var gt=new(ff())(x,S,I,R,p,v),$t=H.getImageData(0,0,gt.size,gt.size),gr=ip(o),dr;try{for(gr.s();!(dr=gr.n()).done;){var kr=dr.value;if(O){var Sn=String.fromCharCode(parseInt(kr.replace("&#x","").replace(";",""),16)),Vn=gt.draw(Sn);Zv(Vn,$t)}else Zv(gt.draw(kr),$t);H.putImageData($t,oe[kr].x,oe[kr].y)}}catch(Co){gr.e(Co)}finally{gr.f()}}else{var Vi=ip(o),Ba;try{for(Vi.s();!(Ba=Vi.n()).done;){var mo=Ba.value;H.fillText(mo,oe[mo].x,oe[mo].y+x*zv)}}catch(Co){Vi.e(Co)}finally{Vi.f()}}return{xOffset:Oe,yOffset:it,mapping:oe,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){return"key";var t,o,u,c,p,v,x,S}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var c=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(S){v.has(S)||c.push(S)}),c}}]),r}(Js.EventEmitter))||np),xd,ov;function bd(e){var i=Zc();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ed=3,up=1024,Yf=64,Sd=(xd=(0,_n.b2)(),xd(ov=function(e){(0,sr.Z)(r,e);var i=bd(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"canvasHeight",128),(0,Y.Z)((0,Le.Z)(n),"texture",void 0),(0,Y.Z)((0,Le.Z)(n),"canvas",void 0),(0,Y.Z)((0,Le.Z)(n),"iconData",void 0),(0,Y.Z)((0,Le.Z)(n),"iconMap",void 0),(0,Y.Z)((0,Le.Z)(n),"ctx",void 0),(0,Y.Z)((0,Le.Z)(n),"loadingImageCount",0),n}return(0,xt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ca.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(t,o){var u=this,c=new Image;if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:Yf}),this.updateIconMap(),this.loadImage(o).then(function(p){c=p;var v=u.iconData.find(function(x){return x.id===t});v&&(v.image=c,v.width=c.width,v.height=c.height),u.update()})}},{key:"addImageMini",value:function(t,o,u){var c=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:Yf}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var S=c.iconData.find(function(w){return w.id===t});S&&(S.image=v,S.width=v.width,S.height=v.height),c.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var c=new Image;c.crossOrigin="anonymous",c.onload=function(){o(c)},c.onerror=function(){u(new Error("Could not load image at "+t))},c.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=up,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],c=u.x,p=u.y,v=u.image,x=u.width,S=x===void 0?64:x,w=u.height,I=w===void 0?64:w,R=Math.max(S,I),O=R/Yf,B=I/O,H=S/O;v&&t.ctx.drawImage(v,c+(Yf-H)/2,p+(Yf-B)/2,H,B)})}},{key:"updateIconMap",value:function(){var t=vd(this.iconData,Ed,up),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,c){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){c(new Error("Could not load image at "+t))},p.src=t})}}]),r}(Js.EventEmitter))||ov),Ya=Q(49685);function pf(){var e=new Ya.WT(16);return Ya.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Vp(e){var i=new Ya.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Uv(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function sv(e,i,r,n,t,o,u,c,p,v,x,S,w,I,R,O){var B=new Ya.WT(16);return B[0]=e,B[1]=i,B[2]=r,B[3]=n,B[4]=t,B[5]=o,B[6]=u,B[7]=c,B[8]=p,B[9]=v,B[10]=x,B[11]=S,B[12]=w,B[13]=I,B[14]=R,B[15]=O,B}function Vv(e,i,r,n,t,o,u,c,p,v,x,S,w,I,R,O,B){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=c,e[7]=p,e[8]=v,e[9]=x,e[10]=S,e[11]=w,e[12]=I,e[13]=R,e[14]=O,e[15]=B,e}function uv(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jv(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],c=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=c}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function du(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],c=i[5],p=i[6],v=i[7],x=i[8],S=i[9],w=i[10],I=i[11],R=i[12],O=i[13],B=i[14],H=i[15],ae=r*c-n*u,oe=r*p-t*u,Ie=r*v-o*u,Oe=n*p-t*c,it=n*v-o*c,At=t*v-o*p,gt=x*O-S*R,$t=x*B-w*R,gr=x*H-I*R,dr=S*B-w*O,kr=S*H-I*O,Sn=w*H-I*B,Vn=ae*Sn-oe*kr+Ie*dr+Oe*gr-it*$t+At*gt;return Vn?(Vn=1/Vn,e[0]=(c*Sn-p*kr+v*dr)*Vn,e[1]=(t*kr-n*Sn-o*dr)*Vn,e[2]=(O*At-B*it+H*Oe)*Vn,e[3]=(w*it-S*At-I*Oe)*Vn,e[4]=(p*gr-u*Sn-v*$t)*Vn,e[5]=(r*Sn-t*gr+o*$t)*Vn,e[6]=(B*Ie-R*At-H*oe)*Vn,e[7]=(x*At-w*Ie+I*oe)*Vn,e[8]=(u*kr-c*gr+v*gt)*Vn,e[9]=(n*gr-r*kr-o*gt)*Vn,e[10]=(R*it-O*Ie+H*ae)*Vn,e[11]=(S*Ie-x*it-I*ae)*Vn,e[12]=(c*$t-u*dr-p*gt)*Vn,e[13]=(r*dr-n*$t+t*gt)*Vn,e[14]=(O*oe-R*Oe-B*ae)*Vn,e[15]=(x*Oe-S*oe+w*ae)*Vn,e):null}function Cd(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],c=i[5],p=i[6],v=i[7],x=i[8],S=i[9],w=i[10],I=i[11],R=i[12],O=i[13],B=i[14],H=i[15];return e[0]=c*(w*H-I*B)-S*(p*H-v*B)+O*(p*I-v*w),e[1]=-(n*(w*H-I*B)-S*(t*H-o*B)+O*(t*I-o*w)),e[2]=n*(p*H-v*B)-c*(t*H-o*B)+O*(t*v-o*p),e[3]=-(n*(p*I-v*w)-c*(t*I-o*w)+S*(t*v-o*p)),e[4]=-(u*(w*H-I*B)-x*(p*H-v*B)+R*(p*I-v*w)),e[5]=r*(w*H-I*B)-x*(t*H-o*B)+R*(t*I-o*w),e[6]=-(r*(p*H-v*B)-u*(t*H-o*B)+R*(t*v-o*p)),e[7]=r*(p*I-v*w)-u*(t*I-o*w)+x*(t*v-o*p),e[8]=u*(S*H-I*O)-x*(c*H-v*O)+R*(c*I-v*S),e[9]=-(r*(S*H-I*O)-x*(n*H-o*O)+R*(n*I-o*S)),e[10]=r*(c*H-v*O)-u*(n*H-o*O)+R*(n*v-o*c),e[11]=-(r*(c*I-v*S)-u*(n*I-o*S)+x*(n*v-o*c)),e[12]=-(u*(S*B-w*O)-x*(c*B-p*O)+R*(c*w-p*S)),e[13]=r*(S*B-w*O)-x*(n*B-t*O)+R*(n*w-t*S),e[14]=-(r*(c*B-p*O)-u*(n*B-t*O)+R*(n*p-t*c)),e[15]=r*(c*w-p*S)-u*(n*w-t*S)+x*(n*p-t*c),e}function Gv(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],c=e[6],p=e[7],v=e[8],x=e[9],S=e[10],w=e[11],I=e[12],R=e[13],O=e[14],B=e[15],H=i*u-r*o,ae=i*c-n*o,oe=i*p-t*o,Ie=r*c-n*u,Oe=r*p-t*u,it=n*p-t*c,At=v*R-x*I,gt=v*O-S*I,$t=v*B-w*I,gr=x*O-S*R,dr=x*B-w*R,kr=S*B-w*O;return H*kr-ae*dr+oe*gr+Ie*$t-Oe*gt+it*At}function Xs(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],c=i[4],p=i[5],v=i[6],x=i[7],S=i[8],w=i[9],I=i[10],R=i[11],O=i[12],B=i[13],H=i[14],ae=i[15],oe=r[0],Ie=r[1],Oe=r[2],it=r[3];return e[0]=oe*n+Ie*c+Oe*S+it*O,e[1]=oe*t+Ie*p+Oe*w+it*B,e[2]=oe*o+Ie*v+Oe*I+it*H,e[3]=oe*u+Ie*x+Oe*R+it*ae,oe=r[4],Ie=r[5],Oe=r[6],it=r[7],e[4]=oe*n+Ie*c+Oe*S+it*O,e[5]=oe*t+Ie*p+Oe*w+it*B,e[6]=oe*o+Ie*v+Oe*I+it*H,e[7]=oe*u+Ie*x+Oe*R+it*ae,oe=r[8],Ie=r[9],Oe=r[10],it=r[11],e[8]=oe*n+Ie*c+Oe*S+it*O,e[9]=oe*t+Ie*p+Oe*w+it*B,e[10]=oe*o+Ie*v+Oe*I+it*H,e[11]=oe*u+Ie*x+Oe*R+it*ae,oe=r[12],Ie=r[13],Oe=r[14],it=r[15],e[12]=oe*n+Ie*c+Oe*S+it*O,e[13]=oe*t+Ie*p+Oe*w+it*B,e[14]=oe*o+Ie*v+Oe*I+it*H,e[15]=oe*u+Ie*x+Oe*R+it*ae,e}function jp(e,i,r){var n=r[0],t=r[1],o=r[2],u,c,p,v,x,S,w,I,R,O,B,H;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],c=i[1],p=i[2],v=i[3],x=i[4],S=i[5],w=i[6],I=i[7],R=i[8],O=i[9],B=i[10],H=i[11],e[0]=u,e[1]=c,e[2]=p,e[3]=v,e[4]=x,e[5]=S,e[6]=w,e[7]=I,e[8]=R,e[9]=O,e[10]=B,e[11]=H,e[12]=u*n+x*t+R*o+i[12],e[13]=c*n+S*t+O*o+i[13],e[14]=p*n+w*t+B*o+i[14],e[15]=v*n+I*t+H*o+i[15]),e}function lp(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Eh(e,i,r,n){var t=n[0],o=n[1],u=n[2],c=Math.hypot(t,o,u),p,v,x,S,w,I,R,O,B,H,ae,oe,Ie,Oe,it,At,gt,$t,gr,dr,kr,Sn,Vn,Vi;return c<Ya.Ib?null:(c=1/c,t*=c,o*=c,u*=c,p=Math.sin(r),v=Math.cos(r),x=1-v,S=i[0],w=i[1],I=i[2],R=i[3],O=i[4],B=i[5],H=i[6],ae=i[7],oe=i[8],Ie=i[9],Oe=i[10],it=i[11],At=t*t*x+v,gt=o*t*x+u*p,$t=u*t*x-o*p,gr=t*o*x-u*p,dr=o*o*x+v,kr=u*o*x+t*p,Sn=t*u*x+o*p,Vn=o*u*x-t*p,Vi=u*u*x+v,e[0]=S*At+O*gt+oe*$t,e[1]=w*At+B*gt+Ie*$t,e[2]=I*At+H*gt+Oe*$t,e[3]=R*At+ae*gt+it*$t,e[4]=S*gr+O*dr+oe*kr,e[5]=w*gr+B*dr+Ie*kr,e[6]=I*gr+H*dr+Oe*kr,e[7]=R*gr+ae*dr+it*kr,e[8]=S*Sn+O*Vn+oe*Vi,e[9]=w*Sn+B*Vn+Ie*Vi,e[10]=I*Sn+H*Vn+Oe*Vi,e[11]=R*Sn+ae*Vn+it*Vi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function df(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],c=i[6],p=i[7],v=i[8],x=i[9],S=i[10],w=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+v*n,e[5]=u*t+x*n,e[6]=c*t+S*n,e[7]=p*t+w*n,e[8]=v*t-o*n,e[9]=x*t-u*n,e[10]=S*t-c*n,e[11]=w*t-p*n,e}function $f(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],c=i[2],p=i[3],v=i[8],x=i[9],S=i[10],w=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-v*n,e[1]=u*t-x*n,e[2]=c*t-S*n,e[3]=p*t-w*n,e[8]=o*n+v*t,e[9]=u*n+x*t,e[10]=c*n+S*t,e[11]=p*n+w*t,e}function qf(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],c=i[2],p=i[3],v=i[4],x=i[5],S=i[6],w=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+v*n,e[1]=u*t+x*n,e[2]=c*t+S*n,e[3]=p*t+w*n,e[4]=v*t-o*n,e[5]=x*t-u*n,e[6]=S*t-c*n,e[7]=w*t-p*n,e}function Sh(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Hv(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Wv(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),c,p,v;return u<Ya.Ib?null:(u=1/u,n*=u,t*=u,o*=u,c=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=t*n*v+o*c,e[2]=o*n*v-t*c,e[3]=0,e[4]=n*t*v-o*c,e[5]=t*t*v+p,e[6]=o*t*v+n*c,e[7]=0,e[8]=n*o*v+t*c,e[9]=t*o*v-n*c,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Xv(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yv(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lv(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ad(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],c=n+n,p=t+t,v=o+o,x=n*c,S=n*p,w=n*v,I=t*p,R=t*v,O=o*v,B=u*c,H=u*p,ae=u*v;return e[0]=1-(I+O),e[1]=S+ae,e[2]=w-H,e[3]=0,e[4]=S-ae,e[5]=1-(x+O),e[6]=R+B,e[7]=0,e[8]=w+H,e[9]=R-B,e[10]=1-(x+I),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function vf(e,i){var r=new Ya.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],c=i[4],p=i[5],v=i[6],x=i[7],S=n*n+t*t+o*o+u*u;return S>0?(r[0]=(c*u+x*n+p*o-v*t)*2/S,r[1]=(p*u+x*t+v*n-c*o)*2/S,r[2]=(v*u+x*o+c*t-p*n)*2/S):(r[0]=(c*u+x*n+p*o-v*t)*2,r[1]=(p*u+x*t+v*n-c*o)*2,r[2]=(v*u+x*o+c*t-p*n)*2),Ad(e,i,r),e}function $v(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function wd(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],c=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,c),e[2]=Math.hypot(p,v,x),e}function cv(e,i){var r=new Ya.WT(3);wd(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,c=i[1]*t,p=i[2]*o,v=i[4]*n,x=i[5]*t,S=i[6]*o,w=i[8]*n,I=i[9]*t,R=i[10]*o,O=u+x+R,B=0;return O>0?(B=Math.sqrt(O+1)*2,e[3]=.25*B,e[0]=(S-I)/B,e[1]=(w-p)/B,e[2]=(c-v)/B):u>x&&u>R?(B=Math.sqrt(1+u-x-R)*2,e[3]=(S-I)/B,e[0]=.25*B,e[1]=(c+v)/B,e[2]=(w+p)/B):x>R?(B=Math.sqrt(1+x-u-R)*2,e[3]=(w-p)/B,e[0]=(c+v)/B,e[1]=.25*B,e[2]=(S+I)/B):(B=Math.sqrt(1+R-u-x)*2,e[3]=(c-v)/B,e[0]=(w+p)/B,e[1]=(S+I)/B,e[2]=.25*B),e}function qv(e,i,r,n){var t=i[0],o=i[1],u=i[2],c=i[3],p=t+t,v=o+o,x=u+u,S=t*p,w=t*v,I=t*x,R=o*v,O=o*x,B=u*x,H=c*p,ae=c*v,oe=c*x,Ie=n[0],Oe=n[1],it=n[2];return e[0]=(1-(R+B))*Ie,e[1]=(w+oe)*Ie,e[2]=(I-ae)*Ie,e[3]=0,e[4]=(w-oe)*Oe,e[5]=(1-(S+B))*Oe,e[6]=(O+H)*Oe,e[7]=0,e[8]=(I+ae)*it,e[9]=(O-H)*it,e[10]=(1-(S+R))*it,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fv(e,i,r,n,t){var o=i[0],u=i[1],c=i[2],p=i[3],v=o+o,x=u+u,S=c+c,w=o*v,I=o*x,R=o*S,O=u*x,B=u*S,H=c*S,ae=p*v,oe=p*x,Ie=p*S,Oe=n[0],it=n[1],At=n[2],gt=t[0],$t=t[1],gr=t[2],dr=(1-(O+H))*Oe,kr=(I+Ie)*Oe,Sn=(R-oe)*Oe,Vn=(I-Ie)*it,Vi=(1-(w+H))*it,Ba=(B+ae)*it,mo=(R+oe)*At,Co=(B-ae)*At,Vo=(1-(w+O))*At;return e[0]=dr,e[1]=kr,e[2]=Sn,e[3]=0,e[4]=Vn,e[5]=Vi,e[6]=Ba,e[7]=0,e[8]=mo,e[9]=Co,e[10]=Vo,e[11]=0,e[12]=r[0]+gt-(dr*gt+Vn*$t+mo*gr),e[13]=r[1]+$t-(kr*gt+Vi*$t+Co*gr),e[14]=r[2]+gr-(Sn*gt+Ba*$t+Vo*gr),e[15]=1,e}function Kv(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,c=n+n,p=t+t,v=r*u,x=n*u,S=n*c,w=t*u,I=t*c,R=t*p,O=o*u,B=o*c,H=o*p;return e[0]=1-S-R,e[1]=x+H,e[2]=w-B,e[3]=0,e[4]=x-H,e[5]=1-v-R,e[6]=I+O,e[7]=0,e[8]=w+B,e[9]=I-O,e[10]=1-v-S,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qv(e,i,r,n,t,o,u){var c=1/(r-i),p=1/(t-n),v=1/(o-u);return e[0]=o*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*c,e[9]=(t+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function Td(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var hv=Td;function Gp(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function Jv(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),c=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+c),v=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-c)*p*.5),e[9]=(t-o)*v*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Hp(e,i,r,n,t,o,u){var c=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+r)*c,e[13]=(t+n)*p,e[14]=(u+o)*v,e[15]=1,e}var X0=Hp;function e0(e,i,r,n,t,o,u){var c=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+r)*c,e[13]=(t+n)*p,e[14]=o*v,e[15]=1,e}function Y0(e,i,r,n){var t,o,u,c,p,v,x,S,w,I,R=i[0],O=i[1],B=i[2],H=n[0],ae=n[1],oe=n[2],Ie=r[0],Oe=r[1],it=r[2];return Math.abs(R-Ie)<Ya.Ib&&Math.abs(O-Oe)<Ya.Ib&&Math.abs(B-it)<Ya.Ib?uv(e):(x=R-Ie,S=O-Oe,w=B-it,I=1/Math.hypot(x,S,w),x*=I,S*=I,w*=I,t=ae*w-oe*S,o=oe*x-H*w,u=H*S-ae*x,I=Math.hypot(t,o,u),I?(I=1/I,t*=I,o*=I,u*=I):(t=0,o=0,u=0),c=S*u-w*o,p=w*t-x*u,v=x*o-S*t,I=Math.hypot(c,p,v),I?(I=1/I,c*=I,p*=I,v*=I):(c=0,p=0,v=0),e[0]=t,e[1]=c,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=S,e[7]=0,e[8]=u,e[9]=v,e[10]=w,e[11]=0,e[12]=-(t*R+o*O+u*B),e[13]=-(c*R+p*O+v*B),e[14]=-(x*R+S*O+w*B),e[15]=1,e)}function $0(e,i,r,n){var t=i[0],o=i[1],u=i[2],c=n[0],p=n[1],v=n[2],x=t-r[0],S=o-r[1],w=u-r[2],I=x*x+S*S+w*w;I>0&&(I=1/Math.sqrt(I),x*=I,S*=I,w*=I);var R=p*w-v*S,O=v*x-c*w,B=c*S-p*x;return I=R*R+O*O+B*B,I>0&&(I=1/Math.sqrt(I),R*=I,O*=I,B*=I),e[0]=R,e[1]=O,e[2]=B,e[3]=0,e[4]=S*B-w*O,e[5]=w*R-x*B,e[6]=x*O-S*R,e[7]=0,e[8]=x,e[9]=S,e[10]=w,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function q0(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function K0(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Q0(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function t0(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function J0(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function em(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Uc(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function cp(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],c=e[5],p=e[6],v=e[7],x=e[8],S=e[9],w=e[10],I=e[11],R=e[12],O=e[13],B=e[14],H=e[15],ae=i[0],oe=i[1],Ie=i[2],Oe=i[3],it=i[4],At=i[5],gt=i[6],$t=i[7],gr=i[8],dr=i[9],kr=i[10],Sn=i[11],Vn=i[12],Vi=i[13],Ba=i[14],mo=i[15];return Math.abs(r-ae)<=Ya.Ib*Math.max(1,Math.abs(r),Math.abs(ae))&&Math.abs(n-oe)<=Ya.Ib*Math.max(1,Math.abs(n),Math.abs(oe))&&Math.abs(t-Ie)<=Ya.Ib*Math.max(1,Math.abs(t),Math.abs(Ie))&&Math.abs(o-Oe)<=Ya.Ib*Math.max(1,Math.abs(o),Math.abs(Oe))&&Math.abs(u-it)<=Ya.Ib*Math.max(1,Math.abs(u),Math.abs(it))&&Math.abs(c-At)<=Ya.Ib*Math.max(1,Math.abs(c),Math.abs(At))&&Math.abs(p-gt)<=Ya.Ib*Math.max(1,Math.abs(p),Math.abs(gt))&&Math.abs(v-$t)<=Ya.Ib*Math.max(1,Math.abs(v),Math.abs($t))&&Math.abs(x-gr)<=Ya.Ib*Math.max(1,Math.abs(x),Math.abs(gr))&&Math.abs(S-dr)<=Ya.Ib*Math.max(1,Math.abs(S),Math.abs(dr))&&Math.abs(w-kr)<=Ya.Ib*Math.max(1,Math.abs(w),Math.abs(kr))&&Math.abs(I-Sn)<=Ya.Ib*Math.max(1,Math.abs(I),Math.abs(Sn))&&Math.abs(R-Vn)<=Ya.Ib*Math.max(1,Math.abs(R),Math.abs(Vn))&&Math.abs(O-Vi)<=Ya.Ib*Math.max(1,Math.abs(O),Math.abs(Vi))&&Math.abs(B-Ba)<=Ya.Ib*Math.max(1,Math.abs(B),Math.abs(Ba))&&Math.abs(H-mo)<=Ya.Ib*Math.max(1,Math.abs(H),Math.abs(mo))}var r0=Xs,Wp=t0,pv,rg,rE=(pv=(0,_n.b2)(),pv(rg=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"viewport",void 0),(0,Y.Z)(this,"overridedViewProjectionMatrix",void 0),(0,Y.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,Y.Z)(this,"jitteredProjectionMatrix",void 0),(0,Y.Z)(this,"viewMatrixInverse",void 0),(0,Y.Z)(this,"cameraPosition",void 0)}return(0,xt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=pf(),du(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,mr.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=Sh(pf(),[r,n,0]);this.jitteredProjectionMatrix=Xs(pf(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Xs(pf(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||rg),Ch;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom"})(Ch||(Ch={}));var ng,ig;function nE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=iE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function iE(e,i){if(!!e){if(typeof e=="string")return ag(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ag(e,i)}}function ag(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var aE={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},oE=(ng=(0,_n.b2)(),ng(ig=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"container",void 0),(0,Y.Z)(this,"controlCorners",void 0),(0,Y.Z)(this,"controlContainer",void 0),(0,Y.Z)(this,"scene",void 0),(0,Y.Z)(this,"mapsService",void 0),(0,Y.Z)(this,"controls",[]),(0,Y.Z)(this,"unAddControls",[])}return(0,xt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Yt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(Yt.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=nE(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=Ni("div",n+"control-container",this.container);function o(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=c.map(function(v){return n+v}).join(" ");r[c.filter(function(v){return!["row","column"].includes(v)}).join("")]=Ni("div",p,t)}function u(c){var p=c.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,N.Z)(p),[aE[c]])}Object.values(Ch).forEach(function(c){o(u(c))})}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ks(this.controlCorners[r]);this.controlContainer&&ks(this.controlContainer)}}]),e}())||ig),og,sg,sE=(og=(0,_n.b2)(),og(sg=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"container",void 0),(0,Y.Z)(this,"scene",void 0),(0,Y.Z)(this,"mapsService",void 0),(0,Y.Z)(this,"markers",[]),(0,Y.Z)(this,"markerLayers",[]),(0,Y.Z)(this,"unAddMarkers",[]),(0,Y.Z)(this,"unAddMarkerLayers",[])}return(0,xt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Yt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||sg),ug,lg,uE=(ug=(0,_n.b2)(),ug(lg=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"scene",void 0),(0,Y.Z)(this,"mapsService",void 0),(0,Y.Z)(this,"popups",[]),(0,Y.Z)(this,"unAddPopups",[])}return(0,xt.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,N.Z)(this.popups),(0,N.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Yt.IMapService)}}]),e}())||lg),lE={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},cE=lE,cg,fg,fE={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},hE={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},pE=(cg=(0,_n.b2)(),cg(fg=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"sceneConfigCache",{}),(0,Y.Z)(this,"layerConfigCache",{})}return(0,xt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return cE[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,U.Z)((0,U.Z)({},fE),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,U.Z)({},(0,pt.merge)({},this.sceneConfigCache[r],hE,t))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||fg);function va(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function da(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,c){return c(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function hg(){var e=new Ya.WT(4);return Ya.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function sL(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function dE(e,i,r,n){var t=new Ya.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function uL(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function lL(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function cL(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function fL(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function hL(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function pL(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function dL(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function vL(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function mL(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function gL(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function yL(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function vE(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function _L(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function xL(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function bL(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function EL(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function SL(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function CL(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function AL(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function wL(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function TL(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function ML(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],c=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],x=i[0],S=i[1],w=i[2],I=i[3];return e[0]=S*v-w*p+I*c,e[1]=-(x*v)+w*u-I*o,e[2]=x*p-S*u+I*t,e[3]=-(x*c)+S*o-w*t,e}function IL(e,i,r,n){var t=i[0],o=i[1],u=i[2],c=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=c+n*(r[3]-c),e}function kL(e,i){i=i||1;var r,n,t,o,u,c;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,c=t*t+o*o;while(c>=1);var p=Math.sqrt((1-u)/c);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function tm(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function PL(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],c=r[1],p=r[2],v=r[3],x=v*n+c*o-p*t,S=v*t+p*n-u*o,w=v*o+u*t-c*n,I=-u*n-c*t-p*o;return e[0]=x*v+I*-u+S*-p-w*-c,e[1]=S*v+I*-c+w*-u-x*-p,e[2]=w*v+I*-p+x*-c-S*-u,e[3]=i[3],e}function LL(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function RL(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function OL(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function DL(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],c=i[1],p=i[2],v=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var FL=null,BL=null,NL=null,zL=null,ZL=null,UL=null,VL=null,jL=function(){var e=hg();return function(i,r,n,t,o,u){var c,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,c=n;c<p;c+=r)e[0]=i[c],e[1]=i[c+1],e[2]=i[c+2],e[3]=i[c+3],o(e,e,u),i[c]=e[0],i[c+1]=e[1],i[c+2]=e[2],i[c+3]=e[3];return i}}(),rm=Math.PI/180,mE=512,pg=4003e4;function dg(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,c=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var x={},S=mE*o,w=Math.cos(r*rm),I=S/360,R=I/w,O=S/pg/w;if(x.pixelsPerMeter=[O,-O,O],x.metersPerPixel=[1/O,-1/O,1/O],x.pixelsPerDegree=[I,-R,O],x.degreesPerPixel=[1/I,-1/R,1/O],c){var B=rm*Math.tan(r*rm)/w,H=I*B/2,ae=S/pg*B,oe=ae/R*O;x.pixelsPerDegree2=[0,-H,ae],x.pixelsPerMeter2=[oe,0,oe],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var fp;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(fp||(fp={}));var Xp={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},vg,mg,gg,nm,yg,gE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],yE=(vg=(0,_n.b2)(),mg=(0,_n.f3)(Yt.ICameraService),vg(gg=(nm=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"needRefresh",!0),va(this,"cameraService",yg,this),(0,Y.Z)(this,"coordinateSystem",void 0),(0,Y.Z)(this,"viewportCenter",void 0),(0,Y.Z)(this,"viewportCenterProjection",void 0),(0,Y.Z)(this,"pixelsPerDegree",void 0),(0,Y.Z)(this,"pixelsPerDegree2",void 0),(0,Y.Z)(this,"pixelsPerMeter",void 0)}return(0,xt.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=dg({latitude:o[1],zoom:n}),c=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=c,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===fp.LNGLAT||this.coordinateSystem===fp.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===fp.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===fp.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=dg({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),c=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),S=this.cameraService.getProjectionMatrix(),w=Xs([],S,x),I=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=tm([],[I[0],I[1],0,1],w),x=this.cameraService.getViewMatrixUncentered()||x,w=Xs([],S,x),w=Xs([],w,gE),this.cameraService.setViewProjectionMatrix(w),this.pixelsPerMeter=c,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),yg=da(nm.prototype,"cameraService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm))||gg),_E=Q(20396),dv=Q.n(_E),Du;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Du||(Du={}));var _g,xg,bg,im,Eg;function xE(e){var i=bE();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function bE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EE={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},SE=(_g=(0,_n.b2)(),xg=(0,_n.f3)(Yt.IMapService),_g(bg=(im=function(e){(0,sr.Z)(r,e);var i=xE(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"indragging",!1),va((0,Le.Z)(n),"mapService",Eg,(0,Le.Z)(n)),(0,Y.Z)((0,Le.Z)(n),"hammertime",void 0),(0,Y.Z)((0,Le.Z)(n),"lastClickTime",0),(0,Y.Z)((0,Le.Z)(n),"lastClickXY",[-1,-1]),(0,Y.Z)((0,Le.Z)(n),"clickTimer",void 0),(0,Y.Z)((0,Le.Z)(n),"$containter",void 0),(0,Y.Z)((0,Le.Z)(n),"onDrag",function(c){var p=n.interactionEvent(c);p.type=EE[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Du.Drag,p)}),(0,Y.Z)((0,Le.Z)(n),"onHammer",function(c){c.srcEvent.stopPropagation();var p=n.interactionEvent(c);n.emit(Du.Hover,p)}),(0,Y.Z)((0,Le.Z)(n),"onTouch",function(c){var p=c.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,Y.Z)((0,Le.Z)(n),"onHover",function(c){var p=c.clientX,v=c.clientY,x=p,S=v,w=c.type,I=n.mapService.getMapContainer();if(I)if(ts)x=x-I.left-0,S=S-I.top-0;else{var R=I.getBoundingClientRect(),O=R.top,B=R.left;x=x-B-I.clientLeft,S=S-O-I.clientTop}var H=n.mapService.containerToLngLat([x,S]);if(w==="click"){if(!ts&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(x,S,H);return}if(w==="touch"){n.isDoubleTap(x,S,H);return}w!=="click"&&w!=="dblclick"&&n.emit(Du.Hover,{x,y:S,lngLat:H,type:w,target:c})}),n}return(0,xt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Du.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(Du.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(Du.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(Du.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(ts)ca.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(dv()).Manager(t);o.add(new(dv()).Tap({event:"dblclick",taps:2})),o.add(new(dv()).Tap({event:"click"})),o.add(new(dv()).Pan({threshold:0,pointers:0})),o.add(new(dv()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(ts)ca.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,c,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),c=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),c=Math.floor(t.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),S=x.top,w=x.left;c-=w,p-=S}var I=this.mapService.containerToLngLat([c,p]);return{x:c,y:p,lngLat:I,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var c=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(Du.Hover,{x:t,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){v="click",c.emit(Du.Hover,{x:t,y:o,lngLat:u,type:v})},400))}}]),r}(Gf()),Eg=da(im.prototype,"mapService",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im))||bg),CE=0;function AE(e){if(ts)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(CE++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function wE(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(t){if(t!=null&&t.classList){var o;t==null||(o=t.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var X;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(X||(X={}));var Sg,Cg,Ag,wg,Tg,Mg,Ig,Yp,kg,Pg,Lg,Rg,Og,TE=(Sg=(0,_n.b2)(),Cg=(0,_n.f3)(Yt.IMapService),Ag=(0,_n.f3)(Yt.IRendererService),wg=(0,_n.f3)(Yt.IGlobalConfigService),Tg=(0,_n.f3)(Yt.IInteractionService),Mg=(0,_n.f3)(Yt.ILayerService),Sg(Ig=(Yp=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,Y.Z)(this,"pickedColors",void 0),(0,Y.Z)(this,"pickedTileLayers",[]),va(this,"mapService",kg,this),va(this,"rendererService",Pg,this),va(this,"configService",Lg,this),va(this,"interactionService",Rg,this),va(this,"layerService",Og,this),(0,Y.Z)(this,"pickingFBO",void 0),(0,Y.Z)(this,"width",0),(0,Y.Z)(this,"height",0),(0,Y.Z)(this,"alreadyInPicking",!1),(0,Y.Z)(this,"pickBufferScale",1),(0,Y.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,c=n.type,p=n.target,v=!1,x=i.rendererService,S=x.readPixels,w=x.getContainer,I=i.getContainerSize(w()),R=I.width,O=I.height;R*=Oa,O*=Oa;var B=r.getLayerConfig(),H=B.enableHighlight,ae=B.enableSelect,oe=t*Oa,Ie=o*Oa;if(oe>R-1*Oa||oe<0||Ie>O-1*Oa||Ie<0)return!1;var Oe=S({x:Math.floor(oe/i.pickBufferScale),y:Math.floor((O-(o+1)*Oa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Oe,Oe[0]!==0||Oe[1]!==0||Oe[2]!==0){var it=Ze(Oe),At=r.getSource().getFeatureById(it);it!==r.getCurrentPickId()&&c==="mousemove"&&(c="mouseenter");var gt={x:t,y:o,type:c,lngLat:u,featureId:it,feature:At,target:p};At&&(v=!0,r.setCurrentPickId(it),i.triggerHoverOnLayer(r,gt))}else{var $t={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&c==="mousemove"?"mouseout":"un"+c,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,U.Z)((0,U.Z)({},$t),{},{type:"unpick"})),i.triggerHoverOnLayer(r,$t),r.setCurrentPickId(null)}if(H&&i.highlightPickedFeature(r,Oe),ae&&c==="click"&&(Oe==null?void 0:Oe.toString())!==[0,0,0,0].toString()){var gr=Ze(Oe);r.getCurrentSelectedId()===null||gr!==r.getCurrentSelectedId()?(i.selectFeature(r,Oe),r.setCurrentSelectedId(gr)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null)),r.isVector||i.layerService.getLayers().filter(function(dr){return dr.tileLayer}).map(function(dr){dr.tileLayer.clearPickState()})}return v})}return(0,xt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,c=this.getContainerSize(u()),p=c.width,v=c.height;p*=Oa,v*=Oa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.interactionService.on(Du.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Ct.Z)(Et().mark(function n(t,o,u){var c=this,p,v,x;return Et().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var I=c.pickBox(t,o);u(I)});case 3:case"end":return w.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(gr){var dr=gr<0?0:gr;return Math.floor(dr*Oa/t.pickBufferScale)}),u=(0,mr.Z)(o,4),c=u[0],p=u[1],v=u[2],x=u[3],S=this.rendererService,w=S.readPixels,I=S.getContainer,R=this.getContainerSize(I()),O=R.width,B=R.height;if(O*=Oa,B*=Oa,c>(O-1)*Oa/this.pickBufferScale||v<0||p>(B-1)*Oa/this.pickBufferScale||x<0)return[];for(var H=Math.min(O/this.pickBufferScale,v)-c,ae=Math.min(B/this.pickBufferScale,x)-p,oe=w({x:c,y:Math.floor(B/this.pickBufferScale-(x+1)),width:H,height:ae,data:new Uint8Array(H*ae*4),framebuffer:this.pickingFBO}),Ie=[],Oe={},it=0;it<oe.length/4;it=it+1){var At=oe.slice(it*4,it*4+4),gt=Ze(At);if(gt!==-1&&!Oe[gt]){var $t=r.getSource().getFeatureById(gt);Ie.push((0,U.Z)((0,U.Z)({},$t),{},{pickedFeatureIdx:gt})),Oe[gt]=!0}}return Ie}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,c=t.cursorEnabled;if(c){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Oa,height:r.height/Oa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Ct.Z)(Et().mark(function n(t){return Et().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.isPickingAllLayer()){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=Oa,o*=Oa,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,Ct.Z)(Et().mark(function n(t){var o=this,u,c,p;return Et().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,c=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),c(this.pickingFBO,function(){var S=o.layerService.getRenderList();S.filter(function(w){return w.needPick(t.type)}).reverse().some(function(w){if(p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedTileLayers.map(function(R){var O;return(O=R.tileLayer)===null||O===void 0?void 0:O.clearPick(t.type)}),w.tileLayer&&w.tileLayer.pickLayers)return w.tileLayer.pickLayers(t);w.hooks.beforePickingEncode.call(),w.masks.length>0&&w.masks.map(function(R){R.hooks.beforeRenderData.call(),R.hooks.beforeRender.call(),R.render(),R.hooks.afterRender.call()}),w.renderModels(!0),w.hooks.afterPickingEncode.call();var I=o.pickFromPickingFBO(w,t);return o.layerService.pickedLayerId=I?+w.id:-1,I&&!w.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){wE(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var t=(0,mr.Z)(n,3),o=t[0],u=t[1],c=t[2];r.hooks.beforeHighlight.call([o,u,c])}},{key:"selectFeature",value:function(r,n){var t=(0,mr.Z)(n,3),o=t[0],u=t[1],c=t[2];r.hooks.beforeSelect.call([o,u,c])}}]),e}(),kg=da(Yp.prototype,"mapService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=da(Yp.prototype,"rendererService",[Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg=da(Yp.prototype,"configService",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=da(Yp.prototype,"interactionService",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Og=da(Yp.prototype,"layerService",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp))||Ig),ME=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,vt.Z)(this,e),(0,Y.Z)(this,"autoStart",void 0),(0,Y.Z)(this,"startTime",0),(0,Y.Z)(this,"oldTime",0),(0,Y.Z)(this,"running",!1),(0,Y.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,xt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Dg,Fg,Bg,Ng,n0,zg,Zg;function IE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function kE(e,i){if(!!e){if(typeof e=="string")return Ug(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ug(e,i)}}function Ug(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function PE(e){var i=LE();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RE=(Dg=(0,_n.b2)(),Fg=(0,_n.f3)(Yt.IRendererService),Bg=(0,_n.f3)(Yt.IMapService),Dg(Ng=(n0=function(e){(0,sr.Z)(r,e);var i=PE(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"pickedLayerId",-1),(0,Y.Z)((0,Le.Z)(n),"clock",new ME),(0,Y.Z)((0,Le.Z)(n),"alreadyInRendering",!1),(0,Y.Z)((0,Le.Z)(n),"layers",[]),(0,Y.Z)((0,Le.Z)(n),"layerList",[]),(0,Y.Z)((0,Le.Z)(n),"layerRenderID",void 0),(0,Y.Z)((0,Le.Z)(n),"sceneInited",!1),(0,Y.Z)((0,Le.Z)(n),"animateInstanceCount",0),(0,Y.Z)((0,Le.Z)(n),"shaderPicking",!0),(0,Y.Z)((0,Le.Z)(n),"enableRender",!0),va((0,Le.Z)(n),"renderService",zg,(0,Le.Z)(n)),va((0,Le.Z)(n),"mapService",Zg,(0,Le.Z)(n)),(0,Y.Z)((0,Le.Z)(n),"reRender",(0,pt.throttle)(function(){n.updateLayerRenderList(),n.renderLayers()},32)),(0,Y.Z)((0,Le.Z)(n),"throttleRenderLayers",(0,pt.throttle)(function(){n.renderLayers()},16)),n}return(0,xt.Z)(r,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList(),this.emit("layerChange",this.layers)}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"cleanRemove",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=this.layers.indexOf(t);u>-1&&this.layers.splice(u,1),o&&this.throttleRenderLayers()}},{key:"remove",value:function(t,o){if(o){var u=o.layerChildren.indexOf(t);u>-1&&o.layerChildren.splice(u,1)}else{var c=this.layers.indexOf(t);c>-1&&this.layers.splice(c,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,Ct.Z)(Et().mark(function o(){var u,c,p;return Et().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){x.next=2;break}return x.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),u=IE(this.layerList),x.prev=5,u.s();case 7:if((c=u.n()).done){x.next=21;break}if(p=c.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),p.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(S){S.hooks.beforeRenderData.call(),S.hooks.beforeRender.call(),S.render(),S.hooks.afterRender.call()})),!p.getLayerConfig().enableMultiPassRenderer){x.next=17;break}return x.next=15,p.renderMultiPass();case 15:x.next=18;break;case 17:p.render();case 18:p.hooks.afterRender.call();case 19:x.next=7;break;case 21:x.next=26;break;case 23:x.prev=23,x.t0=x.catch(5),u.e(x.t0);case 26:return x.prev=26,u.f(),x.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return x.stop()}},o,this,[[5,23,26,29]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Re(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ca.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ca.cancelAnimationFrame(this.layerRenderID)}}]),r}(Js.EventEmitter),zg=da(n0.prototype,"renderService",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=da(n0.prototype,"mapService",[Bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n0))||Ng),hp=Q(81253),OE=function(){function e(i){var r=this;(0,vt.Z)(this,e),(0,Y.Z)(this,"name",void 0),(0,Y.Z)(this,"type",void 0),(0,Y.Z)(this,"scale",void 0),(0,Y.Z)(this,"descriptor",void 0),(0,Y.Z)(this,"featureBufferLayout",[]),(0,Y.Z)(this,"needRescale",!1),(0,Y.Z)(this,"needRemapping",!1),(0,Y.Z)(this,"needRegenerateVertices",!1),(0,Y.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,Y.Z)(this,"vertexAttribute",void 0),(0,Y.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var c,p=(c=r.scale)===null||c===void 0?void 0:c.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,xt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,N.Z)(r));if(!(0,pt.isNil)(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),DE=["modelType"],FE=["buffer","update","name"],BE=["buffer","update","name"],NE=["buffer","update","name"],vv,Vg,jg,Gg,am,Hg,zE=(vv={},(0,Y.Z)(vv,X.FLOAT,4),(0,Y.Z)(vv,X.UNSIGNED_BYTE,1),(0,Y.Z)(vv,X.UNSIGNED_SHORT,2),vv),ZE=(Vg=(0,_n.b2)(),jg=(0,_n.f3)(Yt.IRendererService),Vg(Gg=(am=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"attributesAndIndices",void 0),va(this,"rendererService",Hg,this),(0,Y.Z)(this,"attributes",[]),(0,Y.Z)(this,"triangulation",void 0),(0,Y.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,xt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new OE(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,U.Z)((0,U.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,c=this.attributes.find(function(Oe){return Oe.name===r});if(c&&c.descriptor){var p=c.descriptor,v=p.update,x=p.buffer,S=p.size,w=S===void 0?0:S,I=zE[x.type||X.FLOAT];if(v){var R=this.featureLayout,O=R.elements,B=R.sizePerElement,H=O.slice(t,o);if(!H.length)return;var ae=H[0].offset,oe=ae*w*I,Ie=H.map(function(Oe,it){for(var At=Oe.featureIdx,gt=Oe.vertices,$t=Oe.normals,gr=gt.length/B,dr=[],kr=0;kr<gr;kr++){var Sn=$t?$t.slice(kr*3,kr*3+3):[];dr.push.apply(dr,(0,N.Z)(v(n[At],At,gt.slice(kr*B,kr*B+B),it,Sn)))}return dr}).reduce(function(Oe,it){return Oe.push.apply(Oe,(0,N.Z)(it)),Oe},[]);c.vertexAttribute.updateBuffer({data:Ie,offset:oe}),u==null||u.emit("legend:".concat(r),{type:r,attr:c})}}}},{key:"createAttributesAndIndicesAscy",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(R){return R.resetDescriptor(),R.descriptor}).filter(function(R){return R}),c=t.modelType,p=(0,hp.Z)(t,DE),v=this.rendererService,x=v.createAttribute,S=v.createBuffer,w=v.createElements,I={};return new Promise(function(R,O){Tl(c,(0,U.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:r,segmentNumber:n},p)).then(function(B){B.descriptors.forEach(function(ae,oe){if(ae){var Ie=ae.buffer,Oe=ae.update,it=ae.name,At=(0,hp.Z)(ae,FE),gt=x((0,U.Z)({buffer:S(Ie)},At));I[ae.name||""]=gt,o.attributes[oe].vertexAttribute=gt}}),o.featureLayout=B.featureLayout;var H=w({data:B.indices,type:X.UNSIGNED_INT,count:B.indices.length});o.attributesAndIndices={attributes:I,elements:H,count:null},R(o.attributesAndIndices)}).catch(function(B){console.warn(B),O(B)})})}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(oe){return oe.resetDescriptor(),oe.descriptor}),c=0,p=0,v=[],x=[],S=[],w=3;r.forEach(function(oe,Ie){var Oe=o.triangulation(oe,t),it=Oe.indices,At=Oe.vertices,gt=Oe.normals,$t=Oe.size,gr=Oe.indexes,dr=Oe.count;typeof dr=="number"&&(p+=dr),it.forEach(function(Vi){x.push(Vi+c)}),w=$t;var kr=At.length/$t;o.featureLayout.sizePerElement=w,o.featureLayout.elements.push({featureIdx:Ie,vertices:At,normals:gt,offset:c}),c+=kr;for(var Sn=function(Ba){var mo=(gt==null?void 0:gt.slice(Ba*3,Ba*3+3))||[],Co=At.slice(Ba*$t,Ba*$t+$t),Vo=0;gr&&gr[Ba]!==void 0&&(Vo=gr[Ba]),u.forEach(function(Ju,xp){if(Ju&&Ju.update){var bp;(bp=Ju.buffer.data).push.apply(bp,(0,N.Z)(Ju.update(oe,Ie,Co,Ba,mo,Vo)))}})},Vn=0;Vn<kr;Vn++)Sn(Vn)});var I=this.rendererService,R=I.createAttribute,O=I.createBuffer,B=I.createElements,H={};u.forEach(function(oe,Ie){if(oe){var Oe=oe.buffer,it=oe.update,At=oe.name,gt=(0,hp.Z)(oe,BE),$t=R((0,U.Z)({buffer:O(Oe)},gt));H[oe.name||""]=$t,o.attributes[Ie].vertexAttribute=$t}});var ae=B({data:x,type:X.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:H,elements:ae,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(I){return I.resetDescriptor(),I.descriptor}),u=0,c=[],p=3;r.forEach(function(I,R){var O=t.triangulation(I),B=O.indices,H=O.vertices,ae=O.normals,oe=O.size,Ie=O.indexes;B.forEach(function(gt){c.push(gt+u)}),p=oe;var Oe=H.length/oe;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:R,vertices:H,normals:ae,offset:u}),u+=Oe;for(var it=function($t){var gr=(ae==null?void 0:ae.slice($t*3,$t*3+3))||[],dr=H.slice($t*oe,$t*oe+oe),kr=0;Ie&&Ie[$t]!==void 0&&(kr=Ie[$t]),o.forEach(function(Sn,Vn){if(Sn&&Sn.update){var Vi;(Vi=Sn.buffer.data).push.apply(Vi,(0,N.Z)(Sn.update(I,R,dr,$t,gr,kr)))}})},At=0;At<Oe;At++)it(At)});var v=this.rendererService,x=v.createAttribute,S=v.createBuffer,w={};return o.forEach(function(I,R){if(I){var O=I.buffer,B=I.update,H=I.name,ae=(0,hp.Z)(I,NE),oe=x((0,U.Z)({buffer:S(O)},ae));w[I.name||""]=oe,t.attributes[R].vertexAttribute=oe}}),{attributes:w}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(r){return r.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),Hg=da(am.prototype,"rendererService",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am))||Gg),Wg=Q(67709),UE=Q.n(Wg),Xg,Yg,$g,qg,Kg,Qg,Jg,ey,ty,ry,ny,iy,ay,oy,sy,uy,ly,Fu,cy,fy,hy,py,dy,vy,gy,yy,_y,xy,by,Ey,Sy,Cy,Ay;function VE(e){var i=jE();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GE=(Xg=(0,_n.b2)(),Yg=(0,_n.f3)(Yt.SceneID),$g=(0,_n.f3)(Yt.IIconService),qg=(0,_n.f3)(Yt.IFontService),Kg=(0,_n.f3)(Yt.IControlService),Qg=(0,_n.f3)(Yt.IGlobalConfigService),Jg=(0,_n.f3)(Yt.IMapService),ey=(0,_n.f3)(Yt.ICoordinateSystemService),ty=(0,_n.f3)(Yt.IRendererService),ry=(0,_n.f3)(Yt.ILayerService),ny=(0,_n.f3)(Yt.ICameraService),iy=(0,_n.f3)(Yt.IInteractionService),ay=(0,_n.f3)(Yt.IPickingService),oy=(0,_n.f3)(Yt.IShaderModuleService),sy=(0,_n.f3)(Yt.IMarkerService),uy=(0,_n.f3)(Yt.IPopupService),Xg(ly=(Fu=function(e){(0,sr.Z)(r,e);var i=VE(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,Y.Z)((0,Le.Z)(n),"destroyed",!1),(0,Y.Z)((0,Le.Z)(n),"loaded",!1),va((0,Le.Z)(n),"id",cy,(0,Le.Z)(n)),va((0,Le.Z)(n),"iconService",fy,(0,Le.Z)(n)),va((0,Le.Z)(n),"fontService",hy,(0,Le.Z)(n)),va((0,Le.Z)(n),"controlService",py,(0,Le.Z)(n)),va((0,Le.Z)(n),"configService",dy,(0,Le.Z)(n)),va((0,Le.Z)(n),"map",vy,(0,Le.Z)(n)),va((0,Le.Z)(n),"coordinateSystemService",gy,(0,Le.Z)(n)),va((0,Le.Z)(n),"rendererService",yy,(0,Le.Z)(n)),va((0,Le.Z)(n),"layerService",_y,(0,Le.Z)(n)),va((0,Le.Z)(n),"cameraService",xy,(0,Le.Z)(n)),va((0,Le.Z)(n),"interactionService",by,(0,Le.Z)(n)),va((0,Le.Z)(n),"pickingService",Ey,(0,Le.Z)(n)),va((0,Le.Z)(n),"shaderModuleService",Sy,(0,Le.Z)(n)),va((0,Le.Z)(n),"markerService",Cy,(0,Le.Z)(n)),va((0,Le.Z)(n),"popupService",Ay,(0,Le.Z)(n)),(0,Y.Z)((0,Le.Z)(n),"inited",!1),(0,Y.Z)((0,Le.Z)(n),"initPromise",void 0),(0,Y.Z)((0,Le.Z)(n),"rendering",!1),(0,Y.Z)((0,Le.Z)(n),"$container",void 0),(0,Y.Z)((0,Le.Z)(n),"canvas",void 0),(0,Y.Z)((0,Le.Z)(n),"markerContainer",void 0),(0,Y.Z)((0,Le.Z)(n),"hooks",void 0),(0,Y.Z)((0,Le.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Mo(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,Y.Z)((0,Le.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new Li},n}return(0,xt.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ct.Z)(Et().mark(function u(){return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Du.Drag,o.addSceneEvent.bind(o));case 9:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Ct.Z)(Et().mark(function u(){var c,p;return Et().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(c=o.map.getOverlayContainer(),c?o.$container=c:o.$container=AE(o.configService.getSceneConfig(o.id).id||""),!o.$container){x.next=12;break}return o.canvas=Ni("canvas","",o.$container),o.setCanvas(),x.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.initContainer(),UE()(o.$container,o.handleWindowResized),ca.matchMedia&&((p=ca.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(o.handleWindowResized)),x.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return x.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ct.Z)(Et().mark(function u(){return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Du.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Ct.Z)(Et().mark(function u(){var c;return Et().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(c=t.canvas,o.$container=c||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,Ct.Z)(Et().mark(function o(){return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(this.rendering||this.destroyed)){c.next=2;break}return c.abrupt("return");case 2:if(this.rendering=!0,this.inited){c.next=12;break}return c.next=6,this.initPromise;case 6:this.destroyed&&this.destroy(),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 12:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 15:case"end":return c.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var c=t==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return c}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=Ni("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Wg.unbind)(this.$container,this.handleWindowResized),ca.matchMedia){var c;(c=ca.matchMedia("screen and (min-resolution: 2dppx)"))===null||c===void 0||c.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var t,o,u=Oa,c=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=c*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*c,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=Oa,c=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=c*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(Js.EventEmitter),cy=da(Fu.prototype,"id",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fy=da(Fu.prototype,"iconService",[$g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hy=da(Fu.prototype,"fontService",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=da(Fu.prototype,"controlService",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=da(Fu.prototype,"configService",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vy=da(Fu.prototype,"map",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=da(Fu.prototype,"coordinateSystemService",[ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=da(Fu.prototype,"rendererService",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=da(Fu.prototype,"layerService",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=da(Fu.prototype,"cameraService",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),by=da(Fu.prototype,"interactionService",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ey=da(Fu.prototype,"pickingService",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sy=da(Fu.prototype,"shaderModuleService",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy=da(Fu.prototype,"markerService",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=da(Fu.prototype,"popupService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fu))||ly);function HE(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var WE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function wy(e){var i={};return e=e.replace(WE,function(r,n,t){var o=t.split(":"),u=o[0].trim(),c="";switch(o.length>1&&(c=o[1].trim()),n){case"bool":c=c==="true";break;case"float":case"int":c=Number(c);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":c?c=c.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):c=new Array(HE(n)).fill(0);break;default:}return i[u]=c,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var Ty,My,Iy="#define PI 3.14159265359",XE=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,YE=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,$E=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,qE=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,KE=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,QE=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,JE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,eS=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,tS=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,rS=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,nS=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,iS=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,aS=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,oS=/precision\s+(high|low|medium)p\s+float/,sS=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,uS=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,lS=(Ty=(0,_n.b2)(),Ty(My=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"moduleCache",{}),(0,Y.Z)(this,"rawContentCache",{})}return(0,xt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Iy,fs:Iy}),this.registerModule("decode",{vs:XE,fs:""}),this.registerModule("projection",{vs:JE,fs:""}),this.registerModule("project",{vs:QE,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:eS}),this.registerModule("lighting",{vs:$E,fs:""}),this.registerModule("light",{vs:YE,fs:""}),this.registerModule("picking",{vs:KE,fs:qE}),this.registerModule("styleMapping",{vs:tS,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:aS,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:rS,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:nS,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:iS,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var t=n.vs,o=n.fs,u=n.uniforms,c=wy(t),p=c.content,v=c.uniforms,x=wy(o),S=x.content,w=x.uniforms;this.rawContentCache[r]={fs:S,uniforms:(0,U.Z)((0,U.Z)((0,U.Z)({},v),w),u),vs:p}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.processModule(t,[],"vs"),c=u.content,p=u.includeList,v=this.processModule(o,[],"fs"),x=v.content,S=v.includeList,w=x,I=(0,pt.uniq)(p.concat(S).concat(r)).reduce(function(R,O){return(0,U.Z)((0,U.Z)({},R),n.rawContentCache[O].uniforms)},{});return oS.test(x)||(w=sS+x),this.moduleCache[r]={fs:w.trim(),uniforms:I,vs:c.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(uS,function(c,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var S=o.rawContentCache[x][t];n.push(x);var w=o.processModule(S,n,t),I=w.content;return I});return{content:u,includeList:n}}}]),e}())||My),Ha=Q(66213),pp;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(pp||(pp={}));var ky,Py,i0=(ky=(0,_n.b2)(),ky(Py=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"shaderModuleService",void 0),(0,Y.Z)(this,"rendererService",void 0),(0,Y.Z)(this,"cameraService",void 0),(0,Y.Z)(this,"mapService",void 0),(0,Y.Z)(this,"interactionService",void 0),(0,Y.Z)(this,"layerService",void 0),(0,Y.Z)(this,"config",void 0)}return(0,xt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return pp.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Yt.IRendererService),this.cameraService=r.getContainer().get(Yt.ICameraService),this.mapService=r.getContainer().get(Yt.IMapService),this.interactionService=r.getContainer().get(Yt.IInteractionService),this.layerService=r.getContainer().get(Yt.ILayerService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Py),Ly,Ry;function cS(e){var i=fS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=(Ly=(0,_n.b2)(),Ly(Ry=function(e){(0,sr.Z)(r,e);var i=cS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){(0,Ha.Z)((0,je.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(i0))||Ry),Oy,Dy,Fy,om,By;function pS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=dS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function dS(e,i){if(!!e){if(typeof e=="string")return Ny(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ny(e,i)}}function Ny(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var vS=(Oy=(0,_n.b2)(),Dy=(0,_n.f3)(Yt.IPostProcessor),Oy(Fy=(om=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"passes",[]),va(this,"postProcessor",By,this),(0,Y.Z)(this,"layer",void 0),(0,Y.Z)(this,"renderFlag",void 0),(0,Y.Z)(this,"width",0),(0,Y.Z)(this,"height",0)}return(0,xt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Ct.Z)(Et().mark(function n(){var t,o,u;return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=pS(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===pp.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),By=da(om.prototype,"postProcessor",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om))||Fy),zy,Zy;function mS(e){var i=gS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=(zy=(0,_n.b2)(),zy(Zy=function(e){(0,sr.Z)(r,e);var i=mS(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"pickingFBO",void 0),(0,Y.Z)((0,Le.Z)(n),"layer",void 0),(0,Y.Z)((0,Le.Z)(n),"width",0),(0,Y.Z)((0,Le.Z)(n),"height",0),(0,Y.Z)((0,Le.Z)(n),"alreadyInRendering",!1),(0,Y.Z)((0,Le.Z)(n),"pickFromPickingFBO",function(c){var p=c.x,v=c.y,x=c.lngLat,S=c.type;if(!(!n.layer.isVisible()||!n.layer.needPick(S))){var w=n.rendererService,I=w.getViewportSize,R=w.readPixels,O=w.useFramebuffer,B=I(),H=B.width,ae=B.height,oe=n.layer.getLayerConfig(),Ie=oe.enableHighlight,Oe=oe.enableSelect,it=p*Oa,At=v*Oa;if(!(it>H||it<0||At>ae||At<0)){var gt;O(n.pickingFBO,function(){var $t;if(gt=R({x:Math.round(it),y:Math.round(ae-(v+1)*Oa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),gt[0]!==0||gt[1]!==0||gt[2]!==0){var gr=Ze(gt),dr=n.layer.getSource().getFeatureById(gr),kr={x:p,y:v,type:S,lngLat:x,featureId:gr,feature:dr};dr&&(n.layer.setCurrentPickId(gr),n.triggerHoverOnLayer(kr))}else{var Sn={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+S:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,U.Z)((0,U.Z)({},Sn),{},{type:"unpick"})),n.triggerHoverOnLayer(Sn),n.layer.setCurrentPickId(null)}Ie&&n.highlightPickedFeature(gt),Oe&&S==="click"&&(($t=gt)===null||$t===void 0?void 0:$t.toString())!==[0,0,0,0].toString()&&n.selectFeature(gt)})}}}),n}return(0,xt.Z)(r,[{key:"getType",value:function(){return pp.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){(0,Ha.Z)((0,je.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,c=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),S=x.width,w=x.height;this.pickingFBO=p({color:c({width:S,height:w,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.interactionService.on(Du.Hover,this.pickFromPickingFBO),this.interactionService.on(Du.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Du.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,c=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=c(),S=x.width,w=x.height;this.alreadyInRendering=!0,(this.width!==S||this.height!==w)&&(this.pickingFBO.resize({width:S,height:w}),this.width=S,this.height=w),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var I=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(I),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,mr.Z)(t,3),u=o[0],c=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,c,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,mr.Z)(t,3),u=o[0],c=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,c,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=nt(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=nt(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(i0))||Zy),Uy,Vy,jy,sm,Gy,_S=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ah=(Uy=(0,_n.b2)(),Vy=(0,_n.f3)(Yt.IShaderModuleService),Uy(jy=(sm=function(){function e(){(0,vt.Z)(this,e),va(this,"shaderModuleService",Gy,this),(0,Y.Z)(this,"rendererService",void 0),(0,Y.Z)(this,"config",void 0),(0,Y.Z)(this,"quad",_S),(0,Y.Z)(this,"enabled",!0),(0,Y.Z)(this,"renderToScreen",!1),(0,Y.Z)(this,"model",void 0),(0,Y.Z)(this,"name",void 0),(0,Y.Z)(this,"optionsToUpdate",{})}return(0,xt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return pp.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Yt.IRendererService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,c=t.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,S=p.uniforms;this.model=c({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:(0,U.Z)((0,U.Z)({u_Texture:null},S),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,c=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),S=x.width,w=x.height;c(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var I=(0,U.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[S,w]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(I.u_BloomFinal=1,I.u_Texture2=n),t.model.draw({uniforms:I})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,U.Z)((0,U.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){(0,pt.isNil)(r[t])||(n["u_".concat((0,pt.upperFirst)((0,pt.camelCase)(t)))]=r[t])}),n}}]),e}(),Gy=da(sm.prototype,"shaderModuleService",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm))||jy),Hy,Wy;function xS(e){var i=bS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function bS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ES=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,SS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,CS=(Hy=(0,_n.b2)(),Hy(Wy=function(e){(0,sr.Z)(r,e);var i=xS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:SS,fs:ES});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},c),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,pt.isNil)(t.bloomRadius)||(o.u_radius=t.bloomRadius),(0,pt.isNil)(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),(0,pt.isNil)(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(Ah))||Wy),Xy,Yy;function AS(e){var i=wS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function wS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,MS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,IS=(Xy=(0,_n.b2)(),Xy(Yy=function(e){(0,sr.Z)(r,e);var i=AS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:MS,fs:TS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},c),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,pt.isNil)(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(Ah))||Yy),$y,qy;function kS(e){var i=PS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function PS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,RS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,OS=($y=(0,_n.b2)(),$y(qy=function(e){(0,sr.Z)(r,e);var i=kS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:RS,fs:LS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},c),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,pt.isNil)(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(Ah))||qy),Ky,Qy;function DS(e){var i=FS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,NS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zS=(Ky=(0,_n.b2)(),Ky(Qy=function(e){(0,sr.Z)(r,e);var i=DS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:NS,fs:BS});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},c),{},{u_ViewportSize:[v,x]})}}}]),r}(Ah))||Qy),Jy,e_;function ZS(e){var i=US();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,jS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,GS=(Jy=(0,_n.b2)(),Jy(e_=function(e){(0,sr.Z)(r,e);var i=ZS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:jS,fs:VS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Ah))||e_),t_,r_;function HS(e){var i=WS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,YS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$S=(t_=(0,_n.b2)(),t_(r_=function(e){(0,sr.Z)(r,e);var i=HS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:YS,fs:XS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},c),{},{u_ViewportSize:[v,x]})}}}]),r}(Ah))||r_),n_,i_;function qS(e){var i=KS();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,JS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,eC=(n_=(0,_n.b2)(),n_(i_=function(e){(0,sr.Z)(r,e);var i=qS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:JS,fs:QS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},c),{},{u_ViewportSize:[v,x]})}}}]),r}(Ah))||i_),a_,o_;function tC(e){var i=rC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,iC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,aC=(a_=(0,_n.b2)(),a_(o_=function(e){(0,sr.Z)(r,e);var i=tC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:iC,fs:nC}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Ah))||o_),s_,u_;function oC(e){var i=sC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function sC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,cC=(s_=(0,_n.b2)(),s_(u_=function(e){(0,sr.Z)(r,e);var i=oC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:uC,fs:lC}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Ah))||u_),l_,c_,f_,h_,Md,p_,fC=(l_=(0,_n.b2)(),c_=(0,_n.f3)(Yt.IRendererService),f_=(0,_n.zY)(),l_(h_=(Md=function(){function e(){(0,vt.Z)(this,e),va(this,"rendererService",p_,this),(0,Y.Z)(this,"passes",[]),(0,Y.Z)(this,"readFBO",void 0),(0,Y.Z)(this,"writeFBO",void 0)}return(0,xt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,c=o.height;return t({x:0,y:0,width:u,height:c,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,Ct.Z)(Et().mark(function o(){return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return c.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Ct.Z)(Et().mark(function n(t,o){var u,c;return Et().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,c=0;case 4:if(!(c<4)){v.next=11;break}return v.next=7,o.render(t,u);case 7:this.swap(),c++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Ct.Z)(Et().mark(function n(t){var o,u;return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),p_=da(Md.prototype,"rendererService",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),da(Md.prototype,"init",[f_],Object.getOwnPropertyDescriptor(Md.prototype,"init"),Md.prototype),Md))||h_),d_,v_;function hC(e){var i=pC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function pC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dC=(d_=(0,_n.b2)(),d_(v_=function(e){(0,sr.Z)(r,e);var i=hC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getType",value:function(){return pp.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){(0,Ha.Z)((0,je.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,c=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(v){v.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(i0))||v_),m_,g_,y_,um,__;function vC(e){var i=mC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gC=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,x_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,yC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function b_(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var _C=1,xC=(m_=(0,_n.b2)(),g_=(0,_n.f3)(Yt.IShaderModuleService),m_(y_=(um=function(e){(0,sr.Z)(r,e);var i=vC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),va((0,Le.Z)(n),"shaderModuleService",__,(0,Le.Z)(n)),(0,Y.Z)((0,Le.Z)(n),"haltonSequence",[]),(0,Y.Z)((0,Le.Z)(n),"accumulatingId",0),(0,Y.Z)((0,Le.Z)(n),"frame",0),(0,Y.Z)((0,Le.Z)(n),"timer",void 0),(0,Y.Z)((0,Le.Z)(n),"sampleRenderTarget",void 0),(0,Y.Z)((0,Le.Z)(n),"prevRenderTarget",void 0),(0,Y.Z)((0,Le.Z)(n),"outputRenderTarget",void 0),(0,Y.Z)((0,Le.Z)(n),"copyRenderTarget",void 0),(0,Y.Z)((0,Le.Z)(n),"blendModel",void 0),(0,Y.Z)((0,Le.Z)(n),"outputModel",void 0),(0,Y.Z)((0,Le.Z)(n),"copyModel",void 0),n}return(0,xt.Z)(r,[{key:"getType",value:function(){return pp.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){(0,Ha.Z)((0,je.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,c=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=c({color:p({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.prevRenderTarget=c({color:p({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.outputRenderTarget=c({color:p({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.copyRenderTarget=c({color:p({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([b_(v,2),b_(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",gC),this.outputModel=this.createTriangleModel("copy-pass",x_,{blend:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:X.ONE,dstAlpha:X.ONE_MINUS_SRC_ALPHA},equation:{rgb:X.FUNC_ADD,alpha:X.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",x_)}},{key:"render",value:function(t){var o=this,u=this.rendererService,c=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,w=x.height;this.sampleRenderTarget.resize({width:S,height:w}),this.prevRenderTarget.resize({width:S,height:w}),this.outputRenderTarget.resize({width:S,height:w}),this.copyRenderTarget.resize({width:S,height:w}),this.resetFrame(),this.stopAccumulating();var I=t.multiPassRenderer.getPostProcessor().getReadFBO();v(I,function(){c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:I}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var R=function O(B){!o.accumulatingId||B!==o.accumulatingId||o.isFinished()||(o.doRender(t),ca.requestAnimationFrame(function(){O(B)}))};this.accumulatingId=_C++,this.timer=ca.setTimeout(function(){R(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,c=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,w=x.height,I=t.getLayerConfig(),R=I.jitterScale,O=R===void 0?1:R,B=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((B[0]*2-1)/S*O,(B[1]*2-1)/w*O),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var H=t.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:H.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var ae=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ae,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ca.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:yC,fs:o});var c=this.shaderModuleService.getModule(t),p=c.vs,v=c.fs,x=c.uniforms,S=this.rendererService,w=S.createAttribute,I=S.createBuffer,R=S.createModel;return R((0,U.Z)({vs:p,fs:v,attributes:{a_Position:w({buffer:I({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:(0,U.Z)({},x),depth:{enable:!1},count:3},u))}}]),r}(i0),__=da(um.prototype,"shaderModuleService",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um))||y_),mv=new _n.W2;mv.bind(Yt.IGlobalConfigService).to(pE).inSingletonScope(),(0,_n.GW)((0,_n.b2)(),Js.EventEmitter),mv.bind(Yt.IEventEmitter).to(Js.EventEmitter);var E_=(0,Fp.Z)(mv,!1),lm=function(i){var r=E_.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},GL=function(i){var r=E_.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},ic=mv,bC=0;function EC(){var e=new _n.W2;return e.parent=mv,e.bind(Yt.SceneID).toConstantValue("".concat(bC++)),e.bind(Yt.IShaderModuleService).to(lS).inSingletonScope(),e.bind(Yt.ILayerService).to(RE).inSingletonScope(),e.bind(Yt.ISceneService).to(GE).inSingletonScope(),e.bind(Yt.ICameraService).to(rE).inSingletonScope(),e.bind(Yt.ICoordinateSystemService).to(yE).inSingletonScope(),e.bind(Yt.IInteractionService).to(SE).inSingletonScope(),e.bind(Yt.IPickingService).to(TE).inSingletonScope(),e.bind(Yt.IControlService).to(oE).inSingletonScope(),e.bind(Yt.IMarkerService).to(sE).inSingletonScope(),e.bind(Yt.IIconService).to(Sd).inSingletonScope(),e.bind(Yt.IFontService).to(Xf).inSingletonScope(),e.bind(Yt.IPopupService).to(uE).inSingletonScope(),e.bind(Yt.INormalPass).to(hS).whenTargetNamed("clear"),e.bind(Yt.INormalPass).to(yS).whenTargetNamed("pixelPicking"),e.bind(Yt.INormalPass).to(dC).whenTargetNamed("render"),e.bind(Yt.INormalPass).to(xC).whenTargetNamed("taa"),e.bind(Yt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Yt.INormalPass,r)}}),e.bind(Yt.IPostProcessingPass).to(GS).whenTargetNamed("copy"),e.bind(Yt.IPostProcessingPass).to(CS).whenTargetNamed("bloom"),e.bind(Yt.IPostProcessingPass).to(IS).whenTargetNamed("blurH"),e.bind(Yt.IPostProcessingPass).to(OS).whenTargetNamed("blurV"),e.bind(Yt.IPostProcessingPass).to(aC).whenTargetNamed("noise"),e.bind(Yt.IPostProcessingPass).to(cC).whenTargetNamed("sepia"),e.bind(Yt.IPostProcessingPass).to(zS).whenTargetNamed("colorHalftone"),e.bind(Yt.IPostProcessingPass).to($S).whenTargetNamed("hexagonalPixelate"),e.bind(Yt.IPostProcessingPass).to(eC).whenTargetNamed("ink"),e.bind(Yt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Yt.IPostProcessingPass,r);return n.setName(r),n}}),e}function cm(e){var i=new _n.W2;return i.parent=e,i.bind(Yt.IStyleAttributeService).to(ZE).inSingletonScope(),i.bind(Yt.IMultiPassRenderer).to(vS).inSingletonScope(),i.bind(Yt.IPostProcessor).to(fC).inSingletonScope(),i}var SC=null;function HL(e){return SC.indexOf(e)}var CC=2,WL=4,AC=64,XL=128,wC=256,TC=512,YL=8192,$L=16384,qL=32768,MC=null,S_=131072,KL=262144,IC=524288,QL=1048576,kC=2097152,JL=4194304,PC=8388608,LC=16777216,RC=null;function a0(e,i){return e=clamp(Math.floor(e),0,255),i=clamp(Math.floor(i),0,255),256*e+i}function eR(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,c=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],S=[],w=[],I=[a0(i[0],i[1]),a0(i[2],i[3])],R=[a0(c[0],c[1]),a0(c[2],c[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(O){var B=_slicedToArray(O,2),H=B[0],ae=B[1];x.push([].concat(I,[(H+1)*PC+(ae+1)*kC+getShapeIndex(o)*S_+r,(n+512)*IC+(t+512)*AC])),S.push([].concat(R,[p,v])),w.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:S,packedBuffer3:w}}function tR(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*RC+r*LC+n*S_+r*MC+n*TC+r*wC+n*CC+r}var mf;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(mf||(mf={}));var lo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(lo||(lo={}));var dp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(dp||(dp={}));var mn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(mn||(mn={}));var OC=["mapload","mapchange","mapAfterFrameChange"],$p={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},o0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];function DC(e){var i=FC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C_=function(e){(0,sr.Z)(r,e);var i=DC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,Le.Z)(t),"added",!1),(0,Y.Z)((0,Le.Z)(t),"eventHandle",function(o){t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,U.Z)((0,U.Z)({},t.getDefault()),n),ee(["update","onMove","onUp","addDragHandler","onMapClick"],(0,Le.Z)(t)),t.init(),t}return(0,xt.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:at.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(Yt.IMapService),this.sceneSerive=t.get(Yt.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&ks(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&ks(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),Vl(o,"".concat(yt[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,c=this.lngLat,p=c.lng,v=c.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var S=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),w=S.containerHeight,I=S.containerWidth,R=S.bounds;if(!R)return;if(Math.abs(R[0][0])>180||Math.abs(R[1][0])>180){if(x.x>I){var O=this.mapsService.lngLatToContainer([p-360,v]);x.x=O.x}if(x.x<0){var B=this.mapsService.lngLatToContainer([p+360,v]);x.x=B.x}}(x.x>I||x.x<0||x.y>w||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,c=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=Ni("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",c),v.appendChild(x),o.appendChild(v)}wu(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(S){var w,I,R=((w=t.markerOption)===null||w===void 0?void 0:w.style)&&((I=t.markerOption)===null||I===void 0?void 0:I.style[S]);o&&(o.style[S]=R)}),o.addEventListener("click",function(S){t.onMapClick(S)}),o.addEventListener("click",this.eventHandle),Ut(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){throw new Error("Method not implemented.")}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(Js.EventEmitter);function BC(e){var i=NC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rR=function(e){(0,sr.Z)(r,e);var i=BC(r);function r(n){var t,o;return(0,vt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,Le.Z)(o),"markers",[]),(0,Y.Z)((0,Le.Z)(o),"points",[]),(0,Y.Z)((0,Le.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,pt.merge)(o.getDefault(),n),ee(["update"],(0,Le.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,xt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(Yt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),c=this.mapsService.getBounds();this.bbox=fs(c,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),c=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[c,p]},properties:(0,U.Z)((0,U.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,c=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(so())({radius:o,minZoom:c,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,c=t[0].concat(t[1]),p=this.clusterIndex.getClusters(c,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,S=u.markerLayerOption.clusterOption,w=S.field,I=S.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var R,O=u.getLeaves((R=v.properties)===null||R===void 0?void 0:R.cluster_id);if(v.properties.clusterData=O,w&&I){var B=O==null?void 0:O.map(function(Oe){var it=(0,Y.Z)({},w,Oe.properties[w]);return it}),H=Mf(B,w),ae=Jc(I,H),oe="point_"+I;v.properties[oe]=ae.toFixed(2)}}var Ie=u.clusterMarker(v);u.clusterMarkers.push(Ie),Ie.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,c=u.element,p=c===void 0?this.generateElement.bind(this):c,v=new C_({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!_c(this.bbox,o))&&(this.bbox=fs(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=Ni("div","l7-marker-cluster"),u=Ni("div","",o),c=Ni("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;t.properties.point_count=t.properties.point_count||1;var S=v&&x?t.properties["point_"+x]||t.properties[v]:t.properties.point_count;return c.textContent=S,o}}]),r}(Js.EventEmitter),nR=Q(4157);function zC(e){var i=ZC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Id=function(e){(0,sr.Z)(r,e);var i=zC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),r.controlCount++,t.controlOption=(0,U.Z)((0,U.Z)({},t.getDefault(n)),n||{}),t}return(0,xt.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var c=(0,mr.Z)(u,2),p=c[0],v=c[1];v===void 0&&(t[p]=o[p])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,U.Z)((0,U.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(Yt.IMapService),this.renderService=t.get(Yt.IRendererService),this.layerService=t.get(Yt.ILayerService),this.controlService=t.get(Yt.IControlService),this.configService=t.get(Yt.IGlobalConfigService),this.scene=t.get(Yt.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),wu(this.container,"l7-control");var o=this.controlOption,u=o.className,c=o.style;return u&&this.setClassName(u),c&&this.setStyle(c),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;ks(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Ni("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;Ul(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;wu(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:Ch.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ch.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&Ul(o,u),t&&wu(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.container,o=this.controlOption.position,u=this.controlService.controlCorners[o];o.indexOf("bottom")!==-1?u.insertBefore(t,u.firstChild):u.appendChild(t)}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(Gf());(0,Y.Z)(Id,"controlCount",0);function UC(e){var i=VC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function VC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s0=function(e){(0,sr.Z)(r,e);var i=UC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"isDisable",!1),n}return(0,xt.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ni("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,c=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(c),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,c=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(c),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&ks(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var c;(c=this.button)===null||c===void 0||c.insertBefore(t,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(!!this.button)if(Ul(this.button,"l7-button-control--row"),Ul(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=Ni("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,wu(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(ks(this.buttonText),this.buttonText=void 0)}}]),r}(Id);function jC(e){var i=GC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A_=function(e){(0,sr.Z)(r,e);var i=jC(r);function r(n,t){var o;return(0,vt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,Le.Z)(o),"isShow",!1),(0,Y.Z)((0,Le.Z)(o),"timeout",null),(0,Y.Z)((0,Le.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Ul(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,Le.Z)(o)&&u.isShow&&u.hide()}),o.emit("show")),(0,Le.Z)(o)}),(0,Y.Z)((0,Le.Z)(o),"hide",function(){return o.isShow&&(wu(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),(0,Le.Z)(o)}),(0,Y.Z)((0,Le.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,Y.Z)((0,Le.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,Y.Z)((0,Le.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,Y.Z)((0,Le.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,Y.Z)((0,Le.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,Le.Z)(o)),o}return(0,xt.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(jl(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),ks(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,c=o.offset,p=c===void 0?[0,0]:c,v=o.placement,x=(0,mr.Z)(p,2),S=x[0],w=x[1],I=this.button.getBoundingClientRect(),R=u.getBoundingClientRect(),O=dn(I,R),B=O.left,H=O.right,ae=O.top,oe=O.bottom,Ie=!1,Oe=!1;/^(left|right)/.test(v)?(v.includes("left")?t.right="".concat(I.width+H,"px"):v.includes("right")&&(t.left="".concat(I.width+B,"px")),v.includes("start")?t.top="".concat(ae,"px"):v.includes("end")?t.bottom="".concat(oe,"px"):(t.top="".concat(ae+I.height/2,"px"),Oe=!0,t.transform="translate(".concat(S,"px, calc(").concat(w,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?t.bottom="".concat(I.height+oe,"px"):v.includes("bottom")&&(t.top="".concat(I.height+ae,"px")),v.includes("start")?t.left="".concat(B,"px"):v.includes("end")?t.right="".concat(H,"px"):(t.left="".concat(B+I.width/2,"px"),Ie=!0,t.transform="translate(calc(".concat(S,"px - 50%), ").concat(w,"px)"))),t.transform="translate(calc(".concat(S,"px - ").concat(Ie?"50%":"0%","), calc(").concat(w,"px - ").concat(Oe?"50%":"0%",")");var it=v.split("-");it.length&&wu(this.popperDOM,it.map(function(At){return"l7-popper-".concat(At)}).join(" ")),xl(this.popperDOM,Tf(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,c=u===void 0?"":u,p=t.content,v=Ni("div","l7-popper l7-popper-hide ".concat(c)),x=Ni("div","l7-popper-content"),S=Ni("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(S),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),r}(Js.EventEmitter);(0,Y.Z)(A_,"conflictPopperList",[]);function HC(e){var i=WC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},YC=function(e){(0,sr.Z)(r,e);var i=HC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,Ha.Z)((0,je.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t),c=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:XC[c],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,c=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new A_(this.button,{className:u,placement:c,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if((0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(s0);function $C(e){var i=qC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function qC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wh;(function(e){e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index"})(wh||(wh={}));var w_=function(e){(0,sr.Z)(r,e);var i=$C(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"selectValue",[]),(0,Y.Z)((0,Le.Z)(n),"createNormalOption",function(c){var p=n.selectValue.includes(c.value),v=Ni("div","l7-select-control-item ".concat(p?wh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),c.icon&&v.appendChild(c.icon);var x=Ni("span");return x.innerText=c.text,v.appendChild(x),v}),(0,Y.Z)((0,Le.Z)(n),"onItemClick",function(c){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===c.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,N.Z)(n.selectValue),[c.value])}else n.selectValue=[c.value];n.setSelectValue(n.selectValue)}),n}return(0,xt.Z)(r,[{key:"setOptions",value:function(t){(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,c=this.transSelectValue(t);this.optionDOMList.forEach(function(p){var v=p.getAttribute(wh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;c.includes(v)?(wu(p,wh.ActiveOptionClassName),x&&dc(x,!0)):(Ul(p,wh.ActiveOptionClassName),x&&dc(x,!1))}),this.selectValue=c,u&&this.emit("selectChange",this.getIsMultiple()?c:c[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),c=Ni("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&wu(c,"l7-select-control--multiple");var p=t.map(function(v,x){var S=u?o.createImageOption(v):o.createNormalOption(v);return S.setAttribute(wh.OptionValueAttrKey,v.value),S.setAttribute(wh.OptionIndexAttrKey,window.String(x)),S.addEventListener("click",o.onItemClick.bind(o,v)),S});return c.append.apply(c,(0,N.Z)(p)),this.optionDOMList=p,c}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=Ni("div","l7-select-control-item ".concat(o?wh.ActiveOptionClassName:"")),c=Ni("img");c.setAttribute("src",t.img),nl(c),u.appendChild(c);var p=Ni("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=Ni("span");return v.innerText=t.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(t){var o=Ni("input");return o.setAttribute("type","checkbox"),t&&dc(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(YC);function KC(e){var i=QC();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JC=function(e){(0,sr.Z)(r,e);var i=KC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getDefault",value:function(){return{position:Ch.BOTTOMLEFT,name:"logo",href:"https://l7.antv.vision/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=Ni("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(jl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,c=o.img,p=Ni("img");if(p.setAttribute("src",c),p.setAttribute("aria-label","AntV logo"),nl(p),u){var v=Ni("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),t.appendChild(v)}else t.appendChild(p)}}]),r}(Id),Th=function(i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),r.appendChild(n),r};function T_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=eA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function eA(e,i){if(!!e){if(typeof e=="string")return M_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M_(e,i)}}function M_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var I_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Mh=function(){if(typeof document=="undefined")return!1;var e=I_[0],i={},r=T_(I_),n;try{for(r.s();!(n=r.n()).done;){var t=n.value,o=t==null?void 0:t[1];if(o in document){var u=T_(t.entries()),c;try{for(u.s();!(c=u.n()).done;){var p=(0,mr.Z)(c.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(S){u.e(S)}finally{u.f()}return i}}}catch(S){r.e(S)}finally{r.f()}return!1}(),k_={change:Mh.fullscreenchange,error:Mh.fullscreenerror},ac={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function c(){ac.off("change",c),n()};ac.on("change",o);var u=i[Mh.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(i,r){if(!ac.isFullscreen){i();return}var n=function o(){ac.off("change",o),i()};ac.on("change",n);var t=document[Mh.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(i,r){return ac.isFullscreen?ac.exit():ac.request(i,r)},onchange:function(i){ac.on("change",i)},onerror:function(i){ac.on("error",i)},on:function(i,r){var n=k_[i];n&&document.addEventListener(n,r,!1)},off:function(i,r){var n=k_[i];n&&document.removeEventListener(n,r,!1)},raw:Mh};Object.defineProperties(ac,{isFullscreen:{get:function(){return Boolean(document[Mh.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[Mh.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Mh.fullscreenEnabled])}}}),Mh||(ac={isEnabled:!1});var fm=ac;function tA(e){var i=rA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iR=function(e){(0,sr.Z)(r,e);var i=tA(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),(0,Y.Z)((0,Le.Z)(t),"isFullscreen",!1),(0,Y.Z)((0,Le.Z)(t),"toggleFullscreen",(0,Ct.Z)(Et().mark(function o(){return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!fm.isEnabled){c.next=3;break}return c.next=3,fm.toggle(t.mapContainer);case 3:case"end":return c.stop()}},o)}))),(0,Y.Z)((0,Le.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,Y.Z)((0,Le.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,c=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,S=o.exitTitle;t.isFullscreen?(t.setBtnTitle(S),t.setBtnText(v),t.setBtnIcon(x)):(t.setBtnTitle(p),t.setBtnText(u),t.setBtnIcon(c)),t.emit("fullscreenChange",t.isFullscreen)}),fm.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,xt.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,c=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(c)),(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=Wi(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){(0,Ha.Z)((0,je.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:Th("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Th("l7-icon-exit-fullscreen")})}}]),r}(s0);function nA(e){var i=iA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aR=function(e){(0,sr.Z)(r,e);var i=nA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"onClick",(0,Ct.Z)(Et().mark(function c(){var p;return Et().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},c)}))),(0,Y.Z)((0,Le.Z)(n),"mergeImage",(0,Ct.Z)(Et().mark(function c(){var p,v,x,S,w,I,R,O,B,H,ae,oe,Ie,Oe,it=arguments;return Et().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:for(x=n.controlOption.imageType,S=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},w=S.width,I=w===void 0?0:w,R=S.height,O=R===void 0?0:R,B=document.createElement("canvas"),B.width=I,B.height=O,H=B.getContext("2d"),ae=it.length,oe=new Array(ae),Ie=0;Ie<ae;Ie++)oe[Ie]=it[Ie];return gt.next=9,Promise.all(oe.map(function($t){return new Promise(function(gr){var dr=new Image;dr.onload=function(){gr(dr)},dr.src=$t})}));case 9:return Oe=gt.sent,Oe.forEach(function($t){H==null||H.drawImage($t,0,0,I,O)}),gt.abrupt("return",B.toDataURL("image/".concat(x)));case 12:case"end":return gt.stop()}},c)}))),n}return(0,xt.Z)(r,[{key:"onAdd",value:function(){var t=(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Th("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var t=this.mapsService.exportMap("png"),o=this.scene.exportPng("png");return this.mergeImage(t,o)}}]),r}(s0);function aA(e){var i=oA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oR=function(e){(0,sr.Z)(r,e);var i=aA(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),(0,Y.Z)((0,Le.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(c){var p=c.coords,v=p!=null?p:{},x=v.longitude,S=v.latitude;!(0,pt.isNaN)(x)&&!(0,pt.isNaN)(S)?o([x,S]):u()},function(c){u(c)})})}),(0,Y.Z)((0,Le.Z)(t),"onClick",(0,Ct.Z)(Et().mark(function o(){var u,c,p;return Et().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=t.controlOption.transform,x.next=5,t.getGeoLocation();case 5:if(c=x.sent,p=t.mapsService.getZoom(),x.t0=t.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(c);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=c;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,xt.Z)(r,[{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:Th("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(s0),sA={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-nqiT6Vu948AAAAAAAAAAAAAARQnAQ"},light:{text:"\u6708\u5149\u94F6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*J_wYQL_PaUEAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*U7M9QI1yat4AAAAAAAAAAAAAARQnAQ"},fresh:{text:"\u8349\u8272\u9752",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*T-oBT4hB5ucAAAAAAAAAAAAAARQnAQ"},grey:{text:"\u96C5\u58EB\u7070",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OREXQ4vgQRIAAAAAAAAAAAAAARQnAQ"},graffiti:{text:"\u6D82\u9E26",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*4UApTKmeiy4AAAAAAAAAAAAAARQnAQ"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*0GrCQLtDjNcAAAAAAAAAAAAAARQnAQ"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*uWxqSZQlPkkAAAAAAAAAAAAAARQnAQ"},wine:{text:"\u9171\u7C7D",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OFPrTbg3an0AAAAAAAAAAAAAARQnAQ"}},uA={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*AnfJTbIBJOkAAAAAAAAAAAAAARQnAQ"},light:{text:"\u4EAE",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gnuiQIok9qIAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u6697",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*NwG-TbOlBH0AAAAAAAAAAAAAARQnAQ"},satellite:{text:"\u536B\u661F",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*2X5EQLKul3IAAAAAAAAAAAAAARQnAQ"},outdoors:{text:"\u6237\u5916",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gXFLRIaBUI0AAAAAAAAAAAAAARQnAQ"}};function lA(e){var i=cA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function cA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sR=function(e){(0,sr.Z)(r,e);var i=lA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,xt.Z)(r,[{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Th("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?uA:sA;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,mr.Z)(o,2),c=u[0],p=u[1];return typeof p=="string"&&c!=="blank"}).map(function(o){var u,c=(0,mr.Z)(o,2),p=c[0],v=c[1],x=(u=t[p])!==null&&u!==void 0?u:{},S=x.text,w=x.img;return{text:S!=null?S:p,value:v,img:w,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,c,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(c=this.controlOption.options.find(function(x){return x.key===p}))===null||c===void 0?void 0:c.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(w_);function fA(e){var i=hA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uR=function(e){(0,sr.Z)(r,e);var i=fA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"onLayerChange",function(){var c;(c=n.controlOption.layers)!==null&&c!==void 0&&c.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,Y.Z)((0,Le.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,Y.Z)((0,Le.Z)(n),"onSelectChange",function(){n.layers.forEach(function(c){var p=n.selectValue.includes(c.name),v=c.isVisible();p&&!v&&c.show(),!p&&v&&c.hide()})}),n}return(0,xt.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(c){if(c instanceof Object&&u.push(c),typeof c=="string"){var p=t.getLayer(c)||t.getLayerByName(c);p&&u.push(p)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Th("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,Ha.Z)((0,je.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(w_);function pA(e){var i=dA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function dA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lR=function(e){(0,sr.Z)(r,e);var i=pA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"location",[0,0]),(0,Y.Z)((0,Le.Z)(n),"onMouseMove",function(c){var p=n.location,v=c.lngLat||c.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,xt.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:Ch.BOTTOMLEFT,transform:function(u){var c=(0,mr.Z)(u,2),p=c[0],v=c[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=Ni("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(Id);function vA(e){var i=mA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function mA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cR=function(e){(0,sr.Z)(r,e);var i=vA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,Y.Z)((0,Le.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,Y.Z)((0,Le.Z)(n),"updateDisabled",function(){var c=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||c.getZoom()<=c.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),(n.disabled||c.getZoom()>=c.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,xt.Z)(r,[{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:Ch.BOTTOMRIGHT,name:"zoom",zoomInText:Th("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Th("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(t){(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=Ni("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){jl(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,c,p){var v=Ni("button",u,c);return typeof t=="string"?v.innerHTML=t:v.append(t),v.title=o,v.addEventListener("click",p),v}}]),r}(Id);function gA(e){var i=yA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function yA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fR=function(e){(0,sr.Z)(r,e);var i=gA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"update",function(){var c=n.mapsService,p=n.controlOption.maxWidth,v=c.getSize()[1]/2,x=c.containerToLngLat([0,v]),S=c.containerToLngLat([p,v]),w=Rf([x.lng,x.lat],[S.lng,S.lat]);n.updateScales(w)}),n}return(0,xt.Z)(r,[{key:"getDefault",value:function(t){return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:Ch.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=Ni("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,c=o.imperial;u&&t&&this.updateMetric(t),c&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){jl(t);var o=this.controlOption,u=o.metric,c=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&xl(t,"width: ".concat(p,"px")),u&&(this.mScale=Ni("div","l7-control-scale-line",t)),c&&(this.iScale=Ni("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var c=this.controlOption.maxWidth;t.style.width=Math.round(c*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,c,p;o>5280?(u=o/5280,c=this.getRoundNum(u),this.updateScale(this.iScale,c+" mi",c/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),r}(Id);function _A(e){var i=xA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hm=function(e){(0,sr.Z)(r,e);var i=_A(r);function r(n){var t;(0,vt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,Le.Z)(t),"isShow",!0),(0,Y.Z)((0,Le.Z)(t),"onMouseMove",function(u){var c,p=t.mapsService.getMapContainer(),v=(c=p==null?void 0:p.getBoundingClientRect())!==null&&c!==void 0?c:{},x=v.left,S=x===void 0?0:x,w=v.top,I=w===void 0?0:w;t.setPopupPosition(u.clientX-S,u.clientY-I)}),(0,Y.Z)((0,Le.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,c=u.lng,p=u.lat,v=t.mapsService.lngLatToContainer([c,p]),x=v.x,S=v.y;t.setPopupPosition(x,S)}}),(0,Y.Z)((0,Le.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,Y.Z)((0,Le.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.remove()}),(0,Y.Z)((0,Le.Z)(t),"update",function(){var u=!!t.lngLat,c=t.popupOption,p=c.className,v=c.style,x=c.maxWidth,S=c.anchor,w=c.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var I=t.mapsService.getMarkerContainer();!t.container&&I&&(t.container=Ni("div","l7-popup ".concat(p!=null?p:""," ").concat(t.isShow?"":"l7-popup-hide"),I),v&&t.container.setAttribute("style",v),t.tip=Ni("div","l7-popup-tip",t.container),t.container.appendChild(t.content),w&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(R){t.container.addEventListener(R,function(O){O.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),x&&t.container.style.maxWidth!==x&&(t.container.style.maxWidth=x),t.updateLngLatPosition(),Vl(t.container,"".concat(yt[S])),Ut(t.container,S,"popup")}}),t.popupOption=(0,U.Z)((0,U.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,xt.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(Yt.IMapService),this.sceneService=t.get(Yt.ISceneService),this.layerService=t.get(Yt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,c=o.text;return u?this.setHTML(u):c&&this.setText(c),this.emit("open"),this}},{key:"remove",value:function(){if(!!this.isOpen())return this.content&&ks(this.content),this.container&&(ks(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.popupOption=(0,U.Z)((0,U.Z)({},this.popupOption),t),this.checkUpdateOption(t,["closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets","title"])&&(this.container&&(ks(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Ul(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&wu(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(this.getPopupHTMLFragment(t))}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:at.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.createContent(),this.contentPanel.appendChild(t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){this.mapsService.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&this.mapsService.on("click",this.onCloseButtonClick)}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o=this.mapsService.getContainer();o.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&o.addEventListener("mousemove",this.onMouseMove)}},{key:"createContent",value:function(){if(this.content&&ks(this.content),this.content=Ni("div","l7-popup-content",this.container),this.popupOption.title){var t;this.contentTitle=Ni("div","l7-popup-content__title",this.content),(t=this.contentTitle)===null||t===void 0||t.append(this.getPopupHTMLFragment(this.popupOption.title))}else this.contentTitle=void 0;if(this.popupOption.closeButton){var o=Th("l7-icon-guanbi");wu(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",this.onCloseButtonClick),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=Ni("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}},{key:"getPopupHTMLFragment",value:function(t){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),c;for(typeof t=="string"?u.innerHTML=t:Array.isArray(t)?u.append.apply(u,(0,N.Z)(t)):t instanceof HTMLElement&&u.append(t);c=u.firstChild,!!c;)o.appendChild(c);return o}}]),r}(Js.EventEmitter);function bA(e){var i=EA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function EA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hR=function(e){(0,sr.Z)(r,e);var i=bA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"layerConfigMap",new WeakMap),n}return(0,xt.Z)(r,[{key:"addTo",value:function(t){return(0,Ha.Z)((0,je.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,Ha.Z)((0,je.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),(0,Ha.Z)((0,je.Z)(r.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,U.Z)((0,U.Z)({},(0,Ha.Z)((0,je.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption,u=o.config,c=o.trigger;u.forEach(function(p){var v=t.getLayerByConfig(p);if(!!v){var x=(0,U.Z)({},p);if(c==="hover"){var S=t.onLayerMouseMove.bind(t,v),w=t.onLayerMouseOut.bind(t,v);x.onMouseMove=S,x.onMouseOut=w,v==null||v.on("mousemove",S),v==null||v.on("mouseout",w)}else{var I=t.onLayerClick.bind(t,v);x.onClick=I,v==null||v.on("click",I)}var R=v.getSource(),O=t.onSourceUpdate.bind(t,v);R==null||R.on("update",O),x.onSourceUpdate=O,t.layerConfigMap.set(v,x)}})}},{key:"unbindLayerEvent",value:function(){var t=this,o=this.popupOption.config;o.forEach(function(u){var c=t.getLayerByConfig(u),p=c&&t.layerConfigMap.get(c);if(!!p){var v=p.onMouseMove,x=p.onMouseOut,S=p.onClick,w=p.onSourceUpdate;if(v&&c.off("mousemove",v),x&&c.off("mouseout",x),S&&c.off("click",S),w){var I;c==null||(I=c.getSource())===null||I===void 0||I.off("update",w)}}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o);this.setDOMContent(u),this.displayFeatureInfo={layer:t,featureId:o.featureId}}this.isShow||this.show()}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(t,o){if(this.isShow&&this.isSameFeature(t,o.featureId))this.hide();else{var u=this.getLayerInfoFrag(t,o);this.setDOMContent(u),this.setLnglat(o.lngLat),this.show(),this.displayFeatureInfo={layer:t,featureId:o.featureId}}}},{key:"onSourceUpdate",value:function(t){var o;((o=this.displayFeatureInfo)===null||o===void 0?void 0:o.layer)===t&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),c=document.createDocumentFragment();if(u){var p=o.feature;p.type==="Feature"&&"properties"in p&&"geometry"in p&&(p=p.properties);var v=u.fields;v==null||v.forEach(function(x){var S=typeof x=="string"?{field:x}:x,w=S.field,I=S.formatField,R=S.formatValue,O=S.getValue,B=Ni("div","l7-layer-popup__row"),H=O?O(o.feature):(0,pt.get)(p,w);B.innerHTML="".concat(I?I(w):w,": ").concat(R?R(H):H),c.appendChild(B)})}return c}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(hm);function SA(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}SA(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  pointer-events: none;
  will-change: transform;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  pointer-events: auto;
  font-size: 14px;
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  font-weight: bold;
  margin-bottom: 8px;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  line-height: 18px;
  text-align: center;
  padding: 0;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  font-size: 14px;
}
.l7-popup .l7-popup-tip {
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var vp,pm=(vp={},(0,Y.Z)(vp,mf.additive,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:1,dstAlpha:1}}),(0,Y.Z)(vp,mf.none,{enable:!1}),(0,Y.Z)(vp,mf.normal,{enable:!0,func:{srcRGB:X.SRC_ALPHA,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,Y.Z)(vp,mf.subtractive,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:X.ZERO,dstAlpha:X.ONE_MINUS_SRC_COLOR},equation:{rgb:X.FUNC_SUBTRACT,alpha:X.FUNC_SUBTRACT}}),(0,Y.Z)(vp,mf.max,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MAX_EXT}}),(0,Y.Z)(vp,mf.min,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MIN_EXT}}),vp);function cl(e,i,r,n,t){i.updateStyleAttribute(e,r,n,t)}function CA(e,i){i.tileLayer||i.isTileLayer||(e.opacity&&u0("opacity",i,e.opacity),e.strokeWidth&&u0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&u0("strokeOpacity",i,e.strokeOpacity),e.stroke&&AA("stroke",i,e.stroke),e.offsets&&P_("offsets",i,e.offsets),e.textOffset&&P_("textOffset",i,e.textOffset),e.thetaOffset&&u0("thetaOffset",i,e.thetaOffset))}function u0(e,i,r){(0,pt.isString)(r)?cl(e,i,r,function(n){return n}):(0,pt.isNumber)(r)?cl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?(0,pt.isString)(r[0])&&(0,pt.isFunction)(r[1])||(0,pt.isString)(r[0])&&Array.isArray(r[1])&&(0,pt.isNumber)(r[1][0])&&(0,pt.isNumber)(r[1][1])?cl(e,i,r[0],r[1]):cl(e,i,[1],void 0):cl(e,i,[1],void 0)}function P_(e,i,r){(0,pt.isString)(r)?cl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&(0,pt.isString)(r[0])&&(0,pt.isFunction)(r[1])?cl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&(0,pt.isNumber)(r[0])&&(0,pt.isNumber)(r[1])?cl(e,i,r,void 0):cl(e,i,[0,0],void 0)}function AA(e,i,r){(0,pt.isString)(r)?cl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&((0,pt.isString)(r[0])&&(0,pt.isFunction)(r[1])||(0,pt.isString)(r[0])&&Array.isArray(r[1])&&r[1].length>0)?cl(e,i,r[0],r[1]):cl(e,i,"#fff",void 0)}var gs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(gs||(gs={}));function wA(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Of(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function TA(e,i,r){if(e.length>0&&i.version===gs["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=gs["GAODE2.x"],t.originCoordinates=(0,pt.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordByLayer(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=gs["GAODE2.x"],t.originCoordinates=(0,pt.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordsByLayer(t.coordinates,n)})}}function MA(e,i){e.length>0&&i.version===gs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=IA(r.coordinates,i),r.simpleCoordinate=!0)})}function IA(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function kA(e,i,r){var n;if(!e.scale)return[];var t=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],o=[];t.forEach(function(c){var p,v=c.field;(i.hasOwnProperty(v)||((p=e.scale)===null||p===void 0?void 0:p.type)==="variable")&&o.push(i[v])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!Ce(u[0])?[r]:u}function PA(e,i,r,n,t,o){var u=o==null?void 0:o.getLayerConfig(),c=u.arrow,p=c===void 0?{enable:!1}:c,v=i.map(function(x){var S={id:x._id,coordinates:x.coordinates};if(e.filter(function(R){return R.scale!==void 0}).forEach(function(R){var O=kA(R,x,t);R.needRemapping=!1,R.name==="color"&&(O=O.map(function(B){return Re(B)})),S[R.name]=Array.isArray(O)&&O.length===1?O[0]:O,R.name==="shape"&&(S.shape=r.getIconFontKey(S[R.name]))}),S.shape==="line"&&p.enable){var w=S.coordinates,I=wA(w[0],w[1]);S.coordinates.splice(1,0,I,I)}return S});return TA(v,n,o),MA(v,n),v}function LA(e,i,r,n,t,o){var u=new Nc(t,o),c=e.getBottomColor(),p=n.getLayerStyleAttributes()||[],v=u.data.dataArray,x=v,S=PA(p,x,i,r,c,e);return u.destroy(),S}function L_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function R_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),L_(i).forEach(function(c){var p=(0,mr.Z)(c,2),v=p[0],x=p[1];t.add(r(v),x)}),t.add(r("copy")),t}var RA=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function OA(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}RA.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var DA=["passes"],FA=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],O_,dm,D_;function BA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=NA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function NA(e,i){if(!!e){if(typeof e=="string")return F_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F_(e,i)}}function F_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function zA(e){var i=ZA();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function ZA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B_=0,Kf=(O_=lm(Yt.IGlobalConfigService),dm=function(e){(0,sr.Z)(r,e);var i=zA(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,vt.Z)(this,r),n=i.call(this),(0,Y.Z)((0,Le.Z)(n),"id","".concat(B_++)),(0,Y.Z)((0,Le.Z)(n),"name","".concat(B_)),(0,Y.Z)((0,Le.Z)(n),"visible",!0),(0,Y.Z)((0,Le.Z)(n),"zIndex",0),(0,Y.Z)((0,Le.Z)(n),"inited",!1),(0,Y.Z)((0,Le.Z)(n),"layerModelNeedUpdate",!1),(0,Y.Z)((0,Le.Z)(n),"pickedFeatureID",null),(0,Y.Z)((0,Le.Z)(n),"selectedFeatureID",null),(0,Y.Z)((0,Le.Z)(n),"styleNeedUpdate",!1),(0,Y.Z)((0,Le.Z)(n),"forceRender",!1),(0,Y.Z)((0,Le.Z)(n),"clusterZoom",0),(0,Y.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,Y.Z)((0,Le.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,Y.Z)((0,Le.Z)(n),"hooks",{init:new Ui,afterInit:new Ui,beforeRender:new Ui,beforeRenderData:new Wn,afterRender:new tn,beforePickingEncode:new tn,afterPickingEncode:new tn,beforeHighlight:new tn(["pickedColor"]),afterHighlight:new tn,beforeSelect:new tn(["pickedColor"]),afterSelect:new tn,beforeDestroy:new tn,afterDestroy:new tn}),(0,Y.Z)((0,Le.Z)(n),"models",[]),(0,Y.Z)((0,Le.Z)(n),"modelLoaded",!1),(0,Y.Z)((0,Le.Z)(n),"layerChildren",[]),(0,Y.Z)((0,Le.Z)(n),"masks",[]),(0,Y.Z)((0,Le.Z)(n),"isVector",!1),va((0,Le.Z)(n),"configService",D_,(0,Le.Z)(n)),(0,Y.Z)((0,Le.Z)(n),"animateOptions",{enable:!1}),(0,Y.Z)((0,Le.Z)(n),"currentPickId",null),(0,Y.Z)((0,Le.Z)(n),"pendingStyleAttributes",[]),(0,Y.Z)((0,Le.Z)(n),"scaleOptions",{}),(0,Y.Z)((0,Le.Z)(n),"animateStatus",!1),(0,Y.Z)((0,Le.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,Y.Z)((0,Le.Z)(n),"isDestroyed",!1),(0,Y.Z)((0,Le.Z)(n),"encodeDataLength",0),(0,Y.Z)((0,Le.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions),n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,xt.Z)(r,[{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(c){c in o.rawConfig&&(o.rawConfig[c]=t[c])}),!this.inited)this.needUpdateConfig=(0,U.Z)((0,U.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(Yt.SceneID);CA(t,this),this.configService.setLayerConfig(u,this.id,(0,U.Z)((0,U.Z)((0,U.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(t){this.bottomColor=t}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var t=this,o=this.container.get(Yt.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Yt.IIconService),this.fontService=this.container.get(Yt.IFontService),this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.interactionService=this.container.get(Yt.IInteractionService),this.pickingService=this.container.get(Yt.IPickingService),this.mapService=this.container.get(Yt.IMapService);var u=this.getLayerConfig(),c=u.enableMultiPassRenderer,p=u.passes;c&&p!==null&&p!==void 0&&p.length&&p.length>0&&this.mapService.on("mapAfterFrameChange",function(){t.renderLayers()}),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(w){var I=w.attributeName,R=w.attributeField,O=w.attributeValues,B=w.updateOptions;t.styleAttributeService.updateStyleAttribute(I,{scale:(0,U.Z)({field:R},t.splitValuesAndCallbackInAttribute(O,t.getLayerConfig()[I]))},B)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin);var v=BA(this.plugins),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(w){v.e(w)}finally{v.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var c=this.calculateEncodeData(t,o),p=this.triangulation;return c&&p?this.styleAttributeService.createAttributesAndIndices(c,p):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(t,o){return this.inited?LA(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,U.Z)((0,U.Z)({},this.getDefaultConfig()),this.rawConfig));var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){return this.updateStyleAttribute("filter",t,o,u),this}},{key:"shape",value:function(t,o,u){var c,p,v,x=(c=this.styleAttributeService)===null||c===void 0||(p=c.getLayerStyleAttribute("shape"))===null||p===void 0||(v=p.scale)===null||v===void 0?void 0:v.field,S=t;return this.shapeOption={field:t,values:o},this.updateStyleAttribute("shape",t,o,u),this.tileLayer||OA(this,x,S),this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return(0,pt.isObject)(t)?(o.enable=!0,o=(0,U.Z)((0,U.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?this.layerSource.setData(t,o):this.on("inited",function(){var c=u.getSource();c?u.layerSource.setData(t,o):(u.source(new Nc(t,o)),u.sourceEvent())}),this}},{key:"style",value:function(t){var o=this,u=this.getLayerConfig(),c=t.passes,p=(0,hp.Z)(t,DA);return c&&L_(c).forEach(function(v){var x=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(v[0]);x&&x.updateOptions(v[1])}),this.rawConfig=(0,U.Z)((0,U.Z)({},this.rawConfig),p),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&t.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(v){o.models=v})),this}},{key:"scale",value:function(t,o){return(0,pt.isObject)(t)?this.scaleOptions=(0,U.Z)((0,U.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var n=(0,Ct.Z)(Et().mark(function o(){return Et().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){c.next=2;break}return c.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){c.next=7;break}return c.next=5,this.multiPassRenderer.render();case 5:c.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return c.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=(0,pt.isObject)(t)?!0:t,(0,pt.isObject)(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if((0,pt.isObject)(t)){var c=t.x,p=c===void 0?0:c,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:(0,pt.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,pt.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:(0,pt.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,pt.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(nt(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=(0,pt.isObject)(t)?!0:t,(0,pt.isObject)(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if((0,pt.isObject)(t)){var c=t.x,p=c===void 0?0:c,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:(0,pt.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,pt.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:(0,pt.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,pt.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(nt(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,c=o.minZoom,p=c===void 0?-Infinity:c,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&t>=p&&t<=x}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),c=u.passes,p=c===void 0?[]:c;this.multiPassRenderer=R_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,S=v.height;this.multiPassRenderer.resize(x,S)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,c=u.some(function(p){return Math.abs(p)===Infinity});return c?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(p){return p.destroy(!1)}),this.layerChildren=[],this.masks.map(function(p){return p.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(c),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],this.layerService.cleanRemove(this,c),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(){if(o.coordCenter===void 0){var c,p=o.layerSource.center;o.coordCenter=p,((c=o.mapService)===null||c===void 0?void 0:c.setCoordCenter)&&o.mapService.setCoordCenter(p)}o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,c,p=this.styleAttributeService.getLayerStyleAttribute(t),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(c=p.scale)===null||c===void 0?void 0:c.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,Y.Z)({value:o.invertExtent(v)},t,v)});return u}else if(o.ticks){var c=o.ticks().map(function(v){return(0,Y.Z)({value:v},t,o(v))});return c}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!(0,pt.isUndefined)(v)}).map(function(v){return(0,Y.Z)({value:v},t,o(v))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(t){var o=this,u=t.moduleName,c=t.vertexShader,p=t.fragmentShader,v=t.triangulation,x=t.segmentNumber,S=t.workerEnabled,w=S===void 0?!1:S,I=t.workerOptions,R=(0,hp.Z)(t,FA);this.shaderModuleService.registerModule(u,{vs:c,fs:p});var O=this.shaderModuleService.getModule(u),B=O.vs,H=O.fs,ae=O.uniforms,oe=this.rendererService.createModel;return new Promise(function(Ie,Oe){setTimeout(function(){if(I&&I.modelType in uh&&w)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,x,I).then(function(kr){var Sn=kr.attributes,Vn=kr.elements,Vi=oe((0,U.Z)({attributes:Sn,uniforms:ae,fs:H,vs:B,elements:Vn,blend:pm[mf.normal]},R));Ie(Vi)}).catch(function(kr){return Oe(kr)});else{var it=o.styleAttributeService.createAttributesAndIndices(o.encodedData,v,x),At=it.attributes,gt=it.elements,$t=it.count,gr=(0,U.Z)({attributes:At,uniforms:ae,fs:H,vs:B,elements:gt,blend:pm[mf.normal]},R);$t&&(gr.count=$t);var dr=oe(gr);Ie(dr)}})})}},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),c=u.attributes;return c}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){if(this.rawConfig.usage==="basemap")return!1;var o=this.getLayerConfig(),u=o.enableHighlight,c=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&v&&(x=!0),t==="mousemove"&&(c||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(t){var o=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(u){o.models=u,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},t)}),this)}},{key:"updateStyleAttribute",value:function(t,o,u,c){this.inited?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,U.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},c):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:c})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"dispatchModelLoad",value:function(t){var o=this;this.models.forEach(function(u){return u.destroy()}),this.models=[],this.models=t,this.emit("modelLoaded",null),this.modelLoaded=!0,setTimeout(function(){o.layerService.renderLayers()},32)}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:(0,pt.isFunction)(t)?void 0:t||o,callback:(0,pt.isFunction)(t)?t:void 0}}}]),r}(Js.EventEmitter),D_=da(dm.prototype,"configService",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm),N_,vm,z_;function UA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=VA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function VA(e,i){if(!!e){if(typeof e=="string")return Z_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z_(e,i)}}function Z_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var xa=(N_=lm(Yt.IGlobalConfigService),vm=function(){function e(i){(0,vt.Z)(this,e),va(this,"configService",z_,this),this.layer=i,this.rendererService=i.getContainer().get(Yt.IRendererService),this.pickingService=i.getContainer().get(Yt.IPickingService),this.shaderModuleService=i.getContainer().get(Yt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Yt.IStyleAttributeService),this.mapService=i.getContainer().get(Yt.IMapService),this.iconService=i.getContainer().get(Yt.IIconService),this.fontService=i.getContainer().get(Yt.IFontService),this.cameraService=i.getContainer().get(Yt.ICameraService),this.layerService=i.getContainer().get(Yt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:X.NEAREST,min:X.NEAREST,width:1,height:1}))}return(0,xt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return(0,pt.isEqual)(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),(0,pt.isEqual)(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),(0,pt.isEqual)(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),(0,pt.isEqual)(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),(0,pt.isEqual)(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),(0,pt.isEqual)(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!(0,pt.isNumber)(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!(0,pt.isNumber)(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!(0,pt.isNumber)(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!(0,pt.isNumber)(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return(0,pt.isString)(r)?!!(0,Ee.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Re(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&(0,pt.isNumber)(r[0])&&(0,pt.isNumber)(r[1]))}},{key:"patchMod",value:function(r,n){for(var t=0;t<n;t++)r.push(-1)}},{key:"patchData",value:function(r,n,t){var o=UA(t),u;try{for(o.s();!(u=o.n()).done;){var c=u.value,p=c.attr,v=c.count,x=n[p];x!==void 0?p==="stroke"?r.push.apply(r,(0,N.Z)(Re(x))):p==="offsets"?this.isOffsetStatic(x)?r.push(-x[0],x[1]):r.push(0,0):r.push((0,pt.isNumber)(x)?x:1):this.patchMod(r,v)}}catch(S){o.e(S)}finally{o.f()}}},{key:"calDataFrame",value:function(r,n,t){for(var o=n.length,u=Math.ceil(o*r/this.DATA_TEXTURE_WIDTH),c=u*this.DATA_TEXTURE_WIDTH,p=[],v=0;v<o;v++){var x=n[v];this.patchData(p,x,t)}for(var S=p.length;S<c;S++)p.push(-1);return{data:p,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return pm[mf[t]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(r){throw new Error("Method not implemented.")}},{key:"initModels",value:function(r){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),z_=da(vm.prototype,"configService",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm),mm=100,pR=36,dR=40;function U_(e){return e/180*Math.acos(-1)}function V_(e){var i=U_(e[0])+Math.PI/2,r=U_(e[1]),n=mm+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function vR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,c=2+u,p=2*c,v=[],x=[],S=[],w=[],I=[],R=[],O=0;O<=c;O++){for(var B=O/c,H=B*Math.PI,ae=0;ae<=p;ae++){var oe=ae/p,Ie=oe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-H),mat4.identity(r),mat4.rotateY(r,r,Ie),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),S.push(o.slice()),w.push.apply(w,_toConsumableArray(o.slice())),vec3.normalize(o,o),I.push.apply(I,_toConsumableArray(o.slice())),R.push([oe,1-B]),w.push(oe,1-B)}if(O>0)for(var Oe=S.length,it=Oe-2*(p+1);it+p+2<Oe;it++)v.push([it,it+1,it+p+1]),x.push(it,it+1,it+p+1),v.push([it+p+1,it+1,it+p+2]),x.push(it+p+1,it+1,it+p+2)}return{cells:v,positions:S,uvs:R,positionsArr:w,indicesArr:x,normalArr:I}}var l0=$r.create(),mR=$r.create(),ru=$r.create(),mp=$r.create(),kd=$r.create();function gm(e,i,r,n,t){$r.add(e,r,n),$r.normalize(e,e),i=$r.fromValues(-e[1],e[0]);var o=$r.fromValues(-r[1],r[0]);return[t/$r.dot(i,o),i]}function gp(e,i){return $r.set(e,-i[1],i[0])}function Pd(e,i,r){return $r.sub(e,i,r),$r.normalize(e,e),e}function ym(e,i){return e[0]===i[0]&&e[1]===i[1]}function gR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var jA=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,Y.Z)(this,"lastFlip",-1),(0,Y.Z)(this,"miter",$r.fromValues(0,0)),(0,Y.Z)(this,"started",!1),(0,Y.Z)(this,"dash",!1),(0,Y.Z)(this,"totalDistance",0),(0,Y.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,xt.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,c,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,v,x,S=r[c-1];S.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var w=n[c-1],I=r[c];I.push((v=n[c][2])!==null&&v!==void 0?v:0);var R=n[c],O=c<r.length-1?[].concat((0,N.Z)(r[c+1]),[(x=n[c+1][2])!==null&&x!==void 0?x:0]):null,B=c<n.length-1?n[c+1]:null,H=this.simpleSegment(t,u,S,I,O,w,R,B);u+=H}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,v,x,S=r[c-1];S.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var w=n[c-1],I=r[c];I.push((v=n[c][2])!==null&&v!==void 0?v:0);var R=n[c],O=c<r.length-1?[].concat((0,N.Z)(r[c+1]),[(x=n[c+1][2])!==null&&x!==void 0?x:0]):null,B=c<n.length-1?n[c+1]:null,H=this.segment_gaode2(t,u,S,I,O,w,R,B);u+=H}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,c,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var c=0,p=r.indices,v=r.positions,x=r.normals,S=_o([o[0],o[1]]),w=_o([t[0],t[1]]);Pd(ru,S,w);var I=0;if(this.dash&&(I=this.lineSegmentDistance(S,w),this.totalDistance+=I),this.normal||(this.normal=$r.create(),gp(this.normal,ru)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-I)),p.push(n+0,n+1,n+2),!u)gp(this.normal,ru),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2;else{var R=_o([u[0],u[1]]);ym(S,R)&&$r.add(R,S,$r.normalize(R,$r.subtract(R,S,w))),Pd(mp,R,S);var O=gm(kd,$r.create(),ru,mp,this.thickness),B=(0,mr.Z)(O,2),H=B[0],ae=B[1],oe=$r.dot(kd,this.normal)<0?-1:1;this.extrusions(v,x,o,ae,H,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),oe=-1,$r.copy(this.normal,ae),c+=2,this.lastFlip=oe}return c}},{key:"segment_gaode2",value:function(r,n,t,o,u,c,p,v){var x=0,S=r.indices,w=r.positions,I=r.normals,R=this.cap==="square",O=this.join==="bevel",B=_o([p[0],p[1]]),H=_o([c[0],c[1]]);Pd(ru,o,t);var ae=0;if(this.dash&&(ae=this.lineSegmentDistance(B,H),this.totalDistance+=ae),this.normal||(this.normal=$r.create(),gp(this.normal,ru)),!this.started)if(this.started=!0,R){var oe=$r.create(),Ie=$r.create();$r.add(oe,this.normal,ru),$r.add(Ie,this.normal,ru),I.push(Ie[0],Ie[1],0),I.push(oe[0],oe[1],0),w.push(t[0],t[1],t[2]|0,this.totalDistance-ae,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),w.push(t[0],t[1],t[2]|0,this.totalDistance-ae,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,I,t,this.normal,this.thickness,this.totalDistance-ae);if(S.push(n+0,n+1,n+2),u){ym(o,u)&&$r.add(u,o,$r.normalize(u,$r.subtract(u,o,t))),Pd(mp,u,o);var At=gm(kd,$r.create(),ru,mp,this.thickness),gt=(0,mr.Z)(At,2),$t=gt[0],gr=gt[1],dr=$r.dot(kd,this.normal)<0?-1:1,kr=O;if(!kr&&this.join==="miter"){var Sn=$t;Sn>this.miterLimit&&(kr=!0)}kr?(I.push(this.normal[0],this.normal[1],0),I.push(gr[0],gr[1],0),w.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),w.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,N.Z)(this.lastFlip!==-dr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),gp(l0,mp),$r.copy(this.normal,l0),I.push(this.normal[0],this.normal[1],0),w.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(w,I,o,gr,$t,this.totalDistance),S.push.apply(S,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),dr=-1,$r.copy(this.normal,gr),x+=2),this.lastFlip=dr}else{if(gp(this.normal,ru),R){var Oe=$r.create(),it=$r.create();$r.sub(it,ru,this.normal),$r.add(Oe,ru,this.normal),I.push(it[0],it[1],0),I.push(Oe[0],Oe[1],0),w.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),w.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,I,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(r,n,t,o,u){var c=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",w=this.join==="bevel",I=_o([o[0],o[1]]),R=_o([t[0],t[1]]);Pd(ru,I,R);var O=0;if(this.dash&&(O=this.lineSegmentDistance(I,R),this.totalDistance+=O),this.normal||(this.normal=$r.create(),gp(this.normal,ru)),!this.started)if(this.started=!0,S){var B=$r.create(),H=$r.create();$r.add(B,this.normal,ru),$r.add(H,this.normal,ru),x.push(H[0],H[1],0),x.push(B[0],B[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-O,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-O,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-O);if(p.push(n+0,n+1,n+2),u){var Ie=_o([u[0],u[1]]);ym(I,Ie)&&$r.add(Ie,I,$r.normalize(Ie,$r.subtract(Ie,I,R))),Pd(mp,Ie,I);var Oe=gm(kd,$r.create(),ru,mp,this.thickness),it=(0,mr.Z)(Oe,2),At=it[0],gt=it[1],$t=$r.dot(kd,this.normal)<0?-1:1,gr=w;if(!gr&&this.join==="miter"){var dr=At;dr>this.miterLimit&&(gr=!0)}gr?(x.push(this.normal[0],this.normal[1],0),x.push(gt[0],gt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,N.Z)(this.lastFlip!==-$t?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),gp(l0,mp),$r.copy(this.normal,l0),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*$t,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(v,x,o,gt,At,this.totalDistance),p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$t=-1,$r.copy(this.normal,gt),c+=2),this.lastFlip=$t}else{if(gp(this.normal,ru),S){var ae=$r.create(),oe=$r.create();$r.sub(oe,ru,this.normal),$r.add(ae,ru,this.normal),x.push(oe[0],oe[1],0),x.push(ae[0],ae[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,N.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2}return c}},{key:"extrusions",value:function(r,n,t,o,u,c){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,c,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,c,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),ro=Q(77160);function GA(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=Us().flatten(e),o=t.vertices,u=t.dimensions,c=[],p=[],v=0;v<o.length/u;v++)u===2?c.push(o[v*2],o[v*2+1],1):c.push(o[v*3],o[v*3+1],1);var x=Us()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,N.Z)(x));for(var S=function(R){var O=t.vertices.slice(R*u,(R+1)*u),B=t.vertices.slice((R+1)*u,(R+2)*u);B.length===0&&(B=t.vertices.slice(0,u));var H=c.length/3;c.push(O[0],O[1],1,B[0],B[1],1,O[0],O[1],0,B[0],B[1],0),p.push.apply(p,(0,N.Z)([0,2,1,2,3,1].map(function(ae){return ae+H})))},w=0;w<n;w++)S(w);return{positions:c,index:p}}function HA(e){var i=Us().flatten(e),r=Us()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function j_(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=Us().flatten(e),u=o.vertices,c=o.dimensions,p=[],v=[],x=[],S=0;S<u.length/c;S++)c===2?p.push(u[S*2],u[S*2+1],1,-1,-1):p.push(u[S*3],u[S*3+1],1,-1,-1),x.push(0,0,1);var w=Us()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,N.Z)(w));for(var I=function(B){var H=o.vertices.slice(B*c,(B+1)*c),ae=o.vertices.slice((B+1)*c,(B+2)*c);ae.length===0&&(ae=o.vertices.slice(0,c));var oe=p.length/5;p.push(H[0],H[1],1,0,0,ae[0],ae[1],1,.1,0,H[0],H[1],0,0,.8,ae[0],ae[1],0,.1,.8);var Ie=WA([ae[0],ae[1],1],[H[0],H[1],0],[H[0],H[1],1],i);x.push.apply(x,(0,N.Z)(Ie).concat((0,N.Z)(Ie),(0,N.Z)(Ie),(0,N.Z)(Ie))),v.push.apply(v,(0,N.Z)([1,2,0,3,2,1].map(function(Oe){return Oe+oe})))},R=0;R<t;R++)I(R);return{positions:p,index:v,normals:x}}function WA(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=ro.create(),o=ro.create(),u=ro.create();n&&(e=Hl(e),i=Hl(i),r=Hl(r));var c=ro.fromValues.apply(ro,(0,N.Z)(e)),p=ro.fromValues.apply(ro,(0,N.Z)(i)),v=ro.fromValues.apply(ro,(0,N.Z)(r));ro.sub(t,v,p),ro.sub(o,c,p),ro.cross(u,t,o);var x=ro.create();return ro.normalize(x,u),x}var Vc,qp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(qp||(qp={}));var Kp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Kp||(Kp={}));function gv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var c=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[c,p,0]});return o}function G_(){return gv(30)}function H_(){return gv(4)}function W_(){return gv(3)}function X_(){return gv(6,1)}function Y_(){return gv(5)}var Ld=(Vc={},(0,Y.Z)(Vc,Kp.CIRCLE,G_),(0,Y.Z)(Vc,Kp.HEXAGON,X_),(0,Y.Z)(Vc,Kp.TRIANGLE,W_),(0,Y.Z)(Vc,Kp.SQUARE,H_),(0,Y.Z)(Vc,Kp.PENTAGON,Y_),(0,Y.Z)(Vc,qp.CYLINDER,G_),(0,Y.Z)(Vc,qp.HEXAGONCOLUMN,X_),(0,Y.Z)(Vc,qp.TRIANGLECOLUMN,W_),(0,Y.Z)(Vc,qp.SQUARECOLUMN,H_),(0,Y.Z)(Vc,qp.PENTAGONCOLUMN,Y_),Vc),c0={};function Qp(e){var i=T(e.coordinates);return{vertices:[].concat((0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i),(0,N.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function $_(e){var i=T(e.coordinates),r=V_(i);return{vertices:[].concat((0,N.Z)(r),(0,N.Z)(r),(0,N.Z)(r),(0,N.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function _m(e){var i=e.shape,r=ew(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function XA(e){var i=T(e.coordinates);return{vertices:(0,N.Z)(i),indices:[0],size:i.length}}function Jp(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new jA({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var c=0;c<o.length;c++){var p=o[c],v=u[c];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(w){t.extrude(w)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function YA(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=qA(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function $A(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=KA(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function q_(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function Rd(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function qA(e){var i=0;if(e.length<2)return{results:e,totalDistance:0};var r=[],n=Rd(e[0],i);r.push(n);for(var t=1;t<e.length-1;t++){var o=q_(e[t-1],e[t]);i+=o;var u=Rd(e[t],i);r.push(u),r.push(u)}var c=q_(e[e.length-2],e[e.length-1]);return i+=c,r.push(Rd(e[e.length-1],i)),{results:r,totalDistance:i}}function KA(e){if(e.length<2)return{results:e};var i=[],r=Rd(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=Rd(e[n]);i.push(t),i.push(t)}return i.push(Rd(e[e.length-1])),{results:i}}function yv(e){var i=e.coordinates,r=Us().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Us()(n,o,t),vertices:n,size:t}}function QA(e){var i=e.coordinates,r=Us().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Us()(n,o,t),vertices:JA(n),size:t+4}}function JA(e){for(var i=[],r=k(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],c=e[o+1];i.push.apply(i,[u,c,0].concat((0,N.Z)(n),[t]))}return i}function K_(e){var i=e.coordinates,r=j_(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function Q_(e){var i=e.shape,r=rw(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function Od(e){var i=e.coordinates,r=[].concat((0,N.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,N.Z)(i[1]),[0,1,0],(0,N.Z)(i[0]),[0,0,1],(0,N.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function f0(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(v){t.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==r-1&&o.push.apply(o,(0,N.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},c=0;c<r;c++)u(c);return{vertices:t,indices:o,size:7}}function J_(e){var i=e.coordinates;i.length===2&&i.push(0);var r=h0(-1,1),n=h0(1,1),t=h0(-1,-1),o=h0(1,-1),u=[].concat((0,N.Z)(i),(0,N.Z)(r),(0,N.Z)(i),(0,N.Z)(t),(0,N.Z)(i),(0,N.Z)(o),(0,N.Z)(i),(0,N.Z)(n)),c=[0,1,2,3,0,2];return{vertices:u,indices:c,size:5}}function ew(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(c0&&c0[e])return c0[e];var r=Ld[e]?Ld[e]():Ld.cylinder(),n=j_([r],i);return c0[e]=n,n}function yR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,c,p=vec3.create(),v=vec3.create(),x=vec3.create(),S=0,w=i.length;S<w;S+=3){o=i[S+0]*3,u=i[S+1]*3,c=i[S+2]*3;var I=[e[o],e[o+1]],R=[e[u],e[u+1]],O=[e[c],e[c+1]];n&&(I=lngLatToMeters(I),R=lngLatToMeters(R),O=lngLatToMeters(O));var B=I,H=_slicedToArray(B,2),ae=H[0],oe=H[1],Ie=vec3.fromValues(ae,oe,e[o+2]),Oe=R,it=_slicedToArray(Oe,2),At=it[0],gt=it[1],$t=vec3.fromValues(At,gt,e[u+2]),gr=O,dr=_slicedToArray(gr,2),kr=dr[0],Sn=dr[1],Vn=vec3.fromValues(kr,Sn,e[c+2]);vec3.sub(p,Vn,$t),vec3.sub(v,Ie,$t),vec3.cross(x,p,v),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[c]+=p[0],t[c+1]+=p[1],t[c+2]+=p[2]}return tw(t),t}function tw(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function _R(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function rw(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Ld[e]?Ld[e]():Ld.circle(),n=i.indexOf(e)===-1?HA([r]):GA([r]);return n}function h0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function xR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function bR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function nw(e){var i=iw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aw=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ow=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,sw=function(e){(0,sr.Z)(r,e);var i=nw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.baseColor,p=c===void 0?"rgb(16,16,16)":c,v=t.brightColor,x=v===void 0?"rgb(255,176,38)":v,S=t.windowColor,w=S===void 0?"rgb(30,60,89)":S,I=t.time,R=I===void 0?0:I,O=t.sweep,B=O===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:O;return{u_cityCenter:B.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*B.sweepRadius,u_circleSweep:B.enable?1:0,u_circleSweepColor:Re(B.sweepColor).slice(0,3),u_circleSweepSpeed:B.sweepSpeed,u_opacity:u,u_baseColor:Re(p),u_brightColor:Re(x),u_windowColor:Re(w),u_time:this.layer.getLayerAnimateTime()||R}}},{key:"calCityGeo",value:function(){var t=(0,mr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(c+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([c,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var S=c-o,w=p-u;this.cityCenter=[(c+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(S,2)+Math.pow(w,2))/4}}},{key:"initModels",value:function(t){this.calCityGeo(),this.startModelAnimate(),this.buildModels(t)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:ow,fragmentShader:aw,triangulation:K_,depth:{enable:!0},cull:{enable:!0,face:X.BACK}}).then(function(o){t([o])}).catch(function(o){console.warn(o),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?10:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(xa);function uw(e){var i=lw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cw=function(e){(0,sr.Z)(r,e);var i=uw(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","CityBuildingLayer"),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this;this.layerModel=new sw(this),this.layerModel.initModels(function(o){t.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Kf);function fw(e){var i=hw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,dw=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vw=function(e){(0,sr.Z)(r,e);var i=fw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,c=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:c||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:pw,fragmentShader:dw,triangulation:Q_,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:mn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(xa);function mw(e){var i=gw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yw=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,_w=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,xw=function(e){(0,sr.Z)(r,e);var i=mw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,c=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:c||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:yw,fragmentShader:_w,triangulation:_m,primitive:X.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:mn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(xa);function bw(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,c=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,S=0;S<o;S++){var w=S-c;n.push(w/c,-x/p,0),t.push(S/e),t.push(1-v/i)}for(var I=0;I<i;I++)for(var R=0;R<e;R++){var O=R+o*I,B=R+o*(I+1),H=R+1+o*(I+1),ae=R+1+o*I;r.push(O,B,ae),r.push(B,H,ae)}return{vertices:n,indices:r,uvs:t}}var e1,t1;function Ew(e){var i=Sw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cw=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Aw=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,ww=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Tw=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Mw=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,Iw=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,r1=(e1=(0,_n.b2)(),e1(t1=function(e){(0,sr.Z)(r,e);var i=Ew(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"render",value:function(){var t=this,o=this.rendererService,u=o.clear,c=o.useFramebuffer;c(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R,O,B;return Et().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return p=this.rendererService,v=p.createFramebuffer,x=p.getViewportSize,S=p.createTexture2D,w=this.styleAttributeService.getLayerStyleAttribute("shape"),I=(w==null||(c=w.scale)===null||c===void 0?void 0:c.field)||"heatmap",this.shapeType=I,ae.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=ae.sent,this.colorModel=I==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),R=x(),O=R.width,B=R.height,this.heatmapFramerBuffer=v({color:S({width:Math.floor(O/4),height:Math.floor(B/4),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return ae.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:mn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?1:u;return[c]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Ct.Z)(Et().mark(function o(){var u;return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=J_,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:Iw,fragmentShader:Mw,triangulation:J_,depth:{enable:!1},cull:{enable:!0,face:kc(this.mapService.version)},blend:{enable:!0,func:{srcRGB:X.ONE,srcAlpha:1,dstRGB:X.ONE,dstAlpha:1}}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,c=t.maskInside,p=c===void 0?!0:c;this.shaderModuleService.registerModule("heatmapColor",{vs:Tw,fs:ww});var v=this.shaderModuleService.getModule("heatmapColor"),x=v.vs,S=v.fs,w=v.uniforms,I=this.rendererService,R=I.createAttribute,O=I.createElements,B=I.createBuffer,H=I.createModel;return H({vs:x,fs:S,attributes:{a_Position:R({buffer:B({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:X.FLOAT}),size:3}),a_Uv:R({buffer:B({data:[0,1,1,1,0,0,1,0],type:X.FLOAT}),size:2})},uniforms:(0,U.Z)({},w),depth:{enable:!1},blend:this.getBlend(),elements:O({data:[0,2,1,2,3,1],type:X.UNSIGNED_INT,count:6}),stencil:Zt(u,p)})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,c=o.intensity,p=c===void 0?10:c,v=o.radius,x=v===void 0?5:v;(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p}})}},{key:"drawColorMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity;(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,c=pf();du(c,this.cameraService.getViewProjectionMatrixUncentered()),(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,N.Z)(c)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,c=t.maskInside,p=c===void 0?!0:c,v=this.rendererService.getViewportSize,x=v(),S=x.width,w=x.height,I=bw(S/4,w/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Aw,fs:Cw});var R=this.shaderModuleService.getModule("heatmap3dColor"),O=R.vs,B=R.fs,H=R.uniforms,ae=this.rendererService,oe=ae.createAttribute,Ie=ae.createElements,Oe=ae.createBuffer,it=ae.createModel;return it({vs:O,fs:B,attributes:{a_Position:oe({buffer:Oe({data:I.vertices,type:X.FLOAT}),size:3}),a_Uv:oe({buffer:Oe({data:I.uvs,type:X.FLOAT}),size:2})},primitive:X.TRIANGLES,uniforms:(0,U.Z)({},H),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:X.SRC_ALPHA,srcAlpha:1,dstRGB:X.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ie({data:I.indices,type:X.UNSIGNED_INT,count:I.indices.length}),stencil:Zt(u,p)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,c=Fe(u);this.colorTexture=t({data:new Uint8Array(c.data),width:c.width,height:c.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1})}}]),r}(xa))||t1);function kw(e){var i=Pw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lw=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Rw=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ow=function(e){(0,sr.Z)(r,e);var i=kw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,c=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:c||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:Rw,fragmentShader:Lw,triangulation:Q_,depth:{enable:!1},primitive:X.TRIANGLES,blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:mn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(xa),Dw={heatmap:r1,heatmap3d:r1,grid:vw,grid3d:xw,hexagon:Ow},Fw=Dw;function Bw(e){var i=Nw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zw=function(e){(0,sr.Z)(r,e);var i=Bw(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","HeatMapLayer"),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new Fw[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"renderModels",value:function(){var t=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return t.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:t.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),c=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(c==null?void 0:c.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(c==null?void 0:c.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),r}(Kf);function Zw(e){var i=Uw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vw=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,jw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Gw=function(e){(0,sr.Z)(r,e);var i=Zw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,c=u===void 0?!0:u,p=t.clampHigh,v=p===void 0?!0:p,x=t.noDataValue,S=x===void 0?-9999999:x,w=t.domain,I=w===void 0?[0,1]:w,R=t.rampColors,O=t.pixelConstant,B=O===void 0?0:O,H=t.pixelConstantR,ae=H===void 0?256*256:H,oe=t.pixelConstantG,Ie=oe===void 0?256:oe,Oe=t.pixelConstantB,it=Oe===void 0?1:Oe,At=t.pixelConstantRGB,gt=At===void 0?.1:At;return(0,pt.isEqual)(this.rampColors,R)||(this.updateColorTexture(),this.rampColors=R),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:B,u_pixelConstantR:ae,u_pixelConstantG:Ie,u_pixelConstantB:it,u_pixelConstantRGB:gt,u_domain:I,u_clampLow:c,u_clampHigh:typeof v!="undefined"?v:c,u_noDataValue:S,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(t){var o=this,u=this.layer.getLayerConfig(),c=u.mask,p=c===void 0?!1:c,v=u.maskInside,x=v===void 0?!0:v,S=u.rampColorsData,w=u.rampColors,I=this.layer.getSource(),R=this.rendererService.createTexture2D;this.texture=R({height:0,width:0}),I.data.images.then(function(B){o.texture=R({data:B[0],width:B[0].width,height:B[0].height}),o.layerService.reRender()});var O=S||Fe(w);this.colorTexture=R({data:O.data,width:O.width,height:O.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:jw,fragmentShader:Vw,triangulation:Od,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(p,x)}).then(function(B){t([B])}).catch(function(B){console.warn(B),t([])})}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,c=Fe(u);this.colorTexture=t({data:c.data,width:c.width,height:c.height,flipY:!1})}}]),r}(xa);function Hw(e){var i=Ww();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Yw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,$w=function(e){(0,sr.Z)(r,e);var i=Hw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(t){var o=this,u=this.layer.getLayerConfig(),c=u.mask,p=c===void 0?!1:c,v=u.maskInside,x=v===void 0?!0:v,S=this.layer.getSource(),w=this.rendererService.createTexture2D;if(this.texture=w({height:0,width:0}),ts){var I=this.layerService.sceneService.getSceneConfig().canvas,R=I.createImage();R.crossOrigin="anonymous",R.src=S.data.originData,R.onload=function(){o.texture=w({data:R,width:R.width,height:R.height}),o.layerService.reRender()}}else S.data.images.then(function(O){o.texture=w({data:O[0],width:O[0].width,height:O[0].height,mag:X.LINEAR,min:X.LINEAR}),o.layerService.reRender()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:Yw,fragmentShader:Xw,triangulation:Od,primitive:X.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:Zt(p,x)}).then(function(O){t([O])}).catch(function(O){console.warn(O),t([])})}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(xa);function qw(e){var i=Kw();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qw=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,Jw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,e3=function(e){(0,sr.Z)(r,e);var i=qw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.opacity,c=o.clampLow,p=c===void 0?!0:c,v=o.clampHigh,x=v===void 0?!0:v,S=o.noDataValue,w=S===void 0?-9999999:S,I=o.domain,R=I===void 0?[0,1]:I,O=o.colorTexture,B=O===void 0?t({height:0,width:0}):O,H=o.pixelConstant,ae=H===void 0?0:H,oe=o.pixelConstantR,Ie=oe===void 0?256*256:oe,Oe=o.pixelConstantG,it=Oe===void 0?256:Oe,At=o.pixelConstantB,gt=At===void 0?1:At,$t=o.pixelConstantRGB,gr=$t===void 0?.1:$t;return{u_opacity:u||1,u_texture:this.texture,u_pixelConstant:ae,u_pixelConstantR:Ie,u_pixelConstantG:it,u_pixelConstantB:gt,u_pixelConstantRGB:gr,u_domain:R,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:w,u_colorTexture:B}}},{key:"initModels",value:function(t){var o=this,u=this.layer.getLayerConfig(),c=u.mask,p=c===void 0?!1:c,v=u.maskInside,x=v===void 0?!0:v,S=this.layer.getSource(),w=this.rendererService.createTexture2D;this.texture=w({height:0,width:0}),S.data.images.then(function(I){o.texture=w({data:I[0],width:I[0].width,height:I[0].height}),o.layerService.reRender()}),this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:Jw,fragmentShader:Qw,triangulation:Od,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(p,x)}).then(function(I){t([I])}).catch(function(I){console.warn(I),t([])})}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(xa),t3={image:$w,dataImage:Gw,tileDataImage:e3},r3=t3;function n3(e){var i=i3();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n1=function(e){(0,sr.Z)(r,e);var i=n3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","ImageLayer"),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new r3[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{},dataImage:{},tileDataImage:{}};return o[t]}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="dataImage"?"dataImage":u==="image"?"image":u==="tileDataImage"?"tileDataImage":"image"}}]),r}(Kf);function a3(e,i,r){var n=r.createTexture2D,t=Fe(e),o=n({data:t.data,width:t.width,height:t.height,flipY:!1});return i.map(function(u){u.updateLayerConfig({colorTexture:o})}),o}function xm(e,i,r){e.map(function(n){i==="mask"?n.style({mask:r}):n.updateLayerConfig((0,Y.Z)({},i,r))})}function p0(e,i,r,n){if(Array.isArray(n)){e[r].apply(e,(0,N.Z)(n));return}if(typeof n=="string"){e[r](n);return}var t=o3(e,i.type,r);if(!n)return e[r](t),e;var o=u3(n,r);o.length===0?e[r](t):e[r].apply(e,(0,N.Z)(o))}function o3(e,i,r){switch(r){case"size":return 1;case"color":return"#fff";case"shape":return s3(i,e);default:return""}}function s3(e,i){var r,n=i.getAttribute("shape");if(n&&(r=n.scale)!==null&&r!==void 0&&r.field){var t;return((t=n.scale)===null||t===void 0?void 0:t.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function u3(e,i){if(i==="shape")return typeof e=="string"?[e]:e!=null&&e.field?[e==null?void 0:e.field]:[];var r=e,n=r.field,t=r.values,o=r.callback;return n&&t&&Array.isArray(t)?[n,t]:n&&o?[n,o]:n?[n]:[]}function l3(e,i){var r=i.tileLayer.scaleField,n=Object.keys(r);n.map(function(t){e.scale(t,r[t])})}var i1=["mvt","geojsonvt","testTile"];function c3(e){var i=e.getSource();return i1.includes(i.parser.type)}function d0(e){return i1.indexOf(e)>=0}function a1(e,i){i.map(function(r){var n=cm(e.sceneContainer);r.setContainer(n,e.sceneContainer),r.init()})}function o1(e,i){var r,n=i.getAttribute("shape");if(n&&(r=n.scale)!==null&&r!==void 0&&r.field){var t;return((t=n.scale)===null||t===void 0?void 0:t.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function s1(e,i){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return i;default:return i}}function ER(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function bm(e){return e.layerIDList.length===e.loadedLayers}function f3(e){var i=e.children;return i.filter(function(r){return bm(r)}).length===i.length}function h3(e){var i=e.parent;return i?bm(i):!0}function p3(e,i){var r=window.setInterval(function(){var n=bm(e),t=f3(e),o=h3(e);n&&t&&o&&(i(),window.clearInterval(r))},36)}function d3(e,i){e.isVisible?i():p3(e,function(){i()})}function v3(e){var i=!0;return e.map(function(r){r.type!=="PointLayer"&&(i=!1)}),i}function m3(e,i,r){if(i.length!==0){if(v3(i)){xm(i,"visible",e.isVisible),r.reRender();return}d3(e,function(){xm(i,"visible",e.isVisible),r.reRender()})}}function g3(e,i,r,n){var t,o,u,c,p=(e==null||(t=e.bboxPolygon)===null||t===void 0?void 0:t.bbox)||[0,0,10,-10],v=(0,mr.Z)(p,4),x=v[0],S=x===void 0?0:x,w=v[1],I=w===void 0?0:w,R=v[2],O=R===void 0?10:R,B=v[3],H=B===void 0?-10:B,ae=i.lngLatToContainer([S,I]),oe=i.lngLatToContainer([O,H]),Ie=oe.x-ae.x,Oe=ae.y-oe.y,it=[(r-ae.x)/Ie,(n-oe.y)/Oe],At=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,gt=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,$t=Math.floor(it[0]*At),gr=Math.floor(it[1]*gt),dr=Math.max(0,gr-1)*At+$t,kr=e==null||(c=e.data)===null||c===void 0?void 0:c.data[dr];return kr}function SR(e,i,r){var n=r.readPixels,t=r.getContainer,o=e*DOM.DPR,u=i*DOM.DPR,c=y3(t()),p=c.width,v=c.height;if(p*=DOM.DPR,v*=DOM.DPR,o>p-1*DOM.DPR||o<0||u>v-1*DOM.DPR||u<0)return!1;var x=n({x:Math.floor(o),y:Math.floor(v-(i+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return x}function y3(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function _3(e){var i=x3();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function x3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b3=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,E3=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;


#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

void main() {
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // if(u_coord > 0.0) { // \u4F7F\u7528\u7ECF\u7EAC\u5EA6\u5750\u6807
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
  // } else { // \u4F7F\u7528\u504F\u79FB\u5750\u6807
  //   vec2 pointPos = a_Position.xy;
  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   tileWorld.xy += pointOffset;

  //   tileWorld.xy += offset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     tileWorld.w *= u_PixelsPerMeter.z;
  //   }
  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}
`,S3=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,C3=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_size;

#pragma include "projection"

void main() {

  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
}
`,Em=function(e){(0,sr.Z)(r,e);var i=_3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.usage,p=t.color,v=p===void 0?"#fff":p,x=t.size,S=x===void 0?1:x;return{u_opacity:Number(u),u_color:c==="basemap"?Re(v):[0,0,0,0],u_size:c==="basemap"?S:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R;return Et().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:c=this.layer.getLayerConfig(),p=c.mask,v=p===void 0?!1:p,x=c.maskInside,S=x===void 0?!0:x,w=c.depth,I=w===void 0?!1:w,R=c.usage,this.layer.triangulation=Jp,this.layer.buildLayerModel({moduleName:"lineTile_"+R,vertexShader:R==="basemap"?C3:E3,fragmentShader:R==="basemap"?S3:b3,triangulation:Jp,blend:this.getBlend(),depth:{enable:I},stencil:Zt(v,S),pick:R!=="basemap"}).then(function(H){u([H])}).catch(function(H){console.warn(H),u([])});case 3:case"end":return B.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(c){var p=c.size,v=p===void 0?1:p;return Array.isArray(v)?[v[0],v[1]]:[v,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(c,p,v,x,S){return S}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(c,p,v){return[v[4]]}}})}}]),r}(xa);function A3(e){var i=w3();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function w3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T3=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,M3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

varying vec4 v_color;

void main() {
  v_color = a_Color; 

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}
`,I3=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,k3=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}`,P3=function(e){(0,sr.Z)(r,e);var i=A3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.usage,p=t.color,v=p===void 0?"#fff":p;return{u_opacity:(0,pt.isNumber)(u)?u:1,u_color:c==="basemap"?Re(v):[0,0,0,0]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=o.usage;this.layer.buildLayerModel({moduleName:"lineTileSimpleNormal_"+x,vertexShader:x==="basemap"?k3:M3,fragmentShader:x==="basemap"?I3:T3,triangulation:$A,primitive:X.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v),pick:!1}).then(function(S){t([S])}).catch(function(S){console.warn(S),t([])})}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(xa);function L3(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=R3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function R3(e,i){if(!!e){if(typeof e=="string")return u1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u1(e,i)}}function u1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var O3=function(){function e(i,r,n){(0,vt.Z)(this,e),(0,Y.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,xt.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,c){this.boxCells[u].push(c)}},{key:"queryHitTest",value:function(r,n,t,o,u,c){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return c?p.filter(c):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,x,c),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,c,p,v){var x=p.seenUids,S=this.boxCells[u];if(S!==null){var w=this.bboxes,I=L3(S),R;try{for(I.s();!(R=I.n()).done;){var O=R.value;if(!x.box[O]){x.box[O]=!0;var B=O*4;if(r<=w[B+2]&&n<=w[B+3]&&t>=w[B+0]&&o>=w[B+1]&&(!v||v(this.boxKeys[O]))){if(p.hitTest)return c.push(!0),!0;c.push({key:this.boxKeys[O],x1:w[B],y1:w[B+1],x2:w[B+2],y2:w[B+3]})}}}}catch(H){I.e(H)}finally{I.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,c,p,v){for(var x=this.convertToXCellCoord(r),S=this.convertToYCellCoord(n),w=this.convertToXCellCoord(t),I=this.convertToYCellCoord(o),R=x;R<=w;R++)for(var O=S;O<=I;O++){var B=this.xCellCount*O+R;if(u.call(this,r,n,t,o,B,c,p,v))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),D3=O3,l1=function(){function e(i,r){(0,vt.Z)(this,e),(0,Y.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new D3(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,xt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=dE(n,t,0,1),u=hg(),c=sv.apply(Ae,(0,N.Z)(r));return tm(u,o,c),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function c1(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=F3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function F3(e,i){if(!!e){if(typeof e=="string")return f1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f1(e,i)}}function f1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function h1(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function p1(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var c=i[u].advance*o.scale,p=(e[n].x+c)*t,v=r;v<=n;v++)e[v].x-=p}}function d1(e,i,r,n,t,o,u){var c=(i-r)*t,p=(-n*u+.5)*o,v=c1(e),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.x+=c,S.y+=p}}catch(w){v.e(w)}finally{v.f()}}function B3(e,i,r,n,t,o,u){var c=-8,p=0,v=c,x=0,S=e.positionedGlyphs,w=o==="right"?1:o==="left"?0:.5,I=S.length;r.forEach(function(ae){if(ae.split("").forEach(function(Ie){var Oe=i[Ie],it=0;Oe&&(S.push({glyph:Ie,x:p,y:v+it,vertical:!1,scale:1,metrics:Oe}),p+=Oe.advance+u)}),S.length!==I){var oe=p-u;x=Math.max(oe,x),p1(S,i,I,S.length-1,w)}p=0,v-=n+5});var R=h1(t),O=R.horizontalAlign,B=R.verticalAlign;d1(S,w,O,B,x,n,r.length);var H=v-c;e.top+=-B*H,e.bottom=e.top-H,e.left+=-O*x,e.right=e.left+x}function N3(e,i,r,n,t,o,u){var c=-8,p=0,v=c,x=0,S=e.positionedGlyphs,w=o==="right"?1:o==="left"?0:.5,I=S.length;r.forEach(function(ae){var oe=i[ae],Ie=0;if(oe&&(S.push({glyph:ae,x:oe.advance/2,y:v+Ie,vertical:!1,scale:1,metrics:oe}),p+=oe.advance+u),S.length!==I){var Oe=p-u;x=Math.max(Oe,x),p1(S,i,I,S.length-1,w)}p=0,v-=n+5});var R=h1(t),O=R.horizontalAlign,B=R.verticalAlign;d1(S,w,O,B,x,n,r.length);var H=v-c;e.top+=-B*H,e.bottom=e.top-H,e.left+=-O*x,e.right=e.left+x}function v1(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],c=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return c?N3(x,i,p,r,n,t,o):B3(x,i,p,r,n,t,o),v.length?x:!1}function m1(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=c1(t),c;try{for(u.s();!(c=u.n()).done;){var p=c.value,v=p.metrics,x=4,S=v.advance*p.scale/2,w=r?[p.x+S,p.y]:[0,0],I=r?[0,0]:[p.x+S+i[0],p.y+i[1]],R=(0-x)*p.scale-S+I[0],O=(0-x)*p.scale+I[1],B=R+v.width*p.scale,H=O+v.height*p.scale,ae={x:R,y:O},oe={x:B,y:O},Ie={x:R,y:H},Oe={x:B,y:H};o.push({tl:ae,tr:oe,bl:Ie,br:Oe,tex:v,glyphOffset:w})}}catch(it){u.e(it)}finally{u.f()}return o}function z3(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Z3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function Z3(e,i){if(!!e){if(typeof e=="string")return g1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g1(e,i)}}function g1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function U3(e){var i=V3();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,_1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,x1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;

uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;
uniform vec4 u_color;

void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
}
`,b1=`#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_size;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "projection"

void main() {
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = u_size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;

}
`;function E1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(c,p){n.push.apply(n,(0,N.Z)(u).concat([c.tex.x,c.tex.y+c.tex.height,c.tl.x,c.tl.y],(0,N.Z)(u),[c.tex.x+c.tex.width,c.tex.y+c.tex.height,c.tr.x,c.tr.y],(0,N.Z)(u),[c.tex.x+c.tex.width,c.tex.y,c.br.x,c.br.y],(0,N.Z)(u),[c.tex.x,c.tex.y,c.bl.x,c.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var S1=function(e){(0,sr.Z)(r,e);var i=U3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"glyphInfoMap",{}),(0,Y.Z)((0,Le.Z)(n),"currentZoom",-1),(0,Y.Z)((0,Le.Z)(n),"textureHeight",0),(0,Y.Z)((0,Le.Z)(n),"textCount",0),(0,Y.Z)((0,Le.Z)(n),"preTextStyle",{}),(0,Y.Z)((0,Le.Z)(n),"buildModels",function(){var c=(0,Ct.Z)(Et().mark(function p(v){var x,S;return Et().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:n.mapping(),x=n.layer.getLayerConfig(),S=x.usage,n.layer.buildLayerModel({moduleName:"pointTileText_"+S,vertexShader:S==="basemap"?b1:_1,fragmentShader:S==="basemap"?x1:y1,triangulation:E1.bind((0,Le.Z)(n)),depth:{enable:!1},blend:n.getBlend(),pick:S!=="basemap"}).then(function(R){v([R])}).catch(function(R){console.warn(R),v([])});case 3:case"end":return I.stop()}},p)}));return function(p){return c.apply(this,arguments)}}()),(0,Y.Z)((0,Le.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.stroke,p=c===void 0?"#fff":c,v=t.strokeWidth,x=v===void 0?0:v,S=t.textAnchor,w=S===void 0?"center":S,I=t.textAllowOverlap,R=I===void 0?!1:I,O=t.halo,B=O===void 0?.5:O,H=t.gamma,ae=H===void 0?2:H,oe=t.usage,Ie=t.color,Oe=Ie===void 0?"#fff":Ie,it=t.size,At=it===void 0?1:it,gt=this.fontService,$t=gt.canvas,gr=gt.mapping;return Object.keys(gr).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(gr).length),this.preTextStyle={textAnchor:w,textAllowOverlap:R},{u_opacity:(0,pt.isNumber)(u)?u:1,u_stroke_width:(0,pt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:B,u_gamma_scale:ae,u_sdf_map_size:[$t.width,$t.height],u_color:oe==="basemap"?Re(Oe):[0,0,0,0],u_size:oe==="basemap"?At:1}}},{key:"initModels",value:function(t){this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,c=u===void 0?"center":u,p=o.textAllowOverlap,v=p===void 0?!0:p;this.preTextStyle={textAnchor:c,textAllowOverlap:v},this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:mn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(c,p,v){return[v[5],v[6]]}}}),o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(c){var p=c.size,v=p===void 0?12:p;return Array.isArray(v)?[v[0]]:[v]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:mn.Attribute,descriptor:{name:"a_tex",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(c,p,v){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return fs(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,c=t.fontFamily,p=c===void 0?"sans-serif":c,v=this.layer.getEncodedData(),x=[];v.forEach(function(S){var w=S.shape,I=w===void 0?"":w;I=I.toString();var R=z3(I),O;try{for(R.s();!(O=R.n()).done;){var B=O.value;x.indexOf(B)===-1&&x.push(B)}}catch(H){R.e(H)}finally{R.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var t=this,o=this.fontService.mapping,u=this.layer.getLayerConfig(),c=u.spacing,p=c===void 0?2:c,v=u.textAnchor,x=v===void 0?"center":v,S=this.layer.getEncodedData();this.glyphInfo=S.map(function(w){var I=w.shape,R=I===void 0?"":I,O=w.id,B=w.size,H=B===void 0?1:B,ae=w.textOffset,oe=ae===void 0?[0,0]:ae,Ie=v1(R.toString(),o,H,x,"left",p,oe,!1),Oe=m1(Ie,oe,!1);return w.shaping=Ie,w.glyphQuads=Oe,w.centroid=T(w.coordinates),w.originCentroid=w.version==="GAODE2.x"?T(w.originCoordinates):w.originCentroid=w.centroid,t.glyphInfoMap[O]={shaping:Ie,glyphQuads:Oe,centroid:T(w.coordinates)},w})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,c=u===void 0?[4,4]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),S=x.width,w=x.height,I=new l1(S,w),R=this.glyphInfo.filter(function(O){var B=O.shaping,H=O.id,ae=H===void 0?0:H,oe=O.version==="GAODE2.x"?O.originCentroid:O.centroid,Ie=O.size,Oe=Ie/24,it=t.mapService.lngLatToContainer(oe),At=I.placeCollisionBox({x1:B.left*Oe-c[0],x2:B.right*Oe+c[0],y1:B.top*Oe-c[1],y2:B.bottom*Oe+c[1],anchorPointX:it.x,anchorPointY:it.y}),gt=At.box;return gt&&gt.length?(I.insertCollisionBox(gt,ae),!0):!1});R.forEach(function(O){t.glyphInfoMap[O.id]=O})}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:X.LINEAR,min:X.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.usage;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText_"+u,vertexShader:u==="basemap"?b1:_1,fragmentShader:u==="basemap"?x1:y1,triangulation:E1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:u!=="basemap"}).then(function(c){t.layer.models=[c],t.layerService.throttleRenderLayers()}).catch(function(c){console.warn(c),t.layer.models=[]})}}]),r}(xa);function j3(e){var i=G3();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H3=`uniform float u_additive;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));


  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,W3=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width));
  offset = project_pixel(offset);

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

// if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
// } else {

  // vec2 pointPos = a_Position.xy;
  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  // world.xy += offset;
  // world.xy += pointOffset;

  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   // Needs to be divided with project_uCommonUnitsPerMeter
  //   world.w *= u_PixelsPerMeter.z;
  // }

  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
// }

 
  setPickingColor(a_PickingColor);


}
`,v0=function(e){(0,sr.Z)(r,e);var i=j3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.strokeOpacity,p=c===void 0?1:c,v=t.strokeWidth,x=v===void 0?0:v,S=t.stroke,w=S===void 0?"rgba(0,0,0,0)":S,I=t.blend;return{u_additive:I==="additive"?1:0,u_opacity:Number(u),u_stroke_opacity:Number(p),u_stroke_width:Number(x),u_stroke_color:this.getStrokeColor(w)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qp)}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.workerEnabled,c=u===void 0?!1:u,p=o.usage;this.layer.triangulation=Qp,this.layer.buildLayerModel({moduleName:"pointTile_"+p,vertexShader:W3,fragmentShader:H3,triangulation:Qp,depth:{enable:!1},cull:{enable:!0,face:kc(this.mapService.version)},blend:this.getBlend(),workerEnabled:c,workerOptions:{modelType:"pointTile"},pick:p!=="basemap"}).then(function(v){t([v])}).catch(function(v){console.warn(v),t([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:mn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:mn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.shape,p=c===void 0?2:c,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(xa);function X3(e){var i=Y3();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Y3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $3=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,q3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  // if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
    }
  // } else {
  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   world.xy += pointOffset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     world.w *= u_PixelsPerMeter.z;
  //   }

  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}

`,K3=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,Q3=`attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}`,C1=function(e){(0,sr.Z)(r,e);var i=X3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.usage,p=t.color,v=p===void 0?"#fff":p;return{u_opacity:u,u_color:c==="basemap"?Re(v):[0,0,0,0]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=o.usage;this.layer.triangulation=yv,this.layer.buildLayerModel({moduleName:"polygonTile_"+x,vertexShader:x==="basemap"?Q3:q3,fragmentShader:x==="basemap"?K3:$3,triangulation:yv,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v),pick:x!=="basemap"}).then(function(S){t([S])}).catch(function(S){console.warn(S),t([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(xa);function J3(e){var i=eT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function eT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tT=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,rT=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,A1=function(e){(0,sr.Z)(r,e);var i=J3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?0:o,c=t.color,p=c===void 0?"#000":c;return{u_opacity:(0,pt.isNumber)(u)?u:0,u_color:Re(p)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){return Et().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:rT,fragmentShader:tT,triangulation:yv,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:X.ALWAYS,ref:1,mask:255},opFront:{fail:X.REPLACE,zfail:X.REPLACE,zpass:X.REPLACE}},pick:!1}).then(function(v){u([v])}).catch(function(v){console.warn(v),u([])});case 1:case"end":return p.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(xa);function nT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=iT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function iT(e,i){if(!!e){if(typeof e=="string")return w1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w1(e,i)}}function w1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function aT(e){var i=oT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function oT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m0=function(e){(0,sr.Z)(r,e);var i=aT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"needListen",!0),(0,Y.Z)((0,Le.Z)(n),"isVector",!0),(0,Y.Z)((0,Le.Z)(n),"isTileLayer",!0),(0,Y.Z)((0,Le.Z)(n),"type",n.layerType||"vectorLayer"),(0,Y.Z)((0,Le.Z)(n),"pickedID",null),(0,Y.Z)((0,Le.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0,n.reRender()}),n}return(0,xt.Z)(r,[{key:"init",value:function(){var t=this,o=this.container.get(Yt.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.type==="PointLayer"&&(this.iconService=this.container.get(Yt.IIconService),this.fontService=this.container.get(Yt.IFontService)),this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.mapService=this.container.get(Yt.IMapService),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(v){var x=v.attributeName,S=v.attributeField,w=v.attributeValues,I=v.updateOptions;t.styleAttributeService.updateStyleAttribute(x,{scale:(0,U.Z)({field:S},t.splitValuesAndCallbackInAttribute(w,t.getLayerConfig()[x]))},I)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin);var u=nT(this.plugins),c;try{for(u.s();!(c=u.n()).done;){var p=c.value;p.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(v){u.e(v)}finally{u.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"renderModels",value:function(t){var o=this;return this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},t)}),this}},{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return C1;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();case"MaskLayer":return A1;default:return v0}}},{key:"getLineModel",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;switch(u){case"tileline":case"line":return Em;case"simple":return P3;default:return Em}}},{key:"getPointModel",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,c=t.find(function(v){return v.hasOwnProperty("shape")});if(c){var p=c.shape;return(u==null?void 0:u.indexOf(p))!==-1?v0:S1}else return v0}},{key:"getDefaultConfig",value:function(){return{}}}]),r}(Kf),sT=Q(32676);function uT(e,i,r){r===void 0&&(r={});var n=zt(e),t=zt(i),o=sT.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?Nn(o[0],r.properties):Yn(o,r.properties)}var lT=uT;function cT(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return T1(e);case"FeatureCollection":return fT(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Sm(e);default:throw new Error("unknown GeoJSON type")}}function T1(e){var i={type:"Feature"};return Object.keys(e).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:i[r]=e[r]}}),i.properties=M1(e.properties),i.geometry=Sm(e.geometry),i}function M1(e){var i={};return e&&Object.keys(e).forEach(function(r){var n=e[r];typeof n=="object"?n===null?i[r]=null:Array.isArray(n)?i[r]=n.map(function(t){return t}):i[r]=M1(n):i[r]=n}),i}function fT(e){var i={type:"FeatureCollection"};return Object.keys(e).forEach(function(r){switch(r){case"type":case"features":return;default:i[r]=e[r]}}),i.features=e.features.map(function(r){return T1(r)}),i}function Sm(e){var i={type:e.type};return e.bbox&&(i.bbox=e.bbox),e.type==="GeometryCollection"?(i.geometries=e.geometries.map(function(r){return Sm(r)}),i):(i.coordinates=I1(e.coordinates),i)}function I1(e){var i=e;return typeof i[0]!="object"?i.slice():i.map(function(r){return I1(r)})}var hT=cT;function pT(e,i){i===void 0&&(i={});var r=zt(e);switch(!i.properties&&e.type==="Feature"&&(i.properties=e.properties),r.type){case"Polygon":return dT(r,i);case"MultiPolygon":return vT(r,i);default:throw new Error("invalid poly")}}function dT(e,i){i===void 0&&(i={});var r=zt(e),n=r.coordinates,t=i.properties?i.properties:e.type==="Feature"?e.properties:{};return k1(n,t)}function vT(e,i){i===void 0&&(i={});var r=zt(e),n=r.coordinates,t=i.properties?i.properties:e.type==="Feature"?e.properties:{},o=[];return n.forEach(function(u){o.push(k1(u,t))}),Ri(o)}function k1(e,i){return e.length>1?ki(e,i):xi(e[0],i)}var P1={features:[],featureId:null,vectorTileLayer:null,source:null},ed=function(){function e(i){(0,vt.Z)(this,e),(0,Y.Z)(this,"outSideEventTimer",null),(0,Y.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=i.parent,this.mapService=i.mapService,this.rendererService=i.rendererService;var r=this.parentLayer.getSource();this.zoomOffset=r.parser.zoomOffset||0,this.tilesetManager=r.tileset}return(0,xt.Z)(e,[{key:"createTile",value:function(r,n){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(r,n){var t=n.sourceLayer,o=n.featureId,u=n.transforms,c=u===void 0?[]:u,p=n.layerType,v=n.shape;if(!t)return P1;var x=r.data.layers[t],S=x==null?void 0:x.features;if(Array.isArray(S)&&S.length>0){var w=[];p==="LineLayer"&&v==="simple"?S.map(function(R){var O=hT(R);if(O.geometry.type==="MultiPolygon"){var B,H=pT(O).features;(B=w).push.apply(B,(0,N.Z)(H))}else O.geometry.type==="Polygon"&&(O.geometry.type="MultiLineString"),w.push(O)}):w=S;var I=new Nc({type:"FeatureCollection",features:w},{parser:{type:"geojson",featureId:o,cancelExtent:!0},transforms:c});return{features:w,featureId:o,vectorTileLayer:x,source:I}}else return P1}},{key:"createLayer",value:function(r){var n=r.L7Layer,t=r.tile,o=r.initOptions,u=r.vectorTileLayer,c=r.source,p=r.needListen,v=p===void 0?!0:p,x=o.mask,S=o.color,w=o.layerType,I=o.size,R=o.shape,O=o.usage,B=o.basemapColor,H=o.basemapSize,ae=n||m0,oe=new ae((0,U.Z)({visible:t.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord,needListen:v},this.getLayerInitOption(o)));if(w&&(oe.type=w),oe.isTileLayer=!0,oe.isVector&&O!=="basemap"&&(this.emitEvent([oe]),oe.select(!0)),oe.source(c),p0(oe,this.parentLayer,"shape",R),O!=="basemap"?(l3(oe,this.parentLayer),p0(oe,this.parentLayer,"color",S),p0(oe,this.parentLayer,"size",I)):oe.style({color:B,size:H}),x&&oe.isVector){var Ie=new m0({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[t.bboxPolygon]},{parser:{type:"geojson",cancelExtent:!0}});a1(this.parentLayer,[Ie]),oe.addMaskLayer(Ie)}return this.layers=[oe],oe}},{key:"updateStyle",value:function(r){return""}},{key:"getTile",value:function(r,n){var t=this.mapService.getZoom();return this.tilesetManager.getTileByLngLat(r,n,t)}},{key:"bindVectorEvent",value:function(r){var n=this;r.on("click",function(t){n.eventCache.click=1,n.getFeatureAndEmitEvent("subLayerClick",t)}),r.on("mousemove",function(t){n.eventCache.mousemove=1,n.getFeatureAndEmitEvent("subLayerMouseMove",t)}),r.on("mouseenter",function(t){n.getFeatureAndEmitEvent("subLayerMouseEnter",t)})}},{key:"readRasterTile",value:function(r,n){var t=r.lngLat,o=t.lng,u=t.lat,c=this.getTile(o,u);if(!!c){var p=g3(c,this.mapService,r.x,r.y);r.value=p,this.parentLayer.emit(n,r)}}},{key:"bindRasterEvent",value:function(r){var n=this;r.on("click",function(t){n.eventCache.click=1,n.readRasterTile(t,"subLayerClick")}),r.on("mousemove",function(t){n.eventCache.mousemove=1,n.readRasterTile(t,"subLayerMouseMove")}),r.on("mouseenter",function(t){n.readRasterTile(t,"subLayerMouseMove")})}},{key:"bindCommonEvent",value:function(r){var n=this;r.on("mouseup",function(t){n.eventCache.mouseup=1,n.getFeatureAndEmitEvent("subLayerMouseUp",t)}),r.on("mouseout",function(t){n.getFeatureAndEmitEvent("subLayerMouseOut",t)}),r.on("mousedown",function(t){n.eventCache.mousedown=1,n.getFeatureAndEmitEvent("subLayerMouseDown",t)}),r.on("contextmenu",function(t){n.eventCache.contextmenu=1,n.getFeatureAndEmitEvent("subLayerContextmenu",t)}),r.on("unclick",function(t){return n.handleOutsideEvent("click","subLayerUnClick",r,t)}),r.on("unmouseup",function(t){return n.handleOutsideEvent("mouseup","subLayerUnMouseUp",r,t)}),r.on("unmousedown",function(t){return n.handleOutsideEvent("mousedown","subLayerUnMouseDown",r,t)}),r.on("uncontextmenu",function(t){return n.handleOutsideEvent("contextmenu","subLayerUnContextmenu",r,t)})}},{key:"emitEvent",value:function(r){var n=this;r.map(function(t){t.once("modelLoaded",function(){n.bindVectorEvent(t),n.bindCommonEvent(t)})})}},{key:"emitRasterEvent",value:function(r){var n=this;r.map(function(t){t.once("modelLoaded",function(){n.bindRasterEvent(t),n.bindCommonEvent(t)})})}},{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=Nn(o.coordinates);n===null&&(n=u),n=lT(n,u)}),t&&(n.properties=(0,U.Z)({},t)),n}},{key:"getFeatureAndEmitEvent",value:function(r,n){var t=n.featureId,o=this.getAllFeatures(t);try{n.feature=this.getCombineFeature(o)}catch(u){console.warn("Combine Featuer Err! Return First Feature!"),n.feature=o[0]}this.parentLayer.emit(r,n)}},{key:"getAllFeatures",value:function(r){var n=this.parentLayer.tileLayer.children,t=[];return n.map(function(o){var u=o.getSource();u.data.dataArray.map(function(c){c._id===r&&t.push(c)})}),t}},{key:"getLayerInitOption",value:function(r){var n=(0,U.Z)({},r);return delete n.color,delete n.shape,delete n.size,delete n.coords,delete n.sourceLayer,delete n.coords,n}},{key:"handleOutsideEvent",value:function(r,n,t,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[r]>0?u.eventCache[r]=0:u.getFeatureAndEmitEvent(n,o)},64)}}]),e}();function mT(e){var i=gT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yT=function(e){(0,sr.Z)(r,e);var i=mT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,v=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var x=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:v});return{layers:[x],layerIDList:[x.id]}}}]),r}(ed);function _T(e){var i=xT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function xT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bT=function(e){(0,sr.Z)(r,e);var i=_T(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,v=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var x=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:v,needListen:!1});return{layers:[x],layerIDList:[x.id]}}}]),r}(ed);function ET(e){var i=ST();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function ST(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CT=function(e){(0,sr.Z)(r,e);var i=ET(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,v=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var x=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:v});return{layers:[x],layerIDList:[x.id]}}}]),r}(ed);function AT(e){var i=wT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function wT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TT=function(e){(0,sr.Z)(r,e);var i=AT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,v=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var x=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:v,needListen:!1});return{layers:[x],layerIDList:[x.id]}}}]),r}(ed);function MT(e){var i=IT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function IT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L1=function(e){(0,sr.Z)(r,e);var i=MT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u=new Nc(t.data,{parser:{type:"image",extent:t.bounds}}),c=this.createLayer({L7Layer:n1,tile:t,initOptions:o,source:u});return{layers:[c],layerIDList:[c.id]}}}]),r}(ed);function kT(e){var i=PT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function PT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,RT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,OT=function(e){(0,sr.Z)(r,e);var i=kT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.colorTexture,c=u===void 0?t({data:[],width:0,height:0,flipY:!1}):u,p=o.opacity,v=p===void 0?1:p,x=o.clampLow,S=x===void 0?!0:x,w=o.clampHigh,I=w===void 0?!0:w,R=o.noDataValue,O=R===void 0?-9999999:R,B=o.domain,H=B===void 0?[0,1]:B;return{u_opacity:v||1,u_texture:this.texture,u_domain:H,u_clampLow:S,u_clampHigh:typeof I!="undefined"?I:S,u_noDataValue:O,u_colorTexture:c}}},{key:"initModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=this.layer.getSource(),S=this.rendererService.createTexture2D,w=x.data.dataArray[0];this.texture=S({data:w.data,width:w.width,height:w.height,format:X.LUMINANCE,type:X.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterTileImageData",vertexShader:RT,fragmentShader:LT,triangulation:Od,depth:{enable:!1},stencil:Zt(c,v)}).then(function(I){t([I])}).catch(function(I){console.warn(I),t([])})}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(xa);function DT(e){var i=FT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_channelRMax: 256.;
uniform float u_channelGMax: 256.;
uniform float u_channelBMax: 256.;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  gl_FragColor = vec4(rgb.r/u_channelRMax, rgb.g/u_channelGMax, rgb.b/u_channelBMax, u_opacity);
}`,NT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,R1=function(e){(0,sr.Z)(r,e);var i=DT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"channelRMax",256),(0,Y.Z)((0,Le.Z)(n),"channelGMax",256),(0,Y.Z)((0,Le.Z)(n),"channelBMax",256),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.channelRMax,p=t.channelGMax,v=t.channelBMax;return{u_opacity:u||1,u_texture:this.texture,u_channelRMax:c!==void 0?c:this.channelRMax,u_channelGMax:p!==void 0?p:this.channelGMax,u_channelBMax:v!==void 0?v:this.channelBMax}}},{key:"getRasterData",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I;return Et().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!Array.isArray(u.data)){O.next=4;break}return O.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return O.next=6,u.data;case 6:return c=O.sent,p=c.rasterData,v=c.width,x=c.height,S=c.channelR,w=c.channelG,I=c.channelB,this.channelRMax=S,this.channelGMax=w,this.channelBMax=I,O.abrupt("return",{data:Array.from(p),width:v,height:x});case 17:case"end":return O.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R,O,B,H,ae;return Et().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return c=this.layer.getLayerConfig(),p=c.mask,v=p===void 0?!1:p,x=c.maskInside,S=x===void 0?!0:x,w=this.layer.getSource(),I=this.rendererService.createTexture2D,R=w.data.dataArray[0],Ie.next=6,this.getRasterData(R);case 6:O=Ie.sent,B=O.data,H=O.width,ae=O.height,this.texture=I({data:B,width:H,height:ae,format:X.RGB,type:X.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:NT,fragmentShader:BT,triangulation:Od,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Zt(v,S)}).then(function(Oe){u([Oe])}).catch(function(Oe){console.warn(Oe),u([])});case 12:case"end":return Ie.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(xa);function zT(e){var i=ZT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UT=function(e){(0,sr.Z)(r,e);var i=zT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type",n.layerType),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){return this.layerSource.parser.type==="rasterRgb"?R1:OT}},{key:"getDefaultConfig",value:function(){return{}}}]),r}(Kf);function VT(e){var i=jT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function jT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT=function(e){(0,sr.Z)(r,e);var i=VT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u,c,p,v=o.colorTexture,x=o.opacity,S=o.domain,w=o.clampHigh,I=o.clampLow,R=o.mask,O=t.data;if(!O.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var B=(u=this.parentLayer)===null||u===void 0||(c=u.getSource())===null||c===void 0||(p=c.parser)===null||p===void 0?void 0:p.dataType,H=new UT({visible:t.isVisible,mask:R}).source(O.data,{parser:{type:B==="rgb"?"rasterRgb":"raster",width:O.width,height:O.height,extent:t.bboxPolygon.bbox}}).style({colorTexture:v,opacity:x,domain:S,clampHigh:w,clampLow:I});return this.emitRasterEvent([H]),{layers:[H],layerIDList:[H.id]}}}]),r}(ed);function HT(e){var i=WT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=function(e){(0,sr.Z)(r,e);var i=HT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,xt.Z)(r,[{key:"createTile",value:function(t,o){var u=o.sourceLayer;if(!u)return{layers:[],layerIDList:[]};var c=t.data.layers[u],p=c==null?void 0:c.features;if(p.length===0)return{layers:[],layerIDList:[]};var v=p[0].properties,x=new m0({layerType:"PointLayer",usage:"basemap",needListen:!1}).source([v],{parser:{type:"json",x:"textLng",y:"textLat",cancelExtent:!0}}).shape("key","text").style({size:20,color:"#000",stroke:"#fff",strokeWidth:2}),S=new m0({layerType:"LineLayer",usage:"basemap",needListen:!1}).source({type:"FeatureCollection",features:p},{parser:{type:"geojson",cancelExtent:!0}}).shape("simple").style({color:"#000"});return{layers:[S,x],layerIDList:[S.id,x.id]}}}]),r}(ed);function YT(e,i){switch(e){case"PolygonLayer":return CT;case"LineLayer":return yT;case"PointLayer":return bT;case"MaskLayer":return TT;case"TileDebugLayer":return XT;case"RasterLayer":return Op.includes(i.dataType)?GT:L1;default:return console.warn("Current Tile Not Exist!"),L1}}var O1=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"tileCache",new Map)}return(0,xt.Z)(e,[{key:"hasTile",value:function(r){return!!this.tileCache.has(r.key)}},{key:"addTile",value:function(r){var n;if(this.hasTile(r))return{layers:[],layerIDList:[]};this.tileCache.set(r.key,r);var t=this.tileFactory.createTile(r,this.initOptions);return a1(this.parent,t.layers),(n=r.layerIDList).push.apply(n,(0,N.Z)(t.layerIDList)),this.addChildren(t.layers),t.layers.map(function(o){o.once("modelLoaded",function(){r.layerLoad()})}),t}},{key:"removeTile",value:function(r){this.tileCache.delete(r.key),this.removeChildren(r.layerIDList,!1)}},{key:"addChild",value:function(r){this.children.push(r)}},{key:"addChildren",value:function(r){var n;(n=this.children).push.apply(n,(0,N.Z)(r))}},{key:"removeChildren",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=[],o=[];this.children.filter(function(u){r.includes(u.id)?t.push(u):o.push(u)}),t.map(function(u){return u.destroy(n)}),this.children=o}},{key:"removeChild",value:function(r){var n=this.children.indexOf(r);n>-1&&this.children.splice(n,1),r.destroy()}},{key:"getChildren",value:function(r){return this.children.filter(function(n){return r.includes(n.id)})}},{key:"getChild",value:function(r){return this.children.filter(function(n){return n.id===r})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(r){r.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(r){return this.children.includes(r)}},{key:"initTileFactory",value:function(){var r=this.parent.getSource(),n=YT(this.parent.type,r.parser);this.tileFactory=new n({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}},{key:"getSourceLayer",value:function(r,n){return r==="geojsonvt"?"geojsonvt":r==="testTile"?"testTile":n}},{key:"destroy",value:function(){}}]),e}();function $T(e){var i=qT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function qT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KT=function(e){(0,sr.Z)(r,e);var i=$T(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,Y.Z)((0,Le.Z)(n),"checkConfigList",[]),n.cacheConfig=new Map,n}return(0,xt.Z)(r,[{key:"setConfig",value:function(t,o){this.checkConfigList.includes(t)||this.checkConfigList.push(t),this.cacheConfig.set(t,o)}},{key:"removeConfig",value:function(t){var o=this.checkConfigList.indexOf(t);o>-1&&(this.cacheConfig.delete(t),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(t){var o=this;if(!!t.inited){var u=t.getLayerConfig(),c=[];this.checkConfigList.map(function(p){var v=o.cacheConfig.get(p),x;if(["color","size","shape"].includes(p)){var S;x=(S=t.getAttribute(p))===null||S===void 0?void 0:S.scale}else{if(!(p in u))return;x=u[p]}(0,pt.isEqual)(v,x)||(c.push(p),o.setConfig(p,x))}),c.length>0&&(console.warn("tile config cache update!",c),this.emit("updateConfig",c))}}},{key:"getAttributeScale",value:function(t,o){var u=t.getAttribute(o),c={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var p=u.scale,v=p.field,x=p.values,S=p.callback;c.field=v,c.values=x,c.callback=S}return c}}]),r}(Gf());function QT(e){var i=JT();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function JT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e5=function(e){(0,sr.Z)(r,e);var i=QT(r);function r(n,t,o,u,c){var p;return(0,vt.Z)(this,r),p=i.call(this),(0,Y.Z)((0,Le.Z)(p),"isLastPicked",!1),p.parent=n,p.rendererService=t,p.pickingService=o,p.children=u,p.tileRenderService=c,p}return(0,xt.Z)(r,[{key:"pick",value:function(t,o){var u=this;this.tileRenderService.renderMask(this.parent);var c=t.filter(function(p){return u.parent.needPick(o.type)&&p.inited&&p.isVisible()}).some(function(p){p.hooks.beforePickingEncode.call(),p.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(x){x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),p.renderModels(!0),p.hooks.afterPickingEncode.call();var v=u.pickingService.pickFromPickingFBO(p,o);return v&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:p}),u.pickingService.pickedTileLayers=[u.parent]),v});return this.parent.type!=="RasterLayer"&&!c&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=c,c}},{key:"clearPick",value:function(){this.children.filter(function(t){return t.inited&&t.isVisible()}).map(function(t){t.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(t){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(t)})}},{key:"beforeSelect",value:function(t){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(t)})}},{key:"destroy",value:function(){this.removeAllListeners()}}]),r}(Js.EventEmitter),t5=function(){function e(i){(0,vt.Z)(this,e),this.rendererService=i}return(0,xt.Z)(e,[{key:"render",value:function(r){var n=this;r.filter(function(t){return t.inited}).filter(function(t){return t.isVisible()}).map(function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.masks.length>0&&(n.rendererService.clear({stencil:0,depth:1,framebuffer:null}),t.masks.map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),t.render(),t.hooks.afterRender.call()})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&r.masks.length>0&&(r.hooks.beforeRender.call(),this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(n){n.hooks.beforeRender.call(),n.render(),n.hooks.afterRender.call()}),r.hooks.afterRender.call())}}]),e}(),D1=["size","color","shape"],g0=["opacity","zIndex"],r5=["mask","rampColors","domain","clampHigh","clampLow","pixelConstant","pixelConstantR","pixelConstantG","pixelConstantB","pixelConstantRGB"].concat(g0),n5=["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(g0),i5=["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(g0),a5=["color","shape"].concat(g0),o5={PointLayer:n5,LineLayer:i5,PolygonLayer:a5,RasterLayer:r5,MaskLayer:[],TileDebugLayer:[]};function s5(e){var i=u5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function u5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l5=function(e){(0,sr.Z)(r,e);var i=s5(r);function r(n,t,o,u,c){var p;return(0,vt.Z)(this,r),p=i.call(this),p.parent=n,p.children=n.layerChildren,p.mapService=t,p.rendererService=o,p.transforms=c,p.tileRenderService=new t5(o),p.tilePickService=new e5(n,o,u,p.children,p.tileRenderService),p.tileStyleService=new KT,p.setSubLayerInitOption(),p.setConfigListener(),p.initTileFactory(),p}return(0,xt.Z)(r,[{key:"render",value:function(){this.tileStyleService.checkConfig(this.parent),this.tileRenderService.render(this.children)}},{key:"pickLayers",value:function(t){return this.tilePickService.pick(this.children,t)}},{key:"setSubLayerInitOption",value:function(){var t,o=this.parent.getLayerConfig(),u=o.zIndex,c=u===void 0?0:u,p=o.opacity,v=p===void 0?1:p,x=o.mask,S=x===void 0?!1:x,w=o.stroke,I=w===void 0?"#fff":w,R=o.strokeWidth,O=R===void 0?0:R,B=o.strokeOpacity,H=B===void 0?1:B,ae=o.clampLow,oe=ae===void 0?!0:ae,Ie=o.clampHigh,Oe=Ie===void 0?!0:Ie,it=o.domain,At=it===void 0?[0,1]:it,gt=o.rampColors,$t=gt===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:gt,gr=o.featureId,dr=gr===void 0?"id":gr,kr=o.workerEnabled,Sn=kr===void 0?!1:kr,Vn=o.sourceLayer,Vi=o.pixelConstant,Ba=Vi===void 0?0:Vi,mo=o.pixelConstantR,Co=mo===void 0?256*256:mo,Vo=o.pixelConstantG,Ju=Vo===void 0?256:Vo,xp=o.pixelConstantB,bp=xp===void 0?1:xp,Ep=o.pixelConstantRGB,Wd=Ep===void 0?.1:Ep,Fv=this.tileStyleService.getAttributeScale(this.parent,"color"),Xd=this.tileStyleService.getAttributeScale(this.parent,"size"),Yd=this.parent.getSource(),tg=(Yd==null||(t=Yd.data)===null||t===void 0?void 0:t.tilesetOptions)||{},bi=tg.coords,ka=Yd.getParserType(),$a=o1(this.parent.type,this.parent);if(this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:$a,zIndex:c,opacity:v,sourceLayer:this.getSourceLayer(ka,Vn),coords:bi,featureId:dr,color:Fv,size:Xd,mask:s1(this.parent.type,S),stroke:I,strokeWidth:O,strokeOpacity:H,clampLow:oe,clampHigh:Oe,domain:At,rampColors:$t,workerEnabled:Sn,pixelConstant:Ba,pixelConstantR:Co,pixelConstantG:Ju,pixelConstantB:bp,pixelConstantRGB:Wd},$t){var kn=this.rendererService.createTexture2D,Cu=Fe($t),Ro=kn({data:Cu.data,width:Cu.width,height:Cu.height,flipY:!1});this.initOptions.colorTexture=Ro}}},{key:"getInitOptionValue",value:function(t){var o,u,c;switch(t){case"color":return(o=this.parent.getAttribute("color"))===null||o===void 0?void 0:o.scale;case"shape":return(u=this.parent.getAttribute("shape"))===null||u===void 0?void 0:u.scale;case"size":return(c=this.parent.getAttribute("size"))===null||c===void 0?void 0:c.scale;default:return this.initOptions[t]}}},{key:"setInitOptionValue",value:function(t,o){this.initOptions[t]=o}},{key:"setConfigListener",value:function(){var t=this,o=o5[this.parent.type]||[];o.map(function(u){t.tileStyleService.setConfig(u,t.getInitOptionValue(u))}),this.tileStyleService.on("updateConfig",function(u){u.map(function(c){return t.updateStyle(c)})})}},{key:"updateAttribute",value:function(t){var o=this;if(D1.includes(t)){var u,c=(u=this.parent.getAttribute(t))===null||u===void 0?void 0:u.scale;if(!c)return;this.children.map(function(p){return p0(p,o.parent,t,c)})}}},{key:"updateStyle",value:function(t){var o=null;if(D1.includes(t))this.updateAttribute(t);else{var u=this.parent.getLayerConfig();if(!(t in u))return;var c=u[t];switch(o=c,t){case"rampColors":var p=a3(c,this.children,this.rendererService);this.initOptions.colorTexture=p;break;default:xm(this.children,t,c)}}this.setInitOptionValue(t,o)}},{key:"destroy",value:function(){this.tilePickService.destroy()}}]),r}(O1),F1=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"initedTileset",!1),(0,Y.Z)(this,"viewchange",(0,pt.debounce)(this.mapchange,200))}return(0,xt.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"mapchange",value:function(){var r,n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),c=u.visible;o<3&&c?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=3&&!c&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===t.toString()||(this.lastViewStates={zoom:o,latLonBounds:t},(r=this.tilesetManager)===null||r===void 0||r.throttleUpdate(o,t))}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}},{key:"bindTilesetEvent",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",function(){return r.viewchange()}),this.mapService.on("moveend",function(){return r.viewchange()}))}},{key:"render",value:function(){this.tileLayerManager.render()}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerManager.destroy()}},{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeTile(r)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(n){return n.isLoaded}).map(function(n){if(!!r.isTileReady(n))if(r.tileLayerManager.hasTile(n)){if(!n.isVisibleChange)return;var u=r.tileLayerManager.getChildren(n.layerIDList);m3(n,u,r.layerService),r.setPickState(u)}else{var t=r.tileLayerManager.addTile(n),o=t.layers;r.setPickState(o)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"isTileReady",value:function(r){var n;if((n=r.data)!==null&&n!==void 0&&n.layers&&this.sourceLayer){var t=r.data.layers[this.sourceLayer],o=t==null?void 0:t.features;if(!(Array.isArray(o)&&o.length>0))return!1}return!0}},{key:"setPickState",value:function(r){}}]),e}();function c5(e){e.filter(function(i){return i.inited&&i.isVisible()}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){Dd(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)})}function f5(e,i,r){var n=Ze(i),t;return e.map(function(o){o.getCurrentSelectedId()===null||n!==o.getCurrentSelectedId()?(Dd(o,i),o.setCurrentSelectedId(n),t=i):(Dd(o,new Uint8Array([0,0,0,0])),o.setCurrentSelectedId(null),t=null)}),r.filter(function(o){return o.inited&&!o.isVector&&o.isVisible()&&o.needPick("click")}).filter(function(o){return o.getCurrentSelectedId()!==null}).map(function(o){Dd(o,new Uint8Array([0,0,0,0])),o.setCurrentSelectedId(null)}),t}function h5(e,i){var r=Ze(i);e.filter(function(n){return n.inited&&n.isVisible()&&n.isVector}).filter(function(n){return n.getPickID()!==r}).map(function(n){n.setPickID(r),n.hooks.beforeHighlight.call(i)})}function p5(e,i){i.select&&e.map(function(r){Dd(r,i.select)}),i.active&&e.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeHighlight.call(i.active)})}function Dd(e,i){var r=(0,mr.Z)(i,3),n=r[0],t=r[1],o=r[2];e.hooks.beforeSelect.call([n,t,o])}function CR(e,i){var r=decodePickingColor(e);i.map(function(n){Dd(n,e),n.setCurrentSelectedId(r)})}function AR(e,i){var r=decodePickingColor(e);i.map(function(n){n.hooks.beforeHighlight.call(e),n.setCurrentPickId(r)})}function d5(e){var i=v5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function v5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m5=function(e){(0,sr.Z)(r,e);var i=d5(r);function r(n){var t,o,u=n.parent,c=n.rendererService,p=n.mapService,v=n.layerService,x=n.pickingService,S=n.transforms;(0,vt.Z)(this,r),o=i.call(this),(0,Y.Z)((0,Le.Z)(o),"pickColors",{select:null,active:null});var w=u.getSource(),I=(w==null||(t=w.data)===null||t===void 0?void 0:t.tilesetOptions)||{},R=I.sourceLayer;return o.sourceLayer=R,o.parent=u,o.mapService=p,o.layerService=v,o.tileLayerManager=new l5(u,p,c,x,S),o.initTileSetManager(),o.bindSubLayerEvent(),o.bindSubLayerPick(),o.scaleField=o.parent.getScaleOptions(),o}return(0,xt.Z)(r,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickService.clearPick()}},{key:"clearPickState",value:function(){c5(this.children)}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"setPickState",value:function(t){p5(t,this.pickColors)}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickService.on("pick",function(o){var u=(0,mr.Z)(o.pickedColors,3),c=u[0],p=u[1],v=u[2];if(o.type==="click"){var x=t.children.filter(function(I){return I.inited&&I.isVisible()&&I.isVector}).filter(function(I){return I!==o.layer}),S=t.layerService.getRenderList(),w=f5(x,[c,p,v],S);t.pickColors.select=w}else h5(t.children,[c,p,v]),t.pickColors.active=[c,p,v]}),this.tileLayerManager.tilePickService.on("unpick",function(){t.pickColors.active=null})}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(o){t.parent.emit("click",(0,U.Z)({},o))}),this.parent.on("subLayerMouseMove",function(o){return t.parent.emit("mousemove",(0,U.Z)({},o))}),this.parent.on("subLayerMouseUp",function(o){return t.parent.emit("mouseup",(0,U.Z)({},o))}),this.parent.on("subLayerMouseEnter",function(o){return t.parent.emit("mouseenter",(0,U.Z)({},o))}),this.parent.on("subLayerMouseOut",function(o){return t.parent.emit("mouseout",(0,U.Z)({},o))}),this.parent.on("subLayerMouseDown",function(o){return t.parent.emit("mousedown",(0,U.Z)({},o))}),this.parent.on("subLayerContextmenu",function(o){return t.parent.emit("contextmenu",(0,U.Z)({},o))}),this.parent.on("subLayerUnClick",function(o){return t.parent.emit("unclick",(0,U.Z)({},o))}),this.parent.on("subLayerUnMouseMove",function(o){return t.parent.emit("unmousemove",(0,U.Z)({},o))}),this.parent.on("subLayerUnMouseUp",function(o){return t.parent.emit("unmouseup",(0,U.Z)({},o))}),this.parent.on("subLayerUnMouseDown",function(o){return t.parent.emit("unmousedown",(0,U.Z)({},o))}),this.parent.on("subLayerUnContextmenu",function(o){return t.parent.emit("uncontextmenu",(0,U.Z)({},o))})}}]),r}(F1);function g5(e){var i=y5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function y5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _5=function(e){(0,sr.Z)(r,e);var i=g5(r);function r(n,t,o){var u;return(0,vt.Z)(this,r),u=i.call(this),u.parent=n,u.children=n.layerChildren,u.mapService=t,u.rendererService=o,u.setSubLayerInitOption(),u.initTileFactory(),u}return(0,xt.Z)(r,[{key:"render",value:function(){var t=this;this.children.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.masks.length>0&&(t.rendererService.clear({stencil:0,depth:1,framebuffer:null}),o.masks.map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.render(),u.hooks.afterRender.call()})),o.render(),o.hooks.afterRender.call()})}},{key:"setSubLayerInitOption",value:function(){var t,o,u=this.parent.getLayerConfig(),c=u.zIndex,p=c===void 0?0:c,v=u.opacity,x=v===void 0?1:v,S=u.mask,w=S===void 0?!1:S,I=u.stroke,R=I===void 0?"#fff":I,O=u.strokeWidth,B=O===void 0?0:O,H=u.strokeOpacity,ae=H===void 0?1:H,oe=u.workerEnabled,Ie=oe===void 0?!1:oe,Oe=u.sourceLayer,it=this.parent.getSource(),At=it.getParserType(),gt=this.parent.getAttribute("color"),$t=(gt==null||(t=gt.scale)===null||t===void 0?void 0:t.field)||"#fff",gr=this.parent.getAttribute("size"),dr=(gr==null||(o=gr.scale)===null||o===void 0?void 0:o.field)||1,kr=o1(this.parent.type,this.parent);this.initOptions={usage:"basemap",layerType:this.parent.type,shape:kr,zIndex:p,opacity:x,sourceLayer:this.getSourceLayer(At,Oe),basemapColor:$t,basemapSize:dr,mask:s1(this.parent.type,w),stroke:R,strokeWidth:B,strokeOpacity:ae,workerEnabled:Ie}}}]),r}(O1);function x5(e){var i=b5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function b5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E5=function(e){(0,sr.Z)(r,e);var i=x5(r);function r(n){var t,o,u=n.parent,c=n.rendererService,p=n.mapService,v=n.layerService;(0,vt.Z)(this,r),o=i.call(this);var x=u.getSource(),S=(x==null||(t=x.data)===null||t===void 0?void 0:t.tilesetOptions)||{},w=S.sourceLayer;return o.sourceLayer=w,o.parent=u,o.mapService=p,o.layerService=v,o.tileLayerManager=new _5(u,p,c),o.initTileSetManager(),o}return(0,xt.Z)(r)}(F1);function S5(e){var i=C5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function C5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _v=function(e){(0,sr.Z)(r,e);var i=S5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"getTileLayer",value:function(t){switch(t){case"basemap":return E5;default:return m5}}},{key:"initModels",value:function(){var t=this.layer.getSource(),o=this.layer.getLayerConfig(),u=o.usage;if(t!=null&&t.data.isTile&&!this.layer.tileLayer){var c=this.getTileLayer(u);this.layer.tileLayer=new c({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:t.transforms})}return this.buildModels()}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(xa);function A5(e){var i=w5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function w5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T5=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,M5=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,I5=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,k5=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,P5=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,L5=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,R5={solid:0,dash:1},O5=function(e){(0,sr.Z)(r,e);var i=A5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,w=S===void 0?"solid":S,I=t.dashArray,R=I===void 0?[10,5]:I,O=t.forward,B=O===void 0?!0:O,H=t.lineTexture,ae=H===void 0?!1:H,oe=t.iconStep,Ie=oe===void 0?100:oe,Oe=t.segmentNumber,it=Oe===void 0?30:Oe,At=t.thetaOffset,gt=At===void 0?.314:At;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:gt})){this.judgeStyleAttributes({opacity:u,thetaOffset:gt});var $t=this.layer.getEncodedData(),gr=this.calDataFrame(this.cellLength,$t,this.cellProperties),dr=gr.data,kr=gr.width,Sn=gr.height;this.rowCount=Sn,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:X.LUMINANCE,type:X.FLOAT,width:kr,height:Sn}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}R.length===2&&R.push(0,0);var Vn=0,Vi=[0,0,0,0],Ba=[0,0,0,0];return c&&p&&(Vi=Re(c),Ba=Re(p),Vn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,pt.isNumber)(gt)?gt:0,u_opacity:(0,pt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:it,u_line_type:R5[w||"solid"],u_dash_array:R,u_blur:.9,u_lineDir:B?1:-1,u_texture:this.texture,u_line_texture:ae?1:0,u_icon_step:Ie,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vn,u_sourceColor:Vi,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,c=t.lineType;return c==="dash"?{frag:T5,vert:M5,type:"Dash"}:o&&u?{frag:P5,vert:L5,type:"Linear"}:{frag:I5,vert:k5,type:""}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.segmentNumber,c=u===void 0?30:u,p=o.mask,v=p===void 0?!1:p,x=o.maskInside,S=x===void 0?!0:x,w=this.getShaders(),I=w.frag,R=w.vert,O=w.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+O,vertexShader:R,fragmentShader:I,triangulation:f0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:c,stencil:Zt(v,S)}).then(function(B){t([B])}).catch(function(B){console.warn(B),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa);function D5(e){var i=F5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function F5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,N5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,z5=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Z5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,U5={solid:0,dash:1},V5=function(e){(0,sr.Z)(r,e);var i=D5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,w=S===void 0?"solid":S,I=t.dashArray,R=I===void 0?[10,5]:I,O=t.lineTexture,B=O===void 0?!1:O,H=t.iconStep,ae=H===void 0?100:H,oe=t.segmentNumber,Ie=oe===void 0?30:oe,Oe=t.globalArcHeight,it=Oe===void 0?10:Oe;R.length===2&&R.push(0,0);var At=0,gt=[0,0,0,0],$t=[0,0,0,0];if(c&&p&&(gt=Re(c),$t=Re(p),At=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var gr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,gr,this.cellProperties),kr=dr.data,Sn=dr.width,Vn=dr.height;this.rowCount=Vn,this.dataTexture=this.cellLength>0&&kr.length>0?this.createTexture2D({flipY:!0,data:kr,format:X.LUMINANCE,type:X.FLOAT,width:Sn,height:Vn}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:mm,u_global_height:it,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ie,u_line_type:U5[w]||0,u_dash_array:R,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:At,u_sourceColor:gt,u_targetColor:$t}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:z5,vert:Z5,type:"Linear"}:{frag:B5,vert:N5,type:""}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.segmentNumber,c=u===void 0?30:u,p=o.mask,v=p===void 0?!1:p,x=o.maskInside,S=x===void 0?!0:x,w=this.getShaders(),I=w.frag,R=w.vert,O=w.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+O,vertexShader:R,fragmentShader:I,triangulation:f0,blend:this.getBlend(),segmentNumber:c,stencil:Zt(v,S)}).then(function(B){t([B])}).catch(function(B){console.warn(B),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa);function j5(e){var i=G5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,W5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,X5=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Y5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,$5={solid:0,dash:1},q5=function(e){(0,sr.Z)(r,e);var i=j5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,w=S===void 0?"solid":S,I=t.dashArray,R=I===void 0?[10,5]:I,O=t.lineTexture,B=O===void 0?!1:O,H=t.iconStep,ae=H===void 0?100:H,oe=t.segmentNumber,Ie=oe===void 0?30:oe,Oe=t.globalArcHeight,it=Oe===void 0?10:Oe;R.length===2&&R.push(0,0);var At=0,gt=[0,0,0,0],$t=[0,0,0,0];if(c&&p&&(gt=Re(c),$t=Re(p),At=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var gr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,gr,this.cellProperties),kr=dr.data,Sn=dr.width,Vn=dr.height;this.rowCount=Vn,this.dataTexture=this.cellLength>0&&kr.length>0?this.createTexture2D({flipY:!0,data:kr,format:X.LUMINANCE,type:X.FLOAT,width:Sn,height:Vn}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:mm,u_global_height:it,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ie,u_line_type:$5[w]||0,u_dash_array:R,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:At,u_sourceColor:gt,u_targetColor:$t}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:X5,vert:Y5,type:"Linear"}:{frag:H5,vert:W5,type:""}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.segmentNumber,c=u===void 0?30:u,p=o.mask,v=p===void 0?!1:p,x=o.maskInside,S=x===void 0?!0:x,w=this.getShaders(),I=w.frag,R=w.vert,O=w.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+O,vertexShader:R,fragmentShader:I,triangulation:f0,depth:{enable:!0},blend:this.getBlend(),segmentNumber:c,stencil:Zt(v,S)}).then(function(B){t([B])}).catch(function(B){console.warn(B),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa);function K5(e){var i=Q5();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function Q5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,eM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,tM={solid:0,dash:1},rM=function(e){(0,sr.Z)(r,e);var i=K5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,w=S===void 0?"solid":S,I=t.dashArray,R=I===void 0?[10,5]:I,O=t.lineTexture,B=O===void 0?!1:O,H=t.iconStep,ae=H===void 0?100:H,oe=t.segmentNumber,Ie=oe===void 0?30:oe;R.length===2&&R.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Oe=0,it=[0,0,0,0],At=[0,0,0,0];if(c&&p&&(it=Re(c),At=Re(p),Oe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var gt=this.layer.getEncodedData(),$t=this.calDataFrame(this.cellLength,gt,this.cellProperties),gr=$t.data,dr=$t.width,kr=$t.height;this.rowCount=kr,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:X.LUMINANCE,type:X.FLOAT,width:dr,height:kr}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ie,u_line_type:tM[w]||0,u_dash_array:R,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Oe,u_sourceColor:it,u_targetColor:At}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:eM,fragmentShader:J5,triangulation:f0,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa);function nM(e){var i=iM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aM=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,oM=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,sM=function(e){(0,sr.Z)(r,e);var i=nM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.arrow,x=v===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:v,S=0,w=[0,0,0,0],I=[0,0,0,0];if(c&&p&&(w=Re(c),I=Re(p),S=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var R=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,R,this.cellProperties),B=O.data,H=O.width,ae=O.height;this.rowCount=ae,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:X.LUMINANCE,type:X.FLOAT,width:H,height:ae}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_linearColor:S,u_sourceColor:w,u_targetColor:I,u_arrow:Number(x.enable),u_arrowHeight:x.arrowHeight||3,u_arrowWidth:x.arrowWidth||2,u_tailWidth:x.tailWidth===void 0?1:x.tailWidth}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R,O,B;return Et().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:c=this.layer.getLayerConfig(),p=c.mask,v=p===void 0?!1:p,x=c.maskInside,S=x===void 0?!0:x,w=c.depth,I=w===void 0?!1:w,R=this.getShaders(),O=R.frag,B=R.vert,this.layer.triangulation=Jp,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:B,fragmentShader:O,triangulation:Jp,depth:{enable:I},blend:this.getBlend(),stencil:Zt(v,S)}).then(function(oe){u([oe])}).catch(function(oe){console.warn(oe),u([])});case 4:case"end":return ae.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:aM,vert:oM,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:mn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v,x){return x===void 0?[c[3],10,c[5]]:[c[3],x,c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:mn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(o){var u=o.coordinates[0]||[0,0],c=o.coordinates[3]||[0,0];return[u[0],u[1],c[0],c[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,c){return[c[4]]}}})}}]),r}(xa),B1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(B1||(B1={}));var Fd;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Fd||(Fd={}));var Cm;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(Cm||(Cm={}));var N1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(N1||(N1={}));function uM(e){var i=lM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cM=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,fM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hM=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,z1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,pM=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,dM={solid:0,dash:1},Z1=function(e){(0,sr.Z)(r,e);var i=uM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,w=S===void 0?"solid":S,I=t.dashArray,R=I===void 0?[10,5,0,0]:I,O=t.lineTexture,B=O===void 0?!1:O,H=t.iconStep,ae=H===void 0?100:H,oe=t.vertexHeightScale,Ie=oe===void 0?20:oe,Oe=t.borderWidth,it=Oe===void 0?0:Oe,At=t.borderColor,gt=At===void 0?"#ccc":At,$t=t.raisingHeight,gr=$t===void 0?0:$t,dr=t.heightfixed,kr=dr===void 0?!1:dr,Sn=t.linearDir,Vn=Sn===void 0?Fd.VERTICAL:Sn,Vi=t.blur,Ba=Vi===void 0?[1,1,1]:Vi,mo=t.arrow,Co=mo===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:mo;R.length===2&&R.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Vo=0,Ju=[0,0,0,0],xp=[0,0,0,0];if(c&&p&&(Ju=Re(c),xp=Re(p),Vo=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var bp=this.layer.getEncodedData(),Ep=this.calDataFrame(this.cellLength,bp,this.cellProperties),Wd=Ep.data,Fv=Ep.width,Xd=Ep.height;this.rowCount=Xd,this.dataTexture=this.cellLength>0&&Wd.length>0?this.createTexture2D({flipY:!0,data:Wd,format:X.LUMINANCE,type:X.FLOAT,width:Fv,height:Xd}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_textureBlend:x===Cm.NORMAL?0:1,u_line_type:dM[w],u_dash_array:R,u_blur:Ba,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:it,u_borderColor:Re(gt),u_linearDir:Vn===Fd.VERTICAL?1:0,u_linearColor:Vo,u_sourceColor:Ju,u_targetColor:xp,u_heightfixed:Number(kr),u_vertexScale:Ie,u_raisingHeight:Number(gr),u_arrow:Number(Co.enable),u_arrowHeight:Co.arrowHeight||3,u_arrowWidth:Co.arrowWidth||2,u_tailWidth:Co.tailWidth===void 0?1:Co.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=o.depth,S=x===void 0?!1:x,w=o.workerEnabled,I=w===void 0?!1:w,R=o.enablePicking,O=this.getShaders(),B=O.frag,H=O.vert,ae=O.type;this.layer.triangulation=af,this.layer.buildLayerModel({moduleName:"line"+ae,vertexShader:H,fragmentShader:B,triangulation:af,depth:{enable:S},blend:this.getBlend(),stencil:Zt(c,v),workerEnabled:I,workerOptions:{modelType:"line"+ae,enablePicking:R,iconMap:this.iconService.getIconMap()}}).then(function(oe){t([oe])}).catch(function(oe){console.warn(oe),t([])})}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,c=t.lineType;return c==="dash"?{frag:cM,vert:fM,type:"Dash"}:o&&u?{frag:pM,vert:z1,type:"Linear"}:{frag:hM,vert:z1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:mn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,c,p,v,x,S){return S===void 0?[p[3],10]:[p[3],S]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:mn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,c,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,c,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa);function vM(e){var i=mM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,yM=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,_M=function(e){(0,sr.Z)(r,e);var i=vM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=Fe(v);n.colorTexture=c({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.vertexHeightScale,p=c===void 0?20:c,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,w=S===void 0?!1:S,I=t.linearDir,R=I===void 0?Fd.VERTICAL:I;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,O,this.cellProperties),H=B.data,ae=B.width,oe=B.height;this.rowCount=oe,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:X.LUMINANCE,type:X.FLOAT,width:ae,height:oe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:R===Fd.VERTICAL?1:0,u_opacity:(0,pt.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(w),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(t){this.updateTexture(),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.colorTexture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=o.depth,S=x===void 0?!1:x;this.layer.triangulation=Jp,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:yM,fragmentShader:gM,triangulation:Jp,depth:{enable:S},blend:this.getBlend(),stencil:Zt(c,v)}).then(function(w){t([w])}).catch(function(w){console.warn(w),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:mn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c,p,v,x){return x===void 0?[c[3],10]:[c[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:mn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,c){return[c[4]]}}})}}]),r}(xa);function xM(e){var i=bM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,SM=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,U1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,CM=function(e){(0,sr.Z)(r,e);var i=xM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.vertexHeightScale,x=v===void 0?20:v,S=0,w=[0,0,0,0],I=[0,0,0,0];if(c&&p&&(w=Re(c),I=Re(p),S=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var R=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,R,this.cellProperties),B=O.data,H=O.width,ae=O.height;this.rowCount=ae,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:X.LUMINANCE,type:X.FLOAT,width:H,height:ae}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_linearColor:S,u_sourceColor:w,u_targetColor:I,u_vertexScale:x}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:SM,vert:U1,type:"lineSimpleLinear"}:{frag:EM,vert:U1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=this.getShaders(),S=x.frag,w=x.vert,I=x.type;this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:S,triangulation:YA,primitive:X.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v),pick:!1}).then(function(R){t([R])}).catch(function(R){console.warn(R),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:mn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:mn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}})}}]),r}(xa);function AM(e){var i=wM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function wM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TM=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,MM=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,IM=function(e){(0,sr.Z)(r,e);var i=AM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.heightfixed,w=S===void 0?!1:S,I=t.lineTexture,R=I===void 0?!1:I,O=t.iconStep,B=O===void 0?100:O,H=t.iconStepCount,ae=H===void 0?1:H;this.rendererService.getDirty()&&this.texture.bind();var oe=0,Ie=[0,0,0,0],Oe=[0,0,0,0];return c&&p&&(Ie=Re(c),Oe=Re(p),oe=1),{u_heightfixed:Number(w),u_opacity:(0,pt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:R?1:0,u_iconStepCount:ae,u_icon_step:B,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:oe,u_sourceColor:Ie,u_targetColor:Oe}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:MM,fragmentShader:TM,triangulation:Jp,depth:{enable:!1},blend:this.getBlend()}).then(function(o){t([o])}).catch(function(o){console.warn(o),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:mn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,c,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:mn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,c,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,c,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa),kM={arc:O5,arc3d:V5,greatcircle:rM,wall:IM,line:Z1,halfLine:sM,simple:CM,linearline:_M,vectorline:_v,tileLine:Em,earthArc3d:q5},PM=kM;function LM(e){var i=RM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function RM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OM=function(e){(0,sr.Z)(r,e);var i=LM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","LineLayer"),(0,Y.Z)((0,Le.Z)(n),"arrowInsertCount",0),(0,Y.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new PM[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.layerSource.getParserType();if(d0(o))return"vectorline";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),c=u==null||(t=u.scale)===null||t===void 0?void 0:t.field;return c||"line"}}]),r}(Kf);function DM(e){var i=FM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function FM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BM=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,NM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,zM=function(e){(0,sr.Z)(r,e);var i=DM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"raiseCount",0),(0,Y.Z)((0,Le.Z)(n),"raiseRepeat",0),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,c=t.opacity,p=c===void 0?1:c,v=t.sourceColor,x=t.targetColor,S=t.pickLight,w=S===void 0?!1:S,I=t.heightfixed,R=I===void 0?!1:I,O=t.opacityLinear,B=O===void 0?{enable:!1,dir:"up"}:O,H=t.lightEnable,ae=H===void 0?!0:H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var oe=this.layer.getEncodedData(),Ie=this.calDataFrame(this.cellLength,oe,this.cellProperties),Oe=Ie.data,it=Ie.width,At=Ie.height;this.rowCount=At,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:X.LUMINANCE,type:X.FLOAT,width:it,height:At}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var gt=0,$t=[0,0,0,0],gr=[0,0,0,0];if(v&&x&&($t=Re(v),gr=Re(x),gt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var dr=u.speed,kr=dr===void 0?.01:dr;this.raiseCount+=kr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(w),u_heightfixed:Number(R),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(p)?p:1,u_linearColor:gt,u_sourceColor:$t,u_targetColor:gr,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(ae)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,c=u===void 0?1:u;this.raiseRepeat=c,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:NM,fragmentShader:BM,triangulation:_m,depth:{enable:!0},cull:{enable:!0,face:kc(this.mapService.version)},blend:this.getBlend()}).then(function(p){t([p])}).catch(function(p){console.warn(p),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=o.size;if(u){var c=[];return Array.isArray(u)&&(c=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(c=[u,u,u]),c}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:mn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=T(o.coordinates);return V_([u[0],u[1]])}}})}}]),r}(xa);function ZM(e){var i=UM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function UM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VM=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,jM=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,GM=function(e){(0,sr.Z)(r,e);var i=ZM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.strokeOpacity,p=c===void 0?1:c,v=t.strokeWidth,x=v===void 0?0:v,S=t.stroke,w=S===void 0?"rgba(0,0,0,0)":S,I=t.offsets,R=I===void 0?[0,0]:I,O=t.blend,B=t.blur,H=B===void 0?0:B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:w,offsets:R})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:w,offsets:R});var ae=this.layer.getEncodedData(),oe=this.calDataFrame(this.cellLength,ae,this.cellProperties),Ie=oe.data,Oe=oe.width,it=oe.height;this.rowCount=it,this.dataTexture=this.cellLength>0&&Ie.length>0?this.createTexture2D({flipY:!0,data:Ie,format:X.LUMINANCE,type:X.FLOAT,width:Oe,height:it}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_blur:H,u_additive:O==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_stroke_opacity:(0,pt.isNumber)(p)?p:1,u_stroke_width:(0,pt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(w),u_offsets:this.isOffsetStatic(R)?R:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){this.layer.triangulation=$_,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:jM,fragmentShader:VM,triangulation:$_,depth:{enable:!0},blend:this.getBlend()}).then(function(o){t([o])}).catch(function(o){console.warn(o),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:mn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v){var x=(0,mr.Z)(p,3),S=x[0],w=x[1],I=x[2],R=ro.fromValues(0,0,1),O=ro.fromValues(S,0,I),B=S>=0?ro.angle(R,O):Math.PI*2-ro.angle(R,O),H=Math.PI*2-Math.asin(w/100),ae=pf();$f(ae,ae,B),df(ae,ae,H);var oe=ro.fromValues(1,1,0);ro.transformMat4(oe,oe,ae),ro.normalize(oe,oe);var Ie=ro.fromValues(-1,1,0);ro.transformMat4(Ie,Ie,ae),ro.normalize(Ie,Ie);var Oe=ro.fromValues(-1,-1,0);ro.transformMat4(Oe,Oe,ae),ro.normalize(Oe,Oe);var it=ro.fromValues(1,-1,0);ro.transformMat4(it,it,ae),ro.normalize(it,it);var At=[].concat((0,N.Z)(oe),(0,N.Z)(Ie),(0,N.Z)(Oe),(0,N.Z)(it)),gt=v%4*3;return[At[gt],At[gt+1],At[gt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:mn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.shape,p=c===void 0?2:c,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(xa);function HM(e){var i=WM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function WM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XM=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,V1=function(e){(0,sr.Z)(r,e);var i=HM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"raiseCount",0),(0,Y.Z)((0,Le.Z)(n),"raiseRepeat",0),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,c=t.opacity,p=c===void 0?1:c,v=t.sourceColor,x=t.targetColor,S=t.pickLight,w=S===void 0?!1:S,I=t.heightfixed,R=I===void 0?!1:I,O=t.opacityLinear,B=O===void 0?{enable:!1,dir:"up"}:O,H=t.lightEnable,ae=H===void 0?!0:H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var oe=this.layer.getEncodedData(),Ie=this.calDataFrame(this.cellLength,oe,this.cellProperties),Oe=Ie.data,it=Ie.width,At=Ie.height;this.rowCount=At,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:X.LUMINANCE,type:X.FLOAT,width:it,height:At}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var gt=0,$t=[0,0,0,0],gr=[0,0,0,0];if(v&&x&&($t=Re(v),gr=Re(x),gt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var dr=u.speed,kr=dr===void 0?.01:dr;this.raiseCount+=kr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(w),u_heightfixed:Number(R),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(p)?p:1,u_linearColor:gt,u_sourceColor:$t,u_targetColor:gr,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(ae)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S;return Et().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:c=this.layer.getLayerConfig(),p=c.depth,v=p===void 0?!0:p,x=c.animateOption.repeat,S=x===void 0?1:x,this.raiseRepeat=S,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:YM,fragmentShader:XM,triangulation:_m,blend:this.getBlend(),cull:{enable:!0,face:kc(this.mapService.version)},depth:{enable:v}}).then(function(R){u([R])}).catch(function(R){console.warn(R),u([])});case 3:case"end":return I.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=o.size;if(u){var c=[];return Array.isArray(u)&&(c=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(c=[u,u,u]),c}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,c,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:mn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o){var u=T(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(xa);function $M(e){var i=qM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function qM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,KM=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Am=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,G1=function(e){(0,sr.Z)(r,e);var i=$M(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"meter2coord",1),(0,Y.Z)((0,Le.Z)(n),"meterYScale",1),(0,Y.Z)((0,Le.Z)(n),"isMeter",!1),(0,Y.Z)((0,Le.Z)(n),"unit","l7size"),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.strokeOpacity,p=c===void 0?1:c,v=t.strokeWidth,x=v===void 0?0:v,S=t.stroke,w=S===void 0?"rgba(0,0,0,0)":S,I=t.offsets,R=I===void 0?[0,0]:I,O=t.blend,B=t.blur,H=B===void 0?0:B,ae=t.raisingHeight,oe=ae===void 0?0:ae,Ie=t.heightfixed,Oe=Ie===void 0?!1:Ie,it=t.unit,At=it===void 0?"l7size":it;if(this.updateUnit(At),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:w,offsets:R})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:w,offsets:R});var gt=this.layer.getEncodedData(),$t=this.calDataFrame(this.cellLength,gt,this.cellProperties),gr=$t.data,dr=$t.width,kr=$t.height;this.rowCount=kr,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:X.LUMINANCE,type:X.FLOAT,width:dr,height:kr}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(oe),u_heightfixed:Number(Oe),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:H,u_additive:O==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_stroke_opacity:(0,pt.isNumber)(p)?p:1,u_stroke_width:(0,pt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(w),u_offsets:this.isOffsetStatic(R)?R:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),of)}},{key:"initModels",value:function(t){this.updateUnit("l7size"),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,mr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3],v=[(o+c)/2,(u+p)/2],x=this.mapService.version,S=ca==null?void 0:ca.mapboxgl;if(x===gs.MAPBOX&&S!==null&&S!==void 0&&S.MercatorCoordinate){var w=S.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),I=w.meterInMercatorCoordinateUnits(),R=new S.MercatorCoordinate(w.x-I,w.y,w.z),O=R.toLngLat(),B=new S.MercatorCoordinate(w.x,w.y-I,w.z),H=B.toLngLat();this.meter2coord=v[0]-O.lng,this.meterYScale=(H.lat-v[1])/this.meter2coord;return}var ae=this.mapService.meterToCoord(v,[o,u]),oe=this.mapService.meterToCoord(v,[c===o?c+.1:c,p===u?u+.1:p]);this.meter2coord=(ae+oe)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R,O,B,H,ae,oe,Ie,Oe;return Et().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:c=this.layer.getLayerConfig(),p=c.mask,v=p===void 0?!1:p,x=c.maskInside,S=x===void 0?!0:x,w=c.animateOption,I=w===void 0?{enable:!1}:w,R=c.workerEnabled,O=R===void 0?!1:R,B=c.enablePicking,H=c.shape2d,ae=this.getShaders(I),oe=ae.frag,Ie=ae.vert,Oe=ae.type,this.layer.triangulation=of,this.layer.buildLayerModel({moduleName:Oe,vertexShader:Ie,fragmentShader:oe,triangulation:of,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(v,S),workerEnabled:O,workerOptions:{modelType:Oe,enablePicking:B,shape2d:H}}).then(function(gt){u([gt])}).catch(function(gt){console.warn(gt),u([])});case 4:case"end":return At.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:j1,vert:Am,type:"pointWave"};default:return{frag:j1,vert:Am,type:"pointWave"}}else return{frag:KM,vert:Am,type:"pointFill"}}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:mn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:mn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.shape,p=c===void 0?2:c,v=t.indexOf(p);return[v]}}})}},{key:"updateUnit",value:function(t){var o=this.mapService.version;this.unit!==t&&(this.unit!=="meter"&&t==="meter"&&o!==gs.L7MAP&&o!==gs.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&t!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=t)}}]),r}(xa);function QM(e){var i=JM();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function JM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e4=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,t4=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,r4=function(e){(0,sr.Z)(r,e);var i=QM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"meter2coord",1),(0,Y.Z)((0,Le.Z)(n),"isMeter",!1),(0,Y.Z)((0,Le.Z)(n),"radian",0),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.offsets,p=c===void 0?[0,0]:c,v=t.rotation,x=t.raisingHeight,S=x===void 0?0:x,w=t.heightfixed,I=w===void 0?!1:w;this.rendererService.getDirty()&&this.texture.bind();var R=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(R=-1),this.radian=v!==void 0?R*Math.PI*v/180:R*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var O=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,O,this.cellProperties),H=B.data,ae=B.width,oe=B.height;this.rowCount=oe,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:X.LUMINANCE,type:X.FLOAT,width:ae,height:oe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(S),u_heightfixed:Number(I),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,pt.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qp)}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,c=u===void 0?"l7size":u,p=this.mapService.version;c==="meter"&&p!==gs.L7MAP&&p!==gs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,mr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3],v=[(o+c)/2,(u+p)/2],x=this.mapService.version;if(x===gs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var S=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),w=1,I=w*S.meterInMercatorCoordinateUnits(),R=new window.mapboxgl.MercatorCoordinate(S.x-I,S.y,S.z),O=R.toLngLat();this.meter2coord=v[0]-O.lng;return}var B=this.mapService.meterToCoord(v,[o,u]),H=this.mapService.meterToCoord(v,[c===o?c+.1:c,p===u?u+.1:p]);this.meter2coord=(B+H)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:t4,fragmentShader:e4,triangulation:Qp,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v),cull:{enable:!0,face:kc(this.mapService.version)}}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"clearModels",value:function(){var t,o;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:mn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.rotate,p=c===void 0?0:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.shape,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:mn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(xa);function n4(e){var i=i4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function i4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a4=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,o4=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,H1=function(e){(0,sr.Z)(r,e);var i=n4(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=c({data:n.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.offsets,p=c===void 0?[0,0]:c,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,w=S===void 0?!1:S;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var I=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,I,this.cellProperties),O=R.data,B=R.width,H=R.height;this.rowCount=H,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:X.LUMINANCE,type:X.FLOAT,width:B,height:H}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(x),u_heightfixed:Number(w),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,pt.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"initModels",value:function(t){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:o4,fragmentShader:a4,triangulation:XA,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.shape,v=c[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(xa);function s4(e){var i=u4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function u4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l4=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,c4=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function W1(e){var i=e.coordinates;return{vertices:(0,N.Z)(i),indices:[0],size:i.length}}var X1=function(e){(0,sr.Z)(r,e);var i=s4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return{u_opacity:(0,pt.isNumber)(u)?u:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.triangulation=W1,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:c4,fragmentShader:l4,triangulation:W1,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:Zt(c,v),pick:!1}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}})}}]),r}(xa);function f4(e){var i=h4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function h4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p4=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,d4=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,v4=function(e){(0,sr.Z)(r,e);var i=f4(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"meter2coord",1),(0,Y.Z)((0,Le.Z)(n),"isMeter",!1),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.blend,p=t.speed,v=p===void 0?1:p;return{u_isMeter:Number(this.isMeter),u_speed:v,u_additive:c==="additive"?1:0,u_opacity:(0,pt.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qp)}},{key:"initModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.unit,c=u===void 0?"l7size":u,p=this.mapService.version;c==="meter"&&p!==gs.L7MAP&&p!==gs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,mr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3],v=[(o+c)/2,(u+p)/2],x=this.mapService.version;if(x===gs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var S=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),w=1,I=w*S.meterInMercatorCoordinateUnits(),R=new window.mapboxgl.MercatorCoordinate(S.x-I,S.y,S.z),O=R.toLngLat();this.meter2coord=v[0]-O.lng;return}var B=this.mapService.meterToCoord(v,[o,u]),H=this.mapService.meterToCoord(v,[c===o?c+.1:c,p===u?u+.1:p]);this.meter2coord=(B+H)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:d4,fragmentShader:p4,triangulation:Qp,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:mn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,c,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(xa);function m4(e){var i=g4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function g4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y4=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,_4=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Y1(e){var i=e.coordinates;return{vertices:(0,N.Z)(i),indices:[0],size:i.length}}var x4=function(e){(0,sr.Z)(r,e);var i=m4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.offsets,p=c===void 0?[0,0]:c,v=t.blend,x=t.strokeOpacity,S=x===void 0?1:x,w=t.strokeWidth,I=w===void 0?0:w,R=t.stroke,O=R===void 0?"#fff":R;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var B=this.layer.getEncodedData(),H=this.calDataFrame(this.cellLength,B,this.cellProperties),ae=H.data,oe=H.width,Ie=H.height;this.rowCount=Ie,this.dataTexture=this.cellLength>0&&ae.length>0?this.createTexture2D({flipY:!0,data:ae,format:X.LUMINANCE,type:X.FLOAT,width:oe,height:Ie}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,pt.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0],u_stroke_opacity:(0,pt.isNumber)(S)?S:1,u_stroke_width:(0,pt.isNumber)(I)?I:1,u_stroke_color:this.getStrokeColor(O)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.triangulation=Y1,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:_4,fragmentShader:y4,triangulation:Y1,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}})}}]),r}(xa);function b4(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=E4(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function E4(e,i){if(!!e){if(typeof e=="string")return $1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $1(e,i)}}function $1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function S4(e){var i=C4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function C4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,K1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Q1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(c,p){n.push.apply(n,(0,N.Z)(u).concat([c.tex.x,c.tex.y+c.tex.height,c.tl.x,c.tl.y],(0,N.Z)(u),[c.tex.x+c.tex.width,c.tex.y+c.tex.height,c.tr.x,c.tr.y],(0,N.Z)(u),[c.tex.x+c.tex.width,c.tex.y,c.br.x,c.br.y],(0,N.Z)(u),[c.tex.x,c.tex.y,c.bl.x,c.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var J1=function(e){(0,sr.Z)(r,e);var i=S4(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"glyphInfoMap",{}),(0,Y.Z)((0,Le.Z)(n),"currentZoom",-1),(0,Y.Z)((0,Le.Z)(n),"textureHeight",0),(0,Y.Z)((0,Le.Z)(n),"textCount",0),(0,Y.Z)((0,Le.Z)(n),"preTextStyle",{}),(0,Y.Z)((0,Le.Z)(n),"buildModels",function(){var c=(0,Ct.Z)(Et().mark(function p(v){var x,S,w,I,R;return Et().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:x=n.layer.getLayerConfig(),S=x.mask,w=S===void 0?!1:S,I=x.maskInside,R=I===void 0?!0:I,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:K1,fragmentShader:q1,triangulation:Q1.bind((0,Le.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Zt(w,R)}).then(function(H){v([H])}).catch(function(H){console.warn(H),v([])});case 3:case"end":return B.stop()}},p)}));return function(p){return c.apply(this,arguments)}}()),(0,Y.Z)((0,Le.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.stroke,p=c===void 0?"#fff":c,v=t.strokeWidth,x=v===void 0?0:v,S=t.textAnchor,w=S===void 0?"center":S,I=t.textAllowOverlap,R=I===void 0?!1:I,O=t.halo,B=O===void 0?.5:O,H=t.gamma,ae=H===void 0?2:H,oe=t.raisingHeight,Ie=oe===void 0?0:oe,Oe=this.fontService,it=Oe.canvas,At=Oe.mapping;if(Object.keys(At).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(At).length),this.preTextStyle={textAnchor:w,textAllowOverlap:R},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:x,stroke:p})){this.judgeStyleAttributes({opacity:u,strokeWidth:x,stroke:p});var gt=this.layer.getEncodedData(),$t=this.calDataFrame(this.cellLength,gt,this.cellProperties),gr=$t.data,dr=$t.width,kr=$t.height;this.rowCount=kr,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:X.LUMINANCE,type:X.FLOAT,width:dr,height:kr}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Ie),u_opacity:(0,pt.isNumber)(u)?u:1,u_stroke_width:(0,pt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:B,u_gamma_scale:ae,u_sdf_map_size:[it.width,it.height]}}},{key:"initModels",value:function(t){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,c=u===void 0?"center":u,p=o.textAllowOverlap,v=p===void 0?!0:p;this.preTextStyle={textAnchor:c,textAllowOverlap:v},this.buildModels(t)}},{key:"needUpdate",value:function(){var t=this.layer.getLayerConfig(),o=t.textAllowOverlap,u=o===void 0?!1:o,c=this.mapService.getZoom(),p=this.mapService.getBounds(),v=_c(this.extent,p);return!u&&(Math.abs(this.currentZoom-c)>1||!v)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:mn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.rotate,c=u===void 0?0:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:mn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?12:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:mn.Attribute,descriptor:{name:"a_tex",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return fs(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,c=t.fontFamily,p=c===void 0?"sans-serif":c,v=this.layer.getEncodedData(),x=[];v.forEach(function(S){var w=S.shape,I=w===void 0?"":w;I=I.toString();var R=b4(I),O;try{for(R.s();!(O=R.n()).done;){var B=O.value;x.indexOf(B)===-1&&x.push(B)}}catch(H){R.e(H)}finally{R.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,c=t.fontFamily,p=c===void 0?"sans-serif":c,v=this.layer.getEncodedData(),x=[];v.forEach(function(S){var w=S.shape,I=w===void 0?"":w;I="".concat(I),x.indexOf(I)===-1&&x.push(I)}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.fontService.mapping,c=this.layer.getLayerConfig(),p=c.spacing,v=p===void 0?2:p,x=c.textAnchor,S=x===void 0?"center":x,w=this.layer.getEncodedData();this.glyphInfo=w.map(function(I){var R=I.shape,O=R===void 0?"":R,B=I.id,H=I.size,ae=H===void 0?1:H,oe=I.textOffset,Ie=oe===void 0?[0,0]:oe,Oe=v1(O.toString(),u,ae,S,"left",v,Ie,t),it=m1(Oe,Ie,!1);return I.shaping=Oe,I.glyphQuads=it,I.centroid=T(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?T(I.originCoordinates):I.originCentroid=I.centroid,o.glyphInfoMap[B]={shaping:Oe,glyphQuads:it,centroid:T(I.coordinates)},I})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,c=u===void 0?[4,4]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),S=x.width,w=x.height,I=new l1(S,w),R=this.glyphInfo.filter(function(O){var B=O.shaping,H=O.id,ae=H===void 0?0:H,oe=O.version==="GAODE2.x"?O.originCentroid:O.centroid,Ie=O.size,Oe=Ie/24,it=t.mapService.lngLatToContainer(oe),At=I.placeCollisionBox({x1:B.left*Oe-c[0],x2:B.right*Oe+c[0],y1:B.top*Oe-c[1],y2:B.bottom*Oe+c[1],anchorPointX:it.x,anchorPointY:it.y}),gt=At.box;return gt&&gt.length?(I.insertCollisionBox(gt,ae),!0):!1});R.forEach(function(O){t.glyphInfoMap[O.id]=O})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:X.LINEAR,min:X.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:K1,fragmentShader:q1,triangulation:Q1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Zt(c,v)}).then(function(x){t.layer.models=[x],t.layerService.throttleRenderLayers()}).catch(function(x){console.warn(x),t.layer.models=[]})}}]),r}(xa),A4={fillImage:r4,fill:G1,radar:v4,image:H1,normal:X1,simplePoint:x4,extrude:V1,text:J1,vectorPoint:_v,tile:v0,tileText:S1,earthFill:GM,earthExtrude:zM},w4=A4;function T4(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M4(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function M4(e,i){if(!!e){if(typeof e=="string")return ex(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ex(e,i)}}function ex(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function I4(e){var i=k4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function k4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P4=function(e){(0,sr.Z)(r,e);var i=I4(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","PointLayer"),(0,Y.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new w4[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,c=this.getLayerConfig(),p=c.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var x=T4(u),S;try{for(x.s();!(S=x.n()).done;){var w=S.value;if(typeof w=="string"&&v.hasOwnProperty(w))return"image"}}catch(I){x.e(I)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorPoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();if(d0(t))return"vectorPoint";var o=this.getEncodedData(),u=this.getLayerConfig(),c=u.shape2d,p=u.shape3d,v=this.iconService.getIconMap(),x=o.find(function(w){return w.hasOwnProperty("shape")});if(x){var S=x.shape;return S==="dot"?"normal":S==="simple"?"simplePoint":S==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(c==null?void 0:c.indexOf(S))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(p==null?void 0:p.indexOf(S))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":v.hasOwnProperty(S)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Kf);function L4(e){var i=R4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function R4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O4=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,D4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,F4=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,B4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,N4=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,z4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Z4=function(e){(0,sr.Z)(r,e);var i=L4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.heightfixed,p=c===void 0?!1:c,v=t.raisingHeight,x=v===void 0?0:v,S=t.topsurface,w=S===void 0?!0:S,I=t.sidesurface,R=I===void 0?!0:I,O=t.sourceColor,B=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var H=this.layer.getEncodedData(),ae=this.calDataFrame(this.cellLength,H,this.cellProperties),oe=ae.data,Ie=ae.width,Oe=ae.height;this.rowCount=Oe,this.dataTexture=this.cellLength>0&&oe.length>0?this.createTexture2D({flipY:!0,data:oe,format:X.LUMINANCE,type:X.FLOAT,width:Ie,height:Oe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var it=0,At=[1,1,1,1],gt=[1,1,1,1];return O&&B&&(At=Re(O),gt=Re(B),it=1),{u_topsurface:Number(w),u_sidesurface:Number(R),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(x),u_opacity:(0,pt.isNumber)(u)?u:1,u_linearColor:it,u_sourceColor:At,u_targetColor:gt,u_texture:this.texture}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p,x=this.getShaders(),S=x.frag,w=x.vert,I=x.type;this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:S,triangulation:K_,stencil:Zt(c,v)}).then(function(R){t([R])}).catch(function(R){console.warn(R),t([])})}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:F4,vert:B4,type:"polygonExtrudeTexture"}:o?{frag:N4,vert:z4,type:"polygonExtrudePickLight"}:{frag:O4,vert:D4,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t,o;(t=this.dataTexture)===null||t===void 0||t.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,mr.Z)(t,4),u=o[0],c=o[1],p=o[2],v=o[3],x=p-u,S=v-c;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:mn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(I,R,O){var B=O[0],H=O[1];return[(B-u)/x,(H-c)/S,O[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(I,R,O,B,H){return H}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(I){var R=I.size,O=R===void 0?10:R;return Array.isArray(O)?[O[0]]:[O]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.mapTexture,c=this.rendererService.createTexture2D;if(this.texture=c({height:0,width:0}),u){var p=new Image;p.crossOrigin="",p.src=u,p.onload=function(){t.texture=c({data:p,width:p.width,height:p.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR}),t.layerService.reRender()}}}}]),r}(xa);function U4(e){var i=V4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function V4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j4=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,G4=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,H4=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,W4=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,X4=function(e){(0,sr.Z)(r,e);var i=U4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,c=t.opacity,p=c===void 0?1:c,v=t.opacityLinear,x=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var S=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,S,this.cellProperties),I=w.data,R=w.width,O=w.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:X.LUMINANCE,type:X.FLOAT,width:R,height:O}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,pt.isNumber)(p)?p:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.getModelParams(),u=o.frag,c=o.vert,p=o.triangulation,v=o.type,x=this.layer.getLayerConfig(),S=x.mask,w=S===void 0?!1:S,I=x.maskInside,R=I===void 0?!0:I,O=x.workerEnabled,B=O===void 0?!1:O,H=x.enablePicking;this.layer.triangulation=p,this.layer.buildLayerModel({moduleName:v,vertexShader:c,fragmentShader:u,triangulation:p,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Zt(w,R),workerEnabled:B,workerOptions:{modelType:v,enablePicking:H}}).then(function(ae){t([ae])}).catch(function(ae){console.warn(ae),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:mn.Attribute,descriptor:{name:"a_linear",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:G4,vert:H4,type:"polygonLinear",triangulation:QA}:{frag:j4,vert:W4,type:"polygonFill",triangulation:Nf}}}]),r}(xa);function Y4(e){var i=$4();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function $4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q4=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,K4=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Q4=function(e){(0,sr.Z)(r,e);var i=Y4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.watercolor,p=c===void 0?"#6D99A8":c,v=t.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Re(p),u_watercolor2:Re(x),u_opacity:(0,pt.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:K4,fragmentShader:q4,triangulation:yv,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,mr.Z)(t,4),u=o[0],c=o[1],p=o[2],v=o[3],x=p-u,S=v-c;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:mn.Attribute,descriptor:{name:"a_uv",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(I,R,O,B){var H=I.version===gs["GAODE2.x"]?I.originCoordinates[0][B]:O,ae=(0,mr.Z)(H,2),oe=ae[0],Ie=ae[1];return[(oe-u)/x,(Ie-c)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),c(function(v){t.texture1=p(v[0]),t.texture2=p(v[1]),t.texture3=p(v[2]),t.layerService.reRender()});function c(v){var x=0,S=[],w=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];w.map(function(I){var R=new Image;R.crossOrigin="",R.src=I,S.push(R),R.onload=function(){x++,x===3&&v(S)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR})}}}]),r}(xa);function J4(e){var i=eI();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function eI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tI=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,rI=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,nI=function(e){(0,sr.Z)(r,e);var i=J4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.speed,p=c===void 0?.5:c;return{u_texture:this.texture,u_speed:p,u_opacity:(0,pt.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,v=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:rI,fragmentShader:tI,triangulation:yv,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Zt(c,v)}).then(function(x){t([x])}).catch(function(x){console.warn(x),t([])})}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,mr.Z)(t,4),u=o[0],c=o[1],p=o[2],v=o[3],x=p-u,S=v-c;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:mn.Attribute,descriptor:{name:"a_uv",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(I,R,O,B){var H=I.version===gs["GAODE2.x"]?I.originCoordinates[0][B]:O,ae=(0,mr.Z)(H,2),oe=ae[0],Ie=ae[1];return[(oe-u)/x,(Ie-c)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,c=this.rendererService.createTexture2D;this.texture=c({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=c({data:p,width:p.width,height:p.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR}),t.layerService.reRender()}}}]),r}(xa),iI={fill:X4,line:Z1,extrude:Z4,text:J1,point_fill:G1,point_image:H1,point_normal:X1,point_extrude:V1,water:nI,ocean:Q4,vectorpolygon:_v,tile:C1},aI=iI;function oI(e){var i=sI();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function sI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tx=function(e){(0,sr.Z)(r,e);var i=oI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","PolygonLayer"),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new aI[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){var t,o=this.layerSource.getParserType();if(d0(o))return"vectorpolygon";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),c=u==null||(t=u.scale)===null||t===void 0?void 0:t.field;return c==="fill"?"fill":c==="extrude"?"extrude":c==="water"?"water":c==="ocean"?"ocean":c==="line"?"line":c==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,c=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(S){return S.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(c==null?void 0:c.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),r}(Kf);function uI(e){var i=lI();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function lI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cI=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,fI=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,rx=function(e){(0,sr.Z)(r,e);var i=uI(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.clampLow,p=c===void 0?!0:c,v=t.clampHigh,x=v===void 0?!0:v,S=t.noDataValue,w=S===void 0?-9999999:S,I=t.domain,R=I===void 0?[0,1]:I,O=t.rampColors;return(0,pt.isEqual)(this.rampColors,O)||(this.updateColorTexture(),this.rampColors=O),{u_opacity:u||1,u_texture:this.texture,u_domain:R,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:w,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x;return Et().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!Array.isArray(u.data)){w.next=4;break}return w.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return w.next=6,u.data;case 6:return c=w.sent,p=c.rasterData,v=c.width,x=c.height,w.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return w.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,Ct.Z)(Et().mark(function o(u){var c,p,v,x,S,w,I,R,O,B,H,ae,oe,Ie,Oe;return Et().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return c=this.layer.getLayerConfig(),p=c.mask,v=p===void 0?!1:p,x=c.maskInside,S=x===void 0?!0:x,w=c.rampColorsData,I=c.rampColors,R=this.layer.getSource(),O=this.rendererService.createTexture2D,B=R.data.dataArray[0],At.next=6,this.getRasterData(B);case 6:H=At.sent,ae=H.data,oe=H.width,Ie=H.height,this.texture=O({data:ae,width:oe,height:Ie,format:X.LUMINANCE,type:X.FLOAT}),Oe=w||Fe(I),this.colorTexture=O({data:Oe.data,width:Oe.width,height:Oe.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:fI,fragmentShader:cI,triangulation:Od,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Zt(v,S)}).then(function(gt){u([gt])}).catch(function(gt){console.warn(gt),u([])});case 14:case"end":return At.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,c=Fe(u);this.colorTexture=t({data:c.data,width:c.width,height:c.height,flipY:!1})}}]),r}(xa),hI={raster:rx,rasterRgb:R1,raster3d:rx,rasterTile:_v},pI=hI;function dI(e){var i=vI();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function vI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mI=function(e){(0,sr.Z)(r,e);var i=dI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","RasterLayer"),n}return(0,xt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new pI[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTile:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(Kf),gI={fill:A1,vectorMask:_v},yI=gI;function _I(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xI(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function xI(e,i){if(!!e){if(typeof e=="string")return nx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nx(e,i)}}function nx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bI(e){var i=EI();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function EI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SI=function(e){(0,sr.Z)(r,e);var i=bI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"type","MaskLayer"),n}return(0,xt.Z)(r,[{key:"init",value:function(){var t=this,o=this.container.get(Yt.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.mapService=this.container.get(Yt.IMapService),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(v){var x=v.attributeName,S=v.attributeField,w=v.attributeValues,I=v.updateOptions;t.styleAttributeService.updateStyleAttribute(x,{scale:(0,U.Z)({field:S},t.splitValuesAndCallbackInAttribute(w,t.getLayerConfig()[x]))},I)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin);var u=_I(this.plugins),c;try{for(u.s();!(c=u.n()).done;){var p=c.value;p.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(v){u.e(v)}finally{u.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new yI[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();return d0(t)?"vectorMask":"fill"}}]),r}(Kf),ix,ax,ox,sx,y0,ux,lx,CI=(ix=(0,_n.b2)(),ax=(0,_n.f3)(Yt.IMapService),ox=(0,_n.f3)(Yt.IFontService),ix(sx=(y0=function(){function e(){(0,vt.Z)(this,e),va(this,"mapService",ux,this),va(this,"fontService",lx,this)}return(0,xt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){var u=r.getSource();u.inited?t.generateMaping(r,{styleAttributeService:o}):u.once("update",function(){t.generateMaping(r,{styleAttributeService:o})})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){r.dataState.dataMappingNeedUpdate=!1;var u=r.getSource();return u.inited?t.generateMaping(r,{styleAttributeService:o}):u.once("update",function(){t.generateMaping(r,{styleAttributeService:o})}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getLayerConfig(),c=u.usage;if(c!=="basemap"){var p=r.getSource();if(!(r.layerModelNeedUpdate||!p||!p.inited)){var v=r.getBottomColor(),x=o.getLayerStyleAttributes()||[],S=o.getLayerStyleAttribute("filter"),w=p.data.dataArray,I=x.filter(function(H){return H.needRemapping}),R=w;if(S!=null&&S.needRemapping&&S!==null&&S!==void 0&&S.scale&&(R=w.filter(function(H){return t.applyAttributeMapping(S,H,v)[0]})),I.length){if(S!=null&&S.needRemapping){var O=t.mapping(r,x,R,void 0,v);r.setEncodedData(O),S.needRemapping=!1}else{var B=t.mapping(r,I,R,r.getEncodedData(),v);r.setEncodedData(B)}r.emit("remapping",null)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=r.getBottomColor(),c=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=r.getSource().data.dataArray,x=v;p!=null&&p.scale&&(x=v.filter(function(w){return t.applyAttributeMapping(p,w,u)[0]}));var S=this.mapping(r,c,x,void 0,u);r.setEncodedData(S),r.emit("dataUpdate",null)}},{key:"mapping",value:function(r,n,t,o,u){var c=this,p=r.getLayerConfig(),v=p.arrow,x=v===void 0?{enable:!1}:v,S=p.usage;if(S==="basemap")return this.mapLayerMapping(r,n,t,o);var w=n.filter(function(R){return R.scale!==void 0}),I=t.map(function(R,O){var B=o?o[O]:{},H=(0,U.Z)({id:R._id,coordinates:R.coordinates},B);if(w.forEach(function(Ie){var Oe=c.applyAttributeMapping(Ie,R,u);Ie.needRemapping=!1,Ie.name==="color"&&(Oe=Oe.map(function(it){return Re(it)})),H[Ie.name]=Array.isArray(Oe)&&Oe.length===1?Oe[0]:Oe,Ie.name==="shape"&&(H.shape=c.fontService.getIconFontKey(H[Ie.name]))}),x.enable&&(H.shape==="line"||H.shape==="halfLine")){var ae=H.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var oe=c.getArrowPoints(ae[0],ae[1]);H.coordinates.splice(1,0,oe,oe),r.arrowInsertCount++}}return H});return this.adjustData2Amap2Coordinates(I,r),this.adjustData2SimpleCoordinates(I),I}},{key:"mapLayerMapping",value:function(r,n,t,o){var u=this,c=n.filter(function(v){return v.scale!==void 0}),p=t.map(function(v,x){var S=o?o[x]:{},w=(0,U.Z)({id:v._id,coordinates:v.coordinates},S);return c.forEach(function(I){var R;if(I.name==="shape"&&((R=r.shapeOption)===null||R===void 0?void 0:R.field)==="simple")w[I.name]="simple",I.needRemapping=!1;else{var O=u.applyMapLayerAttributeMapping(I,v);I.needRemapping=!1,w[I.name]=Array.isArray(O)&&O.length===1?O[0]:O,I.name==="shape"&&(w.shape=u.fontService.getIconFontKey(w[I.name]))}}),w.size===void 0&&(w.size=1),w});return this.adjustData2Amap2Coordinates(p,r),p}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===gs["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;typeof r[0].coordinates[0]=="number"?r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=gs["GAODE2.x"],u.originCoordinates=(0,pt.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordByLayer(u.coordinates,o)}):r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=gs["GAODE2.x"],u.originCoordinates=(0,pt.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===gs.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var c=[];u.map(function(p){c.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(c)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n,t){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],c=[];u.forEach(function(v){var x,S=v.field;(n.hasOwnProperty(S)||((x=r.scale)===null||x===void 0?void 0:x.type)==="variable")&&c.push(n[S])});var p=r.mapping?r.mapping(c):[];return r.name==="color"&&!Ce(p[0])?[t]:p}},{key:"applyMapLayerAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=r.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var c=r.mapping?r.mapping(u):[];return c}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=Of(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),ux=da(y0.prototype,"mapService",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=da(y0.prototype,"fontService",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y0))||sx),cx,fx,AI=(cx=(0,_n.b2)(),cx(fx=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Yt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var t=r.getSource();if(!t){var o=r.sourceOption||r.defaultSourceConfig,u=o.data,c=o.options;t=new Nc(u,c),r.setSource(t)}t.inited?n.updateClusterData(r):t.once("update",function(){n.updateClusterData(r)})}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var t=n.updateClusterData(r),o=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,t||o})}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer)return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,c=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(c)),t&&Math.abs(r.clusterZoom-c)>=1?(u!==Math.floor(c)&&n.updateClusterData(Math.floor(c)),r.clusterZoom=c,!0):!1}}]),e}())||fx);function wm(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function hx(e){return e.length===1&&(e=wI(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function wI(e){return function(i,r){return wm(e(i),r)}}var px=hx(wm),TI=px.right,wR=px.left,_0=TI;function dx(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var vx=Array.prototype,TR=vx.slice,MR=vx.map,Tm=Math.sqrt(50),Mm=Math.sqrt(10),Im=Math.sqrt(2);function mx(e,i,r){var n,t=-1,o,u,c;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(c=x0(e,i,r))===0||!isFinite(c))return[];if(c>0)for(e=Math.ceil(e/c),i=Math.floor(i/c),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*c;else for(e=Math.floor(e*c),i=Math.ceil(i*c),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/c;return n&&u.reverse(),u}function x0(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=Tm?10:o>=Mm?5:o>=Im?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=Tm?10:o>=Mm?5:o>=Im?2:1)}function km(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=Tm?t*=10:o>=Mm?t*=5:o>=Im&&(t*=2),i<e?-t:t}function IR(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,c,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var v=i(p),x=v[0],S=v[1],w=r(p,x,S);Array.isArray(w)||(w=tickStep(x,S,w),w=range(Math.ceil(x/w)*w,S,w));for(var I=w.length;w[0]<=x;)w.shift(),--I;for(;w[I-1]>S;)w.pop(),--I;var R=new Array(I+1),O;for(o=0;o<=I;++o)O=R[o]=[],O.x0=o>0?w[o-1]:x,O.x1=o<I?w[o]:S;for(o=0;o<u;++o)c=p[o],x<=c&&c<=S&&R[bisect(w,c,0,I)].push(t[o]);return R}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function kR(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function MI(e){return e===null?NaN:+e}function II(e,i,r){if(r==null&&(r=MI),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),c=+r(e[o+1],o+1,e);return u+(c-u)*(t-o)}}var kI=Q(87765),jc="$";function b0(){}b0.prototype=gx.prototype={constructor:b0,has:function(e){return jc+e in this},get:function(e){return this[jc+e]},set:function(e,i){return this[jc+e]=i,this},remove:function(e){var i=jc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===jc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===jc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===jc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===jc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===jc&&++e;return e},empty:function(){for(var e in this)if(e[0]===jc)return!1;return!0},each:function(e){for(var i in this)i[0]===jc&&e(this[i],i.slice(1),this)}};function gx(e,i){var r=new b0;if(e instanceof b0)e.each(function(c,p){r.set(p,c)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var Pm=gx;function PR(){var e=[],i=[],r,n,t;function o(c,p,v,x){if(p>=e.length)return r!=null&&c.sort(r),n!=null?n(c):c;for(var S=-1,w=c.length,I=e[p++],R,O,B=map(),H,ae=v();++S<w;)(H=B.get(R=I(O=c[S])+""))?H.push(O):B.set(R,[O]);return B.each(function(oe,Ie){x(ae,Ie,o(oe,p,v,x))}),ae}function u(c,p){if(++p>e.length)return c;var v,x=i[p-1];return n!=null&&p>=e.length?v=c.entries():(v=[],c.each(function(S,w){v.push({key:w,values:u(S,p)})})),x!=null?v.sort(function(S,w){return x(S.key,w.key)}):v}return t={object:function(c){return o(c,0,PI,LI)},map:function(c){return o(c,0,yx,_x)},entries:function(c){return u(o(c,0,yx,_x),0)},key:function(c){return e.push(c),t},sortKeys:function(c){return i[e.length-1]=c,t},sortValues:function(c){return r=c,t},rollup:function(c){return n=c,t}}}function PI(){return{}}function LI(e,i,r){e[i]=r}function yx(){return map()}function _x(e,i,r){e.set(i,r)}function E0(){}var td=Pm.prototype;E0.prototype=RI.prototype={constructor:E0,has:td.has,add:function(e){return e+="",this[jc+e]=e,this},remove:td.remove,clear:td.clear,values:td.keys,size:td.size,empty:td.empty,each:td.each};function RI(e,i){var r=new E0;if(e instanceof E0)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var LR=null,xx=Array.prototype,S0=xx.map,rd=xx.slice;function yp(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function bx(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Ex={name:"implicit"};function C0(){var e=Pm(),i=[],r=[],n=Ex;function t(o){var u=o+"",c=e.get(u);if(!c){if(n!==Ex)return n;e.set(u,c=i.push(o))}return r[(c-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=Pm();for(var u=-1,c=o.length,p,v;++u<c;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return t},t.range=function(o){return arguments.length?(r=rd.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return C0(i,r).unknown(n)},yp.apply(t,arguments),t}function Sx(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,c=0,p=0,v=.5;delete e.unknown;function x(){var S=i().length,w=n[1]<n[0],I=n[w-0],R=n[1-w];t=(R-I)/Math.max(1,S-c+p*2),u&&(t=Math.floor(t)),I+=(R-I-t*(S-c))*v,o=t*(1-c),u&&(I=Math.round(I),o=Math.round(o));var O=sequence(S).map(function(B){return I+t*B});return r(w?O.reverse():O)}return e.domain=function(S){return arguments.length?(i(S),x()):i()},e.range=function(S){return arguments.length?(n=[+S[0],+S[1]],x()):n.slice()},e.rangeRound=function(S){return n=[+S[0],+S[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(S){return arguments.length?(u=!!S,x()):u},e.padding=function(S){return arguments.length?(c=Math.min(1,p=+S),x()):c},e.paddingInner=function(S){return arguments.length?(c=Math.min(1,S),x()):c},e.paddingOuter=function(S){return arguments.length?(p=+S,x()):p},e.align=function(S){return arguments.length?(v=Math.max(0,Math.min(1,S)),x()):v},e.copy=function(){return Sx(i(),n).round(u).paddingInner(c).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function Cx(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Cx(i())},e}function RR(){return Cx(Sx.apply(null,arguments).paddingInner(1))}var OI=Q(21775),DI=Q(73626);function FI(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function BI(e){return function(){return e}}function Lm(e){return+e}var Ax=[0,1];function Qu(e){return e}function Rm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:BI(isNaN(i)?NaN:.5)}function Tx(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function NI(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=Rm(t,n),o=r(u,o)):(n=Rm(n,t),o=r(o,u)),function(c){return o(n(c))}}function zI(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=Rm(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(c){var p=_0(e,c,1,n)-1;return o[p](t[p](c))}}function A0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Om(){var e=Ax,i=Ax,r=OI.Z,n,t,o,u=Qu,c,p,v;function x(){return c=Math.min(e.length,i.length)>2?zI:NI,p=v=null,S}function S(w){return isNaN(w=+w)?o:(p||(p=c(e.map(n),i,r)))(n(u(w)))}return S.invert=function(w){return u(t((v||(v=c(i,e.map(n),DI.Z)))(w)))},S.domain=function(w){return arguments.length?(e=S0.call(w,Lm),u===Qu||(u=Tx(e)),x()):e.slice()},S.range=function(w){return arguments.length?(i=rd.call(w),x()):i.slice()},S.rangeRound=function(w){return i=rd.call(w),r=FI,x()},S.clamp=function(w){return arguments.length?(u=w?Tx(e):Qu,S):u!==Qu},S.interpolate=function(w){return arguments.length?(r=w,x()):r},S.unknown=function(w){return arguments.length?(o=w,S):o},function(w,I){return n=w,t=I,x()}}function Mx(e,i){return Om()(e,i)}var ZI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function w0(e){if(!(i=ZI.exec(e)))throw new Error("invalid format: "+e);var i;return new Dm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}w0.prototype=Dm.prototype;function Dm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Dm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function UI(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function T0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Bd(e){return e=T0(Math.abs(e)),e?e[1]:NaN}function VI(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Bd(i)/3)))*3-Bd(Math.abs(e)))}function jI(e,i){return function(r,n){for(var t=r.length,o=[],u=0,c=e[0],p=0;t>0&&c>0&&(p+c+1>n&&(c=Math.max(1,n-p)),o.push(r.substring(t-=c,t+c)),!((p+=c+1)>n));)c=e[u=(u+1)%e.length];return o.reverse().join(i)}}function GI(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function HI(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var Ix;function WI(e,i){var r=T0(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(Ix=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+T0(e,Math.max(0,i+o-1))[0]}function kx(e,i){var r=T0(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var Px={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:UI,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return kx(e*100,i)},r:kx,s:WI,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Lx(e){return e}var Rx=Array.prototype.map,Ox=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function XI(e){var i=e.grouping===void 0||e.thousands===void 0?Lx:jI(Rx.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Lx:GI(Rx.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",c=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(S){S=w0(S);var w=S.fill,I=S.align,R=S.sign,O=S.symbol,B=S.zero,H=S.width,ae=S.comma,oe=S.precision,Ie=S.trim,Oe=S.type;Oe==="n"?(ae=!0,Oe="g"):Px[Oe]||(oe===void 0&&(oe=12),Ie=!0,Oe="g"),(B||w==="0"&&I==="=")&&(B=!0,w="0",I="=");var it=O==="$"?r:O==="#"&&/[boxX]/.test(Oe)?"0"+Oe.toLowerCase():"",At=O==="$"?n:/[%p]/.test(Oe)?u:"",gt=Px[Oe],$t=/[defgprs%]/.test(Oe);oe=oe===void 0?6:/[gprs]/.test(Oe)?Math.max(1,Math.min(21,oe)):Math.max(0,Math.min(20,oe));function gr(dr){var kr=it,Sn=At,Vn,Vi,Ba;if(Oe==="c")Sn=gt(dr)+Sn,dr="";else{dr=+dr;var mo=dr<0||1/dr<0;if(dr=isNaN(dr)?p:gt(Math.abs(dr),oe),Ie&&(dr=HI(dr)),mo&&+dr==0&&R!=="+"&&(mo=!1),kr=(mo?R==="("?R:c:R==="-"||R==="("?"":R)+kr,Sn=(Oe==="s"?Ox[8+Ix/3]:"")+Sn+(mo&&R==="("?")":""),$t){for(Vn=-1,Vi=dr.length;++Vn<Vi;)if(Ba=dr.charCodeAt(Vn),48>Ba||Ba>57){Sn=(Ba===46?t+dr.slice(Vn+1):dr.slice(Vn))+Sn,dr=dr.slice(0,Vn);break}}}ae&&!B&&(dr=i(dr,Infinity));var Co=kr.length+dr.length+Sn.length,Vo=Co<H?new Array(H-Co+1).join(w):"";switch(ae&&B&&(dr=i(Vo+dr,Vo.length?H-Sn.length:Infinity),Vo=""),I){case"<":dr=kr+dr+Sn+Vo;break;case"=":dr=kr+Vo+dr+Sn;break;case"^":dr=Vo.slice(0,Co=Vo.length>>1)+kr+dr+Sn+Vo.slice(Co);break;default:dr=Vo+kr+dr+Sn;break}return o(dr)}return gr.toString=function(){return S+""},gr}function x(S,w){var I=v((S=w0(S),S.type="f",S)),R=Math.max(-8,Math.min(8,Math.floor(Bd(w)/3)))*3,O=Math.pow(10,-R),B=Ox[8+R/3];return function(H){return I(O*H)+B}}return{format:v,formatPrefix:x}}var M0,Fm,Dx;YI({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function YI(e){return M0=XI(e),Fm=M0.format,Dx=M0.formatPrefix,M0}function $I(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Bd(i)-Bd(e))+1}function qI(e){return Math.max(0,-Bd(Math.abs(e)))}function KI(e,i,r,n){var t=km(e,i,r),o;switch(n=w0(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=VI(t,u))&&(n.precision=o),Dx(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=$I(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=qI(t))&&(n.precision=o-(n.type==="%")*2);break}}return Fm(n)}function Nd(e){var i=e.domain;return e.ticks=function(r){var n=i();return mx(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return KI(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],c=n[o],p;return c<u&&(p=u,u=c,c=p,p=t,t=o,o=p),p=x0(u,c,r),p>0?(u=Math.floor(u/p)*p,c=Math.ceil(c/p)*p,p=x0(u,c,r)):p<0&&(u=Math.ceil(u*p)/p,c=Math.floor(c*p)/p,p=x0(u,c,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(c/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(c*p)/p,i(n)),e},e}function Fx(){var e=Mx(Qu,Qu);return e.copy=function(){return A0(e,Fx())},yp.apply(e,arguments),Nd(e)}function Bx(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=S0.call(n,Lm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return Bx(e).unknown(i)},e=arguments.length?S0.call(e,Lm):[0,1],Nd(r)}function Nx(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function zx(e){return Math.log(e)}function Zx(e){return Math.exp(e)}function QI(e){return-Math.log(-e)}function JI(e){return-Math.exp(-e)}function e6(e){return isFinite(e)?+("1e"+e):e<0?0:e}function t6(e){return e===10?e6:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function r6(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Ux(e){return function(i){return-e(-i)}}function n6(e){var i=e(zx,Zx),r=i.domain,n=10,t,o;function u(){return t=r6(n),o=t6(n),r()[0]<0?(t=Ux(t),o=Ux(o),e(QI,JI)):e(zx,Zx),i}return i.base=function(c){return arguments.length?(n=+c,u()):n},i.domain=function(c){return arguments.length?(r(c),u()):r()},i.ticks=function(c){var p=r(),v=p[0],x=p[p.length-1],S;(S=x<v)&&(w=v,v=x,x=w);var w=t(v),I=t(x),R,O,B,H=c==null?10:+c,ae=[];if(!(n%1)&&I-w<H){if(w=Math.round(w)-1,I=Math.round(I)+1,v>0){for(;w<I;++w)for(O=1,R=o(w);O<n;++O)if(B=R*O,!(B<v)){if(B>x)break;ae.push(B)}}else for(;w<I;++w)for(O=n-1,R=o(w);O>=1;--O)if(B=R*O,!(B<v)){if(B>x)break;ae.push(B)}}else ae=mx(w,I,Math.min(I-w,H)).map(o);return S?ae.reverse():ae},i.tickFormat=function(c,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=Fm(p)),c===Infinity)return p;c==null&&(c=10);var v=Math.max(1,n*c/i.ticks().length);return function(x){var S=x/o(Math.round(t(x)));return S*n<n-.5&&(S*=n),S<=v?p(x):""}},i.nice=function(){return r(Nx(r(),{floor:function(c){return o(Math.floor(t(c)))},ceil:function(c){return o(Math.ceil(t(c)))}}))},i}function Vx(){var e=n6(Om()).domain([1,10]);return e.copy=function(){return A0(e,Vx()).base(e.base())},yp.apply(e,arguments),e}function jx(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Gx(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function i6(e){var i=1,r=e(jx(i),Gx(i));return r.constant=function(n){return arguments.length?e(jx(i=+n),Gx(i)):i},linearish(r)}function a6(){var e=i6(transformer());return e.copy=function(){return copy(e,a6()).constant(e.constant())},initRange.apply(e,arguments)}function Hx(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function o6(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function s6(e){return e<0?-e*e:e*e}function u6(e){var i=e(Qu,Qu),r=1;function n(){return r===1?e(Qu,Qu):r===.5?e(o6,s6):e(Hx(r),Hx(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},Nd(i)}function Bm(){var e=u6(Om());return e.copy=function(){return A0(e,Bm()).exponent(e.exponent())},yp.apply(e,arguments),e}function OR(){return Bm.apply(null,arguments).exponent(.5)}function Wx(){var e=[],i=[],r=[],n;function t(){var u=0,c=Math.max(1,i.length);for(r=new Array(c-1);++u<c;)r[u-1]=II(e,u/c);return o}function o(u){return isNaN(u=+u)?n:i[_0(r,u)]}return o.invertExtent=function(u){var c=i.indexOf(u);return c<0?[NaN,NaN]:[c>0?r[c-1]:e[0],c<r.length?r[c]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var c=0,p=u.length,v;c<p;++c)v=u[c],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(wm),t()},o.range=function(u){return arguments.length?(i=rd.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Wx().domain(e).range(i).unknown(n)},yp.apply(o,arguments)}function Xx(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[_0(n,p,0,r)]:o}function c(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],c()):[e,i]},u.range=function(p){return arguments.length?(r=(t=rd.call(p)).length-1,c()):t.slice()},u.invertExtent=function(p){var v=t.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=r?[n[r-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return Xx().domain([e,i]).range(t).unknown(o)},yp.apply(Nd(u),arguments)}function Yx(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[_0(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=rd.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=rd.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return Yx().domain(e).range(i).unknown(r)},yp.apply(t,arguments)}var Nm=new Date,zm=new Date;function fl(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),c=t.ceil(o);return o-u<c-o?u:c},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,c){var p=[],v;if(o=t.ceil(o),c=c==null?1:Math.floor(c),!(o<u)||!(c>0))return p;do p.push(v=new Date(+o)),i(o,c),e(o);while(v<o&&o<u);return p},t.filter=function(o){return fl(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,c){if(u>=u)if(c<0)for(;++c<=0;)for(;i(u,-1),!o(u););else for(;--c>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return Nm.setTime(+o),zm.setTime(+u),e(Nm),e(zm),Math.floor(r(Nm,zm))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var Zm=fl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Zm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var zd=Zm,DR=Zm.range,$x=fl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),l6=$x,FR=$x.range,I0=1e3,xv=6e4,qx=36e5,Kx=864e5,Qx=6048e5;function nd(e){return fl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*xv)/Qx})}var Um=nd(0),k0=nd(1),c6=nd(2),f6=nd(3),Zd=nd(4),h6=nd(5),p6=nd(6),BR=Um.range,NR=k0.range,zR=c6.range,ZR=f6.range,UR=Zd.range,VR=h6.range,jR=p6.range,Jx=fl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*xv)/Kx},function(e){return e.getDate()-1}),Vm=Jx,GR=Jx.range,eb=fl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*I0-e.getMinutes()*xv)},function(e,i){e.setTime(+e+i*qx)},function(e,i){return(i-e)/qx},function(e){return e.getHours()}),d6=eb,HR=eb.range,tb=fl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*I0)},function(e,i){e.setTime(+e+i*xv)},function(e,i){return(i-e)/xv},function(e){return e.getMinutes()}),v6=tb,WR=tb.range,rb=fl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*I0)},function(e,i){return(i-e)/I0},function(e){return e.getUTCSeconds()}),m6=rb,XR=rb.range,P0=fl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});P0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?fl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):P0};var g6=P0,YR=P0.range;function id(e){return fl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/Qx})}var nb=id(0),L0=id(1),y6=id(2),_6=id(3),Ud=id(4),x6=id(5),b6=id(6),$R=nb.range,qR=L0.range,KR=y6.range,QR=_6.range,JR=Ud.range,e8=x6.range,t8=b6.range,ib=fl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/Kx},function(e){return e.getUTCDate()-1}),ab=ib,r8=ib.range,jm=fl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});jm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var bv=jm,n8=jm.range;function Gm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Hm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ev(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function E6(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,c=e.months,p=e.shortMonths,v=Sv(t),x=Cv(t),S=Sv(o),w=Cv(o),I=Sv(u),R=Cv(u),O=Sv(c),B=Cv(c),H=Sv(p),ae=Cv(p),oe={a:mo,A:Co,b:Vo,B:Ju,c:null,d:fb,e:fb,f:H6,g:tk,G:nk,H:V6,I:j6,j:G6,L:hb,m:W6,M:X6,p:xp,q:bp,Q:yb,s:_b,S:Y6,u:$6,U:q6,V:K6,w:Q6,W:J6,x:null,X:null,y:ek,Y:rk,Z:ik,"%":gb},Ie={a:Ep,A:Wd,b:Fv,B:Xd,c:null,d:db,e:db,f:uk,g:yk,G:xk,H:ak,I:ok,j:sk,L:vb,m:lk,M:ck,p:Yd,q:tg,Q:yb,s:_b,S:fk,u:hk,U:pk,V:dk,w:vk,W:mk,x:null,X:null,y:gk,Y:_k,Z:bk,"%":gb},Oe={a:gr,A:dr,b:kr,B:Sn,c:Vn,d:lb,e:lb,f:N6,g:ub,G:sb,H:cb,I:cb,j:O6,L:B6,m:R6,M:D6,p:$t,q:L6,Q:Z6,s:U6,S:F6,u:T6,U:M6,V:I6,w:w6,W:k6,x:Vi,X:Ba,y:ub,Y:sb,Z:P6,"%":z6};oe.x=it(r,oe),oe.X=it(n,oe),oe.c=it(i,oe),Ie.x=it(r,Ie),Ie.X=it(n,Ie),Ie.c=it(i,Ie);function it(bi,ka){return function($a){var kn=[],Cu=-1,Ro=0,sc=bi.length,uc,sd,tE;for($a instanceof Date||($a=new Date(+$a));++Cu<sc;)bi.charCodeAt(Cu)===37&&(kn.push(bi.slice(Ro,Cu)),(sd=ob[uc=bi.charAt(++Cu)])!=null?uc=bi.charAt(++Cu):sd=uc==="e"?" ":"0",(tE=ka[uc])&&(uc=tE($a,sd)),kn.push(uc),Ro=Cu+1);return kn.push(bi.slice(Ro,Cu)),kn.join("")}}function At(bi,ka){return function($a){var kn=Ev(1900,void 0,1),Cu=gt(kn,bi,$a+="",0),Ro,sc;if(Cu!=$a.length)return null;if("Q"in kn)return new Date(kn.Q);if("s"in kn)return new Date(kn.s*1e3+("L"in kn?kn.L:0));if(ka&&!("Z"in kn)&&(kn.Z=0),"p"in kn&&(kn.H=kn.H%12+kn.p*12),kn.m===void 0&&(kn.m="q"in kn?kn.q:0),"V"in kn){if(kn.V<1||kn.V>53)return null;"w"in kn||(kn.w=1),"Z"in kn?(Ro=Hm(Ev(kn.y,0,1)),sc=Ro.getUTCDay(),Ro=sc>4||sc===0?L0.ceil(Ro):L0(Ro),Ro=ab.offset(Ro,(kn.V-1)*7),kn.y=Ro.getUTCFullYear(),kn.m=Ro.getUTCMonth(),kn.d=Ro.getUTCDate()+(kn.w+6)%7):(Ro=Gm(Ev(kn.y,0,1)),sc=Ro.getDay(),Ro=sc>4||sc===0?k0.ceil(Ro):k0(Ro),Ro=Vm.offset(Ro,(kn.V-1)*7),kn.y=Ro.getFullYear(),kn.m=Ro.getMonth(),kn.d=Ro.getDate()+(kn.w+6)%7)}else("W"in kn||"U"in kn)&&("w"in kn||(kn.w="u"in kn?kn.u%7:"W"in kn?1:0),sc="Z"in kn?Hm(Ev(kn.y,0,1)).getUTCDay():Gm(Ev(kn.y,0,1)).getDay(),kn.m=0,kn.d="W"in kn?(kn.w+6)%7+kn.W*7-(sc+5)%7:kn.w+kn.U*7-(sc+6)%7);return"Z"in kn?(kn.H+=kn.Z/100|0,kn.M+=kn.Z%100,Hm(kn)):Gm(kn)}}function gt(bi,ka,$a,kn){for(var Cu=0,Ro=ka.length,sc=$a.length,uc,sd;Cu<Ro;){if(kn>=sc)return-1;if(uc=ka.charCodeAt(Cu++),uc===37){if(uc=ka.charAt(Cu++),sd=Oe[uc in ob?ka.charAt(Cu++):uc],!sd||(kn=sd(bi,$a,kn))<0)return-1}else if(uc!=$a.charCodeAt(kn++))return-1}return kn}function $t(bi,ka,$a){var kn=v.exec(ka.slice($a));return kn?(bi.p=x[kn[0].toLowerCase()],$a+kn[0].length):-1}function gr(bi,ka,$a){var kn=I.exec(ka.slice($a));return kn?(bi.w=R[kn[0].toLowerCase()],$a+kn[0].length):-1}function dr(bi,ka,$a){var kn=S.exec(ka.slice($a));return kn?(bi.w=w[kn[0].toLowerCase()],$a+kn[0].length):-1}function kr(bi,ka,$a){var kn=H.exec(ka.slice($a));return kn?(bi.m=ae[kn[0].toLowerCase()],$a+kn[0].length):-1}function Sn(bi,ka,$a){var kn=O.exec(ka.slice($a));return kn?(bi.m=B[kn[0].toLowerCase()],$a+kn[0].length):-1}function Vn(bi,ka,$a){return gt(bi,i,ka,$a)}function Vi(bi,ka,$a){return gt(bi,r,ka,$a)}function Ba(bi,ka,$a){return gt(bi,n,ka,$a)}function mo(bi){return u[bi.getDay()]}function Co(bi){return o[bi.getDay()]}function Vo(bi){return p[bi.getMonth()]}function Ju(bi){return c[bi.getMonth()]}function xp(bi){return t[+(bi.getHours()>=12)]}function bp(bi){return 1+~~(bi.getMonth()/3)}function Ep(bi){return u[bi.getUTCDay()]}function Wd(bi){return o[bi.getUTCDay()]}function Fv(bi){return p[bi.getUTCMonth()]}function Xd(bi){return c[bi.getUTCMonth()]}function Yd(bi){return t[+(bi.getUTCHours()>=12)]}function tg(bi){return 1+~~(bi.getUTCMonth()/3)}return{format:function(bi){var ka=it(bi+="",oe);return ka.toString=function(){return bi},ka},parse:function(bi){var ka=At(bi+="",!1);return ka.toString=function(){return bi},ka},utcFormat:function(bi){var ka=it(bi+="",Ie);return ka.toString=function(){return bi},ka},utcParse:function(bi){var ka=At(bi+="",!0);return ka.toString=function(){return bi},ka}}}var ob={"-":"",_:" ","0":"0"},Su=/^\s*\d+/,S6=/^%/,C6=/[\\^$*+?|[\]().{}]/g;function co(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function A6(e){return e.replace(C6,"\\$&")}function Sv(e){return new RegExp("^(?:"+e.map(A6).join("|")+")","i")}function Cv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function w6(e,i,r){var n=Su.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function T6(e,i,r){var n=Su.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function M6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function I6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function k6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function sb(e,i,r){var n=Su.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function ub(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function P6(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function L6(e,i,r){var n=Su.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function R6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function lb(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function O6(e,i,r){var n=Su.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function cb(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function D6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function F6(e,i,r){var n=Su.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function B6(e,i,r){var n=Su.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function N6(e,i,r){var n=Su.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function z6(e,i,r){var n=S6.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function Z6(e,i,r){var n=Su.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function U6(e,i,r){var n=Su.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function fb(e,i){return co(e.getDate(),i,2)}function V6(e,i){return co(e.getHours(),i,2)}function j6(e,i){return co(e.getHours()%12||12,i,2)}function G6(e,i){return co(1+Vm.count(zd(e),e),i,3)}function hb(e,i){return co(e.getMilliseconds(),i,3)}function H6(e,i){return hb(e,i)+"000"}function W6(e,i){return co(e.getMonth()+1,i,2)}function X6(e,i){return co(e.getMinutes(),i,2)}function Y6(e,i){return co(e.getSeconds(),i,2)}function $6(e){var i=e.getDay();return i===0?7:i}function q6(e,i){return co(Um.count(zd(e)-1,e),i,2)}function pb(e){var i=e.getDay();return i>=4||i===0?Zd(e):Zd.ceil(e)}function K6(e,i){return e=pb(e),co(Zd.count(zd(e),e)+(zd(e).getDay()===4),i,2)}function Q6(e){return e.getDay()}function J6(e,i){return co(k0.count(zd(e)-1,e),i,2)}function ek(e,i){return co(e.getFullYear()%100,i,2)}function tk(e,i){return e=pb(e),co(e.getFullYear()%100,i,2)}function rk(e,i){return co(e.getFullYear()%1e4,i,4)}function nk(e,i){var r=e.getDay();return e=r>=4||r===0?Zd(e):Zd.ceil(e),co(e.getFullYear()%1e4,i,4)}function ik(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+co(i/60|0,"0",2)+co(i%60,"0",2)}function db(e,i){return co(e.getUTCDate(),i,2)}function ak(e,i){return co(e.getUTCHours(),i,2)}function ok(e,i){return co(e.getUTCHours()%12||12,i,2)}function sk(e,i){return co(1+ab.count(bv(e),e),i,3)}function vb(e,i){return co(e.getUTCMilliseconds(),i,3)}function uk(e,i){return vb(e,i)+"000"}function lk(e,i){return co(e.getUTCMonth()+1,i,2)}function ck(e,i){return co(e.getUTCMinutes(),i,2)}function fk(e,i){return co(e.getUTCSeconds(),i,2)}function hk(e){var i=e.getUTCDay();return i===0?7:i}function pk(e,i){return co(nb.count(bv(e)-1,e),i,2)}function mb(e){var i=e.getUTCDay();return i>=4||i===0?Ud(e):Ud.ceil(e)}function dk(e,i){return e=mb(e),co(Ud.count(bv(e),e)+(bv(e).getUTCDay()===4),i,2)}function vk(e){return e.getUTCDay()}function mk(e,i){return co(L0.count(bv(e)-1,e),i,2)}function gk(e,i){return co(e.getUTCFullYear()%100,i,2)}function yk(e,i){return e=mb(e),co(e.getUTCFullYear()%100,i,2)}function _k(e,i){return co(e.getUTCFullYear()%1e4,i,4)}function xk(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ud(e):Ud.ceil(e),co(e.getUTCFullYear()%1e4,i,4)}function bk(){return"+0000"}function gb(){return"%"}function yb(e){return+e}function _b(e){return Math.floor(+e/1e3)}var Vd,xb,Ek,Sk,Ck;Ak({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ak(e){return Vd=E6(e),xb=Vd.format,Ek=Vd.parse,Sk=Vd.utcFormat,Ck=Vd.utcParse,Vd}var Av=1e3,wv=Av*60,Tv=wv*60,Mv=Tv*24,wk=Mv*7,bb=Mv*30,Wm=Mv*365;function Tk(e){return new Date(e)}function Mk(e){return e instanceof Date?+e:+new Date(+e)}function Eb(e,i,r,n,t,o,u,c,p){var v=Mx(Qu,Qu),x=v.invert,S=v.domain,w=p(".%L"),I=p(":%S"),R=p("%I:%M"),O=p("%I %p"),B=p("%a %d"),H=p("%b %d"),ae=p("%B"),oe=p("%Y"),Ie=[[u,1,Av],[u,5,5*Av],[u,15,15*Av],[u,30,30*Av],[o,1,wv],[o,5,5*wv],[o,15,15*wv],[o,30,30*wv],[t,1,Tv],[t,3,3*Tv],[t,6,6*Tv],[t,12,12*Tv],[n,1,Mv],[n,2,2*Mv],[r,1,wk],[i,1,bb],[i,3,3*bb],[e,1,Wm]];function Oe(At){return(u(At)<At?w:o(At)<At?I:t(At)<At?R:n(At)<At?O:i(At)<At?r(At)<At?B:H:e(At)<At?ae:oe)(At)}function it(At,gt,$t,gr){if(At==null&&(At=10),typeof At=="number"){var dr=Math.abs($t-gt)/At,kr=hx(function(Sn){return Sn[2]}).right(Ie,dr);kr===Ie.length?(gr=km(gt/Wm,$t/Wm,At),At=e):kr?(kr=Ie[dr/Ie[kr-1][2]<Ie[kr][2]/dr?kr-1:kr],gr=kr[1],At=kr[0]):(gr=Math.max(km(gt,$t,At),1),At=c)}return gr==null?At:At.every(gr)}return v.invert=function(At){return new Date(x(At))},v.domain=function(At){return arguments.length?S(S0.call(At,Mk)):S().map(Tk)},v.ticks=function(At,gt){var $t=S(),gr=$t[0],dr=$t[$t.length-1],kr=dr<gr,Sn;return kr&&(Sn=gr,gr=dr,dr=Sn),Sn=it(At,gr,dr,gt),Sn=Sn?Sn.range(gr,dr+1):[],kr?Sn.reverse():Sn},v.tickFormat=function(At,gt){return gt==null?Oe:p(gt)},v.nice=function(At,gt){var $t=S();return(At=it(At,$t[0],$t[$t.length-1],gt))?S(Nx($t,At)):v},v.copy=function(){return A0(v,Eb(e,i,r,n,t,o,u,c,p))},v}function Ik(){return yp.apply(Eb(zd,l6,Um,Vm,d6,v6,m6,g6,xb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function i8(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function R0(){var e=0,i=1,r,n,t,o,u=Qu,c=!1,p;function v(x){return isNaN(x=+x)?p:u(t===0?.5:(x=(o(x)-r)*t,c?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(r=o(e=+x[0]),n=o(i=+x[1]),t=r===n?0:1/(n-r),v):[e,i]},v.clamp=function(x){return arguments.length?(c=!!x,v):c},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,r=x(e),n=x(i),t=r===n?0:1/(n-r),v}}function Iv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Sb(){var e=Nd(R0()(Qu));return e.copy=function(){return Iv(e,Sb())},bx.apply(e,arguments)}function kk(){var e=loggish(R0()).domain([1,10]);return e.copy=function(){return Iv(e,kk()).base(e.base())},initInterpolator.apply(e,arguments)}function Pk(){var e=symlogish(R0());return e.copy=function(){return Iv(e,Pk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Cb(){var e=powish(R0());return e.copy=function(){return Iv(e,Cb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function a8(){return Cb.apply(null,arguments).exponent(.5)}function Lk(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return Lk(i).domain(e)},initInterpolator.apply(r,arguments)}function O0(){var e=0,i=.5,r=1,n,t,o,u,c,p=Qu,v,x=!1,S;function w(I){return isNaN(I=+I)?S:(I=.5+((I=+v(I))-t)*(I<t?u:c),p(x?Math.max(0,Math.min(1,I)):I))}return w.domain=function(I){return arguments.length?(n=v(e=+I[0]),t=v(i=+I[1]),o=v(r=+I[2]),u=n===t?0:.5/(t-n),c=t===o?0:.5/(o-t),w):[e,i,r]},w.clamp=function(I){return arguments.length?(x=!!I,w):x},w.interpolator=function(I){return arguments.length?(p=I,w):p},w.unknown=function(I){return arguments.length?(S=I,w):S},function(I){return v=I,n=I(e),t=I(i),o=I(r),u=n===t?0:.5/(t-n),c=t===o?0:.5/(o-t),w}}function Ab(){var e=Nd(O0()(Qu));return e.copy=function(){return Iv(e,Ab())},bx.apply(e,arguments)}function Rk(){var e=loggish(O0()).domain([.1,1,10]);return e.copy=function(){return copy(e,Rk()).base(e.base())},initInterpolator.apply(e,arguments)}function Ok(){var e=symlogish(O0());return e.copy=function(){return copy(e,Ok()).constant(e.constant())},initInterpolator.apply(e,arguments)}function wb(){var e=powish(O0());return e.copy=function(){return copy(e,wb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function o8(){return wb.apply(null,arguments).exponent(.5)}var oc,Tb,Mb,Dk=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Fk=(oc={},(0,Y.Z)(oc,lo.LINEAR,Fx),(0,Y.Z)(oc,lo.POWER,Bm),(0,Y.Z)(oc,lo.LOG,Vx),(0,Y.Z)(oc,lo.IDENTITY,Bx),(0,Y.Z)(oc,lo.SEQUENTIAL,Sb),(0,Y.Z)(oc,lo.TIME,Ik),(0,Y.Z)(oc,lo.QUANTILE,Wx),(0,Y.Z)(oc,lo.QUANTIZE,Xx),(0,Y.Z)(oc,lo.THRESHOLD,Yx),(0,Y.Z)(oc,lo.CAT,C0),(0,Y.Z)(oc,lo.DIVERGING,Ab),oc),Bk=(Tb=(0,_n.b2)(),Tb(Mb=function(){function e(){(0,vt.Z)(this,e),(0,Y.Z)(this,"scaleOptions",{})}return(0,xt.Z)(e,[{key:"getSourceData",value:function(r,n){var t=r.getSource();t.inited?n(t.data):t.once("update",function(){n(t.data)})}},{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes();t.getSourceData(r,function(c){var p=c.dataArray;Array.isArray(p)&&p.length===0||t.caculateScalesForAttributes(u||[],p)})}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes();return t.getSourceData(r,function(c){var p=c.dataArray;Array.isArray(p)&&p.length===0||(t.caculateScalesForAttributes(u||[],p),r.layerModelNeedUpdate=!0)}),!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){var u=r.getLayerConfig(),c=u.usage;if(!(r.layerModelNeedUpdate||c==="basemap")){t.scaleOptions=r.getScaleOptions();var p=o.getLayerStyleAttributes();p&&t.getSourceData(r,function(v){var x=v.dataArray;if(x.length!==0){var S=p.filter(function(w){return w.needRescale});S.length&&t.caculateScalesForAttributes(S,x)}})}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale;u.names=t.parseFields(o.scale.field||[]);var c=[];u.names.forEach(function(p){var v;c.push(t.createScale(p,o.name,(v=o.scale)===null||v===void 0?void 0:v.values,n))}),c.some(function(p){return p.type===dp.VARIABLE})?(u.type=dp.VARIABLE,c.forEach(function(p){var v;if(!u.callback&&u.values!=="text")switch((v=p.option)===null||v===void 0?void 0:v.type){case lo.LOG:case lo.LINEAR:case lo.POWER:if(u.values&&u.values.length>2){var x=p.scale.ticks(u.values.length);p.scale.domain(x)}u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case lo.QUANTILE:case lo.QUANTIZE:case lo.THRESHOLD:p.scale.range(u.values);break;case lo.CAT:u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case lo.DIVERGING:case lo.SEQUENTIAL:p.scale.interpolator(kI.hD(u.values));break}if(u.values==="text"){var S;p.scale.range((S=p.option)===null||S===void 0?void 0:S.domain)}})):(u.type=dp.CONSTANT,u.defaultValues=c.map(function(p,v){return p.scale(u.names[v])})),u.scalers=c.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:(0,pt.isString)(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,c,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],v={field:r,scale:void 0,type:dp.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=C0([r]),v.type=dp.CONSTANT),v;var x=(c=o.find(function(I){return!(0,pt.isNil)(I[r])}))===null||c===void 0?void 0:c[r];if(this.isNumber(r)||(0,pt.isNil)(x)&&!p)v.scale=C0([r]),v.type=dp.CONSTANT;else{var S=p&&p.type||this.getDefaultType(x);t==="text"&&(S=lo.CAT);var w=this.createScaleConfig(S,r,p,o);v.scale=this.createDefaultScale(w),v.option=w}return v}},{key:"getDefaultType",value:function(r){var n=lo.LINEAR;return typeof r=="string"&&(n=Dk.test(r)?lo.TIME:lo.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},c=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r!==lo.CAT&&r!==lo.QUANTILE&&r!==lo.DIVERGING)u.domain=dx(c);else if(r===lo.CAT)u.domain=(0,pt.uniq)(c);else if(r===lo.QUANTILE)u.domain=c;else if(r===lo.DIVERGING){var p=dx(c),v=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}return(0,U.Z)((0,U.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,c=r.nice,p=Fk[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),c!==void 0&&p.nice&&p.nice(c),p}}]),e}())||Mb),Ib,kb,Nk=(Ib=(0,_n.b2)(),Ib(kb=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,U.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||kb),Pb,Lb,zk=(Pb=(0,_n.b2)(),Pb(Lb=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"initLayerModel",value:function(r){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(r){var n;r.prepareBuildModel(),(n=r.layerModel)===null||n===void 0||n.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1}},{key:"apply",value:function(r){var n=this;r.hooks.init.tap("LayerModelPlugin",function(){r.inited=!0,r.modelLoaded=!1;var t=r.getSource();t.inited&&n.initLayerModel(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var t=r.getSource();return r.modelLoaded=!1,t.inited?n.prepareLayerModel(r):t.once("update",function(){n.prepareLayerModel(r)}),!1})}}]),e}())||Lb),Rb,Ob,Zk=(Rb=(0,_n.b2)(),Rb(Ob=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&setTimeout(function(){r.fitBounds(o)},100)})}}]),e}())||Ob),Db,Fb,Uk=["type"],Bb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Vk={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},jk={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Gk={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function Hk(e){var i={u_DirectionalLights:new Array(3).fill((0,U.Z)({},jk)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,U.Z)({},Gk)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[Vk]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,hp.Z)(r,Uk),u=Bb[t].lights,c=Bb[t].num,p=i[c];i[u][p]=(0,U.Z)((0,U.Z)({},i[u][p]),o),i[c]++}),i}var Wk=(Db=(0,_n.b2)(),Db(Fb=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,U.Z)({},Hk()))})})}}]),e}())||Fb),Nb,zb,Xk=(Nb=(0,_n.b2)(),Nb(zb=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,c=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,S=x===void 0?[]:x;t.enabled=!!v&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=R_(r,S,u,c),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;r.multiPassRenderer.resize(v,x)}})}}]),e}())||zb),Zb,Ub,D0={NONE:0,ENCODE:1,HIGHLIGHT:2},Yk=(Zb=(0,_n.b2)(),Zb(Ub=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:mn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:X.FLOAT},size:3,update:function(p){var v=p.id;return u?nt(v):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(c){return c.addUniforms({u_PickingStage:D0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(c){return c.addUniforms({u_PickingStage:D0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),c=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof c=="string"?Re(c):c||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ze(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:D0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(w){return w*255}),u_activeMix:v})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),c=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof c=="string"?Re(c):c||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ze(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:D0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(w){return w*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(w){return w*255}),u_EnableSelect:1})})})}}]),e}())||Ub),Vb,jb,$k=(Vb=(0,_n.b2)(),Vb(jb=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){c3(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}var t=n.getLayerConfig(),o=t.usage;if(o==="basemap"){this.registerPositionAttribute(r);return}if(n.isTileLayer){this.registerPositionAttribute(r),this.registerColorAttribute(r);return}this.registerPositionAttribute(r),this.registerFilterAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:mn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:X.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:mn.Attribute,descriptor:{name:"filter",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:mn.Attribute,descriptor:{name:"a_Color",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:mn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||jb),Gb,Hb,Wb,Xb,Yb,$b,jd,qb,Kb,Qb,Jb,qk=(Gb=(0,_n.b2)(),Hb=(0,_n.f3)(Yt.ICameraService),Wb=(0,_n.f3)(Yt.ICoordinateSystemService),Xb=(0,_n.f3)(Yt.IRendererService),Yb=(0,_n.f3)(Yt.IMapService),Gb($b=(jd=function(){function e(){(0,vt.Z)(this,e),va(this,"cameraService",qb,this),va(this,"coordinateSystemService",Kb,this),va(this,"rendererService",Qb,this),va(this,"mapService",Jb,this)}return(0,xt.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var c=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(c),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;r.models.forEach(function(S){var w;S.addUniforms((w={},(0,Y.Z)(w,$p.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,Y.Z)(w,$p.ViewMatrix,n.cameraService.getViewMatrix()),(0,Y.Z)(w,$p.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,Y.Z)(w,$p.Zoom,n.cameraService.getZoom()),(0,Y.Z)(w,$p.ZoomScale,n.cameraService.getZoomScale()),(0,Y.Z)(w,$p.FocalDistance,n.cameraService.getFocalDistance()),(0,Y.Z)(w,$p.CameraPosition,n.cameraService.getCameraPosition()),(0,Y.Z)(w,Xp.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,Y.Z)(w,Xp.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,Y.Z)(w,Xp.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,Y.Z)(w,Xp.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,Y.Z)(w,Xp.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,Y.Z)(w,Xp.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,Y.Z)(w,Xp.Mvp,o),(0,Y.Z)(w,"u_SceneCenterMKT",u),(0,Y.Z)(w,"u_ViewportSize",[v,x]),(0,Y.Z)(w,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,Y.Z)(w,"u_DevicePixelRatio",ca.devicePixelRatio),(0,Y.Z)(w,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,Y.Z)(w,"u_shaderPick",Number(r.getShaderPickStat())),w))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),qb=da(jd.prototype,"cameraService",[Hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kb=da(jd.prototype,"coordinateSystemService",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb=da(jd.prototype,"rendererService",[Xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jb=da(jd.prototype,"mapService",[Yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd))||$b),e2,t2,Kk=(e2=(0,_n.b2)(),e2(t2=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||t2),r2,n2,Qk=(r2=(0,_n.b2)(),r2(n2=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){var u=r.getLayerConfig(),c=u.usage;r.layerModelNeedUpdate||r.tileLayer||c==="basemap"||r.modelLoaded&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(c){return c.needRegenerateVertices=!1});return}o.filter(function(c){return c.needRegenerateVertices}).forEach(function(c){t.updateAttributeByFeatureRange(c.name,r.getEncodedData(),c.featureRange.startIndex,c.featureRange.endIndex,r),c.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||n2);ic.bind(Yt.ILayerPlugin).to(AI).inRequestScope(),ic.bind(Yt.ILayerPlugin).to($k).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Bk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(CI).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Zk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Qk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Kk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Xk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(qk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Nk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Wk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(Yk).inRequestScope(),ic.bind(Yt.ILayerPlugin).to(zk).inRequestScope();var Jk=Q(88307),e7=Q.n(Jk),t7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,c=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},c&&(this.attribute.size=c)}return(0,xt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ih,kv,kh,Gc,Pv,_p,Lv,F0,Qf,ad,Bu,Jf,eh,B0,r7=(Ih={},(0,Y.Z)(Ih,X.POINTS,"points"),(0,Y.Z)(Ih,X.LINES,"lines"),(0,Y.Z)(Ih,X.LINE_LOOP,"line loop"),(0,Y.Z)(Ih,X.LINE_STRIP,"line strip"),(0,Y.Z)(Ih,X.TRIANGLES,"triangles"),(0,Y.Z)(Ih,X.TRIANGLE_FAN,"triangle fan"),(0,Y.Z)(Ih,X.TRIANGLE_STRIP,"triangle strip"),Ih),i2=(kv={},(0,Y.Z)(kv,X.STATIC_DRAW,"static"),(0,Y.Z)(kv,X.DYNAMIC_DRAW,"dynamic"),(0,Y.Z)(kv,X.STREAM_DRAW,"stream"),kv),Xm=(kh={},(0,Y.Z)(kh,X.BYTE,"int8"),(0,Y.Z)(kh,X.UNSIGNED_INT,"int16"),(0,Y.Z)(kh,X.INT,"int32"),(0,Y.Z)(kh,X.UNSIGNED_BYTE,"uint8"),(0,Y.Z)(kh,X.UNSIGNED_SHORT,"uint16"),(0,Y.Z)(kh,X.UNSIGNED_INT,"uint32"),(0,Y.Z)(kh,X.FLOAT,"float"),kh),n7=(Gc={},(0,Y.Z)(Gc,X.ALPHA,"alpha"),(0,Y.Z)(Gc,X.LUMINANCE,"luminance"),(0,Y.Z)(Gc,X.LUMINANCE_ALPHA,"luminance alpha"),(0,Y.Z)(Gc,X.RGB,"rgb"),(0,Y.Z)(Gc,X.RGBA,"rgba"),(0,Y.Z)(Gc,X.RGBA4,"rgba4"),(0,Y.Z)(Gc,X.RGB5_A1,"rgb5 a1"),(0,Y.Z)(Gc,X.RGB565,"rgb565"),(0,Y.Z)(Gc,X.DEPTH_COMPONENT,"depth"),(0,Y.Z)(Gc,X.DEPTH_STENCIL,"depth stencil"),Gc),i7=(Pv={},(0,Y.Z)(Pv,X.DONT_CARE,"dont care"),(0,Y.Z)(Pv,X.NICEST,"nice"),(0,Y.Z)(Pv,X.FASTEST,"fast"),Pv),a2=(_p={},(0,Y.Z)(_p,X.NEAREST,"nearest"),(0,Y.Z)(_p,X.LINEAR,"linear"),(0,Y.Z)(_p,X.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,Y.Z)(_p,X.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,Y.Z)(_p,X.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,Y.Z)(_p,X.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),_p),o2=(Lv={},(0,Y.Z)(Lv,X.REPEAT,"repeat"),(0,Y.Z)(Lv,X.CLAMP_TO_EDGE,"clamp"),(0,Y.Z)(Lv,X.MIRRORED_REPEAT,"mirror"),Lv),a7=(F0={},(0,Y.Z)(F0,X.NONE,"none"),(0,Y.Z)(F0,X.BROWSER_DEFAULT_WEBGL,"browser"),F0),o7=(Qf={},(0,Y.Z)(Qf,X.NEVER,"never"),(0,Y.Z)(Qf,X.ALWAYS,"always"),(0,Y.Z)(Qf,X.LESS,"less"),(0,Y.Z)(Qf,X.LEQUAL,"lequal"),(0,Y.Z)(Qf,X.GREATER,"greater"),(0,Y.Z)(Qf,X.GEQUAL,"gequal"),(0,Y.Z)(Qf,X.EQUAL,"equal"),(0,Y.Z)(Qf,X.NOTEQUAL,"notequal"),Qf),s2=(ad={},(0,Y.Z)(ad,X.FUNC_ADD,"add"),(0,Y.Z)(ad,X.MIN_EXT,"min"),(0,Y.Z)(ad,X.MAX_EXT,"max"),(0,Y.Z)(ad,X.FUNC_SUBTRACT,"subtract"),(0,Y.Z)(ad,X.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ad),N0=(Bu={},(0,Y.Z)(Bu,X.ZERO,"zero"),(0,Y.Z)(Bu,X.ONE,"one"),(0,Y.Z)(Bu,X.SRC_COLOR,"src color"),(0,Y.Z)(Bu,X.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,Y.Z)(Bu,X.SRC_ALPHA,"src alpha"),(0,Y.Z)(Bu,X.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,Y.Z)(Bu,X.DST_COLOR,"dst color"),(0,Y.Z)(Bu,X.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,Y.Z)(Bu,X.DST_ALPHA,"dst alpha"),(0,Y.Z)(Bu,X.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,Y.Z)(Bu,X.CONSTANT_COLOR,"constant color"),(0,Y.Z)(Bu,X.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,Y.Z)(Bu,X.CONSTANT_ALPHA,"constant alpha"),(0,Y.Z)(Bu,X.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,Y.Z)(Bu,X.SRC_ALPHA_SATURATE,"src alpha saturate"),Bu),s7=(Jf={},(0,Y.Z)(Jf,X.NEVER,"never"),(0,Y.Z)(Jf,X.ALWAYS,"always"),(0,Y.Z)(Jf,X.LESS,"less"),(0,Y.Z)(Jf,X.LEQUAL,"lequal"),(0,Y.Z)(Jf,X.GREATER,"greater"),(0,Y.Z)(Jf,X.GEQUAL,"gequal"),(0,Y.Z)(Jf,X.EQUAL,"equal"),(0,Y.Z)(Jf,X.NOTEQUAL,"notequal"),Jf),Gd=(eh={},(0,Y.Z)(eh,X.ZERO,"zero"),(0,Y.Z)(eh,X.KEEP,"keep"),(0,Y.Z)(eh,X.REPLACE,"replace"),(0,Y.Z)(eh,X.INVERT,"invert"),(0,Y.Z)(eh,X.INCR,"increment"),(0,Y.Z)(eh,X.DECR,"decrement"),(0,Y.Z)(eh,X.INCR_WRAP,"increment wrap"),(0,Y.Z)(eh,X.DECR_WRAP,"decrement wrap"),eh),u7=(B0={},(0,Y.Z)(B0,X.FRONT,"front"),(0,Y.Z)(B0,X.BACK,"back"),B0),l7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:i2[t||X.STATIC_DRAW],type:Xm[o||X.UNSIGNED_BYTE]})}return(0,xt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),c7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:i2[t||X.STATIC_DRAW],type:Xm[o||X.UNSIGNED_BYTE],count:u})}return(0,xt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),f7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,c={width:n,height:t};Array.isArray(u)&&(c.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(c.color=o.get()),this.framebuffer=i.framebuffer(c)}return(0,xt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),h7=function(){function e(i,r){(0,vt.Z)(this,e),(0,Y.Z)(this,"destroyed",!1),(0,Y.Z)(this,"uniforms",{}),this.reGl=i;var n=r.pick,t=n===void 0?!0:n,o=r.vs,u=r.fs,c=r.attributes,p=r.uniforms,v=r.primitive,x=r.count,S=r.elements,w=r.depth,I=r.blend,R=r.stencil,O=r.cull,B=r.instances,H={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Oe){H[Oe]=i.prop(Oe)}));var ae={};Object.keys(c).forEach(function(Oe){ae[Oe]=c[Oe].get()});var oe={attributes:ae,frag:u,uniforms:H,vert:o,blend:{},primitive:r7[v===void 0?X.TRIANGLES:v]};if(B&&(oe.instances=B),x?oe.count=x:S&&(oe.elements=S.get()),this.initDepthDrawParams({depth:w},oe),this.initBlendDrawParams({blend:I},oe),this.initStencilDrawParams({stencil:R},oe),this.initCullDrawParams({cull:O},oe),this.drawCommand=i(oe),t){var Ie=(0,pt.cloneDeep)(oe);Ie.blend=(0,U.Z)((0,U.Z)({},Ie.blend),{},{enable:!1}),this.drawPickCommand=i(Ie)}this.drawParams=oe}return(0,xt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};if(Object.keys(r).forEach(function(u){t[u]=r[u].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var o=(0,pt.cloneDeep)(this.drawParams);o.blend=(0,U.Z)((0,U.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}}},{key:"updateAttributes",value:function(r){var n={};if(Object.keys(r).forEach(function(o){n[o]=r[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var t=(0,pt.cloneDeep)(this.drawParams);t.blend=(0,U.Z)((0,U.Z)({},t.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(t)}}},{key:"addUniforms",value:function(r){this.uniforms=(0,U.Z)((0,U.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,U.Z)((0,U.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var c=(0,ke.Z)(t[u]);c==="boolean"||c==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),n?this.drawPickCommand&&this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:o7[t.func||X.LESS],range:t.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var t=r.blend;if(t){var o=t.enable,u=t.func,c=t.equation,p=t.color,v=p===void 0?[0,0,0,0]:p;n.blend={enable:!!o,func:{srcRGB:N0[u&&u.srcRGB||X.SRC_ALPHA],srcAlpha:N0[u&&u.srcAlpha||X.SRC_ALPHA],dstRGB:N0[u&&u.dstRGB||X.ONE_MINUS_SRC_ALPHA],dstAlpha:N0[u&&u.dstAlpha||X.ONE_MINUS_SRC_ALPHA]},equation:{rgb:s2[c&&c.rgb||X.FUNC_ADD],alpha:s2[c&&c.alpha||X.FUNC_ADD]},color:v}}}},{key:"initStencilDrawParams",value:function(r,n){var t=r.stencil;if(t){var o=t.enable,u=t.mask,c=u===void 0?-1:u,p=t.func,v=p===void 0?{cmp:X.ALWAYS,ref:0,mask:-1}:p,x=t.opFront,S=x===void 0?{fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}:x,w=t.opBack,I=w===void 0?{fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}:w;n.stencil={enable:!!o,mask:c,func:(0,U.Z)((0,U.Z)({},v),{},{cmp:s7[v.cmp]}),opFront:{fail:Gd[S.fail],zfail:Gd[S.zfail],zpass:Gd[S.zpass]},opBack:{fail:Gd[I.fail],zfail:Gd[I.zfail],zpass:Gd[I.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,c=u===void 0?X.BACK:u;n.cull={enable:!!o,face:u7[c]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,pt.isTypedArray)(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}(0,pt.isPlainObject)(n)&&Object.keys(n).forEach(function(c){u.extractUniformsRecursively(c,n[c],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(c,p){Object.keys(c).forEach(function(v){u.extractUniformsRecursively(v,c[v],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),p7=function(){function e(i,r){(0,vt.Z)(this,e),(0,Y.Z)(this,"isDistroy",!1);var n=r.data,t=r.type,o=t===void 0?X.UNSIGNED_BYTE:t,u=r.width,c=r.height,p=r.flipY,v=p===void 0?!1:p,x=r.format,S=x===void 0?X.RGBA:x,w=r.mipmap,I=w===void 0?!1:w,R=r.wrapS,O=R===void 0?X.CLAMP_TO_EDGE:R,B=r.wrapT,H=B===void 0?X.CLAMP_TO_EDGE:B,ae=r.aniso,oe=ae===void 0?0:ae,Ie=r.alignment,Oe=Ie===void 0?1:Ie,it=r.premultiplyAlpha,At=it===void 0?!1:it,gt=r.mag,$t=gt===void 0?X.NEAREST:gt,gr=r.min,dr=gr===void 0?X.NEAREST:gr,kr=r.colorSpace,Sn=kr===void 0?X.BROWSER_DEFAULT_WEBGL:kr,Vn=r.x,Vi=Vn===void 0?0:Vn,Ba=r.y,mo=Ba===void 0?0:Ba,Co=r.copy,Vo=Co===void 0?!1:Co;this.width=u,this.height=c;var Ju={width:u,height:c,type:Xm[o],format:n7[S],wrapS:o2[O],wrapT:o2[H],mag:a2[$t],min:a2[dr],alignment:Oe,flipY:v,colorSpace:a7[Sn],premultiplyAlpha:At,aniso:oe,x:Vi,y:mo,copy:Vo};n&&(Ju.data=n),typeof I=="number"?Ju.mipmap=i7[I]:typeof I=="boolean"&&(Ju.mipmap=I),this.texture=i.texture(Ju)}return(0,xt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),u2,l2,d7=(u2=(0,_n.b2)(),u2(l2=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,Y.Z)(this,"createModel",function(r){return new h7(i.gl,r)}),(0,Y.Z)(this,"createAttribute",function(r){return new t7(i.gl,r)}),(0,Y.Z)(this,"createBuffer",function(r){return new l7(i.gl,r)}),(0,Y.Z)(this,"createElements",function(r){return new c7(i.gl,r)}),(0,Y.Z)(this,"createTexture2D",function(r){return new p7(i.gl,r)}),(0,Y.Z)(this,"createFramebuffer",function(r){return new f7(i.gl,r)}),(0,Y.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,Y.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,c=r.framebuffer,p=c===void 0?null:c,v={color:t,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,Y.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,Y.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,c=r.height,p={x:t,y:o,width:u,height:c};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,Y.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,Y.Z)(this,"getContainer",function(){if(ts)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,Y.Z)(this,"getCanvas",function(){return i.canvas}),(0,Y.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,Y.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,xt.Z)(e,[{key:"init",value:function(){var i=(0,Ct.Z)(Et().mark(function n(t,o,u){var c=this;return Et().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=t,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,S){e7()({canvas:c.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(I,R){(I||!R)&&S(I),x(R)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||l2);function v7(e){var i=m7();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function m7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ym=["selectstart","selecting","selectend"],g7=function(e){(0,sr.Z)(r,e);var i=v7(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,vt.Z)(this,r),t=i.call(this),(0,Y.Z)((0,Le.Z)(t),"isEnable",!1),(0,Y.Z)((0,Le.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,Y.Z)((0,Le.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,Y.Z)((0,Le.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,xt.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=Ni("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,c=this.endEvent,p=c.x,v=c.y,x=Math.min(o,p),S=Math.min(u,v),w=Math.abs(o-p),I=Math.abs(u-v);this.box.style.top="".concat(S,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(w,"px"),this.box.style.height="".concat(I,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,c=this.endEvent.lngLat,p=c.lng,v=c.lat;return D([[o,u],[p,v]])}}]),r}(Js.EventEmitter),y7=function(){function e(i){(0,vt.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=EC();this.container=u,n.setContainer(u,r,t,o),u.bind(Yt.IRendererService).to(d7).inSingletonScope(),this.sceneService=u.get(Yt.ISceneService),this.mapService=u.get(Yt.IMapService),this.iconService=u.get(Yt.IIconService),this.fontService=u.get(Yt.IFontService),this.controlService=u.get(Yt.IControlService),this.layerService=u.get(Yt.ILayerService),this.markerService=u.get(Yt.IMarkerService),this.interactionService=u.get(Yt.IInteractionService),this.popupService=u.get(Yt.IPopupService),this.boxSelect=new g7(this,{}),ts?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,xt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=cm(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,c=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!!t){var x=new SI().source(o).shape("fill").style({color:c,opacity:v});return x}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=cm(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,mr.Z)(t,2),u=o[0],c=o[1];n.fontService.addIconFont(u,c)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){ts?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(Ym.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else o0.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(Ym.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else o0.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){o0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(Ym.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else o0.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,U.Z)((0,U.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Yt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Wi(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new JC({position:t}))}}]),e}(),s8="2.10.1";function c2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?c2(Object(r),!0).forEach(function(n){_7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function l8(e,i){return S7(e)||E7(e,i)||b7(e,i)||x7()}function x7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b7(e,i){if(!!e){if(typeof e=="string")return f2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f2(e,i)}}function f2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function E7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function S7(e){if(Array.isArray(e))return e}var c8=null,f8=null,h2,$m,p2,C7=(h2=lm(Yt.IGlobalConfigService),$m=function(){function e(i){(0,vt.Z)(this,e),va(this,"configService",p2,this),this.config=i}return(0,xt.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(Yt.MapConfig).toConstantValue((0,U.Z)((0,U.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(Yt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),p2=da($m.prototype,"configService",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$m),A7=Q(6158),Rv=Q.n(A7);function Ov(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function z0(e,i){var r=tm([],i,e);return vE(r,r,1/r[3]),r}function h8(e,i){var r=e%i;return r<0?i+r:r}function p8(e,i,r){return r*i+(1-r)*e}function od(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var gf=Math.PI,d2=gf/4,Ph=gf/180,v2=180/gf,qm=512,Km=4003e4,w7=1.5;function m2(e){return Math.pow(2,e)}function T7(e){return Math.log2(e)}function Z0(e,i){var r=(0,mr.Z)(e,2),n=r[0],t=r[1];od(Number.isFinite(n)&&Number.isFinite(i)),od(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=qm;var o=n*Ph,u=t*Ph,c=i*(o+gf)/(2*gf),p=i*(gf-Math.log(Math.tan(d2+u*.5)))/(2*gf);return[c,p]}function Qm(e,i){var r=(0,mr.Z)(e,2),n=r[0],t=r[1];i*=qm;var o=n/i*(2*gf)-gf,u=2*(Math.atan(Math.exp(gf-t/i*(2*gf)))-d2);return[o*v2,u*v2]}function d8(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Ph);return T7(Km*r)-9}function g2(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:m2(n),od(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var c={},p=qm*t,v=Math.cos(i*Ph),x=p/360,S=x/v,w=p/Km/v;if(c.pixelsPerMeter=[w,-w,w],c.metersPerPixel=[1/w,-1/w,1/w],c.pixelsPerDegree=[x,-S,w],c.degreesPerPixel=[1/x,-1/S,1/w],u){var I=Ph*Math.tan(i*Ph)/v,R=x*I/2,O=p/Km*I,B=O/S*w;c.pixelsPerDegree2=[0,-R,O],c.pixelsPerMeter2=[B,0,B]}return c}function v8(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),c=u[0],p=u[1],v=u[2],x=1,S=g2({longitude:n,latitude:t,scale:x,highPrecision:!0}),w=S.pixelsPerMeter,I=S.pixelsPerMeter2,R=Z0(e,x);R[0]+=c*(w[0]+I[0]*p),R[1]+=p*(w[1]+I[1]*p);var O=Qm(R,x),B=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[O[0],O[1],B]:O}function M7(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,c=e.flipY,p=c===void 0?!1:c,v=Ov();return jp(v,v,[0,0,-t]),lp(v,v,[1,1,1/i]),df(v,v,-r*Ph),qf(v,v,n*Ph),p&&lp(v,v,[1,-1,1]),u&&jp(v,v,ro.negate([],u)),v}function I7(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?w7:n,o=e.pitch,u=o===void 0?0:o,c=e.nearZMultiplier,p=c===void 0?1:c,v=e.farZMultiplier,x=v===void 0?1:v,S=u*Ph,w=Math.atan(.5/t),I=Math.sin(w)*t/Math.sin(Math.PI/2-S-w),R=Math.cos(Math.PI/2-S)*I+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:R*x}}function k7(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,c=I7({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=c.fov,v=c.aspect,x=c.near,S=c.far,w=hv([],p,v,x,S);return w}function P7(e,i){var r=(0,mr.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return od(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),z0(i,[n,t,u,1])}function y2(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,mr.Z)(e,3),t=n[0],o=n[1],u=n[2];if(od(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var c=z0(i,[t,o,u,1]);return c}var p=z0(i,[t,o,0,1]),v=z0(i,[t,o,1,1]),x=p[2],S=v[2],w=x===S?0:((r||0)-x)/(S-x);return $r.lerp([],p,v,w)}var _2=Ov(),L7=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?_2:t,u=i.projectionMatrix,c=u===void 0?_2:u;(0,vt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=c;var p=Ov();Xs(p,p,this.projectionMatrix),Xs(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=Ov();lp(v,v,[this.width/2,-this.height/2,1]),jp(v,v,[1,-1,0]),Xs(v,v,this.viewProjectionMatrix);var x=du(Ov(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,xt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&cp(r.projectionMatrix,this.projectionMatrix)&&cp(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),c=P7(u,this.pixelProjectionMatrix),p=(0,mr.Z)(c,2),v=p[0],x=p[1],S=o?x:this.height-x;return r.length===2?[v,S]:[v,S,c[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,c=(0,mr.Z)(r,3),p=c[0],v=c[1],x=c[2],S=o?v:this.height-v,w=u&&u*this.pixelsPerMeter,I=y2([p,S,x],this.pixelUnprojectionMatrix,w),R=this.unprojectPosition(I),O=(0,mr.Z)(R,3),B=O[0],H=O[1],ae=O[2];return Number.isFinite(x)?[B,H,ae]:Number.isFinite(u)?[B,H,u]:[B,H]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,mr.Z)(n,2),o=t[0],u=t[1],c=(r[2]||0)*this.pixelsPerMeter;return[o,u,c]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,mr.Z)(n,2),o=t[0],u=t[1],c=(r[2]||0)/this.pixelsPerMeter;return[o,u,c]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function R7(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,c=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,S=x===void 0?[0,0]:x,w=(0,mr.Z)(n,2),I=(0,mr.Z)(w[0],2),R=I[0],O=I[1],B=(0,mr.Z)(w[1],2),H=B[0],ae=B[1];if(Number.isFinite(v)){var oe=v;v={top:oe,bottom:oe,left:oe,right:oe}}else od(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var Ie=new x2({width:i,height:r,longitude:0,latitude:0,zoom:0}),Oe=Ie.project([R,ae]),it=Ie.project([H,O]),At=[Math.max(Math.abs(it[0]-Oe[0]),o),Math.max(Math.abs(it[1]-Oe[1]),o)],gt=[i-v.left-v.right-Math.abs(S[0])*2,r-v.top-v.bottom-Math.abs(S[1])*2];od(gt[0]>0&&gt[1]>0);var $t=gt[0]/At[0],gr=gt[1]/At[1],dr=(v.right-v.left)/2/$t,kr=(v.bottom-v.top)/2/gr,Sn=[(it[0]+Oe[0])/2+dr,(it[1]+Oe[1])/2+kr],Vn=Ie.unproject(Sn),Vi=Ie.zoom+Math.log2(Math.abs(Math.min($t,gr)));return{longitude:Vn[0],latitude:Vn[1],zoom:Math.min(Vi,c)}}var x2=function(e){(0,sr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,c=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,S=x===void 0?0:x,w=n.pitch,I=w===void 0?0:w,R=n.bearing,O=R===void 0?0:R,B=n.altitude,H=B===void 0?1.5:B,ae=n.nearZMultiplier,oe=n.farZMultiplier;(0,vt.Z)(this,i),t=t||1,o=o||1;var Ie=m2(S);H=Math.max(.75,H);var Oe=Z0([v,c],Ie);Oe[2]=0;var it=k7({width:t,height:o,pitch:I,bearing:O,altitude:H,nearZMultiplier:ae||1/o,farZMultiplier:oe||1.01}),At=M7({height:o,center:Oe,pitch:I,bearing:O,altitude:H,flipY:!0});return r=(0,xr.Z)(this,(0,je.Z)(i).call(this,{width:t,height:o,viewMatrix:At,projectionMatrix:it})),r.latitude=c,r.longitude=v,r.zoom=S,r.pitch=I,r.bearing=O,r.altitude=H,r.scale=Ie,r.center=Oe,r.pixelsPerMeter=g2((0,Le.Z)((0,Le.Z)(r))).pixelsPerMeter[2],Object.freeze((0,Le.Z)((0,Le.Z)(r))),r}return(0,xt.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Z0(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Qm(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=y2(o,this.pixelUnprojectionMatrix),c=Z0(t,this.scale),p=$r.add([],c,$r.negate([],u)),v=$r.add([],this.center,p);return Qm(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,c=R7(Object.assign({width:o,height:u,bounds:n},t)),p=c.longitude,v=c.latitude,x=c.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(L7),O7=function(){function e(){(0,vt.Z)(this,e)}return(0,xt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,c=r.viewportHeight,p=r.viewportWidth;this.viewport=new x2({width:p,height:c,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),D7=function(){function e(i){(0,vt.Z)(this,e),(0,Y.Z)(this,"size",1e4),this.size=i||1e4}return(0,xt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}(),F7={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},b2,E2,S2,C2,A2,w2,Hd,T2,M2,I2,k2,P2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},B7=12,N7=(b2=(0,_n.b2)(),E2=(0,_n.f3)(Yt.MapConfig),S2=(0,_n.f3)(Yt.IGlobalConfigService),C2=(0,_n.f3)(Yt.ICoordinateSystemService),A2=(0,_n.f3)(Yt.IEventEmitter),b2(w2=(Hd=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,Y.Z)(this,"version",gs.L7MAP),(0,Y.Z)(this,"simpleMapCoord",new D7),(0,Y.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),va(this,"config",T2,this),va(this,"configService",M2,this),va(this,"coordinateSystemService",I2,this),va(this,"eventEmitter",k2,this),(0,Y.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,xt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ni("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){OC.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(P2[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(P2[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===gs.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return F7}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>B7&&n?this.coordinateSystemService.setCoordinateSystem(fp.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(fp.LNGLAT)}}]),e}(),T2=da(Hd.prototype,"config",[E2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M2=da(Hd.prototype,"configService",[S2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I2=da(Hd.prototype,"coordinateSystemService",[C2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k2=da(Hd.prototype,"eventEmitter",[A2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd))||w2),z7=["id","attributionControl","style","token","rotation","mapInstance"],L2,R2;function Z7(e){var i=U7();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function U7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function V7(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}V7(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Rv();var j7=0,O2="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",G7=(L2=(0,_n.b2)(),L2(R2=function(e){(0,sr.Z)(r,e);var i=Z7(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,Y.Z)((0,Le.Z)(n),"version",gs.MAPBOX),n}return(0,xt.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),c=u.x,p=u.y;return[c-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),c=u.x,p=c===void 0?0:c,v=u.y,x=v===void 0?0:v,S=u.z,w=S===void 0?0:S;return{x:p,y:x,z:w}}},{key:"getModelMatrix",value:function(t,o,u){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),x=v.meterInMercatorCoordinateUnits(),S=pf();return jp(S,S,ro.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),lp(S,S,ro.fromValues(x*c[0],-x*c[1],x*c[2])),df(S,S,u[0]),$f(S,S,u[1]),qf(S,S,u[2]),S}},{key:"init",value:function(){var n=(0,Ct.Z)(Et().mark(function o(){var u,c,p,v,x,S,w,I,R,O,B,H,ae;return Et().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:u=this.config,c=u.id,p=c===void 0?"map":c,v=u.attributionControl,x=v===void 0?!1:v,S=u.style,w=S===void 0?"light":S,I=u.token,R=I===void 0?O2:I,O=u.rotation,B=O===void 0?0:O,H=u.mapInstance,ae=(0,hp.Z)(u,z7),this.viewport=new O7,!H&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===O2&&w!=="blank"&&!window.mapboxgl.accessToken&&!H&&console.warn(this.configService.getSceneWarninfo("MapToken")),!H&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),H?(this.map=H,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(p),this.map=new window.mapboxgl.Map((0,U.Z)({container:this.$mapContainer,style:this.getMapStyleValue(w),attributionControl:x,bearing:B},ae))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ie.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,c=new Array(u>1?u-1:0),p=1;p<u;p++)c[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(c))}},{key:"once",value:function(t){for(var o,u=arguments.length,c=new Array(u>1?u-1:0),p=1;p<u;p++)c[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(c))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Rv()).LngLat(t[0],t[1]),c=new(Rv()).LngLat(o[0],o[1]),p=u.distanceTo(c),v=Rv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),x=Rv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),S=v.x,w=v.y,I=x.x,R=x.y,O=Math.sqrt(Math.pow(S-I,2)+Math.pow(w-R,2))*4194304*2;return O/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+j7++,o.appendChild(u),u}}]),r}(N7))||R2);function H7(e){var i=W7();return function(){var n=(0,je.Z)(e),t;if(i){var o=(0,je.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,xr.Z)(this,t)}}function W7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function X7(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}X7(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Y7=function(e){(0,sr.Z)(r,e);var i=H7(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,xt.Z)(r,[{key:"getServiceConstructor",value:function(){return G7}}]),r}(C7);function D2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F2(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?D2(Object(r),!0).forEach(function(n){$7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function q7(e,i){return eP(e)||J7(e,i)||Q7(e,i)||K7()}function K7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q7(e,i){if(!!e){if(typeof e=="string")return B2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B2(e,i)}}function B2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function J7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function eP(e){if(Array.isArray(e))return e}var tP=re.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,re.createRef)(),c=(0,re.useState)(),p=q7(c,2),v=p[0],x=p[1];return(0,re.useEffect)(function(){var S=new y7(F2(F2({id:u.current},t),{},{map:new Y7(n)}));return S.on("loaded",function(){x(S),o&&o(S)}),function(){S.destroy()}},[]),(0,re.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,re.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,re.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,re.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,re.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),re.createElement(y.Provider,{value:v},(0,re.createElement)("div",{ref:u,style:i,className:r},v&&e.children))}),rP=tP;function N2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N2(Object(r),!0).forEach(function(n){nP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function g8(e,i){return sP(e)||oP(e,i)||aP(e,i)||iP()}function iP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aP(e,i){if(!!e){if(typeof e=="string")return z2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z2(e,i)}}function z2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function oP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function sP(e){if(Array.isArray(e))return e}var y8=null,_8=null;function Z2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function x8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Z2(Object(r),!0).forEach(function(n){uP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function b8(e,i){return hP(e)||fP(e,i)||cP(e,i)||lP()}function lP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cP(e,i){if(!!e){if(typeof e=="string")return U2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U2(e,i)}}function U2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function fP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function hP(e){if(Array.isArray(e))return e}var E8=null,S8=null;function C8(e,i){return mP(e)||vP(e,i)||dP(e,i)||pP()}function pP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dP(e,i){if(!!e){if(typeof e=="string")return V2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V2(e,i)}}function V2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function mP(e){if(Array.isArray(e))return e}var A8=null,w8=null;function j2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function T8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?j2(Object(r),!0).forEach(function(n){gP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function M8(e,i){if(e==null)return{};var r=yP(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function yP(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var I8=null,G2=Q(73935);function H2(e,i){return EP(e)||bP(e,i)||xP(e,i)||_P()}function _P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xP(e,i){if(!!e){if(typeof e=="string")return W2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W2(e,i)}}function W2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function EP(e){if(Array.isArray(e))return e}var X2=re.useEffect,Y2=re.useState,SP=/\B([A-Z])/g,CP=function(i){return i.replace(SP,"-$1").toLowerCase()};function k8(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=Y2(),u=H2(o,2),c=u[0],p=u[1],v=useSceneValue(),x=Y2(function(){return document.createElement("div")}),S=H2(x,1),w=S[0];return X2(function(){var I=new Control({position:t});return I.onAdd=function(){if(i&&(w.className=i),r){var R=Object.keys(r).map(function(O){return"".concat(CP(O),":").concat(r[O])}).join(";");w.style.cssText=R}return w},I.onRemove=function(){},p(I),v.addControl(I),function(){v.removeControl(I)}},[]),X2(function(){c&&c.setPosition(t||"bottomleft")},[t]),createPortal(n,w)}var $2=(0,re.createContext)({});function P8(){return useContext($2)}var L8=re.useEffect,AP=re.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},pt.isEqual),R8=re.useEffect,wP=re.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},pt.isEqual),O8=re.useEffect,TP=re.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},pt.isEqual),MP=re.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},pt.isEqual),IP=re.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},pt.isEqual),D8=re.useEffect,kP=re.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},pt.isEqual),PP=re.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},pt.isEqual),LP=re.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},pt.isEqual),RP=["data"];function OP(e,i){if(e==null)return{};var r=DP(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function DP(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var FP=re.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=OP(n,RP);return r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions),null},pt.isEqual),F8=re.useEffect,BP=re.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},pt.isEqual);function NP(e,i){return VP(e)||UP(e,i)||ZP(e,i)||zP()}function zP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZP(e,i){if(!!e){if(typeof e=="string")return q2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q2(e,i)}}function q2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function UP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,c;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,c=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw c}}return n}}function VP(e){if(Array.isArray(e))return e}var Dv=re.useEffect,jP=re.useState;function K2(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,c=i.scale,p=i.active,v=i.select,x=i.filter,S=i.animate,w=i.options,I=i.onLayerLoaded,R=Se(),O=jP(function(){var ae;switch(e){case"polygonLayer":ae=new tx(w);break;case"lineLayer":ae=new OM(w);break;case"pointLayer":ae=new P4(w);break;case"heatmapLayer":ae=new zw(w);break;case"rasterLayer":ae=new mI(w);break;case"imageLayer":ae=new n1(w);break;case"citybuildingLayer":ae=new cw(w);break;default:ae=new tx(w)}return ae.on("inited",function(){I&&I(ae,R)}),ae}),B=NP(O,1),H=B[0];return Dv(function(){return R.addLayer(H),function(){R.removeLayer(H)}},[]),Dv(function(){H.inited&&w&&H.updateLayerConfig(w)},[w==null?void 0:w.minZoom,w==null?void 0:w.maxZoom,w==null?void 0:w.visible]),Dv(function(){H.inited&&(w==null?void 0:w.zIndex)&&H.setIndex(w.zIndex)},[w==null?void 0:w.zIndex]),Dv(function(){H.inited&&(w==null?void 0:w.blend)&&H.setBlend(w.blend)},[w==null?void 0:w.blend]),Dv(function(){R.render()}),re.createElement($2.Provider,{value:H},re.createElement(FP,{layer:H,source:r}),c&&re.createElement(IP,{layer:H,scale:c}),n&&re.createElement(TP,{layer:H,color:n}),u&&re.createElement(LP,{layer:H,size:u}),t&&re.createElement(PP,{layer:H,shape:t}),o&&re.createElement(BP,{layer:H,style:o}),p&&re.createElement(AP,{layer:H,active:p}),v&&re.createElement(kP,{layer:H,select:v}),x&&re.createElement(MP,{layer:H,filter:x}),S&&re.createElement(wP,{layer:H,animate:S}),i.children)}var B8=null,N8=null,GP=re.memo(function(i){return K2("pointLayer",i)}),HP=re.memo(function(i){return K2("heatmapLayer",i)}),z8=null,Z8=null,U8=null,V8=re.useEffect,j8=null,G8=null;function U0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?U0=function(r){return typeof r}:U0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},U0(e)}function Q2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function V0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Q2(Object(r),!0).forEach(function(n){WP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function XP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function J2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function YP(e,i,r){return i&&J2(e.prototype,i),r&&J2(e,r),e}function $P(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&Jm(e,i)}function Jm(e,i){return Jm=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},Jm(e,i)}function qP(e){var i=JP();return function(){var n=j0(e),t;if(i){var o=j0(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return KP(this,t)}}function KP(e,i){if(i&&(U0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QP(e)}function QP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function j0(e){return j0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},j0(e)}var H8=function(e){$P(r,e);var i=qP(r);function r(n){var t;return XP(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.popup=void 0,t.el=document.createElement("div"),t}return YP(r,[{key:"componentDidMount",value:function(){var t,o=this.props,u=o.lnglat,c=o.children,p=o.option,v=o.lngLat,x=new hm(V0(V0({},p),{},{stopPropagation:(t=this.props.option)===null||t===void 0?void 0:t.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),c&&x.setDOMContent(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(t){var o,u,c,p,v,x,S=Array.isArray(t.lnglat)?t.lnglat:[t==null||(o=t.lnglat)===null||o===void 0?void 0:o.lng,t==null||(u=t.lnglat)===null||u===void 0?void 0:u.lat],w=Array.isArray(this.props.lnglat)?this.props.lnglat:[(c=this.props)===null||c===void 0||(p=c.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],I=S.toString()!==w.toString();if(I){var R;this.popup.remove(),this.popup=new hm(V0(V0({},this.props.option),{},{stopPropagation:(R=this.props.option)===null||R===void 0?void 0:R.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var t=this;return re.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,G2.createPortal)(t.props.children,t.el)})}}]),r}(re.PureComponent);function G0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?G0=function(r){return typeof r}:G0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},G0(e)}function eL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function eE(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tL(e,i,r){return i&&eE(e.prototype,i),r&&eE(e,r),e}function rL(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&eg(e,i)}function eg(e,i){return eg=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},eg(e,i)}function nL(e){var i=oL();return function(){var n=H0(e),t;if(i){var o=H0(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return iL(this,t)}}function iL(e,i){if(i&&(G0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aL(e)}function aL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function H0(e){return H0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},H0(e)}var W8=function(e){rL(r,e);var i=nL(r);function r(n){var t;return eL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.marker=void 0,t.el=document.createElement("div"),t}return tL(r,[{key:"componentDidMount",value:function(){var t=this.props,o=t.lnglat,u=t.children,c=t.option,p=t.onMarkerLoaded,v=new C_(c);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(t){var o,u=(t==null?void 0:t.lnglat.toString())!==((o=this.props)===null||o===void 0?void 0:o.lnglat.toString());u&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var t=this;return re.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,G2.createPortal)(t.props.children,t.el)})}}]),r}(re.PureComponent),X8=re.useEffect,Y8=null,$8=null,q8=re.useEffect,K8=null},66213:function(Fr,fe,Q){"use strict";Q.d(fe,{Z:function(){return y}});var Ae=Q(77608);function re(Se,W){for(;!Object.prototype.hasOwnProperty.call(Se,W)&&(Se=(0,Ae.Z)(Se),Se!==null););return Se}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(W,ge,ce){var Xe=re(W,ge);if(!!Xe){var me=Object.getOwnPropertyDescriptor(Xe,ge);return me.get?me.get.call(arguments.length<3?W:ce):me.value}},y.apply(this,arguments)}},59591:function(Fr,fe,Q){var Ae=Q(50008).default;function re(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fr.exports=re=function(){return y},Fr.exports.__esModule=!0,Fr.exports.default=Fr.exports;var y={},Se=Object.prototype,W=Se.hasOwnProperty,ge=Object.defineProperty||function(N,U,le){N[U]=le.value},ce=typeof Symbol=="function"?Symbol:{},Xe=ce.iterator||"@@iterator",me=ce.asyncIterator||"@@asyncIterator",qe=ce.toStringTag||"@@toStringTag";function lt(N,U,le){return Object.defineProperty(N,U,{value:le,enumerable:!0,configurable:!0,writable:!0}),N[U]}try{lt({},"")}catch(N){lt=function(le,He,Je){return le[He]=Je}}function bt(N,U,le,He){var Je=U&&U.prototype instanceof Nt?U:Nt,ft=Object.create(Je.prototype),Vt=new Lr(He||[]);return ge(ft,"_invoke",{value:ht(N,le,Vt)}),ft}function Pt(N,U,le){try{return{type:"normal",arg:N.call(U,le)}}catch(He){return{type:"throw",arg:He}}}y.wrap=bt;var ur={};function Nt(){}function pr(){}function Xt(){}var It={};lt(It,Xe,function(){return this});var kt=Object.getPrototypeOf,_r=kt&&kt(kt(te([])));_r&&_r!==Se&&W.call(_r,Xe)&&(It=_r);var J=Xt.prototype=Nt.prototype=Object.create(It);function lr(N){["next","throw","return"].forEach(function(U){lt(N,U,function(le){return this._invoke(U,le)})})}function Tt(N,U){function le(Je,ft,Vt,nr){var Zr=Pt(N[Je],N,ft);if(Zr.type!=="throw"){var Dr=Zr.arg,Xn=Dr.value;return Xn&&Ae(Xn)=="object"&&W.call(Xn,"__await")?U.resolve(Xn.__await).then(function(sn){le("next",sn,Vt,nr)},function(sn){le("throw",sn,Vt,nr)}):U.resolve(Xn).then(function(sn){Dr.value=sn,Vt(Dr)},function(sn){return le("throw",sn,Vt,nr)})}nr(Zr.arg)}var He;ge(this,"_invoke",{value:function(ft,Vt){function nr(){return new U(function(Zr,Dr){le(ft,Vt,Zr,Dr)})}return He=He?He.then(nr,nr):nr()}})}function ht(N,U,le){var He="suspendedStart";return function(Je,ft){if(He==="executing")throw new Error("Generator is already running");if(He==="completed"){if(Je==="throw")throw ft;return Ne()}for(le.method=Je,le.arg=ft;;){var Vt=le.delegate;if(Vt){var nr=Wt(Vt,le);if(nr){if(nr===ur)continue;return nr}}if(le.method==="next")le.sent=le._sent=le.arg;else if(le.method==="throw"){if(He==="suspendedStart")throw He="completed",le.arg;le.dispatchException(le.arg)}else le.method==="return"&&le.abrupt("return",le.arg);He="executing";var Zr=Pt(N,U,le);if(Zr.type==="normal"){if(He=le.done?"completed":"suspendedYield",Zr.arg===ur)continue;return{value:Zr.arg,done:le.done}}Zr.type==="throw"&&(He="completed",le.method="throw",le.arg=Zr.arg)}}}function Wt(N,U){var le=N.iterator[U.method];if(le===void 0){if(U.delegate=null,U.method==="throw"){if(N.iterator.return&&(U.method="return",U.arg=void 0,Wt(N,U),U.method==="throw"))return ur;U.method="throw",U.arg=new TypeError("The iterator does not provide a 'throw' method")}return ur}var He=Pt(le,N.iterator,U.arg);if(He.type==="throw")return U.method="throw",U.arg=He.arg,U.delegate=null,ur;var Je=He.arg;return Je?Je.done?(U[N.resultName]=Je.value,U.next=N.nextLoc,U.method!=="return"&&(U.method="next",U.arg=void 0),U.delegate=null,ur):Je:(U.method="throw",U.arg=new TypeError("iterator result is not an object"),U.delegate=null,ur)}function mt(N){var U={tryLoc:N[0]};1 in N&&(U.catchLoc=N[1]),2 in N&&(U.finallyLoc=N[2],U.afterLoc=N[3]),this.tryEntries.push(U)}function fr(N){var U=N.completion||{};U.type="normal",delete U.arg,N.completion=U}function Lr(N){this.tryEntries=[{tryLoc:"root"}],N.forEach(mt,this),this.reset(!0)}function te(N){if(N){var U=N[Xe];if(U)return U.call(N);if(typeof N.next=="function")return N;if(!isNaN(N.length)){var le=-1,He=function Je(){for(;++le<N.length;)if(W.call(N,le))return Je.value=N[le],Je.done=!1,Je;return Je.value=void 0,Je.done=!0,Je};return He.next=He}}return{next:Ne}}function Ne(){return{value:void 0,done:!0}}return pr.prototype=Xt,ge(J,"constructor",{value:Xt,configurable:!0}),ge(Xt,"constructor",{value:pr,configurable:!0}),pr.displayName=lt(Xt,qe,"GeneratorFunction"),y.isGeneratorFunction=function(N){var U=typeof N=="function"&&N.constructor;return!!U&&(U===pr||(U.displayName||U.name)==="GeneratorFunction")},y.mark=function(N){return Object.setPrototypeOf?Object.setPrototypeOf(N,Xt):(N.__proto__=Xt,lt(N,qe,"GeneratorFunction")),N.prototype=Object.create(J),N},y.awrap=function(N){return{__await:N}},lr(Tt.prototype),lt(Tt.prototype,me,function(){return this}),y.AsyncIterator=Tt,y.async=function(N,U,le,He,Je){Je===void 0&&(Je=Promise);var ft=new Tt(bt(N,U,le,He),Je);return y.isGeneratorFunction(U)?ft:ft.next().then(function(Vt){return Vt.done?Vt.value:ft.next()})},lr(J),lt(J,qe,"Generator"),lt(J,Xe,function(){return this}),lt(J,"toString",function(){return"[object Generator]"}),y.keys=function(N){var U=Object(N),le=[];for(var He in U)le.push(He);return le.reverse(),function Je(){for(;le.length;){var ft=le.pop();if(ft in U)return Je.value=ft,Je.done=!1,Je}return Je.done=!0,Je}},y.values=te,Lr.prototype={constructor:Lr,reset:function(U){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(fr),!U)for(var le in this)le.charAt(0)==="t"&&W.call(this,le)&&!isNaN(+le.slice(1))&&(this[le]=void 0)},stop:function(){this.done=!0;var U=this.tryEntries[0].completion;if(U.type==="throw")throw U.arg;return this.rval},dispatchException:function(U){if(this.done)throw U;var le=this;function He(Dr,Xn){return Vt.type="throw",Vt.arg=U,le.next=Dr,Xn&&(le.method="next",le.arg=void 0),!!Xn}for(var Je=this.tryEntries.length-1;Je>=0;--Je){var ft=this.tryEntries[Je],Vt=ft.completion;if(ft.tryLoc==="root")return He("end");if(ft.tryLoc<=this.prev){var nr=W.call(ft,"catchLoc"),Zr=W.call(ft,"finallyLoc");if(nr&&Zr){if(this.prev<ft.catchLoc)return He(ft.catchLoc,!0);if(this.prev<ft.finallyLoc)return He(ft.finallyLoc)}else if(nr){if(this.prev<ft.catchLoc)return He(ft.catchLoc,!0)}else{if(!Zr)throw new Error("try statement without catch or finally");if(this.prev<ft.finallyLoc)return He(ft.finallyLoc)}}}},abrupt:function(U,le){for(var He=this.tryEntries.length-1;He>=0;--He){var Je=this.tryEntries[He];if(Je.tryLoc<=this.prev&&W.call(Je,"finallyLoc")&&this.prev<Je.finallyLoc){var ft=Je;break}}ft&&(U==="break"||U==="continue")&&ft.tryLoc<=le&&le<=ft.finallyLoc&&(ft=null);var Vt=ft?ft.completion:{};return Vt.type=U,Vt.arg=le,ft?(this.method="next",this.next=ft.finallyLoc,ur):this.complete(Vt)},complete:function(U,le){if(U.type==="throw")throw U.arg;return U.type==="break"||U.type==="continue"?this.next=U.arg:U.type==="return"?(this.rval=this.arg=U.arg,this.method="return",this.next="end"):U.type==="normal"&&le&&(this.next=le),ur},finish:function(U){for(var le=this.tryEntries.length-1;le>=0;--le){var He=this.tryEntries[le];if(He.finallyLoc===U)return this.complete(He.completion,He.afterLoc),fr(He),ur}},catch:function(U){for(var le=this.tryEntries.length-1;le>=0;--le){var He=this.tryEntries[le];if(He.tryLoc===U){var Je=He.completion;if(Je.type==="throw"){var ft=Je.arg;fr(He)}return ft}}throw new Error("illegal catch attempt")},delegateYield:function(U,le,He){return this.delegate={iterator:te(U),resultName:le,nextLoc:He},this.method==="next"&&(this.arg=void 0),ur}},y}Fr.exports=re,Fr.exports.__esModule=!0,Fr.exports.default=Fr.exports},87757:function(Fr,fe,Q){var Ae=Q(59591)();Fr.exports=Ae;try{regeneratorRuntime=Ae}catch(re){typeof globalThis=="object"?globalThis.regeneratorRuntime=Ae:Function("r","regeneratorRuntime = r")(Ae)}},38163:function(Fr){Fr.exports=fe;function fe(re,y){var Se=re&&re.type,W;if(Se==="FeatureCollection")for(W=0;W<re.features.length;W++)fe(re.features[W],y);else if(Se==="GeometryCollection")for(W=0;W<re.geometries.length;W++)fe(re.geometries[W],y);else if(Se==="Feature")fe(re.geometry,y);else if(Se==="Polygon")Q(re.coordinates,y);else if(Se==="MultiPolygon")for(W=0;W<re.coordinates.length;W++)Q(re.coordinates[W],y);return re}function Q(re,y){if(re.length!==0){Ae(re[0],y);for(var Se=1;Se<re.length;Se++)Ae(re[Se],!y)}}function Ae(re,y){for(var Se=0,W=0,ge=0,ce=re.length,Xe=ce-1;ge<ce;Xe=ge++){var me=(re[ge][0]-re[Xe][0])*(re[Xe][1]+re[ge][1]),qe=Se+me;W+=Math.abs(Se)>=Math.abs(me)?Se-qe+me:me-qe+Se,Se=qe}Se+W>=0!=!!y&&re.reverse()}},75550:function(Fr){"use strict";Fr.exports=fe;function fe(Q,Ae){this.x=Q,this.y=Ae}fe.prototype={clone:function(){return new fe(this.x,this.y)},add:function(Q){return this.clone()._add(Q)},sub:function(Q){return this.clone()._sub(Q)},multByPoint:function(Q){return this.clone()._multByPoint(Q)},divByPoint:function(Q){return this.clone()._divByPoint(Q)},mult:function(Q){return this.clone()._mult(Q)},div:function(Q){return this.clone()._div(Q)},rotate:function(Q){return this.clone()._rotate(Q)},rotateAround:function(Q,Ae){return this.clone()._rotateAround(Q,Ae)},matMult:function(Q){return this.clone()._matMult(Q)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(Q){return this.x===Q.x&&this.y===Q.y},dist:function(Q){return Math.sqrt(this.distSqr(Q))},distSqr:function(Q){var Ae=Q.x-this.x,re=Q.y-this.y;return Ae*Ae+re*re},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(Q){return Math.atan2(this.y-Q.y,this.x-Q.x)},angleWith:function(Q){return this.angleWithSep(Q.x,Q.y)},angleWithSep:function(Q,Ae){return Math.atan2(this.x*Ae-this.y*Q,this.x*Q+this.y*Ae)},_matMult:function(Q){var Ae=Q[0]*this.x+Q[1]*this.y,re=Q[2]*this.x+Q[3]*this.y;return this.x=Ae,this.y=re,this},_add:function(Q){return this.x+=Q.x,this.y+=Q.y,this},_sub:function(Q){return this.x-=Q.x,this.y-=Q.y,this},_mult:function(Q){return this.x*=Q,this.y*=Q,this},_div:function(Q){return this.x/=Q,this.y/=Q,this},_multByPoint:function(Q){return this.x*=Q.x,this.y*=Q.y,this},_divByPoint:function(Q){return this.x/=Q.x,this.y/=Q.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var Q=this.y;return this.y=this.x,this.x=-Q,this},_rotate:function(Q){var Ae=Math.cos(Q),re=Math.sin(Q),y=Ae*this.x-re*this.y,Se=re*this.x+Ae*this.y;return this.x=y,this.y=Se,this},_rotateAround:function(Q,Ae){var re=Math.cos(Q),y=Math.sin(Q),Se=Ae.x+re*(this.x-Ae.x)-y*(this.y-Ae.y),W=Ae.y+y*(this.x-Ae.x)+re*(this.y-Ae.y);return this.x=Se,this.y=W,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fe.convert=function(Q){return Q instanceof fe?Q:Array.isArray(Q)?new fe(Q[0],Q[1]):Q}},38929:function(Fr,fe,Q){Fr.exports.VectorTile=Q(22779),Q(66024),Q(59701)},22779:function(Fr,fe,Q){"use strict";var Ae=Q(59701);Fr.exports=re;function re(Se,W){this.layers=Se.readFields(y,{},W)}function y(Se,W,ge){if(Se===3){var ce=new Ae(ge,ge.readVarint()+ge.pos);ce.length&&(W[ce.name]=ce)}}},66024:function(Fr,fe,Q){"use strict";var Ae=Q(75550);Fr.exports=re;function re(ce,Xe,me,qe,lt){this.properties={},this.extent=me,this.type=0,this._pbf=ce,this._geometry=-1,this._keys=qe,this._values=lt,ce.readFields(y,this,Xe)}function y(ce,Xe,me){ce==1?Xe.id=me.readVarint():ce==2?Se(me,Xe):ce==3?Xe.type=me.readVarint():ce==4&&(Xe._geometry=me.pos)}function Se(ce,Xe){for(var me=ce.readVarint()+ce.pos;ce.pos<me;){var qe=Xe._keys[ce.readVarint()],lt=Xe._values[ce.readVarint()];Xe.properties[qe]=lt}}re.types=["Unknown","Point","LineString","Polygon"],re.prototype.loadGeometry=function(){var ce=this._pbf;ce.pos=this._geometry;for(var Xe=ce.readVarint()+ce.pos,me=1,qe=0,lt=0,bt=0,Pt=[],ur;ce.pos<Xe;){if(qe<=0){var Nt=ce.readVarint();me=Nt&7,qe=Nt>>3}if(qe--,me===1||me===2)lt+=ce.readSVarint(),bt+=ce.readSVarint(),me===1&&(ur&&Pt.push(ur),ur=[]),ur.push(new Ae(lt,bt));else if(me===7)ur&&ur.push(ur[0].clone());else throw new Error("unknown command "+me)}return ur&&Pt.push(ur),Pt},re.prototype.bbox=function(){var ce=this._pbf;ce.pos=this._geometry;for(var Xe=ce.readVarint()+ce.pos,me=1,qe=0,lt=0,bt=0,Pt=Infinity,ur=-Infinity,Nt=Infinity,pr=-Infinity;ce.pos<Xe;){if(qe<=0){var Xt=ce.readVarint();me=Xt&7,qe=Xt>>3}if(qe--,me===1||me===2)lt+=ce.readSVarint(),bt+=ce.readSVarint(),lt<Pt&&(Pt=lt),lt>ur&&(ur=lt),bt<Nt&&(Nt=bt),bt>pr&&(pr=bt);else if(me!==7)throw new Error("unknown command "+me)}return[Pt,Nt,ur,pr]},re.prototype.toGeoJSON=function(ce,Xe,me){var qe=this.extent*Math.pow(2,me),lt=this.extent*ce,bt=this.extent*Xe,Pt=this.loadGeometry(),ur=re.types[this.type],Nt,pr;function Xt(_r){for(var J=0;J<_r.length;J++){var lr=_r[J],Tt=180-(lr.y+bt)*360/qe;_r[J]=[(lr.x+lt)*360/qe-180,360/Math.PI*Math.atan(Math.exp(Tt*Math.PI/180))-90]}}switch(this.type){case 1:var It=[];for(Nt=0;Nt<Pt.length;Nt++)It[Nt]=Pt[Nt][0];Pt=It,Xt(Pt);break;case 2:for(Nt=0;Nt<Pt.length;Nt++)Xt(Pt[Nt]);break;case 3:for(Pt=W(Pt),Nt=0;Nt<Pt.length;Nt++)for(pr=0;pr<Pt[Nt].length;pr++)Xt(Pt[Nt][pr]);break}Pt.length===1?Pt=Pt[0]:ur="Multi"+ur;var kt={type:"Feature",geometry:{type:ur,coordinates:Pt},properties:this.properties};return"id"in this&&(kt.id=this.id),kt};function W(ce){var Xe=ce.length;if(Xe<=1)return[ce];for(var me=[],qe,lt,bt=0;bt<Xe;bt++){var Pt=ge(ce[bt]);Pt!==0&&(lt===void 0&&(lt=Pt<0),lt===Pt<0?(qe&&me.push(qe),qe=[ce[bt]]):qe.push(ce[bt]))}return qe&&me.push(qe),me}function ge(ce){for(var Xe=0,me=0,qe=ce.length,lt=qe-1,bt,Pt;me<qe;lt=me++)bt=ce[me],Pt=ce[lt],Xe+=(Pt.x-bt.x)*(bt.y+Pt.y);return Xe}},59701:function(Fr,fe,Q){"use strict";var Ae=Q(66024);Fr.exports=re;function re(W,ge){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=W,this._keys=[],this._values=[],this._features=[],W.readFields(y,this,ge),this.length=this._features.length}function y(W,ge,ce){W===15?ge.version=ce.readVarint():W===1?ge.name=ce.readString():W===5?ge.extent=ce.readVarint():W===2?ge._features.push(ce.pos):W===3?ge._keys.push(ce.readString()):W===4&&ge._values.push(Se(ce))}function Se(W){for(var ge=null,ce=W.readVarint()+W.pos;W.pos<ce;){var Xe=W.readVarint()>>3;ge=Xe===1?W.readString():Xe===2?W.readFloat():Xe===3?W.readDouble():Xe===4?W.readVarint64():Xe===5?W.readVarint():Xe===6?W.readSVarint():Xe===7?W.readBoolean():null}return ge}re.prototype.feature=function(W){if(W<0||W>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[W];var ge=this._pbf.readVarint()+this._pbf.pos;return new Ae(this._pbf,ge,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},15746:function(Fr,fe,Q){"use strict";var Ae=Q(21584);fe.Z=Ae.Z},89032:function(Fr,fe,Q){"use strict";var Ae=Q(38663),re=Q.n(Ae),y=Q(6999)},71230:function(Fr,fe,Q){"use strict";var Ae=Q(92820);fe.Z=Ae.Z},13062:function(Fr,fe,Q){"use strict";var Ae=Q(38663),re=Q.n(Ae),y=Q(6999)},7277:function(Fr,fe,Q){"use strict";Q.d(fe,{Z:function(){return fr}});var Ae=Q(22122),re=Q(67294),y=Q(57838),Se=Q(96159),W=Q(96156),ge=Q(94184),ce=Q.n(ge),Xe=Q(53124),me=Q(90860),qe=Q(11726),lt=Q.n(qe),bt=function(te){var Ne=te.value,N=te.formatter,U=te.precision,le=te.decimalSeparator,He=te.groupSeparator,Je=He===void 0?"":He,ft=te.prefixCls,Vt;if(typeof N=="function")Vt=N(Ne);else{var nr=String(Ne),Zr=nr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Zr||nr==="-")Vt=nr;else{var Dr=Zr[1],Xn=Zr[2]||"0",sn=Zr[4]||"";Xn=Xn.replace(/\B(?=(\d{3})+(?!\d))/g,Je),typeof U=="number"&&(sn=lt()(sn,U,"0").slice(0,U>0?U:0)),sn&&(sn="".concat(le).concat(sn)),Vt=[re.createElement("span",{key:"int",className:"".concat(ft,"-content-value-int")},Dr,Xn),sn&&re.createElement("span",{key:"decimal",className:"".concat(ft,"-content-value-decimal")},sn)]}}return re.createElement("span",{className:"".concat(ft,"-content-value")},Vt)},Pt=bt,ur=function(te){var Ne=te.prefixCls,N=te.className,U=te.style,le=te.valueStyle,He=te.value,Je=He===void 0?0:He,ft=te.title,Vt=te.valueRender,nr=te.prefix,Zr=te.suffix,Dr=te.loading,Xn=Dr===void 0?!1:Dr,sn=te.direction,Nn=te.onMouseEnter,ra=te.onMouseLeave,xi=te.decimalSeparator,si=xi===void 0?".":xi,Ri=te.groupSeparator,ki=Ri===void 0?",":Ri,di=re.createElement(Pt,(0,Ae.Z)({decimalSeparator:si,groupSeparator:ki},te,{value:Je})),Yn=ce()(Ne,(0,W.Z)({},"".concat(Ne,"-rtl"),sn==="rtl"),N);return re.createElement("div",{className:Yn,style:U,onMouseEnter:Nn,onMouseLeave:ra},ft&&re.createElement("div",{className:"".concat(Ne,"-title")},ft),re.createElement(me.Z,{paragraph:!1,loading:Xn,className:"".concat(Ne,"-skeleton")},re.createElement("div",{style:le,className:"".concat(Ne,"-content")},nr&&re.createElement("span",{className:"".concat(Ne,"-content-prefix")},nr),Vt?Vt(di):di,Zr&&re.createElement("span",{className:"".concat(Ne,"-content-suffix")},Zr))))},Nt=(0,Xe.PG)({prefixCls:"statistic"})(ur),pr=Nt,Xt=Q(28481),It=Q(32475),kt=Q.n(It),_r=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function J(Lr,te){var Ne=Lr,N=/\[[^\]]*]/g,U=(te.match(N)||[]).map(function(ft){return ft.slice(1,-1)}),le=te.replace(N,"[]"),He=_r.reduce(function(ft,Vt){var nr=(0,Xt.Z)(Vt,2),Zr=nr[0],Dr=nr[1];if(ft.includes(Zr)){var Xn=Math.floor(Ne/Dr);return Ne-=Xn*Dr,ft.replace(new RegExp("".concat(Zr,"+"),"g"),function(sn){var Nn=sn.length;return kt()(Xn.toString(),Nn,"0")})}return ft},le),Je=0;return He.replace(N,function(){var ft=U[Je];return Je+=1,ft})}function lr(Lr,te){var Ne=te.format,N=Ne===void 0?"":Ne,U=new Date(Lr).getTime(),le=Date.now(),He=Math.max(U-le,0);return J(He,N)}var Tt=1e3/30;function ht(Lr){return new Date(Lr).getTime()}var Wt=function(te){var Ne=te.value,N=te.format,U=N===void 0?"HH:mm:ss":N,le=te.onChange,He=te.onFinish,Je=(0,y.Z)(),ft=re.useRef(null),Vt=function(){He==null||He(),ft.current&&(clearInterval(ft.current),ft.current=null)},nr=function(){var sn=ht(Ne);sn>=Date.now()&&(ft.current=setInterval(function(){Je(),le==null||le(sn-Date.now()),sn<Date.now()&&Vt()},Tt))};re.useEffect(function(){return nr(),function(){ft.current&&(clearInterval(ft.current),ft.current=null)}},[Ne]);var Zr=function(sn,Nn){return lr(sn,(0,Ae.Z)((0,Ae.Z)({},Nn),{format:U}))},Dr=function(sn){return(0,Se.Tm)(sn,{title:void 0})};return re.createElement(pr,(0,Ae.Z)({},te,{valueRender:Dr,formatter:Zr}))},mt=re.memo(Wt);pr.Countdown=mt;var fr=pr},95300:function(Fr,fe,Q){"use strict";var Ae=Q(38663),re=Q.n(Ae),y=Q(81903),Se=Q.n(y),W=Q(71748)},9187:function(Fr){"use strict";Fr.exports=fe,Fr.exports.default=fe;function fe(N,U,le){le=le||2;var He=U&&U.length,Je=He?U[0]*le:N.length,ft=Q(N,0,Je,le,!0),Vt=[];if(!ft||ft.next===ft.prev)return Vt;var nr,Zr,Dr,Xn,sn,Nn,ra;if(He&&(ft=ce(N,U,ft,le)),N.length>80*le){nr=Dr=N[0],Zr=Xn=N[1];for(var xi=le;xi<Je;xi+=le)sn=N[xi],Nn=N[xi+1],sn<nr&&(nr=sn),Nn<Zr&&(Zr=Nn),sn>Dr&&(Dr=sn),Nn>Xn&&(Xn=Nn);ra=Math.max(Dr-nr,Xn-Zr),ra=ra!==0?32767/ra:0}return re(ft,Vt,le,nr,Zr,ra,0),Vt}function Q(N,U,le,He,Je){var ft,Vt;if(Je===Ne(N,U,le,He)>0)for(ft=U;ft<le;ft+=He)Vt=fr(ft,N[ft],N[ft+1],Vt);else for(ft=le-He;ft>=U;ft-=He)Vt=fr(ft,N[ft],N[ft+1],Vt);return Vt&&kt(Vt,Vt.next)&&(Lr(Vt),Vt=Vt.next),Vt}function Ae(N,U){if(!N)return N;U||(U=N);var le=N,He;do if(He=!1,!le.steiner&&(kt(le,le.next)||It(le.prev,le,le.next)===0)){if(Lr(le),le=U=le.prev,le===le.next)break;He=!0}else le=le.next;while(He||le!==U);return U}function re(N,U,le,He,Je,ft,Vt){if(!!N){!Vt&&ft&&bt(N,He,Je,ft);for(var nr=N,Zr,Dr;N.prev!==N.next;){if(Zr=N.prev,Dr=N.next,ft?Se(N,He,Je,ft):y(N)){U.push(Zr.i/le|0),U.push(N.i/le|0),U.push(Dr.i/le|0),Lr(N),N=Dr.next,nr=Dr.next;continue}if(N=Dr,N===nr){Vt?Vt===1?(N=W(Ae(N),U,le),re(N,U,le,He,Je,ft,2)):Vt===2&&ge(N,U,le,He,Je,ft):re(Ae(N),U,le,He,Je,ft,1);break}}}}function y(N){var U=N.prev,le=N,He=N.next;if(It(U,le,He)>=0)return!1;for(var Je=U.x,ft=le.x,Vt=He.x,nr=U.y,Zr=le.y,Dr=He.y,Xn=Je<ft?Je<Vt?Je:Vt:ft<Vt?ft:Vt,sn=nr<Zr?nr<Dr?nr:Dr:Zr<Dr?Zr:Dr,Nn=Je>ft?Je>Vt?Je:Vt:ft>Vt?ft:Vt,ra=nr>Zr?nr>Dr?nr:Dr:Zr>Dr?Zr:Dr,xi=He.next;xi!==U;){if(xi.x>=Xn&&xi.x<=Nn&&xi.y>=sn&&xi.y<=ra&&pr(Je,nr,ft,Zr,Vt,Dr,xi.x,xi.y)&&It(xi.prev,xi,xi.next)>=0)return!1;xi=xi.next}return!0}function Se(N,U,le,He){var Je=N.prev,ft=N,Vt=N.next;if(It(Je,ft,Vt)>=0)return!1;for(var nr=Je.x,Zr=ft.x,Dr=Vt.x,Xn=Je.y,sn=ft.y,Nn=Vt.y,ra=nr<Zr?nr<Dr?nr:Dr:Zr<Dr?Zr:Dr,xi=Xn<sn?Xn<Nn?Xn:Nn:sn<Nn?sn:Nn,si=nr>Zr?nr>Dr?nr:Dr:Zr>Dr?Zr:Dr,Ri=Xn>sn?Xn>Nn?Xn:Nn:sn>Nn?sn:Nn,ki=ur(ra,xi,U,le,He),di=ur(si,Ri,U,le,He),Yn=N.prevZ,ri=N.nextZ;Yn&&Yn.z>=ki&&ri&&ri.z<=di;){if(Yn.x>=ra&&Yn.x<=si&&Yn.y>=xi&&Yn.y<=Ri&&Yn!==Je&&Yn!==Vt&&pr(nr,Xn,Zr,sn,Dr,Nn,Yn.x,Yn.y)&&It(Yn.prev,Yn,Yn.next)>=0||(Yn=Yn.prevZ,ri.x>=ra&&ri.x<=si&&ri.y>=xi&&ri.y<=Ri&&ri!==Je&&ri!==Vt&&pr(nr,Xn,Zr,sn,Dr,Nn,ri.x,ri.y)&&It(ri.prev,ri,ri.next)>=0))return!1;ri=ri.nextZ}for(;Yn&&Yn.z>=ki;){if(Yn.x>=ra&&Yn.x<=si&&Yn.y>=xi&&Yn.y<=Ri&&Yn!==Je&&Yn!==Vt&&pr(nr,Xn,Zr,sn,Dr,Nn,Yn.x,Yn.y)&&It(Yn.prev,Yn,Yn.next)>=0)return!1;Yn=Yn.prevZ}for(;ri&&ri.z<=di;){if(ri.x>=ra&&ri.x<=si&&ri.y>=xi&&ri.y<=Ri&&ri!==Je&&ri!==Vt&&pr(nr,Xn,Zr,sn,Dr,Nn,ri.x,ri.y)&&It(ri.prev,ri,ri.next)>=0)return!1;ri=ri.nextZ}return!0}function W(N,U,le){var He=N;do{var Je=He.prev,ft=He.next.next;!kt(Je,ft)&&_r(Je,He,He.next,ft)&&ht(Je,ft)&&ht(ft,Je)&&(U.push(Je.i/le|0),U.push(He.i/le|0),U.push(ft.i/le|0),Lr(He),Lr(He.next),He=N=ft),He=He.next}while(He!==N);return Ae(He)}function ge(N,U,le,He,Je,ft){var Vt=N;do{for(var nr=Vt.next.next;nr!==Vt.prev;){if(Vt.i!==nr.i&&Xt(Vt,nr)){var Zr=mt(Vt,nr);Vt=Ae(Vt,Vt.next),Zr=Ae(Zr,Zr.next),re(Vt,U,le,He,Je,ft,0),re(Zr,U,le,He,Je,ft,0);return}nr=nr.next}Vt=Vt.next}while(Vt!==N)}function ce(N,U,le,He){var Je=[],ft,Vt,nr,Zr,Dr;for(ft=0,Vt=U.length;ft<Vt;ft++)nr=U[ft]*He,Zr=ft<Vt-1?U[ft+1]*He:N.length,Dr=Q(N,nr,Zr,He,!1),Dr===Dr.next&&(Dr.steiner=!0),Je.push(Nt(Dr));for(Je.sort(Xe),ft=0;ft<Je.length;ft++)le=me(Je[ft],le);return le}function Xe(N,U){return N.x-U.x}function me(N,U){var le=qe(N,U);if(!le)return U;var He=mt(le,N);return Ae(He,He.next),Ae(le,le.next)}function qe(N,U){var le=U,He=N.x,Je=N.y,ft=-Infinity,Vt;do{if(Je<=le.y&&Je>=le.next.y&&le.next.y!==le.y){var nr=le.x+(Je-le.y)*(le.next.x-le.x)/(le.next.y-le.y);if(nr<=He&&nr>ft&&(ft=nr,Vt=le.x<le.next.x?le:le.next,nr===He))return Vt}le=le.next}while(le!==U);if(!Vt)return null;var Zr=Vt,Dr=Vt.x,Xn=Vt.y,sn=Infinity,Nn;le=Vt;do He>=le.x&&le.x>=Dr&&He!==le.x&&pr(Je<Xn?He:ft,Je,Dr,Xn,Je<Xn?ft:He,Je,le.x,le.y)&&(Nn=Math.abs(Je-le.y)/(He-le.x),ht(le,N)&&(Nn<sn||Nn===sn&&(le.x>Vt.x||le.x===Vt.x&&lt(Vt,le)))&&(Vt=le,sn=Nn)),le=le.next;while(le!==Zr);return Vt}function lt(N,U){return It(N.prev,N,U.prev)<0&&It(U.next,N,N.next)<0}function bt(N,U,le,He){var Je=N;do Je.z===0&&(Je.z=ur(Je.x,Je.y,U,le,He)),Je.prevZ=Je.prev,Je.nextZ=Je.next,Je=Je.next;while(Je!==N);Je.prevZ.nextZ=null,Je.prevZ=null,Pt(Je)}function Pt(N){var U,le,He,Je,ft,Vt,nr,Zr,Dr=1;do{for(le=N,N=null,ft=null,Vt=0;le;){for(Vt++,He=le,nr=0,U=0;U<Dr&&(nr++,He=He.nextZ,!!He);U++);for(Zr=Dr;nr>0||Zr>0&&He;)nr!==0&&(Zr===0||!He||le.z<=He.z)?(Je=le,le=le.nextZ,nr--):(Je=He,He=He.nextZ,Zr--),ft?ft.nextZ=Je:N=Je,Je.prevZ=ft,ft=Je;le=He}ft.nextZ=null,Dr*=2}while(Vt>1);return N}function ur(N,U,le,He,Je){return N=(N-le)*Je|0,U=(U-He)*Je|0,N=(N|N<<8)&16711935,N=(N|N<<4)&252645135,N=(N|N<<2)&858993459,N=(N|N<<1)&1431655765,U=(U|U<<8)&16711935,U=(U|U<<4)&252645135,U=(U|U<<2)&858993459,U=(U|U<<1)&1431655765,N|U<<1}function Nt(N){var U=N,le=N;do(U.x<le.x||U.x===le.x&&U.y<le.y)&&(le=U),U=U.next;while(U!==N);return le}function pr(N,U,le,He,Je,ft,Vt,nr){return(Je-Vt)*(U-nr)>=(N-Vt)*(ft-nr)&&(N-Vt)*(He-nr)>=(le-Vt)*(U-nr)&&(le-Vt)*(ft-nr)>=(Je-Vt)*(He-nr)}function Xt(N,U){return N.next.i!==U.i&&N.prev.i!==U.i&&!Tt(N,U)&&(ht(N,U)&&ht(U,N)&&Wt(N,U)&&(It(N.prev,N,U.prev)||It(N,U.prev,U))||kt(N,U)&&It(N.prev,N,N.next)>0&&It(U.prev,U,U.next)>0)}function It(N,U,le){return(U.y-N.y)*(le.x-U.x)-(U.x-N.x)*(le.y-U.y)}function kt(N,U){return N.x===U.x&&N.y===U.y}function _r(N,U,le,He){var Je=lr(It(N,U,le)),ft=lr(It(N,U,He)),Vt=lr(It(le,He,N)),nr=lr(It(le,He,U));return!!(Je!==ft&&Vt!==nr||Je===0&&J(N,le,U)||ft===0&&J(N,He,U)||Vt===0&&J(le,N,He)||nr===0&&J(le,U,He))}function J(N,U,le){return U.x<=Math.max(N.x,le.x)&&U.x>=Math.min(N.x,le.x)&&U.y<=Math.max(N.y,le.y)&&U.y>=Math.min(N.y,le.y)}function lr(N){return N>0?1:N<0?-1:0}function Tt(N,U){var le=N;do{if(le.i!==N.i&&le.next.i!==N.i&&le.i!==U.i&&le.next.i!==U.i&&_r(le,le.next,N,U))return!0;le=le.next}while(le!==N);return!1}function ht(N,U){return It(N.prev,N,N.next)<0?It(N,U,N.next)>=0&&It(N,N.prev,U)>=0:It(N,U,N.prev)<0||It(N,N.next,U)<0}function Wt(N,U){var le=N,He=!1,Je=(N.x+U.x)/2,ft=(N.y+U.y)/2;do le.y>ft!=le.next.y>ft&&le.next.y!==le.y&&Je<(le.next.x-le.x)*(ft-le.y)/(le.next.y-le.y)+le.x&&(He=!He),le=le.next;while(le!==N);return He}function mt(N,U){var le=new te(N.i,N.x,N.y),He=new te(U.i,U.x,U.y),Je=N.next,ft=U.prev;return N.next=U,U.prev=N,le.next=Je,Je.prev=le,He.next=le,le.prev=He,ft.next=He,He.prev=ft,He}function fr(N,U,le,He){var Je=new te(N,U,le);return He?(Je.next=He.next,Je.prev=He,He.next.prev=Je,He.next=Je):(Je.prev=Je,Je.next=Je),Je}function Lr(N){N.next.prev=N.prev,N.prev.next=N.next,N.prevZ&&(N.prevZ.nextZ=N.nextZ),N.nextZ&&(N.nextZ.prevZ=N.prevZ)}function te(N,U,le){this.i=N,this.x=U,this.y=le,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}fe.deviation=function(N,U,le,He){var Je=U&&U.length,ft=Je?U[0]*le:N.length,Vt=Math.abs(Ne(N,0,ft,le));if(Je)for(var nr=0,Zr=U.length;nr<Zr;nr++){var Dr=U[nr]*le,Xn=nr<Zr-1?U[nr+1]*le:N.length;Vt-=Math.abs(Ne(N,Dr,Xn,le))}var sn=0;for(nr=0;nr<He.length;nr+=3){var Nn=He[nr]*le,ra=He[nr+1]*le,xi=He[nr+2]*le;sn+=Math.abs((N[Nn]-N[xi])*(N[ra+1]-N[Nn+1])-(N[Nn]-N[ra])*(N[xi+1]-N[Nn+1]))}return Vt===0&&sn===0?0:Math.abs((sn-Vt)/Vt)};function Ne(N,U,le,He){for(var Je=0,ft=U,Vt=le-He;ft<le;ft+=He)Je+=(N[Vt]-N[ft])*(N[ft+1]+N[Vt+1]),Vt=ft;return Je}fe.flatten=function(N){for(var U=N[0][0].length,le={vertices:[],holes:[],dimensions:U},He=0,Je=0;Je<N.length;Je++){for(var ft=0;ft<N[Je].length;ft++)for(var Vt=0;Vt<U;Vt++)le.vertices.push(N[Je][ft][Vt]);Je>0&&(He+=N[Je-1].length,le.holes.push(He))}return le}},67709:function(Fr){function fe(Ae){var re=Ae.target||Ae.srcElement;re.__resizeRAF__&&cancelAnimationFrame(re.__resizeRAF__),re.__resizeRAF__=requestAnimationFrame(function(){var y=re.__resizeTrigger__,Se=y&&y.__resizeListeners__;Se&&Se.forEach(function(W){W.call(y,Ae)})})}var Q=function(re,y){var Se=this,W=Se.document,ge,ce=W.attachEvent;typeof navigator!="undefined"&&(ge=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Xe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",fe)}if(!re.__resizeListeners__)if(re.__resizeListeners__=[],ce)re.__resizeTrigger__=re,re.attachEvent("onresize",fe);else{getComputedStyle(re).position==="static"&&(re.style.position="relative");var me=re.__resizeTrigger__=W.createElement("object");me.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),me.setAttribute("class","resize-sensor"),me.setAttribute("tabindex","-1"),me.setAttribute("title",""),me.__resizeElement__=re,me.onload=Xe,me.type="text/html",ge&&re.appendChild(me),me.data="about:blank",ge||re.appendChild(me)}re.__resizeListeners__.push(y)};Fr.exports=typeof window=="undefined"?Q:Q.bind(window),Fr.exports.unbind=function(Ae,re){var y=document.attachEvent,Se=Ae.__resizeListeners__||[];if(re){var W=Se.indexOf(re);W!==-1&&Se.splice(W,1)}else Se=Ae.__resizeListeners__=[];if(!Se.length){if(y)Ae.detachEvent("onresize",fe);else if(Ae.__resizeTrigger__){var ge=Ae.__resizeTrigger__.contentDocument,ce=ge&&ge.defaultView;ce&&(ce.removeEventListener("resize",fe),delete ce.__resizeTrigger__),Ae.__resizeTrigger__=!Ae.removeChild(Ae.__resizeTrigger__)}delete Ae.__resizeListeners__}}},26729:function(Fr){"use strict";var fe=Object.prototype.hasOwnProperty,Q="~";function Ae(){}Object.create&&(Ae.prototype=Object.create(null),new Ae().__proto__||(Q=!1));function re(ge,ce,Xe){this.fn=ge,this.context=ce,this.once=Xe||!1}function y(ge,ce,Xe,me,qe){if(typeof Xe!="function")throw new TypeError("The listener must be a function");var lt=new re(Xe,me||ge,qe),bt=Q?Q+ce:ce;return ge._events[bt]?ge._events[bt].fn?ge._events[bt]=[ge._events[bt],lt]:ge._events[bt].push(lt):(ge._events[bt]=lt,ge._eventsCount++),ge}function Se(ge,ce){--ge._eventsCount==0?ge._events=new Ae:delete ge._events[ce]}function W(){this._events=new Ae,this._eventsCount=0}W.prototype.eventNames=function(){var ce=[],Xe,me;if(this._eventsCount===0)return ce;for(me in Xe=this._events)fe.call(Xe,me)&&ce.push(Q?me.slice(1):me);return Object.getOwnPropertySymbols?ce.concat(Object.getOwnPropertySymbols(Xe)):ce},W.prototype.listeners=function(ce){var Xe=Q?Q+ce:ce,me=this._events[Xe];if(!me)return[];if(me.fn)return[me.fn];for(var qe=0,lt=me.length,bt=new Array(lt);qe<lt;qe++)bt[qe]=me[qe].fn;return bt},W.prototype.listenerCount=function(ce){var Xe=Q?Q+ce:ce,me=this._events[Xe];return me?me.fn?1:me.length:0},W.prototype.emit=function(ce,Xe,me,qe,lt,bt){var Pt=Q?Q+ce:ce;if(!this._events[Pt])return!1;var ur=this._events[Pt],Nt=arguments.length,pr,Xt;if(ur.fn){switch(ur.once&&this.removeListener(ce,ur.fn,void 0,!0),Nt){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Xe),!0;case 3:return ur.fn.call(ur.context,Xe,me),!0;case 4:return ur.fn.call(ur.context,Xe,me,qe),!0;case 5:return ur.fn.call(ur.context,Xe,me,qe,lt),!0;case 6:return ur.fn.call(ur.context,Xe,me,qe,lt,bt),!0}for(Xt=1,pr=new Array(Nt-1);Xt<Nt;Xt++)pr[Xt-1]=arguments[Xt];ur.fn.apply(ur.context,pr)}else{var It=ur.length,kt;for(Xt=0;Xt<It;Xt++)switch(ur[Xt].once&&this.removeListener(ce,ur[Xt].fn,void 0,!0),Nt){case 1:ur[Xt].fn.call(ur[Xt].context);break;case 2:ur[Xt].fn.call(ur[Xt].context,Xe);break;case 3:ur[Xt].fn.call(ur[Xt].context,Xe,me);break;case 4:ur[Xt].fn.call(ur[Xt].context,Xe,me,qe);break;default:if(!pr)for(kt=1,pr=new Array(Nt-1);kt<Nt;kt++)pr[kt-1]=arguments[kt];ur[Xt].fn.apply(ur[Xt].context,pr)}}return!0},W.prototype.on=function(ce,Xe,me){return y(this,ce,Xe,me,!1)},W.prototype.once=function(ce,Xe,me){return y(this,ce,Xe,me,!0)},W.prototype.removeListener=function(ce,Xe,me,qe){var lt=Q?Q+ce:ce;if(!this._events[lt])return this;if(!Xe)return Se(this,lt),this;var bt=this._events[lt];if(bt.fn)bt.fn===Xe&&(!qe||bt.once)&&(!me||bt.context===me)&&Se(this,lt);else{for(var Pt=0,ur=[],Nt=bt.length;Pt<Nt;Pt++)(bt[Pt].fn!==Xe||qe&&!bt[Pt].once||me&&bt[Pt].context!==me)&&ur.push(bt[Pt]);ur.length?this._events[lt]=ur.length===1?ur[0]:ur:Se(this,lt)}return this},W.prototype.removeAllListeners=function(ce){var Xe;return ce?(Xe=Q?Q+ce:ce,this._events[Xe]&&Se(this,Xe)):(this._events=new Ae,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=Q,W.EventEmitter=W,Fr.exports=W},80645:function(Fr,fe){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */fe.read=function(Q,Ae,re,y,Se){var W,ge,ce=Se*8-y-1,Xe=(1<<ce)-1,me=Xe>>1,qe=-7,lt=re?Se-1:0,bt=re?-1:1,Pt=Q[Ae+lt];for(lt+=bt,W=Pt&(1<<-qe)-1,Pt>>=-qe,qe+=ce;qe>0;W=W*256+Q[Ae+lt],lt+=bt,qe-=8);for(ge=W&(1<<-qe)-1,W>>=-qe,qe+=y;qe>0;ge=ge*256+Q[Ae+lt],lt+=bt,qe-=8);if(W===0)W=1-me;else{if(W===Xe)return ge?NaN:(Pt?-1:1)*Infinity;ge=ge+Math.pow(2,y),W=W-me}return(Pt?-1:1)*ge*Math.pow(2,W-y)},fe.write=function(Q,Ae,re,y,Se,W){var ge,ce,Xe,me=W*8-Se-1,qe=(1<<me)-1,lt=qe>>1,bt=Se===23?Math.pow(2,-24)-Math.pow(2,-77):0,Pt=y?0:W-1,ur=y?1:-1,Nt=Ae<0||Ae===0&&1/Ae<0?1:0;for(Ae=Math.abs(Ae),isNaN(Ae)||Ae===Infinity?(ce=isNaN(Ae)?1:0,ge=qe):(ge=Math.floor(Math.log(Ae)/Math.LN2),Ae*(Xe=Math.pow(2,-ge))<1&&(ge--,Xe*=2),ge+lt>=1?Ae+=bt/Xe:Ae+=bt*Math.pow(2,1-lt),Ae*Xe>=2&&(ge++,Xe/=2),ge+lt>=qe?(ce=0,ge=qe):ge+lt>=1?(ce=(Ae*Xe-1)*Math.pow(2,Se),ge=ge+lt):(ce=Ae*Math.pow(2,lt-1)*Math.pow(2,Se),ge=0));Se>=8;Q[re+Pt]=ce&255,Pt+=ur,ce/=256,Se-=8);for(ge=ge<<Se|ce,me+=Se;me>0;Q[re+Pt]=ge&255,Pt+=ur,ge/=256,me-=8);Q[re+Pt-ur]|=Nt*128}},7375:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0});var Q=Symbol.for("INJECTION");function Ae(ge,ce,Xe,me){function qe(){return me&&!Reflect.hasMetadata(Q,this,ce)&&Reflect.defineMetadata(Q,Xe(),this,ce),Reflect.hasMetadata(Q,this,ce)?Reflect.getMetadata(Q,this,ce):Xe()}function lt(bt){Reflect.defineMetadata(Q,bt,this,ce)}Object.defineProperty(ge,ce,{configurable:!0,enumerable:!0,get:qe,set:lt})}function re(ge,ce){return function(Xe){return function(me,qe){var lt=function(){return ge.get(Xe)};Ae(me,qe,lt,ce)}}}fe.makePropertyInjectDecorator=re;function y(ge,ce){return function(Xe,me){return function(qe,lt){var bt=function(){return ge.getNamed(Xe,me)};Ae(qe,lt,bt,ce)}}}fe.makePropertyInjectNamedDecorator=y;function Se(ge,ce){return function(Xe,me,qe){return function(lt,bt){var Pt=function(){return ge.getTagged(Xe,me,qe)};Ae(lt,bt,Pt,ce)}}}fe.makePropertyInjectTaggedDecorator=Se;function W(ge,ce){return function(Xe){return function(me,qe){var lt=function(){return ge.getAll(Xe)};Ae(me,qe,lt,ce)}}}fe.makePropertyMultiInjectDecorator=W},84879:function(Fr,fe,Q){"use strict";var Ae;Ae={value:!0};var re=Q(7375);function y(Se,W){W===void 0&&(W=!0);var ge=re.makePropertyInjectDecorator(Se,W),ce=re.makePropertyInjectNamedDecorator(Se,W),Xe=re.makePropertyInjectTaggedDecorator(Se,W),me=re.makePropertyMultiInjectDecorator(Se,W);return{lazyInject:ge,lazyInjectNamed:ce,lazyInjectTagged:Xe,lazyMultiInject:me}}fe.Z=y},99934:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.tagProperty=fe.tagParameter=fe.decorate=void 0;var Ae=Q(16674),re=Q(6867);function y(me,qe,lt,bt){var Pt=re.TAGGED;W(Pt,me,qe,bt,lt)}fe.tagParameter=y;function Se(me,qe,lt){var bt=re.TAGGED_PROP;W(bt,me.constructor,qe,lt)}fe.tagProperty=Se;function W(me,qe,lt,bt,Pt){var ur={},Nt=typeof Pt=="number",pr=Pt!==void 0&&Nt?Pt.toString():lt;if(Nt&&lt!==void 0)throw new Error(Ae.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(me,qe)&&(ur=Reflect.getMetadata(me,qe));var Xt=ur[pr];if(!Array.isArray(Xt))Xt=[];else for(var It=0,kt=Xt;It<kt.length;It++){var _r=kt[It];if(_r.key===bt.key)throw new Error(Ae.DUPLICATED_METADATA+" "+_r.key.toString())}Xt.push(bt),ur[pr]=Xt,Reflect.defineMetadata(me,ur,qe)}function ge(me,qe){Reflect.decorate(me,qe)}function ce(me,qe){return function(lt,bt){qe(lt,bt,me)}}function Xe(me,qe,lt){typeof lt=="number"?ge([ce(lt,me)],qe):typeof lt=="string"?Reflect.decorate([me],qe,lt):ge([me],qe)}fe.decorate=Xe},5744:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.inject=fe.LazyServiceIdentifer=void 0;var Ae=Q(16674),re=Q(6867),y=Q(47738),Se=Q(99934),W=function(){function ce(Xe){this._cb=Xe}return ce.prototype.unwrap=function(){return this._cb()},ce}();fe.LazyServiceIdentifer=W;function ge(ce){return function(Xe,me,qe){if(ce===void 0)throw new Error(Ae.UNDEFINED_INJECT_ANNOTATION(Xe.name));var lt=new y.Metadata(re.INJECT_TAG,ce);typeof qe=="number"?Se.tagParameter(Xe,me,qe,lt):Se.tagProperty(Xe,me,lt)}}fe.inject=ge},64315:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.injectable=void 0;var Ae=Q(16674),re=Q(6867);function y(){return function(Se){if(Reflect.hasOwnMetadata(re.PARAM_TYPES,Se))throw new Error(Ae.DUPLICATED_INJECTABLE_DECORATOR);var W=Reflect.getMetadata(re.DESIGN_PARAM_TYPES,Se)||[];return Reflect.defineMetadata(re.PARAM_TYPES,W,Se),Se}}fe.injectable=y},71693:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.multiInject=void 0;var Ae=Q(6867),re=Q(47738),y=Q(99934);function Se(W){return function(ge,ce,Xe){var me=new re.Metadata(Ae.MULTI_INJECT_TAG,W);typeof Xe=="number"?y.tagParameter(ge,ce,Xe,me):y.tagProperty(ge,ce,me)}}fe.multiInject=Se},38085:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.named=void 0;var Ae=Q(6867),re=Q(47738),y=Q(99934);function Se(W){return function(ge,ce,Xe){var me=new re.Metadata(Ae.NAMED_TAG,W);typeof Xe=="number"?y.tagParameter(ge,ce,Xe,me):y.tagProperty(ge,ce,me)}}fe.named=Se},6515:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.optional=void 0;var Ae=Q(6867),re=Q(47738),y=Q(99934);function Se(){return function(W,ge,ce){var Xe=new re.Metadata(Ae.OPTIONAL_TAG,!0);typeof ce=="number"?y.tagParameter(W,ge,ce,Xe):y.tagProperty(W,ge,Xe)}}fe.optional=Se},7014:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.postConstruct=void 0;var Ae=Q(16674),re=Q(6867),y=Q(47738);function Se(){return function(W,ge,ce){var Xe=new y.Metadata(re.POST_CONSTRUCT,ge);if(Reflect.hasOwnMetadata(re.POST_CONSTRUCT,W.constructor))throw new Error(Ae.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(re.POST_CONSTRUCT,Xe,W.constructor)}}fe.postConstruct=Se},32052:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.tagged=void 0;var Ae=Q(47738),re=Q(99934);function y(Se,W){return function(ge,ce,Xe){var me=new Ae.Metadata(Se,W);typeof Xe=="number"?re.tagParameter(ge,ce,Xe,me):re.tagProperty(ge,ce,me)}}fe.tagged=y},55638:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.targetName=void 0;var Ae=Q(6867),re=Q(47738),y=Q(99934);function Se(W){return function(ge,ce,Xe){var me=new re.Metadata(Ae.NAME_TAG,W);y.tagParameter(ge,ce,Xe,me)}}fe.targetName=Se},86757:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.unmanaged=void 0;var Ae=Q(6867),re=Q(47738),y=Q(99934);function Se(){return function(W,ge,ce){var Xe=new re.Metadata(Ae.UNMANAGED_TAG,!0);y.tagParameter(W,ge,ce,Xe)}}fe.unmanaged=Se},44290:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Binding=void 0;var Ae=Q(28421),re=Q(37791),y=function(){function Se(W,ge){this.id=re.id(),this.activated=!1,this.serviceIdentifier=W,this.scope=ge,this.type=Ae.BindingTypeEnum.Invalid,this.constraint=function(ce){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Se.prototype.clone=function(){var W=new Se(this.serviceIdentifier,this.scope);return W.activated=W.scope===Ae.BindingScopeEnum.Singleton?this.activated:!1,W.implementationType=this.implementationType,W.dynamicValue=this.dynamicValue,W.scope=this.scope,W.type=this.type,W.factory=this.factory,W.provider=this.provider,W.constraint=this.constraint,W.onActivation=this.onActivation,W.cache=this.cache,W},Se}();fe.Binding=y},23184:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingCount=void 0;var Q={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};fe.BindingCount=Q},16674:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.STACK_OVERFLOW=fe.CIRCULAR_DEPENDENCY_IN_FACTORY=fe.POST_CONSTRUCT_ERROR=fe.MULTIPLE_POST_CONSTRUCT_METHODS=fe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=fe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=fe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=fe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=fe.ARGUMENTS_LENGTH_MISMATCH=fe.INVALID_DECORATOR_OPERATION=fe.INVALID_TO_SELF_VALUE=fe.INVALID_FUNCTION_BINDING=fe.INVALID_MIDDLEWARE_RETURN=fe.NO_MORE_SNAPSHOTS_AVAILABLE=fe.INVALID_BINDING_TYPE=fe.NOT_IMPLEMENTED=fe.CIRCULAR_DEPENDENCY=fe.UNDEFINED_INJECT_ANNOTATION=fe.MISSING_INJECT_ANNOTATION=fe.MISSING_INJECTABLE_ANNOTATION=fe.NOT_REGISTERED=fe.CANNOT_UNBIND=fe.AMBIGUOUS_MATCH=fe.KEY_NOT_FOUND=fe.NULL_ARGUMENT=fe.DUPLICATED_METADATA=fe.DUPLICATED_INJECTABLE_DECORATOR=void 0,fe.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",fe.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",fe.NULL_ARGUMENT="NULL argument",fe.KEY_NOT_FOUND="Key Not Found",fe.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",fe.CANNOT_UNBIND="Could not unbind serviceIdentifier:",fe.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",fe.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",fe.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Q=function(Se){return"@inject called with undefined this could mean that the class "+Se+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};fe.UNDEFINED_INJECT_ANNOTATION=Q,fe.CIRCULAR_DEPENDENCY="Circular dependency found:",fe.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",fe.INVALID_BINDING_TYPE="Invalid binding type:",fe.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",fe.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",fe.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",fe.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",fe.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Ae=function(){for(var Se=[],W=0;W<arguments.length;W++)Se[W]=arguments[W];return"The number of constructor arguments in the derived class "+(Se[0]+" must be >= than the number of constructor arguments of its base class.")};fe.ARGUMENTS_LENGTH_MISMATCH=Ae,fe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",fe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",fe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",fe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",fe.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var re=function(){for(var Se=[],W=0;W<arguments.length;W++)Se[W]=arguments[W];return"@postConstruct error in class "+Se[0]+": "+Se[1]};fe.POST_CONSTRUCT_ERROR=re;var y=function(){for(var Se=[],W=0;W<arguments.length;W++)Se[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+Se[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Se[1]+"'.")};fe.CIRCULAR_DEPENDENCY_IN_FACTORY=y,fe.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.TargetTypeEnum=fe.BindingTypeEnum=fe.BindingScopeEnum=void 0;var Q={Request:"Request",Singleton:"Singleton",Transient:"Transient"};fe.BindingScopeEnum=Q;var Ae={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};fe.BindingTypeEnum=Ae;var re={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};fe.TargetTypeEnum=re},6867:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.NON_CUSTOM_TAG_KEYS=fe.POST_CONSTRUCT=fe.DESIGN_PARAM_TYPES=fe.PARAM_TYPES=fe.TAGGED_PROP=fe.TAGGED=fe.MULTI_INJECT_TAG=fe.INJECT_TAG=fe.OPTIONAL_TAG=fe.UNMANAGED_TAG=fe.NAME_TAG=fe.NAMED_TAG=void 0,fe.NAMED_TAG="named",fe.NAME_TAG="name",fe.UNMANAGED_TAG="unmanaged",fe.OPTIONAL_TAG="optional",fe.INJECT_TAG="inject",fe.MULTI_INJECT_TAG="multi_inject",fe.TAGGED="inversify:tagged",fe.TAGGED_PROP="inversify:tagged_props",fe.PARAM_TYPES="inversify:paramtypes",fe.DESIGN_PARAM_TYPES="design:paramtypes",fe.POST_CONSTRUCT="post_construct";function Q(){return[fe.INJECT_TAG,fe.MULTI_INJECT_TAG,fe.NAME_TAG,fe.UNMANAGED_TAG,fe.NAMED_TAG,fe.OPTIONAL_TAG]}fe.NON_CUSTOM_TAG_KEYS=Q()},51389:function(Fr,fe,Q){"use strict";var Ae=this&&this.__awaiter||function(Xt,It,kt,_r){function J(lr){return lr instanceof kt?lr:new kt(function(Tt){Tt(lr)})}return new(kt||(kt=Promise))(function(lr,Tt){function ht(fr){try{mt(_r.next(fr))}catch(Lr){Tt(Lr)}}function Wt(fr){try{mt(_r.throw(fr))}catch(Lr){Tt(Lr)}}function mt(fr){fr.done?lr(fr.value):J(fr.value).then(ht,Wt)}mt((_r=_r.apply(Xt,It||[])).next())})},re=this&&this.__generator||function(Xt,It){var kt={label:0,sent:function(){if(lr[0]&1)throw lr[1];return lr[1]},trys:[],ops:[]},_r,J,lr,Tt;return Tt={next:ht(0),throw:ht(1),return:ht(2)},typeof Symbol=="function"&&(Tt[Symbol.iterator]=function(){return this}),Tt;function ht(mt){return function(fr){return Wt([mt,fr])}}function Wt(mt){if(_r)throw new TypeError("Generator is already executing.");for(;kt;)try{if(_r=1,J&&(lr=mt[0]&2?J.return:mt[0]?J.throw||((lr=J.return)&&lr.call(J),0):J.next)&&!(lr=lr.call(J,mt[1])).done)return lr;switch(J=0,lr&&(mt=[mt[0]&2,lr.value]),mt[0]){case 0:case 1:lr=mt;break;case 4:return kt.label++,{value:mt[1],done:!1};case 5:kt.label++,J=mt[1],mt=[0];continue;case 7:mt=kt.ops.pop(),kt.trys.pop();continue;default:if(lr=kt.trys,!(lr=lr.length>0&&lr[lr.length-1])&&(mt[0]===6||mt[0]===2)){kt=0;continue}if(mt[0]===3&&(!lr||mt[1]>lr[0]&&mt[1]<lr[3])){kt.label=mt[1];break}if(mt[0]===6&&kt.label<lr[1]){kt.label=lr[1],lr=mt;break}if(lr&&kt.label<lr[2]){kt.label=lr[2],kt.ops.push(mt);break}lr[2]&&kt.ops.pop(),kt.trys.pop();continue}mt=It.call(Xt,kt)}catch(fr){mt=[6,fr],J=0}finally{_r=lr=0}if(mt[0]&5)throw mt[1];return{value:mt[0]?mt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Xt,It){for(var kt=0,_r=It.length,J=Xt.length;kt<_r;kt++,J++)Xt[J]=It[kt];return Xt};Object.defineProperty(fe,"__esModule",{value:!0}),fe.Container=void 0;var Se=Q(44290),W=Q(16674),ge=Q(28421),ce=Q(6867),Xe=Q(51377),me=Q(86311),qe=Q(31927),lt=Q(15451),bt=Q(37791),Pt=Q(55800),ur=Q(85700),Nt=Q(80175),pr=function(){function Xt(It){this._appliedMiddleware=[];var kt=It||{};if(typeof kt!="object")throw new Error(""+W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(kt.defaultScope===void 0)kt.defaultScope=ge.BindingScopeEnum.Transient;else if(kt.defaultScope!==ge.BindingScopeEnum.Singleton&&kt.defaultScope!==ge.BindingScopeEnum.Transient&&kt.defaultScope!==ge.BindingScopeEnum.Request)throw new Error(""+W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(kt.autoBindInjectable===void 0)kt.autoBindInjectable=!1;else if(typeof kt.autoBindInjectable!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(kt.skipBaseClassChecks===void 0)kt.skipBaseClassChecks=!1;else if(typeof kt.skipBaseClassChecks!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:kt.autoBindInjectable,defaultScope:kt.defaultScope,skipBaseClassChecks:kt.skipBaseClassChecks},this.id=bt.id(),this._bindingDictionary=new Nt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Xe.MetadataReader}return Xt.merge=function(It,kt){for(var _r=[],J=2;J<arguments.length;J++)_r[J-2]=arguments[J];var lr=new Xt,Tt=y([It,kt],_r).map(function(mt){return me.getBindingDictionary(mt)}),ht=me.getBindingDictionary(lr);function Wt(mt,fr){mt.traverse(function(Lr,te){te.forEach(function(Ne){fr.add(Ne.serviceIdentifier,Ne.clone())})})}return Tt.forEach(function(mt){Wt(mt,ht)}),lr},Xt.prototype.load=function(){for(var It=[],kt=0;kt<arguments.length;kt++)It[kt]=arguments[kt];for(var _r=this._getContainerModuleHelpersFactory(),J=0,lr=It;J<lr.length;J++){var Tt=lr[J],ht=_r(Tt.id);Tt.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)}},Xt.prototype.loadAsync=function(){for(var It=[],kt=0;kt<arguments.length;kt++)It[kt]=arguments[kt];return Ae(this,void 0,void 0,function(){var _r,J,lr,Tt,ht;return re(this,function(Wt){switch(Wt.label){case 0:_r=this._getContainerModuleHelpersFactory(),J=0,lr=It,Wt.label=1;case 1:return J<lr.length?(Tt=lr[J],ht=_r(Tt.id),[4,Tt.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)]):[3,4];case 2:Wt.sent(),Wt.label=3;case 3:return J++,[3,1];case 4:return[2]}})})},Xt.prototype.unload=function(){for(var It=this,kt=[],_r=0;_r<arguments.length;_r++)kt[_r]=arguments[_r];var J=function(lr){return function(Tt){return Tt.moduleId===lr}};kt.forEach(function(lr){var Tt=J(lr.id);It._bindingDictionary.removeByCondition(Tt)})},Xt.prototype.bind=function(It){var kt=this.options.defaultScope||ge.BindingScopeEnum.Transient,_r=new Se.Binding(It,kt);return this._bindingDictionary.add(It,_r),new lt.BindingToSyntax(_r)},Xt.prototype.rebind=function(It){return this.unbind(It),this.bind(It)},Xt.prototype.unbind=function(It){try{this._bindingDictionary.remove(It)}catch(kt){throw new Error(W.CANNOT_UNBIND+" "+Pt.getServiceIdentifierAsString(It))}},Xt.prototype.unbindAll=function(){this._bindingDictionary=new Nt.Lookup},Xt.prototype.isBound=function(It){var kt=this._bindingDictionary.hasKey(It);return!kt&&this.parent&&(kt=this.parent.isBound(It)),kt},Xt.prototype.isBoundNamed=function(It,kt){return this.isBoundTagged(It,ce.NAMED_TAG,kt)},Xt.prototype.isBoundTagged=function(It,kt,_r){var J=!1;if(this._bindingDictionary.hasKey(It)){var lr=this._bindingDictionary.get(It),Tt=me.createMockRequest(this,It,kt,_r);J=lr.some(function(ht){return ht.constraint(Tt)})}return!J&&this.parent&&(J=this.parent.isBoundTagged(It,kt,_r)),J},Xt.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Xt.prototype.restore=function(){var It=this._snapshots.pop();if(It===void 0)throw new Error(W.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=It.bindings,this._middleware=It.middleware},Xt.prototype.createChild=function(It){var kt=new Xt(It||this.options);return kt.parent=this,kt},Xt.prototype.applyMiddleware=function(){for(var It=[],kt=0;kt<arguments.length;kt++)It[kt]=arguments[kt];this._appliedMiddleware=this._appliedMiddleware.concat(It);var _r=this._middleware?this._middleware:this._planAndResolve();this._middleware=It.reduce(function(J,lr){return lr(J)},_r)},Xt.prototype.applyCustomMetadataReader=function(It){this._metadataReader=It},Xt.prototype.get=function(It){return this._get(!1,!1,ge.TargetTypeEnum.Variable,It)},Xt.prototype.getTagged=function(It,kt,_r){return this._get(!1,!1,ge.TargetTypeEnum.Variable,It,kt,_r)},Xt.prototype.getNamed=function(It,kt){return this.getTagged(It,ce.NAMED_TAG,kt)},Xt.prototype.getAll=function(It){return this._get(!0,!0,ge.TargetTypeEnum.Variable,It)},Xt.prototype.getAllTagged=function(It,kt,_r){return this._get(!1,!0,ge.TargetTypeEnum.Variable,It,kt,_r)},Xt.prototype.getAllNamed=function(It,kt){return this.getAllTagged(It,ce.NAMED_TAG,kt)},Xt.prototype.resolve=function(It){var kt=this.createChild();return kt.bind(It).toSelf(),this._appliedMiddleware.forEach(function(_r){kt.applyMiddleware(_r)}),kt.get(It)},Xt.prototype._getContainerModuleHelpersFactory=function(){var It=this,kt=function(ht,Wt){ht._binding.moduleId=Wt},_r=function(ht){return function(Wt){var mt=It.bind.bind(It),fr=mt(Wt);return kt(fr,ht),fr}},J=function(ht){return function(Wt){var mt=It.unbind.bind(It);mt(Wt)}},lr=function(ht){return function(Wt){var mt=It.isBound.bind(It);return mt(Wt)}},Tt=function(ht){return function(Wt){var mt=It.rebind.bind(It),fr=mt(Wt);return kt(fr,ht),fr}};return function(ht){return{bindFunction:_r(ht),isboundFunction:lr(ht),rebindFunction:Tt(ht),unbindFunction:J(ht)}}},Xt.prototype._get=function(It,kt,_r,J,lr,Tt){var ht=null,Wt={avoidConstraints:It,contextInterceptor:function(mt){return mt},isMultiInject:kt,key:lr,serviceIdentifier:J,targetType:_r,value:Tt};if(this._middleware){if(ht=this._middleware(Wt),ht==null)throw new Error(W.INVALID_MIDDLEWARE_RETURN)}else ht=this._planAndResolve()(Wt);return ht},Xt.prototype._planAndResolve=function(){var It=this;return function(kt){var _r=me.plan(It._metadataReader,It,kt.isMultiInject,kt.targetType,kt.serviceIdentifier,kt.key,kt.value,kt.avoidConstraints);_r=kt.contextInterceptor(_r);var J=qe.resolve(_r);return J}},Xt}();fe.Container=pr},33244:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.AsyncContainerModule=fe.ContainerModule=void 0;var Ae=Q(37791),re=function(){function Se(W){this.id=Ae.id(),this.registry=W}return Se}();fe.ContainerModule=re;var y=function(){function Se(W){this.id=Ae.id(),this.registry=W}return Se}();fe.AsyncContainerModule=y},85700:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.ContainerSnapshot=void 0;var Q=function(){function Ae(){}return Ae.of=function(re,y){var Se=new Ae;return Se.bindings=re,Se.middleware=y,Se},Ae}();fe.ContainerSnapshot=Q},80175:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Lookup=void 0;var Ae=Q(16674),re=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Se,W){if(Se==null)throw new Error(Ae.NULL_ARGUMENT);if(W==null)throw new Error(Ae.NULL_ARGUMENT);var ge=this._map.get(Se);ge!==void 0?(ge.push(W),this._map.set(Se,ge)):this._map.set(Se,[W])},y.prototype.get=function(Se){if(Se==null)throw new Error(Ae.NULL_ARGUMENT);var W=this._map.get(Se);if(W!==void 0)return W;throw new Error(Ae.KEY_NOT_FOUND)},y.prototype.remove=function(Se){if(Se==null)throw new Error(Ae.NULL_ARGUMENT);if(!this._map.delete(Se))throw new Error(Ae.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Se){var W=this;this._map.forEach(function(ge,ce){var Xe=ge.filter(function(me){return!Se(me)});Xe.length>0?W._map.set(ce,Xe):W._map.delete(ce)})},y.prototype.hasKey=function(Se){if(Se==null)throw new Error(Ae.NULL_ARGUMENT);return this._map.has(Se)},y.prototype.clone=function(){var Se=new y;return this._map.forEach(function(W,ge){W.forEach(function(ce){return Se.add(ge,ce.clone())})}),Se},y.prototype.traverse=function(Se){this._map.forEach(function(W,ge){Se(ge,W)})},y}();fe.Lookup=re},86700:function(Fr,fe,Q){"use strict";var Ae;Ae={value:!0},Ae=Ae=Ae=Ae=Ae=Ae=fe.GW=Ae=Ae=fe.zY=Ae=Ae=Ae=Ae=Ae=fe.f3=Ae=Ae=fe.b2=Ae=Ae=Ae=Ae=Ae=fe.W2=Ae=void 0;var re=Q(6867);Ae=re;var y=Q(51389);Object.defineProperty(fe,"W2",{enumerable:!0,get:function(){return y.Container}});var Se=Q(28421);Ae={enumerable:!0,get:function(){return Se.BindingScopeEnum}},Ae={enumerable:!0,get:function(){return Se.BindingTypeEnum}},Ae={enumerable:!0,get:function(){return Se.TargetTypeEnum}};var W=Q(33244);Ae={enumerable:!0,get:function(){return W.AsyncContainerModule}},Ae={enumerable:!0,get:function(){return W.ContainerModule}};var ge=Q(64315);Object.defineProperty(fe,"b2",{enumerable:!0,get:function(){return ge.injectable}});var ce=Q(32052);Ae={enumerable:!0,get:function(){return ce.tagged}};var Xe=Q(38085);Ae={enumerable:!0,get:function(){return Xe.named}};var me=Q(5744);Object.defineProperty(fe,"f3",{enumerable:!0,get:function(){return me.inject}}),Ae={enumerable:!0,get:function(){return me.LazyServiceIdentifer}};var qe=Q(6515);Ae={enumerable:!0,get:function(){return qe.optional}};var lt=Q(86757);Ae={enumerable:!0,get:function(){return lt.unmanaged}};var bt=Q(71693);Ae={enumerable:!0,get:function(){return bt.multiInject}};var Pt=Q(55638);Ae={enumerable:!0,get:function(){return Pt.targetName}};var ur=Q(7014);Object.defineProperty(fe,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var Nt=Q(51377);Ae={enumerable:!0,get:function(){return Nt.MetadataReader}};var pr=Q(37791);Ae={enumerable:!0,get:function(){return pr.id}};var Xt=Q(99934);Object.defineProperty(fe,"GW",{enumerable:!0,get:function(){return Xt.decorate}});var It=Q(80758);Ae={enumerable:!0,get:function(){return It.traverseAncerstors}},Ae={enumerable:!0,get:function(){return It.taggedConstraint}},Ae={enumerable:!0,get:function(){return It.namedConstraint}},Ae={enumerable:!0,get:function(){return It.typeConstraint}};var kt=Q(55800);Ae={enumerable:!0,get:function(){return kt.getServiceIdentifierAsString}};var _r=Q(70600);Ae={enumerable:!0,get:function(){return _r.multiBindToService}}},95228:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Context=void 0;var Ae=Q(37791),re=function(){function y(Se){this.id=Ae.id(),this.container=Se}return y.prototype.addPlan=function(Se){this.plan=Se},y.prototype.setCurrentRequest=function(Se){this.currentRequest=Se},y}();fe.Context=re},47738:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Metadata=void 0;var Ae=Q(6867),re=function(){function y(Se,W){this.key=Se,this.value=W}return y.prototype.toString=function(){return this.key===Ae.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();fe.Metadata=re},51377:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.MetadataReader=void 0;var Ae=Q(6867),re=function(){function y(){}return y.prototype.getConstructorMetadata=function(Se){var W=Reflect.getMetadata(Ae.PARAM_TYPES,Se),ge=Reflect.getMetadata(Ae.TAGGED,Se);return{compilerGeneratedMetadata:W,userGeneratedMetadata:ge||{}}},y.prototype.getPropertiesMetadata=function(Se){var W=Reflect.getMetadata(Ae.TAGGED_PROP,Se)||[];return W},y}();fe.MetadataReader=re},55314:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Plan=void 0;var Q=function(){function Ae(re,y){this.parentContext=re,this.rootRequest=y}return Ae}();fe.Plan=Q},86311:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.getBindingDictionary=fe.createMockRequest=fe.plan=void 0;var Ae=Q(23184),re=Q(16674),y=Q(28421),Se=Q(6867),W=Q(85265),ge=Q(55800),ce=Q(95228),Xe=Q(47738),me=Q(55314),qe=Q(6e3),lt=Q(6748),bt=Q(18924);function Pt(J){return J._bindingDictionary}fe.getBindingDictionary=Pt;function ur(J,lr,Tt,ht,Wt,mt){var fr=J?Se.MULTI_INJECT_TAG:Se.INJECT_TAG,Lr=new Xe.Metadata(fr,Tt),te=new bt.Target(lr,ht,Tt,Lr);if(Wt!==void 0){var Ne=new Xe.Metadata(Wt,mt);te.metadata.push(Ne)}return te}function Nt(J,lr,Tt,ht,Wt){var mt=It(Tt.container,Wt.serviceIdentifier),fr=[];return mt.length===Ae.BindingCount.NoBindingsAvailable&&Tt.container.options.autoBindInjectable&&typeof Wt.serviceIdentifier=="function"&&J.getConstructorMetadata(Wt.serviceIdentifier).compilerGeneratedMetadata&&(Tt.container.bind(Wt.serviceIdentifier).toSelf(),mt=It(Tt.container,Wt.serviceIdentifier)),lr?fr=mt:fr=mt.filter(function(Lr){var te=new lt.Request(Lr.serviceIdentifier,Tt,ht,Lr,Wt);return Lr.constraint(te)}),pr(Wt.serviceIdentifier,fr,Wt,Tt.container),fr}function pr(J,lr,Tt,ht){switch(lr.length){case Ae.BindingCount.NoBindingsAvailable:if(Tt.isOptional())return lr;var Wt=ge.getServiceIdentifierAsString(J),mt=re.NOT_REGISTERED;throw mt+=ge.listMetadataForTarget(Wt,Tt),mt+=ge.listRegisteredBindingsForServiceIdentifier(ht,Wt,It),new Error(mt);case Ae.BindingCount.OnlyOneBindingAvailable:if(!Tt.isArray())return lr;case Ae.BindingCount.MultipleBindingsAvailable:default:if(Tt.isArray())return lr;var Wt=ge.getServiceIdentifierAsString(J),mt=re.AMBIGUOUS_MATCH+" "+Wt;throw mt+=ge.listRegisteredBindingsForServiceIdentifier(ht,Wt,It),new Error(mt)}}function Xt(J,lr,Tt,ht,Wt,mt){var fr,Lr;if(Wt===null){fr=Nt(J,lr,ht,null,mt),Lr=new lt.Request(Tt,ht,null,fr,mt);var te=new me.Plan(ht,Lr);ht.addPlan(te)}else fr=Nt(J,lr,ht,Wt,mt),Lr=Wt.addChildRequest(mt.serviceIdentifier,fr,mt);fr.forEach(function(Ne){var N=null;if(mt.isArray())N=Lr.addChildRequest(Ne.serviceIdentifier,Ne,mt);else{if(Ne.cache)return;N=Lr}if(Ne.type===y.BindingTypeEnum.Instance&&Ne.implementationType!==null){var U=qe.getDependencies(J,Ne.implementationType);if(!ht.container.options.skipBaseClassChecks){var le=qe.getBaseClassDependencyCount(J,Ne.implementationType);if(U.length<le){var He=re.ARGUMENTS_LENGTH_MISMATCH(qe.getFunctionName(Ne.implementationType));throw new Error(He)}}U.forEach(function(Je){Xt(J,!1,Je.serviceIdentifier,ht,N,Je)})}})}function It(J,lr){var Tt=[],ht=Pt(J);return ht.hasKey(lr)?Tt=ht.get(lr):J.parent!==null&&(Tt=It(J.parent,lr)),Tt}function kt(J,lr,Tt,ht,Wt,mt,fr,Lr){Lr===void 0&&(Lr=!1);var te=new ce.Context(lr),Ne=ur(Tt,ht,Wt,"",mt,fr);try{return Xt(J,Lr,Wt,te,null,Ne),te}catch(N){throw W.isStackOverflowExeption(N)&&te.plan&&ge.circularDependencyToException(te.plan.rootRequest),N}}fe.plan=kt;function _r(J,lr,Tt,ht){var Wt=new bt.Target(y.TargetTypeEnum.Variable,"",lr,new Xe.Metadata(Tt,ht)),mt=new ce.Context(J),fr=new lt.Request(lr,mt,null,[],Wt);return fr}fe.createMockRequest=_r},88460:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.QueryableString=void 0;var Q=function(){function Ae(re){this.str=re}return Ae.prototype.startsWith=function(re){return this.str.indexOf(re)===0},Ae.prototype.endsWith=function(re){var y="",Se=re.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Se)},Ae.prototype.contains=function(re){return this.str.indexOf(re)!==-1},Ae.prototype.equals=function(re){return this.str===re},Ae.prototype.value=function(){return this.str},Ae}();fe.QueryableString=Q},6e3:function(Fr,fe,Q){"use strict";var Ae=this&&this.__spreadArray||function(Nt,pr){for(var Xt=0,It=pr.length,kt=Nt.length;Xt<It;Xt++,kt++)Nt[kt]=pr[Xt];return Nt};Object.defineProperty(fe,"__esModule",{value:!0}),fe.getFunctionName=fe.getBaseClassDependencyCount=fe.getDependencies=void 0;var re=Q(5744),y=Q(16674),Se=Q(28421),W=Q(6867),ge=Q(55800);Object.defineProperty(fe,"getFunctionName",{enumerable:!0,get:function(){return ge.getFunctionName}});var ce=Q(18924);function Xe(Nt,pr){var Xt=ge.getFunctionName(pr),It=me(Nt,Xt,pr,!1);return It}fe.getDependencies=Xe;function me(Nt,pr,Xt,It){var kt=Nt.getConstructorMetadata(Xt),_r=kt.compilerGeneratedMetadata;if(_r===void 0){var J=y.MISSING_INJECTABLE_ANNOTATION+" "+pr+".";throw new Error(J)}var lr=kt.userGeneratedMetadata,Tt=Object.keys(lr),ht=Xt.length===0&&Tt.length>0,Wt=Tt.length>Xt.length,mt=ht||Wt?Tt.length:Xt.length,fr=lt(It,pr,_r,lr,mt),Lr=bt(Nt,Xt),te=Ae(Ae([],fr),Lr);return te}function qe(Nt,pr,Xt,It,kt){var _r=kt[Nt.toString()]||[],J=ur(_r),lr=J.unmanaged!==!0,Tt=It[Nt],ht=J.inject||J.multiInject;if(Tt=ht||Tt,Tt instanceof re.LazyServiceIdentifer&&(Tt=Tt.unwrap()),lr){var Wt=Tt===Object,mt=Tt===Function,fr=Tt===void 0,Lr=Wt||mt||fr;if(!pr&&Lr){var te=y.MISSING_INJECT_ANNOTATION+" argument "+Nt+" in class "+Xt+".";throw new Error(te)}var Ne=new ce.Target(Se.TargetTypeEnum.ConstructorArgument,J.targetName,Tt);return Ne.metadata=_r,Ne}return null}function lt(Nt,pr,Xt,It,kt){for(var _r=[],J=0;J<kt;J++){var lr=J,Tt=qe(lr,Nt,pr,Xt,It);Tt!==null&&_r.push(Tt)}return _r}function bt(Nt,pr){for(var Xt=Nt.getPropertiesMetadata(pr),It=[],kt=Object.keys(Xt),_r=0,J=kt;_r<J.length;_r++){var lr=J[_r],Tt=Xt[lr],ht=ur(Xt[lr]),Wt=ht.targetName||lr,mt=ht.inject||ht.multiInject,fr=new ce.Target(Se.TargetTypeEnum.ClassProperty,Wt,mt);fr.metadata=Tt,It.push(fr)}var Lr=Object.getPrototypeOf(pr.prototype).constructor;if(Lr!==Object){var te=bt(Nt,Lr);It=Ae(Ae([],It),te)}return It}function Pt(Nt,pr){var Xt=Object.getPrototypeOf(pr.prototype).constructor;if(Xt!==Object){var It=ge.getFunctionName(Xt),kt=me(Nt,It,Xt,!0),_r=kt.map(function(Tt){return Tt.metadata.filter(function(ht){return ht.key===W.UNMANAGED_TAG})}),J=[].concat.apply([],_r).length,lr=kt.length-J;return lr>0?lr:Pt(Nt,Xt)}else return 0}fe.getBaseClassDependencyCount=Pt;function ur(Nt){var pr={};return Nt.forEach(function(Xt){pr[Xt.key.toString()]=Xt.value}),{inject:pr[W.INJECT_TAG],multiInject:pr[W.MULTI_INJECT_TAG],targetName:pr[W.NAME_TAG],unmanaged:pr[W.UNMANAGED_TAG]}}},6748:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Request=void 0;var Ae=Q(37791),re=function(){function y(Se,W,ge,ce,Xe){this.id=Ae.id(),this.serviceIdentifier=Se,this.parentContext=W,this.parentRequest=ge,this.target=Xe,this.childRequests=[],this.bindings=Array.isArray(ce)?ce:[ce],this.requestScope=ge===null?new Map:null}return y.prototype.addChildRequest=function(Se,W,ge){var ce=new y(Se,this.parentContext,this,W,ge);return this.childRequests.push(ce),ce},y}();fe.Request=re},18924:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.Target=void 0;var Ae=Q(6867),re=Q(37791),y=Q(47738),Se=Q(88460),W=function(){function ge(ce,Xe,me,qe){this.id=re.id(),this.type=ce,this.serviceIdentifier=me,this.name=new Se.QueryableString(Xe||""),this.metadata=new Array;var lt=null;typeof qe=="string"?lt=new y.Metadata(Ae.NAMED_TAG,qe):qe instanceof y.Metadata&&(lt=qe),lt!==null&&this.metadata.push(lt)}return ge.prototype.hasTag=function(ce){for(var Xe=0,me=this.metadata;Xe<me.length;Xe++){var qe=me[Xe];if(qe.key===ce)return!0}return!1},ge.prototype.isArray=function(){return this.hasTag(Ae.MULTI_INJECT_TAG)},ge.prototype.matchesArray=function(ce){return this.matchesTag(Ae.MULTI_INJECT_TAG)(ce)},ge.prototype.isNamed=function(){return this.hasTag(Ae.NAMED_TAG)},ge.prototype.isTagged=function(){return this.metadata.some(function(ce){return Ae.NON_CUSTOM_TAG_KEYS.every(function(Xe){return ce.key!==Xe})})},ge.prototype.isOptional=function(){return this.matchesTag(Ae.OPTIONAL_TAG)(!0)},ge.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ce){return ce.key===Ae.NAMED_TAG})[0]:null},ge.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ce){return Ae.NON_CUSTOM_TAG_KEYS.every(function(Xe){return ce.key!==Xe})}):null},ge.prototype.matchesNamedTag=function(ce){return this.matchesTag(Ae.NAMED_TAG)(ce)},ge.prototype.matchesTag=function(ce){var Xe=this;return function(me){for(var qe=0,lt=Xe.metadata;qe<lt.length;qe++){var bt=lt[qe];if(bt.key===ce&&bt.value===me)return!0}return!1}},ge}();fe.Target=W},52279:function(Fr,fe,Q){"use strict";var Ae=this&&this.__spreadArray||function(me,qe){for(var lt=0,bt=qe.length,Pt=me.length;lt<bt;lt++,Pt++)me[Pt]=qe[lt];return me};Object.defineProperty(fe,"__esModule",{value:!0}),fe.resolveInstance=void 0;var re=Q(16674),y=Q(28421),Se=Q(6867);function W(me,qe,lt){var bt=qe.filter(function(ur){return ur.target!==null&&ur.target.type===y.TargetTypeEnum.ClassProperty}),Pt=bt.map(lt);return bt.forEach(function(ur,Nt){var pr="";pr=ur.target.name.value();var Xt=Pt[Nt];me[pr]=Xt}),me}function ge(me,qe){return new(me.bind.apply(me,Ae([void 0],qe)))}function ce(me,qe){if(Reflect.hasMetadata(Se.POST_CONSTRUCT,me)){var lt=Reflect.getMetadata(Se.POST_CONSTRUCT,me);try{qe[lt.value]()}catch(bt){throw new Error(re.POST_CONSTRUCT_ERROR(me.name,bt.message))}}}function Xe(me,qe,lt){var bt=null;if(qe.length>0){var Pt=qe.filter(function(Nt){return Nt.target!==null&&Nt.target.type===y.TargetTypeEnum.ConstructorArgument}),ur=Pt.map(lt);bt=ge(me,ur),bt=W(bt,qe,lt)}else bt=new me;return ce(me,bt),bt}fe.resolveInstance=Xe},31927:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.resolve=void 0;var Ae=Q(16674),re=Q(28421),y=Q(85265),Se=Q(55800),W=Q(52279),ge=function(me,qe,lt){try{return lt()}catch(bt){throw y.isStackOverflowExeption(bt)?new Error(Ae.CIRCULAR_DEPENDENCY_IN_FACTORY(me,qe.toString())):bt}},ce=function(me){return function(qe){qe.parentContext.setCurrentRequest(qe);var lt=qe.bindings,bt=qe.childRequests,Pt=qe.target&&qe.target.isArray(),ur=!qe.parentRequest||!qe.parentRequest.target||!qe.target||!qe.parentRequest.target.matchesArray(qe.target.serviceIdentifier);if(Pt&&ur)return bt.map(function(_r){var J=ce(me);return J(_r)});var Nt=null;if(qe.target.isOptional()&&lt.length===0)return;var pr=lt[0],Xt=pr.scope===re.BindingScopeEnum.Singleton,It=pr.scope===re.BindingScopeEnum.Request;if(Xt&&pr.activated)return pr.cache;if(It&&me!==null&&me.has(pr.id))return me.get(pr.id);if(pr.type===re.BindingTypeEnum.ConstantValue)Nt=pr.cache,pr.activated=!0;else if(pr.type===re.BindingTypeEnum.Function)Nt=pr.cache,pr.activated=!0;else if(pr.type===re.BindingTypeEnum.Constructor)Nt=pr.implementationType;else if(pr.type===re.BindingTypeEnum.DynamicValue&&pr.dynamicValue!==null)Nt=ge("toDynamicValue",pr.serviceIdentifier,function(){return pr.dynamicValue(qe.parentContext)});else if(pr.type===re.BindingTypeEnum.Factory&&pr.factory!==null)Nt=ge("toFactory",pr.serviceIdentifier,function(){return pr.factory(qe.parentContext)});else if(pr.type===re.BindingTypeEnum.Provider&&pr.provider!==null)Nt=ge("toProvider",pr.serviceIdentifier,function(){return pr.provider(qe.parentContext)});else if(pr.type===re.BindingTypeEnum.Instance&&pr.implementationType!==null)Nt=W.resolveInstance(pr.implementationType,bt,ce(me));else{var kt=Se.getServiceIdentifierAsString(qe.serviceIdentifier);throw new Error(Ae.INVALID_BINDING_TYPE+" "+kt)}return typeof pr.onActivation=="function"&&(Nt=pr.onActivation(qe.parentContext,Nt)),Xt&&(pr.cache=Nt,pr.activated=!0),It&&me!==null&&!me.has(pr.id)&&me.set(pr.id,Nt),Nt}};function Xe(me){var qe=ce(me.plan.rootRequest.requestScope);return qe(me.plan.rootRequest)}fe.resolve=Xe},83366:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingInSyntax=void 0;var Ae=Q(28421),re=Q(71325),y=function(){function Se(W){this._binding=W}return Se.prototype.inRequestScope=function(){return this._binding.scope=Ae.BindingScopeEnum.Request,new re.BindingWhenOnSyntax(this._binding)},Se.prototype.inSingletonScope=function(){return this._binding.scope=Ae.BindingScopeEnum.Singleton,new re.BindingWhenOnSyntax(this._binding)},Se.prototype.inTransientScope=function(){return this._binding.scope=Ae.BindingScopeEnum.Transient,new re.BindingWhenOnSyntax(this._binding)},Se}();fe.BindingInSyntax=y},74889:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingInWhenOnSyntax=void 0;var Ae=Q(83366),re=Q(51811),y=Q(98370),Se=function(){function W(ge){this._binding=ge,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding),this._bindingInSyntax=new Ae.BindingInSyntax(ge)}return W.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},W.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},W.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},W.prototype.when=function(ge){return this._bindingWhenSyntax.when(ge)},W.prototype.whenTargetNamed=function(ge){return this._bindingWhenSyntax.whenTargetNamed(ge)},W.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},W.prototype.whenTargetTagged=function(ge,ce){return this._bindingWhenSyntax.whenTargetTagged(ge,ce)},W.prototype.whenInjectedInto=function(ge){return this._bindingWhenSyntax.whenInjectedInto(ge)},W.prototype.whenParentNamed=function(ge){return this._bindingWhenSyntax.whenParentNamed(ge)},W.prototype.whenParentTagged=function(ge,ce){return this._bindingWhenSyntax.whenParentTagged(ge,ce)},W.prototype.whenAnyAncestorIs=function(ge){return this._bindingWhenSyntax.whenAnyAncestorIs(ge)},W.prototype.whenNoAncestorIs=function(ge){return this._bindingWhenSyntax.whenNoAncestorIs(ge)},W.prototype.whenAnyAncestorNamed=function(ge){return this._bindingWhenSyntax.whenAnyAncestorNamed(ge)},W.prototype.whenAnyAncestorTagged=function(ge,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(ge,ce)},W.prototype.whenNoAncestorNamed=function(ge){return this._bindingWhenSyntax.whenNoAncestorNamed(ge)},W.prototype.whenNoAncestorTagged=function(ge,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(ge,ce)},W.prototype.whenAnyAncestorMatches=function(ge){return this._bindingWhenSyntax.whenAnyAncestorMatches(ge)},W.prototype.whenNoAncestorMatches=function(ge){return this._bindingWhenSyntax.whenNoAncestorMatches(ge)},W.prototype.onActivation=function(ge){return this._bindingOnSyntax.onActivation(ge)},W}();fe.BindingInWhenOnSyntax=Se},51811:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingOnSyntax=void 0;var Ae=Q(98370),re=function(){function y(Se){this._binding=Se}return y.prototype.onActivation=function(Se){return this._binding.onActivation=Se,new Ae.BindingWhenSyntax(this._binding)},y}();fe.BindingOnSyntax=re},15451:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingToSyntax=void 0;var Ae=Q(16674),re=Q(28421),y=Q(74889),Se=Q(71325),W=function(){function ge(ce){this._binding=ce}return ge.prototype.to=function(ce){return this._binding.type=re.BindingTypeEnum.Instance,this._binding.implementationType=ce,new y.BindingInWhenOnSyntax(this._binding)},ge.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Ae.INVALID_TO_SELF_VALUE);var ce=this._binding.serviceIdentifier;return this.to(ce)},ge.prototype.toConstantValue=function(ce){return this._binding.type=re.BindingTypeEnum.ConstantValue,this._binding.cache=ce,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=re.BindingScopeEnum.Singleton,new Se.BindingWhenOnSyntax(this._binding)},ge.prototype.toDynamicValue=function(ce){return this._binding.type=re.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ce,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ge.prototype.toConstructor=function(ce){return this._binding.type=re.BindingTypeEnum.Constructor,this._binding.implementationType=ce,this._binding.scope=re.BindingScopeEnum.Singleton,new Se.BindingWhenOnSyntax(this._binding)},ge.prototype.toFactory=function(ce){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=ce,this._binding.scope=re.BindingScopeEnum.Singleton,new Se.BindingWhenOnSyntax(this._binding)},ge.prototype.toFunction=function(ce){if(typeof ce!="function")throw new Error(Ae.INVALID_FUNCTION_BINDING);var Xe=this.toConstantValue(ce);return this._binding.type=re.BindingTypeEnum.Function,this._binding.scope=re.BindingScopeEnum.Singleton,Xe},ge.prototype.toAutoFactory=function(ce){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=function(Xe){var me=function(){return Xe.container.get(ce)};return me},this._binding.scope=re.BindingScopeEnum.Singleton,new Se.BindingWhenOnSyntax(this._binding)},ge.prototype.toProvider=function(ce){return this._binding.type=re.BindingTypeEnum.Provider,this._binding.provider=ce,this._binding.scope=re.BindingScopeEnum.Singleton,new Se.BindingWhenOnSyntax(this._binding)},ge.prototype.toService=function(ce){this.toDynamicValue(function(Xe){return Xe.container.get(ce)})},ge}();fe.BindingToSyntax=W},71325:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingWhenOnSyntax=void 0;var Ae=Q(51811),re=Q(98370),y=function(){function Se(W){this._binding=W,this._bindingWhenSyntax=new re.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Ae.BindingOnSyntax(this._binding)}return Se.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Se.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Se.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Se.prototype.whenTargetTagged=function(W,ge){return this._bindingWhenSyntax.whenTargetTagged(W,ge)},Se.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Se.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Se.prototype.whenParentTagged=function(W,ge){return this._bindingWhenSyntax.whenParentTagged(W,ge)},Se.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Se.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Se.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Se.prototype.whenAnyAncestorTagged=function(W,ge){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,ge)},Se.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Se.prototype.whenNoAncestorTagged=function(W,ge){return this._bindingWhenSyntax.whenNoAncestorTagged(W,ge)},Se.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Se.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Se.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Se}();fe.BindingWhenOnSyntax=y},98370:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.BindingWhenSyntax=void 0;var Ae=Q(51811),re=Q(80758),y=function(){function Se(W){this._binding=W}return Se.prototype.when=function(W){return this._binding.constraint=W,new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenTargetNamed=function(W){return this._binding.constraint=re.namedConstraint(W),new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(W){var ge=W.target!==null&&!W.target.isNamed()&&!W.target.isTagged();return ge},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenTargetTagged=function(W,ge){return this._binding.constraint=re.taggedConstraint(W)(ge),new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenInjectedInto=function(W){return this._binding.constraint=function(ge){return re.typeConstraint(W)(ge.parentRequest)},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenParentNamed=function(W){return this._binding.constraint=function(ge){return re.namedConstraint(W)(ge.parentRequest)},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenParentTagged=function(W,ge){return this._binding.constraint=function(ce){return re.taggedConstraint(W)(ge)(ce.parentRequest)},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenAnyAncestorIs=function(W){return this._binding.constraint=function(ge){return re.traverseAncerstors(ge,re.typeConstraint(W))},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenNoAncestorIs=function(W){return this._binding.constraint=function(ge){return!re.traverseAncerstors(ge,re.typeConstraint(W))},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenAnyAncestorNamed=function(W){return this._binding.constraint=function(ge){return re.traverseAncerstors(ge,re.namedConstraint(W))},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenNoAncestorNamed=function(W){return this._binding.constraint=function(ge){return!re.traverseAncerstors(ge,re.namedConstraint(W))},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenAnyAncestorTagged=function(W,ge){return this._binding.constraint=function(ce){return re.traverseAncerstors(ce,re.taggedConstraint(W)(ge))},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenNoAncestorTagged=function(W,ge){return this._binding.constraint=function(ce){return!re.traverseAncerstors(ce,re.taggedConstraint(W)(ge))},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenAnyAncestorMatches=function(W){return this._binding.constraint=function(ge){return re.traverseAncerstors(ge,W)},new Ae.BindingOnSyntax(this._binding)},Se.prototype.whenNoAncestorMatches=function(W){return this._binding.constraint=function(ge){return!re.traverseAncerstors(ge,W)},new Ae.BindingOnSyntax(this._binding)},Se}();fe.BindingWhenSyntax=y},80758:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.typeConstraint=fe.namedConstraint=fe.taggedConstraint=fe.traverseAncerstors=void 0;var Ae=Q(6867),re=Q(47738),y=function(ce,Xe){var me=ce.parentRequest;return me!==null?Xe(me)?!0:y(me,Xe):!1};fe.traverseAncerstors=y;var Se=function(ce){return function(Xe){var me=function(qe){return qe!==null&&qe.target!==null&&qe.target.matchesTag(ce)(Xe)};return me.metaData=new re.Metadata(ce,Xe),me}};fe.taggedConstraint=Se;var W=Se(Ae.NAMED_TAG);fe.namedConstraint=W;var ge=function(ce){return function(Xe){var me=null;if(Xe!==null)if(me=Xe.bindings[0],typeof ce=="string"){var qe=me.serviceIdentifier;return qe===ce}else{var lt=Xe.bindings[0].implementationType;return ce===lt}return!1}};fe.typeConstraint=ge},70600:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.multiBindToService=void 0;var Q=function(Ae){return function(re){return function(){for(var y=[],Se=0;Se<arguments.length;Se++)y[Se]=arguments[Se];return y.forEach(function(W){return Ae.bind(W).toService(re)})}}};fe.multiBindToService=Q},85265:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.isStackOverflowExeption=void 0;var Ae=Q(16674);function re(y){return y instanceof RangeError||y.message===Ae.STACK_OVERFLOW}fe.isStackOverflowExeption=re},37791:function(Fr,fe){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.id=void 0;var Q=0;function Ae(){return Q++}fe.id=Ae},55800:function(Fr,fe,Q){"use strict";Object.defineProperty(fe,"__esModule",{value:!0}),fe.circularDependencyToException=fe.listMetadataForTarget=fe.listRegisteredBindingsForServiceIdentifier=fe.getServiceIdentifierAsString=fe.getFunctionName=void 0;var Ae=Q(16674);function re(me){if(typeof me=="function"){var qe=me;return qe.name}else{if(typeof me=="symbol")return me.toString();var qe=me;return qe}}fe.getServiceIdentifierAsString=re;function y(me,qe,lt){var bt="",Pt=lt(me,qe);return Pt.length!==0&&(bt=`
Registered bindings:`,Pt.forEach(function(ur){var Nt="Object";ur.implementationType!==null&&(Nt=Xe(ur.implementationType)),bt=bt+`
 `+Nt,ur.constraint.metaData&&(bt=bt+" - "+ur.constraint.metaData)})),bt}fe.listRegisteredBindingsForServiceIdentifier=y;function Se(me,qe){return me.parentRequest===null?!1:me.parentRequest.serviceIdentifier===qe?!0:Se(me.parentRequest,qe)}function W(me){function qe(bt,Pt){Pt===void 0&&(Pt=[]);var ur=re(bt.serviceIdentifier);return Pt.push(ur),bt.parentRequest!==null?qe(bt.parentRequest,Pt):Pt}var lt=qe(me);return lt.reverse().join(" --> ")}function ge(me){me.childRequests.forEach(function(qe){if(Se(qe,qe.serviceIdentifier)){var lt=W(qe);throw new Error(Ae.CIRCULAR_DEPENDENCY+" "+lt)}else ge(qe)})}fe.circularDependencyToException=ge;function ce(me,qe){if(qe.isTagged()||qe.isNamed()){var lt="",bt=qe.getNamedTag(),Pt=qe.getCustomTags();return bt!==null&&(lt+=bt.toString()+`
`),Pt!==null&&Pt.forEach(function(ur){lt+=ur.toString()+`
`})," "+me+`
 `+me+" - "+lt}else return" "+me}fe.listMetadataForTarget=ce;function Xe(me){if(me.name)return me.name;var qe=me.toString(),lt=qe.match(/^function\s*([^\s(]+)/);return lt?lt[1]:"Anonymous function: "+qe}fe.getFunctionName=Xe},31745:function(Fr){"use strict";Fr.exports=Q,Fr.exports.default=Q;var fe=1e20;function Q(W,ge,ce,Xe,me,qe){this.fontSize=W||24,this.buffer=ge===void 0?3:ge,this.cutoff=Xe||.25,this.fontFamily=me||"sans-serif",this.fontWeight=qe||"normal",this.radius=ce||8;var lt=this.size=this.fontSize+this.buffer*2,bt=lt+this.buffer*2,Pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Pt?this.canvas=my.createOffscreenCanvas(lt,lt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=lt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(bt*bt),this.gridInner=new Float64Array(bt*bt),this.f=new Float64Array(bt),this.z=new Float64Array(bt+1),this.v=new Uint16Array(bt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Pt?this.middle=Math.round(lt/2*1):this.middle=Math.round(lt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ae(W,ge,ce,Xe,me,qe,lt){qe.fill(fe,0,ge*ce),lt.fill(0,0,ge*ce);for(var bt=(ge-Xe)/2,Pt=0;Pt<me;Pt++)for(var ur=0;ur<Xe;ur++){var Nt=(Pt+bt)*ge+ur+bt,pr=W.data[4*(Pt*Xe+ur)+3]/255;if(pr===1)qe[Nt]=0,lt[Nt]=fe;else if(pr===0)qe[Nt]=fe,lt[Nt]=0;else{var Xt=Math.max(0,.5-pr),It=Math.max(0,pr-.5);qe[Nt]=Xt*Xt,lt[Nt]=It*It}}}function re(W,ge,ce,Xe,me,qe,lt){for(var bt=0;bt<ge*ce;bt++){var Pt=Math.sqrt(Xe[bt])-Math.sqrt(me[bt]);W[bt]=Math.round(255-255*(Pt/qe+lt))}}Q.prototype._draw=function(W,ge){var ce=this.ctx.measureText(W),Xe=ce.width,me=2*this.buffer,qe,lt,bt,Pt,ur,Nt,pr,Xt;ge&&this.useMetrics?(ur=Math.floor(ce.actualBoundingBoxAscent),Xt=this.buffer+Math.ceil(ce.actualBoundingBoxAscent),Nt=this.buffer,pr=this.buffer,lt=Math.min(this.size,Math.ceil(ce.actualBoundingBoxRight-ce.actualBoundingBoxLeft)),Pt=Math.min(this.size-Nt,Math.ceil(ce.actualBoundingBoxAscent+ce.actualBoundingBoxDescent)),qe=lt+me,bt=Pt+me,this.ctx.textBaseline="alphabetic"):(qe=lt=this.size,bt=Pt=this.size,ur=19*this.fontSize/24,Nt=pr=0,Xt=this.middle,this.ctx.textBaseline="middle");var It;lt&&Pt&&(this.ctx.clearRect(pr,Nt,lt,Pt),this.ctx.fillText(W,this.buffer,Xt),It=this.ctx.getImageData(pr,Nt,lt,Pt));var kt=new Uint8ClampedArray(qe*bt);return Ae(It,qe,bt,lt,Pt,this.gridOuter,this.gridInner),y(this.gridOuter,qe,bt,this.f,this.v,this.z),y(this.gridInner,qe,bt,this.f,this.v,this.z),re(kt,qe,bt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:kt,metrics:{width:lt,height:Pt,sdfWidth:qe,sdfHeight:bt,top:ur,left:0,advance:Xe}}},Q.prototype.draw=function(W){return this._draw(W,!1).data},Q.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function y(W,ge,ce,Xe,me,qe){for(var lt=0;lt<ge;lt++)Se(W,lt,ge,ce,Xe,me,qe);for(var bt=0;bt<ce;bt++)Se(W,bt*ge,1,ge,Xe,me,qe)}function Se(W,ge,ce,Xe,me,qe,lt){var bt,Pt,ur,Nt;for(qe[0]=0,lt[0]=-fe,lt[1]=fe,bt=0;bt<Xe;bt++)me[bt]=W[ge+bt*ce];for(bt=1,Pt=0,ur=0;bt<Xe;bt++){do Nt=qe[Pt],ur=(me[bt]-me[Nt]+bt*bt-Nt*Nt)/(bt-Nt)/2;while(ur<=lt[Pt]&&--Pt>-1);Pt++,qe[Pt]=bt,lt[Pt]=ur,lt[Pt+1]=fe}for(bt=0,Pt=0;bt<Xe;bt++){for(;lt[Pt+1]<bt;)Pt++;Nt=qe[Pt],W[ge+bt*ce]=me[Nt]+(bt-Nt)*(bt-Nt)}}},18857:function(Fr,fe,Q){"use strict";Q.r(fe),Q.d(fe,{Function:function(){return au},Interpreter:function(){return Ia},default:function(){return Ol},evaluate:function(){return el},vm:function(){return Ae}});var Ae={};Q.r(Ae),Q.d(Ae,{Script:function(){return hl},compileFunction:function(){return yf},createContext:function(){return Hc},runInContext:function(){return Is},runInNewContext:function(){return _f}});var re={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Se={5:y,"5module":y+" export import",6:y+" const class extends export import super"},W=/^in(stanceof)?$/,ge="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ce="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Xe=new RegExp("["+ge+"]"),me=new RegExp("["+ge+ce+"]");ge=ce=null;var qe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],lt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function bt(b,M){for(var Z=65536,L=0;L<M.length;L+=2){if(Z+=M[L],Z>b)return!1;if(Z+=M[L+1],Z>=b)return!0}}function Pt(b,M){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&Xe.test(String.fromCharCode(b)):M===!1?!1:bt(b,qe)}function ur(b,M){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&me.test(String.fromCharCode(b)):M===!1?!1:bt(b,qe)||bt(b,lt)}var Nt=function(M,Z){Z===void 0&&(Z={}),this.label=M,this.keyword=Z.keyword,this.beforeExpr=!!Z.beforeExpr,this.startsExpr=!!Z.startsExpr,this.isLoop=!!Z.isLoop,this.isAssign=!!Z.isAssign,this.prefix=!!Z.prefix,this.postfix=!!Z.postfix,this.binop=Z.binop||null,this.updateContext=null};function pr(b,M){return new Nt(b,{beforeExpr:!0,binop:M})}var Xt={beforeExpr:!0},It={startsExpr:!0},kt={};function _r(b,M){return M===void 0&&(M={}),M.keyword=b,kt[b]=new Nt(b,M)}var J={num:new Nt("num",It),regexp:new Nt("regexp",It),string:new Nt("string",It),name:new Nt("name",It),eof:new Nt("eof"),bracketL:new Nt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Nt("]"),braceL:new Nt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Nt("}"),parenL:new Nt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Nt(")"),comma:new Nt(",",Xt),semi:new Nt(";",Xt),colon:new Nt(":",Xt),dot:new Nt("."),question:new Nt("?",Xt),questionDot:new Nt("?."),arrow:new Nt("=>",Xt),template:new Nt("template"),invalidTemplate:new Nt("invalidTemplate"),ellipsis:new Nt("...",Xt),backQuote:new Nt("`",It),dollarBraceL:new Nt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Nt("=",{beforeExpr:!0,isAssign:!0}),assign:new Nt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Nt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Nt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:pr("||",1),logicalAND:pr("&&",2),bitwiseOR:pr("|",3),bitwiseXOR:pr("^",4),bitwiseAND:pr("&",5),equality:pr("==/!=/===/!==",6),relational:pr("</>/<=/>=",7),bitShift:pr("<</>>/>>>",8),plusMin:new Nt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:pr("%",10),star:pr("*",10),slash:pr("/",10),starstar:new Nt("**",{beforeExpr:!0}),coalesce:pr("??",1),_break:_r("break"),_case:_r("case",Xt),_catch:_r("catch"),_continue:_r("continue"),_debugger:_r("debugger"),_default:_r("default",Xt),_do:_r("do",{isLoop:!0,beforeExpr:!0}),_else:_r("else",Xt),_finally:_r("finally"),_for:_r("for",{isLoop:!0}),_function:_r("function",It),_if:_r("if"),_return:_r("return",Xt),_switch:_r("switch"),_throw:_r("throw",Xt),_try:_r("try"),_var:_r("var"),_const:_r("const"),_while:_r("while",{isLoop:!0}),_with:_r("with"),_new:_r("new",{beforeExpr:!0,startsExpr:!0}),_this:_r("this",It),_super:_r("super",It),_class:_r("class",It),_extends:_r("extends",Xt),_export:_r("export"),_import:_r("import",It),_null:_r("null",It),_true:_r("true",It),_false:_r("false",It),_in:_r("in",{beforeExpr:!0,binop:7}),_instanceof:_r("instanceof",{beforeExpr:!0,binop:7}),_typeof:_r("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:_r("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:_r("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},lr=/\r\n?|\n|\u2028|\u2029/,Tt=new RegExp(lr.source,"g");function ht(b,M){return b===10||b===13||!M&&(b===8232||b===8233)}var Wt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,mt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,fr=Object.prototype,Lr=fr.hasOwnProperty,te=fr.toString;function Ne(b,M){return Lr.call(b,M)}var N=Array.isArray||function(b){return te.call(b)==="[object Array]"};function U(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var le=function(M,Z){this.line=M,this.column=Z};le.prototype.offset=function(M){return new le(this.line,this.column+M)};var He=function(M,Z,L){this.start=Z,this.end=L,M.sourceFile!==null&&(this.source=M.sourceFile)};function Je(b,M){for(var Z=1,L=0;;){Tt.lastIndex=L;var ne=Tt.exec(b);if(ne&&ne.index<M)++Z,L=ne.index+ne[0].length;else return new le(Z,M-L)}}var ft={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Vt(b){var M={};for(var Z in ft)M[Z]=b&&Ne(b,Z)?b[Z]:ft[Z];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),N(M.onToken)){var L=M.onToken;M.onToken=function(ne){return L.push(ne)}}return N(M.onComment)&&(M.onComment=nr(M,M.onComment)),M}function nr(b,M){return function(Z,L,ne,ke,st,Ft){var Bt={type:Z?"Block":"Line",value:L,start:ne,end:ke};b.locations&&(Bt.loc=new He(this,st,Ft)),b.ranges&&(Bt.range=[ne,ke]),M.push(Bt)}}var Zr=1,Dr=2,Xn=Zr|Dr,sn=4,Nn=8,ra=16,xi=32,si=64,Ri=128;function ki(b,M){return Dr|(b?sn:0)|(M?Nn:0)}var di=0,Yn=1,ri=2,Ao=3,Na=4,ma=5,wt=function(M,Z,L){this.options=M=Vt(M),this.sourceFile=M.sourceFile,this.keywords=U(Se[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var ne="";if(M.allowReserved!==!0){for(var ke=M.ecmaVersion;!(ne=re[ke]);ke--);M.sourceType==="module"&&(ne+=" await")}this.reservedWords=U(ne);var st=(ne?ne+" ":"")+re.strict;this.reservedWordsStrict=U(st),this.reservedWordsStrictBind=U(st+" "+re.strictBind),this.input=String(Z),this.containsEsc=!1,L?(this.pos=L,this.lineStart=this.input.lastIndexOf(`
`,L-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(lr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=J.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Zr),this.regexpState=null},ve={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};wt.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},ve.inFunction.get=function(){return(this.currentVarScope().flags&Dr)>0},ve.inGenerator.get=function(){return(this.currentVarScope().flags&Nn)>0},ve.inAsync.get=function(){return(this.currentVarScope().flags&sn)>0},ve.allowSuper.get=function(){return(this.currentThisScope().flags&si)>0},ve.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ri)>0},ve.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},wt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Dr)>0},wt.extend=function(){for(var M=[],Z=arguments.length;Z--;)M[Z]=arguments[Z];for(var L=this,ne=0;ne<M.length;ne++)L=M[ne](L);return L},wt.parse=function(M,Z){return new this(Z,M).parse()},wt.parseExpressionAt=function(M,Z,L){var ne=new this(L,M,Z);return ne.nextToken(),ne.parseExpression()},wt.tokenizer=function(M,Z){return new this(Z,M)},Object.defineProperties(wt.prototype,ve);var se=wt.prototype,xe=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;se.strictDirective=function(b){for(;;){mt.lastIndex=b,b+=mt.exec(this.input)[0].length;var M=xe.exec(this.input.slice(b));if(!M)return!1;if((M[1]||M[2])==="use strict"){mt.lastIndex=b+M[0].length;var Z=mt.exec(this.input),L=Z.index+Z[0].length,ne=this.input.charAt(L);return ne===";"||ne==="}"||lr.test(Z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ne)||ne==="!"&&this.input.charAt(L+1)==="=")}b+=M[0].length,mt.lastIndex=b,b+=mt.exec(this.input)[0].length,this.input[b]===";"&&b++}},se.eat=function(b){return this.type===b?(this.next(),!0):!1},se.isContextual=function(b){return this.type===J.name&&this.value===b&&!this.containsEsc},se.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},se.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},se.canInsertSemicolon=function(){return this.type===J.eof||this.type===J.braceR||lr.test(this.input.slice(this.lastTokEnd,this.start))},se.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},se.semicolon=function(){!this.eat(J.semi)&&!this.insertSemicolon()&&this.unexpected()},se.afterTrailingComma=function(b,M){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},se.expect=function(b){this.eat(b)||this.unexpected()},se.unexpected=function(b){this.raise(b!=null?b:this.start,"Unexpected token")};function z(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}se.checkPatternErrors=function(b,M){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var Z=M?b.parenthesizedAssign:b.parenthesizedBind;Z>-1&&this.raiseRecoverable(Z,"Parenthesized pattern")}},se.checkExpressionErrors=function(b,M){if(!b)return!1;var Z=b.shorthandAssign,L=b.doubleProto;if(!M)return Z>=0||L>=0;Z>=0&&this.raise(Z,"Shorthand property assignments are valid only in destructuring patterns"),L>=0&&this.raiseRecoverable(L,"Redefinition of __proto__ property")},se.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},se.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var et=wt.prototype;et.parseTopLevel=function(b){var M={};for(b.body||(b.body=[]);this.type!==J.eof;){var Z=this.parseStatement(null,!0,M);b.body.push(Z)}if(this.inModule)for(var L=0,ne=Object.keys(this.undefinedExports);L<ne.length;L+=1){var ke=ne[L];this.raiseRecoverable(this.undefinedExports[ke].start,"Export '"+ke+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var Qt={kind:"loop"},zr={kind:"switch"};et.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;mt.lastIndex=this.pos;var M=mt.exec(this.input),Z=this.pos+M[0].length,L=this.input.charCodeAt(Z);if(L===91)return!0;if(b)return!1;if(L===123)return!0;if(Pt(L,!0)){for(var ne=Z+1;ur(this.input.charCodeAt(ne),!0);)++ne;var ke=this.input.slice(Z,ne);if(!W.test(ke))return!0}return!1},et.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;mt.lastIndex=this.pos;var b=mt.exec(this.input),M=this.pos+b[0].length;return!lr.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!ur(this.input.charAt(M+8)))},et.parseStatement=function(b,M,Z){var L=this.type,ne=this.startNode(),ke;switch(this.isLet(b)&&(L=J._var,ke="let"),L){case J._break:case J._continue:return this.parseBreakContinueStatement(ne,L.keyword);case J._debugger:return this.parseDebuggerStatement(ne);case J._do:return this.parseDoStatement(ne);case J._for:return this.parseForStatement(ne);case J._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ne,!1,!b);case J._class:return b&&this.unexpected(),this.parseClass(ne,!0);case J._if:return this.parseIfStatement(ne);case J._return:return this.parseReturnStatement(ne);case J._switch:return this.parseSwitchStatement(ne);case J._throw:return this.parseThrowStatement(ne);case J._try:return this.parseTryStatement(ne);case J._const:case J._var:return ke=ke||this.value,b&&ke!=="var"&&this.unexpected(),this.parseVarStatement(ne,ke);case J._while:return this.parseWhileStatement(ne);case J._with:return this.parseWithStatement(ne);case J.braceL:return this.parseBlock(!0,ne);case J.semi:return this.parseEmptyStatement(ne);case J._export:case J._import:if(this.options.ecmaVersion>10&&L===J._import){mt.lastIndex=this.pos;var st=mt.exec(this.input),Ft=this.pos+st[0].length,Bt=this.input.charCodeAt(Ft);if(Bt===40||Bt===46)return this.parseExpressionStatement(ne,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),L===J._import?this.parseImport(ne):this.parseExport(ne,Z);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(ne,!0,!b);var Sr=this.value,Br=this.parseExpression();return L===J.name&&Br.type==="Identifier"&&this.eat(J.colon)?this.parseLabeledStatement(ne,Sr,Br,b):this.parseExpressionStatement(ne,Br)}},et.parseBreakContinueStatement=function(b,M){var Z=M==="break";this.next(),this.eat(J.semi)||this.insertSemicolon()?b.label=null:this.type!==J.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var L=0;L<this.labels.length;++L){var ne=this.labels[L];if((b.label==null||ne.name===b.label.name)&&(ne.kind!=null&&(Z||ne.kind==="loop")||b.label&&Z))break}return L===this.labels.length&&this.raise(b.start,"Unsyntactic "+M),this.finishNode(b,Z?"BreakStatement":"ContinueStatement")},et.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},et.parseDoStatement=function(b){return this.next(),this.labels.push(Qt),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(J._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(J.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},et.parseForStatement=function(b){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Qt),this.enterScope(0),this.expect(J.parenL),this.type===J.semi)return M>-1&&this.unexpected(M),this.parseFor(b,null);var Z=this.isLet();if(this.type===J._var||this.type===J._const||Z){var L=this.startNode(),ne=Z?"let":this.value;return this.next(),this.parseVar(L,!0,ne),this.finishNode(L,"VariableDeclaration"),(this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&L.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===J._in?M>-1&&this.unexpected(M):b.await=M>-1),this.parseForIn(b,L)):(M>-1&&this.unexpected(M),this.parseFor(b,L))}var ke=new z,st=this.parseExpression(!0,ke);return this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===J._in?M>-1&&this.unexpected(M):b.await=M>-1),this.toAssignable(st,!1,ke),this.checkLVal(st),this.parseForIn(b,st)):(this.checkExpressionErrors(ke,!0),M>-1&&this.unexpected(M),this.parseFor(b,st))},et.parseFunctionStatement=function(b,M,Z){return this.next(),this.parseFunction(b,Rt|(Z?0:vr),!1,M)},et.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(J._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},et.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(J.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},et.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(J.braceL),this.labels.push(zr),this.enterScope(0);for(var M,Z=!1;this.type!==J.braceR;)if(this.type===J._case||this.type===J._default){var L=this.type===J._case;M&&this.finishNode(M,"SwitchCase"),b.cases.push(M=this.startNode()),M.consequent=[],this.next(),L?M.test=this.parseExpression():(Z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),Z=!0,M.test=null),this.expect(J.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},et.parseThrowStatement=function(b){return this.next(),lr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var Ke=[];et.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===J._catch){var M=this.startNode();if(this.next(),this.eat(J.parenL)){M.param=this.parseBindingAtom();var Z=M.param.type==="Identifier";this.enterScope(Z?xi:0),this.checkLVal(M.param,Z?Na:ri),this.expect(J.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(M,"CatchClause")}return b.finalizer=this.eat(J._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},et.parseVarStatement=function(b,M){return this.next(),this.parseVar(b,!1,M),this.semicolon(),this.finishNode(b,"VariableDeclaration")},et.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(Qt),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},et.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},et.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},et.parseLabeledStatement=function(b,M,Z,L){for(var ne=0,ke=this.labels;ne<ke.length;ne+=1){var st=ke[ne];st.name===M&&this.raise(Z.start,"Label '"+M+"' is already declared")}for(var Ft=this.type.isLoop?"loop":this.type===J._switch?"switch":null,Bt=this.labels.length-1;Bt>=0;Bt--){var Sr=this.labels[Bt];if(Sr.statementStart===b.start)Sr.statementStart=this.start,Sr.kind=Ft;else break}return this.labels.push({name:M,kind:Ft,statementStart:this.start}),b.body=this.parseStatement(L?L.indexOf("label")===-1?L+"label":L:"label"),this.labels.pop(),b.label=Z,this.finishNode(b,"LabeledStatement")},et.parseExpressionStatement=function(b,M){return b.expression=M,this.semicolon(),this.finishNode(b,"ExpressionStatement")},et.parseBlock=function(b,M,Z){for(b===void 0&&(b=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(J.braceL),b&&this.enterScope(0);this.type!==J.braceR;){var L=this.parseStatement(null);M.body.push(L)}return Z&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(M,"BlockStatement")},et.parseFor=function(b,M){return b.init=M,this.expect(J.semi),b.test=this.type===J.semi?null:this.parseExpression(),this.expect(J.semi),b.update=this.type===J.parenR?null:this.parseExpression(),this.expect(J.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},et.parseForIn=function(b,M){var Z=this.type===J._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!Z||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(Z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),b.left=M,b.right=Z?this.parseExpression():this.parseMaybeAssign(),this.expect(J.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,Z?"ForInStatement":"ForOfStatement")},et.parseVar=function(b,M,Z){for(b.declarations=[],b.kind=Z;;){var L=this.startNode();if(this.parseVarId(L,Z),this.eat(J.eq)?L.init=this.parseMaybeAssign(M):Z==="const"&&!(this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():L.id.type!=="Identifier"&&!(M&&(this.type===J._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):L.init=null,b.declarations.push(this.finishNode(L,"VariableDeclarator")),!this.eat(J.comma))break}return b},et.parseVarId=function(b,M){b.id=this.parseBindingAtom(),this.checkLVal(b.id,M==="var"?Yn:ri,!1)};var Rt=1,vr=2,Pr=4;et.parseFunction=function(b,M,Z,L){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!L)&&(this.type===J.star&&M&vr&&this.unexpected(),b.generator=this.eat(J.star)),this.options.ecmaVersion>=8&&(b.async=!!L),M&Rt&&(b.id=M&Pr&&this.type!==J.name?null:this.parseIdent(),b.id&&!(M&vr)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?Yn:ri:Ao));var ne=this.yieldPos,ke=this.awaitPos,st=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ki(b.async,b.generator)),M&Rt||(b.id=this.type===J.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,Z,!1),this.yieldPos=ne,this.awaitPos=ke,this.awaitIdentPos=st,this.finishNode(b,M&Rt?"FunctionDeclaration":"FunctionExpression")},et.parseFunctionParams=function(b){this.expect(J.parenL),b.params=this.parseBindingList(J.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},et.parseClass=function(b,M){this.next();var Z=this.strict;this.strict=!0,this.parseClassId(b,M),this.parseClassSuper(b);var L=this.startNode(),ne=!1;for(L.body=[],this.expect(J.braceL);this.type!==J.braceR;){var ke=this.parseClassElement(b.superClass!==null);ke&&(L.body.push(ke),ke.type==="MethodDefinition"&&ke.kind==="constructor"&&(ne&&this.raise(ke.start,"Duplicate constructor in the same class"),ne=!0))}return this.strict=Z,this.next(),b.body=this.finishNode(L,"ClassBody"),this.finishNode(b,M?"ClassDeclaration":"ClassExpression")},et.parseClassElement=function(b){var M=this;if(this.eat(J.semi))return null;var Z=this.startNode(),L=function(Bt,Sr){Sr===void 0&&(Sr=!1);var Br=M.start,Hn=M.startLoc;return M.eatContextual(Bt)?M.type!==J.parenL&&(!Sr||!M.canInsertSemicolon())?!0:(Z.key&&M.unexpected(),Z.computed=!1,Z.key=M.startNodeAt(Br,Hn),Z.key.name=Bt,M.finishNode(Z.key,"Identifier"),!1):!1};Z.kind="method",Z.static=L("static");var ne=this.eat(J.star),ke=!1;ne||(this.options.ecmaVersion>=8&&L("async",!0)?(ke=!0,ne=this.options.ecmaVersion>=9&&this.eat(J.star)):L("get")?Z.kind="get":L("set")&&(Z.kind="set")),Z.key||this.parsePropertyName(Z);var st=Z.key,Ft=!1;return!Z.computed&&!Z.static&&(st.type==="Identifier"&&st.name==="constructor"||st.type==="Literal"&&st.value==="constructor")?(Z.kind!=="method"&&this.raise(st.start,"Constructor can't have get/set modifier"),ne&&this.raise(st.start,"Constructor can't be a generator"),ke&&this.raise(st.start,"Constructor can't be an async method"),Z.kind="constructor",Ft=b):Z.static&&st.type==="Identifier"&&st.name==="prototype"&&this.raise(st.start,"Classes may not have a static property named prototype"),this.parseClassMethod(Z,ne,ke,Ft),Z.kind==="get"&&Z.value.params.length!==0&&this.raiseRecoverable(Z.value.start,"getter should have no params"),Z.kind==="set"&&Z.value.params.length!==1&&this.raiseRecoverable(Z.value.start,"setter should have exactly one param"),Z.kind==="set"&&Z.value.params[0].type==="RestElement"&&this.raiseRecoverable(Z.value.params[0].start,"Setter cannot use rest params"),Z},et.parseClassMethod=function(b,M,Z,L){return b.value=this.parseMethod(M,Z,L),this.finishNode(b,"MethodDefinition")},et.parseClassId=function(b,M){this.type===J.name?(b.id=this.parseIdent(),M&&this.checkLVal(b.id,ri,!1)):(M===!0&&this.unexpected(),b.id=null)},et.parseClassSuper=function(b){b.superClass=this.eat(J._extends)?this.parseExprSubscripts():null},et.parseExport=function(b,M){if(this.next(),this.eat(J.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(M,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==J.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(J._default)){this.checkExport(M,"default",this.lastTokStart);var Z;if(this.type===J._function||(Z=this.isAsyncFunction())){var L=this.startNode();this.next(),Z&&this.next(),b.declaration=this.parseFunction(L,Rt|Pr,!1,Z)}else if(this.type===J._class){var ne=this.startNode();b.declaration=this.parseClass(ne,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,b.declaration.declarations):this.checkExport(M,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==J.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var ke=0,st=b.specifiers;ke<st.length;ke+=1){var Ft=st[ke];this.checkUnreserved(Ft.local),this.checkLocalExport(Ft.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},et.checkExport=function(b,M,Z){!b||(Ne(b,M)&&this.raiseRecoverable(Z,"Duplicate export '"+M+"'"),b[M]=!0)},et.checkPatternExport=function(b,M){var Z=M.type;if(Z==="Identifier")this.checkExport(b,M.name,M.start);else if(Z==="ObjectPattern")for(var L=0,ne=M.properties;L<ne.length;L+=1){var ke=ne[L];this.checkPatternExport(b,ke)}else if(Z==="ArrayPattern")for(var st=0,Ft=M.elements;st<Ft.length;st+=1){var Bt=Ft[st];Bt&&this.checkPatternExport(b,Bt)}else Z==="Property"?this.checkPatternExport(b,M.value):Z==="AssignmentPattern"?this.checkPatternExport(b,M.left):Z==="RestElement"?this.checkPatternExport(b,M.argument):Z==="ParenthesizedExpression"&&this.checkPatternExport(b,M.expression)},et.checkVariableExport=function(b,M){if(!!b)for(var Z=0,L=M;Z<L.length;Z+=1){var ne=L[Z];this.checkPatternExport(b,ne.id)}},et.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},et.parseExportSpecifiers=function(b){var M=[],Z=!0;for(this.expect(J.braceL);!this.eat(J.braceR);){if(Z)Z=!1;else if(this.expect(J.comma),this.afterTrailingComma(J.braceR))break;var L=this.startNode();L.local=this.parseIdent(!0),L.exported=this.eatContextual("as")?this.parseIdent(!0):L.local,this.checkExport(b,L.exported.name,L.exported.start),M.push(this.finishNode(L,"ExportSpecifier"))}return M},et.parseImport=function(b){return this.next(),this.type===J.string?(b.specifiers=Ke,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===J.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},et.parseImportSpecifiers=function(){var b=[],M=!0;if(this.type===J.name){var Z=this.startNode();if(Z.local=this.parseIdent(),this.checkLVal(Z.local,ri),b.push(this.finishNode(Z,"ImportDefaultSpecifier")),!this.eat(J.comma))return b}if(this.type===J.star){var L=this.startNode();return this.next(),this.expectContextual("as"),L.local=this.parseIdent(),this.checkLVal(L.local,ri),b.push(this.finishNode(L,"ImportNamespaceSpecifier")),b}for(this.expect(J.braceL);!this.eat(J.braceR);){if(M)M=!1;else if(this.expect(J.comma),this.afterTrailingComma(J.braceR))break;var ne=this.startNode();ne.imported=this.parseIdent(!0),this.eatContextual("as")?ne.local=this.parseIdent():(this.checkUnreserved(ne.imported),ne.local=ne.imported),this.checkLVal(ne.local,ri),b.push(this.finishNode(ne,"ImportSpecifier"))}return b},et.adaptDirectivePrologue=function(b){for(var M=0;M<b.length&&this.isDirectiveCandidate(b[M]);++M)b[M].directive=b[M].expression.raw.slice(1,-1)},et.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var Xr=wt.prototype;Xr.toAssignable=function(b,M,Z){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",Z&&this.checkPatternErrors(Z,!0);for(var L=0,ne=b.properties;L<ne.length;L+=1){var ke=ne[L];this.toAssignable(ke,M),ke.type==="RestElement"&&(ke.argument.type==="ArrayPattern"||ke.argument.type==="ObjectPattern")&&this.raise(ke.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,M);break;case"ArrayExpression":b.type="ArrayPattern",Z&&this.checkPatternErrors(Z,!0),this.toAssignableList(b.elements,M);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,M),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,M,Z);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(b.start,"Assigning to rvalue")}else Z&&this.checkPatternErrors(Z,!0);return b},Xr.toAssignableList=function(b,M){for(var Z=b.length,L=0;L<Z;L++){var ne=b[L];ne&&this.toAssignable(ne,M)}if(Z){var ke=b[Z-1];this.options.ecmaVersion===6&&M&&ke&&ke.type==="RestElement"&&ke.argument.type!=="Identifier"&&this.unexpected(ke.argument.start)}return b},Xr.parseSpread=function(b){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,b),this.finishNode(M,"SpreadElement")},Xr.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==J.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},Xr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case J.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(J.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case J.braceL:return this.parseObj(!0)}return this.parseIdent()},Xr.parseBindingList=function(b,M,Z){for(var L=[],ne=!0;!this.eat(b);)if(ne?ne=!1:this.expect(J.comma),M&&this.type===J.comma)L.push(null);else{if(Z&&this.afterTrailingComma(b))break;if(this.type===J.ellipsis){var ke=this.parseRestBinding();this.parseBindingListItem(ke),L.push(ke),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var st=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(st),L.push(st)}}return L},Xr.parseBindingListItem=function(b){return b},Xr.parseMaybeDefault=function(b,M,Z){if(Z=Z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(J.eq))return Z;var L=this.startNodeAt(b,M);return L.left=Z,L.right=this.parseMaybeAssign(),this.finishNode(L,"AssignmentPattern")},Xr.checkLVal=function(b,M,Z){switch(M===void 0&&(M=di),b.type){case"Identifier":M===ri&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(M?"Binding ":"Assigning to ")+b.name+" in strict mode"),Z&&(Ne(Z,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),Z[b.name]=!0),M!==di&&M!==ma&&this.declareName(b.name,M,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var L=0,ne=b.properties;L<ne.length;L+=1){var ke=ne[L];this.checkLVal(ke,M,Z)}break;case"Property":this.checkLVal(b.value,M,Z);break;case"ArrayPattern":for(var st=0,Ft=b.elements;st<Ft.length;st+=1){var Bt=Ft[st];Bt&&this.checkLVal(Bt,M,Z)}break;case"AssignmentPattern":this.checkLVal(b.left,M,Z);break;case"RestElement":this.checkLVal(b.argument,M,Z);break;case"ParenthesizedExpression":this.checkLVal(b.expression,M,Z);break;default:this.raise(b.start,(M?"Binding":"Assigning to")+" rvalue")}};var rn=wt.prototype;rn.checkPropClash=function(b,M,Z){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var L=b.key,ne;switch(L.type){case"Identifier":ne=L.name;break;case"Literal":ne=String(L.value);break;default:return}var ke=b.kind;if(this.options.ecmaVersion>=6){ne==="__proto__"&&ke==="init"&&(M.proto&&(Z?Z.doubleProto<0&&(Z.doubleProto=L.start):this.raiseRecoverable(L.start,"Redefinition of __proto__ property")),M.proto=!0);return}ne="$"+ne;var st=M[ne];if(st){var Ft;ke==="init"?Ft=this.strict&&st.init||st.get||st.set:Ft=st.init||st[ke],Ft&&this.raiseRecoverable(L.start,"Redefinition of property")}else st=M[ne]={init:!1,get:!1,set:!1};st[ke]=!0}},rn.parseExpression=function(b,M){var Z=this.start,L=this.startLoc,ne=this.parseMaybeAssign(b,M);if(this.type===J.comma){var ke=this.startNodeAt(Z,L);for(ke.expressions=[ne];this.eat(J.comma);)ke.expressions.push(this.parseMaybeAssign(b,M));return this.finishNode(ke,"SequenceExpression")}return ne},rn.parseMaybeAssign=function(b,M,Z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var L=!1,ne=-1,ke=-1;M?(ne=M.parenthesizedAssign,ke=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new z,L=!0);var st=this.start,Ft=this.startLoc;(this.type===J.parenL||this.type===J.name)&&(this.potentialArrowAt=this.start);var Bt=this.parseMaybeConditional(b,M);if(Z&&(Bt=Z.call(this,Bt,st,Ft)),this.type.isAssign){var Sr=this.startNodeAt(st,Ft);return Sr.operator=this.value,Sr.left=this.type===J.eq?this.toAssignable(Bt,!1,M):Bt,L||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=Sr.left.start&&(M.shorthandAssign=-1),this.checkLVal(Bt),this.next(),Sr.right=this.parseMaybeAssign(b),this.finishNode(Sr,"AssignmentExpression")}else L&&this.checkExpressionErrors(M,!0);return ne>-1&&(M.parenthesizedAssign=ne),ke>-1&&(M.trailingComma=ke),Bt},rn.parseMaybeConditional=function(b,M){var Z=this.start,L=this.startLoc,ne=this.parseExprOps(b,M);if(this.checkExpressionErrors(M))return ne;if(this.eat(J.question)){var ke=this.startNodeAt(Z,L);return ke.test=ne,ke.consequent=this.parseMaybeAssign(),this.expect(J.colon),ke.alternate=this.parseMaybeAssign(b),this.finishNode(ke,"ConditionalExpression")}return ne},rn.parseExprOps=function(b,M){var Z=this.start,L=this.startLoc,ne=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||ne.start===Z&&ne.type==="ArrowFunctionExpression"?ne:this.parseExprOp(ne,Z,L,-1,b)},rn.parseExprOp=function(b,M,Z,L,ne){var ke=this.type.binop;if(ke!=null&&(!ne||this.type!==J._in)&&ke>L){var st=this.type===J.logicalOR||this.type===J.logicalAND,Ft=this.type===J.coalesce;Ft&&(ke=J.logicalAND.binop);var Bt=this.value;this.next();var Sr=this.start,Br=this.startLoc,Hn=this.parseExprOp(this.parseMaybeUnary(null,!1),Sr,Br,ke,ne),Kn=this.buildBinary(M,Z,b,Hn,Bt,st||Ft);return(st&&this.type===J.coalesce||Ft&&(this.type===J.logicalOR||this.type===J.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Kn,M,Z,L,ne)}return b},rn.buildBinary=function(b,M,Z,L,ne,ke){var st=this.startNodeAt(b,M);return st.left=Z,st.operator=ne,st.right=L,this.finishNode(st,ke?"LogicalExpression":"BinaryExpression")},rn.parseMaybeUnary=function(b,M){var Z=this.start,L=this.startLoc,ne;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ne=this.parseAwait(),M=!0;else if(this.type.prefix){var ke=this.startNode(),st=this.type===J.incDec;ke.operator=this.value,ke.prefix=!0,this.next(),ke.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),st?this.checkLVal(ke.argument):this.strict&&ke.operator==="delete"&&ke.argument.type==="Identifier"?this.raiseRecoverable(ke.start,"Deleting local variable in strict mode"):M=!0,ne=this.finishNode(ke,st?"UpdateExpression":"UnaryExpression")}else{if(ne=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return ne;for(;this.type.postfix&&!this.canInsertSemicolon();){var Ft=this.startNodeAt(Z,L);Ft.operator=this.value,Ft.prefix=!1,Ft.argument=ne,this.checkLVal(ne),this.next(),ne=this.finishNode(Ft,"UpdateExpression")}}return!M&&this.eat(J.starstar)?this.buildBinary(Z,L,ne,this.parseMaybeUnary(null,!1),"**",!1):ne},rn.parseExprSubscripts=function(b){var M=this.start,Z=this.startLoc,L=this.parseExprAtom(b);if(L.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return L;var ne=this.parseSubscripts(L,M,Z);return b&&ne.type==="MemberExpression"&&(b.parenthesizedAssign>=ne.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=ne.start&&(b.parenthesizedBind=-1)),ne},rn.parseSubscripts=function(b,M,Z,L){for(var ne=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start==5&&this.potentialArrowAt===b.start,ke=!1;;){var st=this.parseSubscript(b,M,Z,L,ne,ke);if(st.optional&&(ke=!0),st===b||st.type==="ArrowFunctionExpression"){if(ke){var Ft=this.startNodeAt(M,Z);Ft.expression=st,st=this.finishNode(Ft,"ChainExpression")}return st}b=st}},rn.parseSubscript=function(b,M,Z,L,ne,ke){var st=this.options.ecmaVersion>=11,Ft=st&&this.eat(J.questionDot);L&&Ft&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Bt=this.eat(J.bracketL);if(Bt||Ft&&this.type!==J.parenL&&this.type!==J.backQuote||this.eat(J.dot)){var Sr=this.startNodeAt(M,Z);Sr.object=b,Sr.property=Bt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Sr.computed=!!Bt,Bt&&this.expect(J.bracketR),st&&(Sr.optional=Ft),b=this.finishNode(Sr,"MemberExpression")}else if(!L&&this.eat(J.parenL)){var Br=new z,Hn=this.yieldPos,Kn=this.awaitPos,yi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var $i=this.parseExprList(J.parenR,this.options.ecmaVersion>=8,!1,Br);if(ne&&!Ft&&!this.canInsertSemicolon()&&this.eat(J.arrow))return this.checkPatternErrors(Br,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Hn,this.awaitPos=Kn,this.awaitIdentPos=yi,this.parseArrowExpression(this.startNodeAt(M,Z),$i,!0);this.checkExpressionErrors(Br,!0),this.yieldPos=Hn||this.yieldPos,this.awaitPos=Kn||this.awaitPos,this.awaitIdentPos=yi||this.awaitIdentPos;var Ea=this.startNodeAt(M,Z);Ea.callee=b,Ea.arguments=$i,st&&(Ea.optional=Ft),b=this.finishNode(Ea,"CallExpression")}else if(this.type===J.backQuote){(Ft||ke)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var La=this.startNodeAt(M,Z);La.tag=b,La.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(La,"TaggedTemplateExpression")}return b},rn.parseExprAtom=function(b){this.type===J.slash&&this.readRegexp();var M,Z=this.potentialArrowAt===this.start;switch(this.type){case J._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===J.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==J.dot&&this.type!==J.bracketL&&this.type!==J.parenL&&this.unexpected(),this.finishNode(M,"Super");case J._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case J.name:var L=this.start,ne=this.startLoc,ke=this.containsEsc,st=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ke&&st.name==="async"&&!this.canInsertSemicolon()&&this.eat(J._function))return this.parseFunction(this.startNodeAt(L,ne),0,!1,!0);if(Z&&!this.canInsertSemicolon()){if(this.eat(J.arrow))return this.parseArrowExpression(this.startNodeAt(L,ne),[st],!1);if(this.options.ecmaVersion>=8&&st.name==="async"&&this.type===J.name&&!ke)return st=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(J.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(L,ne),[st],!0)}return st;case J.regexp:var Ft=this.value;return M=this.parseLiteral(Ft.value),M.regex={pattern:Ft.pattern,flags:Ft.flags},M;case J.num:case J.string:return this.parseLiteral(this.value);case J._null:case J._true:case J._false:return M=this.startNode(),M.value=this.type===J._null?null:this.type===J._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case J.parenL:var Bt=this.start,Sr=this.parseParenAndDistinguishExpression(Z);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Sr)&&(b.parenthesizedAssign=Bt),b.parenthesizedBind<0&&(b.parenthesizedBind=Bt)),Sr;case J.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(J.bracketR,!0,!0,b),this.finishNode(M,"ArrayExpression");case J.braceL:return this.parseObj(!1,b);case J._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case J._class:return this.parseClass(this.startNode(),!1);case J._new:return this.parseNew();case J.backQuote:return this.parseTemplate();case J._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},rn.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case J.parenL:return this.parseDynamicImport(b);case J.dot:return b.meta=M,this.parseImportMeta(b);default:this.unexpected()}},rn.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(J.parenR)){var M=this.start;this.eat(J.comma)&&this.eat(J.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(b,"ImportExpression")},rn.parseImportMeta=function(b){this.next();var M=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},rn.parseLiteral=function(b){var M=this.startNode();return M.value=b,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},rn.parseParenExpression=function(){this.expect(J.parenL);var b=this.parseExpression();return this.expect(J.parenR),b},rn.parseParenAndDistinguishExpression=function(b){var M=this.start,Z=this.startLoc,L,ne=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ke=this.start,st=this.startLoc,Ft=[],Bt=!0,Sr=!1,Br=new z,Hn=this.yieldPos,Kn=this.awaitPos,yi;for(this.yieldPos=0,this.awaitPos=0;this.type!==J.parenR;)if(Bt?Bt=!1:this.expect(J.comma),ne&&this.afterTrailingComma(J.parenR,!0)){Sr=!0;break}else if(this.type===J.ellipsis){yi=this.start,Ft.push(this.parseParenItem(this.parseRestBinding())),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Ft.push(this.parseMaybeAssign(!1,Br,this.parseParenItem));var $i=this.start,Ea=this.startLoc;if(this.expect(J.parenR),b&&!this.canInsertSemicolon()&&this.eat(J.arrow))return this.checkPatternErrors(Br,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Hn,this.awaitPos=Kn,this.parseParenArrowList(M,Z,Ft);(!Ft.length||Sr)&&this.unexpected(this.lastTokStart),yi&&this.unexpected(yi),this.checkExpressionErrors(Br,!0),this.yieldPos=Hn||this.yieldPos,this.awaitPos=Kn||this.awaitPos,Ft.length>1?(L=this.startNodeAt(ke,st),L.expressions=Ft,this.finishNodeAt(L,"SequenceExpression",$i,Ea)):L=Ft[0]}else L=this.parseParenExpression();if(this.options.preserveParens){var La=this.startNodeAt(M,Z);return La.expression=L,this.finishNode(La,"ParenthesizedExpression")}else return L},rn.parseParenItem=function(b){return b},rn.parseParenArrowList=function(b,M,Z){return this.parseArrowExpression(this.startNodeAt(b,M),Z)};var jn=[];rn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(J.dot)){b.meta=M;var Z=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),Z&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var L=this.start,ne=this.startLoc,ke=this.type===J._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),L,ne,!0),ke&&b.callee.type==="ImportExpression"&&this.raise(L,"Cannot use new with import()"),this.eat(J.parenL)?b.arguments=this.parseExprList(J.parenR,this.options.ecmaVersion>=8,!1):b.arguments=jn,this.finishNode(b,"NewExpression")},rn.parseTemplateElement=function(b){var M=b.isTagged,Z=this.startNode();return this.type===J.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),Z.value={raw:this.value,cooked:null}):Z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),Z.tail=this.type===J.backQuote,this.finishNode(Z,"TemplateElement")},rn.parseTemplate=function(b){b===void 0&&(b={});var M=b.isTagged;M===void 0&&(M=!1);var Z=this.startNode();this.next(),Z.expressions=[];var L=this.parseTemplateElement({isTagged:M});for(Z.quasis=[L];!L.tail;)this.type===J.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(J.dollarBraceL),Z.expressions.push(this.parseExpression()),this.expect(J.braceR),Z.quasis.push(L=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(Z,"TemplateLiteral")},rn.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===J.name||this.type===J.num||this.type===J.string||this.type===J.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===J.star)&&!lr.test(this.input.slice(this.lastTokEnd,this.start))},rn.parseObj=function(b,M){var Z=this.startNode(),L=!0,ne={};for(Z.properties=[],this.next();!this.eat(J.braceR);){if(L)L=!1;else if(this.expect(J.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(J.braceR))break;var ke=this.parseProperty(b,M);b||this.checkPropClash(ke,ne,M),Z.properties.push(ke)}return this.finishNode(Z,b?"ObjectPattern":"ObjectExpression")},rn.parseProperty=function(b,M){var Z=this.startNode(),L,ne,ke,st;if(this.options.ecmaVersion>=9&&this.eat(J.ellipsis))return b?(Z.argument=this.parseIdent(!1),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(Z,"RestElement")):(this.type===J.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),Z.argument=this.parseMaybeAssign(!1,M),this.type===J.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(Z,"SpreadElement"));this.options.ecmaVersion>=6&&(Z.method=!1,Z.shorthand=!1,(b||M)&&(ke=this.start,st=this.startLoc),b||(L=this.eat(J.star)));var Ft=this.containsEsc;return this.parsePropertyName(Z),!b&&!Ft&&this.options.ecmaVersion>=8&&!L&&this.isAsyncProp(Z)?(ne=!0,L=this.options.ecmaVersion>=9&&this.eat(J.star),this.parsePropertyName(Z,M)):ne=!1,this.parsePropertyValue(Z,b,L,ne,ke,st,M,Ft),this.finishNode(Z,"Property")},rn.parsePropertyValue=function(b,M,Z,L,ne,ke,st,Ft){if((Z||L)&&this.type===J.colon&&this.unexpected(),this.eat(J.colon))b.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,st),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===J.parenL)M&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(Z,L);else if(!M&&!Ft&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==J.comma&&this.type!==J.braceR&&this.type!==J.eq){(Z||L)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var Bt=b.kind==="get"?0:1;if(b.value.params.length!==Bt){var Sr=b.value.start;b.kind==="get"?this.raiseRecoverable(Sr,"getter should have no params"):this.raiseRecoverable(Sr,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((Z||L)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ne),b.kind="init",M?b.value=this.parseMaybeDefault(ne,ke,b.key):this.type===J.eq&&st?(st.shorthandAssign<0&&(st.shorthandAssign=this.start),b.value=this.parseMaybeDefault(ne,ke,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},rn.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(J.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(J.bracketR),b.key;b.computed=!1}return b.key=this.type===J.num||this.type===J.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},rn.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},rn.parseMethod=function(b,M,Z){var L=this.startNode(),ne=this.yieldPos,ke=this.awaitPos,st=this.awaitIdentPos;return this.initFunction(L),this.options.ecmaVersion>=6&&(L.generator=b),this.options.ecmaVersion>=8&&(L.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ki(M,L.generator)|si|(Z?Ri:0)),this.expect(J.parenL),L.params=this.parseBindingList(J.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(L,!1,!0),this.yieldPos=ne,this.awaitPos=ke,this.awaitIdentPos=st,this.finishNode(L,"FunctionExpression")},rn.parseArrowExpression=function(b,M,Z){var L=this.yieldPos,ne=this.awaitPos,ke=this.awaitIdentPos;return this.enterScope(ki(Z,!1)|ra),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!Z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(M,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=L,this.awaitPos=ne,this.awaitIdentPos=ke,this.finishNode(b,"ArrowFunctionExpression")},rn.parseFunctionBody=function(b,M,Z){var L=M&&this.type!==J.braceL,ne=this.strict,ke=!1;if(L)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var st=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!ne||st)&&(ke=this.strictDirective(this.end),ke&&st&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ft=this.labels;this.labels=[],ke&&(this.strict=!0),this.checkParams(b,!ne&&!ke&&!M&&!Z&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,ma),b.body=this.parseBlock(!1,void 0,ke&&!ne),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=Ft}this.exitScope()},rn.isSimpleParamList=function(b){for(var M=0,Z=b;M<Z.length;M+=1){var L=Z[M];if(L.type!=="Identifier")return!1}return!0},rn.checkParams=function(b,M){for(var Z={},L=0,ne=b.params;L<ne.length;L+=1){var ke=ne[L];this.checkLVal(ke,Yn,M?null:Z)}},rn.parseExprList=function(b,M,Z,L){for(var ne=[],ke=!0;!this.eat(b);){if(ke)ke=!1;else if(this.expect(J.comma),M&&this.afterTrailingComma(b))break;var st=void 0;Z&&this.type===J.comma?st=null:this.type===J.ellipsis?(st=this.parseSpread(L),L&&this.type===J.comma&&L.trailingComma<0&&(L.trailingComma=this.start)):st=this.parseMaybeAssign(!1,L),ne.push(st)}return ne},rn.checkUnreserved=function(b){var M=b.start,Z=b.end,L=b.name;if(this.inGenerator&&L==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&L==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(L)&&this.raise(M,"Unexpected keyword '"+L+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,Z).indexOf("\\")!==-1)){var ne=this.strict?this.reservedWordsStrict:this.reservedWords;ne.test(L)&&(!this.inAsync&&L==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+L+"' is reserved"))}},rn.parseIdent=function(b,M){var Z=this.startNode();return this.type===J.name?Z.name=this.value:this.type.keyword?(Z.name=this.type.keyword,(Z.name==="class"||Z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(Z,"Identifier"),b||(this.checkUnreserved(Z),Z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Z.start)),Z},rn.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===J.semi||this.canInsertSemicolon()||this.type!==J.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(J.star),M.argument=this.parseMaybeAssign(b)),this.finishNode(M,"YieldExpression")},rn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var Zn=wt.prototype;Zn.raise=function(b,M){var Z=Je(this.input,b);M+=" ("+Z.line+":"+Z.column+")";var L=new SyntaxError(M);throw L.pos=b,L.loc=Z,L.raisedAt=this.pos,L},Zn.raiseRecoverable=Zn.raise,Zn.curPosition=function(){if(this.options.locations)return new le(this.curLine,this.pos-this.lineStart)};var an=wt.prototype,ui=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(b){this.scopeStack.push(new ui(b))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(b){return b.flags&Dr||!this.inModule&&b.flags&Zr},an.declareName=function(b,M,Z){var L=!1;if(M===ri){var ne=this.currentScope();L=ne.lexical.indexOf(b)>-1||ne.functions.indexOf(b)>-1||ne.var.indexOf(b)>-1,ne.lexical.push(b),this.inModule&&ne.flags&Zr&&delete this.undefinedExports[b]}else if(M===Na){var ke=this.currentScope();ke.lexical.push(b)}else if(M===Ao){var st=this.currentScope();this.treatFunctionsAsVar?L=st.lexical.indexOf(b)>-1:L=st.lexical.indexOf(b)>-1||st.var.indexOf(b)>-1,st.functions.push(b)}else for(var Ft=this.scopeStack.length-1;Ft>=0;--Ft){var Bt=this.scopeStack[Ft];if(Bt.lexical.indexOf(b)>-1&&!(Bt.flags&xi&&Bt.lexical[0]===b)||!this.treatFunctionsAsVarInScope(Bt)&&Bt.functions.indexOf(b)>-1){L=!0;break}if(Bt.var.push(b),this.inModule&&Bt.flags&Zr&&delete this.undefinedExports[b],Bt.flags&Xn)break}L&&this.raiseRecoverable(Z,"Identifier '"+b+"' has already been declared")},an.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var M=this.scopeStack[b];if(M.flags&Xn)return M}},an.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var M=this.scopeStack[b];if(M.flags&Xn&&!(M.flags&ra))return M}};var fi=function(M,Z,L){this.type="",this.start=Z,this.end=0,M.options.locations&&(this.loc=new He(M,L)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[Z,0])},Hi=wt.prototype;Hi.startNode=function(){return new fi(this,this.start,this.startLoc)},Hi.startNodeAt=function(b,M){return new fi(this,b,M)};function Aa(b,M,Z,L){return b.type=M,b.end=Z,this.options.locations&&(b.loc.end=L),this.options.ranges&&(b.range[1]=Z),b}Hi.finishNode=function(b,M){return Aa.call(this,b,M,this.lastTokEnd,this.lastTokEndLoc)},Hi.finishNodeAt=function(b,M,Z,L){return Aa.call(this,b,M,Z,L)};var Pa=function(M,Z,L,ne,ke){this.token=M,this.isExpr=!!Z,this.preserveSpace=!!L,this.override=ne,this.generator=!!ke},ba={b_stat:new Pa("{",!1),b_expr:new Pa("{",!0),b_tmpl:new Pa("${",!1),p_stat:new Pa("(",!1),p_expr:new Pa("(",!0),q_tmpl:new Pa("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new Pa("function",!1),f_expr:new Pa("function",!0),f_expr_gen:new Pa("function",!0,!1,null,!0),f_gen:new Pa("function",!1,!1,null,!0)},Ki=wt.prototype;Ki.initialContext=function(){return[ba.b_stat]},Ki.braceIsBlock=function(b){var M=this.curContext();return M===ba.f_expr||M===ba.f_stat?!0:b===J.colon&&(M===ba.b_stat||M===ba.b_expr)?!M.isExpr:b===J._return||b===J.name&&this.exprAllowed?lr.test(this.input.slice(this.lastTokEnd,this.start)):b===J._else||b===J.semi||b===J.eof||b===J.parenR||b===J.arrow?!0:b===J.braceL?M===ba.b_stat:b===J._var||b===J._const||b===J.name?!1:!this.exprAllowed},Ki.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var M=this.context[b];if(M.token==="function")return M.generator}return!1},Ki.updateContext=function(b){var M,Z=this.type;Z.keyword&&b===J.dot?this.exprAllowed=!1:(M=Z.updateContext)?M.call(this,b):this.exprAllowed=Z.beforeExpr},J.parenR.updateContext=J.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===ba.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},J.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?ba.b_stat:ba.b_expr),this.exprAllowed=!0},J.dollarBraceL.updateContext=function(){this.context.push(ba.b_tmpl),this.exprAllowed=!0},J.parenL.updateContext=function(b){var M=b===J._if||b===J._for||b===J._with||b===J._while;this.context.push(M?ba.p_stat:ba.p_expr),this.exprAllowed=!0},J.incDec.updateContext=function(){},J._function.updateContext=J._class.updateContext=function(b){b.beforeExpr&&b!==J.semi&&b!==J._else&&!(b===J._return&&lr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===J.colon||b===J.braceL)&&this.curContext()===ba.b_stat)?this.context.push(ba.f_expr):this.context.push(ba.f_stat),this.exprAllowed=!1},J.backQuote.updateContext=function(){this.curContext()===ba.q_tmpl?this.context.pop():this.context.push(ba.q_tmpl),this.exprAllowed=!1},J.star.updateContext=function(b){if(b===J._function){var M=this.context.length-1;this.context[M]===ba.f_expr?this.context[M]=ba.f_expr_gen:this.context[M]=ba.f_gen}this.exprAllowed=!0},J.name.updateContext=function(b){var M=!1;this.options.ecmaVersion>=6&&b!==J.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var q="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ie=q+" Extended_Pictographic",pe=ie,we={9:q,10:ie,11:pe},ze="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",rt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",_t=rt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",be=_t+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",We={9:rt,10:_t,11:be},zt={};function Rr(b){var M=zt[b]={binary:U(we[b]+" "+ze),nonBinary:{General_Category:U(ze),Script:U(We[b])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}Rr(9),Rr(10),Rr(11);var er=wt.prototype,ar=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=zt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};ar.prototype.reset=function(M,Z,L){var ne=L.indexOf("u")!==-1;this.start=M|0,this.source=Z+"",this.flags=L,this.switchU=ne&&this.parser.options.ecmaVersion>=6,this.switchN=ne&&this.parser.options.ecmaVersion>=9},ar.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},ar.prototype.at=function(M,Z){Z===void 0&&(Z=!1);var L=this.source,ne=L.length;if(M>=ne)return-1;var ke=L.charCodeAt(M);if(!(Z||this.switchU)||ke<=55295||ke>=57344||M+1>=ne)return ke;var st=L.charCodeAt(M+1);return st>=56320&&st<=57343?(ke<<10)+st-56613888:ke},ar.prototype.nextIndex=function(M,Z){Z===void 0&&(Z=!1);var L=this.source,ne=L.length;if(M>=ne)return ne;var ke=L.charCodeAt(M),st;return!(Z||this.switchU)||ke<=55295||ke>=57344||M+1>=ne||(st=L.charCodeAt(M+1))<56320||st>57343?M+1:M+2},ar.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},ar.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},ar.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},ar.prototype.eat=function(M,Z){return Z===void 0&&(Z=!1),this.current(Z)===M?(this.advance(Z),!0):!1};function Or(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}er.validateRegExpFlags=function(b){for(var M=b.validFlags,Z=b.flags,L=0;L<Z.length;L++){var ne=Z.charAt(L);M.indexOf(ne)===-1&&this.raise(b.start,"Invalid regular expression flag"),Z.indexOf(ne,L+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},er.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},er.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var M=0,Z=b.backReferenceNames;M<Z.length;M+=1){var L=Z[M];b.groupNames.indexOf(L)===-1&&b.raise("Invalid named capture referenced")}},er.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},er.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},er.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},er.regexp_eatAssertion=function(b){var M=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=M}if(b.eat(40)&&b.eat(63)){var Z=!1;if(this.options.ecmaVersion>=9&&(Z=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!Z,!0}return b.pos=M,!1},er.regexp_eatQuantifier=function(b,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(b,M)?(b.eat(63),!0):!1},er.regexp_eatQuantifierPrefix=function(b,M){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,M)},er.regexp_eatBracedQuantifier=function(b,M){var Z=b.pos;if(b.eat(123)){var L=0,ne=-1;if(this.regexp_eatDecimalDigits(b)&&(L=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(ne=b.lastIntValue),b.eat(125)))return ne!==-1&&ne<L&&!M&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!M&&b.raise("Incomplete quantifier"),b.pos=Z}return!1},er.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},er.regexp_eatReverseSolidusAtomEscape=function(b){var M=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=M}return!1},er.regexp_eatUncapturingGroup=function(b){var M=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=M}return!1},er.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},er.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},er.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},er.regexp_eatSyntaxCharacter=function(b){var M=b.current();return Dn(M)?(b.lastIntValue=M,b.advance(),!0):!1};function Dn(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}er.regexp_eatPatternCharacters=function(b){for(var M=b.pos,Z=0;(Z=b.current())!==-1&&!Dn(Z);)b.advance();return b.pos!==M},er.regexp_eatExtendedPatternCharacter=function(b){var M=b.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(b.advance(),!0):!1},er.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},er.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},er.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=Or(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=Or(b.lastIntValue);return!0}return!1},er.regexp_eatRegExpIdentifierStart=function(b){var M=b.pos,Z=this.options.ecmaVersion>=11,L=b.current(Z);return b.advance(Z),L===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,Z)&&(L=b.lastIntValue),In(L)?(b.lastIntValue=L,!0):(b.pos=M,!1)};function In(b){return Pt(b,!0)||b===36||b===95}er.regexp_eatRegExpIdentifierPart=function(b){var M=b.pos,Z=this.options.ecmaVersion>=11,L=b.current(Z);return b.advance(Z),L===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,Z)&&(L=b.lastIntValue),qt(L)?(b.lastIntValue=L,!0):(b.pos=M,!1)};function qt(b){return ur(b,!0)||b===36||b===95||b===8204||b===8205}er.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},er.regexp_eatBackReference=function(b){var M=b.pos;if(this.regexp_eatDecimalEscape(b)){var Z=b.lastIntValue;if(b.switchU)return Z>b.maxBackReference&&(b.maxBackReference=Z),!0;if(Z<=b.numCapturingParens)return!0;b.pos=M}return!1},er.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},er.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},er.regexp_eatCControlLetter=function(b){var M=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=M}return!1},er.regexp_eatZero=function(b){return b.current()===48&&!Pi(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},er.regexp_eatControlEscape=function(b){var M=b.current();return M===116?(b.lastIntValue=9,b.advance(),!0):M===110?(b.lastIntValue=10,b.advance(),!0):M===118?(b.lastIntValue=11,b.advance(),!0):M===102?(b.lastIntValue=12,b.advance(),!0):M===114?(b.lastIntValue=13,b.advance(),!0):!1},er.regexp_eatControlLetter=function(b){var M=b.current();return Cn(M)?(b.lastIntValue=M%32,b.advance(),!0):!1};function Cn(b){return b>=65&&b<=90||b>=97&&b<=122}er.regexp_eatRegExpUnicodeEscapeSequence=function(b,M){M===void 0&&(M=!1);var Z=b.pos,L=M||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var ne=b.lastIntValue;if(L&&ne>=55296&&ne<=56319){var ke=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var st=b.lastIntValue;if(st>=56320&&st<=57343)return b.lastIntValue=(ne-55296)*1024+(st-56320)+65536,!0}b.pos=ke,b.lastIntValue=ne}return!0}if(L&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&mr(b.lastIntValue))return!0;L&&b.raise("Invalid unicode escape"),b.pos=Z}return!1};function mr(b){return b>=0&&b<=1114111}er.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var M=b.current();return M!==99&&(!b.switchN||M!==107)?(b.lastIntValue=M,b.advance(),!0):!1},er.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var M=b.current();if(M>=49&&M<=57){do b.lastIntValue=10*b.lastIntValue+(M-48),b.advance();while((M=b.current())>=48&&M<=57);return!0}return!1},er.regexp_eatCharacterClassEscape=function(b){var M=b.current();if(pt(M))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function pt(b){return b===100||b===68||b===115||b===83||b===119||b===87}er.regexp_eatUnicodePropertyValueExpression=function(b){var M=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var Z=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var L=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,Z,L),!0}}if(b.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var ne=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,ne),!0}return!1},er.regexp_validateUnicodePropertyNameAndValue=function(b,M,Z){Ne(b.unicodeProperties.nonBinary,M)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[M].test(Z)||b.raise("Invalid property value")},er.regexp_validateUnicodePropertyNameOrValue=function(b,M){b.unicodeProperties.binary.test(M)||b.raise("Invalid property name")},er.regexp_eatUnicodePropertyName=function(b){var M=0;for(b.lastStringValue="";Ei(M=b.current());)b.lastStringValue+=Or(M),b.advance();return b.lastStringValue!==""};function Ei(b){return Cn(b)||b===95}er.regexp_eatUnicodePropertyValue=function(b){var M=0;for(b.lastStringValue="";gn(M=b.current());)b.lastStringValue+=Or(M),b.advance();return b.lastStringValue!==""};function gn(b){return Ei(b)||Pi(b)}er.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},er.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},er.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var M=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var Z=b.lastIntValue;b.switchU&&(M===-1||Z===-1)&&b.raise("Invalid character class"),M!==-1&&Z!==-1&&M>Z&&b.raise("Range out of order in character class")}}},er.regexp_eatClassAtom=function(b){var M=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var Z=b.current();(Z===99||xt(Z))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=M}var L=b.current();return L!==93?(b.lastIntValue=L,b.advance(),!0):!1},er.regexp_eatClassEscape=function(b){var M=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=M}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},er.regexp_eatClassControlLetter=function(b){var M=b.current();return Pi(M)||M===95?(b.lastIntValue=M%32,b.advance(),!0):!1},er.regexp_eatHexEscapeSequence=function(b){var M=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=M}return!1},er.regexp_eatDecimalDigits=function(b){var M=b.pos,Z=0;for(b.lastIntValue=0;Pi(Z=b.current());)b.lastIntValue=10*b.lastIntValue+(Z-48),b.advance();return b.pos!==M};function Pi(b){return b>=48&&b<=57}er.regexp_eatHexDigits=function(b){var M=b.pos,Z=0;for(b.lastIntValue=0;na(Z=b.current());)b.lastIntValue=16*b.lastIntValue+vt(Z),b.advance();return b.pos!==M};function na(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function vt(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}er.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var M=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var Z=b.lastIntValue;M<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=M*64+Z*8+b.lastIntValue:b.lastIntValue=M*8+Z}else b.lastIntValue=M;return!0}return!1},er.regexp_eatOctalDigit=function(b){var M=b.current();return xt(M)?(b.lastIntValue=M-48,b.advance(),!0):(b.lastIntValue=0,!1)};function xt(b){return b>=48&&b<=55}er.regexp_eatFixedHexDigits=function(b,M){var Z=b.pos;b.lastIntValue=0;for(var L=0;L<M;++L){var ne=b.current();if(!na(ne))return b.pos=Z,!1;b.lastIntValue=16*b.lastIntValue+vt(ne),b.advance()}return!0};var Ii=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new He(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},hi=wt.prototype;hi.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ii(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},hi.getToken=function(){return this.next(),new Ii(this)},typeof Symbol!="undefined"&&(hi[Symbol.iterator]=function(){var b=this;return{next:function(){var M=b.getToken();return{done:M.type===J.eof,value:M}}}}),hi.curContext=function(){return this.context[this.context.length-1]},hi.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(J.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},hi.readToken=function(b){return Pt(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},hi.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var M=this.input.charCodeAt(this.pos+1);return(b<<10)+M-56613888},hi.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),M=this.pos,Z=this.input.indexOf("*/",this.pos+=2);if(Z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=Z+2,this.options.locations){Tt.lastIndex=M;for(var L;(L=Tt.exec(this.input))&&L.index<this.pos;)++this.curLine,this.lineStart=L.index+L[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,Z),M,this.pos,b,this.curPosition())},hi.skipLineComment=function(b){for(var M=this.pos,Z=this.options.onComment&&this.curPosition(),L=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!ht(L);)L=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+b,this.pos),M,this.pos,Z,this.curPosition())},hi.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&Wt.test(String.fromCharCode(b)))++this.pos;else break e}}},hi.finishToken=function(b,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var Z=this.type;this.type=b,this.value=M,this.updateContext(Z)},hi.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&M===46?(this.pos+=3,this.finishToken(J.ellipsis)):(++this.pos,this.finishToken(J.dot))},hi.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(J.assign,2):this.finishOp(J.slash,1)},hi.readToken_mult_modulo_exp=function(b){var M=this.input.charCodeAt(this.pos+1),Z=1,L=b===42?J.star:J.modulo;return this.options.ecmaVersion>=7&&b===42&&M===42&&(++Z,L=J.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(J.assign,Z+1):this.finishOp(L,Z)},hi.readToken_pipe_amp=function(b){var M=this.input.charCodeAt(this.pos+1);if(M===b){if(this.options.ecmaVersion>=12){var Z=this.input.charCodeAt(this.pos+2);if(Z===61)return this.finishOp(J.assign,3)}return this.finishOp(b===124?J.logicalOR:J.logicalAND,2)}return M===61?this.finishOp(J.assign,2):this.finishOp(b===124?J.bitwiseOR:J.bitwiseAND,1)},hi.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(J.assign,2):this.finishOp(J.bitwiseXOR,1)},hi.readToken_plus_min=function(b){var M=this.input.charCodeAt(this.pos+1);return M===b?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||lr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(J.incDec,2):M===61?this.finishOp(J.assign,2):this.finishOp(J.plusMin,1)},hi.readToken_lt_gt=function(b){var M=this.input.charCodeAt(this.pos+1),Z=1;return M===b?(Z=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+Z)===61?this.finishOp(J.assign,Z+1):this.finishOp(J.bitShift,Z)):M===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(Z=2),this.finishOp(J.relational,Z))},hi.readToken_eq_excl=function(b){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(J.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(J.arrow)):this.finishOp(b===61?J.eq:J.prefix,1)},hi.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var Z=this.input.charCodeAt(this.pos+2);if(Z<48||Z>57)return this.finishOp(J.questionDot,2)}if(M===63){if(b>=12){var L=this.input.charCodeAt(this.pos+2);if(L===61)return this.finishOp(J.assign,3)}return this.finishOp(J.coalesce,2)}}return this.finishOp(J.question,1)},hi.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(J.parenL);case 41:return++this.pos,this.finishToken(J.parenR);case 59:return++this.pos,this.finishToken(J.semi);case 44:return++this.pos,this.finishToken(J.comma);case 91:return++this.pos,this.finishToken(J.bracketL);case 93:return++this.pos,this.finishToken(J.bracketR);case 123:return++this.pos,this.finishToken(J.braceL);case 125:return++this.pos,this.finishToken(J.braceR);case 58:return++this.pos,this.finishToken(J.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(J.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(J.prefix,1)}this.raise(this.pos,"Unexpected character '"+ia(b)+"'")},hi.finishOp=function(b,M){var Z=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(b,Z)},hi.readRegexp=function(){for(var b,M,Z=this.pos;;){this.pos>=this.input.length&&this.raise(Z,"Unterminated regular expression");var L=this.input.charAt(this.pos);if(lr.test(L)&&this.raise(Z,"Unterminated regular expression"),b)b=!1;else{if(L==="[")M=!0;else if(L==="]"&&M)M=!1;else if(L==="/"&&!M)break;b=L==="\\"}++this.pos}var ne=this.input.slice(Z,this.pos);++this.pos;var ke=this.pos,st=this.readWord1();this.containsEsc&&this.unexpected(ke);var Ft=this.regexpState||(this.regexpState=new ar(this));Ft.reset(Z,ne,st),this.validateRegExpFlags(Ft),this.validateRegExpPattern(Ft);var Bt=null;try{Bt=new RegExp(ne,st)}catch(Sr){}return this.finishToken(J.regexp,{pattern:ne,flags:st,value:Bt})},hi.readInt=function(b,M,Z){for(var L=this.options.ecmaVersion>=12&&M===void 0,ne=Z&&this.input.charCodeAt(this.pos)===48,ke=this.pos,st=0,Ft=0,Bt=0,Sr=M==null?Infinity:M;Bt<Sr;++Bt,++this.pos){var Br=this.input.charCodeAt(this.pos),Hn=void 0;if(L&&Br===95){ne&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ft===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Bt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ft=Br;continue}if(Br>=97?Hn=Br-97+10:Br>=65?Hn=Br-65+10:Br>=48&&Br<=57?Hn=Br-48:Hn=Infinity,Hn>=b)break;Ft=Br,st=st*b+Hn}return L&&Ft===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ke||M!=null&&this.pos-ke!==M?null:st};function Qi(b,M){return M?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function Ji(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}hi.readRadixNumber=function(b){var M=this.pos;this.pos+=2;var Z=this.readInt(b);return Z==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(Z=Ji(this.input.slice(M,this.pos)),++this.pos):Pt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(J.num,Z)},hi.readNumber=function(b){var M=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var Z=this.pos-M>=2&&this.input.charCodeAt(M)===48;Z&&this.strict&&this.raise(M,"Invalid number");var L=this.input.charCodeAt(this.pos);if(!Z&&!b&&this.options.ecmaVersion>=11&&L===110){var ne=Ji(this.input.slice(M,this.pos));return++this.pos,Pt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(J.num,ne)}Z&&/[89]/.test(this.input.slice(M,this.pos))&&(Z=!1),L===46&&!Z&&(++this.pos,this.readInt(10),L=this.input.charCodeAt(this.pos)),(L===69||L===101)&&!Z&&(L=this.input.charCodeAt(++this.pos),(L===43||L===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),Pt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ke=Qi(this.input.slice(M,this.pos),Z);return this.finishToken(J.num,ke)},hi.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),M;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var Z=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(Z,"Code point out of bounds")}else M=this.readHexChar(4);return M};function ia(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}hi.readString=function(b){for(var M="",Z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var L=this.input.charCodeAt(this.pos);if(L===b)break;L===92?(M+=this.input.slice(Z,this.pos),M+=this.readEscapedChar(!1),Z=this.pos):(ht(L,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(Z,this.pos++),this.finishToken(J.string,M)};var Fi={};hi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===Fi)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},hi.invalidStringToken=function(b,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Fi;this.raise(b,M)},hi.readTmplToken=function(){for(var b="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var Z=this.input.charCodeAt(this.pos);if(Z===96||Z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===J.template||this.type===J.invalidTemplate)?Z===36?(this.pos+=2,this.finishToken(J.dollarBraceL)):(++this.pos,this.finishToken(J.backQuote)):(b+=this.input.slice(M,this.pos),this.finishToken(J.template,b));if(Z===92)b+=this.input.slice(M,this.pos),b+=this.readEscapedChar(!0),M=this.pos;else if(ht(Z)){switch(b+=this.input.slice(M,this.pos),++this.pos,Z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(Z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},hi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(J.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},hi.readEscapedChar=function(b){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ia(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var Z=this.pos-1;return this.invalidStringToken(Z,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var L=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ne=parseInt(L,8);return ne>255&&(L=L.slice(0,-1),ne=parseInt(L,8)),this.pos+=L.length-1,M=this.input.charCodeAt(this.pos),(L!=="0"||M===56||M===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-L.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ne)}return ht(M)?"":String.fromCharCode(M)}},hi.readHexChar=function(b){var M=this.pos,Z=this.readInt(16,b);return Z===null&&this.invalidStringToken(M,"Bad character escape sequence"),Z},hi.readWord1=function(){this.containsEsc=!1;for(var b="",M=!0,Z=this.pos,L=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ne=this.fullCharCodeAtPos();if(ur(ne,L))this.pos+=ne<=65535?1:2;else if(ne===92){this.containsEsc=!0,b+=this.input.slice(Z,this.pos);var ke=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var st=this.readCodePoint();(M?Pt:ur)(st,L)||this.invalidStringToken(ke,"Invalid Unicode escape"),b+=ia(st),Z=this.pos}else break;M=!1}return b+this.input.slice(Z,this.pos)},hi.readWord=function(){var b=this.readWord1(),M=J.name;return this.keywords.test(b)&&(M=kt[b]),this.finishToken(M,b)};var sr="7.4.1";wt.acorn={Parser:wt,version:sr,defaultOptions:ft,Position:le,SourceLocation:He,getLineInfo:Je,Node:fi,TokenType:Nt,tokTypes:J,keywordTypes:kt,TokContext:Pa,tokContexts:ba,isIdentifierChar:ur,isIdentifierStart:Pt,Token:Ii,isNewLine:ht,lineBreak:lr,lineBreakG:Tt,nonASCIIwhitespace:Wt};function xr(b,M){return wt.parse(b,M)}function je(b,M,Z){return wt.parseExpressionAt(b,M,Z)}function wa(b,M){return wt.tokenizer(b,M)}function Le(b,M){b.prototype=Object.create(M.prototype),b.prototype.constructor=b,b.__proto__=M}function As(b){var M=typeof Map=="function"?new Map:void 0;return As=function(L){if(L===null||!Ys(L))return L;if(typeof L!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(L))return M.get(L);M.set(L,ne)}function ne(){return ta(L,arguments,Wa(this).constructor)}return ne.prototype=Object.create(L.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),no(ne,L)},As(b)}function us(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function ta(b,M,Z){return us()?ta=Reflect.construct:ta=function(ne,ke,st){var Ft=[null];Ft.push.apply(Ft,ke);var Bt=Function.bind.apply(ne,Ft),Sr=new Bt;return st&&no(Sr,st.prototype),Sr},ta.apply(null,arguments)}function Ys(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function no(b,M){return no=Object.setPrototypeOf||function(L,ne){return L.__proto__=ne,L},no(b,M)}function Wa(b){return Wa=Object.setPrototypeOf?Object.getPrototypeOf:function(Z){return Z.__proto__||Object.getPrototypeOf(Z)},Wa(b)}var io=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(As(Error)),aa=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(As(SyntaxError)),jo=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(As(ReferenceError)),Qo=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(As(TypeError)),Au=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(io),wo=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(aa),To=function(b){Le(M,b);function M(){return b.apply(this,arguments)||this}return M}(jo),la={UnknownError:[3001,"%0",Au],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Au],NodeTypeSyntaxError:[1001,"Unknown node type: %0",To],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",To],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",To],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",To],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",To],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",To],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",To],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",To],ParamTypeSyntaxError:[1009,"Unknown param type: %0",To],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",To],FunctionUndefinedReferenceError:[2001,"%0 is not a function",jo],VariableUndefinedReferenceError:[2002,"%0 is not defined",jo],IsNotConstructor:[2003,"%0 is not a constructor",Qo]};function ao(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function Go(b,M,Z){return ao()?Go=Reflect.construct:Go=function(ne,ke,st){var Ft=[null];Ft.push.apply(Ft,ke);var Bt=Function.bind.apply(ne,Ft),Sr=new Bt;return st&&qa(Sr,st.prototype),Sr},Go.apply(null,arguments)}function qa(b,M){return qa=Object.setPrototypeOf||function(L,ne){return L.__proto__=ne,L},qa(b,M)}var nu="0.0.3";function Rl(b,M){Object.defineProperty(b,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var Jo=Object.prototype.hasOwnProperty,he=Symbol("Break"),Pe=Symbol("Continue"),dt=Symbol("DefaultCase"),Jt=Symbol("EmptyStatementReturn"),en=Symbol("WithScopeName"),Gn=Symbol("SuperScopeName"),Bi=Symbol("RootScopeName"),fo=Symbol("GlobalScopeName");function za(b){return typeof b=="function"}var Ka=function(){function b(Z){this.interpreter=Z}var M=b.prototype;return M.generator=function(){var L=this.interpreter;function ne(){return this.getCurrentScope()}function ke(){return this.getGlobalScope()}function st(){return this.getCurrentContext()}return{getOptions:L.getOptions.bind(L),getCurrentScope:ne.bind(L),getGlobalScope:ke.bind(L),getCurrentContext:st.bind(L),getExecStartTime:L.getExecStartTime.bind(L)}},b}();function es(b,M,Z){if(Z===void 0&&(Z=!0),!(b instanceof Ka))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var L=b.generator(),ne=L.getOptions(),ke={timeout:ne.timeout,_initEnv:function(){Z||this.setCurrentContext(L.getCurrentContext()),this.execStartTime=L.getExecStartTime(),this.execEndTime=this.execStartTime}},st=Z?L.getGlobalScope():L.getCurrentScope(),Ft=new Ia(st,ke);return Ft.evaluate(M)}}Object.defineProperty(es,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Oo(b){if(!(b instanceof Ka))throw new Error("Illegal call");for(var M=b.generator(),Z=arguments.length,L=new Array(Z>1?Z-1:0),ne=1;ne<Z;ne++)L[ne-1]=arguments[ne];var ke=L.pop(),st=new Ia(M.getGlobalScope(),M.getOptions()),Ft=`
		    (function anonymous(`+L.join(",")+`){
		        `+ke+`
		    });
		    `;return st.evaluate(Ft)}Object.defineProperty(Oo,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var go=function(M){this.value=M},ws=function(M){this.value=M},Ts=function(M){this.value=M},Ms=function(M,Z,L){Z===void 0&&(Z=null),this.name=L,this.parent=Z,this.data=M,this.labelStack=[]};function iu(){}function vu(b,M){return b===void 0&&(b=null),new Ms(Object.create(null),b,M)}function ys(b){return Object.create(b)}var zi={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:es,Function:Oo};typeof JSON!="undefined"&&(zi.JSON=JSON),typeof Promise!="undefined"&&(zi.Promise=Promise),typeof Set!="undefined"&&(zi.Set=Set),typeof Map!="undefined"&&(zi.Map=Map),typeof Symbol!="undefined"&&(zi.Symbol=Symbol),typeof Proxy!="undefined"&&(zi.Proxy=Proxy),typeof WeakMap!="undefined"&&(zi.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(zi.WeakSet=WeakSet),typeof Reflect!="undefined"&&(zi.Reflect=Reflect);var Ia=function(){function b(Z,L){Z===void 0&&(Z=b.global),L===void 0&&(L={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:L.ecmaVersion||b.ecmaVersion,timeout:L.timeout||0,rootContext:L.rootContext,globalContextInFunction:L.globalContextInFunction===void 0?b.globalContextInFunction:L.globalContextInFunction,_initEnv:L._initEnv},this.context=Z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=b.prototype;return M.initEnvironment=function(L){var ne;if(L instanceof Ms)ne=L;else{var ke=null,st=this.createSuperScope(L);this.options.rootContext&&(ke=new Ms(ys(this.options.rootContext),st,Bi)),ne=new Ms(L,ke||st,fo)}this.globalScope=ne,this.currentScope=this.globalScope,this.globalContext=ne.data,this.currentContext=ne.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Ft=this.options._initEnv;Ft&&Ft.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(L){L===void 0&&(L=0),this.options.timeout=L},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(L){return L instanceof Au||L instanceof To||L instanceof wo},M.createSuperScope=function(L){var ne=Object.assign({},zi),ke=Object.keys(ne);return ke.forEach(function(st){st in L&&delete ne[st]}),new Ms(ne,null,Gn)},M.setCurrentContext=function(L){this.currentContext=L},M.setCurrentScope=function(L){this.currentScope=L},M.evaluate=function(L){L===void 0&&(L="");var ne;if(!!L)return ne=xr(L,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(ne,L)},M.appendCode=function(L){return this.evaluate(L)},M.evaluateNode=function(L,ne){var ke=this;ne===void 0&&(ne=""),this.value=void 0,this.source=ne,this.sourceList.push(ne),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var st=this.getCurrentScope(),Ft=this.getCurrentContext(),Bt=st.labelStack.concat([]),Sr=this.callStack.concat([]),Br=function(){ke.setCurrentScope(st),ke.setCurrentContext(Ft),st.labelStack=Bt,ke.callStack=Sr};try{var Hn=this.createClosure(L);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Hn()}catch(Kn){throw Kn}finally{Br(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(L,ne,ke){var st=L[1].replace("%0",String(ne));return ke!==null&&(st+=this.getNodePosition(ke||this.lastExecNode)),st},M.createError=function(L,ne){return new ne(L)},M.createThrowError=function(L,ne){return this.createError(L,ne)},M.createInternalThrowError=function(L,ne,ke){return this.createError(this.createErrorMessage(L,ne,ke),L[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var L=this.options.timeout||0,ne=Date.now();return ne-this.execStartTime>L},M.getNodePosition=function(L){if(L){var ne="";return L.loc?" ["+L.loc.start.line+":"+L.loc.start.column+"]"+ne:""}return""},M.createClosure=function(L){var ne=this,ke;switch(L.type){case"BinaryExpression":ke=this.binaryExpressionHandler(L);break;case"LogicalExpression":ke=this.logicalExpressionHandler(L);break;case"UnaryExpression":ke=this.unaryExpressionHandler(L);break;case"UpdateExpression":ke=this.updateExpressionHandler(L);break;case"ObjectExpression":ke=this.objectExpressionHandler(L);break;case"ArrayExpression":ke=this.arrayExpressionHandler(L);break;case"CallExpression":ke=this.callExpressionHandler(L);break;case"NewExpression":ke=this.newExpressionHandler(L);break;case"MemberExpression":ke=this.memberExpressionHandler(L);break;case"ThisExpression":ke=this.thisExpressionHandler(L);break;case"SequenceExpression":ke=this.sequenceExpressionHandler(L);break;case"Literal":ke=this.literalHandler(L);break;case"Identifier":ke=this.identifierHandler(L);break;case"AssignmentExpression":ke=this.assignmentExpressionHandler(L);break;case"FunctionDeclaration":ke=this.functionDeclarationHandler(L);break;case"VariableDeclaration":ke=this.variableDeclarationHandler(L);break;case"BlockStatement":case"Program":ke=this.programHandler(L);break;case"ExpressionStatement":ke=this.expressionStatementHandler(L);break;case"EmptyStatement":ke=this.emptyStatementHandler(L);break;case"ReturnStatement":ke=this.returnStatementHandler(L);break;case"FunctionExpression":ke=this.functionExpressionHandler(L);break;case"IfStatement":ke=this.ifStatementHandler(L);break;case"ConditionalExpression":ke=this.conditionalExpressionHandler(L);break;case"ForStatement":ke=this.forStatementHandler(L);break;case"WhileStatement":ke=this.whileStatementHandler(L);break;case"DoWhileStatement":ke=this.doWhileStatementHandler(L);break;case"ForInStatement":ke=this.forInStatementHandler(L);break;case"WithStatement":ke=this.withStatementHandler(L);break;case"ThrowStatement":ke=this.throwStatementHandler(L);break;case"TryStatement":ke=this.tryStatementHandler(L);break;case"ContinueStatement":ke=this.continueStatementHandler(L);break;case"BreakStatement":ke=this.breakStatementHandler(L);break;case"SwitchStatement":ke=this.switchStatementHandler(L);break;case"LabeledStatement":ke=this.labeledStatementHandler(L);break;case"DebuggerStatement":ke=this.debuggerStatementHandler(L);break;default:throw this.createInternalThrowError(la.NodeTypeSyntaxError,L.type,L)}return function(){var st=ne.options.timeout;if(st&&st>0&&ne.checkTimeout())throw ne.createInternalThrowError(la.ExecutionTimeOutError,st,null);return ne.lastExecNode=L,ke.apply(void 0,arguments)}},M.binaryExpressionHandler=function(L){var ne=this,ke=this.createClosure(L.left),st=this.createClosure(L.right);return function(){var Ft=ke(),Bt=st();switch(L.operator){case"==":return Ft==Bt;case"!=":return Ft!=Bt;case"===":return Ft===Bt;case"!==":return Ft!==Bt;case"<":return Ft<Bt;case"<=":return Ft<=Bt;case">":return Ft>Bt;case">=":return Ft>=Bt;case"<<":return Ft<<Bt;case">>":return Ft>>Bt;case">>>":return Ft>>>Bt;case"+":return Ft+Bt;case"-":return Ft-Bt;case"*":return Ft*Bt;case"**":return Math.pow(Ft,Bt);case"/":return Ft/Bt;case"%":return Ft%Bt;case"|":return Ft|Bt;case"^":return Ft^Bt;case"&":return Ft&Bt;case"in":return Ft in Bt;case"instanceof":return Ft instanceof Bt;default:throw ne.createInternalThrowError(la.BinaryOperatorSyntaxError,L.operator,L)}}},M.logicalExpressionHandler=function(L){var ne=this,ke=this.createClosure(L.left),st=this.createClosure(L.right);return function(){switch(L.operator){case"||":return ke()||st();case"&&":return ke()&&st();default:throw ne.createInternalThrowError(la.LogicalOperatorSyntaxError,L.operator,L)}}},M.unaryExpressionHandler=function(L){var ne=this;switch(L.operator){case"delete":var ke=this.createObjectGetter(L.argument),st=this.createNameGetter(L.argument);return function(){var Br=ke(),Hn=st();return delete Br[Hn]};default:var Ft;if(L.operator==="typeof"&&L.argument.type==="Identifier"){var Bt=this.createObjectGetter(L.argument),Sr=this.createNameGetter(L.argument);Ft=function(){return Bt()[Sr()]}}else Ft=this.createClosure(L.argument);return function(){var Br=Ft();switch(L.operator){case"-":return-Br;case"+":return+Br;case"!":return!Br;case"~":return~Br;case"void":return;case"typeof":return typeof Br;default:throw ne.createInternalThrowError(la.UnaryOperatorSyntaxError,L.operator,L)}}}},M.updateExpressionHandler=function(L){var ne=this,ke=this.createObjectGetter(L.argument),st=this.createNameGetter(L.argument);return function(){var Ft=ke(),Bt=st();switch(ne.assertVariable(Ft,Bt,L),L.operator){case"++":return L.prefix?++Ft[Bt]:Ft[Bt]++;case"--":return L.prefix?--Ft[Bt]:Ft[Bt]--;default:throw ne.createInternalThrowError(la.UpdateOperatorSyntaxError,L.operator,L)}}},M.objectExpressionHandler=function(L){var ne=this,ke=[];function st(Bt){return Bt.type==="Identifier"?Bt.name:Bt.type==="Literal"?Bt.value:this.throwError(la.ObjectStructureSyntaxError,Bt.type,Bt)}var Ft=Object.create(null);return L.properties.forEach(function(Bt){var Sr=Bt.kind,Br=st(Bt.key);(!Ft[Br]||Sr==="init")&&(Ft[Br]={}),Ft[Br][Sr]=ne.createClosure(Bt.value),ke.push({key:Br,property:Bt})}),function(){for(var Bt={},Sr=ke.length,Br=0;Br<Sr;Br++){var Hn=ke[Br],Kn=Hn.key,yi=Ft[Kn],$i=yi.init?yi.init():void 0,Ea=yi.get?yi.get():function(){},La=yi.set?yi.set():function(pl){};if("set"in yi||"get"in yi){var qi={configurable:!0,enumerable:!0,get:Ea,set:La};Object.defineProperty(Bt,Kn,qi)}else{var _s=Hn.property,mu=_s.kind;_s.key.type==="Identifier"&&_s.value.type==="FunctionExpression"&&mu==="init"&&!_s.value.id&&Rl($i,_s.key.name),Bt[Kn]=$i}}return Bt}},M.arrayExpressionHandler=function(L){var ne=this,ke=L.elements.map(function(st){return st&&ne.createClosure(st)});return function(){for(var st=ke.length,Ft=Array(st),Bt=0;Bt<st;Bt++){var Sr=ke[Bt];Sr&&(Ft[Bt]=Sr())}return Ft}},M.safeObjectGet=function(L,ne,ke){return L[ne]},M.createCallFunctionGetter=function(L){var ne=this;switch(L.type){case"MemberExpression":var ke=this.createClosure(L.object),st=this.createMemberKeyGetter(L),Ft=this.source;return function(){var Sr=ke(),Br=st(),Hn=ne.safeObjectGet(Sr,Br,L);if(!Hn||!za(Hn)){var Kn=Ft.slice(L.start,L.end);throw ne.createInternalThrowError(la.FunctionUndefinedReferenceError,Kn,L)}return Hn.__IS_EVAL_FUNC?function(yi){return Hn(new Ka(ne),yi,!0)}:Hn.__IS_FUNCTION_FUNC?function(){for(var yi=arguments.length,$i=new Array(yi),Ea=0;Ea<yi;Ea++)$i[Ea]=arguments[Ea];return Hn.apply(void 0,[new Ka(ne)].concat($i))}:Hn.bind(Sr)};default:var Bt=this.createClosure(L);return function(){var Sr="";L.type==="Identifier"&&(Sr=L.name);var Br=Bt();if(!Br||!za(Br))throw ne.createInternalThrowError(la.FunctionUndefinedReferenceError,Sr,L);if(L.type==="Identifier"&&Br.__IS_EVAL_FUNC&&Sr==="eval")return function(yi){var $i=ne.getScopeFromName(Sr,ne.getCurrentScope()),Ea=$i.name===Gn||$i.name===fo||$i.name===Bi;return Br(new Ka(ne),yi,!Ea)};if(Br.__IS_EVAL_FUNC)return function(yi){return Br(new Ka(ne),yi,!0)};if(Br.__IS_FUNCTION_FUNC)return function(){for(var yi=arguments.length,$i=new Array(yi),Ea=0;Ea<yi;Ea++)$i[Ea]=arguments[Ea];return Br.apply(void 0,[new Ka(ne)].concat($i))};var Hn=ne.options.globalContextInFunction;if(L.type==="Identifier"){var Kn=ne.getIdentifierScope(L);Kn.name===en&&(Hn=Kn.data)}return Br.bind(Hn)}}},M.callExpressionHandler=function(L){var ne=this,ke=this.createCallFunctionGetter(L.callee),st=L.arguments.map(function(Ft){return ne.createClosure(Ft)});return function(){return ke().apply(void 0,st.map(function(Ft){return Ft()}))}},M.functionExpressionHandler=function(L){var ne=this,ke=this,st=this.source,Ft=this.collectDeclVars,Bt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Sr=L.id?L.id.name:"",Br=L.params.length,Hn=L.params.map(function(Ea){return ne.createParamNameGetter(Ea)}),Kn=this.createClosure(L.body),yi=this.collectDeclVars,$i=this.collectDeclFuncs;return this.collectDeclVars=Ft,this.collectDeclFuncs=Bt,function(){var Ea=ke.getCurrentScope(),La=function qi(){for(var _s=arguments.length,mu=new Array(_s),pl=0;pl<_s;pl++)mu[pl]=arguments[pl];ke.callStack.push(""+Sr);var xf=ke.getCurrentScope(),dl=vu(Ea,"FunctionScope("+Sr+")");ke.setCurrentScope(dl),ke.addDeclarationsToScope(yi,$i,dl),Sr&&(dl.data[Sr]=qi),dl.data.arguments=arguments,Hn.forEach(function(zu,Zu){dl.data[zu()]=mu[Zu]});var Wc=ke.getCurrentContext();ke.setCurrentContext(this);var Nu=Kn();if(ke.setCurrentContext(Wc),ke.setCurrentScope(xf),ke.callStack.pop(),Nu instanceof go)return Nu.value};return Rl(La,Sr),Object.defineProperty(La,"length",{value:Br,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(La,"toString",{value:function(){return st.slice(L.start,L.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(La,"valueOf",{value:function(){return st.slice(L.start,L.end)},writable:!0,configurable:!0,enumerable:!1}),La}},M.newExpressionHandler=function(L){var ne=this,ke=this.source,st=this.createClosure(L.callee),Ft=L.arguments.map(function(Bt){return ne.createClosure(Bt)});return function(){var Bt=st();if(!za(Bt)||Bt.__IS_EVAL_FUNC){var Sr=L.callee,Br=ke.slice(Sr.start,Sr.end);throw ne.createInternalThrowError(la.IsNotConstructor,Br,L)}return Bt.__IS_FUNCTION_FUNC?Bt.apply(void 0,[new Ka(ne)].concat(Ft.map(function(Hn){return Hn()}))):Go(Bt,Ft.map(function(Hn){return Hn()}))}},M.memberExpressionHandler=function(L){var ne=this.createClosure(L.object),ke=this.createMemberKeyGetter(L);return function(){var st=ne(),Ft=ke();return st[Ft]}},M.thisExpressionHandler=function(L){var ne=this;return function(){return ne.getCurrentContext()}},M.sequenceExpressionHandler=function(L){var ne=this,ke=L.expressions.map(function(st){return ne.createClosure(st)});return function(){for(var st,Ft=ke.length,Bt=0;Bt<Ft;Bt++){var Sr=ke[Bt];st=Sr()}return st}},M.literalHandler=function(L){return function(){return L.regex?new RegExp(L.regex.pattern,L.regex.flags):L.value}},M.identifierHandler=function(L){var ne=this;return function(){var ke=ne.getCurrentScope(),st=ne.getScopeDataFromName(L.name,ke);return ne.assertVariable(st,L.name,L),st[L.name]}},M.getIdentifierScope=function(L){var ne=this.getCurrentScope(),ke=this.getScopeFromName(L.name,ne);return ke},M.assignmentExpressionHandler=function(L){var ne=this;L.left.type==="Identifier"&&L.right.type==="FunctionExpression"&&!L.right.id&&(L.right.id={type:"Identifier",name:L.left.name});var ke=this.createObjectGetter(L.left),st=this.createNameGetter(L.left),Ft=this.createClosure(L.right);return function(){var Bt=ke(),Sr=st(),Br=Ft();switch(L.operator!=="="&&ne.assertVariable(Bt,Sr,L),L.operator){case"=":return Bt[Sr]=Br;case"+=":return Bt[Sr]+=Br;case"-=":return Bt[Sr]-=Br;case"*=":return Bt[Sr]*=Br;case"**=":return Bt[Sr]=Math.pow(Bt[Sr],Br);case"/=":return Bt[Sr]/=Br;case"%=":return Bt[Sr]%=Br;case"<<=":return Bt[Sr]<<=Br;case">>=":return Bt[Sr]>>=Br;case">>>=":return Bt[Sr]>>>=Br;case"&=":return Bt[Sr]&=Br;case"^=":return Bt[Sr]^=Br;case"|=":return Bt[Sr]|=Br;default:throw ne.createInternalThrowError(la.AssignmentExpressionSyntaxError,L.type,L)}}},M.functionDeclarationHandler=function(L){if(L.id){var ne=this.functionExpressionHandler(L);Object.defineProperty(ne,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(L.id.name,ne)}return function(){return Jt}},M.getVariableName=function(L){if(L.type==="Identifier")return L.name;throw this.createInternalThrowError(la.VariableTypeSyntaxError,L.type,L)},M.variableDeclarationHandler=function(L){for(var ne=this,ke,st=[],Ft=0;Ft<L.declarations.length;Ft++){var Bt=L.declarations[Ft];this.varDeclaration(this.getVariableName(Bt.id)),Bt.init&&st.push({type:"AssignmentExpression",operator:"=",left:Bt.id,right:Bt.init})}return st.length&&(ke=this.createClosure({type:"BlockStatement",body:st})),function(){if(ke){var Sr=ne.isVarDeclMode;ne.isVarDeclMode=!0,ke(),ne.isVarDeclMode=Sr}return Jt}},M.assertVariable=function(L,ne,ke){if(L===this.globalScope.data&&!(ne in L))throw this.createInternalThrowError(la.VariableUndefinedReferenceError,ne,ke)},M.programHandler=function(L){var ne=this,ke=L.body.map(function(st){return ne.createClosure(st)});return function(){for(var st=Jt,Ft=0;Ft<ke.length;Ft++){var Bt=ke[Ft],Sr=ne.setValue(Bt());if(Sr!==Jt&&(st=Sr,st instanceof go||st instanceof ws||st instanceof Ts||st===he||st===Pe))break}return st}},M.expressionStatementHandler=function(L){return this.createClosure(L.expression)},M.emptyStatementHandler=function(L){return function(){return Jt}},M.returnStatementHandler=function(L){var ne=L.argument?this.createClosure(L.argument):iu;return function(){return new go(ne())}},M.ifStatementHandler=function(L){var ne=this.createClosure(L.test),ke=this.createClosure(L.consequent),st=L.alternate?this.createClosure(L.alternate):function(){return Jt};return function(){return ne()?ke():st()}},M.conditionalExpressionHandler=function(L){return this.ifStatementHandler(L)},M.forStatementHandler=function(L){var ne=this,ke=iu,st=L.test?this.createClosure(L.test):function(){return!0},Ft=iu,Bt=this.createClosure(L.body);return L.type==="ForStatement"&&(ke=L.init?this.createClosure(L.init):ke,Ft=L.update?this.createClosure(L.update):iu),function(Sr){var Br,Hn=Jt,Kn=L.type==="DoWhileStatement";for(Sr&&Sr.type==="LabeledStatement"&&(Br=Sr.label.name),ke();Kn||st();Ft()){Kn=!1;var yi=ne.setValue(Bt());if(!(yi===Jt||yi===Pe)){if(yi===he)break;if(Hn=yi,Hn instanceof Ts&&Hn.value===Br){Hn=Jt;continue}if(Hn instanceof go||Hn instanceof ws||Hn instanceof Ts)break}}return Hn}},M.whileStatementHandler=function(L){return this.forStatementHandler(L)},M.doWhileStatementHandler=function(L){return this.forStatementHandler(L)},M.forInStatementHandler=function(L){var ne=this,ke=L.left,st=this.createClosure(L.right),Ft=this.createClosure(L.body);return L.left.type==="VariableDeclaration"&&(this.createClosure(L.left)(),ke=L.left.declarations[0].id),function(Bt){var Sr,Br=Jt,Hn;Bt&&Bt.type==="LabeledStatement"&&(Sr=Bt.label.name);var Kn=st();for(Hn in Kn){ne.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ke,right:{type:"Literal",value:Hn}})();var yi=ne.setValue(Ft());if(!(yi===Jt||yi===Pe)){if(yi===he)break;if(Br=yi,Br instanceof Ts&&Br.value===Sr){Br=Jt;continue}if(Br instanceof go||Br instanceof ws||Br instanceof Ts)break}}return Br}},M.withStatementHandler=function(L){var ne=this,ke=this.createClosure(L.object),st=this.createClosure(L.body);return function(){var Ft=ke(),Bt=ne.getCurrentScope(),Sr=new Ms(Ft,Bt,en);ne.setCurrentScope(Sr);var Br=ne.setValue(st());return ne.setCurrentScope(Bt),Br}},M.throwStatementHandler=function(L){var ne=this,ke=this.createClosure(L.argument);return function(){throw ne.setValue(void 0),ke()}},M.tryStatementHandler=function(L){var ne=this,ke=this.createClosure(L.block),st=L.handler?this.catchClauseHandler(L.handler):null,Ft=L.finalizer?this.createClosure(L.finalizer):null;return function(){var Bt=ne.getCurrentScope(),Sr=ne.getCurrentContext(),Br=Bt.labelStack.concat([]),Hn=ne.callStack.concat([]),Kn=Jt,yi,$i,Ea=function(){ne.setCurrentScope(Bt),ne.setCurrentContext(Sr),Bt.labelStack=Br,ne.callStack=Hn};try{Kn=ne.setValue(ke()),Kn instanceof go&&(yi=Kn)}catch(La){if(Ea(),ne.isInterruptThrow(La))throw La;if(st)try{Kn=ne.setValue(st(La)),Kn instanceof go&&(yi=Kn)}catch(qi){if(Ea(),ne.isInterruptThrow(qi))throw qi;$i=qi}}if(Ft)try{Kn=Ft(),Kn instanceof go&&(yi=Kn)}catch(La){if(Ea(),ne.isInterruptThrow(La))throw La;$i=La}if($i)throw $i;return yi||Kn}},M.catchClauseHandler=function(L){var ne=this,ke=this.createParamNameGetter(L.param),st=this.createClosure(L.body);return function(Ft){var Bt,Sr=ne.getCurrentScope(),Br=Sr.data,Hn=ke(),Kn=Jo.call(Br,Hn),yi=Br[Hn];return Br[Hn]=Ft,Bt=st(),Kn?Br[Hn]=yi:delete Br[Hn],Bt}},M.continueStatementHandler=function(L){return function(){return L.label?new Ts(L.label.name):Pe}},M.breakStatementHandler=function(L){return function(){return L.label?new ws(L.label.name):he}},M.switchStatementHandler=function(L){var ne=this,ke=this.createClosure(L.discriminant),st=L.cases.map(function(Ft){return ne.switchCaseHandler(Ft)});return function(){for(var Ft=ke(),Bt=!1,Sr,Br,Hn,Kn=0;Kn<st.length;Kn++){var yi=st[Kn](),$i=yi.testClosure();if($i===dt){Hn=yi;continue}if(Bt||$i===Ft){if(Bt=!0,Br=ne.setValue(yi.bodyClosure()),Br===Jt)continue;if(Br===he||(Sr=Br,Sr instanceof go||Sr instanceof ws||Sr instanceof Ts||Sr===Pe))break}}if(!Bt&&Hn){Br=ne.setValue(Hn.bodyClosure());var Ea=Br===Jt||Br===he||Br===Pe;Ea||(Sr=Br)}return Sr}},M.switchCaseHandler=function(L){var ne=L.test?this.createClosure(L.test):function(){return dt},ke=this.createClosure({type:"BlockStatement",body:L.consequent});return function(){return{testClosure:ne,bodyClosure:ke}}},M.labeledStatementHandler=function(L){var ne=this,ke=L.label.name,st=this.createClosure(L.body);return function(){var Ft,Bt=ne.getCurrentScope();return Bt.labelStack.push(ke),Ft=st(L),Ft instanceof ws&&Ft.value===ke&&(Ft=Jt),Bt.labelStack.pop(),Ft}},M.debuggerStatementHandler=function(L){return function(){debugger;return Jt}},M.createParamNameGetter=function(L){if(L.type==="Identifier")return function(){return L.name};throw this.createInternalThrowError(la.ParamTypeSyntaxError,L.type,L)},M.createObjectKeyGetter=function(L){var ne;return L.type==="Identifier"?ne=function(){return L.name}:ne=this.createClosure(L),function(){return ne()}},M.createMemberKeyGetter=function(L){return L.computed?this.createClosure(L.property):this.createObjectKeyGetter(L.property)},M.createObjectGetter=function(L){var ne=this;switch(L.type){case"Identifier":return function(){return ne.getScopeDataFromName(L.name,ne.getCurrentScope())};case"MemberExpression":return this.createClosure(L.object);default:throw this.createInternalThrowError(la.AssignmentTypeSyntaxError,L.type,L)}},M.createNameGetter=function(L){switch(L.type){case"Identifier":return function(){return L.name};case"MemberExpression":return this.createMemberKeyGetter(L);default:throw this.createInternalThrowError(la.AssignmentTypeSyntaxError,L.type,L)}},M.varDeclaration=function(L){var ne=this.collectDeclVars;ne[L]=void 0},M.funcDeclaration=function(L,ne){var ke=this.collectDeclFuncs;ke[L]=ne},M.addDeclarationsToScope=function(L,ne,ke){var st=ke.data;for(var Ft in ne){var Bt=ne[Ft];st[Ft]=Bt&&Bt()}for(var Sr in L)Sr in st||(st[Sr]=void 0)},M.getScopeValue=function(L,ne){var ke=this.getScopeFromName(L,ne);return ke.data[L]},M.getScopeDataFromName=function(L,ne){return this.getScopeFromName(L,ne).data},M.getScopeFromName=function(L,ne){var ke=ne;do if(L in ke.data)return ke;while(ke=ke.parent);return this.globalScope},M.setValue=function(L){var ne=this.callStack.length;return this.isVarDeclMode||ne||L===Jt||L===he||L===Pe||L instanceof ws||L instanceof Ts||(this.value=L instanceof go?L.value:L),L},M.getValue=function(){return this.value},b}();Ia.version=nu,Ia.eval=es,Ia.Function=Oo,Ia.ecmaVersion=5,Ia.globalContextInFunction=void 0,Ia.global=Object.create(null);function Hc(b){return b===void 0&&(b=Object.create(null)),b}function yf(b,M,Z){M===void 0&&(M=[]),Z===void 0&&(Z={});var L=Z.parsingContext,ne=Z.timeout===void 0?0:Z.timeout,ke=`
    (function anonymous(`+M.join(",")+`){
         `+b+`
    });
    `,st=new Ia(L,{ecmaVersion:Z.ecmaVersion,timeout:ne,rootContext:Z.rootContext,globalContextInFunction:Z.globalContextInFunction});return st.evaluate(ke)}function Is(b,M,Z){var L=new Ia(M,Z);return L.evaluate(b)}var _f=Is,hl=function(){function b(Z){this._code=Z}var M=b.prototype;return M.runInContext=function(L){return Is(this._code,L)},M.runInNewContext=function(L){return Is(this._code,L)},b}(),el=function(b,M,Z){return Is(b,M,Z)};function au(){for(var b=arguments.length,M=new Array(b),Z=0;Z<b;Z++)M[Z]=arguments[Z];var L=M.pop();return yf(L||"",M)}var Ol=el},20396:function(Fr,fe,Q){var Ae;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(re,y,Se,W){"use strict";var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ce=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Xe=ge||ce,me=["","webkit","Moz","MS","ms","o"],qe=Xe?"":y.createElement("div"),lt="function",bt=Math.round,Pt=Math.abs,ur=Date.now;function Nt(he,Pe,dt){return setTimeout(Tt(he,dt),Pe)}function pr(he,Pe,dt){return Array.isArray(he)?(Xt(he,dt[Pe],dt),!0):!1}function Xt(he,Pe,dt){var Jt;if(!!he)if(he.forEach)he.forEach(Pe,dt);else if(he.length!==W)for(Jt=0;Jt<he.length;)Pe.call(dt,he[Jt],Jt,he),Jt++;else for(Jt in he)he.hasOwnProperty(Jt)&&Pe.call(dt,he[Jt],Jt,he)}function It(he,Pe,dt){var Jt="DEPRECATED METHOD: "+Pe+`
`+dt+` AT 
`;return function(){var en=new Error("get-stack-trace"),Gn=en&&en.stack?en.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Bi=re.console&&(re.console.warn||re.console.log);return Bi&&Bi.call(re.console,Jt,Gn),he.apply(this,arguments)}}var kt;typeof Object.assign!="function"?kt=function(Pe){if(Pe===W||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var dt=Object(Pe),Jt=1;Jt<arguments.length;Jt++){var en=arguments[Jt];if(en!==W&&en!==null)for(var Gn in en)en.hasOwnProperty(Gn)&&(dt[Gn]=en[Gn])}return dt}:kt=Object.assign;var _r=It(function(Pe,dt,Jt){for(var en=Object.keys(dt),Gn=0;Gn<en.length;)(!Jt||Jt&&Pe[en[Gn]]===W)&&(Pe[en[Gn]]=dt[en[Gn]]),Gn++;return Pe},"extend","Use `assign`."),J=It(function(Pe,dt){return _r(Pe,dt,!0)},"merge","Use `assign`.");function lr(he,Pe,dt){var Jt=Pe.prototype,en;en=he.prototype=Object.create(Jt),en.constructor=he,en._super=Jt,dt&&kt(en,dt)}function Tt(he,Pe){return function(){return he.apply(Pe,arguments)}}function ht(he,Pe){return typeof he==lt?he.apply(Pe&&Pe[0]||W,Pe):he}function Wt(he,Pe){return he===W?Pe:he}function mt(he,Pe,dt){Xt(Ne(Pe),function(Jt){he.addEventListener(Jt,dt,!1)})}function fr(he,Pe,dt){Xt(Ne(Pe),function(Jt){he.removeEventListener(Jt,dt,!1)})}function Lr(he,Pe){for(;he;){if(he==Pe)return!0;he=he.parentNode}return!1}function te(he,Pe){return he.indexOf(Pe)>-1}function Ne(he){return he.trim().split(/\s+/g)}function N(he,Pe,dt){if(he.indexOf&&!dt)return he.indexOf(Pe);for(var Jt=0;Jt<he.length;){if(dt&&he[Jt][dt]==Pe||!dt&&he[Jt]===Pe)return Jt;Jt++}return-1}function U(he){return Array.prototype.slice.call(he,0)}function le(he,Pe,dt){for(var Jt=[],en=[],Gn=0;Gn<he.length;){var Bi=Pe?he[Gn][Pe]:he[Gn];N(en,Bi)<0&&Jt.push(he[Gn]),en[Gn]=Bi,Gn++}return dt&&(Pe?Jt=Jt.sort(function(za,Ka){return za[Pe]>Ka[Pe]}):Jt=Jt.sort()),Jt}function He(he,Pe){for(var dt,Jt,en=Pe[0].toUpperCase()+Pe.slice(1),Gn=0;Gn<me.length;){if(dt=me[Gn],Jt=dt?dt+en:Pe,Jt in he)return Jt;Gn++}return W}var Je=1;function ft(){return Je++}function Vt(he){var Pe=he.ownerDocument||he;return Pe.defaultView||Pe.parentWindow||re}var nr=/mobile|tablet|ip(ad|hone|od)|android/i,Zr="ontouchstart"in re,Dr=He(re,"PointerEvent")!==W,Xn=Zr&&nr.test(navigator.userAgent),sn="touch",Nn="pen",ra="mouse",xi="kinect",si=25,Ri=1,ki=2,di=4,Yn=8,ri=1,Ao=2,Na=4,ma=8,wt=16,ve=Ao|Na,se=ma|wt,xe=ve|se,z=["x","y"],et=["clientX","clientY"];function Qt(he,Pe){var dt=this;this.manager=he,this.callback=Pe,this.element=he.element,this.target=he.options.inputTarget,this.domHandler=function(Jt){ht(he.options.enable,[he])&&dt.handler(Jt)},this.init()}Qt.prototype={handler:function(){},init:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(Vt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&fr(this.element,this.evEl,this.domHandler),this.evTarget&&fr(this.target,this.evTarget,this.domHandler),this.evWin&&fr(Vt(this.element),this.evWin,this.domHandler)}};function zr(he){var Pe,dt=he.options.inputClass;return dt?Pe=dt:Dr?Pe=ze:Xn?Pe=ar:Zr?Pe=qt:Pe=Ki,new Pe(he,Ke)}function Ke(he,Pe,dt){var Jt=dt.pointers.length,en=dt.changedPointers.length,Gn=Pe&Ri&&Jt-en==0,Bi=Pe&(di|Yn)&&Jt-en==0;dt.isFirst=!!Gn,dt.isFinal=!!Bi,Gn&&(he.session={}),dt.eventType=Pe,Rt(he,dt),he.emit("hammer.input",dt),he.recognize(dt),he.session.prevInput=dt}function Rt(he,Pe){var dt=he.session,Jt=Pe.pointers,en=Jt.length;dt.firstInput||(dt.firstInput=Xr(Pe)),en>1&&!dt.firstMultiple?dt.firstMultiple=Xr(Pe):en===1&&(dt.firstMultiple=!1);var Gn=dt.firstInput,Bi=dt.firstMultiple,fo=Bi?Bi.center:Gn.center,za=Pe.center=rn(Jt);Pe.timeStamp=ur(),Pe.deltaTime=Pe.timeStamp-Gn.timeStamp,Pe.angle=ui(fo,za),Pe.distance=an(fo,za),vr(dt,Pe),Pe.offsetDirection=Zn(Pe.deltaX,Pe.deltaY);var Ka=jn(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=Ka.x,Pe.overallVelocityY=Ka.y,Pe.overallVelocity=Pt(Ka.x)>Pt(Ka.y)?Ka.x:Ka.y,Pe.scale=Bi?Hi(Bi.pointers,Jt):1,Pe.rotation=Bi?fi(Bi.pointers,Jt):0,Pe.maxPointers=dt.prevInput?Pe.pointers.length>dt.prevInput.maxPointers?Pe.pointers.length:dt.prevInput.maxPointers:Pe.pointers.length,Pr(dt,Pe);var es=he.element;Lr(Pe.srcEvent.target,es)&&(es=Pe.srcEvent.target),Pe.target=es}function vr(he,Pe){var dt=Pe.center,Jt=he.offsetDelta||{},en=he.prevDelta||{},Gn=he.prevInput||{};(Pe.eventType===Ri||Gn.eventType===di)&&(en=he.prevDelta={x:Gn.deltaX||0,y:Gn.deltaY||0},Jt=he.offsetDelta={x:dt.x,y:dt.y}),Pe.deltaX=en.x+(dt.x-Jt.x),Pe.deltaY=en.y+(dt.y-Jt.y)}function Pr(he,Pe){var dt=he.lastInterval||Pe,Jt=Pe.timeStamp-dt.timeStamp,en,Gn,Bi,fo;if(Pe.eventType!=Yn&&(Jt>si||dt.velocity===W)){var za=Pe.deltaX-dt.deltaX,Ka=Pe.deltaY-dt.deltaY,es=jn(Jt,za,Ka);Gn=es.x,Bi=es.y,en=Pt(es.x)>Pt(es.y)?es.x:es.y,fo=Zn(za,Ka),he.lastInterval=Pe}else en=dt.velocity,Gn=dt.velocityX,Bi=dt.velocityY,fo=dt.direction;Pe.velocity=en,Pe.velocityX=Gn,Pe.velocityY=Bi,Pe.direction=fo}function Xr(he){for(var Pe=[],dt=0;dt<he.pointers.length;)Pe[dt]={clientX:bt(he.pointers[dt].clientX),clientY:bt(he.pointers[dt].clientY)},dt++;return{timeStamp:ur(),pointers:Pe,center:rn(Pe),deltaX:he.deltaX,deltaY:he.deltaY}}function rn(he){var Pe=he.length;if(Pe===1)return{x:bt(he[0].clientX),y:bt(he[0].clientY)};for(var dt=0,Jt=0,en=0;en<Pe;)dt+=he[en].clientX,Jt+=he[en].clientY,en++;return{x:bt(dt/Pe),y:bt(Jt/Pe)}}function jn(he,Pe,dt){return{x:Pe/he||0,y:dt/he||0}}function Zn(he,Pe){return he===Pe?ri:Pt(he)>=Pt(Pe)?he<0?Ao:Na:Pe<0?ma:wt}function an(he,Pe,dt){dt||(dt=z);var Jt=Pe[dt[0]]-he[dt[0]],en=Pe[dt[1]]-he[dt[1]];return Math.sqrt(Jt*Jt+en*en)}function ui(he,Pe,dt){dt||(dt=z);var Jt=Pe[dt[0]]-he[dt[0]],en=Pe[dt[1]]-he[dt[1]];return Math.atan2(en,Jt)*180/Math.PI}function fi(he,Pe){return ui(Pe[1],Pe[0],et)+ui(he[1],he[0],et)}function Hi(he,Pe){return an(Pe[0],Pe[1],et)/an(he[0],he[1],et)}var Aa={mousedown:Ri,mousemove:ki,mouseup:di},Pa="mousedown",ba="mousemove mouseup";function Ki(){this.evEl=Pa,this.evWin=ba,this.pressed=!1,Qt.apply(this,arguments)}lr(Ki,Qt,{handler:function(Pe){var dt=Aa[Pe.type];dt&Ri&&Pe.button===0&&(this.pressed=!0),dt&ki&&Pe.which!==1&&(dt=di),!!this.pressed&&(dt&di&&(this.pressed=!1),this.callback(this.manager,dt,{pointers:[Pe],changedPointers:[Pe],pointerType:ra,srcEvent:Pe}))}});var q={pointerdown:Ri,pointermove:ki,pointerup:di,pointercancel:Yn,pointerout:Yn},ie={2:sn,3:Nn,4:ra,5:xi},pe="pointerdown",we="pointermove pointerup pointercancel";!Xe&&re.MSPointerEvent&&!re.PointerEvent&&(pe="MSPointerDown",we="MSPointerMove MSPointerUp MSPointerCancel");function ze(){this.evEl=pe,this.evWin=we,Qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}lr(ze,Qt,{handler:function(Pe){var dt=this.store,Jt=!1,en=Pe.type.toLowerCase().replace("ms",""),Gn=q[en],Bi=ie[Pe.pointerType]||Pe.pointerType,fo=Bi==sn,za=N(dt,Pe.pointerId,"pointerId");Gn&Ri&&(Pe.button===0||fo)?za<0&&(dt.push(Pe),za=dt.length-1):Gn&(di|Yn)&&(Jt=!0),!(za<0)&&(dt[za]=Pe,this.callback(this.manager,Gn,{pointers:dt,changedPointers:[Pe],pointerType:Bi,srcEvent:Pe}),Jt&&dt.splice(za,1))}});var rt={touchstart:Ri,touchmove:ki,touchend:di,touchcancel:Yn},_t="touchstart",be="touchstart touchmove touchend touchcancel";function We(){this.evTarget=_t,this.evWin=be,this.started=!1,Qt.apply(this,arguments)}lr(We,Qt,{handler:function(Pe){var dt=rt[Pe.type];if(dt===Ri&&(this.started=!0),!!this.started){var Jt=zt.call(this,Pe,dt);dt&(di|Yn)&&Jt[0].length-Jt[1].length==0&&(this.started=!1),this.callback(this.manager,dt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:sn,srcEvent:Pe})}}});function zt(he,Pe){var dt=U(he.touches),Jt=U(he.changedTouches);return Pe&(di|Yn)&&(dt=le(dt.concat(Jt),"identifier",!0)),[dt,Jt]}var Rr={touchstart:Ri,touchmove:ki,touchend:di,touchcancel:Yn},er="touchstart touchmove touchend touchcancel";function ar(){this.evTarget=er,this.targetIds={},Qt.apply(this,arguments)}lr(ar,Qt,{handler:function(Pe){var dt=Rr[Pe.type],Jt=Or.call(this,Pe,dt);!Jt||this.callback(this.manager,dt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:sn,srcEvent:Pe})}});function Or(he,Pe){var dt=U(he.touches),Jt=this.targetIds;if(Pe&(Ri|ki)&&dt.length===1)return Jt[dt[0].identifier]=!0,[dt,dt];var en,Gn,Bi=U(he.changedTouches),fo=[],za=this.target;if(Gn=dt.filter(function(Ka){return Lr(Ka.target,za)}),Pe===Ri)for(en=0;en<Gn.length;)Jt[Gn[en].identifier]=!0,en++;for(en=0;en<Bi.length;)Jt[Bi[en].identifier]&&fo.push(Bi[en]),Pe&(di|Yn)&&delete Jt[Bi[en].identifier],en++;if(!!fo.length)return[le(Gn.concat(fo),"identifier",!0),fo]}var Dn=2500,In=25;function qt(){Qt.apply(this,arguments);var he=Tt(this.handler,this);this.touch=new ar(this.manager,he),this.mouse=new Ki(this.manager,he),this.primaryTouch=null,this.lastTouches=[]}lr(qt,Qt,{handler:function(Pe,dt,Jt){var en=Jt.pointerType==sn,Gn=Jt.pointerType==ra;if(!(Gn&&Jt.sourceCapabilities&&Jt.sourceCapabilities.firesTouchEvents)){if(en)Cn.call(this,dt,Jt);else if(Gn&&pt.call(this,Jt))return;this.callback(Pe,dt,Jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Cn(he,Pe){he&Ri?(this.primaryTouch=Pe.changedPointers[0].identifier,mr.call(this,Pe)):he&(di|Yn)&&mr.call(this,Pe)}function mr(he){var Pe=he.changedPointers[0];if(Pe.identifier===this.primaryTouch){var dt={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(dt);var Jt=this.lastTouches,en=function(){var Gn=Jt.indexOf(dt);Gn>-1&&Jt.splice(Gn,1)};setTimeout(en,Dn)}}function pt(he){for(var Pe=he.srcEvent.clientX,dt=he.srcEvent.clientY,Jt=0;Jt<this.lastTouches.length;Jt++){var en=this.lastTouches[Jt],Gn=Math.abs(Pe-en.x),Bi=Math.abs(dt-en.y);if(Gn<=In&&Bi<=In)return!0}return!1}var Ei=Xe?W:He(qe.style,"touchAction"),gn=Ei!==W,Pi="compute",na="auto",vt="manipulation",xt="none",Ii="pan-x",hi="pan-y",Qi=Fi();function Ji(he,Pe){this.manager=he,this.set(Pe)}Ji.prototype={set:function(he){he==Pi&&(he=this.compute()),gn&&this.manager.element.style&&Qi[he]&&(this.manager.element.style[Ei]=he),this.actions=he.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var he=[];return Xt(this.manager.recognizers,function(Pe){ht(Pe.options.enable,[Pe])&&(he=he.concat(Pe.getTouchAction()))}),ia(he.join(" "))},preventDefaults:function(he){var Pe=he.srcEvent,dt=he.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var Jt=this.actions,en=te(Jt,xt)&&!Qi[xt],Gn=te(Jt,hi)&&!Qi[hi],Bi=te(Jt,Ii)&&!Qi[Ii];if(en){var fo=he.pointers.length===1,za=he.distance<2,Ka=he.deltaTime<250;if(fo&&za&&Ka)return}if(!(Bi&&Gn)&&(en||Gn&&dt&ve||Bi&&dt&se))return this.preventSrc(Pe)},preventSrc:function(he){this.manager.session.prevented=!0,he.preventDefault()}};function ia(he){if(te(he,xt))return xt;var Pe=te(he,Ii),dt=te(he,hi);return Pe&&dt?xt:Pe||dt?Pe?Ii:hi:te(he,vt)?vt:na}function Fi(){if(!gn)return!1;var he={};if(Xe)return he;var Pe=re.CSS&&re.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(dt){he[dt]=Pe?re.CSS.supports("touch-action",dt):!0}),he}var sr=1,xr=2,je=4,wa=8,Le=wa,As=16,us=32;function ta(he){this.options=kt({},this.defaults,he||{}),this.id=ft(),this.manager=null,this.options.enable=Wt(this.options.enable,!0),this.state=sr,this.simultaneous={},this.requireFail=[]}ta.prototype={defaults:{},set:function(he){return kt(this.options,he),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(he){if(pr(he,"recognizeWith",this))return this;var Pe=this.simultaneous;return he=Wa(he,this),Pe[he.id]||(Pe[he.id]=he,he.recognizeWith(this)),this},dropRecognizeWith:function(he){return pr(he,"dropRecognizeWith",this)?this:(he=Wa(he,this),delete this.simultaneous[he.id],this)},requireFailure:function(he){if(pr(he,"requireFailure",this))return this;var Pe=this.requireFail;return he=Wa(he,this),N(Pe,he)===-1&&(Pe.push(he),he.requireFailure(this)),this},dropRequireFailure:function(he){if(pr(he,"dropRequireFailure",this))return this;he=Wa(he,this);var Pe=N(this.requireFail,he);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(he){return!!this.simultaneous[he.id]},emit:function(he){var Pe=this,dt=this.state;function Jt(en){Pe.manager.emit(en,he)}dt<wa&&Jt(Pe.options.event+Ys(dt)),Jt(Pe.options.event),he.additionalEvent&&Jt(he.additionalEvent),dt>=wa&&Jt(Pe.options.event+Ys(dt))},tryEmit:function(he){if(this.canEmit())return this.emit(he);this.state=us},canEmit:function(){for(var he=0;he<this.requireFail.length;){if(!(this.requireFail[he].state&(us|sr)))return!1;he++}return!0},recognize:function(he){var Pe=kt({},he);if(!ht(this.options.enable,[this,Pe])){this.reset(),this.state=us;return}this.state&(Le|As|us)&&(this.state=sr),this.state=this.process(Pe),this.state&(xr|je|wa|As)&&this.tryEmit(Pe)},process:function(he){},getTouchAction:function(){},reset:function(){}};function Ys(he){return he&As?"cancel":he&wa?"end":he&je?"move":he&xr?"start":""}function no(he){return he==wt?"down":he==ma?"up":he==Ao?"left":he==Na?"right":""}function Wa(he,Pe){var dt=Pe.manager;return dt?dt.get(he):he}function io(){ta.apply(this,arguments)}lr(io,ta,{defaults:{pointers:1},attrTest:function(he){var Pe=this.options.pointers;return Pe===0||he.pointers.length===Pe},process:function(he){var Pe=this.state,dt=he.eventType,Jt=Pe&(xr|je),en=this.attrTest(he);return Jt&&(dt&Yn||!en)?Pe|As:Jt||en?dt&di?Pe|wa:Pe&xr?Pe|je:xr:us}});function aa(){io.apply(this,arguments),this.pX=null,this.pY=null}lr(aa,io,{defaults:{event:"pan",threshold:10,pointers:1,direction:xe},getTouchAction:function(){var he=this.options.direction,Pe=[];return he&ve&&Pe.push(hi),he&se&&Pe.push(Ii),Pe},directionTest:function(he){var Pe=this.options,dt=!0,Jt=he.distance,en=he.direction,Gn=he.deltaX,Bi=he.deltaY;return en&Pe.direction||(Pe.direction&ve?(en=Gn===0?ri:Gn<0?Ao:Na,dt=Gn!=this.pX,Jt=Math.abs(he.deltaX)):(en=Bi===0?ri:Bi<0?ma:wt,dt=Bi!=this.pY,Jt=Math.abs(he.deltaY))),he.direction=en,dt&&Jt>Pe.threshold&&en&Pe.direction},attrTest:function(he){return io.prototype.attrTest.call(this,he)&&(this.state&xr||!(this.state&xr)&&this.directionTest(he))},emit:function(he){this.pX=he.deltaX,this.pY=he.deltaY;var Pe=no(he.direction);Pe&&(he.additionalEvent=this.options.event+Pe),this._super.emit.call(this,he)}});function jo(){io.apply(this,arguments)}lr(jo,io,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.scale-1)>this.options.threshold||this.state&xr)},emit:function(he){if(he.scale!==1){var Pe=he.scale<1?"in":"out";he.additionalEvent=this.options.event+Pe}this._super.emit.call(this,he)}});function Qo(){ta.apply(this,arguments),this._timer=null,this._input=null}lr(Qo,ta,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[na]},process:function(he){var Pe=this.options,dt=he.pointers.length===Pe.pointers,Jt=he.distance<Pe.threshold,en=he.deltaTime>Pe.time;if(this._input=he,!Jt||!dt||he.eventType&(di|Yn)&&!en)this.reset();else if(he.eventType&Ri)this.reset(),this._timer=Nt(function(){this.state=Le,this.tryEmit()},Pe.time,this);else if(he.eventType&di)return Le;return us},reset:function(){clearTimeout(this._timer)},emit:function(he){this.state===Le&&(he&&he.eventType&di?this.manager.emit(this.options.event+"up",he):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function Au(){io.apply(this,arguments)}lr(Au,io,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.rotation)>this.options.threshold||this.state&xr)}});function wo(){io.apply(this,arguments)}lr(wo,io,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ve|se,pointers:1},getTouchAction:function(){return aa.prototype.getTouchAction.call(this)},attrTest:function(he){var Pe=this.options.direction,dt;return Pe&(ve|se)?dt=he.overallVelocity:Pe&ve?dt=he.overallVelocityX:Pe&se&&(dt=he.overallVelocityY),this._super.attrTest.call(this,he)&&Pe&he.offsetDirection&&he.distance>this.options.threshold&&he.maxPointers==this.options.pointers&&Pt(dt)>this.options.velocity&&he.eventType&di},emit:function(he){var Pe=no(he.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,he),this.manager.emit(this.options.event,he)}});function To(){ta.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}lr(To,ta,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vt]},process:function(he){var Pe=this.options,dt=he.pointers.length===Pe.pointers,Jt=he.distance<Pe.threshold,en=he.deltaTime<Pe.time;if(this.reset(),he.eventType&Ri&&this.count===0)return this.failTimeout();if(Jt&&en&&dt){if(he.eventType!=di)return this.failTimeout();var Gn=this.pTime?he.timeStamp-this.pTime<Pe.interval:!0,Bi=!this.pCenter||an(this.pCenter,he.center)<Pe.posThreshold;this.pTime=he.timeStamp,this.pCenter=he.center,!Bi||!Gn?this.count=1:this.count+=1,this._input=he;var fo=this.count%Pe.taps;if(fo===0)return this.hasRequireFailures()?(this._timer=Nt(function(){this.state=Le,this.tryEmit()},Pe.interval,this),xr):Le}return us},failTimeout:function(){return this._timer=Nt(function(){this.state=us},this.options.interval,this),us},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Le&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function la(he,Pe){return Pe=Pe||{},Pe.recognizers=Wt(Pe.recognizers,la.defaults.preset),new qa(he,Pe)}la.VERSION="2.0.7",la.defaults={domEvents:!1,touchAction:Pi,enable:!0,inputTarget:null,inputClass:null,preset:[[Au,{enable:!1}],[jo,{enable:!1},["rotate"]],[wo,{direction:ve}],[aa,{direction:ve},["swipe"]],[To],[To,{event:"doubletap",taps:2},["tap"]],[Qo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ao=1,Go=2;function qa(he,Pe){this.options=kt({},la.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||he,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=he,this.input=zr(this),this.touchAction=new Ji(this,this.options.touchAction),nu(this,!0),Xt(this.options.recognizers,function(dt){var Jt=this.add(new dt[0](dt[1]));dt[2]&&Jt.recognizeWith(dt[2]),dt[3]&&Jt.requireFailure(dt[3])},this)}qa.prototype={set:function(he){return kt(this.options,he),he.touchAction&&this.touchAction.update(),he.inputTarget&&(this.input.destroy(),this.input.target=he.inputTarget,this.input.init()),this},stop:function(he){this.session.stopped=he?Go:ao},recognize:function(he){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(he);var dt,Jt=this.recognizers,en=Pe.curRecognizer;(!en||en&&en.state&Le)&&(en=Pe.curRecognizer=null);for(var Gn=0;Gn<Jt.length;)dt=Jt[Gn],Pe.stopped!==Go&&(!en||dt==en||dt.canRecognizeWith(en))?dt.recognize(he):dt.reset(),!en&&dt.state&(xr|je|wa)&&(en=Pe.curRecognizer=dt),Gn++}},get:function(he){if(he instanceof ta)return he;for(var Pe=this.recognizers,dt=0;dt<Pe.length;dt++)if(Pe[dt].options.event==he)return Pe[dt];return null},add:function(he){if(pr(he,"add",this))return this;var Pe=this.get(he.options.event);return Pe&&this.remove(Pe),this.recognizers.push(he),he.manager=this,this.touchAction.update(),he},remove:function(he){if(pr(he,"remove",this))return this;if(he=this.get(he),he){var Pe=this.recognizers,dt=N(Pe,he);dt!==-1&&(Pe.splice(dt,1),this.touchAction.update())}return this},on:function(he,Pe){if(he!==W&&Pe!==W){var dt=this.handlers;return Xt(Ne(he),function(Jt){dt[Jt]=dt[Jt]||[],dt[Jt].push(Pe)}),this}},off:function(he,Pe){if(he!==W){var dt=this.handlers;return Xt(Ne(he),function(Jt){Pe?dt[Jt]&&dt[Jt].splice(N(dt[Jt],Pe),1):delete dt[Jt]}),this}},emit:function(he,Pe){this.options.domEvents&&Rl(he,Pe);var dt=this.handlers[he]&&this.handlers[he].slice();if(!(!dt||!dt.length)){Pe.type=he,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var Jt=0;Jt<dt.length;)dt[Jt](Pe),Jt++}},destroy:function(){this.element&&nu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function nu(he,Pe){var dt=he.element;if(!!dt.style){var Jt;Xt(he.options.cssProps,function(en,Gn){Jt=He(dt.style,Gn),Pe?(he.oldCssProps[Jt]=dt.style[Jt],dt.style[Jt]=en):dt.style[Jt]=he.oldCssProps[Jt]||""}),Pe||(he.oldCssProps={})}}function Rl(he,Pe){if(!Xe){var dt=y.createEvent("Event");dt.initEvent(he,!0,!0),dt.gesture=Pe,Pe.target.dispatchEvent(dt)}}if(!Xe){kt(la,{INPUT_START:Ri,INPUT_MOVE:ki,INPUT_END:di,INPUT_CANCEL:Yn,STATE_POSSIBLE:sr,STATE_BEGAN:xr,STATE_CHANGED:je,STATE_ENDED:wa,STATE_RECOGNIZED:Le,STATE_CANCELLED:As,STATE_FAILED:us,DIRECTION_NONE:ri,DIRECTION_LEFT:Ao,DIRECTION_RIGHT:Na,DIRECTION_UP:ma,DIRECTION_DOWN:wt,DIRECTION_HORIZONTAL:ve,DIRECTION_VERTICAL:se,DIRECTION_ALL:xe,Manager:qa,Input:Qt,TouchAction:Ji,TouchInput:ar,MouseInput:Ki,PointerEventInput:ze,TouchMouseInput:qt,SingleTouchInput:We,Recognizer:ta,AttrRecognizer:io,Tap:To,Pan:aa,Swipe:wo,Pinch:jo,Rotate:Au,Press:Qo,on:mt,off:fr,each:Xt,merge:J,extend:_r,assign:kt,inherit:lr,bindFn:Tt,prefixed:He});var Jo=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Jo.Hammer=la,Ae=function(){return la}.call(fe,Q,fe,Fr),Ae!==W&&(Fr.exports=Ae)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Fr,fe,Q){(function(Ae,re){Fr.exports=re(Q(18857))})(this,function(Ae){"use strict";var re=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},y=function(V,Te){for(var $e=Object.keys(Te),tr=0;tr<$e.length;++tr)V[$e[tr]]=Te[$e[tr]];return V},Se=`
`;function W(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function ge(V){var Te=new Error("(regl) "+V);throw console.error(Te),Te}function ce(V,Te){V||ge(Te)}function Xe(V){return V?": "+V:""}function me(V,Te,$e){V in Te||ge("unknown parameter ("+V+")"+Xe($e)+". possible values: "+Object.keys(Te).join())}function qe(V,Te){re(V)||ge("invalid parameter type"+Xe(Te)+". must be a typed array")}function lt(V,Te){switch(Te){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function bt(V,Te,$e){lt(V,Te)||ge("invalid parameter type"+Xe($e)+". expected "+Te+", got "+typeof V)}function Pt(V,Te){V>=0&&(V|0)===V||ge("invalid parameter type, ("+V+")"+Xe(Te)+". must be a nonnegative integer")}function ur(V,Te,$e){Te.indexOf(V)<0&&ge("invalid value"+Xe($e)+". must be one of: "+Te)}var Nt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function pr(V){Object.keys(V).forEach(function(Te){Nt.indexOf(Te)<0&&ge('invalid regl constructor argument "'+Te+'". must be one of '+Nt)})}function Xt(V,Te){for(V=V+"";V.length<Te;)V=" "+V;return V}function It(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function kt(V,Te){this.number=V,this.line=Te,this.errors=[]}function _r(V,Te,$e){this.file=V,this.line=Te,this.message=$e}function J(){var V=new Error,Te=(V.stack||V).toString(),$e=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Te);if($e)return $e[1];var tr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Te);return tr?tr[1]:"unknown"}function lr(){var V=new Error,Te=(V.stack||V).toString(),$e=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Te);if($e)return $e[1];var tr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Te);return tr?tr[1]:"unknown"}function Tt(V,Te){var $e=V.split(`
`),tr=1,wr=0,rr={unknown:new It,0:new It};rr.unknown.name=rr[0].name=Te||J(),rr.unknown.lines.push(new kt(0,""));for(var br=0;br<$e.length;++br){var Mr=$e[br],Nr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Mr);if(Nr)switch(Nr[1]){case"line":var jr=/(\d+)(\s+\d+)?/.exec(Nr[2]);jr&&(tr=jr[1]|0,jr[2]&&(wr=jr[2]|0,wr in rr||(rr[wr]=new It)));break;case"define":var qr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Nr[2]);qr&&(rr[wr].name=qr[1]?W(qr[2]):qr[2]);break}rr[wr].lines.push(new kt(tr++,Mr))}return Object.keys(rr).forEach(function(Kr){var cn=rr[Kr];cn.lines.forEach(function(Ur){cn.index[Ur.number]=Ur})}),rr}function ht(V){var Te=[];return V.split(`
`).forEach(function($e){if(!($e.length<5)){var tr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec($e);tr?Te.push(new _r(tr[1]|0,tr[2]|0,tr[3].trim())):$e.length>0&&Te.push(new _r("unknown",0,$e))}}),Te}function Wt(V,Te){Te.forEach(function($e){var tr=V[$e.file];if(tr){var wr=tr.index[$e.line];if(wr){wr.errors.push($e),tr.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push($e)})}function mt(V,Te,$e,tr,wr){if(!V.getShaderParameter(Te,V.COMPILE_STATUS)){var rr=V.getShaderInfoLog(Te),br=tr===V.FRAGMENT_SHADER?"fragment":"vertex";le($e,"string",br+" shader source must be a string",wr);var Mr=Tt($e,wr),Nr=ht(rr);Wt(Mr,Nr),Object.keys(Mr).forEach(function(jr){var qr=Mr[jr];if(!qr.hasErrors)return;var Kr=[""],cn=[""];function Ur(Yr,Lt){Kr.push(Yr),cn.push(Lt||"")}Ur("file number "+jr+": "+qr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),qr.lines.forEach(function(Yr){if(Yr.errors.length>0){Ur(Xt(Yr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ur(Yr.line+Se,"color:red; background-color:yellow; font-weight:bold");var Lt=0;Yr.errors.forEach(function(cr){var Gr=cr.message,un=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Gr);if(un){var Tr=un[1];switch(Gr=un[2],Tr){case"assign":Tr="=";break}Lt=Math.max(Yr.line.indexOf(Tr,Lt),0)}else Lt=0;Ur(Xt("| ",6)),Ur(Xt("^^^",Lt+3)+Se,"font-weight:bold"),Ur(Xt("| ",6)),Ur(Gr+Se,"font-weight:bold")}),Ur(Xt("| ",6)+Se)}else Ur(Xt(Yr.number,4)+"|  "),Ur(Yr.line+Se,"color:red")}),typeof document!="undefined"&&!window.chrome?(cn[0]=Kr.join("%c"),console.log.apply(console,cn)):console.log(Kr.join(""))}),ce.raise("Error compiling "+br+" shader, "+Mr[0].name)}}function fr(V,Te,$e,tr,wr){if(!V.getProgramParameter(Te,V.LINK_STATUS)){var rr=V.getProgramInfoLog(Te),br=Tt($e,wr),Mr=Tt(tr,wr),Nr='Error linking program with vertex shader, "'+Mr[0].name+'", and fragment shader "'+br[0].name+'"';typeof document!="undefined"?console.log("%c"+Nr+Se+"%c"+rr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Nr+Se+rr),ce.raise(Nr)}}function Lr(V){V._commandRef=J()}function te(V,Te,$e,tr){Lr(V);function wr(Nr){return Nr?tr.id(Nr):0}V._fragId=wr(V.static.frag),V._vertId=wr(V.static.vert);function rr(Nr,jr){Object.keys(jr).forEach(function(qr){Nr[tr.id(qr)]=!0})}var br=V._uniformSet={};rr(br,Te.static),rr(br,Te.dynamic);var Mr=V._attributeSet={};rr(Mr,$e.static),rr(Mr,$e.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function Ne(V,Te){var $e=lr();ge(V+" in command "+(Te||J())+($e==="unknown"?"":" called from "+$e))}function N(V,Te,$e){V||Ne(Te,$e||J())}function U(V,Te,$e,tr){V in Te||Ne("unknown parameter ("+V+")"+Xe($e)+". possible values: "+Object.keys(Te).join(),tr||J())}function le(V,Te,$e,tr){lt(V,Te)||Ne("invalid parameter type"+Xe($e)+". expected "+Te+", got "+typeof V,tr||J())}function He(V){V()}function Je(V,Te,$e){V.texture?ur(V.texture._texture.internalformat,Te,"unsupported texture format for attachment"):ur(V.renderbuffer._renderbuffer.format,$e,"unsupported renderbuffer format for attachment")}var ft=33071,Vt=9728,nr=9984,Zr=9985,Dr=9986,Xn=9987,sn=5120,Nn=5121,ra=5122,xi=5123,si=5124,Ri=5125,ki=5126,di=32819,Yn=32820,ri=33635,Ao=34042,Na=36193,ma={};ma[sn]=ma[Nn]=1,ma[ra]=ma[xi]=ma[Na]=ma[ri]=ma[di]=ma[Yn]=2,ma[si]=ma[Ri]=ma[ki]=ma[Ao]=4;function wt(V,Te){return V===Yn||V===di||V===ri?2:V===Ao?4:ma[V]*Te}function ve(V){return!(V&V-1)&&!!V}function se(V,Te,$e){var tr,wr=Te.width,rr=Te.height,br=Te.channels;ce(wr>0&&wr<=$e.maxTextureSize&&rr>0&&rr<=$e.maxTextureSize,"invalid texture shape"),(V.wrapS!==ft||V.wrapT!==ft)&&ce(ve(wr)&&ve(rr),"incompatible wrap mode for texture, both width and height must be power of 2"),Te.mipmask===1?wr!==1&&rr!==1&&ce(V.minFilter!==nr&&V.minFilter!==Dr&&V.minFilter!==Zr&&V.minFilter!==Xn,"min filter requires mipmap"):(ce(ve(wr)&&ve(rr),"texture must be a square power of 2 to support mipmapping"),ce(Te.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),Te.type===ki&&($e.extensions.indexOf("oes_texture_float_linear")<0&&ce(V.minFilter===Vt&&V.magFilter===Vt,"filter not supported, must enable oes_texture_float_linear"),ce(!V.genMipmaps,"mipmap generation not supported with float textures"));var Mr=Te.images;for(tr=0;tr<16;++tr)if(Mr[tr]){var Nr=wr>>tr,jr=rr>>tr;ce(Te.mipmask&1<<tr,"missing mipmap data");var qr=Mr[tr];if(ce(qr.width===Nr&&qr.height===jr,"invalid shape for mip images"),ce(qr.format===Te.format&&qr.internalformat===Te.internalformat&&qr.type===Te.type,"incompatible type for mip image"),!qr.compressed)if(qr.data){var Kr=Math.ceil(wt(qr.type,br)*Nr/qr.unpackAlignment)*qr.unpackAlignment;ce(qr.data.byteLength===Kr*jr,"invalid data for image, buffer size is inconsistent with image format")}else qr.element||qr.copy}else V.genMipmaps||ce((Te.mipmask&1<<tr)==0,"extra mipmap data");Te.compressed&&ce(!V.genMipmaps,"mipmap generation for compressed images not supported")}function xe(V,Te,$e,tr){var wr=V.width,rr=V.height,br=V.channels;ce(wr>0&&wr<=tr.maxTextureSize&&rr>0&&rr<=tr.maxTextureSize,"invalid texture shape"),ce(wr===rr,"cube map must be square"),ce(Te.wrapS===ft&&Te.wrapT===ft,"wrap mode not supported by cube map");for(var Mr=0;Mr<$e.length;++Mr){var Nr=$e[Mr];ce(Nr.width===wr&&Nr.height===rr,"inconsistent cube map face shape"),Te.genMipmaps&&(ce(!Nr.compressed,"can not generate mipmap for compressed textures"),ce(Nr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var jr=Nr.images,qr=0;qr<16;++qr){var Kr=jr[qr];if(Kr){var cn=wr>>qr,Ur=rr>>qr;ce(Nr.mipmask&1<<qr,"missing mipmap data"),ce(Kr.width===cn&&Kr.height===Ur,"invalid shape for mip images"),ce(Kr.format===V.format&&Kr.internalformat===V.internalformat&&Kr.type===V.type,"incompatible type for mip image"),Kr.compressed||(Kr.data?ce(Kr.data.byteLength===cn*Ur*Math.max(wt(Kr.type,br),Kr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Kr.element||Kr.copy)}}}}var z=y(ce,{optional:He,raise:ge,commandRaise:Ne,command:N,parameter:me,commandParameter:U,constructor:pr,type:bt,commandType:le,isTypedArray:qe,nni:Pt,oneOf:ur,shaderError:mt,linkError:fr,callSite:lr,saveCommandRef:Lr,saveDrawInfo:te,framebufferFormat:Je,guessCommand:J,texture2D:se,textureCube:xe}),et=0,Qt=0,zr=5,Ke=6;function Rt(V,Te){this.id=et++,this.type=V,this.data=Te}function vr(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Pr(V){if(V.length===0)return[];var Te=V.charAt(0),$e=V.charAt(V.length-1);if(V.length>1&&Te===$e&&(Te==='"'||Te==="'"))return['"'+vr(V.substr(1,V.length-2))+'"'];var tr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(tr)return Pr(V.substr(0,tr.index)).concat(Pr(tr[1])).concat(Pr(V.substr(tr.index+tr[0].length)));var wr=V.split(".");if(wr.length===1)return['"'+vr(V)+'"'];for(var rr=[],br=0;br<wr.length;++br)rr=rr.concat(Pr(wr[br]));return rr}function Xr(V){return"["+Pr(V).join("][")+"]"}function rn(V,Te){return new Rt(V,Xr(Te+""))}function jn(V){return typeof V=="function"&&!V._reglType||V instanceof Rt}function Zn(V,Te){if(typeof V=="function")return new Rt(Qt,V);if(typeof V=="number"||typeof V=="boolean")return new Rt(zr,V);if(Array.isArray(V))return new Rt(Ke,V.map(function($e,tr){return Zn($e,Te+"["+tr+"]")}));if(V instanceof Rt)return V;z(!1,"invalid option type in uniform "+Te)}var an={DynamicVariable:Rt,define:rn,isDynamic:jn,unbox:Zn,accessor:Xr},ui={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},fi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Hi=fi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Aa(){var V={"":0},Te=[""];return{id:function($e){var tr=V[$e];return tr||(tr=V[$e]=Te.length,Te.push($e),tr)},str:function($e){return Te[$e]}}}function Pa(V,Te,$e){var tr=document.createElement("canvas");y(tr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),V.appendChild(tr),V===document.body&&(tr.style.position="absolute",y(V.style,{margin:0,padding:0}));function wr(){var Mr=window.innerWidth,Nr=window.innerHeight;if(V!==document.body){var jr=tr.getBoundingClientRect();Mr=jr.right-jr.left,Nr=jr.bottom-jr.top}tr.width=$e*Mr,tr.height=$e*Nr}var rr;V!==document.body&&typeof ResizeObserver=="function"?(rr=new ResizeObserver(function(){setTimeout(wr)}),rr.observe(V)):window.addEventListener("resize",wr,!1);function br(){rr?rr.disconnect():window.removeEventListener("resize",wr),V.removeChild(tr)}return wr(),{canvas:tr,onDestroy:br}}function ba(V,Te){function $e(tr){try{return V.getContext(tr,Te)}catch(wr){return null}}return $e("webgl")||$e("experimental-webgl")||$e("webgl-experimental")}function Ki(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function q(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function ie(V){return typeof V=="string"?V.split():(z(Array.isArray(V),"invalid extension array"),V)}function pe(V){return typeof V=="string"?(z(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function we(V){var Te=V||{},$e,tr,wr,rr,br={},Mr=[],Nr=[],jr=typeof window=="undefined"?1:window.devicePixelRatio,qr=!1,Kr=function(Yr){Yr&&z.raise(Yr)},cn=function(){};if(typeof Te=="string"?(z(typeof document!="undefined","selector queries only supported in DOM environments"),$e=document.querySelector(Te),z($e,"invalid query string for element")):typeof Te=="object"?Ki(Te)?$e=Te:q(Te)?(rr=Te,wr=rr.canvas):(z.constructor(Te),"gl"in Te?rr=Te.gl:"canvas"in Te?wr=pe(Te.canvas):"container"in Te&&(tr=pe(Te.container)),"attributes"in Te&&(br=Te.attributes,z.type(br,"object","invalid context attributes")),"extensions"in Te&&(Mr=ie(Te.extensions)),"optionalExtensions"in Te&&(Nr=ie(Te.optionalExtensions)),"onDone"in Te&&(z.type(Te.onDone,"function","invalid or missing onDone callback"),Kr=Te.onDone),"profile"in Te&&(qr=!!Te.profile),"pixelRatio"in Te&&(jr=+Te.pixelRatio,z(jr>0,"invalid pixel ratio"))):z.raise("invalid arguments to regl"),$e&&($e.nodeName.toLowerCase()==="canvas"?wr=$e:tr=$e),!rr){if(!wr){z(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Ur=Pa(tr||document.body,Kr,jr);if(!Ur)return null;wr=Ur.canvas,cn=Ur.onDestroy}br.premultipliedAlpha===void 0&&(br.premultipliedAlpha=!0),rr=ba(wr,br)}return rr?{gl:rr,canvas:wr,container:tr,extensions:Mr,optionalExtensions:Nr,pixelRatio:jr,profile:qr,onDone:Kr,onDestroy:cn}:(cn(),Kr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ze(V,Te){var $e={};function tr(Mr){z.type(Mr,"string","extension name must be string");var Nr=Mr.toLowerCase(),jr;try{jr=$e[Nr]=wr(Mr)}catch(qr){}return!!jr}function wr(Mr){return V.getExtension(Mr)?V.getExtension(Mr):V.getExtension(Mr.toLowerCase())?V.getExtension(Mr.toLowerCase()):null}for(var rr=0;rr<Te.extensions.length;++rr){var br=Te.extensions[rr];if(!tr(br))return Te.onDestroy(),Te.onDone('"'+br+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Te.optionalExtensions.forEach(tr),{extensions:$e,restore:function(){Object.keys($e).forEach(function(Mr){if($e[Mr]&&!tr(Mr))throw new Error("(regl): error restoring extension "+Mr)})}}}function rt(V,Te){for(var $e=Array(V),tr=0;tr<V;++tr)$e[tr]=Te(tr);return $e}var _t=5120,be=5121,We=5122,zt=5123,Rr=5124,er=5125,ar=5126;function Or(V){for(var Te=16;Te<=1<<28;Te*=16)if(V<=Te)return Te;return 0}function Dn(V){var Te,$e;return Te=(V>65535)<<4,V>>>=Te,$e=(V>255)<<3,V>>>=$e,Te|=$e,$e=(V>15)<<2,V>>>=$e,Te|=$e,$e=(V>3)<<1,V>>>=$e,Te|=$e,Te|V>>1}function In(){var V=rt(8,function(){return[]});function Te(rr){var br=Or(rr),Mr=V[Dn(br)>>2];return Mr.length>0?Mr.pop():new ArrayBuffer(br)}function $e(rr){V[Dn(rr.byteLength)>>2].push(rr)}function tr(rr,br){var Mr=null;switch(rr){case _t:Mr=new Int8Array(Te(br),0,br);break;case be:Mr=new Uint8Array(Te(br),0,br);break;case We:Mr=new Int16Array(Te(2*br),0,br);break;case zt:Mr=new Uint16Array(Te(2*br),0,br);break;case Rr:Mr=new Int32Array(Te(4*br),0,br);break;case er:Mr=new Uint32Array(Te(4*br),0,br);break;case ar:Mr=new Float32Array(Te(4*br),0,br);break;default:return null}return Mr.length!==br?Mr.subarray(0,br):Mr}function wr(rr){$e(rr.buffer)}return{alloc:Te,free:$e,allocType:tr,freeType:wr}}var qt=In();qt.zero=In();var Cn=3408,mr=3410,pt=3411,Ei=3412,gn=3413,Pi=3414,na=3415,vt=33901,xt=33902,Ii=3379,hi=3386,Qi=34921,Ji=36347,ia=36348,Fi=35661,sr=35660,xr=34930,je=36349,wa=34076,Le=34024,As=7936,us=7937,ta=7938,Ys=35724,no=34047,Wa=36063,io=34852,aa=3553,jo=34067,Qo=34069,Au=33984,wo=6408,To=5126,la=5121,ao=36160,Go=36053,qa=36064,nu=16384,Rl=function(V,Te){var $e=1;Te.ext_texture_filter_anisotropic&&($e=V.getParameter(no));var tr=1,wr=1;Te.webgl_draw_buffers&&(tr=V.getParameter(io),wr=V.getParameter(Wa));var rr=!!Te.oes_texture_float;if(rr){var br=V.createTexture();V.bindTexture(aa,br),V.texImage2D(aa,0,wo,1,1,0,wo,To,null);var Mr=V.createFramebuffer();if(V.bindFramebuffer(ao,Mr),V.framebufferTexture2D(ao,qa,aa,br,0),V.bindTexture(aa,null),V.checkFramebufferStatus(ao)!==Go)rr=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(nu);var Nr=qt.allocType(To,4);V.readPixels(0,0,1,1,wo,To,Nr),V.getError()?rr=!1:(V.deleteFramebuffer(Mr),V.deleteTexture(br),rr=Nr[0]===1),qt.freeType(Nr)}}var jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),qr=!0;if(!jr){var Kr=V.createTexture(),cn=qt.allocType(la,36);V.activeTexture(Au),V.bindTexture(jo,Kr),V.texImage2D(Qo,0,wo,3,3,0,wo,la,cn),qt.freeType(cn),V.bindTexture(jo,null),V.deleteTexture(Kr),qr=!V.getError()}return{colorBits:[V.getParameter(mr),V.getParameter(pt),V.getParameter(Ei),V.getParameter(gn)],depthBits:V.getParameter(Pi),stencilBits:V.getParameter(na),subpixelBits:V.getParameter(Cn),extensions:Object.keys(Te).filter(function(Ur){return!!Te[Ur]}),maxAnisotropic:$e,maxDrawbuffers:tr,maxColorAttachments:wr,pointSizeDims:V.getParameter(vt),lineWidthDims:V.getParameter(xt),maxViewportDims:V.getParameter(hi),maxCombinedTextureUnits:V.getParameter(Fi),maxCubeMapSize:V.getParameter(wa),maxRenderbufferSize:V.getParameter(Le),maxTextureUnits:V.getParameter(xr),maxTextureSize:V.getParameter(Ii),maxAttributes:V.getParameter(Qi),maxVertexUniforms:V.getParameter(Ji),maxVertexTextureUnits:V.getParameter(sr),maxVaryingVectors:V.getParameter(ia),maxFragmentUniforms:V.getParameter(je),glsl:V.getParameter(Ys),renderer:V.getParameter(us),vendor:V.getParameter(As),version:V.getParameter(ta),readFloat:rr,npotTextureCube:qr}};function Jo(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||re(V.data))}var he=function(V){return Object.keys(V).map(function(Te){return V[Te]})},Pe={shape:fo,flatten:Bi};function dt(V,Te,$e){for(var tr=0;tr<Te;++tr)$e[tr]=V[tr]}function Jt(V,Te,$e,tr){for(var wr=0,rr=0;rr<Te;++rr)for(var br=V[rr],Mr=0;Mr<$e;++Mr)tr[wr++]=br[Mr]}function en(V,Te,$e,tr,wr,rr){for(var br=rr,Mr=0;Mr<Te;++Mr)for(var Nr=V[Mr],jr=0;jr<$e;++jr)for(var qr=Nr[jr],Kr=0;Kr<tr;++Kr)wr[br++]=qr[Kr]}function Gn(V,Te,$e,tr,wr){for(var rr=1,br=$e+1;br<Te.length;++br)rr*=Te[br];var Mr=Te[$e];if(Te.length-$e==4){var Nr=Te[$e+1],jr=Te[$e+2],qr=Te[$e+3];for(br=0;br<Mr;++br)en(V[br],Nr,jr,qr,tr,wr),wr+=rr}else for(br=0;br<Mr;++br)Gn(V[br],Te,$e+1,tr,wr),wr+=rr}function Bi(V,Te,$e,tr){var wr=1;if(Te.length)for(var rr=0;rr<Te.length;++rr)wr*=Te[rr];else wr=0;var br=tr||qt.allocType($e,wr);switch(Te.length){case 0:break;case 1:dt(V,Te[0],br);break;case 2:Jt(V,Te[0],Te[1],br);break;case 3:en(V,Te[0],Te[1],Te[2],br,0);break;default:Gn(V,Te,0,br,0)}return br}function fo(V){for(var Te=[],$e=V;$e.length;$e=$e[0])Te.push($e.length);return Te}var za={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ka=5120,es=5122,Oo=5124,go=5121,ws=5123,Ts=5125,Ms=5126,iu=5126,vu={int8:Ka,int16:es,int32:Oo,uint8:go,uint16:ws,uint32:Ts,float:Ms,float32:iu},ys=35048,zi=35040,Ia={dynamic:ys,stream:zi,static:35044},Hc=Pe.flatten,yf=Pe.shape,Is=35044,_f=35040,hl=5121,el=5126,au=[];au[5120]=1,au[5122]=2,au[5124]=4,au[5121]=1,au[5123]=2,au[5125]=4,au[5126]=4;function Ol(V){return za[Object.prototype.toString.call(V)]|0}function b(V,Te){for(var $e=0;$e<Te.length;++$e)V[$e]=Te[$e]}function M(V,Te,$e,tr,wr,rr,br){for(var Mr=0,Nr=0;Nr<$e;++Nr)for(var jr=0;jr<tr;++jr)V[Mr++]=Te[wr*Nr+rr*jr+br]}function Z(V,Te,$e,tr){var wr=0,rr={};function br(Lt){this.id=wr++,this.buffer=V.createBuffer(),this.type=Lt,this.usage=Is,this.byteLength=0,this.dimension=1,this.dtype=hl,this.persistentData=null,$e.profile&&(this.stats={size:0})}br.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},br.prototype.destroy=function(){cn(this)};var Mr=[];function Nr(Lt,cr){var Gr=Mr.pop();return Gr||(Gr=new br(Lt)),Gr.bind(),Kr(Gr,cr,_f,0,1,!1),Gr}function jr(Lt){Mr.push(Lt)}function qr(Lt,cr,Gr){Lt.byteLength=cr.byteLength,V.bufferData(Lt.type,cr,Gr)}function Kr(Lt,cr,Gr,un,Tr,Jr){var yn;if(Lt.usage=Gr,Array.isArray(cr)){if(Lt.dtype=un||el,cr.length>0){var ei;if(Array.isArray(cr[0])){yn=yf(cr);for(var Er=1,Cr=1;Cr<yn.length;++Cr)Er*=yn[Cr];Lt.dimension=Er,ei=Hc(cr,yn,Lt.dtype),qr(Lt,ei,Gr),Jr?Lt.persistentData=ei:qt.freeType(ei)}else if(typeof cr[0]=="number"){Lt.dimension=Tr;var Rn=qt.allocType(Lt.dtype,cr.length);b(Rn,cr),qr(Lt,Rn,Gr),Jr?Lt.persistentData=Rn:qt.freeType(Rn)}else re(cr[0])?(Lt.dimension=cr[0].length,Lt.dtype=un||Ol(cr[0])||el,ei=Hc(cr,[cr.length,cr[0].length],Lt.dtype),qr(Lt,ei,Gr),Jr?Lt.persistentData=ei:qt.freeType(ei)):z.raise("invalid buffer data")}}else if(re(cr))Lt.dtype=un||Ol(cr),Lt.dimension=Tr,qr(Lt,cr,Gr),Jr&&(Lt.persistentData=new Uint8Array(new Uint8Array(cr.buffer)));else if(Jo(cr)){yn=cr.shape;var hn=cr.stride,Vr=cr.offset,vn=0,pn=0,Mi=0,mi=0;yn.length===1?(vn=yn[0],pn=1,Mi=hn[0],mi=0):yn.length===2?(vn=yn[0],pn=yn[1],Mi=hn[0],mi=hn[1]):z.raise("invalid shape"),Lt.dtype=un||Ol(cr.data)||el,Lt.dimension=pn;var fn=qt.allocType(Lt.dtype,vn*pn);M(fn,cr.data,vn,pn,Mi,mi,Vr),qr(Lt,fn,Gr),Jr?Lt.persistentData=fn:qt.freeType(fn)}else cr instanceof ArrayBuffer?(Lt.dtype=hl,Lt.dimension=Tr,qr(Lt,cr,Gr),Jr&&(Lt.persistentData=new Uint8Array(new Uint8Array(cr)))):z.raise("invalid buffer data")}function cn(Lt){Te.bufferCount--,tr(Lt);var cr=Lt.buffer;z(cr,"buffer must not be deleted already"),V.deleteBuffer(cr),Lt.buffer=null,delete rr[Lt.id]}function Ur(Lt,cr,Gr,un){Te.bufferCount++;var Tr=new br(cr);rr[Tr.id]=Tr;function Jr(Er){var Cr=Is,Rn=null,hn=0,Vr=0,vn=1;return Array.isArray(Er)||re(Er)||Jo(Er)||Er instanceof ArrayBuffer?Rn=Er:typeof Er=="number"?hn=Er|0:Er&&(z.type(Er,"object","buffer arguments must be an object, a number or an array"),"data"in Er&&(z(Rn===null||Array.isArray(Rn)||re(Rn)||Jo(Rn),"invalid data for buffer"),Rn=Er.data),"usage"in Er&&(z.parameter(Er.usage,Ia,"invalid buffer usage"),Cr=Ia[Er.usage]),"type"in Er&&(z.parameter(Er.type,vu,"invalid buffer type"),Vr=vu[Er.type]),"dimension"in Er&&(z.type(Er.dimension,"number","invalid dimension"),vn=Er.dimension|0),"length"in Er&&(z.nni(hn,"buffer length must be a nonnegative integer"),hn=Er.length|0)),Tr.bind(),Rn?Kr(Tr,Rn,Cr,Vr,vn,un):(hn&&V.bufferData(Tr.type,hn,Cr),Tr.dtype=Vr||hl,Tr.usage=Cr,Tr.dimension=vn,Tr.byteLength=hn),$e.profile&&(Tr.stats.size=Tr.byteLength*au[Tr.dtype]),Jr}function yn(Er,Cr){z(Cr+Er.byteLength<=Tr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Er.byteLength+" starting from offset "+Cr+" to a buffer of size "+Tr.byteLength),V.bufferSubData(Tr.type,Cr,Er)}function ei(Er,Cr){var Rn=(Cr||0)|0,hn;if(Tr.bind(),re(Er)||Er instanceof ArrayBuffer)yn(Er,Rn);else if(Array.isArray(Er)){if(Er.length>0)if(typeof Er[0]=="number"){var Vr=qt.allocType(Tr.dtype,Er.length);b(Vr,Er),yn(Vr,Rn),qt.freeType(Vr)}else if(Array.isArray(Er[0])||re(Er[0])){hn=yf(Er);var vn=Hc(Er,hn,Tr.dtype);yn(vn,Rn),qt.freeType(vn)}else z.raise("invalid buffer data")}else if(Jo(Er)){hn=Er.shape;var pn=Er.stride,Mi=0,mi=0,fn=0,xn=0;hn.length===1?(Mi=hn[0],mi=1,fn=pn[0],xn=0):hn.length===2?(Mi=hn[0],mi=hn[1],fn=pn[0],xn=pn[1]):z.raise("invalid shape");var ci=Array.isArray(Er.data)?Tr.dtype:Ol(Er.data),Ci=qt.allocType(ci,Mi*mi);M(Ci,Er.data,Mi,mi,fn,xn,Er.offset),yn(Ci,Rn),qt.freeType(Ci)}else z.raise("invalid data for buffer subdata");return Jr}return Gr||Jr(Lt),Jr._reglType="buffer",Jr._buffer=Tr,Jr.subdata=ei,$e.profile&&(Jr.stats=Tr.stats),Jr.destroy=function(){cn(Tr)},Jr}function Yr(){he(rr).forEach(function(Lt){Lt.buffer=V.createBuffer(),V.bindBuffer(Lt.type,Lt.buffer),V.bufferData(Lt.type,Lt.persistentData||Lt.byteLength,Lt.usage)})}return $e.profile&&(Te.getTotalBufferSize=function(){var Lt=0;return Object.keys(rr).forEach(function(cr){Lt+=rr[cr].stats.size}),Lt}),{create:Ur,createStream:Nr,destroyStream:jr,clear:function(){he(rr).forEach(cn),Mr.forEach(cn)},getBuffer:function(Lt){return Lt&&Lt._buffer instanceof br?Lt._buffer:null},restore:Yr,_initBuffer:Kr}}var L=0,ne=0,ke=1,st=1,Ft=4,Bt=4,Sr={points:L,point:ne,lines:ke,line:st,triangles:Ft,triangle:Bt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Br=0,Hn=1,Kn=4,yi=5120,$i=5121,Ea=5122,La=5123,qi=5124,_s=5125,mu=34963,pl=35040,xf=35044;function dl(V,Te,$e,tr){var wr={},rr=0,br={uint8:$i,uint16:La};Te.oes_element_index_uint&&(br.uint32=_s);function Mr(Yr){this.id=rr++,wr[this.id]=this,this.buffer=Yr,this.primType=Kn,this.vertCount=0,this.type=0}Mr.prototype.bind=function(){this.buffer.bind()};var Nr=[];function jr(Yr){var Lt=Nr.pop();return Lt||(Lt=new Mr($e.create(null,mu,!0,!1)._buffer)),Kr(Lt,Yr,pl,-1,-1,0,0),Lt}function qr(Yr){Nr.push(Yr)}function Kr(Yr,Lt,cr,Gr,un,Tr,Jr){Yr.buffer.bind();var yn;if(Lt){var ei=Jr;!Jr&&(!re(Lt)||Jo(Lt)&&!re(Lt.data))&&(ei=Te.oes_element_index_uint?_s:La),$e._initBuffer(Yr.buffer,Lt,cr,ei,3)}else V.bufferData(mu,Tr,cr),Yr.buffer.dtype=yn||$i,Yr.buffer.usage=cr,Yr.buffer.dimension=3,Yr.buffer.byteLength=Tr;if(yn=Jr,!Jr){switch(Yr.buffer.dtype){case $i:case yi:yn=$i;break;case La:case Ea:yn=La;break;case _s:case qi:yn=_s;break;default:z.raise("unsupported type for element array")}Yr.buffer.dtype=yn}Yr.type=yn,z(yn!==_s||!!Te.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Er=un;Er<0&&(Er=Yr.buffer.byteLength,yn===La?Er>>=1:yn===_s&&(Er>>=2)),Yr.vertCount=Er;var Cr=Gr;if(Gr<0){Cr=Kn;var Rn=Yr.buffer.dimension;Rn===1&&(Cr=Br),Rn===2&&(Cr=Hn),Rn===3&&(Cr=Kn)}Yr.primType=Cr}function cn(Yr){tr.elementsCount--,z(Yr.buffer!==null,"must not double destroy elements"),delete wr[Yr.id],Yr.buffer.destroy(),Yr.buffer=null}function Ur(Yr,Lt){var cr=$e.create(null,mu,!0),Gr=new Mr(cr._buffer);tr.elementsCount++;function un(Tr){if(!Tr)cr(),Gr.primType=Kn,Gr.vertCount=0,Gr.type=$i;else if(typeof Tr=="number")cr(Tr),Gr.primType=Kn,Gr.vertCount=Tr|0,Gr.type=$i;else{var Jr=null,yn=xf,ei=-1,Er=-1,Cr=0,Rn=0;Array.isArray(Tr)||re(Tr)||Jo(Tr)?Jr=Tr:(z.type(Tr,"object","invalid arguments for elements"),"data"in Tr&&(Jr=Tr.data,z(Array.isArray(Jr)||re(Jr)||Jo(Jr),"invalid data for element buffer")),"usage"in Tr&&(z.parameter(Tr.usage,Ia,"invalid element buffer usage"),yn=Ia[Tr.usage]),"primitive"in Tr&&(z.parameter(Tr.primitive,Sr,"invalid element buffer primitive"),ei=Sr[Tr.primitive]),"count"in Tr&&(z(typeof Tr.count=="number"&&Tr.count>=0,"invalid vertex count for elements"),Er=Tr.count|0),"type"in Tr&&(z.parameter(Tr.type,br,"invalid buffer type"),Rn=br[Tr.type]),"length"in Tr?Cr=Tr.length|0:(Cr=Er,Rn===La||Rn===Ea?Cr*=2:(Rn===_s||Rn===qi)&&(Cr*=4))),Kr(Gr,Jr,yn,ei,Er,Cr,Rn)}return un}return un(Yr),un._reglType="elements",un._elements=Gr,un.subdata=function(Tr,Jr){return cr.subdata(Tr,Jr),un},un.destroy=function(){cn(Gr)},un}return{create:Ur,createStream:jr,destroyStream:qr,getElements:function(Yr){return typeof Yr=="function"&&Yr._elements instanceof Mr?Yr._elements:null},clear:function(){he(wr).forEach(cn)}}}var Wc=new Float32Array(1),Nu=new Uint32Array(Wc.buffer),zu=5123;function Zu(V){for(var Te=qt.allocType(zu,V.length),$e=0;$e<V.length;++$e)if(isNaN(V[$e]))Te[$e]=65535;else if(V[$e]===Infinity)Te[$e]=31744;else if(V[$e]===-Infinity)Te[$e]=64512;else{Wc[0]=V[$e];var tr=Nu[0],wr=tr>>>31<<15,rr=(tr<<1>>>24)-127,br=tr>>13&(1<<10)-1;if(rr<-24)Te[$e]=wr;else if(rr<-14){var Mr=-14-rr;Te[$e]=wr+(br+(1<<10)>>Mr)}else rr>15?Te[$e]=wr+31744:Te[$e]=wr+(rr+15<<10)+br}return Te}function yo(V){return Array.isArray(V)||re(V)}var th=function(V){return!(V&V-1)&&!!V},Xc=34467,xs=3553,bf=34067,tl=34069,ou=6408,rh=6406,$s=6407,Ta=6409,Dl=6410,Lh=32854,Uu=32855,Yc=36194,Sp=32819,Cp=32820,nh=33635,$c=34042,lc=6402,Fl=34041,Bl=35904,vl=35906,ml=36193,gl=33776,su=33777,Ef=33778,Sf=33779,Nl=35986,yl=35987,cc=34798,qc=35840,fc=35841,Cf=35842,Ap=35843,Af=36196,_l=5121,wf=5123,ih=5125,Vu=5126,Rh=10242,Oh=10243,Dh=10497,zl=33071,Fh=33648,ts=10240,Qa=10241,ca=9728,Zl=9729,rl=9984,Wi=9985,Ra=9986,Fs=9987,Kc=33170,Ni=4352,ks=4353,wu=4354,Ul=34046,Qc=3317,hc=37440,Tu=37441,Ho=37443,pc=37444,Vl=33984,Mo=[rl,Ra,Wi,Fs],Fn=[0,Ta,Dl,$s,ou],ho={};ho[Ta]=ho[rh]=ho[lc]=1,ho[Fl]=ho[Dl]=2,ho[$s]=ho[Bl]=3,ho[ou]=ho[vl]=4;function Oa(V){return"[object "+V+"]"}var xl=Oa("HTMLCanvasElement"),uu=Oa("OffscreenCanvas"),qs=Oa("CanvasRenderingContext2D"),Tf=Oa("ImageBitmap"),dn=Oa("HTMLImageElement"),dc=Oa("HTMLVideoElement"),jl=Object.keys(za).concat([xl,uu,qs,Tf,dn,dc]),nl=[];nl[_l]=1,nl[Vu]=4,nl[ml]=2,nl[wf]=2,nl[ih]=4;var Va=[];Va[Lh]=2,Va[Uu]=2,Va[Yc]=2,Va[Fl]=4,Va[gl]=.5,Va[su]=.5,Va[Ef]=1,Va[Sf]=1,Va[Nl]=.5,Va[yl]=1,Va[cc]=1,Va[qc]=.5,Va[fc]=.25,Va[Cf]=.5,Va[Ap]=.25,Va[Af]=.5;function Bs(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function vc(V){if(!Array.isArray(V))return!1;var Te=V.length;return!(Te===0||!yo(V[0]))}function ju(V){return Object.prototype.toString.call(V)}function Ns(V){return ju(V)===xl}function gu(V){return ju(V)===uu}function Mf(V){return ju(V)===qs}function Jc(V){return ju(V)===Tf}function If(V){return ju(V)===dn}function ah(V){return ju(V)===dc}function lu(V){var Te=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Te&&V&&V.getContext)}function bs(V){var Te=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Te&&V&&"src"in V&&"crossOrigin"in V)}function Oi(V){if(!V)return!1;if(lu(V)||bs(V))return!0;var Te=ju(V);return jl.indexOf(Te)>=0?!0:Bs(V)||vc(V)||Jo(V)}function Mu(V){return za[Object.prototype.toString.call(V)]|0}function yu(V,Te){var $e=Te.length;switch(V.type){case _l:case wf:case ih:case Vu:var tr=qt.allocType(V.type,$e);tr.set(Te),V.data=tr;break;case ml:V.data=Zu(Te);break;default:z.raise("unsupported texture type, must specify a typed array")}}function ls(V,Te){return qt.allocType(V.type===ml?Vu:V.type,Te)}function bl(V,Te){V.type===ml?(V.data=Zu(Te),qt.freeType(Te)):V.data=Te}function El(V,Te,$e,tr,wr,rr){for(var br=V.width,Mr=V.height,Nr=V.channels,jr=br*Mr*Nr,qr=ls(V,jr),Kr=0,cn=0;cn<Mr;++cn)for(var Ur=0;Ur<br;++Ur)for(var Yr=0;Yr<Nr;++Yr)qr[Kr++]=Te[$e*Ur+tr*cn+wr*Yr+rr];bl(V,qr)}function zs(V,Te,$e,tr,wr,rr){var br;if(typeof Va[V]!="undefined"?br=Va[V]:br=ho[V]*nl[Te],rr&&(br*=6),wr){for(var Mr=0,Nr=$e;Nr>=1;)Mr+=br*Nr*Nr,Nr/=2;return Mr}else return br*$e*tr}function Zs(V,Te,$e,tr,wr,rr,br){var Mr={"don't care":Ni,"dont care":Ni,nice:wu,fast:ks},Nr={repeat:Dh,clamp:zl,mirror:Fh},jr={nearest:ca,linear:Zl},qr=y({mipmap:Fs,"nearest mipmap nearest":rl,"linear mipmap nearest":Wi,"nearest mipmap linear":Ra,"linear mipmap linear":Fs},jr),Kr={none:0,browser:pc},cn={uint8:_l,rgba4:Sp,rgb565:nh,"rgb5 a1":Cp},Ur={alpha:rh,luminance:Ta,"luminance alpha":Dl,rgb:$s,rgba:ou,rgba4:Lh,"rgb5 a1":Uu,rgb565:Yc},Yr={};Te.ext_srgb&&(Ur.srgb=Bl,Ur.srgba=vl),Te.oes_texture_float&&(cn.float32=cn.float=Vu),Te.oes_texture_half_float&&(cn.float16=cn["half float"]=ml),Te.webgl_depth_texture&&(y(Ur,{depth:lc,"depth stencil":Fl}),y(cn,{uint16:wf,uint32:ih,"depth stencil":$c})),Te.webgl_compressed_texture_s3tc&&y(Yr,{"rgb s3tc dxt1":gl,"rgba s3tc dxt1":su,"rgba s3tc dxt3":Ef,"rgba s3tc dxt5":Sf}),Te.webgl_compressed_texture_atc&&y(Yr,{"rgb atc":Nl,"rgba atc explicit alpha":yl,"rgba atc interpolated alpha":cc}),Te.webgl_compressed_texture_pvrtc&&y(Yr,{"rgb pvrtc 4bppv1":qc,"rgb pvrtc 2bppv1":fc,"rgba pvrtc 4bppv1":Cf,"rgba pvrtc 2bppv1":Ap}),Te.webgl_compressed_texture_etc1&&(Yr["rgb etc1"]=Af);var Lt=Array.prototype.slice.call(V.getParameter(Xc)||new Uint32Array(0));Object.keys(Yr).forEach(function(Ue){var or=Yr[Ue];Lt.indexOf(or)>=0&&(Ur[Ue]=or)});var cr=Object.keys(Ur);$e.textureFormats=cr;var Gr=[];Object.keys(Ur).forEach(function(Ue){var or=Ur[Ue];Gr[or]=Ue});var un=[];Object.keys(cn).forEach(function(Ue){var or=cn[Ue];un[or]=Ue});var Tr=[];Object.keys(jr).forEach(function(Ue){var or=jr[Ue];Tr[or]=Ue});var Jr=[];Object.keys(qr).forEach(function(Ue){var or=qr[Ue];Jr[or]=Ue});var yn=[];Object.keys(Nr).forEach(function(Ue){var or=Nr[Ue];yn[or]=Ue});var ei=cr.reduce(function(Ue,or){var Gt=Ur[or];return Gt===Ta||Gt===rh||Gt===Ta||Gt===Dl||Gt===lc||Gt===Fl||Te.ext_srgb&&(Gt===Bl||Gt===vl)?Ue[Gt]=Gt:Gt===Uu||or.indexOf("rgba")>=0?Ue[Gt]=ou:Ue[Gt]=$s,Ue},{});function Er(){this.internalformat=ou,this.format=ou,this.type=_l,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=pc,this.width=0,this.height=0,this.channels=0}function Cr(Ue,or){Ue.internalformat=or.internalformat,Ue.format=or.format,Ue.type=or.type,Ue.compressed=or.compressed,Ue.premultiplyAlpha=or.premultiplyAlpha,Ue.flipY=or.flipY,Ue.unpackAlignment=or.unpackAlignment,Ue.colorSpace=or.colorSpace,Ue.width=or.width,Ue.height=or.height,Ue.channels=or.channels}function Rn(Ue,or){if(!(typeof or!="object"||!or)){if("premultiplyAlpha"in or&&(z.type(or.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ue.premultiplyAlpha=or.premultiplyAlpha),"flipY"in or&&(z.type(or.flipY,"boolean","invalid texture flip"),Ue.flipY=or.flipY),"alignment"in or&&(z.oneOf(or.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ue.unpackAlignment=or.alignment),"colorSpace"in or&&(z.parameter(or.colorSpace,Kr,"invalid colorSpace"),Ue.colorSpace=Kr[or.colorSpace]),"type"in or){var Gt=or.type;z(Te.oes_texture_float||!(Gt==="float"||Gt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),z(Te.oes_texture_half_float||!(Gt==="half float"||Gt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),z(Te.webgl_depth_texture||!(Gt==="uint16"||Gt==="uint32"||Gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),z.parameter(Gt,cn,"invalid texture type"),Ue.type=cn[Gt]}var Pn=Ue.width,Yi=Ue.height,De=Ue.channels,ye=!1;"shape"in or?(z(Array.isArray(or.shape)&&or.shape.length>=2,"shape must be an array"),Pn=or.shape[0],Yi=or.shape[1],or.shape.length===3&&(De=or.shape[2],z(De>0&&De<=4,"invalid number of channels"),ye=!0),z(Pn>=0&&Pn<=$e.maxTextureSize,"invalid width"),z(Yi>=0&&Yi<=$e.maxTextureSize,"invalid height")):("radius"in or&&(Pn=Yi=or.radius,z(Pn>=0&&Pn<=$e.maxTextureSize,"invalid radius")),"width"in or&&(Pn=or.width,z(Pn>=0&&Pn<=$e.maxTextureSize,"invalid width")),"height"in or&&(Yi=or.height,z(Yi>=0&&Yi<=$e.maxTextureSize,"invalid height")),"channels"in or&&(De=or.channels,z(De>0&&De<=4,"invalid number of channels"),ye=!0)),Ue.width=Pn|0,Ue.height=Yi|0,Ue.channels=De|0;var ot=!1;if("format"in or){var Ot=or.format;z(Te.webgl_depth_texture||!(Ot==="depth"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),z.parameter(Ot,Ur,"invalid texture format");var Kt=Ue.internalformat=Ur[Ot];Ue.format=ei[Kt],Ot in cn&&("type"in or||(Ue.type=cn[Ot])),Ot in Yr&&(Ue.compressed=!0),ot=!0}!ye&&ot?Ue.channels=ho[Ue.format]:ye&&!ot?Ue.channels!==Fn[Ue.format]&&(Ue.format=Ue.internalformat=Fn[Ue.channels]):ot&&ye&&z(Ue.channels===ho[Ue.format],"number of channels inconsistent with specified format")}}function hn(Ue){V.pixelStorei(hc,Ue.flipY),V.pixelStorei(Tu,Ue.premultiplyAlpha),V.pixelStorei(Ho,Ue.colorSpace),V.pixelStorei(Qc,Ue.unpackAlignment)}function Vr(){Er.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function vn(Ue,or){var Gt=null;if(Oi(or)?Gt=or:or&&(z.type(or,"object","invalid pixel data type"),Rn(Ue,or),"x"in or&&(Ue.xOffset=or.x|0),"y"in or&&(Ue.yOffset=or.y|0),Oi(or.data)&&(Gt=or.data)),z(!Ue.compressed||Gt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),or.copy){z(!Gt,"can not specify copy and data field for the same texture");var Pn=wr.viewportWidth,Yi=wr.viewportHeight;Ue.width=Ue.width||Pn-Ue.xOffset,Ue.height=Ue.height||Yi-Ue.yOffset,Ue.needsCopy=!0,z(Ue.xOffset>=0&&Ue.xOffset<Pn&&Ue.yOffset>=0&&Ue.yOffset<Yi&&Ue.width>0&&Ue.width<=Pn&&Ue.height>0&&Ue.height<=Yi,"copy texture read out of bounds")}else if(!Gt)Ue.width=Ue.width||1,Ue.height=Ue.height||1,Ue.channels=Ue.channels||4;else if(re(Gt))Ue.channels=Ue.channels||4,Ue.data=Gt,!("type"in or)&&Ue.type===_l&&(Ue.type=Mu(Gt));else if(Bs(Gt))Ue.channels=Ue.channels||4,yu(Ue,Gt),Ue.alignment=1,Ue.needsFree=!0;else if(Jo(Gt)){var De=Gt.data;!Array.isArray(De)&&Ue.type===_l&&(Ue.type=Mu(De));var ye=Gt.shape,ot=Gt.stride,Ot,Kt,ct,Ye,St,Me;ye.length===3?(ct=ye[2],Me=ot[2]):(z(ye.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ct=1,Me=1),Ot=ye[0],Kt=ye[1],Ye=ot[0],St=ot[1],Ue.alignment=1,Ue.width=Ot,Ue.height=Kt,Ue.channels=ct,Ue.format=Ue.internalformat=Fn[ct],Ue.needsFree=!0,El(Ue,De,Ye,St,Me,Gt.offset)}else if(lu(Gt)||Ns(Gt)||gu(Gt)||Mf(Gt))lu(Gt)||Ns(Gt)||gu(Gt)?Ue.element=Gt:Ue.element=Gt.canvas,Ue.width=Ue.element.width,Ue.height=Ue.element.height,Ue.channels=4;else if(Jc(Gt))Ue.element=Gt,Ue.width=Gt.width,Ue.height=Gt.height,Ue.channels=4;else if(If(Gt))Ue.element=Gt,Ue.width=Gt.naturalWidth,Ue.height=Gt.naturalHeight,Ue.channels=4;else if(bs(Gt))Ue.element=Gt,Ue.width=Gt.width,Ue.height=Gt.height,Ue.channels=4;else if(ah(Gt))Ue.element=Gt,Ue.width=Gt.videoWidth,Ue.height=Gt.videoHeight,Ue.channels=4;else if(vc(Gt)){var tt=Ue.width||Gt[0].length,Be=Ue.height||Gt.length,Dt=Ue.channels;yo(Gt[0][0])?Dt=Dt||Gt[0][0].length:Dt=Dt||1;for(var Ht=Pe.shape(Gt),Ir=1,on=0;on<Ht.length;++on)Ir*=Ht[on];var ln=ls(Ue,Ir);Pe.flatten(Gt,Ht,"",ln),bl(Ue,ln),Ue.alignment=1,Ue.width=tt,Ue.height=Be,Ue.channels=Dt,Ue.format=Ue.internalformat=Fn[Dt],Ue.needsFree=!0}Ue.type===Vu?z($e.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ue.type===ml&&z($e.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function pn(Ue,or,Gt){var Pn=Ue.element,Yi=Ue.data,De=Ue.internalformat,ye=Ue.format,ot=Ue.type,Ot=Ue.width,Kt=Ue.height;hn(Ue),Pn?V.texImage2D(or,Gt,ye,ye,ot,Pn):Ue.compressed?V.compressedTexImage2D(or,Gt,De,Ot,Kt,0,Yi):Ue.needsCopy?(tr(),V.copyTexImage2D(or,Gt,ye,Ue.xOffset,Ue.yOffset,Ot,Kt,0)):V.texImage2D(or,Gt,ye,Ot,Kt,0,ye,ot,Yi||null)}function Mi(Ue,or,Gt,Pn,Yi){var De=Ue.element,ye=Ue.data,ot=Ue.internalformat,Ot=Ue.format,Kt=Ue.type,ct=Ue.width,Ye=Ue.height;hn(Ue),De?V.texSubImage2D(or,Yi,Gt,Pn,Ot,Kt,De):Ue.compressed?V.compressedTexSubImage2D(or,Yi,Gt,Pn,ot,ct,Ye,ye):Ue.needsCopy?(tr(),V.copyTexSubImage2D(or,Yi,Gt,Pn,Ue.xOffset,Ue.yOffset,ct,Ye)):V.texSubImage2D(or,Yi,Gt,Pn,ct,Ye,Ot,Kt,ye)}var mi=[];function fn(){return mi.pop()||new Vr}function xn(Ue){Ue.needsFree&&qt.freeType(Ue.data),Vr.call(Ue),mi.push(Ue)}function ci(){Er.call(this),this.genMipmaps=!1,this.mipmapHint=Ni,this.mipmask=0,this.images=Array(16)}function Ci(Ue,or,Gt){var Pn=Ue.images[0]=fn();Ue.mipmask=1,Pn.width=Ue.width=or,Pn.height=Ue.height=Gt,Pn.channels=Ue.channels=4}function ji(Ue,or){var Gt=null;if(Oi(or))Gt=Ue.images[0]=fn(),Cr(Gt,Ue),vn(Gt,or),Ue.mipmask=1;else if(Rn(Ue,or),Array.isArray(or.mipmap))for(var Pn=or.mipmap,Yi=0;Yi<Pn.length;++Yi)Gt=Ue.images[Yi]=fn(),Cr(Gt,Ue),Gt.width>>=Yi,Gt.height>>=Yi,vn(Gt,Pn[Yi]),Ue.mipmask|=1<<Yi;else Gt=Ue.images[0]=fn(),Cr(Gt,Ue),vn(Gt,or),Ue.mipmask=1;Cr(Ue,Ue.images[0]),Ue.compressed&&(Ue.internalformat===gl||Ue.internalformat===su||Ue.internalformat===Ef||Ue.internalformat===Sf)&&z(Ue.width%4==0&&Ue.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ma(Ue,or){for(var Gt=Ue.images,Pn=0;Pn<Gt.length;++Pn){if(!Gt[Pn])return;pn(Gt[Pn],or,Pn)}}var bo=[];function Zi(){var Ue=bo.pop()||new ci;Er.call(Ue),Ue.mipmask=0;for(var or=0;or<16;++or)Ue.images[or]=null;return Ue}function ns(Ue){for(var or=Ue.images,Gt=0;Gt<or.length;++Gt)or[Gt]&&xn(or[Gt]),or[Gt]=null;bo.push(Ue)}function ja(){this.minFilter=ca,this.magFilter=ca,this.wrapS=zl,this.wrapT=zl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ni}function Bo(Ue,or){if("min"in or){var Gt=or.min;z.parameter(Gt,qr),Ue.minFilter=qr[Gt],Mo.indexOf(Ue.minFilter)>=0&&!("faces"in or)&&(Ue.genMipmaps=!0)}if("mag"in or){var Pn=or.mag;z.parameter(Pn,jr),Ue.magFilter=jr[Pn]}var Yi=Ue.wrapS,De=Ue.wrapT;if("wrap"in or){var ye=or.wrap;typeof ye=="string"?(z.parameter(ye,Nr),Yi=De=Nr[ye]):Array.isArray(ye)&&(z.parameter(ye[0],Nr),z.parameter(ye[1],Nr),Yi=Nr[ye[0]],De=Nr[ye[1]])}else{if("wrapS"in or){var ot=or.wrapS;z.parameter(ot,Nr),Yi=Nr[ot]}if("wrapT"in or){var Ot=or.wrapT;z.parameter(Ot,Nr),De=Nr[Ot]}}if(Ue.wrapS=Yi,Ue.wrapT=De,"anisotropic"in or){var Kt=or.anisotropic;z(typeof Kt=="number"&&Kt>=1&&Kt<=$e.maxAnisotropic,"aniso samples must be between 1 and "),Ue.anisotropic=or.anisotropic}if("mipmap"in or){var ct=!1;switch(typeof or.mipmap){case"string":z.parameter(or.mipmap,Mr,"invalid mipmap hint"),Ue.mipmapHint=Mr[or.mipmap],Ue.genMipmaps=!0,ct=!0;break;case"boolean":ct=Ue.genMipmaps=or.mipmap;break;case"object":z(Array.isArray(or.mipmap),"invalid mipmap type"),Ue.genMipmaps=!1,ct=!0;break;default:z.raise("invalid mipmap type")}ct&&!("min"in or)&&(Ue.minFilter=rl)}}function Po(Ue,or){V.texParameteri(or,Qa,Ue.minFilter),V.texParameteri(or,ts,Ue.magFilter),V.texParameteri(or,Rh,Ue.wrapS),V.texParameteri(or,Oh,Ue.wrapT),Te.ext_texture_filter_anisotropic&&V.texParameteri(or,Ul,Ue.anisotropic),Ue.genMipmaps&&(V.hint(Kc,Ue.mipmapHint),V.generateMipmap(or))}var is=0,qo={},ps=$e.maxTextureUnits,oo=Array(ps).map(function(){return null});function Ti(Ue){Er.call(this),this.mipmask=0,this.internalformat=ou,this.id=is++,this.refCount=1,this.target=Ue,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ja,br.profile&&(this.stats={size:0})}function No(Ue){V.activeTexture(Vl),V.bindTexture(Ue.target,Ue.texture)}function sa(){var Ue=oo[0];Ue?V.bindTexture(Ue.target,Ue.texture):V.bindTexture(xs,null)}function ds(Ue){var or=Ue.texture;z(or,"must not double destroy texture");var Gt=Ue.unit,Pn=Ue.target;Gt>=0&&(V.activeTexture(Vl+Gt),V.bindTexture(Pn,null),oo[Gt]=null),V.deleteTexture(or),Ue.texture=null,Ue.params=null,Ue.pixels=null,Ue.refCount=0,delete qo[Ue.id],rr.textureCount--}y(Ti.prototype,{bind:function(){var Ue=this;Ue.bindCount+=1;var or=Ue.unit;if(or<0){for(var Gt=0;Gt<ps;++Gt){var Pn=oo[Gt];if(Pn){if(Pn.bindCount>0)continue;Pn.unit=-1}oo[Gt]=Ue,or=Gt;break}or>=ps&&z.raise("insufficient number of texture units"),br.profile&&rr.maxTextureUnits<or+1&&(rr.maxTextureUnits=or+1),Ue.unit=or,V.activeTexture(Vl+or),V.bindTexture(Ue.target,Ue.texture)}return or},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ds(this)}});function gi(Ue,or){var Gt=new Ti(xs);qo[Gt.id]=Gt,rr.textureCount++;function Pn(ye,ot){var Ot=Gt.texInfo;ja.call(Ot);var Kt=Zi();return typeof ye=="number"?typeof ot=="number"?Ci(Kt,ye|0,ot|0):Ci(Kt,ye|0,ye|0):ye?(z.type(ye,"object","invalid arguments to regl.texture"),Bo(Ot,ye),ji(Kt,ye)):Ci(Kt,1,1),Ot.genMipmaps&&(Kt.mipmask=(Kt.width<<1)-1),Gt.mipmask=Kt.mipmask,Cr(Gt,Kt),z.texture2D(Ot,Kt,$e),Gt.internalformat=Kt.internalformat,Pn.width=Kt.width,Pn.height=Kt.height,No(Gt),Ma(Kt,xs),Po(Ot,xs),sa(),ns(Kt),br.profile&&(Gt.stats.size=zs(Gt.internalformat,Gt.type,Kt.width,Kt.height,Ot.genMipmaps,!1)),Pn.format=Gr[Gt.internalformat],Pn.type=un[Gt.type],Pn.mag=Tr[Ot.magFilter],Pn.min=Jr[Ot.minFilter],Pn.wrapS=yn[Ot.wrapS],Pn.wrapT=yn[Ot.wrapT],Pn}function Yi(ye,ot,Ot,Kt){z(!!ye,"must specify image data");var ct=ot|0,Ye=Ot|0,St=Kt|0,Me=fn();return Cr(Me,Gt),Me.width=0,Me.height=0,vn(Me,ye),Me.width=Me.width||(Gt.width>>St)-ct,Me.height=Me.height||(Gt.height>>St)-Ye,z(Gt.type===Me.type&&Gt.format===Me.format&&Gt.internalformat===Me.internalformat,"incompatible format for texture.subimage"),z(ct>=0&&Ye>=0&&ct+Me.width<=Gt.width&&Ye+Me.height<=Gt.height,"texture.subimage write out of bounds"),z(Gt.mipmask&1<<St,"missing mipmap data"),z(Me.data||Me.element||Me.needsCopy,"missing image data"),No(Gt),Mi(Me,xs,ct,Ye,St),sa(),xn(Me),Pn}function De(ye,ot){var Ot=ye|0,Kt=ot|0||Ot;if(Ot===Gt.width&&Kt===Gt.height)return Pn;Pn.width=Gt.width=Ot,Pn.height=Gt.height=Kt,No(Gt);for(var ct=0;Gt.mipmask>>ct;++ct){var Ye=Ot>>ct,St=Kt>>ct;if(!Ye||!St)break;V.texImage2D(xs,ct,Gt.format,Ye,St,0,Gt.format,Gt.type,null)}return sa(),br.profile&&(Gt.stats.size=zs(Gt.internalformat,Gt.type,Ot,Kt,!1,!1)),Pn}return Pn(Ue,or),Pn.subimage=Yi,Pn.resize=De,Pn._reglType="texture2d",Pn._texture=Gt,br.profile&&(Pn.stats=Gt.stats),Pn.destroy=function(){Gt.decRef()},Pn}function Gi(Ue,or,Gt,Pn,Yi,De){var ye=new Ti(bf);qo[ye.id]=ye,rr.cubeCount++;var ot=new Array(6);function Ot(Ye,St,Me,tt,Be,Dt){var Ht,Ir=ye.texInfo;for(ja.call(Ir),Ht=0;Ht<6;++Ht)ot[Ht]=Zi();if(typeof Ye=="number"||!Ye){var on=Ye|0||1;for(Ht=0;Ht<6;++Ht)Ci(ot[Ht],on,on)}else if(typeof Ye=="object")if(St)ji(ot[0],Ye),ji(ot[1],St),ji(ot[2],Me),ji(ot[3],tt),ji(ot[4],Be),ji(ot[5],Dt);else if(Bo(Ir,Ye),Rn(ye,Ye),"faces"in Ye){var ln=Ye.faces;for(z(Array.isArray(ln)&&ln.length===6,"cube faces must be a length 6 array"),Ht=0;Ht<6;++Ht)z(typeof ln[Ht]=="object"&&!!ln[Ht],"invalid input for cube map face"),Cr(ot[Ht],ye),ji(ot[Ht],ln[Ht])}else for(Ht=0;Ht<6;++Ht)ji(ot[Ht],Ye);else z.raise("invalid arguments to cube map");for(Cr(ye,ot[0]),z.optional(function(){$e.npotTextureCube||z(th(ye.width)&&th(ye.height),"your browser does not support non power or two texture dimensions")}),Ir.genMipmaps?ye.mipmask=(ot[0].width<<1)-1:ye.mipmask=ot[0].mipmask,z.textureCube(ye,Ir,ot,$e),ye.internalformat=ot[0].internalformat,Ot.width=ot[0].width,Ot.height=ot[0].height,No(ye),Ht=0;Ht<6;++Ht)Ma(ot[Ht],tl+Ht);for(Po(Ir,bf),sa(),br.profile&&(ye.stats.size=zs(ye.internalformat,ye.type,Ot.width,Ot.height,Ir.genMipmaps,!0)),Ot.format=Gr[ye.internalformat],Ot.type=un[ye.type],Ot.mag=Tr[Ir.magFilter],Ot.min=Jr[Ir.minFilter],Ot.wrapS=yn[Ir.wrapS],Ot.wrapT=yn[Ir.wrapT],Ht=0;Ht<6;++Ht)ns(ot[Ht]);return Ot}function Kt(Ye,St,Me,tt,Be){z(!!St,"must specify image data"),z(typeof Ye=="number"&&Ye===(Ye|0)&&Ye>=0&&Ye<6,"invalid face");var Dt=Me|0,Ht=tt|0,Ir=Be|0,on=fn();return Cr(on,ye),on.width=0,on.height=0,vn(on,St),on.width=on.width||(ye.width>>Ir)-Dt,on.height=on.height||(ye.height>>Ir)-Ht,z(ye.type===on.type&&ye.format===on.format&&ye.internalformat===on.internalformat,"incompatible format for texture.subimage"),z(Dt>=0&&Ht>=0&&Dt+on.width<=ye.width&&Ht+on.height<=ye.height,"texture.subimage write out of bounds"),z(ye.mipmask&1<<Ir,"missing mipmap data"),z(on.data||on.element||on.needsCopy,"missing image data"),No(ye),Mi(on,tl+Ye,Dt,Ht,Ir),sa(),xn(on),Ot}function ct(Ye){var St=Ye|0;if(St!==ye.width){Ot.width=ye.width=St,Ot.height=ye.height=St,No(ye);for(var Me=0;Me<6;++Me)for(var tt=0;ye.mipmask>>tt;++tt)V.texImage2D(tl+Me,tt,ye.format,St>>tt,St>>tt,0,ye.format,ye.type,null);return sa(),br.profile&&(ye.stats.size=zs(ye.internalformat,ye.type,Ot.width,Ot.height,!1,!0)),Ot}}return Ot(Ue,or,Gt,Pn,Yi,De),Ot.subimage=Kt,Ot.resize=ct,Ot._reglType="textureCube",Ot._texture=ye,br.profile&&(Ot.stats=ye.stats),Ot.destroy=function(){ye.decRef()},Ot}function ga(){for(var Ue=0;Ue<ps;++Ue)V.activeTexture(Vl+Ue),V.bindTexture(xs,null),oo[Ue]=null;he(qo).forEach(ds),rr.cubeCount=0,rr.textureCount=0}br.profile&&(rr.getTotalTextureSize=function(){var Ue=0;return Object.keys(qo).forEach(function(or){Ue+=qo[or].stats.size}),Ue});function po(){for(var Ue=0;Ue<ps;++Ue){var or=oo[Ue];or&&(or.bindCount=0,or.unit=-1,oo[Ue]=null)}he(qo).forEach(function(Gt){Gt.texture=V.createTexture(),V.bindTexture(Gt.target,Gt.texture);for(var Pn=0;Pn<32;++Pn)if((Gt.mipmask&1<<Pn)!=0)if(Gt.target===xs)V.texImage2D(xs,Pn,Gt.internalformat,Gt.width>>Pn,Gt.height>>Pn,0,Gt.internalformat,Gt.type,null);else for(var Yi=0;Yi<6;++Yi)V.texImage2D(tl+Yi,Pn,Gt.internalformat,Gt.width>>Pn,Gt.height>>Pn,0,Gt.internalformat,Gt.type,null);Po(Gt.texInfo,Gt.target)})}function qu(){for(var Ue=0;Ue<ps;++Ue){var or=oo[Ue];or&&(or.bindCount=0,or.unit=-1,oo[Ue]=null),V.activeTexture(Vl+Ue),V.bindTexture(xs,null),V.bindTexture(bf,null)}}return{create2D:gi,createCube:Gi,clear:ga,getTexture:function(Ue){return null},restore:po,refresh:qu}}var cu=36161,$n=32854,Un=32855,kf=36194,rs=33189,Iu=36168,cs=34041,_u=35907,Pf=34836,ef=34842,fa=34843,Da=[];Da[$n]=2,Da[Un]=2,Da[kf]=2,Da[rs]=2,Da[Iu]=1,Da[cs]=4,Da[_u]=4,Da[Pf]=16,Da[ef]=8,Da[fa]=6;function tf(V,Te,$e){return Da[V]*Te*$e}var Gl=function(V,Te,$e,tr,wr){var rr={rgba4:$n,rgb565:kf,"rgb5 a1":Un,depth:rs,stencil:Iu,"depth stencil":cs};Te.ext_srgb&&(rr.srgba=_u),Te.ext_color_buffer_half_float&&(rr.rgba16f=ef,rr.rgb16f=fa),Te.webgl_color_buffer_float&&(rr.rgba32f=Pf);var br=[];Object.keys(rr).forEach(function(Ur){var Yr=rr[Ur];br[Yr]=Ur});var Mr=0,Nr={};function jr(Ur){this.id=Mr++,this.refCount=1,this.renderbuffer=Ur,this.format=$n,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}jr.prototype.decRef=function(){--this.refCount<=0&&qr(this)};function qr(Ur){var Yr=Ur.renderbuffer;z(Yr,"must not double destroy renderbuffer"),V.bindRenderbuffer(cu,null),V.deleteRenderbuffer(Yr),Ur.renderbuffer=null,Ur.refCount=0,delete Nr[Ur.id],tr.renderbufferCount--}function Kr(Ur,Yr){var Lt=new jr(V.createRenderbuffer());Nr[Lt.id]=Lt,tr.renderbufferCount++;function cr(un,Tr){var Jr=0,yn=0,ei=$n;if(typeof un=="object"&&un){var Er=un;if("shape"in Er){var Cr=Er.shape;z(Array.isArray(Cr)&&Cr.length>=2,"invalid renderbuffer shape"),Jr=Cr[0]|0,yn=Cr[1]|0}else"radius"in Er&&(Jr=yn=Er.radius|0),"width"in Er&&(Jr=Er.width|0),"height"in Er&&(yn=Er.height|0);"format"in Er&&(z.parameter(Er.format,rr,"invalid renderbuffer format"),ei=rr[Er.format])}else typeof un=="number"?(Jr=un|0,typeof Tr=="number"?yn=Tr|0:yn=Jr):un?z.raise("invalid arguments to renderbuffer constructor"):Jr=yn=1;if(z(Jr>0&&yn>0&&Jr<=$e.maxRenderbufferSize&&yn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),!(Jr===Lt.width&&yn===Lt.height&&ei===Lt.format))return cr.width=Lt.width=Jr,cr.height=Lt.height=yn,Lt.format=ei,V.bindRenderbuffer(cu,Lt.renderbuffer),V.renderbufferStorage(cu,ei,Jr,yn),z(V.getError()===0,"invalid render buffer format"),wr.profile&&(Lt.stats.size=tf(Lt.format,Lt.width,Lt.height)),cr.format=br[Lt.format],cr}function Gr(un,Tr){var Jr=un|0,yn=Tr|0||Jr;return Jr===Lt.width&&yn===Lt.height||(z(Jr>0&&yn>0&&Jr<=$e.maxRenderbufferSize&&yn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),cr.width=Lt.width=Jr,cr.height=Lt.height=yn,V.bindRenderbuffer(cu,Lt.renderbuffer),V.renderbufferStorage(cu,Lt.format,Jr,yn),z(V.getError()===0,"invalid render buffer format"),wr.profile&&(Lt.stats.size=tf(Lt.format,Lt.width,Lt.height))),cr}return cr(Ur,Yr),cr.resize=Gr,cr._reglType="renderbuffer",cr._renderbuffer=Lt,wr.profile&&(cr.stats=Lt.stats),cr.destroy=function(){Lt.decRef()},cr}wr.profile&&(tr.getTotalRenderbufferSize=function(){var Ur=0;return Object.keys(Nr).forEach(function(Yr){Ur+=Nr[Yr].stats.size}),Ur});function cn(){he(Nr).forEach(function(Ur){Ur.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(cu,Ur.renderbuffer),V.renderbufferStorage(cu,Ur.format,Ur.width,Ur.height)}),V.bindRenderbuffer(cu,null)}return{create:Kr,clear:function(){he(Nr).forEach(qr)},restore:cn}},Ks=36160,ku=36161,Do=3553,Sl=34069,xu=36064,Hl=36096,mc=36128,gc=33306,Lf=36053,yc=36054,_o=36055,Bh=36057,Wl=36061,Xl=36193,Rf=5121,Yl=5126,fs=6407,_c=6408,Cl=6402,Of=[fs,_c],$l=[];$l[_c]=4,$l[fs]=3;var f=[];f[Rf]=1,f[Yl]=4,f[Xl]=2;var d=32854,h=32855,g=36194,C=33189,T=36168,k=34041,D=35907,G=34836,ee=34842,_e=34843,Ee=[d,h,g,D,ee,_e,G],Ce={};Ce[Lf]="complete",Ce[yc]="incomplete attachment",Ce[Bh]="incomplete dimensions",Ce[_o]="incomplete, missing attachment",Ce[Wl]="unsupported";function Re(V,Te,$e,tr,wr,rr){var br={cur:null,next:null,dirty:!1,setFBO:null},Mr=["rgba"],Nr=["rgba4","rgb565","rgb5 a1"];Te.ext_srgb&&Nr.push("srgba"),Te.ext_color_buffer_half_float&&Nr.push("rgba16f","rgb16f"),Te.webgl_color_buffer_float&&Nr.push("rgba32f");var jr=["uint8"];Te.oes_texture_half_float&&jr.push("half float","float16"),Te.oes_texture_float&&jr.push("float","float32");function qr(Vr,vn,pn){this.target=Vr,this.texture=vn,this.renderbuffer=pn;var Mi=0,mi=0;vn?(Mi=vn.width,mi=vn.height):pn&&(Mi=pn.width,mi=pn.height),this.width=Mi,this.height=mi}function Kr(Vr){Vr&&(Vr.texture&&Vr.texture._texture.decRef(),Vr.renderbuffer&&Vr.renderbuffer._renderbuffer.decRef())}function cn(Vr,vn,pn){if(!!Vr)if(Vr.texture){var Mi=Vr.texture._texture,mi=Math.max(1,Mi.width),fn=Math.max(1,Mi.height);z(mi===vn&&fn===pn,"inconsistent width/height for supplied texture"),Mi.refCount+=1}else{var xn=Vr.renderbuffer._renderbuffer;z(xn.width===vn&&xn.height===pn,"inconsistent width/height for renderbuffer"),xn.refCount+=1}}function Ur(Vr,vn){vn&&(vn.texture?V.framebufferTexture2D(Ks,Vr,vn.target,vn.texture._texture.texture,0):V.framebufferRenderbuffer(Ks,Vr,ku,vn.renderbuffer._renderbuffer.renderbuffer))}function Yr(Vr){var vn=Do,pn=null,Mi=null,mi=Vr;typeof Vr=="object"&&(mi=Vr.data,"target"in Vr&&(vn=Vr.target|0)),z.type(mi,"function","invalid attachment data");var fn=mi._reglType;return fn==="texture2d"?(pn=mi,z(vn===Do)):fn==="textureCube"?(pn=mi,z(vn>=Sl&&vn<Sl+6,"invalid cube map target")):fn==="renderbuffer"?(Mi=mi,vn=ku):z.raise("invalid regl object for attachment"),new qr(vn,pn,Mi)}function Lt(Vr,vn,pn,Mi,mi){if(pn){var fn=tr.create2D({width:Vr,height:vn,format:Mi,type:mi});return fn._texture.refCount=0,new qr(Do,fn,null)}else{var xn=wr.create({width:Vr,height:vn,format:Mi});return xn._renderbuffer.refCount=0,new qr(ku,null,xn)}}function cr(Vr){return Vr&&(Vr.texture||Vr.renderbuffer)}function Gr(Vr,vn,pn){Vr&&(Vr.texture?Vr.texture.resize(vn,pn):Vr.renderbuffer&&Vr.renderbuffer.resize(vn,pn),Vr.width=vn,Vr.height=pn)}var un=0,Tr={};function Jr(){this.id=un++,Tr[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function yn(Vr){Vr.colorAttachments.forEach(Kr),Kr(Vr.depthAttachment),Kr(Vr.stencilAttachment),Kr(Vr.depthStencilAttachment)}function ei(Vr){var vn=Vr.framebuffer;z(vn,"must not double destroy framebuffer"),V.deleteFramebuffer(vn),Vr.framebuffer=null,rr.framebufferCount--,delete Tr[Vr.id]}function Er(Vr){var vn;V.bindFramebuffer(Ks,Vr.framebuffer);var pn=Vr.colorAttachments;for(vn=0;vn<pn.length;++vn)Ur(xu+vn,pn[vn]);for(vn=pn.length;vn<$e.maxColorAttachments;++vn)V.framebufferTexture2D(Ks,xu+vn,Do,null,0);V.framebufferTexture2D(Ks,gc,Do,null,0),V.framebufferTexture2D(Ks,Hl,Do,null,0),V.framebufferTexture2D(Ks,mc,Do,null,0),Ur(Hl,Vr.depthAttachment),Ur(mc,Vr.stencilAttachment),Ur(gc,Vr.depthStencilAttachment);var Mi=V.checkFramebufferStatus(Ks);!V.isContextLost()&&Mi!==Lf&&z.raise("framebuffer configuration not supported, status = "+Ce[Mi]),V.bindFramebuffer(Ks,br.next?br.next.framebuffer:null),br.cur=br.next,V.getError()}function Cr(Vr,vn){var pn=new Jr;rr.framebufferCount++;function Mi(fn,xn){var ci;z(br.next!==pn,"can not update framebuffer which is currently in use");var Ci=0,ji=0,Ma=!0,bo=!0,Zi=null,ns=!0,ja="rgba",Bo="uint8",Po=1,is=null,qo=null,ps=null,oo=!1;if(typeof fn=="number")Ci=fn|0,ji=xn|0||Ci;else if(!fn)Ci=ji=1;else{z.type(fn,"object","invalid arguments for framebuffer");var Ti=fn;if("shape"in Ti){var No=Ti.shape;z(Array.isArray(No)&&No.length>=2,"invalid shape for framebuffer"),Ci=No[0],ji=No[1]}else"radius"in Ti&&(Ci=ji=Ti.radius),"width"in Ti&&(Ci=Ti.width),"height"in Ti&&(ji=Ti.height);("color"in Ti||"colors"in Ti)&&(Zi=Ti.color||Ti.colors,Array.isArray(Zi)&&z(Zi.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),Zi||("colorCount"in Ti&&(Po=Ti.colorCount|0,z(Po>0,"invalid color buffer count")),"colorTexture"in Ti&&(ns=!!Ti.colorTexture,ja="rgba4"),"colorType"in Ti&&(Bo=Ti.colorType,ns?(z(Te.oes_texture_float||!(Bo==="float"||Bo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),z(Te.oes_texture_half_float||!(Bo==="half float"||Bo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Bo==="half float"||Bo==="float16"?(z(Te.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ja="rgba16f"):(Bo==="float"||Bo==="float32")&&(z(Te.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ja="rgba32f"),z.oneOf(Bo,jr,"invalid color type")),"colorFormat"in Ti&&(ja=Ti.colorFormat,Mr.indexOf(ja)>=0?ns=!0:Nr.indexOf(ja)>=0?ns=!1:z.optional(function(){ns?z.oneOf(Ti.colorFormat,Mr,"invalid color format for texture"):z.oneOf(Ti.colorFormat,Nr,"invalid color format for renderbuffer")}))),("depthTexture"in Ti||"depthStencilTexture"in Ti)&&(oo=!!(Ti.depthTexture||Ti.depthStencilTexture),z(!oo||Te.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ti&&(typeof Ti.depth=="boolean"?Ma=Ti.depth:(is=Ti.depth,bo=!1)),"stencil"in Ti&&(typeof Ti.stencil=="boolean"?bo=Ti.stencil:(qo=Ti.stencil,Ma=!1)),"depthStencil"in Ti&&(typeof Ti.depthStencil=="boolean"?Ma=bo=Ti.depthStencil:(ps=Ti.depthStencil,Ma=!1,bo=!1))}var sa=null,ds=null,gi=null,Gi=null;if(Array.isArray(Zi))sa=Zi.map(Yr);else if(Zi)sa=[Yr(Zi)];else for(sa=new Array(Po),ci=0;ci<Po;++ci)sa[ci]=Lt(Ci,ji,ns,ja,Bo);z(Te.webgl_draw_buffers||sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),z(sa.length<=$e.maxColorAttachments,"too many color attachments, not supported"),Ci=Ci||sa[0].width,ji=ji||sa[0].height,is?ds=Yr(is):Ma&&!bo&&(ds=Lt(Ci,ji,oo,"depth","uint32")),qo?gi=Yr(qo):bo&&!Ma&&(gi=Lt(Ci,ji,!1,"stencil","uint8")),ps?Gi=Yr(ps):!is&&!qo&&bo&&Ma&&(Gi=Lt(Ci,ji,oo,"depth stencil","depth stencil")),z(!!is+!!qo+!!ps<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ga=null;for(ci=0;ci<sa.length;++ci)if(cn(sa[ci],Ci,ji),z(!sa[ci]||sa[ci].texture&&Of.indexOf(sa[ci].texture._texture.format)>=0||sa[ci].renderbuffer&&Ee.indexOf(sa[ci].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ci+" is invalid"),sa[ci]&&sa[ci].texture){var po=$l[sa[ci].texture._texture.format]*f[sa[ci].texture._texture.type];ga===null?ga=po:z(ga===po,"all color attachments much have the same number of bits per pixel.")}return cn(ds,Ci,ji),z(!ds||ds.texture&&ds.texture._texture.format===Cl||ds.renderbuffer&&ds.renderbuffer._renderbuffer.format===C,"invalid depth attachment for framebuffer object"),cn(gi,Ci,ji),z(!gi||gi.renderbuffer&&gi.renderbuffer._renderbuffer.format===T,"invalid stencil attachment for framebuffer object"),cn(Gi,Ci,ji),z(!Gi||Gi.texture&&Gi.texture._texture.format===k||Gi.renderbuffer&&Gi.renderbuffer._renderbuffer.format===k,"invalid depth-stencil attachment for framebuffer object"),yn(pn),pn.width=Ci,pn.height=ji,pn.colorAttachments=sa,pn.depthAttachment=ds,pn.stencilAttachment=gi,pn.depthStencilAttachment=Gi,Mi.color=sa.map(cr),Mi.depth=cr(ds),Mi.stencil=cr(gi),Mi.depthStencil=cr(Gi),Mi.width=pn.width,Mi.height=pn.height,Er(pn),Mi}function mi(fn,xn){z(br.next!==pn,"can not resize a framebuffer which is currently in use");var ci=Math.max(fn|0,1),Ci=Math.max(xn|0||ci,1);if(ci===pn.width&&Ci===pn.height)return Mi;for(var ji=pn.colorAttachments,Ma=0;Ma<ji.length;++Ma)Gr(ji[Ma],ci,Ci);return Gr(pn.depthAttachment,ci,Ci),Gr(pn.stencilAttachment,ci,Ci),Gr(pn.depthStencilAttachment,ci,Ci),pn.width=Mi.width=ci,pn.height=Mi.height=Ci,Er(pn),Mi}return Mi(Vr,vn),y(Mi,{resize:mi,_reglType:"framebuffer",_framebuffer:pn,destroy:function(){ei(pn),yn(pn)},use:function(fn){br.setFBO({framebuffer:Mi},fn)}})}function Rn(Vr){var vn=Array(6);function pn(mi){var fn;z(vn.indexOf(br.next)<0,"can not update framebuffer which is currently in use");var xn={color:null},ci=0,Ci=null,ji="rgba",Ma="uint8",bo=1;if(typeof mi=="number")ci=mi|0;else if(!mi)ci=1;else{z.type(mi,"object","invalid arguments for framebuffer");var Zi=mi;if("shape"in Zi){var ns=Zi.shape;z(Array.isArray(ns)&&ns.length>=2,"invalid shape for framebuffer"),z(ns[0]===ns[1],"cube framebuffer must be square"),ci=ns[0]}else"radius"in Zi&&(ci=Zi.radius|0),"width"in Zi?(ci=Zi.width|0,"height"in Zi&&z(Zi.height===ci,"must be square")):"height"in Zi&&(ci=Zi.height|0);("color"in Zi||"colors"in Zi)&&(Ci=Zi.color||Zi.colors,Array.isArray(Ci)&&z(Ci.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),Ci||("colorCount"in Zi&&(bo=Zi.colorCount|0,z(bo>0,"invalid color buffer count")),"colorType"in Zi&&(z.oneOf(Zi.colorType,jr,"invalid color type"),Ma=Zi.colorType),"colorFormat"in Zi&&(ji=Zi.colorFormat,z.oneOf(Zi.colorFormat,Mr,"invalid color format for texture"))),"depth"in Zi&&(xn.depth=Zi.depth),"stencil"in Zi&&(xn.stencil=Zi.stencil),"depthStencil"in Zi&&(xn.depthStencil=Zi.depthStencil)}var ja;if(Ci)if(Array.isArray(Ci))for(ja=[],fn=0;fn<Ci.length;++fn)ja[fn]=Ci[fn];else ja=[Ci];else{ja=Array(bo);var Bo={radius:ci,format:ji,type:Ma};for(fn=0;fn<bo;++fn)ja[fn]=tr.createCube(Bo)}for(xn.color=Array(ja.length),fn=0;fn<ja.length;++fn){var Po=ja[fn];z(typeof Po=="function"&&Po._reglType==="textureCube","invalid cube map"),ci=ci||Po.width,z(Po.width===ci&&Po.height===ci,"invalid cube map shape"),xn.color[fn]={target:Sl,data:ja[fn]}}for(fn=0;fn<6;++fn){for(var is=0;is<ja.length;++is)xn.color[is].target=Sl+fn;fn>0&&(xn.depth=vn[0].depth,xn.stencil=vn[0].stencil,xn.depthStencil=vn[0].depthStencil),vn[fn]?vn[fn](xn):vn[fn]=Cr(xn)}return y(pn,{width:ci,height:ci,color:ja})}function Mi(mi){var fn,xn=mi|0;if(z(xn>0&&xn<=$e.maxCubeMapSize,"invalid radius for cube fbo"),xn===pn.width)return pn;var ci=pn.color;for(fn=0;fn<ci.length;++fn)ci[fn].resize(xn);for(fn=0;fn<6;++fn)vn[fn].resize(xn);return pn.width=pn.height=xn,pn}return pn(Vr),y(pn,{faces:vn,resize:Mi,_reglType:"framebufferCube",destroy:function(){vn.forEach(function(mi){mi.destroy()})}})}function hn(){br.cur=null,br.next=null,br.dirty=!0,he(Tr).forEach(function(Vr){Vr.framebuffer=V.createFramebuffer(),Er(Vr)})}return y(br,{getFramebuffer:function(Vr){if(typeof Vr=="function"&&Vr._reglType==="framebuffer"){var vn=Vr._framebuffer;if(vn instanceof Jr)return vn}return null},create:Cr,createCube:Rn,clear:function(){he(Tr).forEach(ei)},restore:hn})}var Ze=5126,nt=34962,Fe=34963,at=["attributes","elements","offset","count","primitive","instances"];function yt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ze,this.offset=0,this.stride=0,this.divisor=0}function Ut(V,Te,$e,tr,wr,rr,br){for(var Mr=$e.maxAttributes,Nr=new Array(Mr),jr=0;jr<Mr;++jr)Nr[jr]=new yt;var qr=0,Kr={},cn={Record:yt,scope:{},state:Nr,currentVAO:null,targetVAO:null,restore:Yr()?yn:function(){},createVAO:ei,getVAO:cr,destroyBuffer:Ur,setVAO:Yr()?Gr:un,clear:Yr()?Tr:function(){}};function Ur(Er){for(var Cr=0;Cr<Nr.length;++Cr){var Rn=Nr[Cr];Rn.buffer===Er&&(V.disableVertexAttribArray(Cr),Rn.buffer=null)}}function Yr(){return Te.oes_vertex_array_object}function Lt(){return Te.angle_instanced_arrays}function cr(Er){return typeof Er=="function"&&Er._vao?Er._vao:null}function Gr(Er){if(Er!==cn.currentVAO){var Cr=Yr();Er?Cr.bindVertexArrayOES(Er.vao):Cr.bindVertexArrayOES(null),cn.currentVAO=Er}}function un(Er){if(Er!==cn.currentVAO){if(Er)Er.bindAttrs();else{for(var Cr=Lt(),Rn=0;Rn<Nr.length;++Rn){var hn=Nr[Rn];hn.buffer?(V.enableVertexAttribArray(Rn),hn.buffer.bind(),V.vertexAttribPointer(Rn,hn.size,hn.type,hn.normalized,hn.stride,hn.offfset),Cr&&hn.divisor&&Cr.vertexAttribDivisorANGLE(Rn,hn.divisor)):(V.disableVertexAttribArray(Rn),V.vertexAttrib4f(Rn,hn.x,hn.y,hn.z,hn.w))}br.elements?V.bindBuffer(Fe,br.elements.buffer.buffer):V.bindBuffer(Fe,null)}cn.currentVAO=Er}}function Tr(){he(Kr).forEach(function(Er){Er.destroy()})}function Jr(){this.id=++qr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Er=Yr();Er?this.vao=Er.createVertexArrayOES():this.vao=null,Kr[this.id]=this,this.buffers=[]}Jr.prototype.bindAttrs=function(){for(var Er=Lt(),Cr=this.attributes,Rn=0;Rn<Cr.length;++Rn){var hn=Cr[Rn];hn.buffer?(V.enableVertexAttribArray(Rn),V.bindBuffer(nt,hn.buffer.buffer),V.vertexAttribPointer(Rn,hn.size,hn.type,hn.normalized,hn.stride,hn.offset),Er&&hn.divisor&&Er.vertexAttribDivisorANGLE(Rn,hn.divisor)):(V.disableVertexAttribArray(Rn),V.vertexAttrib4f(Rn,hn.x,hn.y,hn.z,hn.w))}for(var Vr=Cr.length;Vr<Mr;++Vr)V.disableVertexAttribArray(Vr);var vn=rr.getElements(this.elements);vn?V.bindBuffer(Fe,vn.buffer.buffer):V.bindBuffer(Fe,null)},Jr.prototype.refresh=function(){var Er=Yr();Er&&(Er.bindVertexArrayOES(this.vao),this.bindAttrs(),cn.currentVAO=null,Er.bindVertexArrayOES(null))},Jr.prototype.destroy=function(){if(this.vao){var Er=Yr();this===cn.currentVAO&&(cn.currentVAO=null,Er.bindVertexArrayOES(null)),Er.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Kr[this.id]&&(delete Kr[this.id],tr.vaoCount-=1)};function yn(){var Er=Yr();Er&&he(Kr).forEach(function(Cr){Cr.refresh()})}function ei(Er){var Cr=new Jr;tr.vaoCount+=1;function Rn(hn){var Vr;if(Array.isArray(hn))Vr=hn,Cr.elements&&Cr.ownsElements&&Cr.elements.destroy(),Cr.elements=null,Cr.ownsElements=!1,Cr.offset=0,Cr.count=0,Cr.instances=-1,Cr.primitive=4;else{if(z(typeof hn=="object","invalid arguments for create vao"),z("attributes"in hn,"must specify attributes for vao"),hn.elements){var vn=hn.elements;Cr.ownsElements?typeof vn=="function"&&vn._reglType==="elements"?(Cr.elements.destroy(),Cr.ownsElements=!1):(Cr.elements(vn),Cr.ownsElements=!1):rr.getElements(hn.elements)?(Cr.elements=hn.elements,Cr.ownsElements=!1):(Cr.elements=rr.create(hn.elements),Cr.ownsElements=!0)}else Cr.elements=null,Cr.ownsElements=!1;Vr=hn.attributes,Cr.offset=0,Cr.count=-1,Cr.instances=-1,Cr.primitive=4,Cr.elements&&(Cr.count=Cr.elements._elements.vertCount,Cr.primitive=Cr.elements._elements.primType),"offset"in hn&&(Cr.offset=hn.offset|0),"count"in hn&&(Cr.count=hn.count|0),"instances"in hn&&(Cr.instances=hn.instances|0),"primitive"in hn&&(z(hn.primitive in Sr,"bad primitive type: "+hn.primitive),Cr.primitive=Sr[hn.primitive]),z.optional(function(){for(var Ma=Object.keys(hn),bo=0;bo<Ma.length;++bo)z(at.indexOf(Ma[bo])>=0,'invalid option for vao: "'+Ma[bo]+'" valid options are '+at)}),z(Array.isArray(Vr),"attributes must be an array")}z(Vr.length<Mr,"too many attributes"),z(Vr.length>0,"must specify at least one attribute");var pn={},Mi=Cr.attributes;Mi.length=Vr.length;for(var mi=0;mi<Vr.length;++mi){var fn=Vr[mi],xn=Mi[mi]=new yt,ci=fn.data||fn;if(Array.isArray(ci)||re(ci)||Jo(ci)){var Ci;Cr.buffers[mi]&&(Ci=Cr.buffers[mi],re(ci)&&Ci._buffer.byteLength>=ci.byteLength?Ci.subdata(ci):(Ci.destroy(),Cr.buffers[mi]=null)),Cr.buffers[mi]||(Ci=Cr.buffers[mi]=wr.create(fn,nt,!1,!0)),xn.buffer=wr.getBuffer(Ci),xn.size=xn.buffer.dimension|0,xn.normalized=!1,xn.type=xn.buffer.dtype,xn.offset=0,xn.stride=0,xn.divisor=0,xn.state=1,pn[mi]=1}else wr.getBuffer(fn)?(xn.buffer=wr.getBuffer(fn),xn.size=xn.buffer.dimension|0,xn.normalized=!1,xn.type=xn.buffer.dtype,xn.offset=0,xn.stride=0,xn.divisor=0,xn.state=1):wr.getBuffer(fn.buffer)?(xn.buffer=wr.getBuffer(fn.buffer),xn.size=(+fn.size||xn.buffer.dimension)|0,xn.normalized=!!fn.normalized||!1,"type"in fn?(z.parameter(fn.type,vu,"invalid buffer type"),xn.type=vu[fn.type]):xn.type=xn.buffer.dtype,xn.offset=(fn.offset||0)|0,xn.stride=(fn.stride||0)|0,xn.divisor=(fn.divisor||0)|0,xn.state=1,z(xn.size>=1&&xn.size<=4,"size must be between 1 and 4"),z(xn.offset>=0,"invalid offset"),z(xn.stride>=0&&xn.stride<=255,"stride must be between 0 and 255"),z(xn.divisor>=0,"divisor must be positive"),z(!xn.divisor||!!Te.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in fn?(z(mi>0,"first attribute must not be a constant"),xn.x=+fn.x||0,xn.y=+fn.y||0,xn.z=+fn.z||0,xn.w=+fn.w||0,xn.state=2):z(!1,"invalid attribute spec for location "+mi)}for(var ji=0;ji<Cr.buffers.length;++ji)!pn[ji]&&Cr.buffers[ji]&&(Cr.buffers[ji].destroy(),Cr.buffers[ji]=null);return Cr.refresh(),Rn}return Rn.destroy=function(){for(var hn=0;hn<Cr.buffers.length;++hn)Cr.buffers[hn]&&Cr.buffers[hn].destroy();Cr.buffers.length=0,Cr.ownsElements&&(Cr.elements.destroy(),Cr.elements=null,Cr.ownsElements=!1),Cr.destroy()},Rn._vao=Cr,Rn._reglType="vao",Rn(Er)}return cn}var Zt=35632,Ct=35633,yr=35718,Et=35721;function Qr(V,Te,$e,tr){var wr={},rr={};function br(Lt,cr,Gr,un){this.name=Lt,this.id=cr,this.location=Gr,this.info=un}function Mr(Lt,cr){for(var Gr=0;Gr<Lt.length;++Gr)if(Lt[Gr].id===cr.id){Lt[Gr].location=cr.location;return}Lt.push(cr)}function Nr(Lt,cr,Gr){var un=Lt===Zt?wr:rr,Tr=un[cr];if(!Tr){var Jr=Te.str(cr);Tr=V.createShader(Lt),V.shaderSource(Tr,Jr),V.compileShader(Tr),z.shaderError(V,Tr,Jr,Lt,Gr),un[cr]=Tr}return Tr}var jr={},qr=[],Kr=0;function cn(Lt,cr){this.id=Kr++,this.fragId=Lt,this.vertId=cr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,tr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ur(Lt,cr,Gr){var un,Tr,Jr=Nr(Zt,Lt.fragId),yn=Nr(Ct,Lt.vertId),ei=Lt.program=V.createProgram();if(V.attachShader(ei,Jr),V.attachShader(ei,yn),Gr)for(un=0;un<Gr.length;++un){var Er=Gr[un];V.bindAttribLocation(ei,Er[0],Er[1])}V.linkProgram(ei),z.linkError(V,ei,Te.str(Lt.fragId),Te.str(Lt.vertId),cr);var Cr=V.getProgramParameter(ei,yr);tr.profile&&(Lt.stats.uniformsCount=Cr);var Rn=Lt.uniforms;for(un=0;un<Cr;++un)if(Tr=V.getActiveUniform(ei,un),Tr)if(Tr.size>1)for(var hn=0;hn<Tr.size;++hn){var Vr=Tr.name.replace("[0]","["+hn+"]");Mr(Rn,new br(Vr,Te.id(Vr),V.getUniformLocation(ei,Vr),Tr))}else Mr(Rn,new br(Tr.name,Te.id(Tr.name),V.getUniformLocation(ei,Tr.name),Tr));var vn=V.getProgramParameter(ei,Et);tr.profile&&(Lt.stats.attributesCount=vn);var pn=Lt.attributes;for(un=0;un<vn;++un)Tr=V.getActiveAttrib(ei,un),Tr&&Mr(pn,new br(Tr.name,Te.id(Tr.name),V.getAttribLocation(ei,Tr.name),Tr))}tr.profile&&($e.getMaxUniformsCount=function(){var Lt=0;return qr.forEach(function(cr){cr.stats.uniformsCount>Lt&&(Lt=cr.stats.uniformsCount)}),Lt},$e.getMaxAttributesCount=function(){var Lt=0;return qr.forEach(function(cr){cr.stats.attributesCount>Lt&&(Lt=cr.stats.attributesCount)}),Lt});function Yr(){wr={},rr={};for(var Lt=0;Lt<qr.length;++Lt)Ur(qr[Lt],null,qr[Lt].attributes.map(function(cr){return[cr.location,cr.name]}))}return{clear:function(){var Lt=V.deleteShader.bind(V);he(wr).forEach(Lt),wr={},he(rr).forEach(Lt),rr={},qr.forEach(function(cr){V.deleteProgram(cr.program)}),qr.length=0,jr={},$e.shaderCount=0},program:function(Lt,cr,Gr,un){z.command(Lt>=0,"missing vertex shader",Gr),z.command(cr>=0,"missing fragment shader",Gr);var Tr=jr[cr];Tr||(Tr=jr[cr]={});var Jr=Tr[Lt];if(Jr&&(Jr.refCount++,!un))return Jr;var yn=new cn(cr,Lt);return $e.shaderCount++,Ur(yn,Gr,un),Jr||(Tr[Lt]=yn),qr.push(yn),y(yn,{destroy:function(){if(yn.refCount--,yn.refCount<=0){V.deleteProgram(yn.program);var ei=qr.indexOf(yn);qr.splice(ei,1),$e.shaderCount--}Tr[yn.vertId].refCount<=0&&(V.deleteShader(rr[yn.vertId]),delete rr[yn.vertId],delete jr[yn.fragId][yn.vertId]),Object.keys(jr[yn.fragId]).length||(V.deleteShader(wr[yn.fragId]),delete wr[yn.fragId],delete jr[yn.fragId])}})},restore:Yr,shader:Nr,frag:-1,vert:-1}}var Hr=6408,An=5121,Qn=3333,Jn=5126;function ni(V,Te,$e,tr,wr,rr,br){function Mr(qr){var Kr;Te.next===null?(z(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Kr=An):(z(Te.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Kr=Te.next.colorAttachments[0].texture._texture.type,z.optional(function(){rr.oes_texture_float?(z(Kr===An||Kr===Jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Kr===Jn&&z(br.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):z(Kr===An,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var cn=0,Ur=0,Yr=tr.framebufferWidth,Lt=tr.framebufferHeight,cr=null;re(qr)?cr=qr:qr&&(z.type(qr,"object","invalid arguments to regl.read()"),cn=qr.x|0,Ur=qr.y|0,z(cn>=0&&cn<tr.framebufferWidth,"invalid x offset for regl.read"),z(Ur>=0&&Ur<tr.framebufferHeight,"invalid y offset for regl.read"),Yr=(qr.width||tr.framebufferWidth-cn)|0,Lt=(qr.height||tr.framebufferHeight-Ur)|0,cr=qr.data||null),cr&&(Kr===An?z(cr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Kr===Jn&&z(cr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),z(Yr>0&&Yr+cn<=tr.framebufferWidth,"invalid width for read pixels"),z(Lt>0&&Lt+Ur<=tr.framebufferHeight,"invalid height for read pixels"),$e();var Gr=Yr*Lt*4;return cr||(Kr===An?cr=new Uint8Array(Gr):Kr===Jn&&(cr=cr||new Float32Array(Gr))),z.isTypedArray(cr,"data buffer for regl.read() must be a typedarray"),z(cr.byteLength>=Gr,"data buffer for regl.read() too small"),V.pixelStorei(Qn,4),V.readPixels(cn,Ur,Yr,Lt,Hr,Kr,cr),cr}function Nr(qr){var Kr;return Te.setFBO({framebuffer:qr.framebuffer},function(){Kr=Mr(qr)}),Kr}function jr(qr){return!qr||!("framebuffer"in qr)?Mr(qr):Nr(qr)}return jr}function Xi(V){return Array.prototype.slice.call(V)}function wn(V){return Xi(V).join("")}function Si(){var V=0,Te=[],$e=[];function tr(Kr){for(var cn=0;cn<$e.length;++cn)if($e[cn]===Kr)return Te[cn];var Ur="g"+V++;return Te.push(Ur),$e.push(Kr),Ur}function wr(){var Kr=[];function cn(){Kr.push.apply(Kr,Xi(arguments))}var Ur=[];function Yr(){var Lt="v"+V++;return Ur.push(Lt),arguments.length>0&&(Kr.push(Lt,"="),Kr.push.apply(Kr,Xi(arguments)),Kr.push(";")),Lt}return y(cn,{def:Yr,toString:function(){return wn([Ur.length>0?"var "+Ur.join(",")+";":"",wn(Kr)])}})}function rr(){var Kr=wr(),cn=wr(),Ur=Kr.toString,Yr=cn.toString;function Lt(cr,Gr){cn(cr,Gr,"=",Kr.def(cr,Gr),";")}return y(function(){Kr.apply(Kr,Xi(arguments))},{def:Kr.def,entry:Kr,exit:cn,save:Lt,set:function(cr,Gr,un){Lt(cr,Gr),Kr(cr,Gr,"=",un,";")},toString:function(){return Ur()+Yr()}})}function br(){var Kr=wn(arguments),cn=rr(),Ur=rr(),Yr=cn.toString,Lt=Ur.toString;return y(cn,{then:function(){return cn.apply(cn,Xi(arguments)),this},else:function(){return Ur.apply(Ur,Xi(arguments)),this},toString:function(){var cr=Lt();return cr&&(cr="else{"+cr+"}"),wn(["if(",Kr,"){",Yr(),"}",cr])}})}var Mr=wr(),Nr={};function jr(Kr,cn){var Ur=[];function Yr(){var Tr="a"+Ur.length;return Ur.push(Tr),Tr}cn=cn||0;for(var Lt=0;Lt<cn;++Lt)Yr();var cr=rr(),Gr=cr.toString,un=Nr[Kr]=y(cr,{arg:Yr,toString:function(){return wn(["function(",Ur.join(),"){",Gr(),"}"])}});return un}function qr(){var Kr=['"use strict";',Mr,"return {"];Object.keys(Nr).forEach(function(Lt){Kr.push('"',Lt,'":',Nr[Lt].toString(),",")}),Kr.push("}");var cn=wn(Kr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ur=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Yr=Ur?Ae.Function.apply(null,Te.concat(cn)):Function.apply(null,Te.concat(cn));return Yr.apply(null,$e)}return{global:Mr,link:tr,block:wr,proc:jr,scope:rr,cond:br,compile:qr}}var Ai="xyzw".split(""),vi=5121,ai=1,wi=2,li=0,oi=1,xo=2,Ja=3,Io=4,Wo=5,eo=6,to="dither",Ps="blend.enable",hs="blend.color",Gu="blend.equation",Es="blend.func",Ls="depth.enable",Qs="depth.func",xc="depth.range",ql="depth.mask",Hu="colorMask",il="cull.enable",bc="cull.face",Xo="frontFace",Al="lineWidth",Wu="polygonOffset.enable",ko="polygonOffset.offset",al="sample.alpha",wl="sample.enable",Xu="sample.coverage",oa="stencil.enable",fu="stencil.mask",Rs="stencil.func",ol="stencil.opFront",rf="stencil.opBack",nf="scissor.enable",Df="scissor.box",hu="viewport",Ec="profile",bu="framebuffer",Pu="vert",Sc="frag",Lu="elements",Yo="primitive",Cc="count",Ff="offset",Bf="instances",Nh="vao",wp="Width",Tp="Height",Ac=bu+wp,oh=bu+Tp,Mp=hu+wp,zh=hu+Tp,sl="drawingBuffer",wc=sl+wp,Zh=sl+Tp,$d=[Es,Gu,Rs,ol,rf,Xu,hu,Df,ko],Us=34962,Y=34963,$r=35632,Uh=35633,qd=3553,$o=34067,Tc=2884,ul=3042,Ip=3024,Xa=2960,Kl=2929,Vh=3089,kp=32823,jh=32926,af=32928,of=5126,Nf=35664,Mc=35665,zf=35666,sh=5124,uh=35667,Ql=35668,Gh=35669,sf=35670,lh=35671,Zf=35672,Uf=35673,pu=35674,Jl=35675,ch=35676,fh=35678,hh=35680,Hh=4,Tl=1028,ec=1029,Ic=2304,kc=2305,Kd=32775,Qd=32776,ph=519,Os=7680,Eu=0,Wh=1,uf=32774,Yu=513,dh=36160,Jd=36064,Ml={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Vf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Pc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Il={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},jf={frag:$r,vert:Uh},ud={cw:Ic,ccw:kc};function vh(V){return Array.isArray(V)||re(V)||Jo(V)}function Pp(V){return V.sort(function(Te,$e){return Te===hu?-1:$e===hu?1:Te<$e?-1:1})}function Sa(V,Te,$e,tr){this.thisDep=V,this.contextDep=Te,this.propDep=$e,this.append=tr}function Lc(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function Fo(V){return new Sa(!1,!1,!1,V)}function Vs(V,Te){var $e=V.type;if($e===li){var tr=V.data.length;return new Sa(!0,tr>=1,tr>=2,Te)}else if($e===Io){var wr=V.data;return new Sa(wr.thisDep,wr.contextDep,wr.propDep,Te)}else{if($e===Wo)return new Sa(!1,!1,!1,Te);if($e===eo){for(var rr=!1,br=!1,Mr=!1,Nr=0;Nr<V.data.length;++Nr){var jr=V.data[Nr];if(jr.type===oi)Mr=!0;else if(jr.type===xo)br=!0;else if(jr.type===Ja)rr=!0;else if(jr.type===li){rr=!0;var qr=jr.data;qr>=1&&(br=!0),qr>=2&&(Mr=!0)}else jr.type===Io&&(rr=rr||jr.data.thisDep,br=br||jr.data.contextDep,Mr=Mr||jr.data.propDep)}return new Sa(rr,br,Mr,Te)}else return new Sa($e===Ja,$e===xo,$e===oi,Te)}}var Lp=new Sa(!1,!1,!1,function(){});function ld(V,Te,$e,tr,wr,rr,br,Mr,Nr,jr,qr,Kr,cn,Ur,Yr){var Lt=jr.Record,cr={add:32774,subtract:32778,"reverse subtract":32779};$e.ext_blend_minmax&&(cr.min=Kd,cr.max=Qd);var Gr=$e.angle_instanced_arrays,un=$e.webgl_draw_buffers,Tr=$e.oes_vertex_array_object,Jr={dirty:!0,profile:Yr.profile},yn={},ei=[],Er={},Cr={};function Rn(De){return De.replace(".","_")}function hn(De,ye,ot){var Ot=Rn(De);ei.push(De),yn[Ot]=Jr[Ot]=!!ot,Er[Ot]=ye}function Vr(De,ye,ot){var Ot=Rn(De);ei.push(De),Array.isArray(ot)?(Jr[Ot]=ot.slice(),yn[Ot]=ot.slice()):Jr[Ot]=yn[Ot]=ot,Cr[Ot]=ye}hn(to,Ip),hn(Ps,ul),Vr(hs,"blendColor",[0,0,0,0]),Vr(Gu,"blendEquationSeparate",[uf,uf]),Vr(Es,"blendFuncSeparate",[Wh,Eu,Wh,Eu]),hn(Ls,Kl,!0),Vr(Qs,"depthFunc",Yu),Vr(xc,"depthRange",[0,1]),Vr(ql,"depthMask",!0),Vr(Hu,Hu,[!0,!0,!0,!0]),hn(il,Tc),Vr(bc,"cullFace",ec),Vr(Xo,Xo,kc),Vr(Al,Al,1),hn(Wu,kp),Vr(ko,"polygonOffset",[0,0]),hn(al,jh),hn(wl,af),Vr(Xu,"sampleCoverage",[1,!1]),hn(oa,Xa),Vr(fu,"stencilMask",-1),Vr(Rs,"stencilFunc",[ph,0,-1]),Vr(ol,"stencilOpSeparate",[Tl,Os,Os,Os]),Vr(rf,"stencilOpSeparate",[ec,Os,Os,Os]),hn(nf,Vh),Vr(Df,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),Vr(hu,hu,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var vn={gl:V,context:cn,strings:Te,next:yn,current:Jr,draw:Kr,elements:rr,buffer:wr,shader:qr,attributes:jr.state,vao:jr,uniforms:Nr,framebuffer:Mr,extensions:$e,timer:Ur,isBufferArgs:vh},pn={primTypes:Sr,compareFuncs:Pc,blendFuncs:Ml,blendEquations:cr,stencilOps:Il,glTypes:vu,orientationType:ud};z.optional(function(){vn.isArrayLike=yo}),un&&(pn.backBuffer=[ec],pn.drawBuffer=rt(tr.maxDrawbuffers,function(De){return De===0?[0]:rt(De,function(ye){return Jd+ye})}));var Mi=0;function mi(){var De=Si(),ye=De.link,ot=De.global;De.id=Mi++,De.batchId="0";var Ot=ye(vn),Kt=De.shared={props:"a0"};Object.keys(vn).forEach(function(tt){Kt[tt]=ot.def(Ot,".",tt)}),z.optional(function(){De.CHECK=ye(z),De.commandStr=z.guessCommand(),De.command=ye(De.commandStr),De.assert=function(tt,Be,Dt){tt("if(!(",Be,"))",this.CHECK,".commandRaise(",ye(Dt),",",this.command,");")},pn.invalidBlendCombinations=Vf});var ct=De.next={},Ye=De.current={};Object.keys(Cr).forEach(function(tt){Array.isArray(Jr[tt])&&(ct[tt]=ot.def(Kt.next,".",tt),Ye[tt]=ot.def(Kt.current,".",tt))});var St=De.constants={};Object.keys(pn).forEach(function(tt){St[tt]=ot.def(JSON.stringify(pn[tt]))}),De.invoke=function(tt,Be){switch(Be.type){case li:var Dt=["this",Kt.context,Kt.props,De.batchId];return tt.def(ye(Be.data),".call(",Dt.slice(0,Math.max(Be.data.length+1,4)),")");case oi:return tt.def(Kt.props,Be.data);case xo:return tt.def(Kt.context,Be.data);case Ja:return tt.def("this",Be.data);case Io:return Be.data.append(De,tt),Be.data.ref;case Wo:return Be.data.toString();case eo:return Be.data.map(function(Ht){return De.invoke(tt,Ht)})}},De.attribCache={};var Me={};return De.scopeAttrib=function(tt){var Be=Te.id(tt);if(Be in Me)return Me[Be];var Dt=jr.scope[Be];Dt||(Dt=jr.scope[Be]=new Lt);var Ht=Me[Be]=ye(Dt);return Ht},De}function fn(De){var ye=De.static,ot=De.dynamic,Ot;if(Ec in ye){var Kt=!!ye[Ec];Ot=Fo(function(Ye,St){return Kt}),Ot.enable=Kt}else if(Ec in ot){var ct=ot[Ec];Ot=Vs(ct,function(Ye,St){return Ye.invoke(St,ct)})}return Ot}function xn(De,ye){var ot=De.static,Ot=De.dynamic;if(bu in ot){var Kt=ot[bu];return Kt?(Kt=Mr.getFramebuffer(Kt),z.command(Kt,"invalid framebuffer object"),Fo(function(Ye,St){var Me=Ye.link(Kt),tt=Ye.shared;St.set(tt.framebuffer,".next",Me);var Be=tt.context;return St.set(Be,"."+Ac,Me+".width"),St.set(Be,"."+oh,Me+".height"),Me})):Fo(function(Ye,St){var Me=Ye.shared;St.set(Me.framebuffer,".next","null");var tt=Me.context;return St.set(tt,"."+Ac,tt+"."+wc),St.set(tt,"."+oh,tt+"."+Zh),"null"})}else if(bu in Ot){var ct=Ot[bu];return Vs(ct,function(Ye,St){var Me=Ye.invoke(St,ct),tt=Ye.shared,Be=tt.framebuffer,Dt=St.def(Be,".getFramebuffer(",Me,")");z.optional(function(){Ye.assert(St,"!"+Me+"||"+Dt,"invalid framebuffer object")}),St.set(Be,".next",Dt);var Ht=tt.context;return St.set(Ht,"."+Ac,Dt+"?"+Dt+".width:"+Ht+"."+wc),St.set(Ht,"."+oh,Dt+"?"+Dt+".height:"+Ht+"."+Zh),Dt})}else return null}function ci(De,ye,ot){var Ot=De.static,Kt=De.dynamic;function ct(Me){if(Me in Ot){var tt=Ot[Me];z.commandType(tt,"object","invalid "+Me,ot.commandStr);var Be=!0,Dt=tt.x|0,Ht=tt.y|0,Ir,on;return"width"in tt?(Ir=tt.width|0,z.command(Ir>=0,"invalid "+Me,ot.commandStr)):Be=!1,"height"in tt?(on=tt.height|0,z.command(on>=0,"invalid "+Me,ot.commandStr)):Be=!1,new Sa(!Be&&ye&&ye.thisDep,!Be&&ye&&ye.contextDep,!Be&&ye&&ye.propDep,function(nn,zn){var Tn=nn.shared.context,Bn=Ir;"width"in tt||(Bn=zn.def(Tn,".",Ac,"-",Dt));var En=on;return"height"in tt||(En=zn.def(Tn,".",oh,"-",Ht)),[Dt,Ht,Bn,En]})}else if(Me in Kt){var ln=Kt[Me],bn=Vs(ln,function(nn,zn){var Tn=nn.invoke(zn,ln);z.optional(function(){nn.assert(zn,Tn+"&&typeof "+Tn+'==="object"',"invalid "+Me)});var Bn=nn.shared.context,En=zn.def(Tn,".x|0"),Ln=zn.def(Tn,".y|0"),pi=zn.def('"width" in ',Tn,"?",Tn,".width|0:","(",Bn,".",Ac,"-",En,")"),Ca=zn.def('"height" in ',Tn,"?",Tn,".height|0:","(",Bn,".",oh,"-",Ln,")");return z.optional(function(){nn.assert(zn,pi+">=0&&"+Ca+">=0","invalid "+Me)}),[En,Ln,pi,Ca]});return ye&&(bn.thisDep=bn.thisDep||ye.thisDep,bn.contextDep=bn.contextDep||ye.contextDep,bn.propDep=bn.propDep||ye.propDep),bn}else return ye?new Sa(ye.thisDep,ye.contextDep,ye.propDep,function(nn,zn){var Tn=nn.shared.context;return[0,0,zn.def(Tn,".",Ac),zn.def(Tn,".",oh)]}):null}var Ye=ct(hu);if(Ye){var St=Ye;Ye=new Sa(Ye.thisDep,Ye.contextDep,Ye.propDep,function(Me,tt){var Be=St.append(Me,tt),Dt=Me.shared.context;return tt.set(Dt,"."+Mp,Be[2]),tt.set(Dt,"."+zh,Be[3]),Be})}return{viewport:Ye,scissor_box:ct(Df)}}function Ci(De,ye){var ot=De.static,Ot=typeof ot[Sc]=="string"&&typeof ot[Pu]=="string";if(Ot){if(Object.keys(ye.dynamic).length>0)return null;var Kt=ye.static,ct=Object.keys(Kt);if(ct.length>0&&typeof Kt[ct[0]]=="number"){for(var Ye=[],St=0;St<ct.length;++St)z(typeof Kt[ct[St]]=="number","must specify all vertex attribute locations when using vaos"),Ye.push([Kt[ct[St]]|0,ct[St]]);return Ye}}return null}function ji(De,ye,ot){var Ot=De.static,Kt=De.dynamic;function ct(Be){if(Be in Ot){var Dt=Te.id(Ot[Be]);z.optional(function(){qr.shader(jf[Be],Dt,z.guessCommand())});var Ht=Fo(function(){return Dt});return Ht.id=Dt,Ht}else if(Be in Kt){var Ir=Kt[Be];return Vs(Ir,function(on,ln){var bn=on.invoke(ln,Ir),nn=ln.def(on.shared.strings,".id(",bn,")");return z.optional(function(){ln(on.shared.shader,".shader(",jf[Be],",",nn,",",on.command,");")}),nn})}return null}var Ye=ct(Sc),St=ct(Pu),Me=null,tt;return Lc(Ye)&&Lc(St)?(Me=qr.program(St.id,Ye.id,null,ot),tt=Fo(function(Be,Dt){return Be.link(Me)})):tt=new Sa(Ye&&Ye.thisDep||St&&St.thisDep,Ye&&Ye.contextDep||St&&St.contextDep,Ye&&Ye.propDep||St&&St.propDep,function(Be,Dt){var Ht=Be.shared.shader,Ir;Ye?Ir=Ye.append(Be,Dt):Ir=Dt.def(Ht,".",Sc);var on;St?on=St.append(Be,Dt):on=Dt.def(Ht,".",Pu);var ln=Ht+".program("+on+","+Ir;return z.optional(function(){ln+=","+Be.command}),Dt.def(ln+")")}),{frag:Ye,vert:St,progVar:tt,program:Me}}function Ma(De,ye){var ot=De.static,Ot=De.dynamic,Kt={},ct=!1;function Ye(){if(Nh in ot){var zn=ot[Nh];return zn!==null&&jr.getVAO(zn)===null&&(zn=jr.createVAO(zn)),ct=!0,Kt.vao=zn,Fo(function(Bn){var En=jr.getVAO(zn);return En?Bn.link(En):"null"})}else if(Nh in Ot){ct=!0;var Tn=Ot[Nh];return Vs(Tn,function(Bn,En){var Ln=Bn.invoke(En,Tn);return En.def(Bn.shared.vao+".getVAO("+Ln+")")})}return null}var St=Ye(),Me=!1;function tt(){if(Lu in ot){var zn=ot[Lu];if(Kt.elements=zn,vh(zn)){var Tn=Kt.elements=rr.create(zn,!0);zn=rr.getElements(Tn),Me=!0}else zn&&(zn=rr.getElements(zn),Me=!0,z.command(zn,"invalid elements",ye.commandStr));var Bn=Fo(function(Ln,pi){if(zn){var Ca=Ln.link(zn);return Ln.ELEMENTS=Ca,Ca}return Ln.ELEMENTS=null,null});return Bn.value=zn,Bn}else if(Lu in Ot){Me=!0;var En=Ot[Lu];return Vs(En,function(Ln,pi){var Ca=Ln.shared,vs=Ca.isBufferArgs,Ga=Ca.elements,ha=Ln.invoke(pi,En),kl=pi.def("null"),Ds=pi.def(vs,"(",ha,")"),ll=Ln.cond(Ds).then(kl,"=",Ga,".createStream(",ha,");").else(kl,"=",Ga,".getElements(",ha,");");return z.optional(function(){Ln.assert(ll.else,"!"+ha+"||"+kl,"invalid elements")}),pi.entry(ll),pi.exit(Ln.cond(Ds).then(Ga,".destroyStream(",kl,");")),Ln.ELEMENTS=kl,kl})}else if(ct)return new Sa(St.thisDep,St.contextDep,St.propDep,function(Ln,pi){return pi.def(Ln.shared.vao+".currentVAO?"+Ln.shared.elements+".getElements("+Ln.shared.vao+".currentVAO.elements):null")});return null}var Be=tt();function Dt(){if(Yo in ot){var zn=ot[Yo];return Kt.primitive=zn,z.commandParameter(zn,Sr,"invalid primitve",ye.commandStr),Fo(function(Bn,En){return Sr[zn]})}else if(Yo in Ot){var Tn=Ot[Yo];return Vs(Tn,function(Bn,En){var Ln=Bn.constants.primTypes,pi=Bn.invoke(En,Tn);return z.optional(function(){Bn.assert(En,pi+" in "+Ln,"invalid primitive, must be one of "+Object.keys(Sr))}),En.def(Ln,"[",pi,"]")})}else{if(Me)return Lc(Be)?Be.value?Fo(function(Bn,En){return En.def(Bn.ELEMENTS,".primType")}):Fo(function(){return Hh}):new Sa(Be.thisDep,Be.contextDep,Be.propDep,function(Bn,En){var Ln=Bn.ELEMENTS;return En.def(Ln,"?",Ln,".primType:",Hh)});if(ct)return new Sa(St.thisDep,St.contextDep,St.propDep,function(Bn,En){return En.def(Bn.shared.vao+".currentVAO?"+Bn.shared.vao+".currentVAO.primitive:"+Hh)})}return null}function Ht(zn,Tn){if(zn in ot){var Bn=ot[zn]|0;return Tn?Kt.offset=Bn:Kt.instances=Bn,z.command(!Tn||Bn>=0,"invalid "+zn,ye.commandStr),Fo(function(Ln,pi){return Tn&&(Ln.OFFSET=Bn),Bn})}else if(zn in Ot){var En=Ot[zn];return Vs(En,function(Ln,pi){var Ca=Ln.invoke(pi,En);return Tn&&(Ln.OFFSET=Ca,z.optional(function(){Ln.assert(pi,Ca+">=0","invalid "+zn)})),Ca})}else if(Tn){if(Me)return Fo(function(Ln,pi){return Ln.OFFSET=0,0});if(ct)return new Sa(St.thisDep,St.contextDep,St.propDep,function(Ln,pi){return pi.def(Ln.shared.vao+".currentVAO?"+Ln.shared.vao+".currentVAO.offset:0")})}else if(ct)return new Sa(St.thisDep,St.contextDep,St.propDep,function(Ln,pi){return pi.def(Ln.shared.vao+".currentVAO?"+Ln.shared.vao+".currentVAO.instances:-1")});return null}var Ir=Ht(Ff,!0);function on(){if(Cc in ot){var zn=ot[Cc]|0;return Kt.count=zn,z.command(typeof zn=="number"&&zn>=0,"invalid vertex count",ye.commandStr),Fo(function(){return zn})}else if(Cc in Ot){var Tn=Ot[Cc];return Vs(Tn,function(pi,Ca){var vs=pi.invoke(Ca,Tn);return z.optional(function(){pi.assert(Ca,"typeof "+vs+'==="number"&&'+vs+">=0&&"+vs+"===("+vs+"|0)","invalid vertex count")}),vs})}else if(Me)if(Lc(Be)){if(Be)return Ir?new Sa(Ir.thisDep,Ir.contextDep,Ir.propDep,function(pi,Ca){var vs=Ca.def(pi.ELEMENTS,".vertCount-",pi.OFFSET);return z.optional(function(){pi.assert(Ca,vs+">=0","invalid vertex offset/element buffer too small")}),vs}):Fo(function(pi,Ca){return Ca.def(pi.ELEMENTS,".vertCount")});var Bn=Fo(function(){return-1});return z.optional(function(){Bn.MISSING=!0}),Bn}else{var En=new Sa(Be.thisDep||Ir.thisDep,Be.contextDep||Ir.contextDep,Be.propDep||Ir.propDep,function(pi,Ca){var vs=pi.ELEMENTS;return pi.OFFSET?Ca.def(vs,"?",vs,".vertCount-",pi.OFFSET,":-1"):Ca.def(vs,"?",vs,".vertCount:-1")});return z.optional(function(){En.DYNAMIC=!0}),En}else if(ct){var Ln=new Sa(St.thisDep,St.contextDep,St.propDep,function(pi,Ca){return Ca.def(pi.shared.vao,".currentVAO?",pi.shared.vao,".currentVAO.count:-1")});return Ln}return null}var ln=Dt(),bn=on(),nn=Ht(Bf,!1);return{elements:Be,primitive:ln,count:bn,instances:nn,offset:Ir,vao:St,vaoActive:ct,elementsActive:Me,static:Kt}}function bo(De,ye){var ot=De.static,Ot=De.dynamic,Kt={};return ei.forEach(function(ct){var Ye=Rn(ct);function St(Me,tt){if(ct in ot){var Be=Me(ot[ct]);Kt[Ye]=Fo(function(){return Be})}else if(ct in Ot){var Dt=Ot[ct];Kt[Ye]=Vs(Dt,function(Ht,Ir){return tt(Ht,Ir,Ht.invoke(Ir,Dt))})}}switch(ct){case il:case Ps:case to:case oa:case Ls:case nf:case Wu:case al:case wl:case ql:return St(function(Me){return z.commandType(Me,"boolean",ct,ye.commandStr),Me},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,"typeof "+Be+'==="boolean"',"invalid flag "+ct,Me.commandStr)}),Be});case Qs:return St(function(Me){return z.commandParameter(Me,Pc,"invalid "+ct,ye.commandStr),Pc[Me]},function(Me,tt,Be){var Dt=Me.constants.compareFuncs;return z.optional(function(){Me.assert(tt,Be+" in "+Dt,"invalid "+ct+", must be one of "+Object.keys(Pc))}),tt.def(Dt,"[",Be,"]")});case xc:return St(function(Me){return z.command(yo(Me)&&Me.length===2&&typeof Me[0]=="number"&&typeof Me[1]=="number"&&Me[0]<=Me[1],"depth range is 2d array",ye.commandStr),Me},function(Me,tt,Be){z.optional(function(){Me.assert(tt,Me.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var Dt=tt.def("+",Be,"[0]"),Ht=tt.def("+",Be,"[1]");return[Dt,Ht]});case Es:return St(function(Me){z.commandType(Me,"object","blend.func",ye.commandStr);var tt="srcRGB"in Me?Me.srcRGB:Me.src,Be="srcAlpha"in Me?Me.srcAlpha:Me.src,Dt="dstRGB"in Me?Me.dstRGB:Me.dst,Ht="dstAlpha"in Me?Me.dstAlpha:Me.dst;return z.commandParameter(tt,Ml,Ye+".srcRGB",ye.commandStr),z.commandParameter(Be,Ml,Ye+".srcAlpha",ye.commandStr),z.commandParameter(Dt,Ml,Ye+".dstRGB",ye.commandStr),z.commandParameter(Ht,Ml,Ye+".dstAlpha",ye.commandStr),z.command(Vf.indexOf(tt+", "+Dt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+tt+", "+Dt+")",ye.commandStr),[Ml[tt],Ml[Dt],Ml[Be],Ml[Ht]]},function(Me,tt,Be){var Dt=Me.constants.blendFuncs;z.optional(function(){Me.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function Ht(Tn,Bn){var En=tt.def('"',Tn,Bn,'" in ',Be,"?",Be,".",Tn,Bn,":",Be,".",Tn);return z.optional(function(){Me.assert(tt,En+" in "+Dt,"invalid "+ct+"."+Tn+Bn+", must be one of "+Object.keys(Ml))}),En}var Ir=Ht("src","RGB"),on=Ht("dst","RGB");z.optional(function(){var Tn=Me.constants.invalidBlendCombinations;Me.assert(tt,Tn+".indexOf("+Ir+'+", "+'+on+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ln=tt.def(Dt,"[",Ir,"]"),bn=tt.def(Dt,"[",Ht("src","Alpha"),"]"),nn=tt.def(Dt,"[",on,"]"),zn=tt.def(Dt,"[",Ht("dst","Alpha"),"]");return[ln,nn,bn,zn]});case Gu:return St(function(Me){if(typeof Me=="string")return z.commandParameter(Me,cr,"invalid "+ct,ye.commandStr),[cr[Me],cr[Me]];if(typeof Me=="object")return z.commandParameter(Me.rgb,cr,ct+".rgb",ye.commandStr),z.commandParameter(Me.alpha,cr,ct+".alpha",ye.commandStr),[cr[Me.rgb],cr[Me.alpha]];z.commandRaise("invalid blend.equation",ye.commandStr)},function(Me,tt,Be){var Dt=Me.constants.blendEquations,Ht=tt.def(),Ir=tt.def(),on=Me.cond("typeof ",Be,'==="string"');return z.optional(function(){function ln(bn,nn,zn){Me.assert(bn,zn+" in "+Dt,"invalid "+nn+", must be one of "+Object.keys(cr))}ln(on.then,ct,Be),Me.assert(on.else,Be+"&&typeof "+Be+'==="object"',"invalid "+ct),ln(on.else,ct+".rgb",Be+".rgb"),ln(on.else,ct+".alpha",Be+".alpha")}),on.then(Ht,"=",Ir,"=",Dt,"[",Be,"];"),on.else(Ht,"=",Dt,"[",Be,".rgb];",Ir,"=",Dt,"[",Be,".alpha];"),tt(on),[Ht,Ir]});case hs:return St(function(Me){return z.command(yo(Me)&&Me.length===4,"blend.color must be a 4d array",ye.commandStr),rt(4,function(tt){return+Me[tt]})},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,Me.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),rt(4,function(Dt){return tt.def("+",Be,"[",Dt,"]")})});case fu:return St(function(Me){return z.commandType(Me,"number",Ye,ye.commandStr),Me|0},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,"typeof "+Be+'==="number"',"invalid stencil.mask")}),tt.def(Be,"|0")});case Rs:return St(function(Me){z.commandType(Me,"object",Ye,ye.commandStr);var tt=Me.cmp||"keep",Be=Me.ref||0,Dt="mask"in Me?Me.mask:-1;return z.commandParameter(tt,Pc,ct+".cmp",ye.commandStr),z.commandType(Be,"number",ct+".ref",ye.commandStr),z.commandType(Dt,"number",ct+".mask",ye.commandStr),[Pc[tt],Be,Dt]},function(Me,tt,Be){var Dt=Me.constants.compareFuncs;z.optional(function(){function ln(){Me.assert(tt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ln(Be+"&&typeof ",Be,'==="object"'),ln('!("cmp" in ',Be,")||(",Be,".cmp in ",Dt,")")});var Ht=tt.def('"cmp" in ',Be,"?",Dt,"[",Be,".cmp]",":",Os),Ir=tt.def(Be,".ref|0"),on=tt.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[Ht,Ir,on]});case ol:case rf:return St(function(Me){z.commandType(Me,"object",Ye,ye.commandStr);var tt=Me.fail||"keep",Be=Me.zfail||"keep",Dt=Me.zpass||"keep";return z.commandParameter(tt,Il,ct+".fail",ye.commandStr),z.commandParameter(Be,Il,ct+".zfail",ye.commandStr),z.commandParameter(Dt,Il,ct+".zpass",ye.commandStr),[ct===rf?ec:Tl,Il[tt],Il[Be],Il[Dt]]},function(Me,tt,Be){var Dt=Me.constants.stencilOps;z.optional(function(){Me.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid "+ct)});function Ht(Ir){return z.optional(function(){Me.assert(tt,'!("'+Ir+'" in '+Be+")||("+Be+"."+Ir+" in "+Dt+")","invalid "+ct+"."+Ir+", must be one of "+Object.keys(Il))}),tt.def('"',Ir,'" in ',Be,"?",Dt,"[",Be,".",Ir,"]:",Os)}return[ct===rf?ec:Tl,Ht("fail"),Ht("zfail"),Ht("zpass")]});case ko:return St(function(Me){z.commandType(Me,"object",Ye,ye.commandStr);var tt=Me.factor|0,Be=Me.units|0;return z.commandType(tt,"number",Ye+".factor",ye.commandStr),z.commandType(Be,"number",Ye+".units",ye.commandStr),[tt,Be]},function(Me,tt,Be){z.optional(function(){Me.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid "+ct)});var Dt=tt.def(Be,".factor|0"),Ht=tt.def(Be,".units|0");return[Dt,Ht]});case bc:return St(function(Me){var tt=0;return Me==="front"?tt=Tl:Me==="back"&&(tt=ec),z.command(!!tt,Ye,ye.commandStr),tt},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),tt.def(Be,'==="front"?',Tl,":",ec)});case Al:return St(function(Me){return z.command(typeof Me=="number"&&Me>=tr.lineWidthDims[0]&&Me<=tr.lineWidthDims[1],"invalid line width, must be a positive number between "+tr.lineWidthDims[0]+" and "+tr.lineWidthDims[1],ye.commandStr),Me},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,"typeof "+Be+'==="number"&&'+Be+">="+tr.lineWidthDims[0]+"&&"+Be+"<="+tr.lineWidthDims[1],"invalid line width")}),Be});case Xo:return St(function(Me){return z.commandParameter(Me,ud,Ye,ye.commandStr),ud[Me]},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),tt.def(Be+'==="cw"?'+Ic+":"+kc)});case Hu:return St(function(Me){return z.command(yo(Me)&&Me.length===4,"color.mask must be length 4 array",ye.commandStr),Me.map(function(tt){return!!tt})},function(Me,tt,Be){return z.optional(function(){Me.assert(tt,Me.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),rt(4,function(Dt){return"!!"+Be+"["+Dt+"]"})});case Xu:return St(function(Me){z.command(typeof Me=="object"&&Me,Ye,ye.commandStr);var tt="value"in Me?Me.value:1,Be=!!Me.invert;return z.command(typeof tt=="number"&&tt>=0&&tt<=1,"sample.coverage.value must be a number between 0 and 1",ye.commandStr),[tt,Be]},function(Me,tt,Be){z.optional(function(){Me.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var Dt=tt.def('"value" in ',Be,"?+",Be,".value:1"),Ht=tt.def("!!",Be,".invert");return[Dt,Ht]})}}),Kt}function Zi(De,ye){var ot=De.static,Ot=De.dynamic,Kt={};return Object.keys(ot).forEach(function(ct){var Ye=ot[ct],St;if(typeof Ye=="number"||typeof Ye=="boolean")St=Fo(function(){return Ye});else if(typeof Ye=="function"){var Me=Ye._reglType;Me==="texture2d"||Me==="textureCube"?St=Fo(function(tt){return tt.link(Ye)}):Me==="framebuffer"||Me==="framebufferCube"?(z.command(Ye.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ct+'"',ye.commandStr),St=Fo(function(tt){return tt.link(Ye.color[0])})):z.commandRaise('invalid data for uniform "'+ct+'"',ye.commandStr)}else yo(Ye)?St=Fo(function(tt){var Be=tt.global.def("[",rt(Ye.length,function(Dt){return z.command(typeof Ye[Dt]=="number"||typeof Ye[Dt]=="boolean","invalid uniform "+ct,tt.commandStr),Ye[Dt]}),"]");return Be}):z.commandRaise('invalid or missing data for uniform "'+ct+'"',ye.commandStr);St.value=Ye,Kt[ct]=St}),Object.keys(Ot).forEach(function(ct){var Ye=Ot[ct];Kt[ct]=Vs(Ye,function(St,Me){return St.invoke(Me,Ye)})}),Kt}function ns(De,ye){var ot=De.static,Ot=De.dynamic,Kt={};return Object.keys(ot).forEach(function(ct){var Ye=ot[ct],St=Te.id(ct),Me=new Lt;if(vh(Ye))Me.state=ai,Me.buffer=wr.getBuffer(wr.create(Ye,Us,!1,!0)),Me.type=0;else{var tt=wr.getBuffer(Ye);if(tt)Me.state=ai,Me.buffer=tt,Me.type=0;else if(z.command(typeof Ye=="object"&&Ye,"invalid data for attribute "+ct,ye.commandStr),"constant"in Ye){var Be=Ye.constant;Me.buffer="null",Me.state=wi,typeof Be=="number"?Me.x=Be:(z.command(yo(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+ct,ye.commandStr),Ai.forEach(function(nn,zn){zn<Be.length&&(Me[nn]=Be[zn])}))}else{vh(Ye.buffer)?tt=wr.getBuffer(wr.create(Ye.buffer,Us,!1,!0)):tt=wr.getBuffer(Ye.buffer),z.command(!!tt,'missing buffer for attribute "'+ct+'"',ye.commandStr);var Dt=Ye.offset|0;z.command(Dt>=0,'invalid offset for attribute "'+ct+'"',ye.commandStr);var Ht=Ye.stride|0;z.command(Ht>=0&&Ht<256,'invalid stride for attribute "'+ct+'", must be integer betweeen [0, 255]',ye.commandStr);var Ir=Ye.size|0;z.command(!("size"in Ye)||Ir>0&&Ir<=4,'invalid size for attribute "'+ct+'", must be 1,2,3,4',ye.commandStr);var on=!!Ye.normalized,ln=0;"type"in Ye&&(z.commandParameter(Ye.type,vu,"invalid type for attribute "+ct,ye.commandStr),ln=vu[Ye.type]);var bn=Ye.divisor|0;z.optional(function(){"divisor"in Ye&&(z.command(bn===0||Gr,'cannot specify divisor for attribute "'+ct+'", instancing not supported',ye.commandStr),z.command(bn>=0,'invalid divisor for attribute "'+ct+'"',ye.commandStr));var nn=ye.commandStr,zn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ye).forEach(function(Tn){z.command(zn.indexOf(Tn)>=0,'unknown parameter "'+Tn+'" for attribute pointer "'+ct+'" (valid parameters are '+zn+")",nn)})}),Me.buffer=tt,Me.state=ai,Me.size=Ir,Me.normalized=on,Me.type=ln||tt.dtype,Me.offset=Dt,Me.stride=Ht,Me.divisor=bn}}Kt[ct]=Fo(function(nn,zn){var Tn=nn.attribCache;if(St in Tn)return Tn[St];var Bn={isStream:!1};return Object.keys(Me).forEach(function(En){Bn[En]=Me[En]}),Me.buffer&&(Bn.buffer=nn.link(Me.buffer),Bn.type=Bn.type||Bn.buffer+".dtype"),Tn[St]=Bn,Bn})}),Object.keys(Ot).forEach(function(ct){var Ye=Ot[ct];function St(Me,tt){var Be=Me.invoke(tt,Ye),Dt=Me.shared,Ht=Me.constants,Ir=Dt.isBufferArgs,on=Dt.buffer;z.optional(function(){Me.assert(tt,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+Ir+"("+Be+")||"+on+".getBuffer("+Be+")||"+on+".getBuffer("+Be+".buffer)||"+Ir+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+Dt.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+ct+'"')});var ln={isStream:tt.def(!1)},bn=new Lt;bn.state=ai,Object.keys(bn).forEach(function(Bn){ln[Bn]=tt.def(""+bn[Bn])});var nn=ln.buffer,zn=ln.type;tt("if(",Ir,"(",Be,")){",ln.isStream,"=true;",nn,"=",on,".createStream(",Us,",",Be,");",zn,"=",nn,".dtype;","}else{",nn,"=",on,".getBuffer(",Be,");","if(",nn,"){",zn,"=",nn,".dtype;",'}else if("constant" in ',Be,"){",ln.state,"=",wi,";","if(typeof "+Be+'.constant === "number"){',ln[Ai[0]],"=",Be,".constant;",Ai.slice(1).map(function(Bn){return ln[Bn]}).join("="),"=0;","}else{",Ai.map(function(Bn,En){return ln[Bn]+"="+Be+".constant.length>"+En+"?"+Be+".constant["+En+"]:0;"}).join(""),"}}else{","if(",Ir,"(",Be,".buffer)){",nn,"=",on,".createStream(",Us,",",Be,".buffer);","}else{",nn,"=",on,".getBuffer(",Be,".buffer);","}",zn,'="type" in ',Be,"?",Ht.glTypes,"[",Be,".type]:",nn,".dtype;",ln.normalized,"=!!",Be,".normalized;");function Tn(Bn){tt(ln[Bn],"=",Be,".",Bn,"|0;")}return Tn("size"),Tn("offset"),Tn("stride"),Tn("divisor"),tt("}}"),tt.exit("if(",ln.isStream,"){",on,".destroyStream(",nn,");","}"),ln}Kt[ct]=Vs(Ye,St)}),Kt}function ja(De){var ye=De.static,ot=De.dynamic,Ot={};return Object.keys(ye).forEach(function(Kt){var ct=ye[Kt];Ot[Kt]=Fo(function(Ye,St){return typeof ct=="number"||typeof ct=="boolean"?""+ct:Ye.link(ct)})}),Object.keys(ot).forEach(function(Kt){var ct=ot[Kt];Ot[Kt]=Vs(ct,function(Ye,St){return Ye.invoke(St,ct)})}),Ot}function Bo(De,ye,ot,Ot,Kt){var ct=De.static,Ye=De.dynamic;z.optional(function(){var Tn=[bu,Pu,Sc,Lu,Yo,Ff,Cc,Bf,Ec,Nh].concat(ei);function Bn(En){Object.keys(En).forEach(function(Ln){z.command(Tn.indexOf(Ln)>=0,'unknown parameter "'+Ln+'"',Kt.commandStr)})}Bn(ct),Bn(Ye)});var St=Ci(De,ye),Me=xn(De,Kt),tt=ci(De,Me,Kt),Be=Ma(De,Kt),Dt=bo(De,Kt),Ht=ji(De,Kt,St);function Ir(Tn){var Bn=tt[Tn];Bn&&(Dt[Tn]=Bn)}Ir(hu),Ir(Rn(Df));var on=Object.keys(Dt).length>0,ln={framebuffer:Me,draw:Be,shader:Ht,state:Dt,dirty:on,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ln.profile=fn(De,Kt),ln.uniforms=Zi(ot,Kt),ln.drawVAO=ln.scopeVAO=Be.vao,!ln.drawVAO&&Ht.program&&!St&&$e.angle_instanced_arrays&&Be.static.elements){var bn=!0,nn=Ht.program.attributes.map(function(Tn){var Bn=ye.static[Tn];return bn=bn&&!!Bn,Bn});if(bn&&nn.length>0){var zn=jr.getVAO(jr.createVAO({attributes:nn,elements:Be.static.elements}));ln.drawVAO=new Sa(null,null,null,function(Tn,Bn){return Tn.link(zn)}),ln.useVAO=!0}}return St?ln.useVAO=!0:ln.attributes=ns(ye,Kt),ln.context=ja(Ot,Kt),ln}function Po(De,ye,ot){var Ot=De.shared,Kt=Ot.context,ct=De.scope();Object.keys(ot).forEach(function(Ye){ye.save(Kt,"."+Ye);var St=ot[Ye],Me=St.append(De,ye);Array.isArray(Me)?ct(Kt,".",Ye,"=[",Me.join(),"];"):ct(Kt,".",Ye,"=",Me,";")}),ye(ct)}function is(De,ye,ot,Ot){var Kt=De.shared,ct=Kt.gl,Ye=Kt.framebuffer,St;un&&(St=ye.def(Kt.extensions,".webgl_draw_buffers"));var Me=De.constants,tt=Me.drawBuffer,Be=Me.backBuffer,Dt;ot?Dt=ot.append(De,ye):Dt=ye.def(Ye,".next"),Ot||ye("if(",Dt,"!==",Ye,".cur){"),ye("if(",Dt,"){",ct,".bindFramebuffer(",dh,",",Dt,".framebuffer);"),un&&ye(St,".drawBuffersWEBGL(",tt,"[",Dt,".colorAttachments.length]);"),ye("}else{",ct,".bindFramebuffer(",dh,",null);"),un&&ye(St,".drawBuffersWEBGL(",Be,");"),ye("}",Ye,".cur=",Dt,";"),Ot||ye("}")}function qo(De,ye,ot){var Ot=De.shared,Kt=Ot.gl,ct=De.current,Ye=De.next,St=Ot.current,Me=Ot.next,tt=De.cond(St,".dirty");ei.forEach(function(Be){var Dt=Rn(Be);if(!(Dt in ot.state)){var Ht,Ir;if(Dt in Ye){Ht=Ye[Dt],Ir=ct[Dt];var on=rt(Jr[Dt].length,function(bn){return tt.def(Ht,"[",bn,"]")});tt(De.cond(on.map(function(bn,nn){return bn+"!=="+Ir+"["+nn+"]"}).join("||")).then(Kt,".",Cr[Dt],"(",on,");",on.map(function(bn,nn){return Ir+"["+nn+"]="+bn}).join(";"),";"))}else{Ht=tt.def(Me,".",Dt);var ln=De.cond(Ht,"!==",St,".",Dt);tt(ln),Dt in Er?ln(De.cond(Ht).then(Kt,".enable(",Er[Dt],");").else(Kt,".disable(",Er[Dt],");"),St,".",Dt,"=",Ht,";"):ln(Kt,".",Cr[Dt],"(",Ht,");",St,".",Dt,"=",Ht,";")}}}),Object.keys(ot.state).length===0&&tt(St,".dirty=false;"),ye(tt)}function ps(De,ye,ot,Ot){var Kt=De.shared,ct=De.current,Ye=Kt.current,St=Kt.gl;Pp(Object.keys(ot)).forEach(function(Me){var tt=ot[Me];if(!(Ot&&!Ot(tt))){var Be=tt.append(De,ye);if(Er[Me]){var Dt=Er[Me];Lc(tt)?Be?ye(St,".enable(",Dt,");"):ye(St,".disable(",Dt,");"):ye(De.cond(Be).then(St,".enable(",Dt,");").else(St,".disable(",Dt,");")),ye(Ye,".",Me,"=",Be,";")}else if(yo(Be)){var Ht=ct[Me];ye(St,".",Cr[Me],"(",Be,");",Be.map(function(Ir,on){return Ht+"["+on+"]="+Ir}).join(";"),";")}else ye(St,".",Cr[Me],"(",Be,");",Ye,".",Me,"=",Be,";")}})}function oo(De,ye){Gr&&(De.instancing=ye.def(De.shared.extensions,".angle_instanced_arrays"))}function Ti(De,ye,ot,Ot,Kt){var ct=De.shared,Ye=De.stats,St=ct.current,Me=ct.timer,tt=ot.profile;function Be(){var Tn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Tn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Dt,Ht;function Ir(Tn){Dt=ye.def(),Tn(Dt,"=",Be(),";"),typeof Kt=="string"?Tn(Ye,".count+=",Kt,";"):Tn(Ye,".count++;"),Ur&&(Ot?(Ht=ye.def(),Tn(Ht,"=",Me,".getNumPendingQueries();")):Tn(Me,".beginQuery(",Ye,");"))}function on(Tn){Tn(Ye,".cpuTime+=",Be(),"-",Dt,";"),Ur&&(Ot?Tn(Me,".pushScopeStats(",Ht,",",Me,".getNumPendingQueries(),",Ye,");"):Tn(Me,".endQuery();"))}function ln(Tn){var Bn=ye.def(St,".profile");ye(St,".profile=",Tn,";"),ye.exit(St,".profile=",Bn,";")}var bn;if(tt){if(Lc(tt)){tt.enable?(Ir(ye),on(ye.exit),ln("true")):ln("false");return}bn=tt.append(De,ye),ln(bn)}else bn=ye.def(St,".profile");var nn=De.block();Ir(nn),ye("if(",bn,"){",nn,"}");var zn=De.block();on(zn),ye.exit("if(",bn,"){",zn,"}")}function No(De,ye,ot,Ot,Kt){var ct=De.shared;function Ye(Me){switch(Me){case Nf:case uh:case lh:return 2;case Mc:case Ql:case Zf:return 3;case zf:case Gh:case Uf:return 4;default:return 1}}function St(Me,tt,Be){var Dt=ct.gl,Ht=ye.def(Me,".location"),Ir=ye.def(ct.attributes,"[",Ht,"]"),on=Be.state,ln=Be.buffer,bn=[Be.x,Be.y,Be.z,Be.w],nn=["buffer","normalized","offset","stride"];function zn(){ye("if(!",Ir,".buffer){",Dt,".enableVertexAttribArray(",Ht,");}");var Bn=Be.type,En;if(Be.size?En=ye.def(Be.size,"||",tt):En=tt,ye("if(",Ir,".type!==",Bn,"||",Ir,".size!==",En,"||",nn.map(function(pi){return Ir+"."+pi+"!=="+Be[pi]}).join("||"),"){",Dt,".bindBuffer(",Us,",",ln,".buffer);",Dt,".vertexAttribPointer(",[Ht,En,Bn,Be.normalized,Be.stride,Be.offset],");",Ir,".type=",Bn,";",Ir,".size=",En,";",nn.map(function(pi){return Ir+"."+pi+"="+Be[pi]+";"}).join(""),"}"),Gr){var Ln=Be.divisor;ye("if(",Ir,".divisor!==",Ln,"){",De.instancing,".vertexAttribDivisorANGLE(",[Ht,Ln],");",Ir,".divisor=",Ln,";}")}}function Tn(){ye("if(",Ir,".buffer){",Dt,".disableVertexAttribArray(",Ht,");",Ir,".buffer=null;","}if(",Ai.map(function(Bn,En){return Ir+"."+Bn+"!=="+bn[En]}).join("||"),"){",Dt,".vertexAttrib4f(",Ht,",",bn,");",Ai.map(function(Bn,En){return Ir+"."+Bn+"="+bn[En]+";"}).join(""),"}")}on===ai?zn():on===wi?Tn():(ye("if(",on,"===",ai,"){"),zn(),ye("}else{"),Tn(),ye("}"))}Ot.forEach(function(Me){var tt=Me.name,Be=ot.attributes[tt],Dt;if(Be){if(!Kt(Be))return;Dt=Be.append(De,ye)}else{if(!Kt(Lp))return;var Ht=De.scopeAttrib(tt);z.optional(function(){De.assert(ye,Ht+".state","missing attribute "+tt)}),Dt={},Object.keys(new Lt).forEach(function(Ir){Dt[Ir]=ye.def(Ht,".",Ir)})}St(De.link(Me),Ye(Me.info.type),Dt)})}function sa(De,ye,ot,Ot,Kt,ct){for(var Ye=De.shared,St=Ye.gl,Me,tt=0;tt<Ot.length;++tt){var Be=Ot[tt],Dt=Be.name,Ht=Be.info.type,Ir=ot.uniforms[Dt],on=De.link(Be),ln=on+".location",bn;if(Ir){if(!Kt(Ir))continue;if(Lc(Ir)){var nn=Ir.value;if(z.command(nn!==null&&typeof nn!="undefined",'missing uniform "'+Dt+'"',De.commandStr),Ht===fh||Ht===hh){z.command(typeof nn=="function"&&(Ht===fh&&(nn._reglType==="texture2d"||nn._reglType==="framebuffer")||Ht===hh&&(nn._reglType==="textureCube"||nn._reglType==="framebufferCube")),"invalid texture for uniform "+Dt,De.commandStr);var zn=De.link(nn._texture||nn.color[0]._texture);ye(St,".uniform1i(",ln,",",zn+".bind());"),ye.exit(zn,".unbind();")}else if(Ht===pu||Ht===Jl||Ht===ch){z.optional(function(){z.command(yo(nn),"invalid matrix for uniform "+Dt,De.commandStr),z.command(Ht===pu&&nn.length===4||Ht===Jl&&nn.length===9||Ht===ch&&nn.length===16,"invalid length for matrix uniform "+Dt,De.commandStr)});var Tn=De.global.def("new Float32Array(["+Array.prototype.slice.call(nn)+"])"),Bn=2;Ht===Jl?Bn=3:Ht===ch&&(Bn=4),ye(St,".uniformMatrix",Bn,"fv(",ln,",false,",Tn,");")}else{switch(Ht){case of:z.commandType(nn,"number","uniform "+Dt,De.commandStr),Me="1f";break;case Nf:z.command(yo(nn)&&nn.length===2,"uniform "+Dt,De.commandStr),Me="2f";break;case Mc:z.command(yo(nn)&&nn.length===3,"uniform "+Dt,De.commandStr),Me="3f";break;case zf:z.command(yo(nn)&&nn.length===4,"uniform "+Dt,De.commandStr),Me="4f";break;case sf:z.commandType(nn,"boolean","uniform "+Dt,De.commandStr),Me="1i";break;case sh:z.commandType(nn,"number","uniform "+Dt,De.commandStr),Me="1i";break;case lh:z.command(yo(nn)&&nn.length===2,"uniform "+Dt,De.commandStr),Me="2i";break;case uh:z.command(yo(nn)&&nn.length===2,"uniform "+Dt,De.commandStr),Me="2i";break;case Zf:z.command(yo(nn)&&nn.length===3,"uniform "+Dt,De.commandStr),Me="3i";break;case Ql:z.command(yo(nn)&&nn.length===3,"uniform "+Dt,De.commandStr),Me="3i";break;case Uf:z.command(yo(nn)&&nn.length===4,"uniform "+Dt,De.commandStr),Me="4i";break;case Gh:z.command(yo(nn)&&nn.length===4,"uniform "+Dt,De.commandStr),Me="4i";break}ye(St,".uniform",Me,"(",ln,",",yo(nn)?Array.prototype.slice.call(nn):nn,");")}continue}else bn=Ir.append(De,ye)}else{if(!Kt(Lp))continue;bn=ye.def(Ye.uniforms,"[",Te.id(Dt),"]")}Ht===fh?(z(!Array.isArray(bn),"must specify a scalar prop for textures"),ye("if(",bn,"&&",bn,'._reglType==="framebuffer"){',bn,"=",bn,".color[0];","}")):Ht===hh&&(z(!Array.isArray(bn),"must specify a scalar prop for cube maps"),ye("if(",bn,"&&",bn,'._reglType==="framebufferCube"){',bn,"=",bn,".color[0];","}")),z.optional(function(){function Ds(Ou,Rc){De.assert(ye,Ou,'bad data or missing for uniform "'+Dt+'".  '+Rc)}function ll(Ou){z(!Array.isArray(bn),"must not specify an array type for uniform"),Ds("typeof "+bn+'==="'+Ou+'"',"invalid type, expected "+Ou)}function Ru(Ou,Rc){Array.isArray(bn)?z(bn.length===Ou,"must have length "+Ou):Ds(Ye.isArrayLike+"("+bn+")&&"+bn+".length==="+Ou,"invalid vector, should have length "+Ou,De.commandStr)}function Op(Ou){z(!Array.isArray(bn),"must not specify a value type"),Ds("typeof "+bn+'==="function"&&'+bn+'._reglType==="texture'+(Ou===qd?"2d":"Cube")+'"',"invalid texture type",De.commandStr)}switch(Ht){case sh:ll("number");break;case uh:Ru(2,"number");break;case Ql:Ru(3,"number");break;case Gh:Ru(4,"number");break;case of:ll("number");break;case Nf:Ru(2,"number");break;case Mc:Ru(3,"number");break;case zf:Ru(4,"number");break;case sf:ll("boolean");break;case lh:Ru(2,"boolean");break;case Zf:Ru(3,"boolean");break;case Uf:Ru(4,"boolean");break;case pu:Ru(4,"number");break;case Jl:Ru(9,"number");break;case ch:Ru(16,"number");break;case fh:Op(qd);break;case hh:Op($o);break}});var En=1;switch(Ht){case fh:case hh:var Ln=ye.def(bn,"._texture");ye(St,".uniform1i(",ln,",",Ln,".bind());"),ye.exit(Ln,".unbind();");continue;case sh:case sf:Me="1i";break;case uh:case lh:Me="2i",En=2;break;case Ql:case Zf:Me="3i",En=3;break;case Gh:case Uf:Me="4i",En=4;break;case of:Me="1f";break;case Nf:Me="2f",En=2;break;case Mc:Me="3f",En=3;break;case zf:Me="4f",En=4;break;case pu:Me="Matrix2fv";break;case Jl:Me="Matrix3fv";break;case ch:Me="Matrix4fv";break}if(Me.charAt(0)==="M"){ye(St,".uniform",Me,"(",ln,",");var pi=Math.pow(Ht-pu+2,2),Ca=De.global.def("new Float32Array(",pi,")");Array.isArray(bn)?ye("false,(",rt(pi,function(Ds){return Ca+"["+Ds+"]="+bn[Ds]}),",",Ca,")"):ye("false,(Array.isArray(",bn,")||",bn," instanceof Float32Array)?",bn,":(",rt(pi,function(Ds){return Ca+"["+Ds+"]="+bn+"["+Ds+"]"}),",",Ca,")"),ye(");")}else if(En>1){for(var vs=[],Ga=[],ha=0;ha<En;++ha)Array.isArray(bn)?Ga.push(bn[ha]):Ga.push(ye.def(bn+"["+ha+"]")),ct&&vs.push(ye.def());ct&&ye("if(!",De.batchId,"||",vs.map(function(Ds,ll){return Ds+"!=="+Ga[ll]}).join("||"),"){",vs.map(function(Ds,ll){return Ds+"="+Ga[ll]+";"}).join("")),ye(St,".uniform",Me,"(",ln,",",Ga.join(","),");"),ct&&ye("}")}else{if(z(!Array.isArray(bn),"uniform value must not be an array"),ct){var kl=ye.def();ye("if(!",De.batchId,"||",kl,"!==",bn,"){",kl,"=",bn,";")}ye(St,".uniform",Me,"(",ln,",",bn,");"),ct&&ye("}")}}}function ds(De,ye,ot,Ot){var Kt=De.shared,ct=Kt.gl,Ye=Kt.draw,St=Ot.draw;function Me(){var En=St.elements,Ln,pi=ye;return En?((En.contextDep&&Ot.contextDynamic||En.propDep)&&(pi=ot),Ln=En.append(De,pi),St.elementsActive&&pi("if("+Ln+")"+ct+".bindBuffer("+Y+","+Ln+".buffer.buffer);")):(Ln=pi.def(),pi(Ln,"=",Ye,".",Lu,";","if(",Ln,"){",ct,".bindBuffer(",Y,",",Ln,".buffer.buffer);}","else if(",Kt.vao,".currentVAO){",Ln,"=",De.shared.elements+".getElements("+Kt.vao,".currentVAO.elements);",Tr?"":"if("+Ln+")"+ct+".bindBuffer("+Y+","+Ln+".buffer.buffer);","}")),Ln}function tt(){var En=St.count,Ln,pi=ye;return En?((En.contextDep&&Ot.contextDynamic||En.propDep)&&(pi=ot),Ln=En.append(De,pi),z.optional(function(){En.MISSING&&De.assert(ye,"false","missing vertex count"),En.DYNAMIC&&De.assert(pi,Ln+">=0","missing vertex count")})):(Ln=pi.def(Ye,".",Cc),z.optional(function(){De.assert(pi,Ln+">=0","missing vertex count")})),Ln}var Be=Me();function Dt(En){var Ln=St[En];return Ln?Ln.contextDep&&Ot.contextDynamic||Ln.propDep?Ln.append(De,ot):Ln.append(De,ye):ye.def(Ye,".",En)}var Ht=Dt(Yo),Ir=Dt(Ff),on=tt();if(typeof on=="number"){if(on===0)return}else ot("if(",on,"){"),ot.exit("}");var ln,bn;Gr&&(ln=Dt(Bf),bn=De.instancing);var nn=Be+".type",zn=St.elements&&Lc(St.elements)&&!St.vaoActive;function Tn(){function En(){ot(bn,".drawElementsInstancedANGLE(",[Ht,on,nn,Ir+"<<(("+nn+"-"+vi+")>>1)",ln],");")}function Ln(){ot(bn,".drawArraysInstancedANGLE(",[Ht,Ir,on,ln],");")}Be&&Be!=="null"?zn?En():(ot("if(",Be,"){"),En(),ot("}else{"),Ln(),ot("}")):Ln()}function Bn(){function En(){ot(ct+".drawElements("+[Ht,on,nn,Ir+"<<(("+nn+"-"+vi+")>>1)"]+");")}function Ln(){ot(ct+".drawArrays("+[Ht,Ir,on]+");")}Be&&Be!=="null"?zn?En():(ot("if(",Be,"){"),En(),ot("}else{"),Ln(),ot("}")):Ln()}Gr&&(typeof ln!="number"||ln>=0)?typeof ln=="string"?(ot("if(",ln,">0){"),Tn(),ot("}else if(",ln,"<0){"),Bn(),ot("}")):Tn():Bn()}function gi(De,ye,ot,Ot,Kt){var ct=mi(),Ye=ct.proc("body",Kt);return z.optional(function(){ct.commandStr=ye.commandStr,ct.command=ct.link(ye.commandStr)}),Gr&&(ct.instancing=Ye.def(ct.shared.extensions,".angle_instanced_arrays")),De(ct,Ye,ot,Ot),ct.compile().body}function Gi(De,ye,ot,Ot){oo(De,ye),ot.useVAO?ot.drawVAO?ye(De.shared.vao,".setVAO(",ot.drawVAO.append(De,ye),");"):ye(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(ye(De.shared.vao,".setVAO(null);"),No(De,ye,ot,Ot.attributes,function(){return!0})),sa(De,ye,ot,Ot.uniforms,function(){return!0},!1),ds(De,ye,ye,ot)}function ga(De,ye){var ot=De.proc("draw",1);oo(De,ot),Po(De,ot,ye.context),is(De,ot,ye.framebuffer),qo(De,ot,ye),ps(De,ot,ye.state),Ti(De,ot,ye,!1,!0);var Ot=ye.shader.progVar.append(De,ot);if(ot(De.shared.gl,".useProgram(",Ot,".program);"),ye.shader.program)Gi(De,ot,ye,ye.shader.program);else{ot(De.shared.vao,".setVAO(null);");var Kt=De.global.def("{}"),ct=ot.def(Ot,".id"),Ye=ot.def(Kt,"[",ct,"]");ot(De.cond(Ye).then(Ye,".call(this,a0);").else(Ye,"=",Kt,"[",ct,"]=",De.link(function(St){return gi(Gi,De,ye,St,1)}),"(",Ot,");",Ye,".call(this,a0);"))}Object.keys(ye.state).length>0&&ot(De.shared.current,".dirty=true;"),De.shared.vao&&ot(De.shared.vao,".setVAO(null);")}function po(De,ye,ot,Ot){De.batchId="a1",oo(De,ye);function Kt(){return!0}No(De,ye,ot,Ot.attributes,Kt),sa(De,ye,ot,Ot.uniforms,Kt,!1),ds(De,ye,ye,ot)}function qu(De,ye,ot,Ot){oo(De,ye);var Kt=ot.contextDep,ct=ye.def(),Ye="a0",St="a1",Me=ye.def();De.shared.props=Me,De.batchId=ct;var tt=De.scope(),Be=De.scope();ye(tt.entry,"for(",ct,"=0;",ct,"<",St,";++",ct,"){",Me,"=",Ye,"[",ct,"];",Be,"}",tt.exit);function Dt(nn){return nn.contextDep&&Kt||nn.propDep}function Ht(nn){return!Dt(nn)}if(ot.needsContext&&Po(De,Be,ot.context),ot.needsFramebuffer&&is(De,Be,ot.framebuffer),ps(De,Be,ot.state,Dt),ot.profile&&Dt(ot.profile)&&Ti(De,Be,ot,!1,!0),Ot)ot.useVAO?ot.drawVAO?Dt(ot.drawVAO)?Be(De.shared.vao,".setVAO(",ot.drawVAO.append(De,Be),");"):tt(De.shared.vao,".setVAO(",ot.drawVAO.append(De,tt),");"):tt(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(tt(De.shared.vao,".setVAO(null);"),No(De,tt,ot,Ot.attributes,Ht),No(De,Be,ot,Ot.attributes,Dt)),sa(De,tt,ot,Ot.uniforms,Ht,!1),sa(De,Be,ot,Ot.uniforms,Dt,!0),ds(De,tt,Be,ot);else{var Ir=De.global.def("{}"),on=ot.shader.progVar.append(De,Be),ln=Be.def(on,".id"),bn=Be.def(Ir,"[",ln,"]");Be(De.shared.gl,".useProgram(",on,".program);","if(!",bn,"){",bn,"=",Ir,"[",ln,"]=",De.link(function(nn){return gi(po,De,ot,nn,2)}),"(",on,");}",bn,".call(this,a0[",ct,"],",ct,");")}}function Ue(De,ye){var ot=De.proc("batch",2);De.batchId="0",oo(De,ot);var Ot=!1,Kt=!0;Object.keys(ye.context).forEach(function(Ir){Ot=Ot||ye.context[Ir].propDep}),Ot||(Po(De,ot,ye.context),Kt=!1);var ct=ye.framebuffer,Ye=!1;ct?(ct.propDep?Ot=Ye=!0:ct.contextDep&&Ot&&(Ye=!0),Ye||is(De,ot,ct)):is(De,ot,null),ye.state.viewport&&ye.state.viewport.propDep&&(Ot=!0);function St(Ir){return Ir.contextDep&&Ot||Ir.propDep}qo(De,ot,ye),ps(De,ot,ye.state,function(Ir){return!St(Ir)}),(!ye.profile||!St(ye.profile))&&Ti(De,ot,ye,!1,"a1"),ye.contextDep=Ot,ye.needsContext=Kt,ye.needsFramebuffer=Ye;var Me=ye.shader.progVar;if(Me.contextDep&&Ot||Me.propDep)qu(De,ot,ye,null);else{var tt=Me.append(De,ot);if(ot(De.shared.gl,".useProgram(",tt,".program);"),ye.shader.program)qu(De,ot,ye,ye.shader.program);else{ot(De.shared.vao,".setVAO(null);");var Be=De.global.def("{}"),Dt=ot.def(tt,".id"),Ht=ot.def(Be,"[",Dt,"]");ot(De.cond(Ht).then(Ht,".call(this,a0,a1);").else(Ht,"=",Be,"[",Dt,"]=",De.link(function(Ir){return gi(qu,De,ye,Ir,2)}),"(",tt,");",Ht,".call(this,a0,a1);"))}}Object.keys(ye.state).length>0&&ot(De.shared.current,".dirty=true;"),De.shared.vao&&ot(De.shared.vao,".setVAO(null);")}function or(De,ye){var ot=De.proc("scope",3);De.batchId="a2";var Ot=De.shared,Kt=Ot.current;Po(De,ot,ye.context),ye.framebuffer&&ye.framebuffer.append(De,ot),Pp(Object.keys(ye.state)).forEach(function(Ye){var St=ye.state[Ye],Me=St.append(De,ot);yo(Me)?Me.forEach(function(tt,Be){ot.set(De.next[Ye],"["+Be+"]",tt)}):ot.set(Ot.next,"."+Ye,Me)}),Ti(De,ot,ye,!0,!0),[Lu,Ff,Cc,Bf,Yo].forEach(function(Ye){var St=ye.draw[Ye];!St||ot.set(Ot.draw,"."+Ye,""+St.append(De,ot))}),Object.keys(ye.uniforms).forEach(function(Ye){var St=ye.uniforms[Ye].append(De,ot);Array.isArray(St)&&(St="["+St.join()+"]"),ot.set(Ot.uniforms,"["+Te.id(Ye)+"]",St)}),Object.keys(ye.attributes).forEach(function(Ye){var St=ye.attributes[Ye].append(De,ot),Me=De.scopeAttrib(Ye);Object.keys(new Lt).forEach(function(tt){ot.set(Me,"."+tt,St[tt])})}),ye.scopeVAO&&ot.set(Ot.vao,".targetVAO",ye.scopeVAO.append(De,ot));function ct(Ye){var St=ye.shader[Ye];St&&ot.set(Ot.shader,"."+Ye,St.append(De,ot))}ct(Pu),ct(Sc),Object.keys(ye.state).length>0&&(ot(Kt,".dirty=true;"),ot.exit(Kt,".dirty=true;")),ot("a1(",De.shared.context,",a0,",De.batchId,");")}function Gt(De){if(!(typeof De!="object"||yo(De))){for(var ye=Object.keys(De),ot=0;ot<ye.length;++ot)if(an.isDynamic(De[ye[ot]]))return!0;return!1}}function Pn(De,ye,ot){var Ot=ye.static[ot];if(!Ot||!Gt(Ot))return;var Kt=De.global,ct=Object.keys(Ot),Ye=!1,St=!1,Me=!1,tt=De.global.def("{}");ct.forEach(function(Dt){var Ht=Ot[Dt];if(an.isDynamic(Ht)){typeof Ht=="function"&&(Ht=Ot[Dt]=an.unbox(Ht));var Ir=Vs(Ht,null);Ye=Ye||Ir.thisDep,Me=Me||Ir.propDep,St=St||Ir.contextDep}else{switch(Kt(tt,".",Dt,"="),typeof Ht){case"number":Kt(Ht);break;case"string":Kt('"',Ht,'"');break;case"object":Array.isArray(Ht)&&Kt("[",Ht.join(),"]");break;default:Kt(De.link(Ht));break}Kt(";")}});function Be(Dt,Ht){ct.forEach(function(Ir){var on=Ot[Ir];if(!!an.isDynamic(on)){var ln=Dt.invoke(Ht,on);Ht(tt,".",Ir,"=",ln,";")}})}ye.dynamic[ot]=new an.DynamicVariable(Io,{thisDep:Ye,contextDep:St,propDep:Me,ref:tt,append:Be}),delete ye.static[ot]}function Yi(De,ye,ot,Ot,Kt){var ct=mi();ct.stats=ct.link(Kt),Object.keys(ye.static).forEach(function(St){Pn(ct,ye,St)}),$d.forEach(function(St){Pn(ct,De,St)});var Ye=Bo(De,ye,ot,Ot,ct);return ga(ct,Ye),or(ct,Ye),Ue(ct,Ye),y(ct.compile(),{destroy:function(){Ye.shader.program.destroy()}})}return{next:yn,current:Jr,procs:function(){var De=mi(),ye=De.proc("poll"),ot=De.proc("refresh"),Ot=De.block();ye(Ot),ot(Ot);var Kt=De.shared,ct=Kt.gl,Ye=Kt.next,St=Kt.current;Ot(St,".dirty=false;"),is(De,ye),is(De,ot,null,!0);var Me;Gr&&(Me=De.link(Gr)),$e.oes_vertex_array_object&&ot(De.link($e.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var tt=0;tt<tr.maxAttributes;++tt){var Be=ot.def(Kt.attributes,"[",tt,"]"),Dt=De.cond(Be,".buffer");Dt.then(ct,".enableVertexAttribArray(",tt,");",ct,".bindBuffer(",Us,",",Be,".buffer.buffer);",ct,".vertexAttribPointer(",tt,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(ct,".disableVertexAttribArray(",tt,");",ct,".vertexAttrib4f(",tt,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),ot(Dt),Gr&&ot(Me,".vertexAttribDivisorANGLE(",tt,",",Be,".divisor);")}return ot(De.shared.vao,".currentVAO=null;",De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"),Object.keys(Er).forEach(function(Ht){var Ir=Er[Ht],on=Ot.def(Ye,".",Ht),ln=De.block();ln("if(",on,"){",ct,".enable(",Ir,")}else{",ct,".disable(",Ir,")}",St,".",Ht,"=",on,";"),ot(ln),ye("if(",on,"!==",St,".",Ht,"){",ln,"}")}),Object.keys(Cr).forEach(function(Ht){var Ir=Cr[Ht],on=Jr[Ht],ln,bn,nn=De.block();if(nn(ct,".",Ir,"("),yo(on)){var zn=on.length;ln=De.global.def(Ye,".",Ht),bn=De.global.def(St,".",Ht),nn(rt(zn,function(Tn){return ln+"["+Tn+"]"}),");",rt(zn,function(Tn){return bn+"["+Tn+"]="+ln+"["+Tn+"];"}).join("")),ye("if(",rt(zn,function(Tn){return ln+"["+Tn+"]!=="+bn+"["+Tn+"]"}).join("||"),"){",nn,"}")}else ln=Ot.def(Ye,".",Ht),bn=Ot.def(St,".",Ht),nn(ln,");",St,".",Ht,"=",ln,";"),ye("if(",ln,"!==",bn,"){",nn,"}");ot(nn)}),De.compile()}(),compile:Yi}}function ev(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var tv=34918,Js=34919,Gf=35007,rv=function(V,Te){if(!Te.ext_disjoint_timer_query)return null;var $e=[];function tr(){return $e.pop()||Te.ext_disjoint_timer_query.createQueryEXT()}function wr(Gr){$e.push(Gr)}var rr=[];function br(Gr){var un=tr();Te.ext_disjoint_timer_query.beginQueryEXT(Gf,un),rr.push(un),Ur(rr.length-1,rr.length,Gr)}function Mr(){Te.ext_disjoint_timer_query.endQueryEXT(Gf)}function Nr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var jr=[];function qr(){return jr.pop()||new Nr}function Kr(Gr){jr.push(Gr)}var cn=[];function Ur(Gr,un,Tr){var Jr=qr();Jr.startQueryIndex=Gr,Jr.endQueryIndex=un,Jr.sum=0,Jr.stats=Tr,cn.push(Jr)}var Yr=[],Lt=[];function cr(){var Gr,un,Tr=rr.length;if(Tr!==0){Lt.length=Math.max(Lt.length,Tr+1),Yr.length=Math.max(Yr.length,Tr+1),Yr[0]=0,Lt[0]=0;var Jr=0;for(Gr=0,un=0;un<rr.length;++un){var yn=rr[un];Te.ext_disjoint_timer_query.getQueryObjectEXT(yn,Js)?(Jr+=Te.ext_disjoint_timer_query.getQueryObjectEXT(yn,tv),wr(yn)):rr[Gr++]=yn,Yr[un+1]=Jr,Lt[un+1]=Gr}for(rr.length=Gr,Gr=0,un=0;un<cn.length;++un){var ei=cn[un],Er=ei.startQueryIndex,Cr=ei.endQueryIndex;ei.sum+=Yr[Cr]-Yr[Er];var Rn=Lt[Er],hn=Lt[Cr];hn===Rn?(ei.stats.gpuTime+=ei.sum/1e6,Kr(ei)):(ei.startQueryIndex=Rn,ei.endQueryIndex=hn,cn[Gr++]=ei)}cn.length=Gr}}return{beginQuery:br,endQuery:Mr,pushScopeStats:Ur,update:cr,getNumPendingQueries:function(){return rr.length},clear:function(){$e.push.apply($e,rr);for(var Gr=0;Gr<$e.length;Gr++)Te.ext_disjoint_timer_query.deleteQueryEXT($e[Gr]);rr.length=0,$e.length=0},restore:function(){rr.length=0,$e.length=0}}},nv=16384,mh=256,cd=1024,fd=34962,$u="webglcontextlost",Za="webglcontextrestored",Xh=1,tc=2,Hf=3;function Rp(V,Te){for(var $e=0;$e<V.length;++$e)if(V[$e]===Te)return $e;return-1}function hd(V){var Te=we(V);if(!Te)return null;var $e=Te.gl,tr=$e.getContextAttributes(),wr=$e.isContextLost(),rr=ze($e,Te);if(!rr)return null;var br=Aa(),Mr=ev(),Nr=rr.extensions,jr=rv($e,Nr),qr=Hi(),Kr=$e.drawingBufferWidth,cn=$e.drawingBufferHeight,Ur={tick:0,time:0,viewportWidth:Kr,viewportHeight:cn,framebufferWidth:Kr,framebufferHeight:cn,drawingBufferWidth:Kr,drawingBufferHeight:cn,pixelRatio:Te.pixelRatio},Yr={},Lt={elements:null,primitive:4,count:-1,offset:0,instances:-1},cr=Rl($e,Nr),Gr=Z($e,Mr,Te,Jr),un=dl($e,Nr,Gr,Mr),Tr=Ut($e,Nr,cr,Mr,Gr,un,Lt);function Jr(gi){return Tr.destroyBuffer(gi)}var yn=Qr($e,br,Mr,Te),ei=Zs($e,Nr,cr,function(){Rn.procs.poll()},Ur,Mr,Te),Er=Gl($e,Nr,cr,Mr,Te),Cr=Re($e,Nr,cr,ei,Er,Mr),Rn=ld($e,br,Nr,cr,Gr,un,ei,Cr,Yr,Tr,yn,Lt,Ur,jr,Te),hn=ni($e,Cr,Rn.procs.poll,Ur,tr,Nr,cr),Vr=Rn.next,vn=$e.canvas,pn=[],Mi=[],mi=[],fn=[Te.onDestroy],xn=null;function ci(){if(pn.length===0){jr&&jr.update(),xn=null;return}xn=ui.next(ci),oo();for(var gi=pn.length-1;gi>=0;--gi){var Gi=pn[gi];Gi&&Gi(Ur,null,0)}$e.flush(),jr&&jr.update()}function Ci(){!xn&&pn.length>0&&(xn=ui.next(ci))}function ji(){xn&&(ui.cancel(ci),xn=null)}function Ma(gi){gi.preventDefault(),wr=!0,ji(),Mi.forEach(function(Gi){Gi()})}function bo(gi){$e.getError(),wr=!1,rr.restore(),yn.restore(),Gr.restore(),ei.restore(),Er.restore(),Cr.restore(),Tr.restore(),jr&&jr.restore(),Rn.procs.refresh(),Ci(),mi.forEach(function(Gi){Gi()})}var Zi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Zi&&vn&&(vn.addEventListener($u,Ma,!1),vn.addEventListener(Za,bo,!1));function ns(){pn.length=0,ji(),!Zi&&vn&&(vn.removeEventListener($u,Ma),vn.removeEventListener(Za,bo)),yn.clear(),Cr.clear(),Er.clear(),Tr.clear(),ei.clear(),un.clear(),Gr.clear(),jr&&jr.clear(),fn.forEach(function(gi){gi()})}function ja(gi){z(!!gi,"invalid args to regl({...})"),z.type(gi,"object","invalid args to regl({...})");function Gi(ct){var Ye=y({},ct);delete Ye.uniforms,delete Ye.attributes,delete Ye.context,delete Ye.vao,"stencil"in Ye&&Ye.stencil.op&&(Ye.stencil.opBack=Ye.stencil.opFront=Ye.stencil.op,delete Ye.stencil.op);function St(Me){if(Me in Ye){var tt=Ye[Me];delete Ye[Me],Object.keys(tt).forEach(function(Be){Ye[Me+"."+Be]=tt[Be]})}}return St("blend"),St("depth"),St("cull"),St("stencil"),St("polygonOffset"),St("scissor"),St("sample"),"vao"in ct&&(Ye.vao=ct.vao),Ye}function ga(ct,Ye){var St={},Me={};return Object.keys(ct).forEach(function(tt){var Be=ct[tt];if(an.isDynamic(Be)){Me[tt]=an.unbox(Be,tt);return}else if(Ye&&Array.isArray(Be)){for(var Dt=0;Dt<Be.length;++Dt)if(an.isDynamic(Be[Dt])){Me[tt]=an.unbox(Be,tt);return}}St[tt]=Be}),{dynamic:Me,static:St}}var po=ga(gi.context||{},!0),qu=ga(gi.uniforms||{},!0),Ue=ga(gi.attributes||{},!1),or=ga(Gi(gi),!1),Gt={gpuTime:0,cpuTime:0,count:0},Pn=Rn.compile(or,Ue,qu,po,Gt),Yi=Pn.draw,De=Pn.batch,ye=Pn.scope,ot=[];function Ot(ct){for(;ot.length<ct;)ot.push(null);return ot}function Kt(ct,Ye){var St;if(wr&&z.raise("context lost"),typeof ct=="function")return ye.call(this,null,ct,0);if(typeof Ye=="function")if(typeof ct=="number")for(St=0;St<ct;++St)ye.call(this,null,Ye,St);else if(Array.isArray(ct))for(St=0;St<ct.length;++St)ye.call(this,ct[St],Ye,St);else return ye.call(this,ct,Ye,0);else if(typeof ct=="number"){if(ct>0)return De.call(this,Ot(ct|0),ct|0)}else if(Array.isArray(ct)){if(ct.length)return De.call(this,ct,ct.length)}else return Yi.call(this,ct)}return y(Kt,{stats:Gt,destroy:function(){Pn.destroy()}})}var Bo=Cr.setFBO=ja({framebuffer:an.define.call(null,Xh,"framebuffer")});function Po(gi,Gi){var ga=0;Rn.procs.poll();var po=Gi.color;po&&($e.clearColor(+po[0]||0,+po[1]||0,+po[2]||0,+po[3]||0),ga|=nv),"depth"in Gi&&($e.clearDepth(+Gi.depth),ga|=mh),"stencil"in Gi&&($e.clearStencil(Gi.stencil|0),ga|=cd),z(!!ga,"called regl.clear with no buffer specified"),$e.clear(ga)}function is(gi){if(z(typeof gi=="object"&&gi,"regl.clear() takes an object as input"),"framebuffer"in gi)if(gi.framebuffer&&gi.framebuffer_reglType==="framebufferCube")for(var Gi=0;Gi<6;++Gi)Bo(y({framebuffer:gi.framebuffer.faces[Gi]},gi),Po);else Bo(gi,Po);else Po(null,gi)}function qo(gi){z.type(gi,"function","regl.frame() callback must be a function"),pn.push(gi);function Gi(){var ga=Rp(pn,gi);z(ga>=0,"cannot cancel a frame twice");function po(){var qu=Rp(pn,po);pn[qu]=pn[pn.length-1],pn.length-=1,pn.length<=0&&ji()}pn[ga]=po}return Ci(),{cancel:Gi}}function ps(){var gi=Vr.viewport,Gi=Vr.scissor_box;gi[0]=gi[1]=Gi[0]=Gi[1]=0,Ur.viewportWidth=Ur.framebufferWidth=Ur.drawingBufferWidth=gi[2]=Gi[2]=$e.drawingBufferWidth,Ur.viewportHeight=Ur.framebufferHeight=Ur.drawingBufferHeight=gi[3]=Gi[3]=$e.drawingBufferHeight}function oo(){Ur.tick+=1,Ur.time=No(),ps(),Rn.procs.poll()}function Ti(){ei.refresh(),ps(),Rn.procs.refresh(),jr&&jr.update()}function No(){return(Hi()-qr)/1e3}Ti();function sa(gi,Gi){z.type(Gi,"function","listener callback must be a function");var ga;switch(gi){case"frame":return qo(Gi);case"lost":ga=Mi;break;case"restore":ga=mi;break;case"destroy":ga=fn;break;default:z.raise("invalid event, must be one of frame,lost,restore,destroy")}return ga.push(Gi),{cancel:function(){for(var po=0;po<ga.length;++po)if(ga[po]===Gi){ga[po]=ga[ga.length-1],ga.pop();return}}}}var ds=y(ja,{clear:is,prop:an.define.bind(null,Xh),context:an.define.bind(null,tc),this:an.define.bind(null,Hf),draw:ja({}),buffer:function(gi){return Gr.create(gi,fd,!1,!1)},elements:function(gi){return un.create(gi,!1)},texture:ei.create2D,cube:ei.createCube,renderbuffer:Er.create,framebuffer:Cr.create,framebufferCube:Cr.createCube,vao:Tr.createVAO,attributes:tr,frame:qo,on:sa,limits:cr,hasExtension:function(gi){return cr.extensions.indexOf(gi.toLowerCase())>=0},read:hn,destroy:ns,_gl:$e,_refresh:Ti,poll:function(){oo(),jr&&jr.update()},now:No,stats:Mr});return Te.onDone(null,ds),ds}return hd})},44286:function(Fr){function fe(Q){return Q.split("")}Fr.exports=fe},18190:function(Fr){var fe=9007199254740991,Q=Math.floor;function Ae(re,y){var Se="";if(!re||y<1||y>fe)return Se;do y%2&&(Se+=re),y=Q(y/2),y&&(re+=re);while(y);return Se}Fr.exports=Ae},14259:function(Fr){function fe(Q,Ae,re){var y=-1,Se=Q.length;Ae<0&&(Ae=-Ae>Se?0:Se+Ae),re=re>Se?Se:re,re<0&&(re+=Se),Se=Ae>re?0:re-Ae>>>0,Ae>>>=0;for(var W=Array(Se);++y<Se;)W[y]=Q[y+Ae];return W}Fr.exports=fe},40180:function(Fr,fe,Q){var Ae=Q(14259);function re(y,Se,W){var ge=y.length;return W=W===void 0?ge:W,!Se&&W>=ge?y:Ae(y,Se,W)}Fr.exports=re},78302:function(Fr,fe,Q){var Ae=Q(18190),re=Q(80531),y=Q(40180),Se=Q(62689),W=Q(88016),ge=Q(83140),ce=Math.ceil;function Xe(me,qe){qe=qe===void 0?" ":re(qe);var lt=qe.length;if(lt<2)return lt?Ae(qe,me):qe;var bt=Ae(qe,ce(me/W(qe)));return Se(qe)?y(ge(bt),0,me).join(""):bt.slice(0,me)}Fr.exports=Xe},83140:function(Fr,fe,Q){var Ae=Q(44286),re=Q(62689),y=Q(676);function Se(W){return re(W)?y(W):Ae(W)}Fr.exports=Se},676:function(Fr){var fe="\\ud800-\\udfff",Q="\\u0300-\\u036f",Ae="\\ufe20-\\ufe2f",re="\\u20d0-\\u20ff",y=Q+Ae+re,Se="\\ufe0e\\ufe0f",W="["+fe+"]",ge="["+y+"]",ce="\\ud83c[\\udffb-\\udfff]",Xe="(?:"+ge+"|"+ce+")",me="[^"+fe+"]",qe="(?:\\ud83c[\\udde6-\\uddff]){2}",lt="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="\\u200d",Pt=Xe+"?",ur="["+Se+"]?",Nt="(?:"+bt+"(?:"+[me,qe,lt].join("|")+")"+ur+Pt+")*",pr=ur+Pt+Nt,Xt="(?:"+[me+ge+"?",ge,qe,lt,W].join("|")+")",It=RegExp(ce+"(?="+ce+")|"+Xt+pr,"g");function kt(_r){return _r.match(It)||[]}Fr.exports=kt},11726:function(Fr,fe,Q){var Ae=Q(78302),re=Q(88016),y=Q(40554),Se=Q(79833);function W(ge,ce,Xe){ge=Se(ge),ce=y(ce);var me=ce?re(ge):0;return ce&&me<ce?ge+Ae(ce-me,Xe):ge}Fr.exports=W},32475:function(Fr,fe,Q){var Ae=Q(78302),re=Q(88016),y=Q(40554),Se=Q(79833);function W(ge,ce,Xe){ge=Se(ge),ce=y(ce);var me=ce?re(ge):0;return ce&&me<ce?Ae(ce-me,Xe)+ge:ge}Fr.exports=W},6158:function(Fr){(function(fe,Q){Fr.exports=Q()})(this,function(){"use strict";var fe,Q,Ae;function re(y,Se){if(!fe)fe=Se;else if(!Q)Q=Se;else{var W="var sharedChunk = {}; ("+fe+")(sharedChunk); ("+Q+")(sharedChunk);",ge={};fe(ge),Ae=Se(ge),typeof window!="undefined"&&(Ae.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return re(["exports"],function(y){"use strict";function Se(a,s){return a(s={exports:{}},s.exports),s.exports}var W=ge;function ge(a,s,l,m){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=l,this.p2y=m}ge.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},ge.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},ge.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},ge.prototype.solveCurveX=function(a,s){var l,m,_,E,A;for(s===void 0&&(s=1e-6),_=a,A=0;A<8;A++){if(E=this.sampleCurveX(_)-a,Math.abs(E)<s)return _;var P=this.sampleCurveDerivativeX(_);if(Math.abs(P)<1e-6)break;_-=E/P}if((_=a)<(l=0))return l;if(_>(m=1))return m;for(;l<m;){if(E=this.sampleCurveX(_),Math.abs(E-a)<s)return _;a>E?l=_:m=_,_=.5*(m-l)+l}return _},ge.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var ce=Xe;function Xe(a,s){this.x=a,this.y=s}Xe.prototype={clone:function(){return new Xe(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,l=a.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),l=Math.sin(a),m=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=m,this},_rotateAround:function(a,s){var l=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Xe.convert=function(a){return a instanceof Xe?a:Array.isArray(a)?new Xe(a[0],a[1]):a};var me=typeof self!="undefined"?self:{},qe=Math.pow(2,53)-1;function lt(a,s,l,m){var _=new W(a,s,l,m);return function(E){return _.solve(E)}}var bt=lt(.25,.1,.25,1);function Pt(a,s,l){return Math.min(l,Math.max(s,a))}function ur(a,s,l){var m=l-s,_=((a-s)%m+m)%m+s;return _===s?l:_}function Nt(a){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var m=0,_=s;m<_.length;m+=1){var E=_[m];for(var A in E)a[A]=E[A]}return a}var pr=1;function Xt(){return pr++}function It(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function kt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function _r(a,s){a.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function J(a,s){return a.indexOf(s,a.length-s.length)!==-1}function lr(a,s,l){var m={};for(var _ in a)m[_]=s.call(l||this,a[_],_,a);return m}function Tt(a,s,l){var m={};for(var _ in a)s.call(l||this,a[_],_,a)&&(m[_]=a[_]);return m}function ht(a){return Array.isArray(a)?a.map(ht):typeof a=="object"&&a?lr(a,ht):a}var Wt={};function mt(a){Wt[a]||(typeof console!="undefined"&&console.warn(a),Wt[a]=!0)}function fr(a,s,l){return(l.y-a.y)*(s.x-a.x)>(s.y-a.y)*(l.x-a.x)}function Lr(a){for(var s=0,l=0,m=a.length,_=m-1,E=void 0,A=void 0;l<m;_=l++)s+=((A=a[_]).x-(E=a[l]).x)*(E.y+A.y);return s}function te(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ne(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,E,A){var P=E||A;return s[_]=!P||P.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var N=null;function U(a){if(N==null){var s=a.navigator?a.navigator.userAgent:null;N=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return N}function le(a){try{var s=me[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var He,Je,ft,Vt,nr=me.performance&&me.performance.now?me.performance.now.bind(me.performance):Date.now.bind(Date),Zr=me.requestAnimationFrame||me.mozRequestAnimationFrame||me.webkitRequestAnimationFrame||me.msRequestAnimationFrame,Dr=me.cancelAnimationFrame||me.mozCancelAnimationFrame||me.webkitCancelAnimationFrame||me.msCancelAnimationFrame,Xn={now:nr,frame:function(a){var s=Zr(a);return{cancel:function(){return Dr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var l=me.document.createElement("canvas"),m=l.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return He||(He=me.document.createElement("a")),He.href=a,He.href},hardwareConcurrency:me.navigator&&me.navigator.hardwareConcurrency||4,get devicePixelRatio(){return me.devicePixelRatio},get prefersReducedMotion(){return!!me.matchMedia&&(Je==null&&(Je=me.matchMedia("(prefers-reduced-motion: reduce)")),Je.matches)}},sn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Nn={supported:!1,testSupport:function(a){!ra&&Vt&&(xi?si(a):ft=a)}},ra=!1,xi=!1;function si(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Vt),a.isContextLost())return;Nn.supported=!0}catch(l){}a.deleteTexture(s),ra=!0}me.document&&((Vt=me.document.createElement("img")).onload=function(){ft&&si(ft),ft=null,xi=!0},Vt.onerror=function(){ra=!0,ft=null},Vt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ri="01",ki=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function di(a){return a.indexOf("mapbox:")===0}ki.prototype._createSkuToken=function(){var a=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ri,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},ki.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ki.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},ki.prototype.normalizeStyleURL=function(a,s){if(!di(a))return a;var l=Na(a);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},ki.prototype.normalizeGlyphsURL=function(a,s){if(!di(a))return a;var l=Na(a);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},ki.prototype.normalizeSourceURL=function(a,s){if(!di(a))return a;var l=Na(a);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},ki.prototype.normalizeSpriteURL=function(a,s,l,m){var _=Na(a);return di(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+l,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+l,ma(_))},ki.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!di(a))return a;var l=Na(a);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Xn.devicePixelRatio>=2||s===512?"@2x":"")+(Nn.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var m=this._customAccessToken||function(_){for(var E=0,A=_;E<A.length;E+=1){var P=A[E].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(l.params)||sn.ACCESS_TOKEN;return sn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,m)},ki.prototype.canonicalizeTileURL=function(a,s){var l=Na(a);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=l.path.replace("/v4/","");var _=l.params;return s&&(_=_.filter(function(E){return!E.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},ki.prototype.canonicalizeTileset=function(a,s){for(var l=!!s&&di(s),m=[],_=0,E=a.tiles||[];_<E.length;_+=1){var A=E[_];ri(A)?m.push(this.canonicalizeTileURL(A,l)):m.push(A)}return m},ki.prototype._makeAPIURL=function(a,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Na(sn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!sn.REQUIRE_ACCESS_TOKEN)return ma(a);if(!(s=s||sn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return a.params=a.params.filter(function(E){return E.indexOf("access_token")===-1}),a.params.push("access_token="+s),ma(a)};var Yn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ri(a){return Yn.test(a)}var Ao=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Na(a){var s=a.match(Ao);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function ma(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function wt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(me.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var ve=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ve.prototype.getStorageKey=function(a){var s,l=wt(sn.ACCESS_TOKEN);return s=l&&l.u?me.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):sn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},ve.prototype.fetchEventData=function(){var a=le("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(a)try{var m=me.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=me.localStorage.getItem(l);_&&(this.anonId=_)}catch(E){mt("Unable to read from LocalStorage")}},ve.prototype.saveEventData=function(){var a=le("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(a)try{me.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&me.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){mt("Unable to write to LocalStorage")}},ve.prototype.processRequests=function(a){},ve.prototype.postEvent=function(a,s,l,m){var _=this;if(sn.EVENTS_URL){var E=Na(sn.EVENTS_URL);E.params.push("access_token="+(m||sn.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ri,userId:this.anonId},P=s?Nt(A,s):A,F={url:ma(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Ki(F,function(j){_.pendingRequest=null,l(j),_.saveEventData(),_.processRequests(m)})}},ve.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var se,xe,z=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,m,_,E){this.skuToken=_,(sn.EVENTS_URL&&E||sn.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(A){return di(A)||ri(A)}))&&this.queueRequest({id:m,timestamp:Date.now()},E)},s.prototype.processRequests=function(l){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),E=_.id,A=_.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),kt(this.anonId)||(this.anonId=It()),this.postEvent(A,{skuToken:this.skuToken},function(P){P||E&&(m.success[E]=!0)},l))}},s}(ve),et=new(function(a){function s(l){a.call(this,"appUserTurnstile"),this._customAccessToken=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,m){sn.EVENTS_URL&&sn.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(_){return di(_)||ri(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(l){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=wt(sn.ACCESS_TOKEN),E=_?_.u:sn.ACCESS_TOKEN,A=E!==this.eventData.tokenU;kt(this.anonId)||(this.anonId=It(),A=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),j=new Date(P),$=(P-this.eventData.lastSuccess)/864e5;A=A||$>=1||$<-1||F.getDate()!==j.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(K){K||(m.eventData.lastSuccess=P,m.eventData.tokenU=E)},l)}},s}(ve)),Qt=et.postTurnstileEvent.bind(et),zr=new z,Ke=zr.postMapLoadEvent.bind(zr),Rt=500,vr=50;function Pr(){me.caches&&!se&&(se=me.caches.open("mapbox-tiles"))}function Xr(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var rn,jn=1/0;function Zn(){return rn==null&&(rn=me.OffscreenCanvas&&new me.OffscreenCanvas(1,1).getContext("2d")&&typeof me.createImageBitmap=="function"),rn}var an={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(an);var ui=function(a){function s(l,m,_){m===401&&ri(_)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,l),this.status=m,this.url=_,this.name=this.constructor.name,this.message=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),fi=te()?function(){return self.worker&&self.worker.referrer}:function(){return(me.location.protocol==="blob:"?me.parent:me).location.href},Hi,Aa,Pa=function(a,s){if(!(/^file:/.test(l=a.url)||/^file:/.test(fi())&&!/^\w+:/.test(l))){if(me.fetch&&me.Request&&me.AbortController&&me.Request.prototype.hasOwnProperty("signal"))return function(m,_){var E,A=new me.AbortController,P=new me.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:fi(),signal:A.signal}),F=!1,j=!1,$=(E=P.url).indexOf("sku=")>0&&ri(E);m.type==="json"&&P.headers.set("Accept","application/json");var K=function(de,Ve,Ge){if(!j){if(de&&de.message!=="SecurityError"&&mt(de),Ve&&Ge)return ue(Ve);var ut=Date.now();me.fetch(P).then(function(Qe){if(Qe.ok){var Mt=$?Qe.clone():null;return ue(Qe,Mt,ut)}return _(new ui(Qe.statusText,Qe.status,m.url))}).catch(function(Qe){Qe.code!==20&&_(new Error(Qe.message))})}},ue=function(de,Ve,Ge){(m.type==="arrayBuffer"?de.arrayBuffer():m.type==="json"?de.json():de.text()).then(function(ut){j||(Ve&&Ge&&function(Qe,Mt,jt){if(Pr(),se){var ir={status:Mt.status,statusText:Mt.statusText,headers:new me.Headers};Mt.headers.forEach(function(Ar,Wr){return ir.headers.set(Wr,Ar)});var hr=Ne(Mt.headers.get("Cache-Control")||"");hr["no-store"]||(hr["max-age"]&&ir.headers.set("Expires",new Date(jt+1e3*hr["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-jt<42e4||function(Ar,Wr){if(xe===void 0)try{new Response(new ReadableStream),xe=!0}catch(tn){xe=!1}xe?Wr(Ar.body):Ar.blob().then(Wr)}(Mt,function(Ar){var Wr=new me.Response(Ar,ir);Pr(),se&&se.then(function(tn){return tn.put(Xr(Qe.url),Wr)}).catch(function(tn){return mt(tn.message)})}))}}(P,Ve,Ge),F=!0,_(null,ut,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(ut){j||_(new Error(ut.message))})};return $?function(de,Ve){if(Pr(),!se)return Ve(null);var Ge=Xr(de.url);se.then(function(ut){ut.match(Ge).then(function(Qe){var Mt=function(jt){if(!jt)return!1;var ir=new Date(jt.headers.get("Expires")||0),hr=Ne(jt.headers.get("Cache-Control")||"");return ir>Date.now()&&!hr["no-cache"]}(Qe);ut.delete(Ge),Mt&&ut.put(Ge,Qe.clone()),Ve(null,Qe,Mt)}).catch(Ve)}).catch(Ve)}(P,K):K(null,null),{cancel:function(){j=!0,F||A.abort()}}}(a,s);if(te()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var l;return function(m,_){var E=new me.XMLHttpRequest;for(var A in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(A,m.headers[A]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){_(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var P=E.response;if(m.type==="json")try{P=JSON.parse(E.response)}catch(F){return _(F)}_(null,P,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else _(new ui(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(a,s)},ba=function(a,s){return Pa(Nt(a,{type:"arrayBuffer"}),s)},Ki=function(a,s){return Pa(Nt(a,{method:"POST"}),s)},q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Hi=[],Aa=0;var ie=function(a,s){if(Nn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Aa>=sn.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Hi.push(l),l}Aa++;var m=!1,_=function(){if(!m)for(m=!0,Aa--;Hi.length&&Aa<sn.MAX_PARALLEL_IMAGE_REQUESTS;){var A=Hi.shift();A.cancelled||(A.cancel=ie(A.requestParameters,A.callback).cancel)}},E=ba(a,function(A,P,F,j){_(),A?s(A):P&&(Zn()?function($,K){var ue=new me.Blob([new Uint8Array($)],{type:"image/png"});me.createImageBitmap(ue).then(function(de){K(null,de)}).catch(function(de){K(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,s):function($,K,ue,de){var Ve=new me.Image,Ge=me.URL;Ve.onload=function(){K(null,Ve),Ge.revokeObjectURL(Ve.src),Ve.onload=null,me.requestAnimationFrame(function(){Ve.src=q})},Ve.onerror=function(){return K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ut=new me.Blob([new Uint8Array($)],{type:"image/png"});Ve.cacheControl=ue,Ve.expires=de,Ve.src=$.byteLength?Ge.createObjectURL(ut):q}(P,s,F,j))});return{cancel:function(){E.cancel(),_()}}};function pe(a,s,l){l[a]&&l[a].indexOf(s)!==-1||(l[a]=l[a]||[],l[a].push(s))}function we(a,s,l){if(l&&l[a]){var m=l[a].indexOf(s);m!==-1&&l[a].splice(m,1)}}var ze=function(a,s){s===void 0&&(s={}),Nt(this,s),this.type=a},rt=function(a){function s(l,m){m===void 0&&(m={}),a.call(this,"error",Nt({error:l},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(ze),_t=function(){};_t.prototype.on=function(a,s){return this._listeners=this._listeners||{},pe(a,s,this._listeners),this},_t.prototype.off=function(a,s){return we(a,s,this._listeners),we(a,s,this._oneTimeListeners),this},_t.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},pe(a,s,this._oneTimeListeners),this},_t.prototype.fire=function(a,s){typeof a=="string"&&(a=new ze(a,s||{}));var l=a.type;if(this.listens(l)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var E=0,A=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];E<A.length;E+=1){var P=A[E];we(l,P,this._oneTimeListeners),P.call(this,a)}var F=this._eventedParent;F&&(Nt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(a))}else a instanceof rt&&console.error(a.error);return this},_t.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},_t.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},We=function(a,s,l,m){this.message=(a?a+": ":"")+l,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function zt(a){var s=a.value;return s?[new We(a.key,s,"constants have been deprecated as of v8")]:[]}function Rr(a){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var m=0,_=s;m<_.length;m+=1){var E=_[m];for(var A in E)a[A]=E[A]}return a}function er(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ar(a){if(Array.isArray(a))return a.map(ar);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var l in a)s[l]=ar(a[l]);return s}return er(a)}var Or=function(a){function s(l,m){a.call(this,m),this.message=m,this.key=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),Dn=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var l=0,m=s;l<m.length;l+=1){var _=m[l];this.bindings[_[0]]=_[1]}};Dn.prototype.concat=function(a){return new Dn(this,a)},Dn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},Dn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var In={kind:"null"},qt={kind:"number"},Cn={kind:"string"},mr={kind:"boolean"},pt={kind:"color"},Ei={kind:"object"},gn={kind:"value"},Pi={kind:"collator"},na={kind:"formatted"},vt={kind:"resolvedImage"};function xt(a,s){return{kind:"array",itemType:a,N:s}}function Ii(a){if(a.kind==="array"){var s=Ii(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var hi=[In,qt,Cn,mr,pt,na,Ei,xt(gn),vt];function Qi(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Qi(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var l=0,m=hi;l<m.length;l+=1)if(!Qi(m[l],s))return null}}return"Expected "+Ii(a)+" but found "+Ii(s)+" instead."}function Ji(a,s){return s.some(function(l){return l.kind===a.kind})}function ia(a,s){return s.some(function(l){return l==="null"?a===null:l==="array"?Array.isArray(a):l==="object"?a&&!Array.isArray(a)&&typeof a=="object":l===typeof a})}var Fi=Se(function(a,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(P){return(P=Math.round(P))<0?0:P>255?255:P}function _(P){return m(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function E(P){return(F=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:F>1?1:F;var F}function A(P,F,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?P+(F-P)*j*6:2*j<1?F:3*j<2?P+(F-P)*(2/3-j)*6:P}try{s.parseCSSColor=function(P){var F,j=P.replace(/ /g,"").toLowerCase();if(j in l)return l[j].slice();if(j[0]==="#")return j.length===4?(F=parseInt(j.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:j.length===7&&(F=parseInt(j.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var $=j.indexOf("("),K=j.indexOf(")");if($!==-1&&K+1===j.length){var ue=j.substr(0,$),de=j.substr($+1,K-($+1)).split(","),Ve=1;switch(ue){case"rgba":if(de.length!==4)return null;Ve=E(de.pop());case"rgb":return de.length!==3?null:[_(de[0]),_(de[1]),_(de[2]),Ve];case"hsla":if(de.length!==4)return null;Ve=E(de.pop());case"hsl":if(de.length!==3)return null;var Ge=(parseFloat(de[0])%360+360)%360/360,ut=E(de[1]),Qe=E(de[2]),Mt=Qe<=.5?Qe*(ut+1):Qe+ut-Qe*ut,jt=2*Qe-Mt;return[m(255*A(jt,Mt,Ge+1/3)),m(255*A(jt,Mt,Ge)),m(255*A(jt,Mt,Ge-1/3)),Ve];default:return null}}return null}}catch(P){}}).parseCSSColor,sr=function(a,s,l,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=l,this.a=m};sr.parse=function(a){if(a){if(a instanceof sr)return a;if(typeof a=="string"){var s=Fi(a);if(s)return new sr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},sr.prototype.toString=function(){var a=this.toArray(),s=a[1],l=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(l)+","+m+")"},sr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},sr.black=new sr(0,0,0,1),sr.white=new sr(1,1,1,1),sr.transparent=new sr(0,0,0,0),sr.red=new sr(1,0,0,1);var xr=function(a,s,l){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};xr.prototype.compare=function(a,s){return this.collator.compare(a,s)},xr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var je=function(a,s,l,m,_){this.text=a,this.image=s,this.scale=l,this.fontStack=m,this.textColor=_},wa=function(a){this.sections=a};wa.fromString=function(a){return new wa([new je(a,null,null,null,null)])},wa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},wa.factory=function(a){return a instanceof wa?a:wa.fromString(a)},wa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},wa.prototype.serialize=function(){for(var a=["format"],s=0,l=this.sections;s<l.length;s+=1){var m=l[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var Le=function(a){this.name=a.name,this.available=a.available};function As(a,s,l,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,l,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,l,m]:[a,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function us(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof sr||a instanceof xr||a instanceof wa||a instanceof Le)return!0;if(Array.isArray(a)){for(var s=0,l=a;s<l.length;s+=1)if(!us(l[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!us(a[m]))return!1;return!0}return!1}function ta(a){if(a===null)return In;if(typeof a=="string")return Cn;if(typeof a=="boolean")return mr;if(typeof a=="number")return qt;if(a instanceof sr)return pt;if(a instanceof xr)return Pi;if(a instanceof wa)return na;if(a instanceof Le)return vt;if(Array.isArray(a)){for(var s,l=a.length,m=0,_=a;m<_.length;m+=1){var E=ta(_[m]);if(s){if(s===E)continue;s=gn;break}s=E}return xt(s||gn,l)}return Ei}function Ys(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof sr||a instanceof wa||a instanceof Le?a.toString():JSON.stringify(a)}Le.prototype.toString=function(){return this.name},Le.fromString=function(a){return a?new Le({name:a,available:!1}):null},Le.prototype.serialize=function(){return["image",this.name]};var no=function(a,s){this.type=a,this.value=s};no.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!us(a[1]))return s.error("invalid value");var l=a[1],m=ta(l),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new no(m,l)},no.prototype.evaluate=function(){return this.value},no.prototype.eachChild=function(){},no.prototype.outputDefined=function(){return!0},no.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof sr?["rgba"].concat(this.value.toArray()):this.value instanceof wa?this.value.serialize():this.value};var Wa=function(a){this.name="ExpressionEvaluationError",this.message=a};Wa.prototype.toJSON=function(){return this.message};var io={string:Cn,number:qt,boolean:mr,object:Ei},aa=function(a,s){this.type=a,this.args=s};aa.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var l,m=1,_=a[0];if(_==="array"){var E,A;if(a.length>2){var P=a[1];if(typeof P!="string"||!(P in io)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);E=io[P],m++}else E=gn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);A=a[2],m++}l=xt(E,A)}else l=io[_];for(var F=[];m<a.length;m++){var j=s.parse(a[m],m,gn);if(!j)return null;F.push(j)}return new aa(l,F)},aa.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(a);if(!Qi(this.type,ta(l)))return l;if(s===this.args.length-1)throw new Wa("Expected value to be of type "+Ii(this.type)+", but found "+Ii(ta(l))+" instead.")}return null},aa.prototype.eachChild=function(a){this.args.forEach(a)},aa.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},aa.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var l=a.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var jo=function(a){this.type=na,this.sections=a};jo.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var l=a[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,E=1;E<=a.length-1;++E){var A=a[E];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;var P=null;if(A["font-scale"]&&!(P=s.parse(A["font-scale"],1,qt)))return null;var F=null;if(A["text-font"]&&!(F=s.parse(A["text-font"],1,xt(Cn))))return null;var j=null;if(A["text-color"]&&!(j=s.parse(A["text-color"],1,pt)))return null;var $=m[m.length-1];$.scale=P,$.font=F,$.textColor=j}else{var K=s.parse(a[E],1,gn);if(!K)return null;var ue=K.type.kind;if(ue!=="string"&&ue!=="value"&&ue!=="null"&&ue!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:K,scale:null,font:null,textColor:null})}}return new jo(m)},jo.prototype.evaluate=function(a){return new wa(this.sections.map(function(s){var l=s.content.evaluate(a);return ta(l)===vt?new je("",l,null,null,null):new je(Ys(l),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},jo.prototype.eachChild=function(a){for(var s=0,l=this.sections;s<l.length;s+=1){var m=l[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){for(var a=["format"],s=0,l=this.sections;s<l.length;s+=1){var m=l[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var Qo=function(a){this.type=vt,this.input=a};Qo.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var l=s.parse(a[1],1,Cn);return l?new Qo(l):s.error("No image name provided.")},Qo.prototype.evaluate=function(a){var s=this.input.evaluate(a),l=Le.fromString(s);return l&&a.availableImages&&(l.available=a.availableImages.indexOf(s)>-1),l},Qo.prototype.eachChild=function(a){a(this.input)},Qo.prototype.outputDefined=function(){return!1},Qo.prototype.serialize=function(){return["image",this.input.serialize()]};var Au={"to-boolean":mr,"to-color":pt,"to-number":qt,"to-string":Cn},wo=function(a,s){this.type=a,this.args=s};wo.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var l=a[0];if((l==="to-boolean"||l==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=Au[l],_=[],E=1;E<a.length;E++){var A=s.parse(a[E],E,gn);if(!A)return null;_.push(A)}return new wo(m,_)},wo.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,l,m=0,_=this.args;m<_.length;m+=1){if(l=null,(s=_[m].evaluate(a))instanceof sr)return s;if(typeof s=="string"){var E=a.parseColor(s);if(E)return E}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":As(s[0],s[1],s[2],s[3])))return new sr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Wa(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var A=null,P=0,F=this.args;P<F.length;P+=1){if((A=F[P].evaluate(a))===null)return 0;var j=Number(A);if(!isNaN(j))return j}throw new Wa("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?wa.fromString(Ys(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Le.fromString(Ys(this.args[0].evaluate(a))):Ys(this.args[0].evaluate(a))},wo.prototype.eachChild=function(a){this.args.forEach(a)},wo.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},wo.prototype.serialize=function(){if(this.type.kind==="formatted")return new jo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Qo(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var To=["Unknown","Point","LineString","Polygon"],la=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};la.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},la.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?To[this.feature.type]:this.feature.type:null},la.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},la.prototype.canonicalID=function(){return this.canonical},la.prototype.properties=function(){return this.feature&&this.feature.properties||{}},la.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=sr.parse(a)),s};var ao=function(a,s,l,m){this.name=a,this.type=s,this._evaluate=l,this.args=m};ao.prototype.evaluate=function(a){return this._evaluate(a,this.args)},ao.prototype.eachChild=function(a){this.args.forEach(a)},ao.prototype.outputDefined=function(){return!1},ao.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},ao.parse=function(a,s){var l,m=a[0],_=ao.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(_)?_[0]:_.type,A=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,P=A.filter(function(ti){var On=ti[0];return!Array.isArray(On)||On.length===a.length-1}),F=null,j=0,$=P;j<$.length;j+=1){var K=$[j],ue=K[0],de=K[1];F=new iu(s.registry,s.path,null,s.scope);for(var Ve=[],Ge=!1,ut=1;ut<a.length;ut++){var Qe=a[ut],Mt=Array.isArray(ue)?ue[ut-1]:ue.type,jt=F.parse(Qe,1+Ve.length,Mt);if(!jt){Ge=!0;break}Ve.push(jt)}if(!Ge)if(Array.isArray(ue)&&ue.length!==Ve.length)F.error("Expected "+ue.length+" arguments, but found "+Ve.length+" instead.");else{for(var ir=0;ir<Ve.length;ir++){var hr=Array.isArray(ue)?ue[ir]:ue.type,Ar=Ve[ir];F.concat(ir+1).checkSubtype(hr,Ar.type)}if(F.errors.length===0)return new ao(m,E,de,Ve)}}if(P.length===1)(l=s.errors).push.apply(l,F.errors);else{for(var Wr=(P.length?P:A).map(function(ti){var On;return On=ti[0],Array.isArray(On)?"("+On.map(Ii).join(", ")+")":"("+Ii(On.type)+"...)"}).join(" | "),tn=[],qn=1;qn<a.length;qn++){var Mn=s.parse(a[qn],1+tn.length);if(!Mn)return null;tn.push(Ii(Mn.type))}s.error("Expected arguments of type "+Wr+", but found ("+tn.join(", ")+") instead.")}return null},ao.register=function(a,s){for(var l in ao.definitions=s,s)a[l]=ao};var Go=function(a,s,l){this.type=Pi,this.locale=l,this.caseSensitive=a,this.diacriticSensitive=s};function qa(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function nu(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Rl(a,s){var l=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(l*_*8192),Math.round(m*_*8192)]}function Jo(a,s,l){return s[1]>a[1]!=l[1]>a[1]&&a[0]<(l[0]-s[0])*(a[1]-s[1])/(l[1]-s[1])+s[0]}function he(a,s){for(var l,m,_,E,A,P,F,j=!1,$=0,K=s.length;$<K;$++)for(var ue=s[$],de=0,Ve=ue.length;de<Ve-1;de++){if((E=(l=a)[0]-(m=ue[de])[0])*(F=l[1]-(_=ue[de+1])[1])-(P=l[0]-_[0])*(A=l[1]-m[1])==0&&E*P<=0&&A*F<=0)return!1;Jo(a,ue[de],ue[de+1])&&(j=!j)}return j}function Pe(a,s){for(var l=0;l<s.length;l++)if(he(a,s[l]))return!0;return!1}function dt(a,s,l,m){var _=m[0]-l[0],E=m[1]-l[1],A=(a[0]-l[0])*E-_*(a[1]-l[1]),P=(s[0]-l[0])*E-_*(s[1]-l[1]);return A>0&&P<0||A<0&&P>0}function Jt(a,s,l){for(var m=0,_=l;m<_.length;m+=1)for(var E=_[m],A=0;A<E.length-1;++A)if((K=[($=E[A+1])[0]-(j=E[A])[0],$[1]-j[1]])[0]*(ue=[(F=s)[0]-(P=a)[0],F[1]-P[1]])[1]-K[1]*ue[0]!=0&&dt(P,F,j,$)&&dt(j,$,P,F))return!0;var P,F,j,$,K,ue;return!1}function en(a,s){for(var l=0;l<a.length;++l)if(!he(a[l],s))return!1;for(var m=0;m<a.length-1;++m)if(Jt(a[m],a[m+1],s))return!1;return!0}function Gn(a,s){for(var l=0;l<s.length;l++)if(en(a,s[l]))return!0;return!1}function Bi(a,s,l){for(var m=[],_=0;_<a.length;_++){for(var E=[],A=0;A<a[_].length;A++){var P=Rl(a[_][A],l);qa(s,P),E.push(P)}m.push(E)}return m}function fo(a,s,l){for(var m=[],_=0;_<a.length;_++){var E=Bi(a[_],s,l);m.push(E)}return m}function za(a,s,l,m){if(a[0]<l[0]||a[0]>l[2]){var _=.5*m,E=a[0]-l[0]>_?-m:l[0]-a[0]>_?m:0;E===0&&(E=a[0]-l[2]>_?-m:l[2]-a[0]>_?m:0),a[0]+=E}qa(s,a)}function Ka(a,s,l,m){for(var _=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],A=[],P=0,F=a;P<F.length;P+=1)for(var j=0,$=F[P];j<$.length;j+=1){var K=$[j],ue=[K.x+E[0],K.y+E[1]];za(ue,s,l,_),A.push(ue)}return A}function es(a,s,l,m){for(var _,E=8192*Math.pow(2,m.z),A=[8192*m.x,8192*m.y],P=[],F=0,j=a;F<j.length;F+=1){for(var $=[],K=0,ue=j[F];K<ue.length;K+=1){var de=ue[K],Ve=[de.x+A[0],de.y+A[1]];qa(s,Ve),$.push(Ve)}P.push($)}if(s[2]-s[0]<=E/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Ge=0,ut=P;Ge<ut.length;Ge+=1)for(var Qe=0,Mt=ut[Ge];Qe<Mt.length;Qe+=1)za(Mt[Qe],s,l,E)}return P}Go.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var l=a[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var m=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,mr);if(!m)return null;var _=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,mr);if(!_)return null;var E=null;return l.locale&&!(E=s.parse(l.locale,1,Cn))?null:new Go(m,_,E)},Go.prototype.evaluate=function(a){return new xr(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Go.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Oo=function(a,s){this.type=mr,this.geojson=a,this.geometries=s};function go(a){if(a instanceof ao&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Oo)return!1;var s=!0;return a.eachChild(function(l){s&&!go(l)&&(s=!1)}),s}function ws(a){if(a instanceof ao&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(l){s&&!ws(l)&&(s=!1)}),s}function Ts(a,s){if(a instanceof ao&&s.indexOf(a.name)>=0)return!1;var l=!0;return a.eachChild(function(m){l&&!Ts(m,s)&&(l=!1)}),l}Oo.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(us(a[1])){var l=a[1];if(l.type==="FeatureCollection")for(var m=0;m<l.features.length;++m){var _=l.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Oo(l,l.features[m].geometry)}else if(l.type==="Feature"){var E=l.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Oo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Oo(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Oo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,l){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=s.canonicalID();if(l.type==="Polygon"){var A=Bi(l.coordinates,_,E),P=Ka(s.geometry(),m,_,E);if(!nu(m,_))return!1;for(var F=0,j=P;F<j.length;F+=1)if(!he(j[F],A))return!1}if(l.type==="MultiPolygon"){var $=fo(l.coordinates,_,E),K=Ka(s.geometry(),m,_,E);if(!nu(m,_))return!1;for(var ue=0,de=K;ue<de.length;ue+=1)if(!Pe(de[ue],$))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,l){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=s.canonicalID();if(l.type==="Polygon"){var A=Bi(l.coordinates,_,E),P=es(s.geometry(),m,_,E);if(!nu(m,_))return!1;for(var F=0,j=P;F<j.length;F+=1)if(!en(j[F],A))return!1}if(l.type==="MultiPolygon"){var $=fo(l.coordinates,_,E),K=es(s.geometry(),m,_,E);if(!nu(m,_))return!1;for(var ue=0,de=K;ue<de.length;ue+=1)if(!Gn(de[ue],$))return!1}return!0}(a,this.geometries)}return!1},Oo.prototype.eachChild=function(){},Oo.prototype.outputDefined=function(){return!0},Oo.prototype.serialize=function(){return["within",this.geojson]};var Ms=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};Ms.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=a[1];return s.scope.has(l)?new Ms(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},Ms.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Ms.prototype.eachChild=function(){},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){return["var",this.name]};var iu=function(a,s,l,m,_){s===void 0&&(s=[]),m===void 0&&(m=new Dn),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=l};function vu(a,s){for(var l,m=a.length-1,_=0,E=m,A=0;_<=E;)if((l=a[A=Math.floor((_+E)/2)])<=s){if(A===m||s<a[A+1])return A;_=A+1}else{if(!(l>s))throw new Wa("Input is not a number.");E=A-1}return 0}iu.prototype.parse=function(a,s,l,m,_){return _===void 0&&(_={}),s?this.concat(s,l,m)._parse(a,_):this._parse(a,_)},iu.prototype._parse=function(a,s){function l(j,$,K){return K==="assert"?new aa($,[j]):K==="coerce"?new wo($,[j]):j}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var E=_.parse(a,this);if(!E)return null;if(this.expectedType){var A=this.expectedType,P=E.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else E=l(E,A,s.typeAnnotation||"coerce");else E=l(E,A,s.typeAnnotation||"assert")}if(!(E instanceof no)&&E.type.kind!=="resolvedImage"&&function j($){if($ instanceof Ms)return j($.boundExpression);if($ instanceof ao&&$.name==="error"||$ instanceof Go||$ instanceof Oo)return!1;var K=$ instanceof wo||$ instanceof aa,ue=!0;return $.eachChild(function(de){ue=K?ue&&j(de):ue&&de instanceof no}),!!ue&&go($)&&Ts($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var F=new la;try{E=new no(E.type,E.evaluate(F))}catch(j){return this.error(j.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},iu.prototype.concat=function(a,s,l){var m=typeof a=="number"?this.path.concat(a):this.path,_=l?this.scope.concat(l):this.scope;return new iu(this.registry,m,s||null,_,this.errors)},iu.prototype.error=function(a){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Or(m,a))},iu.prototype.checkSubtype=function(a,s){var l=Qi(a,s);return l&&this.error(l),l};var ys=function(a,s,l){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=l;m<_.length;m+=1){var E=_[m],A=E[1];this.labels.push(E[0]),this.outputs.push(A)}};function zi(a,s,l){return a*(1-l)+s*l}ys.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(a[1],1,qt);if(!l)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var E=1;E<a.length;E+=2){var A=E===1?-1/0:a[E],P=a[E+1],F=E,j=E+1;if(typeof A!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(m.length&&m[m.length-1][0]>=A)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var $=s.parse(P,j,_);if(!$)return null;_=_||$.type,m.push([A,$])}return new ys(_,l,m)},ys.prototype.evaluate=function(a){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return l[0].evaluate(a);var _=s.length;return m>=s[_-1]?l[_-1].evaluate(a):l[vu(s,m)].evaluate(a)},ys.prototype.eachChild=function(a){a(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)a(l[s])},ys.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ys.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var Ia=Object.freeze({__proto__:null,number:zi,color:function(a,s,l){return new sr(zi(a.r,s.r,l),zi(a.g,s.g,l),zi(a.b,s.b,l),zi(a.a,s.a,l))},array:function(a,s,l){return a.map(function(m,_){return zi(m,s[_],l)})}}),Hc=6/29*3*(6/29),yf=Math.PI/180,Is=180/Math.PI;function _f(a){return a>.008856451679035631?Math.pow(a,1/3):a/Hc+4/29}function hl(a){return a>6/29?a*a*a:Hc*(a-4/29)}function el(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function au(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ol(a){var s=au(a.r),l=au(a.g),m=au(a.b),_=_f((.4124564*s+.3575761*l+.1804375*m)/.95047),E=_f((.2126729*s+.7151522*l+.072175*m)/1);return{l:116*E-16,a:500*(_-E),b:200*(E-_f((.0193339*s+.119192*l+.9503041*m)/1.08883)),alpha:a.a}}function b(a){var s=(a.l+16)/116,l=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*hl(s),l=.95047*hl(l),m=1.08883*hl(m),new sr(el(3.2404542*l-1.5371385*s-.4985314*m),el(-.969266*l+1.8760108*s+.041556*m),el(.0556434*l-.2040259*s+1.0572252*m),a.alpha)}function M(a,s,l){var m=s-a;return a+l*(m>180||m<-180?m-360*Math.round(m/360):m)}var Z={forward:Ol,reverse:b,interpolate:function(a,s,l){return{l:zi(a.l,s.l,l),a:zi(a.a,s.a,l),b:zi(a.b,s.b,l),alpha:zi(a.alpha,s.alpha,l)}}},L={forward:function(a){var s=Ol(a),l=s.l,m=s.a,_=s.b,E=Math.atan2(_,m)*Is;return{h:E<0?E+360:E,c:Math.sqrt(m*m+_*_),l,alpha:a.a}},reverse:function(a){var s=a.h*yf,l=a.c;return b({l:a.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:a.alpha})},interpolate:function(a,s,l){return{h:M(a.h,s.h,l),c:zi(a.c,s.c,l),l:zi(a.l,s.l,l),alpha:zi(a.alpha,s.alpha,l)}}},ne=Object.freeze({__proto__:null,lab:Z,hcl:L}),ke=function(a,s,l,m,_){this.type=a,this.operator=s,this.interpolation=l,this.input=m,this.labels=[],this.outputs=[];for(var E=0,A=_;E<A.length;E+=1){var P=A[E],F=P[1];this.labels.push(P[0]),this.outputs.push(F)}};function st(a,s,l,m){var _=m-l,E=a-l;return _===0?0:s===1?E/_:(Math.pow(s,E)-1)/(Math.pow(s,_)-1)}ke.interpolationFactor=function(a,s,l,m){var _=0;if(a.name==="exponential")_=st(s,a.base,l,m);else if(a.name==="linear")_=st(s,1,l,m);else if(a.name==="cubic-bezier"){var E=a.controlPoints;_=new W(E[0],E[1],E[2],E[3]).solve(st(s,1,l,m))}return _},ke.parse=function(a,s){var l=a[0],m=a[1],_=a[2],E=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var A=m[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var P=m.slice(1);if(P.length!==4||P.some(function(ut){return typeof ut!="number"||ut<0||ut>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,qt)))return null;var F=[],j=null;l==="interpolate-hcl"||l==="interpolate-lab"?j=pt:s.expectedType&&s.expectedType.kind!=="value"&&(j=s.expectedType);for(var $=0;$<E.length;$+=2){var K=E[$],ue=E[$+1],de=$+3,Ve=$+4;if(typeof K!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(F.length&&F[F.length-1][0]>=K)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var Ge=s.parse(ue,Ve,j);if(!Ge)return null;j=j||Ge.type,F.push([K,Ge])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new ke(j,l,m,_,F):s.error("Type "+Ii(j)+" is not interpolatable.")},ke.prototype.evaluate=function(a){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return l[0].evaluate(a);var _=s.length;if(m>=s[_-1])return l[_-1].evaluate(a);var E=vu(s,m),A=ke.interpolationFactor(this.interpolation,m,s[E],s[E+1]),P=l[E].evaluate(a),F=l[E+1].evaluate(a);return this.operator==="interpolate"?Ia[this.type.kind.toLowerCase()](P,F,A):this.operator==="interpolate-hcl"?L.reverse(L.interpolate(L.forward(P),L.forward(F),A)):Z.reverse(Z.interpolate(Z.forward(P),Z.forward(F),A))},ke.prototype.eachChild=function(a){a(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)a(l[s])},ke.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ke.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var Ft=function(a,s){this.type=a,this.args=s};Ft.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var l=null,m=s.expectedType;m&&m.kind!=="value"&&(l=m);for(var _=[],E=0,A=a.slice(1);E<A.length;E+=1){var P=s.parse(A[E],1+_.length,l,void 0,{typeAnnotation:"omit"});if(!P)return null;l=l||P.type,_.push(P)}var F=m&&_.some(function(j){return Qi(m,j.type)});return new Ft(F?gn:l,_)},Ft.prototype.evaluate=function(a){for(var s,l=null,m=0,_=0,E=this.args;_<E.length&&(m++,(l=E[_].evaluate(a))&&l instanceof Le&&!l.available&&(s||(s=l.name),l=null,m===this.args.length&&(l=s)),l===null);_+=1);return l},Ft.prototype.eachChild=function(a){this.args.forEach(a)},Ft.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Ft.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Bt=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Bt.prototype.evaluate=function(a){return this.result.evaluate(a)},Bt.prototype.eachChild=function(a){for(var s=0,l=this.bindings;s<l.length;s+=1)a(l[s][1]);a(this.result)},Bt.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var l=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=s.parse(a[m+1],m+1);if(!E)return null;l.push([_,E])}var A=s.parse(a[a.length-1],a.length-1,s.expectedType,l);return A?new Bt(l,A):null},Bt.prototype.outputDefined=function(){return this.result.outputDefined()},Bt.prototype.serialize=function(){for(var a=["let"],s=0,l=this.bindings;s<l.length;s+=1){var m=l[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var Sr=function(a,s,l){this.type=a,this.index=s,this.input=l};Sr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,qt),m=s.parse(a[2],2,xt(s.expectedType||gn));return l&&m?new Sr(m.type.itemType,l,m):null},Sr.prototype.evaluate=function(a){var s=this.index.evaluate(a),l=this.input.evaluate(a);if(s<0)throw new Wa("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new Wa("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new Wa("Array index must be an integer, but found "+s+" instead.");return l[s]},Sr.prototype.eachChild=function(a){a(this.index),a(this.input)},Sr.prototype.outputDefined=function(){return!1},Sr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Br=function(a,s){this.type=mr,this.needle=a,this.haystack=s};Br.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,gn),m=s.parse(a[2],2,gn);return l&&m?Ji(l.type,[mr,Cn,qt,In,gn])?new Br(l,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(l.type)+" instead"):null},Br.prototype.evaluate=function(a){var s=this.needle.evaluate(a),l=this.haystack.evaluate(a);if(!l)return!1;if(!ia(s,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Ii(ta(s))+" instead.");if(!ia(l,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Ii(ta(l))+" instead.");return l.indexOf(s)>=0},Br.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Br.prototype.outputDefined=function(){return!0},Br.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Hn=function(a,s,l){this.type=qt,this.needle=a,this.haystack=s,this.fromIndex=l};Hn.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,gn),m=s.parse(a[2],2,gn);if(!l||!m)return null;if(!Ji(l.type,[mr,Cn,qt,In,gn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(l.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,qt);return _?new Hn(l,m,_):null}return new Hn(l,m)},Hn.prototype.evaluate=function(a){var s=this.needle.evaluate(a),l=this.haystack.evaluate(a);if(!ia(s,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Ii(ta(s))+" instead.");if(!ia(l,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Ii(ta(l))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return l.indexOf(s,m)}return l.indexOf(s)},Hn.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Hn.prototype.outputDefined=function(){return!1},Hn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Kn=function(a,s,l,m,_,E){this.inputType=a,this.type=s,this.input=l,this.cases=m,this.outputs=_,this.otherwise=E};Kn.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var l,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},E=[],A=2;A<a.length-1;A+=2){var P=a[A],F=a[A+1];Array.isArray(P)||(P=[P]);var j=s.concat(A);if(P.length===0)return j.error("Expected at least one branch label.");for(var $=0,K=P;$<K.length;$+=1){var ue=K[$];if(typeof ue!="number"&&typeof ue!="string")return j.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ue=="number"&&Math.floor(ue)!==ue)return j.error("Numeric branch labels must be integer values.");if(l){if(j.checkSubtype(l,ta(ue)))return null}else l=ta(ue);if(_[String(ue)]!==void 0)return j.error("Branch labels must be unique.");_[String(ue)]=E.length}var de=s.parse(F,A,m);if(!de)return null;m=m||de.type,E.push(de)}var Ve=s.parse(a[1],1,gn);if(!Ve)return null;var Ge=s.parse(a[a.length-1],a.length-1,m);return Ge?Ve.type.kind!=="value"&&s.concat(1).checkSubtype(l,Ve.type)?null:new Kn(l,m,Ve,_,E,Ge):null},Kn.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(ta(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},Kn.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Kn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Kn.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],l=[],m={},_=0,E=Object.keys(this.cases).sort();_<E.length;_+=1){var A=E[_];(K=m[this.cases[A]])===void 0?(m[this.cases[A]]=l.length,l.push([this.cases[A],[A]])):l[K][1].push(A)}for(var P=function(de){return a.inputType.kind==="number"?Number(de):de},F=0,j=l;F<j.length;F+=1){var $=j[F],K=$[0],ue=$[1];s.push(ue.length===1?P(ue[0]):ue.map(P)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var yi=function(a,s,l){this.type=a,this.branches=s,this.otherwise=l};yi.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var E=s.parse(a[_],_,mr);if(!E)return null;var A=s.parse(a[_+1],_+1,l);if(!A)return null;m.push([E,A]),l=l||A.type}var P=s.parse(a[a.length-1],a.length-1,l);return P?new yi(l,m,P):null},yi.prototype.evaluate=function(a){for(var s=0,l=this.branches;s<l.length;s+=1){var m=l[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},yi.prototype.eachChild=function(a){for(var s=0,l=this.branches;s<l.length;s+=1){var m=l[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},yi.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},yi.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var $i=function(a,s,l,m){this.type=a,this.input=s,this.beginIndex=l,this.endIndex=m};function Ea(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function La(a,s,l,m){return m.compare(s,l)===0}function qi(a,s,l){var m=a!=="=="&&a!=="!=";return function(){function _(E,A,P){this.type=mr,this.lhs=E,this.rhs=A,this.collator=P,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}return _.parse=function(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");var P=E[0],F=A.parse(E[1],1,gn);if(!F)return null;if(!Ea(P,F.type))return A.concat(1).error('"'+P+`" comparisons are not supported for type '`+Ii(F.type)+"'.");var j=A.parse(E[2],2,gn);if(!j)return null;if(!Ea(P,j.type))return A.concat(2).error('"'+P+`" comparisons are not supported for type '`+Ii(j.type)+"'.");if(F.type.kind!==j.type.kind&&F.type.kind!=="value"&&j.type.kind!=="value")return A.error("Cannot compare types '"+Ii(F.type)+"' and '"+Ii(j.type)+"'.");m&&(F.type.kind==="value"&&j.type.kind!=="value"?F=new aa(j.type,[F]):F.type.kind!=="value"&&j.type.kind==="value"&&(j=new aa(F.type,[j])));var $=null;if(E.length===4){if(F.type.kind!=="string"&&j.type.kind!=="string"&&F.type.kind!=="value"&&j.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!($=A.parse(E[3],3,Pi)))return null}return new _(F,j,$)},_.prototype.evaluate=function(E){var A=this.lhs.evaluate(E),P=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var F=ta(A),j=ta(P);if(F.kind!==j.kind||F.kind!=="string"&&F.kind!=="number")throw new Wa('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+F.kind+", "+j.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var $=ta(A),K=ta(P);if($.kind!=="string"||K.kind!=="string")return s(E,A,P)}return this.collator?l(E,A,P,this.collator.evaluate(E)):s(E,A,P)},_.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var E=[a];return this.eachChild(function(A){E.push(A.serialize())}),E},_}()}$i.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,gn),m=s.parse(a[2],2,qt);if(!l||!m)return null;if(!Ji(l.type,[xt(gn),Cn,gn]))return s.error("Expected first argument to be of type array or string, but found "+Ii(l.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,qt);return _?new $i(l.type,l,m,_):null}return new $i(l.type,l,m)},$i.prototype.evaluate=function(a){var s=this.input.evaluate(a),l=this.beginIndex.evaluate(a);if(!ia(s,["string","array"]))throw new Wa("Expected first argument to be of type array or string, but found "+Ii(ta(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(l,m)}return s.slice(l)},$i.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},$i.prototype.outputDefined=function(){return!1},$i.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _s=qi("==",function(a,s,l){return s===l},La),mu=qi("!=",function(a,s,l){return s!==l},function(a,s,l,m){return!La(0,s,l,m)}),pl=qi("<",function(a,s,l){return s<l},function(a,s,l,m){return m.compare(s,l)<0}),xf=qi(">",function(a,s,l){return s>l},function(a,s,l,m){return m.compare(s,l)>0}),dl=qi("<=",function(a,s,l){return s<=l},function(a,s,l,m){return m.compare(s,l)<=0}),Wc=qi(">=",function(a,s,l){return s>=l},function(a,s,l,m){return m.compare(s,l)>=0}),Nu=function(a,s,l,m,_){this.type=Cn,this.number=a,this.locale=s,this.currency=l,this.minFractionDigits=m,this.maxFractionDigits=_};Nu.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var l=s.parse(a[1],1,qt);if(!l)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,Cn)))return null;var E=null;if(m.currency&&!(E=s.parse(m.currency,1,Cn)))return null;var A=null;if(m["min-fraction-digits"]&&!(A=s.parse(m["min-fraction-digits"],1,qt)))return null;var P=null;return m["max-fraction-digits"]&&!(P=s.parse(m["max-fraction-digits"],1,qt))?null:new Nu(l,_,E,A,P)},Nu.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Nu.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var zu=function(a){this.type=qt,this.input=a};zu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Ii(l.type)+" instead."):new zu(l):null},zu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Wa("Expected value to be of type string or array, but found "+Ii(ta(s))+" instead.")},zu.prototype.eachChild=function(a){a(this.input)},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Zu={"==":_s,"!=":mu,">":xf,"<":pl,">=":Wc,"<=":dl,array:aa,at:Sr,boolean:aa,case:yi,coalesce:Ft,collator:Go,format:jo,image:Qo,in:Br,"index-of":Hn,interpolate:ke,"interpolate-hcl":ke,"interpolate-lab":ke,length:zu,let:Bt,literal:no,match:Kn,number:aa,"number-format":Nu,object:aa,slice:$i,step:ys,string:aa,"to-boolean":wo,"to-color":wo,"to-number":wo,"to-string":wo,var:Ms,within:Oo};function yo(a,s){var l=s[0],m=s[1],_=s[2],E=s[3];l=l.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var A=E?E.evaluate(a):1,P=As(l,m,_,A);if(P)throw new Wa(P);return new sr(l/255*A,m/255*A,_/255*A,A)}function th(a,s){return a in s}function Xc(a,s){var l=s[a];return l===void 0?null:l}function xs(a){return{type:a}}function bf(a){return{result:"success",value:a}}function tl(a){return{result:"error",value:a}}function ou(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function rh(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function $s(a){return!!a.expression&&a.expression.interpolated}function Ta(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Dl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Lh(a){return a}function Uu(a,s,l){return a!==void 0?a:s!==void 0?s:l!==void 0?l:void 0}function Yc(a,s,l,m,_){return Uu(typeof l===_?m[l]:void 0,a.default,s.default)}function Sp(a,s,l){if(Ta(l)!=="number")return Uu(a.default,s.default);var m=a.stops.length;if(m===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[m-1][0])return a.stops[m-1][1];var _=vu(a.stops.map(function(E){return E[0]}),l);return a.stops[_][1]}function Cp(a,s,l){var m=a.base!==void 0?a.base:1;if(Ta(l)!=="number")return Uu(a.default,s.default);var _=a.stops.length;if(_===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[_-1][0])return a.stops[_-1][1];var E=vu(a.stops.map(function(K){return K[0]}),l),A=function(K,ue,de,Ve){var Ge=Ve-de,ut=K-de;return Ge===0?0:ue===1?ut/Ge:(Math.pow(ue,ut)-1)/(Math.pow(ue,Ge)-1)}(l,m,a.stops[E][0],a.stops[E+1][0]),P=a.stops[E][1],F=a.stops[E+1][1],j=Ia[s.type]||Lh;if(a.colorSpace&&a.colorSpace!=="rgb"){var $=ne[a.colorSpace];j=function(K,ue){return $.reverse($.interpolate($.forward(K),$.forward(ue),A))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var K=[],ue=arguments.length;ue--;)K[ue]=arguments[ue];var de=P.evaluate.apply(void 0,K),Ve=F.evaluate.apply(void 0,K);if(de!==void 0&&Ve!==void 0)return j(de,Ve,A)}}:j(P,F,A)}function nh(a,s,l){return s.type==="color"?l=sr.parse(l):s.type==="formatted"?l=wa.fromString(l.toString()):s.type==="resolvedImage"?l=Le.fromString(l.toString()):Ta(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),Uu(l,a.default,s.default)}ao.register(Zu,{error:[{kind:"error"},[Cn],function(a,s){throw new Wa(s[0].evaluate(a))}],typeof:[Cn,[gn],function(a,s){return Ii(ta(s[0].evaluate(a)))}],"to-rgba":[xt(qt,4),[pt],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[pt,[qt,qt,qt],yo],rgba:[pt,[qt,qt,qt,qt],yo],has:{type:mr,overloads:[[[Cn],function(a,s){return th(s[0].evaluate(a),a.properties())}],[[Cn,Ei],function(a,s){var l=s[1];return th(s[0].evaluate(a),l.evaluate(a))}]]},get:{type:gn,overloads:[[[Cn],function(a,s){return Xc(s[0].evaluate(a),a.properties())}],[[Cn,Ei],function(a,s){var l=s[1];return Xc(s[0].evaluate(a),l.evaluate(a))}]]},"feature-state":[gn,[Cn],function(a,s){return Xc(s[0].evaluate(a),a.featureState||{})}],properties:[Ei,[],function(a){return a.properties()}],"geometry-type":[Cn,[],function(a){return a.geometryType()}],id:[gn,[],function(a){return a.id()}],zoom:[qt,[],function(a){return a.globals.zoom}],"heatmap-density":[qt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[qt,[],function(a){return a.globals.lineProgress||0}],accumulated:[gn,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[qt,xs(qt),function(a,s){for(var l=0,m=0,_=s;m<_.length;m+=1)l+=_[m].evaluate(a);return l}],"*":[qt,xs(qt),function(a,s){for(var l=1,m=0,_=s;m<_.length;m+=1)l*=_[m].evaluate(a);return l}],"-":{type:qt,overloads:[[[qt,qt],function(a,s){var l=s[1];return s[0].evaluate(a)-l.evaluate(a)}],[[qt],function(a,s){return-s[0].evaluate(a)}]]},"/":[qt,[qt,qt],function(a,s){var l=s[1];return s[0].evaluate(a)/l.evaluate(a)}],"%":[qt,[qt,qt],function(a,s){var l=s[1];return s[0].evaluate(a)%l.evaluate(a)}],ln2:[qt,[],function(){return Math.LN2}],pi:[qt,[],function(){return Math.PI}],e:[qt,[],function(){return Math.E}],"^":[qt,[qt,qt],function(a,s){var l=s[1];return Math.pow(s[0].evaluate(a),l.evaluate(a))}],sqrt:[qt,[qt],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[qt,[qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[qt,[qt],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[qt,[qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[qt,[qt],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[qt,[qt],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[qt,[qt],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[qt,[qt],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[qt,[qt],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[qt,[qt],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[qt,xs(qt),function(a,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(a)}))}],max:[qt,xs(qt),function(a,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(a)}))}],abs:[qt,[qt],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[qt,[qt],function(a,s){var l=s[0].evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[qt,[qt],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[qt,[qt],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[mr,[Cn,gn],function(a,s){var l=s[0],m=s[1];return a.properties()[l.value]===m.value}],"filter-id-==":[mr,[gn],function(a,s){var l=s[0];return a.id()===l.value}],"filter-type-==":[mr,[Cn],function(a,s){var l=s[0];return a.geometryType()===l.value}],"filter-<":[mr,[Cn,gn],function(a,s){var l=s[0],m=s[1],_=a.properties()[l.value],E=m.value;return typeof _==typeof E&&_<E}],"filter-id-<":[mr,[gn],function(a,s){var l=s[0],m=a.id(),_=l.value;return typeof m==typeof _&&m<_}],"filter->":[mr,[Cn,gn],function(a,s){var l=s[0],m=s[1],_=a.properties()[l.value],E=m.value;return typeof _==typeof E&&_>E}],"filter-id->":[mr,[gn],function(a,s){var l=s[0],m=a.id(),_=l.value;return typeof m==typeof _&&m>_}],"filter-<=":[mr,[Cn,gn],function(a,s){var l=s[0],m=s[1],_=a.properties()[l.value],E=m.value;return typeof _==typeof E&&_<=E}],"filter-id-<=":[mr,[gn],function(a,s){var l=s[0],m=a.id(),_=l.value;return typeof m==typeof _&&m<=_}],"filter->=":[mr,[Cn,gn],function(a,s){var l=s[0],m=s[1],_=a.properties()[l.value],E=m.value;return typeof _==typeof E&&_>=E}],"filter-id->=":[mr,[gn],function(a,s){var l=s[0],m=a.id(),_=l.value;return typeof m==typeof _&&m>=_}],"filter-has":[mr,[gn],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[mr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[mr,[xt(Cn)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[mr,[xt(gn)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[mr,[Cn,xt(gn)],function(a,s){var l=s[0];return s[1].value.indexOf(a.properties()[l.value])>=0}],"filter-in-large":[mr,[Cn,xt(gn)],function(a,s){var l=s[0],m=s[1];return function(_,E,A,P){for(;A<=P;){var F=A+P>>1;if(E[F]===_)return!0;E[F]>_?P=F-1:A=F+1}return!1}(a.properties()[l.value],m.value,0,m.value.length-1)}],all:{type:mr,overloads:[[[mr,mr],function(a,s){var l=s[1];return s[0].evaluate(a)&&l.evaluate(a)}],[xs(mr),function(a,s){for(var l=0,m=s;l<m.length;l+=1)if(!m[l].evaluate(a))return!1;return!0}]]},any:{type:mr,overloads:[[[mr,mr],function(a,s){var l=s[1];return s[0].evaluate(a)||l.evaluate(a)}],[xs(mr),function(a,s){for(var l=0,m=s;l<m.length;l+=1)if(m[l].evaluate(a))return!0;return!1}]]},"!":[mr,[mr],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[mr,[Cn],function(a,s){var l=a.globals&&a.globals.isSupportedScript;return!l||l(s[0].evaluate(a))}],upcase:[Cn,[Cn],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[Cn,[Cn],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[Cn,xs(gn),function(a,s){return s.map(function(l){return Ys(l.evaluate(a))}).join("")}],"resolved-locale":[Cn,[Pi],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var $c=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new la,this._defaultValue=s?function(l){return l.type==="color"&&Dl(l.default)?new sr(0,0,0,0):l.type==="color"?sr.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function lc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Zu}function Fl(a,s){var l=new iu(Zu,[],s?function(_){var E={color:pt,string:Cn,number:qt,enum:Cn,boolean:mr,formatted:na,resolvedImage:vt};return _.type==="array"?xt(E[_.value]||gn,_.length):E[_.type]}(s):void 0),m=l.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?bf(new $c(m,s)):tl(l.errors)}$c.prototype.evaluateWithoutErrorHandling=function(a,s,l,m,_,E){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},$c.prototype.evaluate=function(a,s,l,m,_,E){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Bl=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!ws(s.expression)};Bl.prototype.evaluateWithoutErrorHandling=function(a,s,l,m,_,E){return this._styleExpression.evaluateWithoutErrorHandling(a,s,l,m,_,E)},Bl.prototype.evaluate=function(a,s,l,m,_,E){return this._styleExpression.evaluate(a,s,l,m,_,E)};var vl=function(a,s,l,m){this.kind=a,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!ws(s.expression),this.interpolationType=m};function ml(a,s){if((a=Fl(a,s)).result==="error")return a;var l=a.value.expression,m=go(l);if(!m&&!ou(s))return tl([new Or("","data expressions not supported")]);var _=Ts(l,["zoom"]);if(!_&&!rh(s))return tl([new Or("","zoom expressions not supported")]);var E=function A(P){var F=null;if(P instanceof Bt)F=A(P.result);else if(P instanceof Ft)for(var j=0,$=P.args;j<$.length&&!(F=A($[j]));j+=1);else(P instanceof ys||P instanceof ke)&&P.input instanceof ao&&P.input.name==="zoom"&&(F=P);return F instanceof Or||P.eachChild(function(K){var ue=A(K);ue instanceof Or?F=ue:!F&&ue?F=new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&ue&&F!==ue&&(F=new Or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(l);return E||_?E instanceof Or?tl([E]):E instanceof ke&&!$s(s)?tl([new Or("",'"interpolate" expressions cannot be used with this property')]):bf(E?new vl(m?"camera":"composite",a.value,E.labels,E instanceof ke?E.interpolation:void 0):new Bl(m?"constant":"source",a.value)):tl([new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}vl.prototype.evaluateWithoutErrorHandling=function(a,s,l,m,_,E){return this._styleExpression.evaluateWithoutErrorHandling(a,s,l,m,_,E)},vl.prototype.evaluate=function(a,s,l,m,_,E){return this._styleExpression.evaluate(a,s,l,m,_,E)},vl.prototype.interpolationFactor=function(a,s,l){return this.interpolationType?ke.interpolationFactor(this.interpolationType,a,s,l):0};var gl=function(a,s){this._parameters=a,this._specification=s,Rr(this,function l(m,_){var E,A,P,F=_.type==="color",j=m.stops&&typeof m.stops[0][0]=="object",$=j||!(j||m.property!==void 0),K=m.type||($s(_)?"exponential":"interval");if(F&&((m=Rr({},m)).stops&&(m.stops=m.stops.map(function(Mn){return[Mn[0],sr.parse(Mn[1])]})),m.default=sr.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!ne[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(K==="exponential")E=Cp;else if(K==="interval")E=Sp;else if(K==="categorical"){E=Yc,A=Object.create(null);for(var ue=0,de=m.stops;ue<de.length;ue+=1){var Ve=de[ue];A[Ve[0]]=Ve[1]}P=typeof m.stops[0][0]}else{if(K!=="identity")throw new Error('Unknown function type "'+K+'"');E=nh}if(j){for(var Ge={},ut=[],Qe=0;Qe<m.stops.length;Qe++){var Mt=m.stops[Qe],jt=Mt[0].zoom;Ge[jt]===void 0&&(Ge[jt]={zoom:jt,type:m.type,property:m.property,default:m.default,stops:[]},ut.push(jt)),Ge[jt].stops.push([Mt[0].value,Mt[1]])}for(var ir=[],hr=0,Ar=ut;hr<Ar.length;hr+=1){var Wr=Ar[hr];ir.push([Ge[Wr].zoom,l(Ge[Wr],_)])}var tn={name:"linear"};return{kind:"composite",interpolationType:tn,interpolationFactor:ke.interpolationFactor.bind(void 0,tn),zoomStops:ir.map(function(Mn){return Mn[0]}),evaluate:function(Mn,ti){var On=Mn.zoom;return Cp({stops:ir,base:m.base},_,On).evaluate(On,ti)}}}if($){var qn=K==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:qn,interpolationFactor:ke.interpolationFactor.bind(void 0,qn),zoomStops:m.stops.map(function(Mn){return Mn[0]}),evaluate:function(Mn){return E(m,_,Mn.zoom,A,P)}}}return{kind:"source",evaluate:function(Mn,ti){var On=ti&&ti.properties?ti.properties[m.property]:void 0;return On===void 0?Uu(m.default,_.default):E(m,_,On,A,P)}}}(this._parameters,this._specification))};function su(a){var s=a.key,l=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},E=a.style,A=a.styleSpec,P=[],F=Ta(l);if(F!=="object")return[new We(s,l,"object expected, "+F+" found")];for(var j in l){var $=j.split(".")[0],K=m[$]||m["*"],ue=void 0;if(_[$])ue=_[$];else if(m[$])ue=Wi;else if(_["*"])ue=_["*"];else{if(!m["*"]){P.push(new We(s,l[j],'unknown property "'+j+'"'));continue}ue=Wi}P=P.concat(ue({key:(s&&s+".")+j,value:l[j],valueSpec:K,style:E,styleSpec:A,object:l,objectKey:j},l))}for(var de in m)_[de]||m[de].required&&m[de].default===void 0&&l[de]===void 0&&P.push(new We(s,l,'missing required property "'+de+'"'));return P}function Ef(a){var s=a.value,l=a.valueSpec,m=a.style,_=a.styleSpec,E=a.key,A=a.arrayElementValidator||Wi;if(Ta(s)!=="array")return[new We(E,s,"array expected, "+Ta(s)+" found")];if(l.length&&s.length!==l.length)return[new We(E,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new We(E,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var P={type:l.value,values:l.values};_.$version<7&&(P.function=l.function),Ta(l.value)==="object"&&(P=l.value);for(var F=[],j=0;j<s.length;j++)F=F.concat(A({array:s,arrayIndex:j,value:s[j],valueSpec:P,style:m,styleSpec:_,key:E+"["+j+"]"}));return F}function Sf(a){var s=a.key,l=a.value,m=a.valueSpec,_=Ta(l);return _==="number"&&l!=l&&(_="NaN"),_!=="number"?[new We(s,l,"number expected, "+_+" found")]:"minimum"in m&&l<m.minimum?[new We(s,l,l+" is less than the minimum value "+m.minimum)]:"maximum"in m&&l>m.maximum?[new We(s,l,l+" is greater than the maximum value "+m.maximum)]:[]}function Nl(a){var s,l,m,_=a.valueSpec,E=er(a.value.type),A={},P=E!=="categorical"&&a.value.property===void 0,F=!P,j=Ta(a.value.stops)==="array"&&Ta(a.value.stops[0])==="array"&&Ta(a.value.stops[0][0])==="object",$=su({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(de){if(E==="identity")return[new We(de.key,de.value,'identity function may not have a "stops" property')];var Ve=[],Ge=de.value;return Ve=Ve.concat(Ef({key:de.key,value:Ge,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:K})),Ta(Ge)==="array"&&Ge.length===0&&Ve.push(new We(de.key,Ge,"array must have at least one stop")),Ve},default:function(de){return Wi({key:de.key,value:de.value,valueSpec:_,style:de.style,styleSpec:de.styleSpec})}}});return E==="identity"&&P&&$.push(new We(a.key,a.value,'missing required property "property"')),E==="identity"||a.value.stops||$.push(new We(a.key,a.value,'missing required property "stops"')),E==="exponential"&&a.valueSpec.expression&&!$s(a.valueSpec)&&$.push(new We(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(F&&!ou(a.valueSpec)?$.push(new We(a.key,a.value,"property functions not supported")):P&&!rh(a.valueSpec)&&$.push(new We(a.key,a.value,"zoom functions not supported"))),E!=="categorical"&&!j||a.value.property!==void 0||$.push(new We(a.key,a.value,'"property" property is required')),$;function K(de){var Ve=[],Ge=de.value,ut=de.key;if(Ta(Ge)!=="array")return[new We(ut,Ge,"array expected, "+Ta(Ge)+" found")];if(Ge.length!==2)return[new We(ut,Ge,"array length 2 expected, length "+Ge.length+" found")];if(j){if(Ta(Ge[0])!=="object")return[new We(ut,Ge,"object expected, "+Ta(Ge[0])+" found")];if(Ge[0].zoom===void 0)return[new We(ut,Ge,"object stop key must have zoom")];if(Ge[0].value===void 0)return[new We(ut,Ge,"object stop key must have value")];if(m&&m>er(Ge[0].zoom))return[new We(ut,Ge[0].zoom,"stop zoom values must appear in ascending order")];er(Ge[0].zoom)!==m&&(m=er(Ge[0].zoom),l=void 0,A={}),Ve=Ve.concat(su({key:ut+"[0]",value:Ge[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:Sf,value:ue}}))}else Ve=Ve.concat(ue({key:ut+"[0]",value:Ge[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},Ge));return lc(ar(Ge[1]))?Ve.concat([new We(ut+"[1]",Ge[1],"expressions are not allowed in function stops.")]):Ve.concat(Wi({key:ut+"[1]",value:Ge[1],valueSpec:_,style:de.style,styleSpec:de.styleSpec}))}function ue(de,Ve){var Ge=Ta(de.value),ut=er(de.value),Qe=de.value!==null?de.value:Ve;if(s){if(Ge!==s)return[new We(de.key,Qe,Ge+" stop domain type must match previous stop domain type "+s)]}else s=Ge;if(Ge!=="number"&&Ge!=="string"&&Ge!=="boolean")return[new We(de.key,Qe,"stop domain value must be a number, string, or boolean")];if(Ge!=="number"&&E!=="categorical"){var Mt="number expected, "+Ge+" found";return ou(_)&&E===void 0&&(Mt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(de.key,Qe,Mt)]}return E!=="categorical"||Ge!=="number"||isFinite(ut)&&Math.floor(ut)===ut?E!=="categorical"&&Ge==="number"&&l!==void 0&&ut<l?[new We(de.key,Qe,"stop domain values must appear in ascending order")]:(l=ut,E==="categorical"&&ut in A?[new We(de.key,Qe,"stop domain values must be unique")]:(A[ut]=!0,[])):[new We(de.key,Qe,"integer expected, found "+ut)]}}function yl(a){var s=(a.expressionContext==="property"?ml:Fl)(ar(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new We(""+a.key+m.key,a.value,m.message)});var l=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!l.outputDefined())return[new We(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ws(l))return[new We(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ws(l))return[new We(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ts(l,["zoom","feature-state"]))return[new We(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!go(l))return[new We(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cc(a){var s=a.key,l=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(er(l))===-1&&_.push(new We(s,l,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(m.values).indexOf(er(l))===-1&&_.push(new We(s,l,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(l)+" found")),_}function qc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,l=a.slice(1);s<l.length;s+=1){var m=l[s];if(!qc(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}gl.deserialize=function(a){return new gl(a._parameters,a._specification)},gl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var fc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cf(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};qc(a)||(a=Af(a));var s=Fl(a,fc);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,m,_){return s.value.evaluate(l,m,{},_)},needGeometry:function l(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(l(m[_]))return!0;return!1}(a)}}function Ap(a,s){return a<s?-1:a>s?1:0}function Af(a){if(!a)return!0;var s,l=a[0];return a.length<=1?l!=="any":l==="=="?_l(a[1],a[2],"=="):l==="!="?Vu(_l(a[1],a[2],"==")):l==="<"||l===">"||l==="<="||l===">="?_l(a[1],a[2],l):l==="any"?(s=a.slice(1),["any"].concat(s.map(Af))):l==="all"?["all"].concat(a.slice(1).map(Af)):l==="none"?["all"].concat(a.slice(1).map(Af).map(Vu)):l==="in"?wf(a[1],a.slice(2)):l==="!in"?Vu(wf(a[1],a.slice(2))):l==="has"?ih(a[1]):l==="!has"?Vu(ih(a[1])):l!=="within"||a}function _l(a,s,l){switch(a){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,a,s]}}function wf(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(Ap)]]:["filter-in-small",a,["literal",s]]}}function ih(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Vu(a){return["!",a]}function Rh(a){return qc(ar(a.value))?yl(Rr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var m=l.value,_=l.key;if(Ta(m)!=="array")return[new We(_,m,"array expected, "+Ta(m)+" found")];var E,A=l.styleSpec,P=[];if(m.length<1)return[new We(_,m,"filter array must have at least 1 element")];switch(P=P.concat(cc({key:_+"[0]",value:m[0],valueSpec:A.filter_operator,style:l.style,styleSpec:l.styleSpec})),er(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&er(m[1])==="$type"&&P.push(new We(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&P.push(new We(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=Ta(m[1]))!=="string"&&P.push(new We(_+"[1]",m[1],"string expected, "+E+" found"));for(var F=2;F<m.length;F++)E=Ta(m[F]),er(m[1])==="$type"?P=P.concat(cc({key:_+"["+F+"]",value:m[F],valueSpec:A.geometry_type,style:l.style,styleSpec:l.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&P.push(new We(_+"["+F+"]",m[F],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var j=1;j<m.length;j++)P=P.concat(s({key:_+"["+j+"]",value:m[j],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":E=Ta(m[1]),m.length!==2?P.push(new We(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&P.push(new We(_+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=Ta(m[1]),m.length!==2?P.push(new We(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&P.push(new We(_+"[1]",m[1],"object expected, "+E+" found"))}return P}(a)}function Oh(a,s){var l=a.key,m=a.style,_=a.styleSpec,E=a.value,A=a.objectKey,P=_[s+"_"+a.layerType];if(!P)return[];var F=A.match(/^(.*)-transition$/);if(s==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return Wi({key:l,value:E,valueSpec:_.transition,style:m,styleSpec:_});var j,$=a.valueSpec||P[A];if(!$)return[new We(l,E,'unknown property "'+A+'"')];if(Ta(E)==="string"&&ou($)&&!$.tokens&&(j=/^{([^}]+)}$/.exec(E)))return[new We(l,E,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var K=[];return a.layerType==="symbol"&&(A==="text-field"&&m&&!m.glyphs&&K.push(new We(l,E,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Dl(ar(E))&&er(E.type)==="identity"&&K.push(new We(l,E,'"text-font" does not support identity functions'))),K.concat(Wi({key:a.key,value:E,valueSpec:$,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:A}))}function Dh(a){return Oh(a,"paint")}function zl(a){return Oh(a,"layout")}function Fh(a){var s=[],l=a.value,m=a.key,_=a.style,E=a.styleSpec;l.type||l.ref||s.push(new We(m,l,'either "type" or "ref" is required'));var A,P=er(l.type),F=er(l.ref);if(l.id)for(var j=er(l.id),$=0;$<a.arrayIndex;$++){var K=_.layers[$];er(K.id)===j&&s.push(new We(m,l.id,'duplicate layer id "'+l.id+'", previously used at line '+K.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in l&&s.push(new We(m,l[Ve],'"'+Ve+'" is prohibited for ref layers'))}),_.layers.forEach(function(Ve){er(Ve.id)===F&&(A=Ve)}),A?A.ref?s.push(new We(m,l.ref,"ref cannot reference another ref layer")):P=er(A.type):s.push(new We(m,l.ref,'ref layer "'+F+'" not found'));else if(P!=="background")if(l.source){var ue=_.sources&&_.sources[l.source],de=ue&&er(ue.type);ue?de==="vector"&&P==="raster"?s.push(new We(m,l.source,'layer "'+l.id+'" requires a raster source')):de==="raster"&&P!=="raster"?s.push(new We(m,l.source,'layer "'+l.id+'" requires a vector source')):de!=="vector"||l["source-layer"]?de==="raster-dem"&&P!=="hillshade"?s.push(new We(m,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!l.paint||!l.paint["line-gradient"]||de==="geojson"&&ue.lineMetrics||s.push(new We(m,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new We(m,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new We(m,l.source,'source "'+l.source+'" not found'))}else s.push(new We(m,l,'missing required property "source"'));return s=s.concat(su({key:m,value:l,valueSpec:E.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Wi({key:m+".type",value:l.type,valueSpec:E.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"})},filter:Rh,layout:function(Ve){return su({layer:l,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(Ge){return zl(Rr({layerType:P},Ge))}}})},paint:function(Ve){return su({layer:l,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(Ge){return Dh(Rr({layerType:P},Ge))}}})}}}))}function ts(a){var s=a.value,l=a.key,m=Ta(s);return m!=="string"?[new We(l,s,"string expected, "+m+" found")]:[]}var Qa={promoteId:function(a){var s=a.key,l=a.value;if(Ta(l)==="string")return ts({key:s,value:l});var m=[];for(var _ in l)m.push.apply(m,ts({key:s+"."+_,value:l[_]}));return m}};function ca(a){var s=a.value,l=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new We(l,s,'"type" is required')];var E,A=er(s.type);switch(A){case"vector":case"raster":case"raster-dem":return su({key:l,value:s,valueSpec:m["source_"+A.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:Qa});case"geojson":if(E=su({key:l,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:Qa}),s.cluster)for(var P in s.clusterProperties){var F=s.clusterProperties[P],j=F[0],$=typeof j=="string"?[j,["accumulated"],["get",P]]:j;E.push.apply(E,yl({key:l+"."+P+".map",value:F[1],expressionContext:"cluster-map"})),E.push.apply(E,yl({key:l+"."+P+".reduce",value:$,expressionContext:"cluster-reduce"}))}return E;case"video":return su({key:l,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return su({key:l,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new We(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cc({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function Zl(a){var s=a.value,l=a.styleSpec,m=l.light,_=a.style,E=[],A=Ta(s);if(s===void 0)return E;if(A!=="object")return E.concat([new We("light",s,"object expected, "+A+" found")]);for(var P in s){var F=P.match(/^(.*)-transition$/);E=E.concat(F&&m[F[1]]&&m[F[1]].transition?Wi({key:P,value:s[P],valueSpec:l.transition,style:_,styleSpec:l}):m[P]?Wi({key:P,value:s[P],valueSpec:m[P],style:_,styleSpec:l}):[new We(P,s[P],'unknown property "'+P+'"')])}return E}var rl={"*":function(){return[]},array:Ef,boolean:function(a){var s=a.value,l=a.key,m=Ta(s);return m!=="boolean"?[new We(l,s,"boolean expected, "+m+" found")]:[]},number:Sf,color:function(a){var s=a.key,l=a.value,m=Ta(l);return m!=="string"?[new We(s,l,"color expected, "+m+" found")]:Fi(l)===null?[new We(s,l,'color expected, "'+l+'" found')]:[]},constants:zt,enum:cc,filter:Rh,function:Nl,layer:Fh,object:su,source:ca,light:Zl,string:ts,formatted:function(a){return ts(a).length===0?[]:yl(a)},resolvedImage:function(a){return ts(a).length===0?[]:yl(a)}};function Wi(a){var s=a.value,l=a.valueSpec,m=a.styleSpec;return l.expression&&Dl(er(s))?Nl(a):l.expression&&lc(ar(s))?yl(a):l.type&&rl[l.type]?rl[l.type](a):su(Rr({},a,{valueSpec:l.type?m[l.type]:l}))}function Ra(a){var s=a.value,l=a.key,m=ts(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new We(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new We(l,s,'"glyphs" url must include a "{range}" token'))),m}function Fs(a,s){s===void 0&&(s=be);var l=[];return l=l.concat(Wi({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:Ra,"*":function(){return[]}}})),a.constants&&(l=l.concat(zt({key:"constants",value:a.constants,style:a,styleSpec:s}))),Kc(l)}function Kc(a){return[].concat(a).sort(function(s,l){return s.line-l.line})}function Ni(a){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return Kc(a.apply(this,s))}}Fs.source=Ni(ca),Fs.light=Ni(Zl),Fs.layer=Ni(Fh),Fs.filter=Ni(Rh),Fs.paintProperty=Ni(Dh),Fs.layoutProperty=Ni(zl);var ks=Fs,wu=ks.light,Ul=ks.paintProperty,Qc=ks.layoutProperty;function hc(a,s){var l=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new rt(new Error(_[m].message))),l=!0;return l}var Tu=Ho;function Ho(a,s,l){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(l=_[2]);for(var E=0;E<this.d*this.d;E++){var A=_[3+E],P=_[3+E+1];m.push(A===P?null:_.subarray(A,P))}var F=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],F),this.bboxes=_.subarray(F),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var j=0;j<this.d*this.d;j++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=l,this.scale=s/a,this.uid=0;var $=l/s*a;this.min=-$,this.max=a+$}Ho.prototype.insert=function(a,s,l,m,_){this._forEachCell(s,l,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(_)},Ho.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ho.prototype._insertCell=function(a,s,l,m,_,E){this.cells[_].push(E)},Ho.prototype.query=function(a,s,l,m,_){var E=this.min,A=this.max;if(a<=E&&s<=E&&A<=l&&A<=m&&!_)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(a,s,l,m,this._queryCell,P,{},_),P},Ho.prototype._queryCell=function(a,s,l,m,_,E,A,P){var F=this.cells[_];if(F!==null)for(var j=this.keys,$=this.bboxes,K=0;K<F.length;K++){var ue=F[K];if(A[ue]===void 0){var de=4*ue;(P?P($[de+0],$[de+1],$[de+2],$[de+3]):a<=$[de+2]&&s<=$[de+3]&&l>=$[de+0]&&m>=$[de+1])?(A[ue]=!0,E.push(j[ue])):A[ue]=!1}}},Ho.prototype._forEachCell=function(a,s,l,m,_,E,A,P){for(var F=this._convertToCellCoord(a),j=this._convertToCellCoord(s),$=this._convertToCellCoord(l),K=this._convertToCellCoord(m),ue=F;ue<=$;ue++)for(var de=j;de<=K;de++){var Ve=this.d*de+ue;if((!P||P(this._convertFromCellCoord(ue),this._convertFromCellCoord(de),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(de+1)))&&_.call(this,a,s,l,m,Ve,E,A,P))return}},Ho.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ho.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ho.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,l=0,m=0;m<this.cells.length;m++)l+=this.cells[m].length;var _=new Int32Array(s+l+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var E=s,A=0;A<a.length;A++){var P=a[A];_[3+A]=E,_.set(P,E),E+=P.length}return _[3+a.length]=E,_.set(this.keys,E),_[3+a.length+1]=E+=this.keys.length,_.set(this.bboxes,E),E+=this.bboxes.length,_.buffer};var pc=me.ImageData,Vl=me.ImageBitmap,Mo={};function Fn(a,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),Mo[a]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var ho in Fn("Object",Object),Tu.serialize=function(a,s){var l=a.toArrayBuffer();return s&&s.push(l),{buffer:l}},Tu.deserialize=function(a){return new Tu(a.buffer)},Fn("Grid",Tu),Fn("Color",sr),Fn("Error",Error),Fn("ResolvedImage",Le),Fn("StylePropertyFunction",gl),Fn("StyleExpression",$c,{omit:["_evaluator"]}),Fn("ZoomDependentExpression",vl),Fn("ZoomConstantExpression",Bl),Fn("CompoundExpression",ao,{omit:["_evaluate"]}),Zu)Zu[ho]._classRegistryKey||Fn("Expression_"+ho,Zu[ho]);function Oa(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function xl(a){return Vl&&a instanceof Vl}function uu(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Oa(a)||xl(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var l=a;return s&&s.push(l.buffer),l}if(a instanceof pc)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,E=a;_<E.length;_+=1)m.push(uu(E[_],s));return m}if(typeof a=="object"){var A=a.constructor,P=A._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var F=A.serialize?A.serialize(a,s):{};if(!A.serialize){for(var j in a)if(a.hasOwnProperty(j)&&!(Mo[P].omit.indexOf(j)>=0)){var $=a[j];F[j]=Mo[P].shallow.indexOf(j)>=0?$:uu($,s)}a instanceof Error&&(F.message=a.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(F.$name=P),F}throw new Error("can't serialize object of type "+typeof a)}function qs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Oa(a)||xl(a)||ArrayBuffer.isView(a)||a instanceof pc)return a;if(Array.isArray(a))return a.map(qs);if(typeof a=="object"){var s=a.$name||"Object",l=Mo[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(a);for(var m=Object.create(l.prototype),_=0,E=Object.keys(a);_<E.length;_+=1){var A=E[_];if(A!=="$name"){var P=a[A];m[A]=Mo[s].shallow.indexOf(A)>=0?P:qs(P)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var Tf=function(){this.first=!0};Tf.prototype.update=function(a,s){var l=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=l,!0))};var dn={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function dc(a){for(var s=0,l=a;s<l.length;s+=1)if(jl(l[s].charCodeAt(0)))return!0;return!1}function jl(a){return!(a!==746&&a!==747&&(a<4352||!(dn["Bopomofo Extended"](a)||dn.Bopomofo(a)||dn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||dn["CJK Compatibility Ideographs"](a)||dn["CJK Compatibility"](a)||dn["CJK Radicals Supplement"](a)||dn["CJK Strokes"](a)||!(!dn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||dn["CJK Unified Ideographs Extension A"](a)||dn["CJK Unified Ideographs"](a)||dn["Enclosed CJK Letters and Months"](a)||dn["Hangul Compatibility Jamo"](a)||dn["Hangul Jamo Extended-A"](a)||dn["Hangul Jamo Extended-B"](a)||dn["Hangul Jamo"](a)||dn["Hangul Syllables"](a)||dn.Hiragana(a)||dn["Ideographic Description Characters"](a)||dn.Kanbun(a)||dn["Kangxi Radicals"](a)||dn["Katakana Phonetic Extensions"](a)||dn.Katakana(a)&&a!==12540||!(!dn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!dn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||dn["Unified Canadian Aboriginal Syllabics"](a)||dn["Unified Canadian Aboriginal Syllabics Extended"](a)||dn["Vertical Forms"](a)||dn["Yijing Hexagram Symbols"](a)||dn["Yi Syllables"](a)||dn["Yi Radicals"](a))))}function nl(a){return!(jl(a)||function(s){return!!(dn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||dn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||dn["Letterlike Symbols"](s)||dn["Number Forms"](s)||dn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||dn["Control Pictures"](s)&&s!==9251||dn["Optical Character Recognition"](s)||dn["Enclosed Alphanumerics"](s)||dn["Geometric Shapes"](s)||dn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||dn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||dn["CJK Symbols and Punctuation"](s)||dn.Katakana(s)||dn["Private Use Area"](s)||dn["CJK Compatibility Forms"](s)||dn["Small Form Variants"](s)||dn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function Va(a){return a>=1424&&a<=2303||dn["Arabic Presentation Forms-A"](a)||dn["Arabic Presentation Forms-B"](a)}function Bs(a,s){return!(!s&&Va(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||dn.Khmer(a))}function vc(a){for(var s=0,l=a;s<l.length;s+=1)if(Va(l[s].charCodeAt(0)))return!0;return!1}var ju=null,Ns="unavailable",gu=null,Mf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Ns="error"),ju&&ju(a)};function Jc(){If.fire(new ze("pluginStateChange",{pluginStatus:Ns,pluginURL:gu}))}var If=new _t,ah=function(){return Ns},lu=function(){if(Ns!=="deferred"||!gu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ns="loading",Jc(),gu&&ba({url:gu},function(a){a?Mf(a):(Ns="loaded",Jc())})},bs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ns==="loaded"||bs.applyArabicShaping!=null},isLoading:function(){return Ns==="loading"},setState:function(a){Ns=a.pluginStatus,gu=a.pluginURL},isParsed:function(){return bs.applyArabicShaping!=null&&bs.processBidirectionalText!=null&&bs.processStyledBidirectionalText!=null},getPluginURL:function(){return gu}},Oi=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Tf,this.transition={})};Oi.prototype.isSupportedScript=function(a){return function(s,l){for(var m=0,_=s;m<_.length;m+=1)if(!Bs(_[m].charCodeAt(0),l))return!1;return!0}(a,bs.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),l=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var Mu=function(a,s){this.property=a,this.value=s,this.expression=function(l,m){if(Dl(l))return new gl(l,m);if(lc(l)){var _=ml(l,m);if(_.result==="error")throw new Error(_.value.map(function(A){return A.key+": "+A.message}).join(", "));return _.value}var E=l;return typeof l=="string"&&m.type==="color"&&(E=sr.parse(l)),{kind:"constant",evaluate:function(){return E}}}(s===void 0?a.specification.default:s,a.specification)};Mu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Mu.prototype.possiblyEvaluate=function(a,s,l){return this.property.possiblyEvaluate(this,a,s,l)};var yu=function(a){this.property=a,this.value=new Mu(a,void 0)};yu.prototype.transitioned=function(a,s){return new bl(this.property,this.value,s,Nt({},a.transition,this.transition),a.now)},yu.prototype.untransitioned=function(){return new bl(this.property,this.value,null,{},0)};var ls=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};ls.prototype.getValue=function(a){return ht(this._values[a].value.value)},ls.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new yu(this._values[a].property)),this._values[a].value=new Mu(this._values[a].property,s===null?void 0:ht(s))},ls.prototype.getTransition=function(a){return ht(this._values[a].transition)},ls.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new yu(this._values[a].property)),this._values[a].transition=ht(s)||void 0},ls.prototype.serialize=function(){for(var a={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var m=l[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var E=this.getTransition(m);E!==void 0&&(a[m+"-transition"]=E)}return a},ls.prototype.transitioned=function(a,s){for(var l=new El(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var E=_[m];l._values[E]=this._values[E].transitioned(a,s._values[E])}return l},ls.prototype.untransitioned=function(){for(var a=new El(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var m=l[s];a._values[m]=this._values[m].untransitioned()}return a};var bl=function(a,s,l,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=l)};bl.prototype.possiblyEvaluate=function(a,s,l){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,l),E=this.prior;if(E){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return E.possiblyEvaluate(a,s,l);var A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(a,s,l),_,function(P){if(P<=0)return 0;if(P>=1)return 1;var F=P*P,j=F*P;return 4*(P<.5?j:3*(P-F)+j-.75)}(A))}return _};var El=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};El.prototype.possiblyEvaluate=function(a,s,l){for(var m=new cu(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var A=E[_];m._values[A]=this._values[A].possiblyEvaluate(a,s,l)}return m},El.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var zs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};zs.prototype.getValue=function(a){return ht(this._values[a].value)},zs.prototype.setValue=function(a,s){this._values[a]=new Mu(this._values[a].property,s===null?void 0:ht(s))},zs.prototype.serialize=function(){for(var a={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var m=l[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},zs.prototype.possiblyEvaluate=function(a,s,l){for(var m=new cu(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var A=E[_];m._values[A]=this._values[A].possiblyEvaluate(a,s,l)}return m};var Zs=function(a,s,l){this.property=a,this.value=s,this.parameters=l};Zs.prototype.isConstant=function(){return this.value.kind==="constant"},Zs.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Zs.prototype.evaluate=function(a,s,l,m){return this.property.evaluate(this.value,this.parameters,a,s,l,m)};var cu=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};cu.prototype.get=function(a){return this._values[a]};var $n=function(a){this.specification=a};$n.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},$n.prototype.interpolate=function(a,s,l){var m=Ia[this.specification.type];return m?m(a,s,l):a};var Un=function(a,s){this.specification=a,this.overrides=s};Un.prototype.possiblyEvaluate=function(a,s,l,m){return new Zs(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},l,m)}:a.expression,s)},Un.prototype.interpolate=function(a,s,l){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new Zs(this,{kind:"constant",value:void 0},a.parameters);var m=Ia[this.specification.type];return m?new Zs(this,{kind:"constant",value:m(a.value.value,s.value.value,l)},a.parameters):a},Un.prototype.evaluate=function(a,s,l,m,_,E){return a.kind==="constant"?a.value:a.evaluate(s,l,m,_,E)};var kf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,m,_,E){if(l.value===void 0)return new Zs(this,{kind:"constant",value:void 0},m);if(l.expression.kind==="constant"){var A=l.expression.evaluate(m,null,{},_,E),P=l.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,F=this._calculate(P,P,P,m);return new Zs(this,{kind:"constant",value:F},m)}if(l.expression.kind==="camera"){var j=this._calculate(l.expression.evaluate({zoom:m.zoom-1}),l.expression.evaluate({zoom:m.zoom}),l.expression.evaluate({zoom:m.zoom+1}),m);return new Zs(this,{kind:"constant",value:j},m)}return new Zs(this,l.expression,m)},s.prototype.evaluate=function(l,m,_,E,A,P){if(l.kind==="source"){var F=l.evaluate(m,_,E,A,P);return this._calculate(F,F,F,m)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(m.zoom)-1},_,E),l.evaluate({zoom:Math.floor(m.zoom)},_,E),l.evaluate({zoom:Math.floor(m.zoom)+1},_,E),m):l.value},s.prototype._calculate=function(l,m,_,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:l,to:m}:{from:_,to:m}},s.prototype.interpolate=function(l){return l},s}(Un),rs=function(a){this.specification=a};rs.prototype.possiblyEvaluate=function(a,s,l,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},l,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new Oi(Math.floor(s.zoom-1),s)),a.expression.evaluate(new Oi(Math.floor(s.zoom),s)),a.expression.evaluate(new Oi(Math.floor(s.zoom+1),s)),s)}},rs.prototype._calculate=function(a,s,l,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:l,to:s}},rs.prototype.interpolate=function(a){return a};var Iu=function(a){this.specification=a};Iu.prototype.possiblyEvaluate=function(a,s,l,m){return!!a.expression.evaluate(s,null,{},l,m)},Iu.prototype.interpolate=function(){return!1};var cs=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var l=a[s];l.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new Mu(l,void 0),_=this.defaultTransitionablePropertyValues[s]=new yu(l);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};Fn("DataDrivenProperty",Un),Fn("DataConstantProperty",$n),Fn("CrossFadedDataDrivenProperty",kf),Fn("CrossFadedProperty",rs),Fn("ColorRampProperty",Iu);var _u=function(a){function s(l,m){if(a.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),m.layout&&(this._unevaluatedLayout=new zs(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new ls(m.paint),l.paint)this.setPaintProperty(_,l.paint[_],{validate:!1});for(var E in l.layout)this.setLayoutProperty(E,l.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cu(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,m,_){_===void 0&&(_={}),m!=null&&this._validate(Qc,"layers."+this.id+".layout."+l,l,m,_)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,m):this.visibility=m)},s.prototype.getPaintProperty=function(l){return J(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-"-transition".length)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(Ul,"layers."+this.id+".paint."+l,l,m,_))return!1;if(J(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-"-transition".length),m||void 0),!1;var E=this._transitionablePaint._values[l],A=E.property.specification["property-type"]==="cross-faded-data-driven",P=E.value.isDataDriven(),F=E.value;this._transitionablePaint.setValue(l,m),this._handleSpecialPaintPropertyUpdate(l);var j=this._transitionablePaint._values[l].value;return j.isDataDriven()||P||A||this._handleOverridablePaintPropertyUpdate(l,F,j)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,m,_){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,m){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,m)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Tt(l,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(l,m,_,E,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&hc(this,l.call(ks,{key:m,layerType:this.type,objectKey:_,value:E,styleSpec:be,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var m=this.paint.get(l);if(m instanceof Zs&&ou(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(_t),Pf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ef=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},fa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Da(a,s){s===void 0&&(s=1);var l=0,m=0;return{members:a.map(function(_){var E=Pf[_.type].BYTES_PER_ELEMENT,A=l=tf(l,Math.max(s,E)),P=_.components||1;return m=Math.max(m,E),l+=E*P,{name:_.name,type:_.type,components:P,offset:A}}),size:tf(l,Math.max(m,s)),alignment:s}}function tf(a,s){return Math.ceil(a/s)*s}fa.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},fa.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},fa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},fa.prototype.clear=function(){this.length=0},fa.prototype.resize=function(a){this.reserve(a),this.length=a},fa.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},fa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Gl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m){var _=this.length;return this.resize(_+1),this.emplace(_,l,m)},s.prototype.emplace=function(l,m,_){var E=2*l;return this.int16[E+0]=m,this.int16[E+1]=_,l},s}(fa);Gl.prototype.bytesPerElement=4,Fn("StructArrayLayout2i4",Gl);var Ks=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,l,m,_,E)},s.prototype.emplace=function(l,m,_,E,A){var P=4*l;return this.int16[P+0]=m,this.int16[P+1]=_,this.int16[P+2]=E,this.int16[P+3]=A,l},s}(fa);Ks.prototype.bytesPerElement=8,Fn("StructArrayLayout4i8",Ks);var ku=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P){var F=this.length;return this.resize(F+1),this.emplace(F,l,m,_,E,A,P)},s.prototype.emplace=function(l,m,_,E,A,P,F){var j=6*l;return this.int16[j+0]=m,this.int16[j+1]=_,this.int16[j+2]=E,this.int16[j+3]=A,this.int16[j+4]=P,this.int16[j+5]=F,l},s}(fa);ku.prototype.bytesPerElement=12,Fn("StructArrayLayout2i4i12",ku);var Do=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P){var F=this.length;return this.resize(F+1),this.emplace(F,l,m,_,E,A,P)},s.prototype.emplace=function(l,m,_,E,A,P,F){var j=4*l,$=8*l;return this.int16[j+0]=m,this.int16[j+1]=_,this.uint8[$+4]=E,this.uint8[$+5]=A,this.uint8[$+6]=P,this.uint8[$+7]=F,l},s}(fa);Do.prototype.bytesPerElement=8,Fn("StructArrayLayout2i4ub8",Do);var Sl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m){var _=this.length;return this.resize(_+1),this.emplace(_,l,m)},s.prototype.emplace=function(l,m,_){var E=2*l;return this.float32[E+0]=m,this.float32[E+1]=_,l},s}(fa);Sl.prototype.bytesPerElement=8,Fn("StructArrayLayout2f8",Sl);var xu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P,F,j,$,K){var ue=this.length;return this.resize(ue+1),this.emplace(ue,l,m,_,E,A,P,F,j,$,K)},s.prototype.emplace=function(l,m,_,E,A,P,F,j,$,K,ue){var de=10*l;return this.uint16[de+0]=m,this.uint16[de+1]=_,this.uint16[de+2]=E,this.uint16[de+3]=A,this.uint16[de+4]=P,this.uint16[de+5]=F,this.uint16[de+6]=j,this.uint16[de+7]=$,this.uint16[de+8]=K,this.uint16[de+9]=ue,l},s}(fa);xu.prototype.bytesPerElement=20,Fn("StructArrayLayout10ui20",xu);var Hl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P,F,j,$,K,ue,de){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,l,m,_,E,A,P,F,j,$,K,ue,de)},s.prototype.emplace=function(l,m,_,E,A,P,F,j,$,K,ue,de,Ve){var Ge=12*l;return this.int16[Ge+0]=m,this.int16[Ge+1]=_,this.int16[Ge+2]=E,this.int16[Ge+3]=A,this.uint16[Ge+4]=P,this.uint16[Ge+5]=F,this.uint16[Ge+6]=j,this.uint16[Ge+7]=$,this.int16[Ge+8]=K,this.int16[Ge+9]=ue,this.int16[Ge+10]=de,this.int16[Ge+11]=Ve,l},s}(fa);Hl.prototype.bytesPerElement=24,Fn("StructArrayLayout4i4ui4i24",Hl);var mc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,m,_)},s.prototype.emplace=function(l,m,_,E){var A=3*l;return this.float32[A+0]=m,this.float32[A+1]=_,this.float32[A+2]=E,l},s}(fa);mc.prototype.bytesPerElement=12,Fn("StructArrayLayout3f12",mc);var gc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var m=this.length;return this.resize(m+1),this.emplace(m,l)},s.prototype.emplace=function(l,m){return this.uint32[1*l+0]=m,l},s}(fa);gc.prototype.bytesPerElement=4,Fn("StructArrayLayout1ul4",gc);var Lf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P,F,j,$){var K=this.length;return this.resize(K+1),this.emplace(K,l,m,_,E,A,P,F,j,$)},s.prototype.emplace=function(l,m,_,E,A,P,F,j,$,K){var ue=10*l,de=5*l;return this.int16[ue+0]=m,this.int16[ue+1]=_,this.int16[ue+2]=E,this.int16[ue+3]=A,this.int16[ue+4]=P,this.int16[ue+5]=F,this.uint32[de+3]=j,this.uint16[ue+8]=$,this.uint16[ue+9]=K,l},s}(fa);Lf.prototype.bytesPerElement=20,Fn("StructArrayLayout6i1ul2ui20",Lf);var yc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P){var F=this.length;return this.resize(F+1),this.emplace(F,l,m,_,E,A,P)},s.prototype.emplace=function(l,m,_,E,A,P,F){var j=6*l;return this.int16[j+0]=m,this.int16[j+1]=_,this.int16[j+2]=E,this.int16[j+3]=A,this.int16[j+4]=P,this.int16[j+5]=F,l},s}(fa);yc.prototype.bytesPerElement=12,Fn("StructArrayLayout2i2i2i12",yc);var _o=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A){var P=this.length;return this.resize(P+1),this.emplace(P,l,m,_,E,A)},s.prototype.emplace=function(l,m,_,E,A,P){var F=4*l,j=8*l;return this.float32[F+0]=m,this.float32[F+1]=_,this.float32[F+2]=E,this.int16[j+6]=A,this.int16[j+7]=P,l},s}(fa);_o.prototype.bytesPerElement=16,Fn("StructArrayLayout2f1f2i16",_o);var Bh=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,l,m,_,E)},s.prototype.emplace=function(l,m,_,E,A){var P=12*l,F=3*l;return this.uint8[P+0]=m,this.uint8[P+1]=_,this.float32[F+1]=E,this.float32[F+2]=A,l},s}(fa);Bh.prototype.bytesPerElement=12,Fn("StructArrayLayout2ub2f12",Bh);var Wl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,m,_)},s.prototype.emplace=function(l,m,_,E){var A=3*l;return this.uint16[A+0]=m,this.uint16[A+1]=_,this.uint16[A+2]=E,l},s}(fa);Wl.prototype.bytesPerElement=6,Fn("StructArrayLayout3ui6",Wl);var Xl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge,ut,Qe,Mt){var jt=this.length;return this.resize(jt+1),this.emplace(jt,l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge,ut,Qe,Mt)},s.prototype.emplace=function(l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge,ut,Qe,Mt,jt){var ir=24*l,hr=12*l,Ar=48*l;return this.int16[ir+0]=m,this.int16[ir+1]=_,this.uint16[ir+2]=E,this.uint16[ir+3]=A,this.uint32[hr+2]=P,this.uint32[hr+3]=F,this.uint32[hr+4]=j,this.uint16[ir+10]=$,this.uint16[ir+11]=K,this.uint16[ir+12]=ue,this.float32[hr+7]=de,this.float32[hr+8]=Ve,this.uint8[Ar+36]=Ge,this.uint8[Ar+37]=ut,this.uint8[Ar+38]=Qe,this.uint32[hr+10]=Mt,this.int16[ir+22]=jt,l},s}(fa);Xl.prototype.bytesPerElement=48,Fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xl);var Rf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge,ut,Qe,Mt,jt,ir,hr,Ar,Wr,tn,qn,Mn,ti,On,Di){var _i=this.length;return this.resize(_i+1),this.emplace(_i,l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge,ut,Qe,Mt,jt,ir,hr,Ar,Wr,tn,qn,Mn,ti,On,Di)},s.prototype.emplace=function(l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge,ut,Qe,Mt,jt,ir,hr,Ar,Wr,tn,qn,Mn,ti,On,Di,_i){var Wn=34*l,Ui=17*l;return this.int16[Wn+0]=m,this.int16[Wn+1]=_,this.int16[Wn+2]=E,this.int16[Wn+3]=A,this.int16[Wn+4]=P,this.int16[Wn+5]=F,this.int16[Wn+6]=j,this.int16[Wn+7]=$,this.uint16[Wn+8]=K,this.uint16[Wn+9]=ue,this.uint16[Wn+10]=de,this.uint16[Wn+11]=Ve,this.uint16[Wn+12]=Ge,this.uint16[Wn+13]=ut,this.uint16[Wn+14]=Qe,this.uint16[Wn+15]=Mt,this.uint16[Wn+16]=jt,this.uint16[Wn+17]=ir,this.uint16[Wn+18]=hr,this.uint16[Wn+19]=Ar,this.uint16[Wn+20]=Wr,this.uint16[Wn+21]=tn,this.uint16[Wn+22]=qn,this.uint32[Ui+12]=Mn,this.float32[Ui+13]=ti,this.float32[Ui+14]=On,this.float32[Ui+15]=Di,this.float32[Ui+16]=_i,l},s}(fa);Rf.prototype.bytesPerElement=68,Fn("StructArrayLayout8i15ui1ul4f68",Rf);var Yl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var m=this.length;return this.resize(m+1),this.emplace(m,l)},s.prototype.emplace=function(l,m){return this.float32[1*l+0]=m,l},s}(fa);Yl.prototype.bytesPerElement=4,Fn("StructArrayLayout1f4",Yl);var fs=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,m,_)},s.prototype.emplace=function(l,m,_,E){var A=3*l;return this.int16[A+0]=m,this.int16[A+1]=_,this.int16[A+2]=E,l},s}(fa);fs.prototype.bytesPerElement=6,Fn("StructArrayLayout3i6",fs);var _c=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,m,_)},s.prototype.emplace=function(l,m,_,E){var A=4*l;return this.uint32[2*l+0]=m,this.uint16[A+2]=_,this.uint16[A+3]=E,l},s}(fa);_c.prototype.bytesPerElement=8,Fn("StructArrayLayout1ul2ui8",_c);var Cl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m){var _=this.length;return this.resize(_+1),this.emplace(_,l,m)},s.prototype.emplace=function(l,m,_){var E=2*l;return this.uint16[E+0]=m,this.uint16[E+1]=_,l},s}(fa);Cl.prototype.bytesPerElement=4,Fn("StructArrayLayout2ui4",Cl);var Of=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var m=this.length;return this.resize(m+1),this.emplace(m,l)},s.prototype.emplace=function(l,m){return this.uint16[1*l+0]=m,l},s}(fa);Of.prototype.bytesPerElement=2,Fn("StructArrayLayout1ui2",Of);var $l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,m,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,l,m,_,E)},s.prototype.emplace=function(l,m,_,E,A){var P=4*l;return this.float32[P+0]=m,this.float32[P+1]=_,this.float32[P+2]=E,this.float32[P+3]=A,l},s}(fa);$l.prototype.bytesPerElement=16,Fn("StructArrayLayout4f16",$l);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new ce(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(ef);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(Lf);Fn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(ef);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new h(this,l)},s}(Xl);Fn("PlacedSymbolArray",g);var C=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(ef);C.prototype.size=68;var T=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new C(this,l)},s}(Rf);Fn("SymbolInstanceArray",T);var k=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(Yl);Fn("GlyphOffsetArray",k);var D=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(fs);Fn("SymbolLineVertexArray",D);var G=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(ef);G.prototype.size=8;var ee=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new G(this,l)},s}(_c);Fn("FeatureIndexArray",ee);var _e=Da([{name:"a_pos",components:2,type:"Int16"}],4).members,Ee=function(a){a===void 0&&(a=[]),this.segments=a};function Ce(a,s){return 256*(a=Pt(Math.floor(a),0,255))+Pt(Math.floor(s),0,255)}Ee.prototype.prepareSegment=function(a,s,l,m){var _=this.segments[this.segments.length-1];return a>Ee.MAX_VERTEX_ARRAY_LENGTH&&mt("Max vertices per segment is "+Ee.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>Ee.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},Ee.prototype.get=function(){return this.segments},Ee.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var l=s[a];for(var m in l.vaos)l.vaos[m].destroy()}},Ee.simpleSegment=function(a,s,l,m){return new Ee([{vertexOffset:a,primitiveOffset:s,vertexLength:l,primitiveLength:m,vaos:{},sortKey:0}])},Ee.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn("SegmentVector",Ee);var Re=Da([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ze=Se(function(a){a.exports=function(s,l){var m,_,E,A,P,F,j,$;for(_=s.length-(m=3&s.length),E=l,P=3432918353,F=461845907,$=0;$<_;)j=255&s.charCodeAt($)|(255&s.charCodeAt(++$))<<8|(255&s.charCodeAt(++$))<<16|(255&s.charCodeAt(++$))<<24,++$,E=27492+(65535&(A=5*(65535&(E=(E^=j=(65535&(j=(j=(65535&j)*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*F+(((j>>>16)*F&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(j=0,m){case 3:j^=(255&s.charCodeAt($+2))<<16;case 2:j^=(255&s.charCodeAt($+1))<<8;case 1:E^=j=(65535&(j=(j=(65535&(j^=255&s.charCodeAt($)))*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*F+(((j>>>16)*F&65535)<<16)&4294967295}return E^=s.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),nt=Se(function(a){a.exports=function(s,l){for(var m,_=s.length,E=l^_,A=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:E^=(255&s.charCodeAt(A+2))<<16;case 2:E^=(255&s.charCodeAt(A+1))<<8;case 1:E=1540483477*(65535&(E^=255&s.charCodeAt(A)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Fe=Ze,at=nt;Fe.murmur3=Ze,Fe.murmur2=at;var yt=function(){this.ids=[],this.positions=[],this.indexed=!1};yt.prototype.add=function(a,s,l,m){this.ids.push(Zt(a)),this.positions.push(s,l,m)},yt.prototype.getPositions=function(a){for(var s=Zt(a),l=0,m=this.ids.length-1;l<m;){var _=l+m>>1;this.ids[_]>=s?m=_:l=_+1}for(var E=[];this.ids[l]===s;)E.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return E},yt.serialize=function(a,s){var l=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(E,A,P,F){for(;P<F;){for(var j=E[P+F>>1],$=P-1,K=F+1;;){do $++;while(E[$]<j);do K--;while(E[K]>j);if($>=K)break;Ct(E,$,K),Ct(A,3*$,3*K),Ct(A,3*$+1,3*K+1),Ct(A,3*$+2,3*K+2)}K-P<F-K?(_(E,A,P,K),P=K+1):(_(E,A,K+1,F),F=K)}}(l,m,0,l.length-1),s&&s.push(l.buffer,m.buffer),{ids:l,positions:m}},yt.deserialize=function(a){var s=new yt;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var Ut=Math.pow(2,53)-1;function Zt(a){var s=+a;return!isNaN(s)&&s<=Ut?s:Fe(String(a))}function Ct(a,s,l){var m=a[s];a[s]=a[l],a[l]=m}Fn("FeaturePositionMap",yt);var yr=function(a,s){this.gl=a.gl,this.location=s},Et=function(a){function s(l,m){a.call(this,l,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(yr),Qr=function(a){function s(l,m){a.call(this,l,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(yr),Hr=function(a){function s(l,m){a.call(this,l,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(yr),An=function(a){function s(l,m){a.call(this,l,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(yr),Qn=function(a){function s(l,m){a.call(this,l,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(yr),Jn=function(a){function s(l,m){a.call(this,l,m),this.current=sr.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(yr),ni=new Float32Array(16),Xi=function(a){function s(l,m){a.call(this,l,m),this.current=ni}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var m=1;m<16;m++)if(l[m]!==this.current[m]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(yr);function wn(a){return[Ce(255*a.r,255*a.g),Ce(255*a.b,255*a.a)]}var Si=function(a,s,l){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=l};Si.prototype.setUniform=function(a,s,l){a.set(l.constantOr(this.value))},Si.prototype.getBinding=function(a,s,l){return this.type==="color"?new Jn(a,s):new Qr(a,s)};var Ai=function(a,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ai.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},Ai.prototype.setUniform=function(a,s,l,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},Ai.prototype.getBinding=function(a,s,l){return l.substr(0,9)==="u_pattern"?new Qn(a,s):new Qr(a,s)};var vi=function(a,s,l,m){this.expression=a,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new m};vi.prototype.populatePaintArray=function(a,s,l,m,_){var E=this.paintVertexArray.length,A=this.expression.evaluate(new Oi(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(E,a,A)},vi.prototype.updatePaintArray=function(a,s,l,m){var _=this.expression.evaluate({zoom:0},l,m);this._setPaintValue(a,s,_)},vi.prototype._setPaintValue=function(a,s,l){if(this.type==="color")for(var m=wn(l),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var E=a;E<s;E++)this.paintVertexArray.emplace(E,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},vi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ai=function(a,s,l,m,_,E){this.expression=a,this.uniformNames=s.map(function(A){return"u_"+A+"_t"}),this.type=l,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(A){return{name:"a_"+A,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ai.prototype.populatePaintArray=function(a,s,l,m,_){var E=this.expression.evaluate(new Oi(this.zoom),s,{},m,[],_),A=this.expression.evaluate(new Oi(this.zoom+1),s,{},m,[],_),P=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(P,a,E,A)},ai.prototype.updatePaintArray=function(a,s,l,m){var _=this.expression.evaluate({zoom:this.zoom},l,m),E=this.expression.evaluate({zoom:this.zoom+1},l,m);this._setPaintValue(a,s,_,E)},ai.prototype._setPaintValue=function(a,s,l,m){if(this.type==="color")for(var _=wn(l),E=wn(m),A=a;A<s;A++)this.paintVertexArray.emplace(A,_[0],_[1],E[0],E[1]);else{for(var P=a;P<s;P++)this.paintVertexArray.emplace(P,l,m);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(m))}},ai.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ai.prototype.setUniform=function(a,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=Pt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);a.set(m)},ai.prototype.getBinding=function(a,s,l){return new Qr(a,s)};var wi=function(a,s,l,m,_,E){this.expression=a,this.type=s,this.useIntegerZoom=l,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};wi.prototype.populatePaintArray=function(a,s,l){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],l)},wi.prototype.updatePaintArray=function(a,s,l,m,_){this._setPaintValues(a,s,l.patterns&&l.patterns[this.layerId],_)},wi.prototype._setPaintValues=function(a,s,l,m){if(m&&l){var _=m[l.min],E=m[l.mid],A=m[l.max];if(_&&E&&A)for(var P=a;P<s;P++)this.zoomInPaintVertexArray.emplace(P,E.tl[0],E.tl[1],E.br[0],E.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],E.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,E.tl[0],E.tl[1],E.br[0],E.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],E.pixelRatio,A.pixelRatio)}},wi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))},wi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var li=function(a,s,l){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(l(_)){var E=a.paint.get(_);if(E instanceof Zs&&ou(E.property.specification)){var A=xo(_,a.type),P=E.value,F=E.property.specification.type,j=E.property.useIntegerZoom,$=E.property.specification["property-type"],K=$==="cross-faded"||$==="cross-faded-data-driven";if(P.kind==="constant")this.binders[_]=K?new Ai(P.value,A):new Si(P.value,A,F),m.push("/u_"+_);else if(P.kind==="source"||K){var ue=Ja(_,F,"source");this.binders[_]=K?new wi(P,F,j,s,ue,a.id):new vi(P,A,F,ue),m.push("/a_"+_)}else{var de=Ja(_,F,"composite");this.binders[_]=new ai(P,A,F,j,s,de),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};li.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof vi||s instanceof ai?s.maxValue:0},li.prototype.populatePaintArrays=function(a,s,l,m,_){for(var E in this.binders){var A=this.binders[E];(A instanceof vi||A instanceof ai||A instanceof wi)&&A.populatePaintArray(a,s,l,m,_)}},li.prototype.setConstantPatternPositions=function(a,s){for(var l in this.binders){var m=this.binders[l];m instanceof Ai&&m.setConstantPatternPositions(a,s)}},li.prototype.updatePaintArrays=function(a,s,l,m,_){var E=!1;for(var A in a)for(var P=0,F=s.getPositions(A);P<F.length;P+=1){var j=F[P],$=l.feature(j.index);for(var K in this.binders){var ue=this.binders[K];if((ue instanceof vi||ue instanceof ai||ue instanceof wi)&&ue.expression.isStateDependent===!0){var de=m.paint.get(K);ue.expression=de.value,ue.updatePaintArray(j.start,j.end,$,a[A],_),E=!0}}}return E},li.prototype.defines=function(){var a=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Si||l instanceof Ai)&&a.push.apply(a,l.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},li.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof vi||l instanceof ai)for(var m=0;m<l.paintVertexAttributes.length;m++)a.push(l.paintVertexAttributes[m].name);else if(l instanceof wi)for(var _=0;_<Re.members.length;_++)a.push(Re.members[_].name)}return a},li.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Si||l instanceof Ai||l instanceof ai)for(var m=0,_=l.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},li.prototype.getPaintVertexBuffers=function(){return this._buffers},li.prototype.getUniforms=function(a,s){var l=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof Si||_ instanceof Ai||_ instanceof ai)for(var E=0,A=_.uniformNames;E<A.length;E+=1){var P=A[E];if(s[P]){var F=_.getBinding(a,s[P],P);l.push({name:P,property:m,binding:F})}}}return l},li.prototype.setUniforms=function(a,s,l,m){for(var _=0,E=s;_<E.length;_+=1){var A=E[_],P=A.name,F=A.property;this.binders[F].setUniform(A.binding,m,l.get(F),P)}},li.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(a&&l instanceof wi){var m=a.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(l instanceof vi||l instanceof ai)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},li.prototype.upload=function(a){for(var s in this.binders){var l=this.binders[s];(l instanceof vi||l instanceof ai||l instanceof wi)&&l.upload(a)}this.updatePaintBuffers()},li.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof vi||s instanceof ai||s instanceof wi)&&s.destroy()}};var oi=function(a,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var E=_[m];this.programConfigurations[E.id]=new li(E,s,l)}this.needsUpload=!1,this._featureMap=new yt,this._bufferOffset=0};function xo(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function Ja(a,s,l){var m={color:{source:Sl,composite:$l},number:{source:Yl,composite:Sl}},_=function(E){return{"line-pattern":{source:xu,composite:xu},"fill-pattern":{source:xu,composite:xu},"fill-extrusion-pattern":{source:xu,composite:xu}}[E]}(a);return _&&_[l]||m[s][l]}oi.prototype.populatePaintArrays=function(a,s,l,m,_,E){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(a,s,m,_,E);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},oi.prototype.updatePaintArrays=function(a,s,l,m){for(var _=0,E=l;_<E.length;_+=1){var A=E[_];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(a,this._featureMap,s,A,m)||this.needsUpload}},oi.prototype.get=function(a){return this.programConfigurations[a]},oi.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},oi.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Fn("ConstantBinder",Si),Fn("CrossFadedConstantBinder",Ai),Fn("SourceExpressionBinder",vi),Fn("CrossFadedCompositeBinder",wi),Fn("CompositeExpressionBinder",ai),Fn("ProgramConfiguration",li,{omit:["_buffers"]}),Fn("ProgramConfigurationSet",oi);var Io=Math.pow(2,14)-1,Wo=-Io-1;function eo(a){for(var s=8192/a.extent,l=a.loadGeometry(),m=0;m<l.length;m++)for(var _=l[m],E=0;E<_.length;E++){var A=_[E],P=Math.round(A.x*s),F=Math.round(A.y*s);A.x=Pt(P,Wo,Io),A.y=Pt(F,Wo,Io),(P<A.x||P>A.x+1||F<A.y||F>A.y+1)&&mt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function to(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?eo(a):[]}}function Ps(a,s,l,m,_){a.emplaceBack(2*s+(m+1)/2,2*l+(_+1)/2)}var hs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Gl,this.indexArray=new Wl,this.segments=new Ee,this.programConfigurations=new oi(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Gu(a,s){for(var l=0;l<a.length;l++)if(Xo(s,a[l]))return!0;for(var m=0;m<s.length;m++)if(Xo(a,s[m]))return!0;return!!xc(a,s)}function Es(a,s,l){return!!Xo(a,s)||!!Hu(s,a,l)}function Ls(a,s){if(a.length===1)return bc(s,a[0]);for(var l=0;l<s.length;l++)for(var m=s[l],_=0;_<m.length;_++)if(Xo(a,m[_]))return!0;for(var E=0;E<a.length;E++)if(bc(s,a[E]))return!0;for(var A=0;A<s.length;A++)if(xc(a,s[A]))return!0;return!1}function Qs(a,s,l){if(a.length>1){if(xc(a,s))return!0;for(var m=0;m<s.length;m++)if(Hu(s[m],a,l))return!0}for(var _=0;_<a.length;_++)if(Hu(a[_],s,l))return!0;return!1}function xc(a,s){if(a.length===0||s.length===0)return!1;for(var l=0;l<a.length-1;l++)for(var m=a[l],_=a[l+1],E=0;E<s.length-1;E++)if(ql(m,_,s[E],s[E+1]))return!0;return!1}function ql(a,s,l,m){return fr(a,l,m)!==fr(s,l,m)&&fr(a,s,l)!==fr(a,s,m)}function Hu(a,s,l){var m=l*l;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(il(a,s[_-1],s[_])<m)return!0;return!1}function il(a,s,l){var m=s.distSqr(l);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(l.x-s.x)+(a.y-s.y)*(l.y-s.y))/m;return a.distSqr(_<0?s:_>1?l:l.sub(s)._mult(_)._add(s))}function bc(a,s){for(var l,m,_,E=!1,A=0;A<a.length;A++)for(var P=0,F=(l=a[A]).length-1;P<l.length;F=P++)(m=l[P]).y>s.y!=(_=l[F]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(E=!E);return E}function Xo(a,s){for(var l=!1,m=0,_=a.length-1;m<a.length;_=m++){var E=a[m],A=a[_];E.y>s.y!=A.y>s.y&&s.x<(A.x-E.x)*(s.y-E.y)/(A.y-E.y)+E.x&&(l=!l)}return l}function Al(a,s,l){var m=l[0],_=l[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var E=fr(a,s,l[0]);return E!==fr(a,s,l[1])||E!==fr(a,s,l[2])||E!==fr(a,s,l[3])}function Wu(a,s,l){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:l.programConfigurations.get(s.id).getMaxValue(a)}function ko(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function al(a,s,l,m,_){if(!s[0]&&!s[1])return a;var E=ce.convert(s)._mult(_);l==="viewport"&&E._rotate(-m);for(var A=[],P=0;P<a.length;P++)A.push(a[P].sub(E));return A}hs.prototype.populate=function(a,s,l){var m=this.layers[0],_=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var A=0,P=a;A<P.length;A+=1){var F=P[A],j=F.feature,$=F.id,K=F.index,ue=F.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,Ve=to(j,de);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),Ve,l)){var Ge=E?E.evaluate(Ve,{},l):void 0,ut={id:$,properties:j.properties,type:j.type,sourceLayerIndex:ue,index:K,geometry:de?Ve.geometry:eo(j),patterns:{},sortKey:Ge};_.push(ut)}}E&&_.sort(function(tn,qn){return tn.sortKey-qn.sortKey});for(var Qe=0,Mt=_;Qe<Mt.length;Qe+=1){var jt=Mt[Qe],ir=jt.geometry,hr=jt.index,Ar=jt.sourceLayerIndex,Wr=a[hr].feature;this.addFeature(jt,ir,hr,l),s.featureIndex.insert(Wr,ir,hr,Ar,this.index)}},hs.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},hs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,_e),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hs.prototype.addFeature=function(a,s,l,m){for(var _=0,E=s;_<E.length;_+=1)for(var A=0,P=E[_];A<P.length;A+=1){var F=P[A],j=F.x,$=F.y;if(!(j<0||j>=8192||$<0||$>=8192)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ue=K.vertexLength;Ps(this.layoutVertexArray,j,$,-1,-1),Ps(this.layoutVertexArray,j,$,1,-1),Ps(this.layoutVertexArray,j,$,1,1),Ps(this.layoutVertexArray,j,$,-1,1),this.indexArray.emplaceBack(ue,ue+1,ue+2),this.indexArray.emplaceBack(ue,ue+3,ue+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,{},m)},Fn("CircleBucket",hs,{omit:["layers"]});var wl=new cs({"circle-sort-key":new Un(be.layout_circle["circle-sort-key"])}),Xu={paint:new cs({"circle-radius":new Un(be.paint_circle["circle-radius"]),"circle-color":new Un(be.paint_circle["circle-color"]),"circle-blur":new Un(be.paint_circle["circle-blur"]),"circle-opacity":new Un(be.paint_circle["circle-opacity"]),"circle-translate":new $n(be.paint_circle["circle-translate"]),"circle-translate-anchor":new $n(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $n(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $n(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Un(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Un(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Un(be.paint_circle["circle-stroke-opacity"])}),layout:wl},oa=typeof Float32Array!="undefined"?Float32Array:Array;function fu(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Rs(a,s,l){var m=s[0],_=s[1],E=s[2],A=s[3],P=s[4],F=s[5],j=s[6],$=s[7],K=s[8],ue=s[9],de=s[10],Ve=s[11],Ge=s[12],ut=s[13],Qe=s[14],Mt=s[15],jt=l[0],ir=l[1],hr=l[2],Ar=l[3];return a[0]=jt*m+ir*P+hr*K+Ar*Ge,a[1]=jt*_+ir*F+hr*ue+Ar*ut,a[2]=jt*E+ir*j+hr*de+Ar*Qe,a[3]=jt*A+ir*$+hr*Ve+Ar*Mt,a[4]=(jt=l[4])*m+(ir=l[5])*P+(hr=l[6])*K+(Ar=l[7])*Ge,a[5]=jt*_+ir*F+hr*ue+Ar*ut,a[6]=jt*E+ir*j+hr*de+Ar*Qe,a[7]=jt*A+ir*$+hr*Ve+Ar*Mt,a[8]=(jt=l[8])*m+(ir=l[9])*P+(hr=l[10])*K+(Ar=l[11])*Ge,a[9]=jt*_+ir*F+hr*ue+Ar*ut,a[10]=jt*E+ir*j+hr*de+Ar*Qe,a[11]=jt*A+ir*$+hr*Ve+Ar*Mt,a[12]=(jt=l[12])*m+(ir=l[13])*P+(hr=l[14])*K+(Ar=l[15])*Ge,a[13]=jt*_+ir*F+hr*ue+Ar*ut,a[14]=jt*E+ir*j+hr*de+Ar*Qe,a[15]=jt*A+ir*$+hr*Ve+Ar*Mt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,l=arguments.length;l--;)s+=a[l]*a[l];return Math.sqrt(s)});var ol,rf=Rs;function nf(a,s,l){var m=s[0],_=s[1],E=s[2],A=s[3];return a[0]=l[0]*m+l[4]*_+l[8]*E+l[12]*A,a[1]=l[1]*m+l[5]*_+l[9]*E+l[13]*A,a[2]=l[2]*m+l[6]*_+l[10]*E+l[14]*A,a[3]=l[3]*m+l[7]*_+l[11]*E+l[15]*A,a}ol=new oa(3),oa!=Float32Array&&(ol[0]=0,ol[1]=0,ol[2]=0),function(){var a=new oa(4);oa!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var Df=(function(){var a=new oa(2);oa!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(l){a.call(this,l,Xu)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(l){return new hs(l)},s.prototype.queryRadius=function(l){var m=l;return Wu("circle-radius",this,m)+Wu("circle-stroke-width",this,m)+ko(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,m,_,E,A,P,F,j){for(var $=al(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,F),K=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),ue=this.paint.get("circle-pitch-alignment")==="map",de=ue?$:function(Wr,tn){return Wr.map(function(qn){return hu(qn,tn)})}($,j),Ve=ue?K*F:K,Ge=0,ut=E;Ge<ut.length;Ge+=1)for(var Qe=0,Mt=ut[Ge];Qe<Mt.length;Qe+=1){var jt=Mt[Qe],ir=ue?jt:hu(jt,j),hr=Ve,Ar=nf([],[jt.x,jt.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?hr*=Ar[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(hr*=P.cameraToCenterDistance/Ar[3]),Es(de,ir,hr))return!0}return!1},s}(_u));function hu(a,s){var l=nf([],[a.x,a.y,0,1],s);return new ce(l[0]/l[3],l[1]/l[3])}var Ec=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(hs);function bu(a,s,l,m){var _=s.width,E=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*E*l)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*E*l);return a.width=_,a.height=E,a.data=m,a}function Pu(a,s,l){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var E=bu({},{width:m,height:_},l);Sc(a,E,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},l),a.width=m,a.height=_,a.data=E.data}}function Sc(a,s,l,m,_,E){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||l.x>a.width-_.width||l.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=a.data,P=s.data,F=0;F<_.height;F++)for(var j=((l.y+F)*a.width+l.x)*E,$=((m.y+F)*s.width+m.x)*E,K=0;K<_.width*E;K++)P[$+K]=A[j+K];return s}Fn("HeatmapBucket",Ec,{omit:["layers"]});var Lu=function(a,s){bu(this,a,1,s)};Lu.prototype.resize=function(a){Pu(this,a,1)},Lu.prototype.clone=function(){return new Lu({width:this.width,height:this.height},new Uint8Array(this.data))},Lu.copy=function(a,s,l,m,_){Sc(a,s,l,m,_,1)};var Yo=function(a,s){bu(this,a,4,s)};Yo.prototype.resize=function(a){Pu(this,a,4)},Yo.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Yo.prototype.clone=function(){return new Yo({width:this.width,height:this.height},new Uint8Array(this.data))},Yo.copy=function(a,s,l,m,_){Sc(a,s,l,m,_,4)},Fn("AlphaImage",Lu),Fn("RGBAImage",Yo);var Cc={paint:new cs({"heatmap-radius":new Un(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Un(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $n(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Iu(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $n(be.paint_heatmap["heatmap-opacity"])})};function Ff(a){var s={},l=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new Yo({width:l,height:m}),E=function(Ve,Ge,ut){s[a.evaluationKey]=ut;var Qe=a.expression.evaluate(s);_.data[Ve+Ge+0]=Math.floor(255*Qe.r/Qe.a),_.data[Ve+Ge+1]=Math.floor(255*Qe.g/Qe.a),_.data[Ve+Ge+2]=Math.floor(255*Qe.b/Qe.a),_.data[Ve+Ge+3]=Math.floor(255*Qe.a)};if(a.clips)for(var A=0,P=0;A<m;++A,P+=4*l)for(var F=0,j=0;F<l;F++,j+=4){var $=F/(l-1),K=a.clips[A];E(P,j,K.start*(1-$)+K.end*$)}else for(var ue=0,de=0;ue<l;ue++,de+=4)E(0,de,ue/(l-1));return _}var Bf=function(a){function s(l){a.call(this,l,Cc),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Ec(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Ff({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(_u),Nh={paint:new cs({"hillshade-illumination-direction":new $n(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $n(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $n(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $n(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $n(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $n(be.paint_hillshade["hillshade-accent-color"])})},wp=function(a){function s(l){a.call(this,l,Nh)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(_u),Tp=Da([{name:"a_pos",components:2,type:"Int16"}],4).members,Ac=Mp,oh=Mp;function Mp(a,s,l){l=l||2;var m,_,E,A,P,F,j,$=s&&s.length,K=$?s[0]*l:a.length,ue=zh(a,0,K,l,!0),de=[];if(!ue||ue.next===ue.prev)return de;if($&&(ue=function(Ge,ut,Qe,Mt){var jt,ir,hr,Ar=[];for(jt=0,ir=ut.length;jt<ir;jt++)(hr=zh(Ge,ut[jt]*Mt,jt<ir-1?ut[jt+1]*Mt:Ge.length,Mt,!1))===hr.next&&(hr.steiner=!0),Ar.push(Tc(hr));for(Ar.sort($r),jt=0;jt<Ar.length;jt++)Uh(Ar[jt],Qe),Qe=sl(Qe,Qe.next);return Qe}(a,s,ue,l)),a.length>80*l){m=E=a[0],_=A=a[1];for(var Ve=l;Ve<K;Ve+=l)(P=a[Ve])<m&&(m=P),(F=a[Ve+1])<_&&(_=F),P>E&&(E=P),F>A&&(A=F);j=(j=Math.max(E-m,A-_))!==0?1/j:0}return wc(ue,de,l,m,_,j),de}function zh(a,s,l,m,_){var E,A;if(_===sh(a,s,l,m)>0)for(E=s;E<l;E+=m)A=Nf(E,a[E],a[E+1],A);else for(E=l-m;E>=s;E-=m)A=Nf(E,a[E],a[E+1],A);return A&&Kl(A,A.next)&&(Mc(A),A=A.next),A}function sl(a,s){if(!a)return a;s||(s=a);var l,m=a;do if(l=!1,m.steiner||!Kl(m,m.next)&&Xa(m.prev,m,m.next)!==0)m=m.next;else{if(Mc(m),(m=s=m.prev)===m.next)break;l=!0}while(l||m!==s);return s}function wc(a,s,l,m,_,E,A){if(a){!A&&E&&function($,K,ue,de){var Ve=$;do Ve.z===null&&(Ve.z=$o(Ve.x,Ve.y,K,ue,de)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==$);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(Ge){var ut,Qe,Mt,jt,ir,hr,Ar,Wr,tn=1;do{for(Qe=Ge,Ge=null,ir=null,hr=0;Qe;){for(hr++,Mt=Qe,Ar=0,ut=0;ut<tn&&(Ar++,Mt=Mt.nextZ);ut++);for(Wr=tn;Ar>0||Wr>0&&Mt;)Ar!==0&&(Wr===0||!Mt||Qe.z<=Mt.z)?(jt=Qe,Qe=Qe.nextZ,Ar--):(jt=Mt,Mt=Mt.nextZ,Wr--),ir?ir.nextZ=jt:Ge=jt,jt.prevZ=ir,ir=jt;Qe=Mt}ir.nextZ=null,tn*=2}while(hr>1)}(Ve)}(a,m,_,E);for(var P,F,j=a;a.prev!==a.next;)if(P=a.prev,F=a.next,E?$d(a,m,_,E):Zh(a))s.push(P.i/l),s.push(a.i/l),s.push(F.i/l),Mc(a),a=F.next,j=F.next;else if((a=F)===j){A?A===1?wc(a=Us(sl(a),s,l),s,l,m,_,E,2):A===2&&Y(a,s,l,m,_,E):wc(sl(a),s,l,m,_,E,1);break}}}function Zh(a){var s=a.prev,l=a,m=a.next;if(Xa(s,l,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(ul(s.x,s.y,l.x,l.y,m.x,m.y,_.x,_.y)&&Xa(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function $d(a,s,l,m){var _=a.prev,E=a,A=a.next;if(Xa(_,E,A)>=0)return!1;for(var P=_.x>E.x?_.x>A.x?_.x:A.x:E.x>A.x?E.x:A.x,F=_.y>E.y?_.y>A.y?_.y:A.y:E.y>A.y?E.y:A.y,j=$o(_.x<E.x?_.x<A.x?_.x:A.x:E.x<A.x?E.x:A.x,_.y<E.y?_.y<A.y?_.y:A.y:E.y<A.y?E.y:A.y,s,l,m),$=$o(P,F,s,l,m),K=a.prevZ,ue=a.nextZ;K&&K.z>=j&&ue&&ue.z<=$;){if(K!==a.prev&&K!==a.next&&ul(_.x,_.y,E.x,E.y,A.x,A.y,K.x,K.y)&&Xa(K.prev,K,K.next)>=0||(K=K.prevZ,ue!==a.prev&&ue!==a.next&&ul(_.x,_.y,E.x,E.y,A.x,A.y,ue.x,ue.y)&&Xa(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;K&&K.z>=j;){if(K!==a.prev&&K!==a.next&&ul(_.x,_.y,E.x,E.y,A.x,A.y,K.x,K.y)&&Xa(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;ue&&ue.z<=$;){if(ue!==a.prev&&ue!==a.next&&ul(_.x,_.y,E.x,E.y,A.x,A.y,ue.x,ue.y)&&Xa(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function Us(a,s,l){var m=a;do{var _=m.prev,E=m.next.next;!Kl(_,E)&&Vh(_,m,m.next,E)&&af(_,E)&&af(E,_)&&(s.push(_.i/l),s.push(m.i/l),s.push(E.i/l),Mc(m),Mc(m.next),m=a=E),m=m.next}while(m!==a);return sl(m)}function Y(a,s,l,m,_,E){var A=a;do{for(var P=A.next.next;P!==A.prev;){if(A.i!==P.i&&Ip(A,P)){var F=of(A,P);return A=sl(A,A.next),F=sl(F,F.next),wc(A,s,l,m,_,E),void wc(F,s,l,m,_,E)}P=P.next}A=A.next}while(A!==a)}function $r(a,s){return a.x-s.x}function Uh(a,s){if(s=function(m,_){var E,A=_,P=m.x,F=m.y,j=-1/0;do{if(F<=A.y&&F>=A.next.y&&A.next.y!==A.y){var $=A.x+(F-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if($<=P&&$>j){if(j=$,$===P){if(F===A.y)return A;if(F===A.next.y)return A.next}E=A.x<A.next.x?A:A.next}}A=A.next}while(A!==_);if(!E)return null;if(P===j)return E;var K,ue=E,de=E.x,Ve=E.y,Ge=1/0;A=E;do P>=A.x&&A.x>=de&&P!==A.x&&ul(F<Ve?P:j,F,de,Ve,F<Ve?j:P,F,A.x,A.y)&&(K=Math.abs(F-A.y)/(P-A.x),af(A,m)&&(K<Ge||K===Ge&&(A.x>E.x||A.x===E.x&&qd(E,A)))&&(E=A,Ge=K)),A=A.next;while(A!==ue);return E}(a,s)){var l=of(s,a);sl(s,s.next),sl(l,l.next)}}function qd(a,s){return Xa(a.prev,a,s.prev)<0&&Xa(s.next,a,a.next)<0}function $o(a,s,l,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Tc(a){var s=a,l=a;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==a);return l}function ul(a,s,l,m,_,E,A,P){return(_-A)*(s-P)-(a-A)*(E-P)>=0&&(a-A)*(m-P)-(l-A)*(s-P)>=0&&(l-A)*(E-P)-(_-A)*(m-P)>=0}function Ip(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(l,m){var _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==m.i&&_.next.i!==m.i&&Vh(_,_.next,l,m))return!0;_=_.next}while(_!==l);return!1}(a,s)&&(af(a,s)&&af(s,a)&&function(l,m){var _=l,E=!1,A=(l.x+m.x)/2,P=(l.y+m.y)/2;do _.y>P!=_.next.y>P&&_.next.y!==_.y&&A<(_.next.x-_.x)*(P-_.y)/(_.next.y-_.y)+_.x&&(E=!E),_=_.next;while(_!==l);return E}(a,s)&&(Xa(a.prev,a,s.prev)||Xa(a,s.prev,s))||Kl(a,s)&&Xa(a.prev,a,a.next)>0&&Xa(s.prev,s,s.next)>0)}function Xa(a,s,l){return(s.y-a.y)*(l.x-s.x)-(s.x-a.x)*(l.y-s.y)}function Kl(a,s){return a.x===s.x&&a.y===s.y}function Vh(a,s,l,m){var _=jh(Xa(a,s,l)),E=jh(Xa(a,s,m)),A=jh(Xa(l,m,a)),P=jh(Xa(l,m,s));return _!==E&&A!==P||!(_!==0||!kp(a,l,s))||!(E!==0||!kp(a,m,s))||!(A!==0||!kp(l,a,m))||!(P!==0||!kp(l,s,m))}function kp(a,s,l){return s.x<=Math.max(a.x,l.x)&&s.x>=Math.min(a.x,l.x)&&s.y<=Math.max(a.y,l.y)&&s.y>=Math.min(a.y,l.y)}function jh(a){return a>0?1:a<0?-1:0}function af(a,s){return Xa(a.prev,a,a.next)<0?Xa(a,s,a.next)>=0&&Xa(a,a.prev,s)>=0:Xa(a,s,a.prev)<0||Xa(a,a.next,s)<0}function of(a,s){var l=new zf(a.i,a.x,a.y),m=new zf(s.i,s.x,s.y),_=a.next,E=s.prev;return a.next=s,s.prev=a,l.next=_,_.prev=l,m.next=l,l.prev=m,E.next=m,m.prev=E,m}function Nf(a,s,l,m){var _=new zf(a,s,l);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function Mc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function zf(a,s,l){this.i=a,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sh(a,s,l,m){for(var _=0,E=s,A=l-m;E<l;E+=m)_+=(a[A]-a[E])*(a[E+1]+a[A+1]),A=E;return _}function uh(a,s,l,m,_){(function E(A,P,F,j,$){for(;j>F;){if(j-F>600){var K=j-F+1,ue=P-F+1,de=Math.log(K),Ve=.5*Math.exp(2*de/3),Ge=.5*Math.sqrt(de*Ve*(K-Ve)/K)*(ue-K/2<0?-1:1);E(A,P,Math.max(F,Math.floor(P-ue*Ve/K+Ge)),Math.min(j,Math.floor(P+(K-ue)*Ve/K+Ge)),$)}var ut=A[P],Qe=F,Mt=j;for(Ql(A,F,P),$(A[j],ut)>0&&Ql(A,F,j);Qe<Mt;){for(Ql(A,Qe,Mt),Qe++,Mt--;$(A[Qe],ut)<0;)Qe++;for(;$(A[Mt],ut)>0;)Mt--}$(A[F],ut)===0?Ql(A,F,Mt):Ql(A,++Mt,j),Mt<=P&&(F=Mt+1),P<=Mt&&(j=Mt-1)}})(a,s,l||0,m||a.length-1,_||Gh)}function Ql(a,s,l){var m=a[s];a[s]=a[l],a[l]=m}function Gh(a,s){return a<s?-1:a>s?1:0}function sf(a,s){var l=a.length;if(l<=1)return[a];for(var m,_,E=[],A=0;A<l;A++){var P=Lr(a[A]);P!==0&&(a[A].area=Math.abs(P),_===void 0&&(_=P<0),_===P<0?(m&&E.push(m),m=[a[A]]):m.push(a[A]))}if(m&&E.push(m),s>1)for(var F=0;F<E.length;F++)E[F].length<=s||(uh(E[F],s,1,E[F].length-1,lh),E[F]=E[F].slice(0,s));return E}function lh(a,s){return s.area-a.area}function Zf(a,s,l){for(var m=l.patternDependencies,_=!1,E=0,A=s;E<A.length;E+=1){var P=A[E].paint.get(a+"-pattern");P.isConstant()||(_=!0);var F=P.constantOr(null);F&&(_=!0,m[F.to]=!0,m[F.from]=!0)}return _}function Uf(a,s,l,m,_){for(var E=_.patternDependencies,A=0,P=s;A<P.length;A+=1){var F=P[A],j=F.paint.get(a+"-pattern").value;if(j.kind!=="constant"){var $=j.evaluate({zoom:m-1},l,{},_.availableImages),K=j.evaluate({zoom:m},l,{},_.availableImages),ue=j.evaluate({zoom:m+1},l,{},_.availableImages);K=K&&K.name?K.name:K,ue=ue&&ue.name?ue.name:ue,E[$=$&&$.name?$.name:$]=!0,E[K]=!0,E[ue]=!0,l.patterns[F.id]={min:$,mid:K,max:ue}}}return l}Mp.deviation=function(a,s,l,m){var _=s&&s.length,E=Math.abs(sh(a,0,_?s[0]*l:a.length,l));if(_)for(var A=0,P=s.length;A<P;A++)E-=Math.abs(sh(a,s[A]*l,A<P-1?s[A+1]*l:a.length,l));var F=0;for(A=0;A<m.length;A+=3){var j=m[A]*l,$=m[A+1]*l,K=m[A+2]*l;F+=Math.abs((a[j]-a[K])*(a[$+1]-a[j+1])-(a[j]-a[$])*(a[K+1]-a[j+1]))}return E===0&&F===0?0:Math.abs((F-E)/E)},Mp.flatten=function(a){for(var s=a[0][0].length,l={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var E=0;E<a[_].length;E++)for(var A=0;A<s;A++)l.vertices.push(a[_][E][A]);_>0&&l.holes.push(m+=a[_-1].length)}return l},Ac.default=oh;var pu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Gl,this.indexArray=new Wl,this.indexArray2=new Cl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new Ee,this.segments2=new Ee,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};pu.prototype.populate=function(a,s,l){this.hasPattern=Zf("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],E=0,A=a;E<A.length;E+=1){var P=A[E],F=P.feature,j=P.id,$=P.index,K=P.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=to(F,ue);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),de,l)){var Ve=m?m.evaluate(de,{},l,s.availableImages):void 0,Ge={id:j,properties:F.properties,type:F.type,sourceLayerIndex:K,index:$,geometry:ue?de.geometry:eo(F),patterns:{},sortKey:Ve};_.push(Ge)}}m&&_.sort(function(Wr,tn){return Wr.sortKey-tn.sortKey});for(var ut=0,Qe=_;ut<Qe.length;ut+=1){var Mt=Qe[ut],jt=Mt.geometry,ir=Mt.index,hr=Mt.sourceLayerIndex;if(this.hasPattern){var Ar=Uf("fill",this.layers,Mt,this.zoom,s);this.patternFeatures.push(Ar)}else this.addFeature(Mt,jt,ir,l,{});s.featureIndex.insert(a[ir].feature,jt,ir,hr,this.index)}},pu.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},pu.prototype.addFeatures=function(a,s,l){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var E=_[m];this.addFeature(E,E.geometry,E.index,s,l)}},pu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},pu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},pu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Tp),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},pu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},pu.prototype.addFeature=function(a,s,l,m,_){for(var E=0,A=sf(s,500);E<A.length;E+=1){for(var P=A[E],F=0,j=0,$=P;j<$.length;j+=1)F+=$[j].length;for(var K=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),ue=K.vertexLength,de=[],Ve=[],Ge=0,ut=P;Ge<ut.length;Ge+=1){var Qe=ut[Ge];if(Qe.length!==0){Qe!==P[0]&&Ve.push(de.length/2);var Mt=this.segments2.prepareSegment(Qe.length,this.layoutVertexArray,this.indexArray2),jt=Mt.vertexLength;this.layoutVertexArray.emplaceBack(Qe[0].x,Qe[0].y),this.indexArray2.emplaceBack(jt+Qe.length-1,jt),de.push(Qe[0].x),de.push(Qe[0].y);for(var ir=1;ir<Qe.length;ir++)this.layoutVertexArray.emplaceBack(Qe[ir].x,Qe[ir].y),this.indexArray2.emplaceBack(jt+ir-1,jt+ir),de.push(Qe[ir].x),de.push(Qe[ir].y);Mt.vertexLength+=Qe.length,Mt.primitiveLength+=Qe.length}}for(var hr=Ac(de,Ve),Ar=0;Ar<hr.length;Ar+=3)this.indexArray.emplaceBack(ue+hr[Ar],ue+hr[Ar+1],ue+hr[Ar+2]);K.vertexLength+=F,K.primitiveLength+=hr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,_,m)},Fn("FillBucket",pu,{omit:["layers","patternFeatures"]});var Jl=new cs({"fill-sort-key":new Un(be.layout_fill["fill-sort-key"])}),ch={paint:new cs({"fill-antialias":new $n(be.paint_fill["fill-antialias"]),"fill-opacity":new Un(be.paint_fill["fill-opacity"]),"fill-color":new Un(be.paint_fill["fill-color"]),"fill-outline-color":new Un(be.paint_fill["fill-outline-color"]),"fill-translate":new $n(be.paint_fill["fill-translate"]),"fill-translate-anchor":new $n(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new kf(be.paint_fill["fill-pattern"])}),layout:Jl},fh=function(a){function s(l){a.call(this,l,ch)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(l,m){a.prototype.recalculate.call(this,l,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new pu(l)},s.prototype.queryRadius=function(){return ko(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,m,_,E,A,P,F){return Ls(al(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,F),E)},s.prototype.isTileClipped=function(){return!0},s}(_u),hh=Da([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Hh=Tl;function Tl(a,s,l,m,_){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(ec,this,s)}function ec(a,s,l){a==1?s.id=l.readVarint():a==2?function(m,_){for(var E=m.readVarint()+m.pos;m.pos<E;){var A=_._keys[m.readVarint()],P=_._values[m.readVarint()];_.properties[A]=P}}(l,s):a==3?s.type=l.readVarint():a==4&&(s._geometry=l.pos)}function Ic(a){for(var s,l,m=0,_=0,E=a.length,A=E-1;_<E;A=_++)m+=((l=a[A]).x-(s=a[_]).x)*(s.y+l.y);return m}Tl.types=["Unknown","Point","LineString","Polygon"],Tl.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,l=a.readVarint()+a.pos,m=1,_=0,E=0,A=0,P=[];a.pos<l;){if(_<=0){var F=a.readVarint();m=7&F,_=F>>3}if(_--,m===1||m===2)E+=a.readSVarint(),A+=a.readSVarint(),m===1&&(s&&P.push(s),s=[]),s.push(new ce(E,A));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&P.push(s),P},Tl.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,l=1,m=0,_=0,E=0,A=1/0,P=-1/0,F=1/0,j=-1/0;a.pos<s;){if(m<=0){var $=a.readVarint();l=7&$,m=$>>3}if(m--,l===1||l===2)(_+=a.readSVarint())<A&&(A=_),_>P&&(P=_),(E+=a.readSVarint())<F&&(F=E),E>j&&(j=E);else if(l!==7)throw new Error("unknown command "+l)}return[A,F,P,j]},Tl.prototype.toGeoJSON=function(a,s,l){var m,_,E=this.extent*Math.pow(2,l),A=this.extent*a,P=this.extent*s,F=this.loadGeometry(),j=Tl.types[this.type];function $(de){for(var Ve=0;Ve<de.length;Ve++){var Ge=de[Ve];de[Ve]=[360*(Ge.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ge.y+P)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<F.length;m++)K[m]=F[m][0];$(F=K);break;case 2:for(m=0;m<F.length;m++)$(F[m]);break;case 3:for(F=function(de){var Ve=de.length;if(Ve<=1)return[de];for(var Ge,ut,Qe=[],Mt=0;Mt<Ve;Mt++){var jt=Ic(de[Mt]);jt!==0&&(ut===void 0&&(ut=jt<0),ut===jt<0?(Ge&&Qe.push(Ge),Ge=[de[Mt]]):Ge.push(de[Mt]))}return Ge&&Qe.push(Ge),Qe}(F),m=0;m<F.length;m++)for(_=0;_<F[m].length;_++)$(F[m][_])}F.length===1?F=F[0]:j="Multi"+j;var ue={type:"Feature",geometry:{type:j,coordinates:F},properties:this.properties};return"id"in this&&(ue.id=this.id),ue};var kc=Kd;function Kd(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Qd,this,s),this.length=this._features.length}function Qd(a,s,l){a===15?s.version=l.readVarint():a===1?s.name=l.readString():a===5?s.extent=l.readVarint():a===2?s._features.push(l.pos):a===3?s._keys.push(l.readString()):a===4&&s._values.push(function(m){for(var _=null,E=m.readVarint()+m.pos;m.pos<E;){var A=m.readVarint()>>3;_=A===1?m.readString():A===2?m.readFloat():A===3?m.readDouble():A===4?m.readVarint64():A===5?m.readVarint():A===6?m.readSVarint():A===7?m.readBoolean():null}return _}(l))}function ph(a,s,l){if(a===3){var m=new kc(l,l.readVarint()+l.pos);m.length&&(s[m.name]=m)}}Kd.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new Hh(this._pbf,s,this.extent,this._keys,this._values)};var Os={VectorTile:function(a,s){this.layers=a.readFields(ph,{},s)},VectorTileFeature:Hh,VectorTileLayer:kc},Eu=Os.VectorTileFeature.types,Wh=Math.pow(2,13);function uf(a,s,l,m,_,E,A,P){a.emplaceBack(s,l,2*Math.floor(m*Wh)+A,_*Wh*2,E*Wh*2,Math.round(P))}var Yu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new ku,this.indexArray=new Wl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new Ee,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function dh(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}Yu.prototype.populate=function(a,s,l){this.features=[],this.hasPattern=Zf("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var E=_[m],A=E.feature,P=E.id,F=E.index,j=E.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,K=to(A,$);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),K,l)){var ue={id:P,sourceLayerIndex:j,index:F,geometry:$?K.geometry:eo(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(Uf("fill-extrusion",this.layers,ue,this.zoom,s)):this.addFeature(ue,ue.geometry,F,l,{}),s.featureIndex.insert(A,ue.geometry,F,j,this.index,!0)}}},Yu.prototype.addFeatures=function(a,s,l){for(var m=0,_=this.features;m<_.length;m+=1){var E=_[m];this.addFeature(E,E.geometry,E.index,s,l)}},Yu.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},Yu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Yu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Yu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,hh),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Yu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Yu.prototype.addFeature=function(a,s,l,m,_){for(var E=0,A=sf(s,500);E<A.length;E+=1){for(var P=A[E],F=0,j=0,$=P;j<$.length;j+=1)F+=$[j].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ue=0,de=P;ue<de.length;ue+=1){var Ve=de[ue];if(Ve.length!==0&&!((Ui=Ve).every(function(Li){return Li.x<0})||Ui.every(function(Li){return Li.x>8192})||Ui.every(function(Li){return Li.y<0})||Ui.every(function(Li){return Li.y>8192})))for(var Ge=0,ut=0;ut<Ve.length;ut++){var Qe=Ve[ut];if(ut>=1){var Mt=Ve[ut-1];if(!dh(Qe,Mt)){K.vertexLength+4>Ee.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var jt=Qe.sub(Mt)._perp()._unit(),ir=Mt.dist(Qe);Ge+ir>32768&&(Ge=0),uf(this.layoutVertexArray,Qe.x,Qe.y,jt.x,jt.y,0,0,Ge),uf(this.layoutVertexArray,Qe.x,Qe.y,jt.x,jt.y,0,1,Ge),uf(this.layoutVertexArray,Mt.x,Mt.y,jt.x,jt.y,0,0,Ge+=ir),uf(this.layoutVertexArray,Mt.x,Mt.y,jt.x,jt.y,0,1,Ge);var hr=K.vertexLength;this.indexArray.emplaceBack(hr,hr+2,hr+1),this.indexArray.emplaceBack(hr+1,hr+2,hr+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+F>Ee.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),Eu[a.type]==="Polygon"){for(var Ar=[],Wr=[],tn=K.vertexLength,qn=0,Mn=P;qn<Mn.length;qn+=1){var ti=Mn[qn];if(ti.length!==0){ti!==P[0]&&Wr.push(Ar.length/2);for(var On=0;On<ti.length;On++){var Di=ti[On];uf(this.layoutVertexArray,Di.x,Di.y,0,0,1,1,0),Ar.push(Di.x),Ar.push(Di.y)}}}for(var _i=Ac(Ar,Wr),Wn=0;Wn<_i.length;Wn+=3)this.indexArray.emplaceBack(tn+_i[Wn],tn+_i[Wn+2],tn+_i[Wn+1]);K.primitiveLength+=_i.length/3,K.vertexLength+=F}}var Ui;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,_,m)},Fn("FillExtrusionBucket",Yu,{omit:["layers","features"]});var Jd={paint:new cs({"fill-extrusion-opacity":new $n(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Un(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $n(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $n(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kf(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Un(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Un(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $n(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ml=function(a){function s(l){a.call(this,l,Jd)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Yu(l)},s.prototype.queryRadius=function(){return ko(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,m,_,E,A,P,F,j){var $=al(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,F),K=this.paint.get("fill-extrusion-height").evaluate(m,_),ue=this.paint.get("fill-extrusion-base").evaluate(m,_),de=function(Ge,ut,Qe,Mt){for(var jt=[],ir=0,hr=Ge;ir<hr.length;ir+=1){var Ar=hr[ir],Wr=[Ar.x,Ar.y,0,1];nf(Wr,Wr,ut),jt.push(new ce(Wr[0]/Wr[3],Wr[1]/Wr[3]))}return jt}($,j),Ve=function(Ge,ut,Qe,Mt){for(var jt=[],ir=[],hr=Mt[8]*ut,Ar=Mt[9]*ut,Wr=Mt[10]*ut,tn=Mt[11]*ut,qn=Mt[8]*Qe,Mn=Mt[9]*Qe,ti=Mt[10]*Qe,On=Mt[11]*Qe,Di=0,_i=Ge;Di<_i.length;Di+=1){for(var Wn=[],Ui=[],Li=0,pa=_i[Di];Li<pa.length;Li+=1){var ii=pa[Li],ya=ii.x,so=ii.y,Eo=Mt[0]*ya+Mt[4]*so+Mt[12],So=Mt[1]*ya+Mt[5]*so+Mt[13],vo=Mt[2]*ya+Mt[6]*so+Mt[14],Lo=Mt[3]*ya+Mt[7]*so+Mt[15],ss=vo+Wr,ms=Lo+tn,eu=Eo+qn,Ss=So+Mn,tu=vo+ti,zo=Lo+On,Cs=new ce((Eo+hr)/ms,(So+Ar)/ms);Cs.z=ss/ms,Wn.push(Cs);var ea=new ce(eu/zo,Ss/zo);ea.z=tu/zo,Ui.push(ea)}jt.push(Wn),ir.push(Ui)}return[jt,ir]}(E,ue,K,j);return function(Ge,ut,Qe){var Mt=1/0;Ls(Qe,ut)&&(Mt=Pc(Qe,ut[0]));for(var jt=0;jt<ut.length;jt++)for(var ir=ut[jt],hr=Ge[jt],Ar=0;Ar<ir.length-1;Ar++){var Wr=ir[Ar],tn=[Wr,ir[Ar+1],hr[Ar+1],hr[Ar],Wr];Gu(Qe,tn)&&(Mt=Math.min(Mt,Pc(Qe,tn)))}return Mt!==1/0&&Mt}(Ve[0],Ve[1],de)},s}(_u);function Vf(a,s){return a.x*s.x+a.y*s.y}function Pc(a,s){if(a.length===1){for(var l,m=0,_=s[m++];!l||_.equals(l);)if(!(l=s[m++]))return 1/0;for(;m<s.length;m++){var E=s[m],A=a[0],P=l.sub(_),F=E.sub(_),j=A.sub(_),$=Vf(P,P),K=Vf(P,F),ue=Vf(F,F),de=Vf(j,P),Ve=Vf(j,F),Ge=$*ue-K*K,ut=(ue*de-K*Ve)/Ge,Qe=($*Ve-K*de)/Ge,Mt=_.z*(1-ut-Qe)+l.z*ut+E.z*Qe;if(isFinite(Mt))return Mt}return 1/0}for(var jt=1/0,ir=0,hr=s;ir<hr.length;ir+=1)jt=Math.min(jt,hr[ir].z);return jt}var Il=Da([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,jf=Da([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ud=Os.VectorTileFeature.types,vh=Math.cos(Math.PI/180*37.5),Pp=Math.pow(2,14)/.5,Sa=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new Do,this.layoutVertexArray2=new Sl,this.indexArray=new Wl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new Ee,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};Sa.prototype.populate=function(a,s,l){this.hasPattern=Zf("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],E=0,A=a;E<A.length;E+=1){var P=A[E],F=P.feature,j=P.id,$=P.index,K=P.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=to(F,ue);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),de,l)){var Ve=m?m.evaluate(de,{},l):void 0,Ge={id:j,properties:F.properties,type:F.type,sourceLayerIndex:K,index:$,geometry:ue?de.geometry:eo(F),patterns:{},sortKey:Ve};_.push(Ge)}}m&&_.sort(function(Wr,tn){return Wr.sortKey-tn.sortKey});for(var ut=0,Qe=_;ut<Qe.length;ut+=1){var Mt=Qe[ut],jt=Mt.geometry,ir=Mt.index,hr=Mt.sourceLayerIndex;if(this.hasPattern){var Ar=Uf("line",this.layers,Mt,this.zoom,s);this.patternFeatures.push(Ar)}else this.addFeature(Mt,jt,ir,l,{});s.featureIndex.insert(a[ir].feature,jt,ir,hr,this.index)}},Sa.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},Sa.prototype.addFeatures=function(a,s,l){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var E=_[m];this.addFeature(E,E.geometry,E.index,s,l)}},Sa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Sa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Sa.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,jf)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Il),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Sa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Sa.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Sa.prototype.addFeature=function(a,s,l,m,_){var E=this.layers[0].layout,A=E.get("line-join").evaluate(a,{}),P=E.get("line-cap"),F=E.get("line-miter-limit"),j=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var $=0,K=s;$<K.length;$+=1)this.addLine(K[$],a,A,P,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,_,m)},Sa.prototype.addLine=function(a,s,l,m,_,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<a.length-1;A++)this.totalDistance+=a[A].dist(a[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=ud[s.type]==="Polygon",F=a.length;F>=2&&a[F-1].equals(a[F-2]);)F--;for(var j=0;j<F-1&&a[j].equals(a[j+1]);)j++;if(!(F<(P?3:2))){l==="bevel"&&(_=1.05);var $,K=this.overscaling<=16?122880/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),de=void 0,Ve=void 0,Ge=void 0,ut=void 0;this.e1=this.e2=-1,P&&(ut=a[j].sub($=a[F-2])._unit()._perp());for(var Qe=j;Qe<F;Qe++)if(!(Ve=Qe===F-1?P?a[j+1]:void 0:a[Qe+1])||!a[Qe].equals(Ve)){ut&&(Ge=ut),$&&(de=$),$=a[Qe],ut=Ve?Ve.sub($)._unit()._perp():Ge;var Mt=(Ge=Ge||ut).add(ut);Mt.x===0&&Mt.y===0||Mt._unit();var jt=Ge.x*ut.x+Ge.y*ut.y,ir=Mt.x*ut.x+Mt.y*ut.y,hr=ir!==0?1/ir:1/0,Ar=2*Math.sqrt(2-2*ir),Wr=ir<vh&&de&&Ve,tn=Ge.x*ut.y-Ge.y*ut.x>0;if(Wr&&Qe>j){var qn=$.dist(de);if(qn>2*K){var Mn=$.sub($.sub(de)._mult(K/qn)._round());this.updateDistance(de,Mn),this.addCurrentVertex(Mn,Ge,0,0,ue),de=Mn}}var ti=de&&Ve,On=ti?l:P?"butt":m;if(ti&&On==="round"&&(hr<E?On="miter":hr<=2&&(On="fakeround")),On==="miter"&&hr>_&&(On="bevel"),On==="bevel"&&(hr>2&&(On="flipbevel"),hr<_&&(On="miter")),de&&this.updateDistance(de,$),On==="miter")Mt._mult(hr),this.addCurrentVertex($,Mt,0,0,ue);else if(On==="flipbevel"){if(hr>100)Mt=ut.mult(-1);else{var Di=hr*Ge.add(ut).mag()/Ge.sub(ut).mag();Mt._perp()._mult(Di*(tn?-1:1))}this.addCurrentVertex($,Mt,0,0,ue),this.addCurrentVertex($,Mt.mult(-1),0,0,ue)}else if(On==="bevel"||On==="fakeround"){var _i=-Math.sqrt(hr*hr-1),Wn=tn?_i:0,Ui=tn?0:_i;if(de&&this.addCurrentVertex($,Ge,Wn,Ui,ue),On==="fakeround")for(var Li=Math.round(180*Ar/Math.PI/20),pa=1;pa<Li;pa++){var ii=pa/Li;if(ii!==.5){var ya=ii-.5;ii+=ii*ya*(ii-1)*((1.0904+jt*(jt*(3.55645-1.43519*jt)-3.2452))*ya*ya+(.848013+jt*(.215638*jt-1.06021)))}var so=ut.sub(Ge)._mult(ii)._add(Ge)._unit()._mult(tn?-1:1);this.addHalfVertex($,so.x,so.y,!1,tn,0,ue)}Ve&&this.addCurrentVertex($,ut,-Wn,-Ui,ue)}else if(On==="butt")this.addCurrentVertex($,Mt,0,0,ue);else if(On==="square"){var Eo=de?1:-1;this.addCurrentVertex($,Mt,Eo,Eo,ue)}else On==="round"&&(de&&(this.addCurrentVertex($,Ge,0,0,ue),this.addCurrentVertex($,Ge,1,1,ue,!0)),Ve&&(this.addCurrentVertex($,ut,-1,-1,ue,!0),this.addCurrentVertex($,ut,0,0,ue)));if(Wr&&Qe<F-1){var So=$.dist(Ve);if(So>2*K){var vo=$.add(Ve.sub($)._mult(K/So)._round());this.updateDistance($,vo),this.addCurrentVertex(vo,ut,0,0,ue),$=vo}}}}},Sa.prototype.addCurrentVertex=function(a,s,l,m,_,E){E===void 0&&(E=!1);var A=s.y*m-s.x,P=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*l,s.y-s.x*l,E,!1,l,_),this.addHalfVertex(a,A,P,E,!0,-m,_),this.distance>Pp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,l,m,_,E))},Sa.prototype.addHalfVertex=function(a,s,l,m,_,E,A){var P=.5*(this.lineClips?this.scaledDistance*(Pp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(E===0?0:E<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),A.primitiveLength++),_?this.e2=F:this.e1=F},Sa.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Sa.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},Fn("LineBucket",Sa,{omit:["layers","patternFeatures"]});var Lc=new cs({"line-cap":new $n(be.layout_line["line-cap"]),"line-join":new Un(be.layout_line["line-join"]),"line-miter-limit":new $n(be.layout_line["line-miter-limit"]),"line-round-limit":new $n(be.layout_line["line-round-limit"]),"line-sort-key":new Un(be.layout_line["line-sort-key"])}),Fo={paint:new cs({"line-opacity":new Un(be.paint_line["line-opacity"]),"line-color":new Un(be.paint_line["line-color"]),"line-translate":new $n(be.paint_line["line-translate"]),"line-translate-anchor":new $n(be.paint_line["line-translate-anchor"]),"line-width":new Un(be.paint_line["line-width"]),"line-gap-width":new Un(be.paint_line["line-gap-width"]),"line-offset":new Un(be.paint_line["line-offset"]),"line-blur":new Un(be.paint_line["line-blur"]),"line-dasharray":new rs(be.paint_line["line-dasharray"]),"line-pattern":new kf(be.paint_line["line-pattern"]),"line-gradient":new Iu(be.paint_line["line-gradient"])}),layout:Lc},Vs=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,m){return m=new Oi(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,l,m)},s.prototype.evaluate=function(l,m,_,E){return m=Nt({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,l,m,_,E)},s}(Un))(Fo.paint.properties["line-width"].specification);Vs.useIntegerZoom=!0;var Lp=function(a){function s(l){a.call(this,l,Fo),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ys,this.gradientVersion=(this.gradientVersion+1)%qe)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,m){a.prototype.recalculate.call(this,l,m),this.paint._values["line-floorwidth"]=Vs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new Sa(l)},s.prototype.queryRadius=function(l){var m=l,_=ld(Wu("line-width",this,m),Wu("line-gap-width",this,m)),E=Wu("line-offset",this,m);return _/2+Math.abs(E)+ko(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,m,_,E,A,P,F){var j=al(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,F),$=F/2*ld(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),K=this.paint.get("line-offset").evaluate(m,_);return K&&(E=function(ue,de){for(var Ve=[],Ge=new ce(0,0),ut=0;ut<ue.length;ut++){for(var Qe=ue[ut],Mt=[],jt=0;jt<Qe.length;jt++){var ir=Qe[jt],hr=Qe[jt+1],Ar=jt===0?Ge:ir.sub(Qe[jt-1])._unit()._perp(),Wr=jt===Qe.length-1?Ge:hr.sub(ir)._unit()._perp(),tn=Ar._add(Wr)._unit();tn._mult(1/(tn.x*Wr.x+tn.y*Wr.y)),Mt.push(tn._mult(de)._add(ir))}Ve.push(Mt)}return Ve}(E,K*F)),function(ue,de,Ve){for(var Ge=0;Ge<de.length;Ge++){var ut=de[Ge];if(ue.length>=3){for(var Qe=0;Qe<ut.length;Qe++)if(Xo(ue,ut[Qe]))return!0}if(Qs(ue,ut,Ve))return!0}return!1}(j,E,$)},s.prototype.isTileClipped=function(){return!0},s}(_u);function ld(a,s){return s>0?s+2*a:a}var ev=Da([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tv=Da([{name:"a_projected_pos",components:3,type:"Float32"}],4),Js=(Da([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Da([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Gf=(Da([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Da([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),rv=Da([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function nv(a,s,l){return a.sections.forEach(function(m){m.text=function(_,E,A){var P=E.layout.get("text-transform").evaluate(A,{});return P==="uppercase"?_=_.toLocaleUpperCase():P==="lowercase"&&(_=_.toLocaleLowerCase()),bs.applyArabicShaping&&(_=bs.applyArabicShaping(_)),_}(m.text,s,l)}),a}Da([{name:"triangle",components:3,type:"Uint16"}]),Da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Da([{type:"Float32",name:"offsetX"}]),Da([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var mh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},cd=function(a,s,l,m,_){var E,A,P=8*_-m-1,F=(1<<P)-1,j=F>>1,$=-7,K=l?_-1:0,ue=l?-1:1,de=a[s+K];for(K+=ue,E=de&(1<<-$)-1,de>>=-$,$+=P;$>0;E=256*E+a[s+K],K+=ue,$-=8);for(A=E&(1<<-$)-1,E>>=-$,$+=m;$>0;A=256*A+a[s+K],K+=ue,$-=8);if(E===0)E=1-j;else{if(E===F)return A?NaN:1/0*(de?-1:1);A+=Math.pow(2,m),E-=j}return(de?-1:1)*A*Math.pow(2,E-m)},fd=function(a,s,l,m,_,E){var A,P,F,j=8*E-_-1,$=(1<<j)-1,K=$>>1,ue=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=m?0:E-1,Ve=m?1:-1,Ge=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(P=isNaN(s)?1:0,A=$):(A=Math.floor(Math.log(s)/Math.LN2),s*(F=Math.pow(2,-A))<1&&(A--,F*=2),(s+=A+K>=1?ue/F:ue*Math.pow(2,1-K))*F>=2&&(A++,F/=2),A+K>=$?(P=0,A=$):A+K>=1?(P=(s*F-1)*Math.pow(2,_),A+=K):(P=s*Math.pow(2,K-1)*Math.pow(2,_),A=0));_>=8;a[l+de]=255&P,de+=Ve,P/=256,_-=8);for(A=A<<_|P,j+=_;j>0;a[l+de]=255&A,de+=Ve,A/=256,j-=8);a[l+de-Ve]|=128*Ge},$u=Za;function Za(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Za.Varint=0,Za.Fixed64=1,Za.Bytes=2,Za.Fixed32=5;var Xh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function tc(a){return a.type===Za.Bytes?a.readVarint()+a.pos:a.pos+1}function Hf(a,s,l){return l?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Rp(a,s,l){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(m);for(var _=l.pos-1;_>=a;_--)l.buf[_+m]=l.buf[_]}function hd(a,s){for(var l=0;l<a.length;l++)s.writeVarint(a[l])}function V(a,s){for(var l=0;l<a.length;l++)s.writeSVarint(a[l])}function Te(a,s){for(var l=0;l<a.length;l++)s.writeFloat(a[l])}function $e(a,s){for(var l=0;l<a.length;l++)s.writeDouble(a[l])}function tr(a,s){for(var l=0;l<a.length;l++)s.writeBoolean(a[l])}function wr(a,s){for(var l=0;l<a.length;l++)s.writeFixed32(a[l])}function rr(a,s){for(var l=0;l<a.length;l++)s.writeSFixed32(a[l])}function br(a,s){for(var l=0;l<a.length;l++)s.writeFixed64(a[l])}function Mr(a,s){for(var l=0;l<a.length;l++)s.writeSFixed64(a[l])}function Nr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function jr(a,s,l){a[l]=s,a[l+1]=s>>>8,a[l+2]=s>>>16,a[l+3]=s>>>24}function qr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function Kr(a,s,l){a===1&&l.readMessage(cn,s)}function cn(a,s,l){if(a===3){var m=l.readMessage(Ur,{}),_=m.width,E=m.height,A=m.left,P=m.top,F=m.advance;s.push({id:m.id,bitmap:new Lu({width:_+6,height:E+6},m.bitmap),metrics:{width:_,height:E,left:A,top:P,advance:F}})}}function Ur(a,s,l){a===1?s.id=l.readVarint():a===2?s.bitmap=l.readBytes():a===3?s.width=l.readVarint():a===4?s.height=l.readVarint():a===5?s.left=l.readSVarint():a===6?s.top=l.readSVarint():a===7&&(s.advance=l.readVarint())}function Yr(a){for(var s=0,l=0,m=0,_=a;m<_.length;m+=1){var E=_[m];s+=E.w*E.h,l=Math.max(l,E.w)}a.sort(function(Ge,ut){return ut.h-Ge.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],P=0,F=0,j=0,$=a;j<$.length;j+=1)for(var K=$[j],ue=A.length-1;ue>=0;ue--){var de=A[ue];if(!(K.w>de.w||K.h>de.h)){if(K.x=de.x,K.y=de.y,F=Math.max(F,K.y+K.h),P=Math.max(P,K.x+K.w),K.w===de.w&&K.h===de.h){var Ve=A.pop();ue<A.length&&(A[ue]=Ve)}else K.h===de.h?(de.x+=K.w,de.w-=K.w):K.w===de.w?(de.y+=K.h,de.h-=K.h):(A.push({x:de.x+K.w,y:de.y,w:de.w-K.w,h:K.h}),de.y+=K.h,de.h-=K.h);break}}return{w:P,h:F,fill:s/(P*F)||0}}Za.prototype={destroy:function(){this.buf=null},readFields:function(a,s,l){for(l=l||this.length;this.pos<l;){var m=this.readVarint(),_=m>>3,E=this.pos;this.type=7&m,a(_,s,this),this.pos===E&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Nr(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=qr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Nr(this.buf,this.pos)+4294967296*Nr(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Nr(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=cd(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=cd(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,l,m=this.buf;return s=127&(l=m[this.pos++]),l<128?s:(s|=(127&(l=m[this.pos++]))<<7,l<128?s:(s|=(127&(l=m[this.pos++]))<<14,l<128?s:(s|=(127&(l=m[this.pos++]))<<21,l<128?s:function(_,E,A){var P,F,j=A.buf;if(P=(112&(F=j[A.pos++]))>>4,F<128||(P|=(127&(F=j[A.pos++]))<<3,F<128)||(P|=(127&(F=j[A.pos++]))<<10,F<128)||(P|=(127&(F=j[A.pos++]))<<17,F<128)||(P|=(127&(F=j[A.pos++]))<<24,F<128)||(P|=(1&(F=j[A.pos++]))<<31,F<128))return Hf(_,P,E);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&Xh?function(l,m,_){return Xh.decode(l.subarray(m,_))}(this.buf,s,a):function(l,m,_){for(var E="",A=m;A<_;){var P,F,j,$=l[A],K=null,ue=$>239?4:$>223?3:$>191?2:1;if(A+ue>_)break;ue===1?$<128&&(K=$):ue===2?(192&(P=l[A+1]))==128&&(K=(31&$)<<6|63&P)<=127&&(K=null):ue===3?(F=l[A+2],(192&(P=l[A+1]))==128&&(192&F)==128&&((K=(15&$)<<12|(63&P)<<6|63&F)<=2047||K>=55296&&K<=57343)&&(K=null)):ue===4&&(F=l[A+2],j=l[A+3],(192&(P=l[A+1]))==128&&(192&F)==128&&(192&j)==128&&((K=(15&$)<<18|(63&P)<<12|(63&F)<<6|63&j)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,ue=1):K>65535&&(K-=65536,E+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),E+=String.fromCharCode(K),A+=ue}return E}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==Za.Bytes)return a.push(this.readVarint(s));var l=tc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==Za.Bytes)return a.push(this.readSVarint());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Za.Bytes)return a.push(this.readBoolean());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Za.Bytes)return a.push(this.readFloat());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Za.Bytes)return a.push(this.readDouble());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed32());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed32());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed64());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed64());var s=tc(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===Za.Varint)for(;this.buf[this.pos++]>127;);else if(s===Za.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Za.Fixed32)this.pos+=4;else{if(s!==Za.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),jr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),jr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),jr(this.buf,-1&a,this.pos),jr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),jr(this.buf,-1&a,this.pos),jr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,l){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(E,A,P){P.buf[P.pos++]=127&E|128,E>>>=7,P.buf[P.pos++]=127&E|128,E>>>=7,P.buf[P.pos++]=127&E|128,E>>>=7,P.buf[P.pos++]=127&E|128,P.buf[P.pos]=127&(E>>>=7)}(m,0,l),function(E,A){var P=(7&E)<<4;A.buf[A.pos++]|=P|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(_,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,E){for(var A,P,F=0;F<_.length;F++){if((A=_.charCodeAt(F))>55295&&A<57344){if(!P){A>56319||F+1===_.length?(m[E++]=239,m[E++]=191,m[E++]=189):P=A;continue}if(A<56320){m[E++]=239,m[E++]=191,m[E++]=189,P=A;continue}A=P-55296<<10|A-56320|65536,P=null}else P&&(m[E++]=239,m[E++]=191,m[E++]=189,P=null);A<128?m[E++]=A:(A<2048?m[E++]=A>>6|192:(A<65536?m[E++]=A>>12|224:(m[E++]=A>>18|240,m[E++]=A>>12&63|128),m[E++]=A>>6&63|128),m[E++]=63&A|128)}return E}(this.buf,a,this.pos);var l=this.pos-s;l>=128&&Rp(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),fd(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),fd(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,s){this.pos++;var l=this.pos;a(s,this);var m=this.pos-l;m>=128&&Rp(l,m,this),this.pos=l-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,l){this.writeTag(a,Za.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,hd,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,V,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,tr,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,Te,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,$e,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,wr,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,rr,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,br,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,Mr,s)},writeBytesField:function(a,s){this.writeTag(a,Za.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,Za.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,Za.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var Lt=function(a,s){var l=s.pixelRatio,m=s.version,_=s.stretchX,E=s.stretchY,A=s.content;this.paddedRect=a,this.pixelRatio=l,this.stretchX=_,this.stretchY=E,this.content=A,this.version=m},cr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};cr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},cr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},cr.tlbr.get=function(){return this.tl.concat(this.br)},cr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Lt.prototype,cr);var Gr=function(a,s){var l={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,l,_),this.addImages(s,m,_);var E=Yr(_),A=new Yo({width:E.w||1,height:E.h||1});for(var P in a){var F=a[P],j=l[P].paddedRect;Yo.copy(F.data,A,{x:0,y:0},{x:j.x+1,y:j.y+1},F.data)}for(var $ in s){var K=s[$],ue=m[$].paddedRect,de=ue.x+1,Ve=ue.y+1,Ge=K.data.width,ut=K.data.height;Yo.copy(K.data,A,{x:0,y:0},{x:de,y:Ve},K.data),Yo.copy(K.data,A,{x:0,y:ut-1},{x:de,y:Ve-1},{width:Ge,height:1}),Yo.copy(K.data,A,{x:0,y:0},{x:de,y:Ve+ut},{width:Ge,height:1}),Yo.copy(K.data,A,{x:Ge-1,y:0},{x:de-1,y:Ve},{width:1,height:ut}),Yo.copy(K.data,A,{x:0,y:0},{x:de+Ge,y:Ve},{width:1,height:ut})}this.image=A,this.iconPositions=l,this.patternPositions=m};Gr.prototype.addImages=function(a,s,l){for(var m in a){var _=a[m],E={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(E),s[m]=new Lt(E,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Gr.prototype.patchUpdatedImages=function(a,s){for(var l in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[l],a.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],a.getImage(l),s)},Gr.prototype.patchUpdatedImage=function(a,s,l){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;l.update(s.data,void 0,{x:m[0],y:m[1]})}},Fn("ImagePosition",Lt),Fn("ImageAtlas",Gr);var un={horizontal:1,vertical:2,horizontalOnly:3},Tr=function(){this.scale=1,this.fontStack="",this.imageName=null};Tr.forText=function(a,s){var l=new Tr;return l.scale=a||1,l.fontStack=s,l},Tr.forImage=function(a){var s=new Tr;return s.imageName=a,s};var Jr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function yn(a,s,l,m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge){var ut,Qe=Jr.fromFeature(a,_);K===un.vertical&&Qe.verticalizePunctuation();var Mt=bs.processBidirectionalText,jt=bs.processStyledBidirectionalText;if(Mt&&Qe.sections.length===1){ut=[];for(var ir=0,hr=Mt(Qe.toString(),vn(Qe,j,E,s,m,de,Ve));ir<hr.length;ir+=1){var Ar=hr[ir],Wr=new Jr;Wr.text=Ar,Wr.sections=Qe.sections;for(var tn=0;tn<Ar.length;tn++)Wr.sectionIndex.push(0);ut.push(Wr)}}else if(jt){ut=[];for(var qn=0,Mn=jt(Qe.text,Qe.sectionIndex,vn(Qe,j,E,s,m,de,Ve));qn<Mn.length;qn+=1){var ti=Mn[qn],On=new Jr;On.text=ti[0],On.sectionIndex=ti[1],On.sections=Qe.sections,ut.push(On)}}else ut=function(Wn,Ui){for(var Li=[],pa=Wn.text,ii=0,ya=0,so=Ui;ya<so.length;ya+=1){var Eo=so[ya];Li.push(Wn.substring(ii,Eo)),ii=Eo}return ii<pa.length&&Li.push(Wn.substring(ii,pa.length)),Li}(Qe,vn(Qe,j,E,s,m,de,Ve));var Di=[],_i={positionedLines:Di,text:Qe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Wn,Ui,Li,pa,ii,ya,so,Eo,So,vo,Lo,ss){for(var ms=0,eu=-17,Ss=0,tu=0,zo=Eo==="right"?1:Eo==="left"?0:.5,Cs=0,ea=0,Ua=ii;ea<Ua.length;ea+=1){var Fa=Ua[ea];Fa.trim();var ua=Fa.getMaxScale(),js=24*(ua-1),Gs={positionedGlyphs:[],lineOffset:0};Wn.positionedLines[Cs]=Gs;var uo=Gs.positionedGlyphs,Ko=0;if(Fa.length()){for(var Hs=0;Hs<Fa.length();Hs++){var _a=Fa.getSection(Hs),Dc=Fa.getSectionIndex(Hs),Ws=Fa.getCharCode(Hs),Fc=0,Zo=null,Bc=null,Pl=null,Kh=24,xh=!(So===un.horizontal||!Lo&&!jl(Ws)||Lo&&(ei[Ws]||(ff=Ws,dn.Arabic(ff)||dn["Arabic Supplement"](ff)||dn["Arabic Extended-A"](ff)||dn["Arabic Presentation Forms-A"](ff)||dn["Arabic Presentation Forms-B"](ff))));if(_a.imageName){var Qh=pa[_a.imageName];if(!Qh)continue;Pl=_a.imageName,Wn.iconsInText=Wn.iconsInText||!0,Bc=Qh.paddedRect;var cf=Qh.displaySize;_a.scale=24*_a.scale/ss,Fc=js+(24-cf[1]*_a.scale),Kh=(Zo={width:cf[0],height:cf[1],left:1,top:-3,advance:xh?cf[1]:cf[0]}).advance;var Nc=xh?cf[0]*_a.scale-24*ua:cf[1]*_a.scale-24*ua;Nc>0&&Nc>Ko&&(Ko=Nc)}else{var iv=Li[_a.fontStack],_n=iv&&iv[Ws];if(_n&&_n.rect)Bc=_n.rect,Zo=_n.metrics;else{var Fp=Ui[_a.fontStack],Yt=Fp&&Fp[Ws];if(!Yt)continue;Zo=Yt.metrics}Fc=24*(ua-_a.scale)}xh?(Wn.verticalizable=!0,uo.push({glyph:Ws,imageName:Pl,x:ms,y:eu+Fc,vertical:xh,scale:_a.scale,fontStack:_a.fontStack,sectionIndex:Dc,metrics:Zo,rect:Bc}),ms+=Kh*_a.scale+vo):(uo.push({glyph:Ws,imageName:Pl,x:ms,y:eu+Fc,vertical:xh,scale:_a.scale,fontStack:_a.fontStack,sectionIndex:Dc,metrics:Zo,rect:Bc}),ms+=Zo.advance*_a.scale+vo)}uo.length!==0&&(Ss=Math.max(ms-vo,Ss),Mi(uo,0,uo.length-1,zo,Ko)),ms=0;var pd=ya*ua+Ko;Gs.lineOffset=Math.max(Ko,js),eu+=pd,tu=Math.max(pd,tu),++Cs}else eu+=ya,++Cs}var ff,Jh=eu- -17,ep=pn(so),hf=ep.horizontalAlign,zc=ep.verticalAlign;(function(dd,vd,tp,rp,Bp,np,ip,Np,zp){var ap,md=(vd-tp)*Bp;ap=np!==ip?-Np*rp- -17:(-rp*zp+.5)*ip;for(var op=0,Zp=dd;op<Zp.length;op+=1)for(var bh=0,Up=Zp[op].positionedGlyphs;bh<Up.length;bh+=1){var sp=Up[bh];sp.x+=md,sp.y+=ap}})(Wn.positionedLines,zo,hf,zc,Ss,tu,ya,Jh,ii.length),Wn.top+=-zc*Jh,Wn.bottom=Wn.top+Jh,Wn.left+=-hf*Ss,Wn.right=Wn.left+Ss}(_i,s,l,m,ut,A,P,F,K,j,ue,Ge),!function(Wn){for(var Ui=0,Li=Wn;Ui<Li.length;Ui+=1)if(Li[Ui].positionedGlyphs.length!==0)return!1;return!0}(Di)&&_i}Jr.fromFeature=function(a,s){for(var l=new Jr,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?l.addImageSection(_):l.addTextSection(_,s)}return l},Jr.prototype.length=function(){return this.text.length},Jr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Jr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Jr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Jr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",l=0;l<a.length;l++){var m=a.charCodeAt(l+1)||null,_=a.charCodeAt(l-1)||null;s+=m&&nl(m)&&!mh[a[l+1]]||_&&nl(_)&&!mh[a[l-1]]||!mh[a[l]]?a[l]:mh[a[l]]}return s}(this.text)},Jr.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&ei[this.text.charCodeAt(s)];s++)a++;for(var l=this.text.length,m=this.text.length-1;m>=0&&m>=a&&ei[this.text.charCodeAt(m)];m--)l--;this.text=this.text.substring(a,l),this.sectionIndex=this.sectionIndex.slice(a,l)},Jr.prototype.substring=function(a,s){var l=new Jr;return l.text=this.text.substring(a,s),l.sectionIndex=this.sectionIndex.slice(a,s),l.sections=this.sections,l},Jr.prototype.toString=function(){return this.text},Jr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,a.sections[l].scale)},0)},Jr.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Tr.forText(a.scale,a.fontStack||s));for(var l=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(l)},Jr.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Tr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):mt("Reached maximum number of images 6401")}else mt("Can't add FormattedSection with an empty image.")},Jr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ei={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Er={};function Cr(a,s,l,m,_,E){if(s.imageName){var A=m[s.imageName];return A?A.displaySize[0]*s.scale*24/E+_:0}var P=l[s.fontStack],F=P&&P[a];return F?F.metrics.advance*s.scale+_:0}function Rn(a,s,l,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(l)*l}function hn(a,s,l){var m=0;return a===10&&(m-=1e4),l&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Vr(a,s,l,m,_,E){for(var A=null,P=Rn(s,l,_,E),F=0,j=m;F<j.length;F+=1){var $=j[F],K=Rn(s-$.x,l,_,E)+$.badness;K<=P&&(A=$,P=K)}return{index:a,x:s,priorBreak:A,badness:P}}function vn(a,s,l,m,_,E,A){if(E!=="point")return[];if(!a)return[];for(var P,F=[],j=function(ut,Qe,Mt,jt,ir,hr){for(var Ar=0,Wr=0;Wr<ut.length();Wr++){var tn=ut.getSection(Wr);Ar+=Cr(ut.getCharCode(Wr),tn,jt,ir,Qe,hr)}return Ar/Math.max(1,Math.ceil(Ar/Mt))}(a,s,l,m,_,A),$=a.text.indexOf("\u200B")>=0,K=0,ue=0;ue<a.length();ue++){var de=a.getSection(ue),Ve=a.getCharCode(ue);if(ei[Ve]||(K+=Cr(Ve,de,m,_,s,A)),ue<a.length()-1){var Ge=!((P=Ve)<11904||!(dn["Bopomofo Extended"](P)||dn.Bopomofo(P)||dn["CJK Compatibility Forms"](P)||dn["CJK Compatibility Ideographs"](P)||dn["CJK Compatibility"](P)||dn["CJK Radicals Supplement"](P)||dn["CJK Strokes"](P)||dn["CJK Symbols and Punctuation"](P)||dn["CJK Unified Ideographs Extension A"](P)||dn["CJK Unified Ideographs"](P)||dn["Enclosed CJK Letters and Months"](P)||dn["Halfwidth and Fullwidth Forms"](P)||dn.Hiragana(P)||dn["Ideographic Description Characters"](P)||dn["Kangxi Radicals"](P)||dn["Katakana Phonetic Extensions"](P)||dn.Katakana(P)||dn["Vertical Forms"](P)||dn["Yi Radicals"](P)||dn["Yi Syllables"](P)));(Er[Ve]||Ge||de.imageName)&&F.push(Vr(ue+1,K,j,F,hn(Ve,a.getCharCode(ue+1),Ge&&$),!1))}}return function ut(Qe){return Qe?ut(Qe.priorBreak).concat(Qe.index):[]}(Vr(a.length(),K,j,F,0,!0))}function pn(a){var s=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Mi(a,s,l,m,_){if(m||_)for(var E=a[l],A=(a[l].x+E.metrics.advance*E.scale)*m,P=s;P<=l;P++)a[P].x-=A,a[P].y+=_}function mi(a,s,l,m,_,E){var A,P=a.image;if(P.content){var F=P.content,j=P.pixelRatio||1;A=[F[0]/j,F[1]/j,P.displaySize[0]-F[2]/j,P.displaySize[1]-F[3]/j]}var $,K,ue,de,Ve=s.left*E,Ge=s.right*E;l==="width"||l==="both"?(de=_[0]+Ve-m[3],K=_[0]+Ge+m[1]):K=(de=_[0]+(Ve+Ge-P.displaySize[0])/2)+P.displaySize[0];var ut=s.top*E,Qe=s.bottom*E;return l==="height"||l==="both"?($=_[1]+ut-m[0],ue=_[1]+Qe+m[2]):ue=($=_[1]+(ut+Qe-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:$,right:K,bottom:ue,left:de,collisionPadding:A}}Er[10]=!0,Er[32]=!0,Er[38]=!0,Er[40]=!0,Er[41]=!0,Er[43]=!0,Er[45]=!0,Er[47]=!0,Er[173]=!0,Er[183]=!0,Er[8203]=!0,Er[8208]=!0,Er[8211]=!0,Er[8231]=!0;var fn=function(a){function s(l,m,_,E){a.call(this,l,m),this.angle=_,E!==void 0&&(this.segment=E)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(ce);function xn(a,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Oi(a+1))};if(l.kind==="source")return{kind:"source"};for(var m=l.zoomStops,_=l.interpolationType,E=0;E<m.length&&m[E]<=a;)E++;for(var A=E=Math.max(0,E-1);A<m.length&&m[A]<a+1;)A++;A=Math.min(m.length-1,A);var P=m[E],F=m[A];return l.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:F,interpolationType:_}:{kind:"camera",minZoom:P,maxZoom:F,minSize:l.evaluate(new Oi(P)),maxSize:l.evaluate(new Oi(F)),interpolationType:_}}function ci(a,s,l){var m=s.uSize,_=l.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?zi(_/128,l.upperSize/128,s.uSizeT):m}function Ci(a,s){var l=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,E=_?Pt(ke.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=zi(a.minSize,a.maxSize,E):l=E}return{uSizeT:l,uSize:m}}Fn("Anchor",fn);var ji=Object.freeze({__proto__:null,getSizeData:xn,evaluateSizeForFeature:ci,evaluateSizeForZoom:Ci,SIZE_PACK_FACTOR:128});function Ma(a,s,l,m,_){if(s.segment===void 0)return!0;for(var E=s,A=s.segment+1,P=0;P>-l/2;){if(--A<0)return!1;P-=a[A].dist(E),E=a[A]}P+=a[A].dist(a[A+1]),A++;for(var F=[],j=0;P<l/2;){var $=a[A],K=a[A+1];if(!K)return!1;var ue=a[A-1].angleTo($)-$.angleTo(K);for(ue=Math.abs((ue+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:P,angleDelta:ue}),j+=ue;P-F[0].distance>m;)j-=F.shift().angleDelta;if(j>_)return!1;A++,P+=$.dist(K)}return!0}function bo(a){for(var s=0,l=0;l<a.length-1;l++)s+=a[l].dist(a[l+1]);return s}function Zi(a,s,l){return a?.6*s*l:0}function ns(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function ja(a,s,l,m,_,E){for(var A=Zi(l,_,E),P=ns(l,m)*E,F=0,j=bo(a)/2,$=0;$<a.length-1;$++){var K=a[$],ue=a[$+1],de=K.dist(ue);if(F+de>j){var Ve=(j-F)/de,Ge=zi(K.x,ue.x,Ve),ut=zi(K.y,ue.y,Ve),Qe=new fn(Ge,ut,ue.angleTo(K),$);return Qe._round(),!A||Ma(a,Qe,P,A,s)?Qe:void 0}F+=de}}function Bo(a,s,l,m,_,E,A,P,F){var j=Zi(m,E,A),$=ns(m,_),K=$*A,ue=a[0].x===0||a[0].x===F||a[0].y===0||a[0].y===F;return s-K<s/4&&(s=K+s/4),function de(Ve,Ge,ut,Qe,Mt,jt,ir,hr,Ar){for(var Wr=jt/2,tn=bo(Ve),qn=0,Mn=Ge-ut,ti=[],On=0;On<Ve.length-1;On++){for(var Di=Ve[On],_i=Ve[On+1],Wn=Di.dist(_i),Ui=_i.angleTo(Di);Mn+ut<qn+Wn;){var Li=((Mn+=ut)-qn)/Wn,pa=zi(Di.x,_i.x,Li),ii=zi(Di.y,_i.y,Li);if(pa>=0&&pa<Ar&&ii>=0&&ii<Ar&&Mn-Wr>=0&&Mn+Wr<=tn){var ya=new fn(pa,ii,Ui,On);ya._round(),Qe&&!Ma(Ve,ya,jt,Qe,Mt)||ti.push(ya)}}qn+=Wn}return hr||ti.length||ir||(ti=de(Ve,qn/2,ut,Qe,Mt,jt,ir,!0,Ar)),ti}(a,ue?s/2*P%s:($/2+2*E)*A*P%s,s,j,l,K,ue,!1,F)}function Po(a,s,l,m,_){for(var E=[],A=0;A<a.length;A++)for(var P=a[A],F=void 0,j=0;j<P.length-1;j++){var $=P[j],K=P[j+1];$.x<s&&K.x<s||($.x<s?$=new ce(s,$.y+(s-$.x)/(K.x-$.x)*(K.y-$.y))._round():K.x<s&&(K=new ce(s,$.y+(s-$.x)/(K.x-$.x)*(K.y-$.y))._round()),$.y<l&&K.y<l||($.y<l?$=new ce($.x+(l-$.y)/(K.y-$.y)*(K.x-$.x),l)._round():K.y<l&&(K=new ce($.x+(l-$.y)/(K.y-$.y)*(K.x-$.x),l)._round()),$.x>=m&&K.x>=m||($.x>=m?$=new ce(m,$.y+(m-$.x)/(K.x-$.x)*(K.y-$.y))._round():K.x>=m&&(K=new ce(m,$.y+(m-$.x)/(K.x-$.x)*(K.y-$.y))._round()),$.y>=_&&K.y>=_||($.y>=_?$=new ce($.x+(_-$.y)/(K.y-$.y)*(K.x-$.x),_)._round():K.y>=_&&(K=new ce($.x+(_-$.y)/(K.y-$.y)*(K.x-$.x),_)._round()),F&&$.equals(F[F.length-1])||E.push(F=[$]),F.push(K)))))}return E}function is(a,s,l,m){var _=[],E=a.image,A=E.pixelRatio,P=E.paddedRect.w-2,F=E.paddedRect.h-2,j=a.right-a.left,$=a.bottom-a.top,K=E.stretchX||[[0,P]],ue=E.stretchY||[[0,F]],de=function(pa,ii){return pa+ii[1]-ii[0]},Ve=K.reduce(de,0),Ge=ue.reduce(de,0),ut=P-Ve,Qe=F-Ge,Mt=0,jt=Ve,ir=0,hr=Ge,Ar=0,Wr=ut,tn=0,qn=Qe;if(E.content&&m){var Mn=E.content;Mt=qo(K,0,Mn[0]),ir=qo(ue,0,Mn[1]),jt=qo(K,Mn[0],Mn[2]),hr=qo(ue,Mn[1],Mn[3]),Ar=Mn[0]-Mt,tn=Mn[1]-ir,Wr=Mn[2]-Mn[0]-jt,qn=Mn[3]-Mn[1]-hr}var ti=function(pa,ii,ya,so){var Eo=oo(pa.stretch-Mt,jt,j,a.left),So=Ti(pa.fixed-Ar,Wr,pa.stretch,Ve),vo=oo(ii.stretch-ir,hr,$,a.top),Lo=Ti(ii.fixed-tn,qn,ii.stretch,Ge),ss=oo(ya.stretch-Mt,jt,j,a.left),ms=Ti(ya.fixed-Ar,Wr,ya.stretch,Ve),eu=oo(so.stretch-ir,hr,$,a.top),Ss=Ti(so.fixed-tn,qn,so.stretch,Ge),tu=new ce(Eo,vo),zo=new ce(ss,vo),Cs=new ce(ss,eu),ea=new ce(Eo,eu),Ua=new ce(So/A,Lo/A),Fa=new ce(ms/A,Ss/A),ua=s*Math.PI/180;if(ua){var js=Math.sin(ua),Gs=Math.cos(ua),uo=[Gs,-js,js,Gs];tu._matMult(uo),zo._matMult(uo),ea._matMult(uo),Cs._matMult(uo)}var Ko=pa.stretch+pa.fixed,Hs=ii.stretch+ii.fixed;return{tl:tu,tr:zo,bl:ea,br:Cs,tex:{x:E.paddedRect.x+1+Ko,y:E.paddedRect.y+1+Hs,w:ya.stretch+ya.fixed-Ko,h:so.stretch+so.fixed-Hs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ua,pixelOffsetBR:Fa,minFontScaleX:Wr/A/j,minFontScaleY:qn/A/$,isSDF:l}};if(m&&(E.stretchX||E.stretchY))for(var On=ps(K,ut,Ve),Di=ps(ue,Qe,Ge),_i=0;_i<On.length-1;_i++)for(var Wn=On[_i],Ui=On[_i+1],Li=0;Li<Di.length-1;Li++)_.push(ti(Wn,Di[Li],Ui,Di[Li+1]));else _.push(ti({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:F+1}));return _}function qo(a,s,l){for(var m=0,_=0,E=a;_<E.length;_+=1){var A=E[_];m+=Math.max(s,Math.min(l,A[1]))-Math.max(s,Math.min(l,A[0]))}return m}function ps(a,s,l){for(var m=[{fixed:-1,stretch:0}],_=0,E=a;_<E.length;_+=1){var A=E[_],P=A[0],F=A[1],j=m[m.length-1];m.push({fixed:P-j.stretch,stretch:j.stretch}),m.push({fixed:P-j.stretch,stretch:j.stretch+(F-P)})}return m.push({fixed:s+1,stretch:l}),m}function oo(a,s,l,m){return a/s*l+m}function Ti(a,s,l,m){return a-s*l/m}var No=function(a,s,l,m,_,E,A,P,F,j){if(this.boxStartIndex=a.length,F){var $=E.top,K=E.bottom,ue=E.collisionPadding;ue&&($-=ue[1],K+=ue[3]);var de=K-$;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var Ve=E.top*A-P,Ge=E.bottom*A+P,ut=E.left*A-P,Qe=E.right*A+P,Mt=E.collisionPadding;if(Mt&&(ut-=Mt[0]*A,Ve-=Mt[1]*A,Qe+=Mt[2]*A,Ge+=Mt[3]*A),j){var jt=new ce(ut,Ve),ir=new ce(Qe,Ve),hr=new ce(ut,Ge),Ar=new ce(Qe,Ge),Wr=j*Math.PI/180;jt._rotate(Wr),ir._rotate(Wr),hr._rotate(Wr),Ar._rotate(Wr),ut=Math.min(jt.x,ir.x,hr.x,Ar.x),Qe=Math.max(jt.x,ir.x,hr.x,Ar.x),Ve=Math.min(jt.y,ir.y,hr.y,Ar.y),Ge=Math.max(jt.y,ir.y,hr.y,Ar.y)}a.emplaceBack(s.x,s.y,ut,Ve,Qe,Ge,l,m,_)}this.boxEndIndex=a.length},sa=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=ds),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function ds(a,s){return a<s?-1:a>s?1:0}function gi(a,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var m=1/0,_=1/0,E=-1/0,A=-1/0,P=a[0],F=0;F<P.length;F++){var j=P[F];(!F||j.x<m)&&(m=j.x),(!F||j.y<_)&&(_=j.y),(!F||j.x>E)&&(E=j.x),(!F||j.y>A)&&(A=j.y)}var $=Math.min(E-m,A-_),K=$/2,ue=new sa([],Gi);if($===0)return new ce(m,_);for(var de=m;de<E;de+=$)for(var Ve=_;Ve<A;Ve+=$)ue.push(new ga(de+K,Ve+K,K,a));for(var Ge=function(Mt){for(var jt=0,ir=0,hr=0,Ar=Mt[0],Wr=0,tn=Ar.length,qn=tn-1;Wr<tn;qn=Wr++){var Mn=Ar[Wr],ti=Ar[qn],On=Mn.x*ti.y-ti.x*Mn.y;ir+=(Mn.x+ti.x)*On,hr+=(Mn.y+ti.y)*On,jt+=3*On}return new ga(ir/jt,hr/jt,0,Mt)}(a),ut=ue.length;ue.length;){var Qe=ue.pop();(Qe.d>Ge.d||!Ge.d)&&(Ge=Qe,l&&console.log("found best %d after %d probes",Math.round(1e4*Qe.d)/1e4,ut)),Qe.max-Ge.d<=s||(ue.push(new ga(Qe.p.x-(K=Qe.h/2),Qe.p.y-K,K,a)),ue.push(new ga(Qe.p.x+K,Qe.p.y-K,K,a)),ue.push(new ga(Qe.p.x-K,Qe.p.y+K,K,a)),ue.push(new ga(Qe.p.x+K,Qe.p.y+K,K,a)),ut+=4)}return l&&(console.log("num probes: "+ut),console.log("best distance: "+Ge.d)),Ge.p}function Gi(a,s){return s.max-a.max}function ga(a,s,l,m){this.p=new ce(a,s),this.h=l,this.d=function(_,E){for(var A=!1,P=1/0,F=0;F<E.length;F++)for(var j=E[F],$=0,K=j.length,ue=K-1;$<K;ue=$++){var de=j[$],Ve=j[ue];de.y>_.y!=Ve.y>_.y&&_.x<(Ve.x-de.x)*(_.y-de.y)/(Ve.y-de.y)+de.x&&(A=!A),P=Math.min(P,il(_,de,Ve))}return(A?1:-1)*Math.sqrt(P)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}sa.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},sa.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},sa.prototype.peek=function(){return this.data[0]},sa.prototype._up=function(a){for(var s=this.data,l=this.compare,m=s[a];a>0;){var _=a-1>>1,E=s[_];if(l(m,E)>=0)break;s[a]=E,a=_}s[a]=m},sa.prototype._down=function(a){for(var s=this.data,l=this.compare,m=this.length>>1,_=s[a];a<m;){var E=1+(a<<1),A=s[E],P=E+1;if(P<this.length&&l(s[P],A)<0&&(E=P,A=s[P]),l(A,_)>=0)break;s[a]=A,a=E}s[a]=_};var po=Number.POSITIVE_INFINITY;function qu(a,s){return s[1]!==po?function(l,m,_){var E=0,A=0;switch(m=Math.abs(m),_=Math.abs(_),l){case"top-right":case"top-left":case"top":A=_-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-_}switch(l){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,A]}(a,s[0],s[1]):function(l,m){var _=0,E=0;m<0&&(m=0);var A=m/Math.sqrt(2);switch(l){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(l){case"top-right":case"bottom-right":_=-A;break;case"top-left":case"bottom-left":_=A;break;case"left":_=m;break;case"right":_=-m}return[_,E]}(a,s[0])}function Ue(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function or(a,s,l,m,_,E,A,P,F,j,$,K,ue,de,Ve){var Ge=function(ir,hr,Ar,Wr,tn,qn,Mn,ti){for(var On=Wr.layout.get("text-rotate").evaluate(qn,{})*Math.PI/180,Di=[],_i=0,Wn=hr.positionedLines;_i<Wn.length;_i+=1)for(var Ui=Wn[_i],Li=0,pa=Ui.positionedGlyphs;Li<pa.length;Li+=1){var ii=pa[Li];if(ii.rect){var ya=ii.rect||{},so=4,Eo=!0,So=1,vo=0,Lo=(tn||ti)&&ii.vertical,ss=ii.metrics.advance*ii.scale/2;if(ti&&hr.verticalizable&&(vo=Ui.lineOffset/2-(ii.imageName?-(24-ii.metrics.width*ii.scale)/2:24*(ii.scale-1))),ii.imageName){var ms=Mn[ii.imageName];Eo=ms.sdf,so=1/(So=ms.pixelRatio)}var eu=tn?[ii.x+ss,ii.y]:[0,0],Ss=tn?[0,0]:[ii.x+ss+Ar[0],ii.y+Ar[1]-vo],tu=[0,0];Lo&&(tu=Ss,Ss=[0,0]);var zo=(ii.metrics.left-so)*ii.scale-ss+Ss[0],Cs=(-ii.metrics.top-so)*ii.scale+Ss[1],ea=zo+ya.w*ii.scale/So,Ua=Cs+ya.h*ii.scale/So,Fa=new ce(zo,Cs),ua=new ce(ea,Cs),js=new ce(zo,Ua),Gs=new ce(ea,Ua);if(Lo){var uo=new ce(-ss,ss- -17),Ko=-Math.PI/2,Hs=12-ss,_a=new ce(22-Hs,-(ii.imageName?Hs:0)),Dc=new(Function.prototype.bind.apply(ce,[null].concat(tu)));Fa._rotateAround(Ko,uo)._add(_a)._add(Dc),ua._rotateAround(Ko,uo)._add(_a)._add(Dc),js._rotateAround(Ko,uo)._add(_a)._add(Dc),Gs._rotateAround(Ko,uo)._add(_a)._add(Dc)}if(On){var Ws=Math.sin(On),Fc=Math.cos(On),Zo=[Fc,-Ws,Ws,Fc];Fa._matMult(Zo),ua._matMult(Zo),js._matMult(Zo),Gs._matMult(Zo)}var Bc=new ce(0,0),Pl=new ce(0,0);Di.push({tl:Fa,tr:ua,bl:js,br:Gs,tex:ya,writingMode:hr.writingMode,glyphOffset:eu,sectionIndex:ii.sectionIndex,isSDF:Eo,pixelOffsetTL:Bc,pixelOffsetBR:Pl,minFontScaleX:0,minFontScaleY:0})}}return Di}(0,l,P,_,E,A,m,a.allowVerticalPlacement),ut=a.textSizeData,Qe=null;ut.kind==="source"?(Qe=[128*_.layout.get("text-size").evaluate(A,{})])[0]>32640&&mt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ut.kind==="composite"&&((Qe=[128*de.compositeTextSizes[0].evaluate(A,{},Ve),128*de.compositeTextSizes[1].evaluate(A,{},Ve)])[0]>32640||Qe[1]>32640)&&mt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ge,Qe,P,E,A,j,s,F.lineStartIndex,F.lineLength,ue,Ve);for(var Mt=0,jt=$;Mt<jt.length;Mt+=1)K[jt[Mt]]=a.text.placedSymbolArray.length-1;return 4*Ge.length}function Gt(a){for(var s in a)return a[s];return null}function Pn(a,s,l,m){var _=a.compareText;if(s in _){for(var E=_[s],A=E.length-1;A>=0;A--)if(m.dist(E[A])<l)return!0}else _[s]=[];return _[s].push(m),!1}var Yi=Os.VectorTileFeature.types,De=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ye(a,s,l,m,_,E,A,P,F,j,$,K,ue){var de=P?Math.min(32640,Math.round(P[0])):0,Ve=P?Math.min(32640,Math.round(P[1])):0;a.emplaceBack(s,l,Math.round(32*m),Math.round(32*_),E,A,(de<<1)+(F?1:0),Ve,16*j,16*$,256*K,256*ue)}function ot(a,s,l){a.emplaceBack(s.x,s.y,l),a.emplaceBack(s.x,s.y,l),a.emplaceBack(s.x,s.y,l),a.emplaceBack(s.x,s.y,l)}function Ot(a){for(var s=0,l=a.sections;s<l.length;s+=1)if(vc(l[s].text))return!0;return!1}var Kt=function(a){this.layoutVertexArray=new Hl,this.indexArray=new Wl,this.programConfigurations=a,this.segments=new Ee,this.dynamicLayoutVertexArray=new mc,this.opacityVertexArray=new gc,this.placedSymbolArray=new g};Kt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Kt.prototype.upload=function(a,s,l,m){this.isEmpty()||(l&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ev.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,tv.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,De,!0),this.opacityVertexBuffer.itemSize=1),(l||m)&&this.programConfigurations.upload(a))},Kt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fn("SymbolBuffers",Kt);var ct=function(a,s,l){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Ee,this.collisionVertexArray=new Bh};ct.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Js.members,!0)},ct.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fn("CollisionBuffers",ct);var Ye=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fu([]),this.placementViewportMatrix=fu([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xn(this.zoom,s["text-size"]),this.iconSizeData=xn(this.zoom,s["icon-size"]);var l=this.layers[0].layout,m=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(E){return un[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=a.sourceID};Ye.prototype.createArrays=function(){this.text=new Kt(new oi(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Kt(new oi(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new k,this.lineVertexArray=new D,this.symbolInstances=new T},Ye.prototype.calculateGlyphDependencies=function(a,s,l,m,_){for(var E=0;E<a.length;E++)if(s[a.charCodeAt(E)]=!0,(l||m)&&_){var A=mh[a.charAt(E)];A&&(s[A.charCodeAt(0)]=!0)}},Ye.prototype.populate=function(a,s,l){var m=this.layers[0],_=m.layout,E=_.get("text-font"),A=_.get("text-field"),P=_.get("icon-image"),F=(A.value.kind!=="constant"||A.value.value instanceof wa&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,$=_.get("symbol-sort-key");if(this.features=[],F||j){for(var K=s.iconDependencies,ue=s.glyphDependencies,de=s.availableImages,Ve=new Oi(this.zoom),Ge=0,ut=a;Ge<ut.length;Ge+=1){var Qe=ut[Ge],Mt=Qe.feature,jt=Qe.id,ir=Qe.index,hr=Qe.sourceLayerIndex,Ar=m._featureFilter.needGeometry,Wr=to(Mt,Ar);if(m._featureFilter.filter(Ve,Wr,l)){Ar||(Wr.geometry=eo(Mt));var tn=void 0;if(F){var qn=m.getValueAndResolveTokens("text-field",Wr,l,de),Mn=wa.factory(qn);Ot(Mn)&&(this.hasRTLText=!0),(!this.hasRTLText||ah()==="unavailable"||this.hasRTLText&&bs.isParsed())&&(tn=nv(Mn,m,Wr))}var ti=void 0;if(j){var On=m.getValueAndResolveTokens("icon-image",Wr,l,de);ti=On instanceof Le?On:Le.fromString(On)}if(tn||ti){var Di=this.sortFeaturesByKey?$.evaluate(Wr,{},l):void 0;if(this.features.push({id:jt,text:tn,icon:ti,index:ir,sourceLayerIndex:hr,geometry:Wr.geometry,properties:Mt.properties,type:Yi[Mt.type],sortKey:Di}),ti&&(K[ti.name]=!0),tn){var _i=E.evaluate(Wr,{},l).join(","),Wn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(un.vertical)>=0;for(var Ui=0,Li=tn.sections;Ui<Li.length;Ui+=1){var pa=Li[Ui];if(pa.image)K[pa.image.name]=!0;else{var ii=dc(tn.toString()),ya=pa.fontStack||_i,so=ue[ya]=ue[ya]||{};this.calculateGlyphDependencies(pa.text,so,Wn,this.allowVerticalPlacement,ii)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(Eo){var So={},vo={},Lo=[],ss=0;function ms(uo){Lo.push(Eo[uo]),ss++}function eu(uo,Ko,Hs){var _a=vo[uo];return delete vo[uo],vo[Ko]=_a,Lo[_a].geometry[0].pop(),Lo[_a].geometry[0]=Lo[_a].geometry[0].concat(Hs[0]),_a}function Ss(uo,Ko,Hs){var _a=So[Ko];return delete So[Ko],So[uo]=_a,Lo[_a].geometry[0].shift(),Lo[_a].geometry[0]=Hs[0].concat(Lo[_a].geometry[0]),_a}function tu(uo,Ko,Hs){var _a=Hs?Ko[0][Ko[0].length-1]:Ko[0][0];return uo+":"+_a.x+":"+_a.y}for(var zo=0;zo<Eo.length;zo++){var Cs=Eo[zo],ea=Cs.geometry,Ua=Cs.text?Cs.text.toString():null;if(Ua){var Fa=tu(Ua,ea),ua=tu(Ua,ea,!0);if(Fa in vo&&ua in So&&vo[Fa]!==So[ua]){var js=Ss(Fa,ua,ea),Gs=eu(Fa,ua,Lo[js].geometry);delete So[Fa],delete vo[ua],vo[tu(Ua,Lo[Gs].geometry,!0)]=Gs,Lo[js].geometry=null}else Fa in vo?eu(Fa,ua,ea):ua in So?Ss(Fa,ua,ea):(ms(zo),So[Fa]=ss-1,vo[ua]=ss-1)}else ms(zo)}return Lo.filter(function(uo){return uo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Eo,So){return Eo.sortKey-So.sortKey})}},Ye.prototype.update=function(a,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,l))},Ye.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ye.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ye.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ye.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ye.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ye.prototype.addToLineVertexArray=function(a,s){var l=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),E={},A=a.segment+1;A<s.length;A++)E[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:m},A<s.length-1&&(m+=s[A+1].dist(s[A]));for(var P=a.segment||0;P>=0;P--)E[P]={x:s[P].x,y:s[P].y,tileUnitDistanceFromAnchor:_},P>0&&(_+=s[P-1].dist(s[P]));for(var F=0;F<s.length;F++){var j=E[F];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},Ye.prototype.addSymbols=function(a,s,l,m,_,E,A,P,F,j,$,K){for(var ue=a.indexArray,de=a.layoutVertexArray,Ve=a.segments.prepareSegment(4*s.length,de,ue,this.canOverlap?E.sortKey:void 0),Ge=this.glyphOffsetArray.length,ut=Ve.vertexLength,Qe=this.allowVerticalPlacement&&A===un.vertical?Math.PI/2:0,Mt=E.text&&E.text.sections,jt=0;jt<s.length;jt++){var ir=s[jt],hr=ir.tl,Ar=ir.tr,Wr=ir.bl,tn=ir.br,qn=ir.tex,Mn=ir.pixelOffsetTL,ti=ir.pixelOffsetBR,On=ir.minFontScaleX,Di=ir.minFontScaleY,_i=ir.glyphOffset,Wn=ir.isSDF,Ui=ir.sectionIndex,Li=Ve.vertexLength,pa=_i[1];ye(de,P.x,P.y,hr.x,pa+hr.y,qn.x,qn.y,l,Wn,Mn.x,Mn.y,On,Di),ye(de,P.x,P.y,Ar.x,pa+Ar.y,qn.x+qn.w,qn.y,l,Wn,ti.x,Mn.y,On,Di),ye(de,P.x,P.y,Wr.x,pa+Wr.y,qn.x,qn.y+qn.h,l,Wn,Mn.x,ti.y,On,Di),ye(de,P.x,P.y,tn.x,pa+tn.y,qn.x+qn.w,qn.y+qn.h,l,Wn,ti.x,ti.y,On,Di),ot(a.dynamicLayoutVertexArray,P,Qe),ue.emplaceBack(Li,Li+1,Li+2),ue.emplaceBack(Li+1,Li+2,Li+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_i[0]),jt!==s.length-1&&Ui===s[jt+1].sectionIndex||a.programConfigurations.populatePaintArrays(de.length,E,E.index,{},K,Mt&&Mt[Ui])}a.placedSymbolArray.emplaceBack(P.x,P.y,Ge,this.glyphOffsetArray.length-Ge,ut,F,j,P.segment,l?l[0]:0,l?l[1]:0,m[0],m[1],A,0,!1,0,$)},Ye.prototype._addCollisionDebugVertex=function(a,s,l,m,_,E){return s.emplaceBack(0,0),a.emplaceBack(l.x,l.y,m,_,Math.round(E.x),Math.round(E.y))},Ye.prototype.addCollisionDebugVertices=function(a,s,l,m,_,E,A){var P=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),F=P.vertexLength,j=_.layoutVertexArray,$=_.collisionVertexArray,K=A.anchorX,ue=A.anchorY;this._addCollisionDebugVertex(j,$,E,K,ue,new ce(a,s)),this._addCollisionDebugVertex(j,$,E,K,ue,new ce(l,s)),this._addCollisionDebugVertex(j,$,E,K,ue,new ce(l,m)),this._addCollisionDebugVertex(j,$,E,K,ue,new ce(a,m)),P.vertexLength+=4;var de=_.indexArray;de.emplaceBack(F,F+1),de.emplaceBack(F+1,F+2),de.emplaceBack(F+2,F+3),de.emplaceBack(F+3,F),P.primitiveLength+=4},Ye.prototype.addDebugCollisionBoxes=function(a,s,l,m){for(var _=a;_<s;_++){var E=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,l)}},Ye.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ct(yc,Gf.members,Cl),this.iconCollisionBox=new ct(yc,Gf.members,Cl);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},Ye.prototype._deserializeCollisionBoxesForSymbol=function(a,s,l,m,_,E,A,P,F){for(var j={},$=s;$<l;$++){var K=a.get($);j.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.textFeatureIndex=K.featureIndex;break}for(var ue=m;ue<_;ue++){var de=a.get(ue);j.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},j.verticalTextFeatureIndex=de.featureIndex;break}for(var Ve=E;Ve<A;Ve++){var Ge=a.get(Ve);j.iconBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},j.iconFeatureIndex=Ge.featureIndex;break}for(var ut=P;ut<F;ut++){var Qe=a.get(ut);j.verticalIconBox={x1:Qe.x1,y1:Qe.y1,x2:Qe.x2,y2:Qe.y2,anchorPointX:Qe.anchorPointX,anchorPointY:Qe.anchorPointY},j.verticalIconFeatureIndex=Qe.featureIndex;break}return j},Ye.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},Ye.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ye.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ye.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ye.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ye.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ye.prototype.addIndicesForPlacedSymbol=function(a,s){for(var l=a.placedSymbolArray.get(s),m=l.vertexStartIndex+4*l.numGlyphs,_=l.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},Ye.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),l=Math.cos(a),m=[],_=[],E=[],A=0;A<this.symbolInstances.length;++A){E.push(A);var P=this.symbolInstances.get(A);m.push(0|Math.round(s*P.anchorX+l*P.anchorY)),_.push(P.featureIndex)}return E.sort(function(F,j){return m[F]-m[j]||_[j]-_[F]}),E},Ye.prototype.addToSortKeyRanges=function(a,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Ye.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,m=this.symbolInstanceIndexes;l<m.length;l+=1){var _=this.symbolInstances.get(m[l]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(E,A,P){E>=0&&P.indexOf(E)===A&&s.addIndicesForPlacedSymbol(s.text,E)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fn("SymbolBucket",Ye,{omit:["layers","collisionBoxArray","features","compareText"]}),Ye.MAX_GLYPHS=65535,Ye.addDynamicAttributes=ot;var St=new cs({"symbol-placement":new $n(be.layout_symbol["symbol-placement"]),"symbol-spacing":new $n(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $n(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Un(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $n(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $n(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $n(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new $n(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $n(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Un(be.layout_symbol["icon-size"]),"icon-text-fit":new $n(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $n(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Un(be.layout_symbol["icon-image"]),"icon-rotate":new Un(be.layout_symbol["icon-rotate"]),"icon-padding":new $n(be.layout_symbol["icon-padding"]),"icon-keep-upright":new $n(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Un(be.layout_symbol["icon-offset"]),"icon-anchor":new Un(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $n(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $n(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $n(be.layout_symbol["text-rotation-alignment"]),"text-field":new Un(be.layout_symbol["text-field"]),"text-font":new Un(be.layout_symbol["text-font"]),"text-size":new Un(be.layout_symbol["text-size"]),"text-max-width":new Un(be.layout_symbol["text-max-width"]),"text-line-height":new $n(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Un(be.layout_symbol["text-letter-spacing"]),"text-justify":new Un(be.layout_symbol["text-justify"]),"text-radial-offset":new Un(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $n(be.layout_symbol["text-variable-anchor"]),"text-anchor":new Un(be.layout_symbol["text-anchor"]),"text-max-angle":new $n(be.layout_symbol["text-max-angle"]),"text-writing-mode":new $n(be.layout_symbol["text-writing-mode"]),"text-rotate":new Un(be.layout_symbol["text-rotate"]),"text-padding":new $n(be.layout_symbol["text-padding"]),"text-keep-upright":new $n(be.layout_symbol["text-keep-upright"]),"text-transform":new Un(be.layout_symbol["text-transform"]),"text-offset":new Un(be.layout_symbol["text-offset"]),"text-allow-overlap":new $n(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $n(be.layout_symbol["text-ignore-placement"]),"text-optional":new $n(be.layout_symbol["text-optional"])}),Me={paint:new cs({"icon-opacity":new Un(be.paint_symbol["icon-opacity"]),"icon-color":new Un(be.paint_symbol["icon-color"]),"icon-halo-color":new Un(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Un(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Un(be.paint_symbol["icon-halo-blur"]),"icon-translate":new $n(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new $n(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Un(be.paint_symbol["text-opacity"]),"text-color":new Un(be.paint_symbol["text-color"],{runtimeType:pt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new Un(be.paint_symbol["text-halo-color"]),"text-halo-width":new Un(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Un(be.paint_symbol["text-halo-blur"]),"text-translate":new $n(be.paint_symbol["text-translate"]),"text-translate-anchor":new $n(be.paint_symbol["text-translate-anchor"])}),layout:St},tt=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:In,this.defaultValue=a};tt.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},tt.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},tt.prototype.outputDefined=function(){return!1},tt.prototype.serialize=function(){return null},Fn("FormatSectionOverride",tt,{omit:["defaultValue"]});var Be=function(a){function s(l){a.call(this,l,Me)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(l,m){if(a.prototype.recalculate.call(this,l,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var E=[],A=0,P=_;A<P.length;A+=1){var F=P[A];E.indexOf(F)<0&&E.push(F)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,m,_,E){var A=this.layout.get(l).evaluate(m,{},_,E),P=this._unevaluatedLayout._values[l];return P.isDataDriven()||lc(P.value)||!A?A:function(F,j){return j.replace(/{([^{}]+)}/g,function($,K){return K in F?String(F[K]):""})}(m.properties,A)},s.prototype.createBucket=function(l){return new Ye(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,m=Me.paint.overridableProperties;l<m.length;l+=1){var _=m[l];if(s.hasPaintOverride(this.layout,_)){var E,A=this.paint.get(_),P=new tt(A),F=new $c(P,A.property.specification);E=A.value.kind==="constant"||A.value.kind==="source"?new Bl("source",F):new vl("composite",F,A.value.zoomStops,A.value._interpolationType),this.paint._values[_]=new Zs(A.property,E,A.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,m){var _=l.get("text-field"),E=Me.paint.properties[m],A=!1,P=function($){for(var K=0,ue=$;K<ue.length;K+=1)if(E.overrides&&E.overrides.hasOverride(ue[K]))return void(A=!0)};if(_.value.kind==="constant"&&_.value.value instanceof wa)P(_.value.value.sections);else if(_.value.kind==="source"){var F=function($){A||($ instanceof no&&ta($.value)===na?P($.value.sections):$ instanceof jo?P($.sections):$.eachChild(F))},j=_.value;j._styleExpression&&F(j._styleExpression.expression)}return A},s}(_u),Dt={paint:new cs({"background-color":new $n(be.paint_background["background-color"]),"background-pattern":new rs(be.paint_background["background-pattern"]),"background-opacity":new $n(be.paint_background["background-opacity"])})},Ht=function(a){function s(l){a.call(this,l,Dt)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(_u),Ir={paint:new cs({"raster-opacity":new $n(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new $n(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $n(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $n(be.paint_raster["raster-brightness-max"]),"raster-saturation":new $n(be.paint_raster["raster-saturation"]),"raster-contrast":new $n(be.paint_raster["raster-contrast"]),"raster-resampling":new $n(be.paint_raster["raster-resampling"]),"raster-fade-duration":new $n(be.paint_raster["raster-fade-duration"])})},on=function(a){function s(l){a.call(this,l,Ir)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(_u),ln=function(a){function s(l){a.call(this,l,{}),this.implementation=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(_u),bn={circle:Df,heatmap:Bf,hillshade:wp,fill:fh,"fill-extrusion":Ml,line:Lp,symbol:Be,background:Ht,raster:on},nn=me.HTMLImageElement,zn=me.HTMLCanvasElement,Tn=me.HTMLVideoElement,Bn=me.ImageData,En=me.ImageBitmap,Ln=function(a,s,l,m){this.context=a,this.format=l,this.texture=a.gl.createTexture(),this.update(s,m)};Ln.prototype.update=function(a,s,l){var m=a.width,_=a.height,E=!(this.size&&this.size[0]===m&&this.size[1]===_||l),A=this.context,P=A.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!s||s.premultiply!==!1)),E)this.size=[m,_],a instanceof nn||a instanceof zn||a instanceof Tn||a instanceof Bn||En&&a instanceof En?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,a):P.texImage2D(P.TEXTURE_2D,0,this.format,m,_,0,this.format,P.UNSIGNED_BYTE,a.data);else{var F=l||{x:0,y:0},j=F.x,$=F.y;a instanceof nn||a instanceof zn||a instanceof Tn||a instanceof Bn||En&&a instanceof En?P.texSubImage2D(P.TEXTURE_2D,0,j,$,P.RGBA,P.UNSIGNED_BYTE,a):P.texSubImage2D(P.TEXTURE_2D,0,j,$,m,_,P.RGBA,P.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},Ln.prototype.bind=function(a,s,l){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},Ln.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ln.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var pi=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};pi.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},pi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ca=function(a,s,l){this.target=a,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_r(["receive","process"],this),this.invoker=new pi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=te()?a:me};function vs(a,s,l){var m=2*Math.PI*6378137/256/Math.pow(2,l);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}Ca.prototype.send=function(a,s,l,m,_){var E=this;_===void 0&&(_=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[A]=l);var P=U(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:a,hasCallback:!!l,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:uu(s,P)},P),{cancel:function(){l&&delete E.callbacks[A],E.target.postMessage({id:A,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},Ca.prototype.receive=function(a){var s=a.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var m=this.cancelCallbacks[l];delete this.cancelCallbacks[l],m&&m()}else te()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},Ca.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},Ca.prototype.processTask=function(a,s){var l=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(qs(s.error)):m(null,qs(s.data)))}else{var _=!1,E=U(this.globalScope)?void 0:[],A=s.hasCallback?function($,K){_=!0,delete l.cancelCallbacks[a],l.target.postMessage({id:a,type:"<response>",sourceMapId:l.mapId,error:$?uu($):null,data:uu(K,E)},E)}:function($){_=!0},P=null,F=qs(s.data);if(this.parent[s.type])P=this.parent[s.type](s.sourceMapId,F,A);else if(this.parent.getWorkerSource){var j=s.type.split(".");P=this.parent.getWorkerSource(s.sourceMapId,j[0],F.source)[j[1]](F,A)}else A(new Error("Could not find function "+s.type));!_&&P&&P.cancel&&(this.cancelCallbacks[a]=P.cancel)}},Ca.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ga=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Ga.prototype.setNorthEast=function(a){return this._ne=a instanceof ha?new ha(a.lng,a.lat):ha.convert(a),this},Ga.prototype.setSouthWest=function(a){return this._sw=a instanceof ha?new ha(a.lng,a.lat):ha.convert(a),this},Ga.prototype.extend=function(a){var s,l,m=this._sw,_=this._ne;if(a instanceof ha)s=a,l=a;else{if(!(a instanceof Ga))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ga.convert(a)):this.extend(ha.convert(a)):this;if(l=a._ne,!(s=a._sw)||!l)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(l.lng,_.lng),_.lat=Math.max(l.lat,_.lat)):(this._sw=new ha(s.lng,s.lat),this._ne=new ha(l.lng,l.lat)),this},Ga.prototype.getCenter=function(){return new ha((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ga.prototype.getSouthWest=function(){return this._sw},Ga.prototype.getNorthEast=function(){return this._ne},Ga.prototype.getNorthWest=function(){return new ha(this.getWest(),this.getNorth())},Ga.prototype.getSouthEast=function(){return new ha(this.getEast(),this.getSouth())},Ga.prototype.getWest=function(){return this._sw.lng},Ga.prototype.getSouth=function(){return this._sw.lat},Ga.prototype.getEast=function(){return this._ne.lng},Ga.prototype.getNorth=function(){return this._ne.lat},Ga.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ga.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ga.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ga.prototype.contains=function(a){var s=ha.convert(a),l=s.lng,m=s.lat,_=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},Ga.convert=function(a){return!a||a instanceof Ga?a:new Ga(a)};var ha=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ha.prototype.wrap=function(){return new ha(ur(this.lng,-180,180),this.lat)},ha.prototype.toArray=function(){return[this.lng,this.lat]},ha.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ha.prototype.distanceTo=function(a){var s=Math.PI/180,l=this.lat*s,m=a.lat*s,_=Math.sin(l)*Math.sin(m)+Math.cos(l)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},ha.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Ga(new ha(this.lng-l,this.lat-s),new ha(this.lng+l,this.lat+s))},ha.convert=function(a){if(a instanceof ha)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new ha(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new ha(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var kl=2*Math.PI*63710088e-1;function Ds(a){return kl*Math.cos(a*Math.PI/180)}function ll(a){return(180+a)/360}function Ru(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Op(a,s){return a/Ds(s)}function Ou(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Rc=function(a,s,l){l===void 0&&(l=0),this.x=+a,this.y=+s,this.z=+l};Rc.fromLngLat=function(a,s){s===void 0&&(s=0);var l=ha.convert(a);return new Rc(ll(l.lng),Ru(l.lat),Op(s,l.lat))},Rc.prototype.toLngLat=function(){return new ha(360*this.x-180,Ou(this.y))},Rc.prototype.toAltitude=function(){return this.z*Ds(Ou(this.y))},Rc.prototype.meterInMercatorCoordinateUnits=function(){return 1/kl*(a=Ou(this.y),1/Math.cos(a*Math.PI/180));var a};var gh=function(a,s,l){this.z=a,this.x=s,this.y=l,this.key=yh(0,a,a,s,l)};gh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},gh.prototype.url=function(a,s){var l,m,_,E,A,P=(m=this.y,_=this.z,E=vs(256*(l=this.x),256*(m=Math.pow(2,_)-m-1),_),A=vs(256*(l+1),256*(m+1),_),E[0]+","+E[1]+","+A[0]+","+A[1]),F=function(j,$,K){for(var ue,de="",Ve=j;Ve>0;Ve--)de+=($&(ue=1<<Ve-1)?1:0)+(K&ue?2:0);return de}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",P)},gh.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new ce(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},gh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Bv=function(a,s){this.wrap=a,this.canonical=s,this.key=yh(a,s.z,s.z,s.x,s.y)},as=function(a,s,l,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new gh(l,+m,+_),this.key=yh(s,a,l,m,_)};function yh(a,s,l,m,_){(a*=2)<0&&(a=-1*a-1);var E=1<<l;return(E*E*a+E*_+m).toString(36)+l.toString(36)+s.toString(36)}as.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},as.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new as(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new as(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},as.prototype.calculateScaledKey=function(a,s){var l=this.canonical.z-a;return a>this.canonical.z?yh(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):yh(this.wrap*+s,a,a,this.canonical.x>>l,this.canonical.y>>l)},as.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},as.prototype.children=function(a){if(this.overscaledZ>=a)return[new as(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,m=2*this.canonical.y;return[new as(s,this.wrap,s,l,m),new as(s,this.wrap,s,l+1,m),new as(s,this.wrap,s,l,m+1),new as(s,this.wrap,s,l+1,m+1)]},as.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},as.prototype.wrapped=function(){return new as(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},as.prototype.unwrapTo=function(a){return new as(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},as.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},as.prototype.toUnwrapped=function(){return new Bv(this.wrap,this.canonical)},as.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},as.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Rc(a.x-this.wrap,a.y))},Fn("CanonicalTileID",gh),Fn("OverscaledTileID",as,{omit:["posMatrix"]});var rc=function(a,s,l){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return mt('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};rc.prototype.get=function(a,s){var l=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[m],l[m+1],l[m+2])},rc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},rc.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},rc.prototype._unpackMapbox=function(a,s,l){return(256*a*256+256*s+l)/10-1e4},rc.prototype._unpackTerrarium=function(a,s,l){return 256*a+s+l/256-32768},rc.prototype.getPixels=function(){return new Yo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},rc.prototype.backfillBorder=function(a,s,l){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,E=l*this.dim,A=l*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(l){case-1:E=A-1;break;case 1:A=E+1}for(var P=-s*this.dim,F=-l*this.dim,j=E;j<A;j++)for(var $=m;$<_;$++)this.data[this._idx($,j)]=a.data[this._idx($+P,j+F)]},Fn("DEMData",rc);var Yh=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var l=a[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};Yh.prototype.encode=function(a){return this._stringToNumber[a]},Yh.prototype.decode=function(a){return this._numberToString[a]};var _h=function(a,s,l,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=l,a._y=m,this.properties=a.properties,this.id=_},$h={geometry:{configurable:!0}};$h.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$h.geometry.set=function(a){this._geometry=a},_h.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(_h.prototype,$h);var Wf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Wf.prototype.updateState=function(a,s,l){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},Nt(this.stateChanges[a][m],l),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var E in this.deletedStates[a][m]={},this.state[a][m])l[E]||(this.deletedStates[a][m][E]=null);else for(var A in l)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][A]===null&&delete this.deletedStates[a][m][A]},Wf.prototype.removeFeatureState=function(a,s,l){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},l&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][l]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(l in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][l]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},Wf.prototype.getState=function(a,s){var l=String(s),m=Nt({},(this.state[a]||{})[l],(this.stateChanges[a]||{})[l]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var E in _)delete m[E]}return m},Wf.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},Wf.prototype.coalesceChanges=function(a,s){var l={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),Nt(this.state[m][E],this.stateChanges[m][E]),_[E]=this.state[m][E];l[m]=_}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var P={};if(this.deletedStates[A]===null)for(var F in this.state[A])P[F]={},this.state[A][F]={};else for(var j in this.deletedStates[A]){if(this.deletedStates[A][j]===null)this.state[A][j]={};else for(var $=0,K=Object.keys(this.deletedStates[A][j]);$<K.length;$+=1)delete this.state[A][j][K[$]];P[j]=this.state[A][j]}l[A]=l[A]||{},Nt(l[A],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var ue in a)a[ue].setFeatureState(l,s)};var nc=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Tu(8192,16,0),this.grid3D=new Tu(8192,16,0),this.featureIndexArray=new ee,this.promoteId=s};function Dp(a,s,l,m,_){return lr(a,function(E,A){var P=s instanceof cu?s.get(A):null;return P&&P.evaluate?P.evaluate(l,m,_):P})}function qh(a){for(var s=1/0,l=1/0,m=-1/0,_=-1/0,E=0,A=a;E<A.length;E+=1){var P=A[E];s=Math.min(s,P.x),l=Math.min(l,P.y),m=Math.max(m,P.x),_=Math.max(_,P.y)}return{minX:s,minY:l,maxX:m,maxY:_}}function Ku(a,s){return s-a}nc.prototype.insert=function(a,s,l,m,_,E){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,m,_);for(var P=E?this.grid3D:this.grid,F=0;F<s.length;F++){for(var j=s[F],$=[1/0,1/0,-1/0,-1/0],K=0;K<j.length;K++){var ue=j[K];$[0]=Math.min($[0],ue.x),$[1]=Math.min($[1],ue.y),$[2]=Math.max($[2],ue.x),$[3]=Math.max($[3],ue.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&P.insert(A,$[0],$[1],$[2],$[3])}},nc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Os.VectorTile(new $u(this.rawTileData)).layers,this.sourceLayerCoder=new Yh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},nc.prototype.query=function(a,s,l,m){var _=this;this.loadVTLayers();for(var E=a.params||{},A=8192/a.tileSize/a.scale,P=Cf(E.filter),F=a.queryGeometry,j=a.queryPadding*A,$=qh(F),K=this.grid.query($.minX-j,$.minY-j,$.maxX+j,$.maxY+j),ue=qh(a.cameraQueryGeometry),de=this.grid3D.query(ue.minX-j,ue.minY-j,ue.maxX+j,ue.maxY+j,function(ir,hr,Ar,Wr){return function(tn,qn,Mn,ti,On){for(var Di=0,_i=tn;Di<_i.length;Di+=1){var Wn=_i[Di];if(qn<=Wn.x&&Mn<=Wn.y&&ti>=Wn.x&&On>=Wn.y)return!0}var Ui=[new ce(qn,Mn),new ce(qn,On),new ce(ti,On),new ce(ti,Mn)];if(tn.length>2){for(var Li=0,pa=Ui;Li<pa.length;Li+=1)if(Xo(tn,pa[Li]))return!0}for(var ii=0;ii<tn.length-1;ii++)if(Al(tn[ii],tn[ii+1],Ui))return!0;return!1}(a.cameraQueryGeometry,ir-j,hr-j,Ar+j,Wr+j)}),Ve=0,Ge=de;Ve<Ge.length;Ve+=1)K.push(Ge[Ve]);K.sort(Ku);for(var ut,Qe={},Mt=function(ir){var hr=K[ir];if(hr!==ut){ut=hr;var Ar=_.featureIndexArray.get(hr),Wr=null;_.loadMatchingFeature(Qe,Ar.bucketIndex,Ar.sourceLayerIndex,Ar.featureIndex,P,E.layers,E.availableImages,s,l,m,function(tn,qn,Mn){return Wr||(Wr=eo(tn)),qn.queryIntersectsFeature(F,tn,Mn,Wr,_.z,a.transform,A,a.pixelPosMatrix)})}},jt=0;jt<K.length;jt++)Mt(jt);return Qe},nc.prototype.loadMatchingFeature=function(a,s,l,m,_,E,A,P,F,j,$){var K=this.bucketLayerIDs[s];if(!E||function(tn,qn){for(var Mn=0;Mn<tn.length;Mn++)if(qn.indexOf(tn[Mn])>=0)return!0;return!1}(E,K)){var ue=this.sourceLayerCoder.decode(l),de=this.vtLayers[ue].feature(m);if(_.needGeometry){var Ve=to(de,!0);if(!_.filter(new Oi(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!_.filter(new Oi(this.tileID.overscaledZ),de))return;for(var Ge=this.getId(de,ue),ut=0;ut<K.length;ut++){var Qe=K[ut];if(!(E&&E.indexOf(Qe)<0)){var Mt=P[Qe];if(Mt){var jt={};Ge!==void 0&&j&&(jt=j.getState(Mt.sourceLayer||"_geojsonTileLayer",Ge));var ir=Nt({},F[Qe]);ir.paint=Dp(ir.paint,Mt.paint,de,jt,A),ir.layout=Dp(ir.layout,Mt.layout,de,jt,A);var hr=!$||$(de,Mt,jt);if(hr){var Ar=new _h(de,this.z,this.x,this.y,Ge);Ar.layer=ir;var Wr=a[Qe];Wr===void 0&&(Wr=a[Qe]=[]),Wr.push({featureIndex:m,feature:Ar,intersectionZ:hr})}}}}}},nc.prototype.lookupSymbolFeatures=function(a,s,l,m,_,E,A,P){var F={};this.loadVTLayers();for(var j=Cf(_),$=0,K=a;$<K.length;$+=1)this.loadMatchingFeature(F,l,m,K[$],j,E,A,P,s);return F},nc.prototype.hasLayer=function(a){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var m=0,_=l[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},nc.prototype.getId=function(a,s){var l=a.id;return this.promoteId&&typeof(l=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},Fn("FeatureIndex",nc,{omit:["rawTileData","sourceLayerCoder"]});var os=function(a,s){this.tileID=a,this.uid=Xt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};os.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<Xn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},os.prototype.loadVectorData=function(a,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(j,$){var K={};if(!$)return K;for(var ue=function(){var Ge=Ve[de],ut=Ge.layerIds.map(function(jt){return $.getLayer(jt)}).filter(Boolean);if(ut.length!==0){Ge.layers=ut,Ge.stateDependentLayerIds&&(Ge.stateDependentLayers=Ge.stateDependentLayerIds.map(function(jt){return ut.filter(function(ir){return ir.id===jt})[0]}));for(var Qe=0,Mt=ut;Qe<Mt.length;Qe+=1)K[Mt[Qe].id]=Ge}},de=0,Ve=j;de<Ve.length;de+=1)ue();return K}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof Ye){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var A=this.buckets[E];if(A instanceof Ye&&A.hasRTLText){this.hasRTLText=!0,bs.isLoading()||bs.isLoaded()||ah()!=="deferred"||lu();break}}for(var P in this.queryPadding=0,this.buckets){var F=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(P).queryRadius(F))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},os.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},os.prototype.getBucket=function(a){return this.buckets[a.id]},os.prototype.upload=function(a){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ln(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ln(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},os.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},os.prototype.queryRenderedFeatures=function(a,s,l,m,_,E,A,P,F,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:E,tileSize:this.tileSize,pixelPosMatrix:j,transform:P,params:A,queryPadding:this.queryPadding*F},a,s,l):{}},os.prototype.querySourceFeatures=function(a,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var m=l.loadVTLayers(),_=s?s.sourceLayer:"",E=m._geojsonTileLayer||m[_];if(E)for(var A=Cf(s&&s.filter),P=this.tileID.canonical,F=P.z,j=P.x,$=P.y,K={z:F,x:j,y:$},ue=0;ue<E.length;ue++){var de=E.feature(ue);if(A.needGeometry){var Ve=to(de,!0);if(!A.filter(new Oi(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!A.filter(new Oi(this.tileID.overscaledZ),de))continue;var Ge=l.getId(de,_),ut=new _h(de,F,j,$,Ge);ut.tile=K,a.push(ut)}}},os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},os.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var l=Ne(a.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var E=this.expirationTime-s;E?this.expirationTime=m+Math.max(E,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},os.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],E=_.layers[0].sourceLayer||"_geojsonTileLayer",A=l[E],P=a[E];if(A&&P&&Object.keys(P).length!==0){_.update(P,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=s&&s.style&&s.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(_)))}}}},os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Xn.now()},os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},os.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Xn.now()+a},os.prototype.setDependencies=function(a,s){for(var l={},m=0,_=s;m<_.length;m+=1)l[_[m]]=!0;this.dependencies[a]=l},os.prototype.hasDependency=function(a,s){for(var l=0,m=a;l<m.length;l+=1){var _=this.dependencies[m[l]];if(_){for(var E=0,A=s;E<A.length;E+=1)if(_[A[E]])return!0}}return!1};var Oc=me.performance,lf=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Oc.mark(this._marks.start)};lf.prototype.finish=function(){Oc.mark(this._marks.end);var a=Oc.getEntriesByName(this._marks.measure);return a.length===0&&(Oc.measure(this._marks.measure,this._marks.start,this._marks.end),a=Oc.getEntriesByName(this._marks.measure),Oc.clearMarks(this._marks.start),Oc.clearMarks(this._marks.end),Oc.clearMeasures(this._marks.measure)),a},y.Actor=Ca,y.AlphaImage=Lu,y.CanonicalTileID=gh,y.CollisionBoxArray=d,y.Color=sr,y.DEMData=rc,y.DataConstantProperty=$n,y.DictionaryCoder=Yh,y.EXTENT=8192,y.ErrorEvent=rt,y.EvaluationParameters=Oi,y.Event=ze,y.Evented=_t,y.FeatureIndex=nc,y.FillBucket=pu,y.FillExtrusionBucket=Yu,y.ImageAtlas=Gr,y.ImagePosition=Lt,y.LineBucket=Sa,y.LngLat=ha,y.LngLatBounds=Ga,y.MercatorCoordinate=Rc,y.ONE_EM=24,y.OverscaledTileID=as,y.Point=ce,y.Point$1=ce,y.Properties=cs,y.Protobuf=$u,y.RGBAImage=Yo,y.RequestManager=ki,y.RequestPerformance=lf,y.ResourceType=an,y.SegmentVector=Ee,y.SourceFeatureState=Wf,y.StructArrayLayout1ui2=Of,y.StructArrayLayout2f1f2i16=_o,y.StructArrayLayout2i4=Gl,y.StructArrayLayout3ui6=Wl,y.StructArrayLayout4i8=Ks,y.SymbolBucket=Ye,y.Texture=Ln,y.Tile=os,y.Transitionable=ls,y.Uniform1f=Qr,y.Uniform1i=Et,y.Uniform2f=Hr,y.Uniform3f=An,y.Uniform4f=Qn,y.UniformColor=Jn,y.UniformMatrix4f=Xi,y.UnwrappedTileID=Bv,y.ValidationError=We,y.WritingMode=un,y.ZoomHistory=Tf,y.add=function(a,s,l){return a[0]=s[0]+l[0],a[1]=s[1]+l[1],a[2]=s[2]+l[2],a},y.addDynamicAttributes=ot,y.asyncAll=function(a,s,l){if(!a.length)return l(null,[]);var m=a.length,_=new Array(a.length),E=null;a.forEach(function(A,P){s(A,function(F,j){F&&(E=F),_[P]=j,--m==0&&l(E,_)})})},y.bezier=lt,y.bindAll=_r,y.browser=Xn,y.cacheEntryPossiblyAdded=function(a){++jn>vr&&(a.getActor().send("enforceCacheSizeLimit",Rt),jn=0)},y.clamp=Pt,y.clearTileCache=function(a){var s=me.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=Po,y.clone=function(a){var s=new oa(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=ht,y.clone$2=function(a){var s=new oa(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=rv,y.config=sn,y.create=function(){var a=new oa(16);return oa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new oa(9);return oa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new oa(4);return oa!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=Se,y.createExpression=Fl,y.createLayout=Da,y.createStyleLayer=function(a){return a.type==="custom"?new ln(a):new bn[a.type](a)},y.cross=function(a,s,l){var m=s[0],_=s[1],E=s[2],A=l[0],P=l[1],F=l[2];return a[0]=_*F-E*P,a[1]=E*A-m*F,a[2]=m*P-_*A,a},y.deepEqual=function a(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],l[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var _ in s)if(!a(s[_],l[_]))return!1;return!0}return s===l},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=bt,y.emitValidationErrors=hc,y.endsWith=J,y.enforceCacheSizeLimit=function(a){Pr(),se&&se.then(function(s){s.keys().then(function(l){for(var m=0;m<l.length-a;m++)s.delete(l[m])})})},y.evaluateSizeForFeature=ci,y.evaluateSizeForZoom=Ci,y.evaluateVariableOffset=qu,y.evented=If,y.extend=Nt,y.featureFilter=Cf,y.filterObject=Tt,y.fromRotation=function(a,s){var l=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=l,a[2]=0,a[3]=-l,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=pn,y.getAnchorJustification=Ue,y.getArrayBuffer=ba,y.getImage=ie,y.getJSON=function(a,s){return Pa(Nt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=ah,y.getReferrer=fi,y.getVideo=function(a,s){var l,m,_=me.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var E=0;E<a.length;E++){var A=me.document.createElement("source");l=a[E],m=void 0,(m=me.document.createElement("a")).href=l,(m.protocol!==me.document.location.protocol||m.host!==me.document.location.host)&&(_.crossOrigin="Anonymous"),A.src=a[E],_.appendChild(A)}return{cancel:function(){}}},y.identity=fu,y.invert=function(a,s){var l=s[0],m=s[1],_=s[2],E=s[3],A=s[4],P=s[5],F=s[6],j=s[7],$=s[8],K=s[9],ue=s[10],de=s[11],Ve=s[12],Ge=s[13],ut=s[14],Qe=s[15],Mt=l*P-m*A,jt=l*F-_*A,ir=l*j-E*A,hr=m*F-_*P,Ar=m*j-E*P,Wr=_*j-E*F,tn=$*Ge-K*Ve,qn=$*ut-ue*Ve,Mn=$*Qe-de*Ve,ti=K*ut-ue*Ge,On=K*Qe-de*Ge,Di=ue*Qe-de*ut,_i=Mt*Di-jt*On+ir*ti+hr*Mn-Ar*qn+Wr*tn;return _i?(a[0]=(P*Di-F*On+j*ti)*(_i=1/_i),a[1]=(_*On-m*Di-E*ti)*_i,a[2]=(Ge*Wr-ut*Ar+Qe*hr)*_i,a[3]=(ue*Ar-K*Wr-de*hr)*_i,a[4]=(F*Mn-A*Di-j*qn)*_i,a[5]=(l*Di-_*Mn+E*qn)*_i,a[6]=(ut*ir-Ve*Wr-Qe*jt)*_i,a[7]=($*Wr-ue*ir+de*jt)*_i,a[8]=(A*On-P*Mn+j*tn)*_i,a[9]=(m*Mn-l*On-E*tn)*_i,a[10]=(Ve*Ar-Ge*ir+Qe*Mt)*_i,a[11]=(K*ir-$*Ar-de*Mt)*_i,a[12]=(P*qn-A*ti-F*tn)*_i,a[13]=(l*ti-m*qn+_*tn)*_i,a[14]=(Ge*jt-Ve*hr-ut*Mt)*_i,a[15]=($*hr-K*jt+ue*Mt)*_i,a):null},y.isChar=dn,y.isMapboxURL=di,y.keysDifference=function(a,s){var l=[];for(var m in a)m in s||l.push(m);return l},y.makeRequest=Pa,y.mapObject=lr,y.mercatorXfromLng=ll,y.mercatorYfromLat=Ru,y.mercatorZfromAltitude=Op,y.mul=rf,y.multiply=Rs,y.mvt=Os,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var l=s[0],m=s[1],_=s[2],E=l*l+m*m+_*_;return E>0&&(E=1/Math.sqrt(E)),a[0]=s[0]*E,a[1]=s[1]*E,a[2]=s[2]*E,a},y.number=zi,y.offscreenCanvasSupported=Zn,y.ortho=function(a,s,l,m,_,E,A){var P=1/(s-l),F=1/(m-_),j=1/(E-A);return a[0]=-2*P,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*F,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(s+l)*P,a[13]=(_+m)*F,a[14]=(A+E)*j,a[15]=1,a},y.parseGlyphPBF=function(a){return new $u(a).readFields(Kr,[])},y.pbf=$u,y.performSymbolLayout=function(a,s,l,m,_,E,A){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var P=a.layers[0].layout,F=a.layers[0]._unevaluatedLayout._values,j={};if(a.textSizeData.kind==="composite"){var $=a.textSizeData,K=$.maxZoom;j.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Oi($.minZoom),A),F["text-size"].possiblyEvaluate(new Oi(K),A)]}if(a.iconSizeData.kind==="composite"){var ue=a.iconSizeData,de=ue.maxZoom;j.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Oi(ue.minZoom),A),F["icon-size"].possiblyEvaluate(new Oi(de),A)]}j.layoutTextSize=F["text-size"].possiblyEvaluate(new Oi(a.zoom+1),A),j.layoutIconSize=F["icon-size"].possiblyEvaluate(new Oi(a.zoom+1),A),j.textMaxSize=F["text-size"].possiblyEvaluate(new Oi(18));for(var Ve=24*P.get("text-line-height"),Ge=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",ut=P.get("text-keep-upright"),Qe=P.get("text-size"),Mt=function(){var hr=ir[jt],Ar=P.get("text-font").evaluate(hr,{},A).join(","),Wr=Qe.evaluate(hr,{},A),tn=j.layoutTextSize.evaluate(hr,{},A),qn=j.layoutIconSize.evaluate(hr,{},A),Mn={horizontal:{},vertical:void 0},ti=hr.text,On=[0,0];if(ti){var Di=ti.toString(),_i=24*P.get("text-letter-spacing").evaluate(hr,{},A),Wn=function(ea){for(var Ua=0,Fa=ea;Ua<Fa.length;Ua+=1)if(ua=Fa[Ua].charCodeAt(0),dn.Arabic(ua)||dn["Arabic Supplement"](ua)||dn["Arabic Extended-A"](ua)||dn["Arabic Presentation Forms-A"](ua)||dn["Arabic Presentation Forms-B"](ua))return!1;var ua;return!0}(Di)?_i:0,Ui=P.get("text-anchor").evaluate(hr,{},A),Li=P.get("text-variable-anchor");if(!Li){var pa=P.get("text-radial-offset").evaluate(hr,{},A);On=pa?qu(Ui,[24*pa,po]):P.get("text-offset").evaluate(hr,{},A).map(function(ea){return 24*ea})}var ii=Ge?"center":P.get("text-justify").evaluate(hr,{},A),ya=P.get("symbol-placement"),so=ya==="point"?24*P.get("text-max-width").evaluate(hr,{},A):0,Eo=function(){a.allowVerticalPlacement&&dc(Di)&&(Mn.vertical=yn(ti,s,l,_,Ar,so,Ve,Ui,"left",Wn,On,un.vertical,!0,ya,tn,Wr))};if(!Ge&&Li){for(var So=ii==="auto"?Li.map(function(ea){return Ue(ea)}):[ii],vo=!1,Lo=0;Lo<So.length;Lo++){var ss=So[Lo];if(!Mn.horizontal[ss])if(vo)Mn.horizontal[ss]=Mn.horizontal[0];else{var ms=yn(ti,s,l,_,Ar,so,Ve,"center",ss,Wn,On,un.horizontal,!1,ya,tn,Wr);ms&&(Mn.horizontal[ss]=ms,vo=ms.positionedLines.length===1)}}Eo()}else{ii==="auto"&&(ii=Ue(Ui));var eu=yn(ti,s,l,_,Ar,so,Ve,Ui,ii,Wn,On,un.horizontal,!1,ya,tn,Wr);eu&&(Mn.horizontal[ii]=eu),Eo(),dc(Di)&&Ge&&ut&&(Mn.vertical=yn(ti,s,l,_,Ar,so,Ve,Ui,ii,Wn,On,un.vertical,!1,ya,tn,Wr))}}var Ss=void 0,tu=!1;if(hr.icon&&hr.icon.name){var zo=m[hr.icon.name];zo&&(Ss=function(ea,Ua,Fa){var ua=pn(Fa),js=Ua[0]-ea.displaySize[0]*ua.horizontalAlign,Gs=Ua[1]-ea.displaySize[1]*ua.verticalAlign;return{image:ea,top:Gs,bottom:Gs+ea.displaySize[1],left:js,right:js+ea.displaySize[0]}}(_[hr.icon.name],P.get("icon-offset").evaluate(hr,{},A),P.get("icon-anchor").evaluate(hr,{},A)),tu=zo.sdf,a.sdfIcons===void 0?a.sdfIcons=zo.sdf:a.sdfIcons!==zo.sdf&&mt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(zo.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Cs=Gt(Mn.horizontal)||Mn.vertical;a.iconsInText=!!Cs&&Cs.iconsInText,(Cs||Ss)&&function(ea,Ua,Fa,ua,js,Gs,uo,Ko,Hs,_a,Dc){var Ws=Gs.textMaxSize.evaluate(Ua,{});Ws===void 0&&(Ws=uo);var Fc,Zo=ea.layers[0].layout,Bc=Zo.get("icon-offset").evaluate(Ua,{},Dc),Pl=Gt(Fa.horizontal),Kh=uo/24,xh=ea.tilePixelRatio*Kh,Qh=ea.tilePixelRatio*Ws/24,cf=ea.tilePixelRatio*Ko,Nc=ea.tilePixelRatio*Zo.get("symbol-spacing"),iv=Zo.get("text-padding")*ea.tilePixelRatio,_n=Zo.get("icon-padding")*ea.tilePixelRatio,Fp=Zo.get("text-max-angle")/180*Math.PI,Yt=Zo.get("text-rotation-alignment")==="map"&&Zo.get("symbol-placement")!=="point",pd=Zo.get("icon-rotation-alignment")==="map"&&Zo.get("symbol-placement")!=="point",ff=Zo.get("symbol-placement"),Jh=Nc/2,ep=Zo.get("icon-text-fit");ua&&ep!=="none"&&(ea.allowVerticalPlacement&&Fa.vertical&&(Fc=mi(ua,Fa.vertical,ep,Zo.get("icon-text-fit-padding"),Bc,Kh)),Pl&&(ua=mi(ua,Pl,ep,Zo.get("icon-text-fit-padding"),Bc,Kh)));var hf=function(W0,_d){_d.x<0||_d.x>=8192||_d.y<0||_d.y>=8192||function(Uo,Ll,Zv,Xf,xd,ov,bd,Zc,Ed,up,Yf,Sd,Ya,pf,Vp,Uv,sv,Vv,uv,jv,du,Cd,Gv,Xs,jp){var lp,Eh,df,$f,qf,Sh=Uo.addToLineVertexArray(Ll,Zv),Hv=0,Wv=0,Xv=0,Yv=0,lv=-1,Ad=-1,vf={},$v=Fe(""),wd=0,cv=0;if(Zc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(wd=(lp=Zc.layout.get("text-offset").evaluate(du,{},Xs).map(function(Wp){return 24*Wp}))[0],cv=lp[1]):(wd=24*Zc.layout.get("text-radial-offset").evaluate(du,{},Xs),cv=po),Uo.allowVerticalPlacement&&Xf.vertical){var qv=Zc.layout.get("text-rotate").evaluate(du,{},Xs)+90;$f=new No(Ed,Ll,up,Yf,Sd,Xf.vertical,Ya,pf,Vp,qv),bd&&(qf=new No(Ed,Ll,up,Yf,Sd,bd,sv,Vv,Vp,qv))}if(xd){var fv=Zc.layout.get("icon-rotate").evaluate(du,{}),Kv=Zc.layout.get("icon-text-fit")!=="none",Qv=is(xd,fv,Gv,Kv),Td=bd?is(bd,fv,Gv,Kv):void 0;df=new No(Ed,Ll,up,Yf,Sd,xd,sv,Vv,!1,fv),Hv=4*Qv.length;var hv=Uo.iconSizeData,Gp=null;hv.kind==="source"?(Gp=[128*Zc.layout.get("icon-size").evaluate(du,{})])[0]>32640&&mt(Uo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):hv.kind==="composite"&&((Gp=[128*Cd.compositeIconSizes[0].evaluate(du,{},Xs),128*Cd.compositeIconSizes[1].evaluate(du,{},Xs)])[0]>32640||Gp[1]>32640)&&mt(Uo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Uo.addSymbols(Uo.icon,Qv,Gp,jv,uv,du,!1,Ll,Sh.lineStartIndex,Sh.lineLength,-1,Xs),lv=Uo.icon.placedSymbolArray.length-1,Td&&(Wv=4*Td.length,Uo.addSymbols(Uo.icon,Td,Gp,jv,uv,du,un.vertical,Ll,Sh.lineStartIndex,Sh.lineLength,-1,Xs),Ad=Uo.icon.placedSymbolArray.length-1)}for(var Jv in Xf.horizontal){var Hp=Xf.horizontal[Jv];if(!Eh){$v=Fe(Hp.text);var X0=Zc.layout.get("text-rotate").evaluate(du,{},Xs);Eh=new No(Ed,Ll,up,Yf,Sd,Hp,Ya,pf,Vp,X0)}var e0=Hp.positionedLines.length===1;if(Xv+=or(Uo,Ll,Hp,ov,Zc,Vp,du,Uv,Sh,Xf.vertical?un.horizontal:un.horizontalOnly,e0?Object.keys(Xf.horizontal):[Jv],vf,lv,Cd,Xs),e0)break}Xf.vertical&&(Yv+=or(Uo,Ll,Xf.vertical,ov,Zc,Vp,du,Uv,Sh,un.vertical,["vertical"],vf,Ad,Cd,Xs));var Y0=Eh?Eh.boxStartIndex:Uo.collisionBoxArray.length,$0=Eh?Eh.boxEndIndex:Uo.collisionBoxArray.length,q0=$f?$f.boxStartIndex:Uo.collisionBoxArray.length,K0=$f?$f.boxEndIndex:Uo.collisionBoxArray.length,Q0=df?df.boxStartIndex:Uo.collisionBoxArray.length,t0=df?df.boxEndIndex:Uo.collisionBoxArray.length,J0=qf?qf.boxStartIndex:Uo.collisionBoxArray.length,em=qf?qf.boxEndIndex:Uo.collisionBoxArray.length,Uc=-1,cp=function(Wp,pv){return Wp&&Wp.circleDiameter?Math.max(Wp.circleDiameter,pv):pv};Uc=cp(Eh,Uc),Uc=cp($f,Uc),Uc=cp(df,Uc);var r0=(Uc=cp(qf,Uc))>-1?1:0;r0&&(Uc*=jp/24),Uo.glyphOffsetArray.length>=Ye.MAX_GLYPHS&&mt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),du.sortKey!==void 0&&Uo.addToSortKeyRanges(Uo.symbolInstances.length,du.sortKey),Uo.symbolInstances.emplaceBack(Ll.x,Ll.y,vf.right>=0?vf.right:-1,vf.center>=0?vf.center:-1,vf.left>=0?vf.left:-1,vf.vertical||-1,lv,Ad,$v,Y0,$0,q0,K0,Q0,t0,J0,em,up,Xv,Yv,Hv,Wv,r0,0,Ya,wd,cv,Uc)}(ea,_d,W0,Fa,ua,js,Fc,ea.layers[0],ea.collisionBoxArray,Ua.index,Ua.sourceLayerIndex,ea.index,xh,iv,Yt,Hs,cf,_n,pd,Bc,Ua,Gs,_a,Dc,uo)};if(ff==="line")for(var zc=0,dd=Po(Ua.geometry,0,0,8192,8192);zc<dd.length;zc+=1)for(var vd=dd[zc],tp=0,rp=Bo(vd,Nc,Fp,Fa.vertical||Pl,ua,24,Qh,ea.overscaling,8192);tp<rp.length;tp+=1){var Bp=rp[tp];Pl&&Pn(ea,Pl.text,Jh,Bp)||hf(vd,Bp)}else if(ff==="line-center")for(var np=0,ip=Ua.geometry;np<ip.length;np+=1){var Np=ip[np];if(Np.length>1){var zp=ja(Np,Fp,Fa.vertical||Pl,ua,24,Qh);zp&&hf(Np,zp)}}else if(Ua.type==="Polygon")for(var ap=0,md=sf(Ua.geometry,0);ap<md.length;ap+=1){var op=md[ap],Zp=gi(op,16);hf(op[0],new fn(Zp.x,Zp.y,0))}else if(Ua.type==="LineString")for(var bh=0,Up=Ua.geometry;bh<Up.length;bh+=1){var sp=Up[bh];hf(sp,new fn(sp[0].x,sp[0].y,0))}else if(Ua.type==="Point")for(var av=0,Nv=Ua.geometry;av<Nv.length;av+=1)for(var gd=0,zv=Nv[av];gd<zv.length;gd+=1){var yd=zv[gd];hf([yd],new fn(yd.x,yd.y,0))}}(a,hr,Mn,Ss,m,j,tn,qn,On,tu,A)},jt=0,ir=a.features;jt<ir.length;jt+=1)Mt();E&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,l,m,_){var E,A=1/Math.tan(s/2);return a[0]=A/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(E=1/(m-_)),a[14]=2*_*m*E):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var l={},m=0;m<s.length;m++){var _=s[m];_ in a&&(l[_]=a[_])}return l},y.plugin=bs,y.polygonIntersectsPolygon=Gu,y.postMapLoadEvent=Ke,y.postTurnstileEvent=Qt,y.potpack=Yr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Fn,y.registerForPluginStateChange=function(a){return a({pluginStatus:Ns,pluginURL:gu}),If.on("pluginStateChange",a),a},y.renderColorRamp=Ff,y.rotate=function(a,s,l){var m=s[0],_=s[1],E=s[2],A=s[3],P=Math.sin(l),F=Math.cos(l);return a[0]=m*F+E*P,a[1]=_*F+A*P,a[2]=m*-P+E*F,a[3]=_*-P+A*F,a},y.rotateX=function(a,s,l){var m=Math.sin(l),_=Math.cos(l),E=s[4],A=s[5],P=s[6],F=s[7],j=s[8],$=s[9],K=s[10],ue=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=E*_+j*m,a[5]=A*_+$*m,a[6]=P*_+K*m,a[7]=F*_+ue*m,a[8]=j*_-E*m,a[9]=$*_-A*m,a[10]=K*_-P*m,a[11]=ue*_-F*m,a},y.rotateZ=function(a,s,l){var m=Math.sin(l),_=Math.cos(l),E=s[0],A=s[1],P=s[2],F=s[3],j=s[4],$=s[5],K=s[6],ue=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=E*_+j*m,a[1]=A*_+$*m,a[2]=P*_+K*m,a[3]=F*_+ue*m,a[4]=j*_-E*m,a[5]=$*_-A*m,a[6]=K*_-P*m,a[7]=ue*_-F*m,a},y.scale=function(a,s,l){var m=l[0],_=l[1],E=l[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*E,a[9]=s[9]*E,a[10]=s[10]*E,a[11]=s[11]*E,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,l){return a[0]=s[0]*l,a[1]=s[1]*l,a[2]=s[2]*l,a[3]=s[3]*l,a},y.scale$2=function(a,s,l){return a[0]=s[0]*l,a[1]=s[1]*l,a[2]=s[2]*l,a},y.setCacheLimits=function(a,s){Rt=a,vr=s},y.setRTLTextPlugin=function(a,s,l){if(l===void 0&&(l=!1),Ns==="deferred"||Ns==="loading"||Ns==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");gu=Xn.resolveURL(a),Ns="deferred",ju=s,Jc(),l||lu()},y.sphericalToCartesian=function(a){var s=a[0],l=a[1],m=a[2];return l+=90,l*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(m),y:s*Math.sin(l)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],l=a[1];return s*s+l*l},y.styleSpec=be,y.sub=function(a,s,l){return a[0]=s[0]-l[0],a[1]=s[1]-l[1],a[2]=s[2]-l[2],a},y.symbolSize=ji,y.transformMat3=function(a,s,l){var m=s[0],_=s[1],E=s[2];return a[0]=m*l[0]+_*l[3]+E*l[6],a[1]=m*l[1]+_*l[4]+E*l[7],a[2]=m*l[2]+_*l[5]+E*l[8],a},y.transformMat4=nf,y.translate=function(a,s,l){var m,_,E,A,P,F,j,$,K,ue,de,Ve,Ge=l[0],ut=l[1],Qe=l[2];return s===a?(a[12]=s[0]*Ge+s[4]*ut+s[8]*Qe+s[12],a[13]=s[1]*Ge+s[5]*ut+s[9]*Qe+s[13],a[14]=s[2]*Ge+s[6]*ut+s[10]*Qe+s[14],a[15]=s[3]*Ge+s[7]*ut+s[11]*Qe+s[15]):(_=s[1],E=s[2],A=s[3],P=s[4],F=s[5],j=s[6],$=s[7],K=s[8],ue=s[9],de=s[10],Ve=s[11],a[0]=m=s[0],a[1]=_,a[2]=E,a[3]=A,a[4]=P,a[5]=F,a[6]=j,a[7]=$,a[8]=K,a[9]=ue,a[10]=de,a[11]=Ve,a[12]=m*Ge+P*ut+K*Qe+s[12],a[13]=_*Ge+F*ut+ue*Qe+s[13],a[14]=E*Ge+j*ut+de*Qe+s[14],a[15]=A*Ge+$*ut+Ve*Qe+s[15]),a},y.triggerPluginCompletionEvent=Mf,y.uniqueId=Xt,y.validateCustomStyleLayer=function(a){var s=[],l=a.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=wu,y.validateStyle=ks,y.values=function(a){var s=[];for(var l in a)s.push(a[l]);return s},y.vectorTile=Os,y.version="1.13.2",y.warnOnce=mt,y.webpSupported=Nn,y.window=me,y.wrap=ur}),re(["./shared"],function(y){"use strict";function Se(q){var ie=typeof q;if(ie==="number"||ie==="boolean"||ie==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){for(var pe="[",we=0,ze=q;we<ze.length;we+=1)pe+=Se(ze[we])+",";return pe+"]"}for(var rt=Object.keys(q).sort(),_t="{",be=0;be<rt.length;be++)_t+=JSON.stringify(rt[be])+":"+Se(q[rt[be]])+",";return _t+"}"}function W(q){for(var ie="",pe=0,we=y.refProperties;pe<we.length;pe+=1)ie+="/"+Se(q[we[pe]]);return ie}var ge=function(q){this.keyCache={},q&&this.replace(q)};ge.prototype.replace=function(q){this._layerConfigs={},this._layers={},this.update(q,[])},ge.prototype.update=function(q,ie){for(var pe=this,we=0,ze=q;we<ze.length;we+=1){var rt=ze[we];this._layerConfigs[rt.id]=rt;var _t=this._layers[rt.id]=y.createStyleLayer(rt);_t._featureFilter=y.featureFilter(_t.filter),this.keyCache[rt.id]&&delete this.keyCache[rt.id]}for(var be=0,We=ie;be<We.length;be+=1){var zt=We[be];delete this.keyCache[zt],delete this._layerConfigs[zt],delete this._layers[zt]}this.familiesBySource={};for(var Rr=0,er=function(mr,pt){for(var Ei={},gn=0;gn<mr.length;gn++){var Pi=pt&&pt[mr[gn].id]||W(mr[gn]);pt&&(pt[mr[gn].id]=Pi);var na=Ei[Pi];na||(na=Ei[Pi]=[]),na.push(mr[gn])}var vt=[];for(var xt in Ei)vt.push(Ei[xt]);return vt}(y.values(this._layerConfigs),this.keyCache);Rr<er.length;Rr+=1){var ar=er[Rr].map(function(mr){return pe._layers[mr.id]}),Or=ar[0];if(Or.visibility!=="none"){var Dn=Or.source||"",In=this.familiesBySource[Dn];In||(In=this.familiesBySource[Dn]={});var qt=Or.sourceLayer||"_geojsonTileLayer",Cn=In[qt];Cn||(Cn=In[qt]=[]),Cn.push(ar)}}};var ce=function(q){var ie={},pe=[];for(var we in q){var ze=q[we],rt=ie[we]={};for(var _t in ze){var be=ze[+_t];if(be&&be.bitmap.width!==0&&be.bitmap.height!==0){var We={x:0,y:0,w:be.bitmap.width+2,h:be.bitmap.height+2};pe.push(We),rt[_t]={rect:We,metrics:be.metrics}}}}var zt=y.potpack(pe),Rr=new y.AlphaImage({width:zt.w||1,height:zt.h||1});for(var er in q){var ar=q[er];for(var Or in ar){var Dn=ar[+Or];if(Dn&&Dn.bitmap.width!==0&&Dn.bitmap.height!==0){var In=ie[er][Or].rect;y.AlphaImage.copy(Dn.bitmap,Rr,{x:0,y:0},{x:In.x+1,y:In.y+1},Dn.bitmap)}}}this.image=Rr,this.positions=ie};y.register("GlyphAtlas",ce);var Xe=function(q){this.tileID=new y.OverscaledTileID(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId};function me(q,ie,pe){for(var we=new y.EvaluationParameters(ie),ze=0,rt=q;ze<rt.length;ze+=1)rt[ze].recalculate(we,pe)}function qe(q,ie){var pe=y.getArrayBuffer(q.request,function(we,ze,rt,_t){we?ie(we):ze&&ie(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(ze)),rawData:ze,cacheControl:rt,expires:_t})});return function(){pe.cancel(),ie()}}Xe.prototype.parse=function(q,ie,pe,we,ze){var rt=this;this.status="parsing",this.data=q,this.collisionBoxArray=new y.CollisionBoxArray;var _t=new y.DictionaryCoder(Object.keys(q.layers).sort()),be=new y.FeatureIndex(this.tileID,this.promoteId);be.bucketLayerIDs=[];var We,zt,Rr,er,ar={},Or={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:pe},Dn=ie.familiesBySource[this.source];for(var In in Dn){var qt=q.layers[In];if(qt){qt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+In+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Cn=_t.encode(In),mr=[],pt=0;pt<qt.length;pt++){var Ei=qt.feature(pt),gn=be.getId(Ei,In);mr.push({feature:Ei,id:gn,index:pt,sourceLayerIndex:Cn})}for(var Pi=0,na=Dn[In];Pi<na.length;Pi+=1){var vt=na[Pi],xt=vt[0];xt.minzoom&&this.zoom<Math.floor(xt.minzoom)||xt.maxzoom&&this.zoom>=xt.maxzoom||xt.visibility!=="none"&&(me(vt,this.zoom,pe),(ar[xt.id]=xt.createBucket({index:be.bucketLayerIDs.length,layers:vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cn,sourceID:this.source})).populate(mr,Or,this.tileID.canonical),be.bucketLayerIDs.push(vt.map(function(ia){return ia.id})))}}}var Ii=y.mapObject(Or.glyphDependencies,function(ia){return Object.keys(ia).map(Number)});Object.keys(Ii).length?we.send("getGlyphs",{uid:this.uid,stacks:Ii},function(ia,Fi){We||(We=ia,zt=Fi,Ji.call(rt))}):zt={};var hi=Object.keys(Or.iconDependencies);hi.length?we.send("getImages",{icons:hi,source:this.source,tileID:this.tileID,type:"icons"},function(ia,Fi){We||(We=ia,Rr=Fi,Ji.call(rt))}):Rr={};var Qi=Object.keys(Or.patternDependencies);function Ji(){if(We)return ze(We);if(zt&&Rr&&er){var ia=new ce(zt),Fi=new y.ImageAtlas(Rr,er);for(var sr in ar){var xr=ar[sr];xr instanceof y.SymbolBucket?(me(xr.layers,this.zoom,pe),y.performSymbolLayout(xr,zt,ia.positions,Rr,Fi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):xr.hasPattern&&(xr instanceof y.LineBucket||xr instanceof y.FillBucket||xr instanceof y.FillExtrusionBucket)&&(me(xr.layers,this.zoom,pe),xr.addFeatures(Or,this.tileID.canonical,Fi.patternPositions))}this.status="done",ze(null,{buckets:y.values(ar).filter(function(je){return!je.isEmpty()}),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ia.image,imageAtlas:Fi,glyphMap:this.returnDependencies?zt:null,iconMap:this.returnDependencies?Rr:null,glyphPositions:this.returnDependencies?ia.positions:null})}}Qi.length?we.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(ia,Fi){We||(We=ia,er=Fi,Ji.call(rt))}):er={},Ji.call(this)};var lt=function(q,ie,pe,we){this.actor=q,this.layerIndex=ie,this.availableImages=pe,this.loadVectorData=we||qe,this.loading={},this.loaded={}};lt.prototype.loadTile=function(q,ie){var pe=this,we=q.uid;this.loading||(this.loading={});var ze=!!(q&&q.request&&q.request.collectResourceTiming)&&new y.RequestPerformance(q.request),rt=this.loading[we]=new Xe(q);rt.abort=this.loadVectorData(q,function(_t,be){if(delete pe.loading[we],_t||!be)return rt.status="done",pe.loaded[we]=rt,ie(_t);var We=be.rawData,zt={};be.expires&&(zt.expires=be.expires),be.cacheControl&&(zt.cacheControl=be.cacheControl);var Rr={};if(ze){var er=ze.finish();er&&(Rr.resourceTiming=JSON.parse(JSON.stringify(er)))}rt.vectorTile=be.vectorTile,rt.parse(be.vectorTile,pe.layerIndex,pe.availableImages,pe.actor,function(ar,Or){if(ar||!Or)return ie(ar);ie(null,y.extend({rawTileData:We.slice(0)},Or,zt,Rr))}),pe.loaded=pe.loaded||{},pe.loaded[we]=rt})},lt.prototype.reloadTile=function(q,ie){var pe=this,we=this.loaded,ze=q.uid,rt=this;if(we&&we[ze]){var _t=we[ze];_t.showCollisionBoxes=q.showCollisionBoxes;var be=function(We,zt){var Rr=_t.reloadCallback;Rr&&(delete _t.reloadCallback,_t.parse(_t.vectorTile,rt.layerIndex,pe.availableImages,rt.actor,Rr)),ie(We,zt)};_t.status==="parsing"?_t.reloadCallback=be:_t.status==="done"&&(_t.vectorTile?_t.parse(_t.vectorTile,this.layerIndex,this.availableImages,this.actor,be):be())}},lt.prototype.abortTile=function(q,ie){var pe=this.loading,we=q.uid;pe&&pe[we]&&pe[we].abort&&(pe[we].abort(),delete pe[we]),ie()},lt.prototype.removeTile=function(q,ie){var pe=this.loaded,we=q.uid;pe&&pe[we]&&delete pe[we],ie()};var bt=y.window.ImageBitmap,Pt=function(){this.loaded={}};function ur(q,ie){if(q.length!==0){Nt(q[0],ie);for(var pe=1;pe<q.length;pe++)Nt(q[pe],!ie)}}function Nt(q,ie){for(var pe=0,we=0,ze=q.length,rt=ze-1;we<ze;rt=we++)pe+=(q[we][0]-q[rt][0])*(q[rt][1]+q[we][1]);pe>=0!=!!ie&&q.reverse()}Pt.prototype.loadTile=function(q,ie){var pe=q.uid,we=q.encoding,ze=q.rawImageData,rt=bt&&ze instanceof bt?this.getImageData(ze):ze,_t=new y.DEMData(pe,rt,we);this.loaded=this.loaded||{},this.loaded[pe]=_t,ie(null,_t)},Pt.prototype.getImageData=function(q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,q.width+2,q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:ie.width,height:ie.height},ie.data)},Pt.prototype.removeTile=function(q){var ie=this.loaded,pe=q.uid;ie&&ie[pe]&&delete ie[pe]};var pr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Xt=function(q){this._feature=q,this.extent=y.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))};Xt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var q=[],ie=0,pe=this._feature.geometry;ie<pe.length;ie+=1){var we=pe[ie];q.push([new y.Point$1(we[0],we[1])])}return q}for(var ze=[],rt=0,_t=this._feature.geometry;rt<_t.length;rt+=1){for(var be=[],We=0,zt=_t[rt];We<zt.length;We+=1){var Rr=zt[We];be.push(new y.Point$1(Rr[0],Rr[1]))}ze.push(be)}return ze},Xt.prototype.toGeoJSON=function(q,ie,pe){return pr.call(this,q,ie,pe)};var It=function(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=q.length,this._features=q};It.prototype.feature=function(q){return new Xt(this._features[q])};var kt=y.vectorTile.VectorTileFeature,_r=J;function J(q,ie){this.options=ie||{},this.features=q,this.length=q.length}function lr(q,ie){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=ie||4096}J.prototype.feature=function(q){return new lr(this.features[q],this.options.extent)},lr.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var ie=0;ie<q.length;ie++){for(var pe=q[ie],we=[],ze=0;ze<pe.length;ze++)we.push(new y.Point$1(pe[ze][0],pe[ze][1]));this.geometry.push(we)}return this.geometry},lr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,ie=1/0,pe=-1/0,we=1/0,ze=-1/0,rt=0;rt<q.length;rt++)for(var _t=q[rt],be=0;be<_t.length;be++){var We=_t[be];ie=Math.min(ie,We.x),pe=Math.max(pe,We.x),we=Math.min(we,We.y),ze=Math.max(ze,We.y)}return[ie,we,pe,ze]},lr.prototype.toGeoJSON=kt.prototype.toGeoJSON;var Tt=Wt,ht=_r;function Wt(q){var ie=new y.pbf;return function(pe,we){for(var ze in pe.layers)we.writeMessage(3,mt,pe.layers[ze])}(q,ie),ie.finish()}function mt(q,ie){var pe;ie.writeVarintField(15,q.version||1),ie.writeStringField(1,q.name||""),ie.writeVarintField(5,q.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<q.length;pe++)we.feature=q.feature(pe),ie.writeMessage(2,fr,we);var ze=we.keys;for(pe=0;pe<ze.length;pe++)ie.writeStringField(3,ze[pe]);var rt=we.values;for(pe=0;pe<rt.length;pe++)ie.writeMessage(4,U,rt[pe])}function fr(q,ie){var pe=q.feature;pe.id!==void 0&&ie.writeVarintField(1,pe.id),ie.writeMessage(2,Lr,q),ie.writeVarintField(3,pe.type),ie.writeMessage(4,N,pe)}function Lr(q,ie){var pe=q.feature,we=q.keys,ze=q.values,rt=q.keycache,_t=q.valuecache;for(var be in pe.properties){var We=rt[be];We===void 0&&(we.push(be),rt[be]=We=we.length-1),ie.writeVarint(We);var zt=pe.properties[be],Rr=typeof zt;Rr!=="string"&&Rr!=="boolean"&&Rr!=="number"&&(zt=JSON.stringify(zt));var er=Rr+":"+zt,ar=_t[er];ar===void 0&&(ze.push(zt),_t[er]=ar=ze.length-1),ie.writeVarint(ar)}}function te(q,ie){return(ie<<3)+(7&q)}function Ne(q){return q<<1^q>>31}function N(q,ie){for(var pe=q.loadGeometry(),we=q.type,ze=0,rt=0,_t=pe.length,be=0;be<_t;be++){var We=pe[be],zt=1;we===1&&(zt=We.length),ie.writeVarint(te(1,zt));for(var Rr=we===3?We.length-1:We.length,er=0;er<Rr;er++){er===1&&we!==1&&ie.writeVarint(te(2,Rr-1));var ar=We[er].x-ze,Or=We[er].y-rt;ie.writeVarint(Ne(ar)),ie.writeVarint(Ne(Or)),ze+=ar,rt+=Or}we===3&&ie.writeVarint(te(7,1))}}function U(q,ie){var pe=typeof q;pe==="string"?ie.writeStringField(1,q):pe==="boolean"?ie.writeBooleanField(7,q):pe==="number"&&(q%1!=0?ie.writeDoubleField(3,q):q<0?ie.writeSVarintField(6,q):ie.writeVarintField(5,q))}function le(q,ie,pe,we){He(q,pe,we),He(ie,2*pe,2*we),He(ie,2*pe+1,2*we+1)}function He(q,ie,pe){var we=q[ie];q[ie]=q[pe],q[pe]=we}function Je(q,ie,pe,we){var ze=q-pe,rt=ie-we;return ze*ze+rt*rt}Tt.fromVectorTileJs=Wt,Tt.fromGeojsonVt=function(q,ie){ie=ie||{};var pe={};for(var we in q)pe[we]=new _r(q[we].features,ie),pe[we].name=we,pe[we].version=ie.version,pe[we].extent=ie.extent;return Wt({layers:pe})},Tt.GeoJSONWrapper=ht;var ft=function(q){return q[0]},Vt=function(q){return q[1]},nr=function(q,ie,pe,we,ze){ie===void 0&&(ie=ft),pe===void 0&&(pe=Vt),we===void 0&&(we=64),ze===void 0&&(ze=Float64Array),this.nodeSize=we,this.points=q;for(var rt=q.length<65536?Uint16Array:Uint32Array,_t=this.ids=new rt(q.length),be=this.coords=new ze(2*q.length),We=0;We<q.length;We++)_t[We]=We,be[2*We]=ie(q[We]),be[2*We+1]=pe(q[We]);(function zt(Rr,er,ar,Or,Dn,In){if(!(Dn-Or<=ar)){var qt=Or+Dn>>1;(function Cn(mr,pt,Ei,gn,Pi,na){for(;Pi>gn;){if(Pi-gn>600){var vt=Pi-gn+1,xt=Ei-gn+1,Ii=Math.log(vt),hi=.5*Math.exp(2*Ii/3),Qi=.5*Math.sqrt(Ii*hi*(vt-hi)/vt)*(xt-vt/2<0?-1:1);Cn(mr,pt,Ei,Math.max(gn,Math.floor(Ei-xt*hi/vt+Qi)),Math.min(Pi,Math.floor(Ei+(vt-xt)*hi/vt+Qi)),na)}var Ji=pt[2*Ei+na],ia=gn,Fi=Pi;for(le(mr,pt,gn,Ei),pt[2*Pi+na]>Ji&&le(mr,pt,gn,Pi);ia<Fi;){for(le(mr,pt,ia,Fi),ia++,Fi--;pt[2*ia+na]<Ji;)ia++;for(;pt[2*Fi+na]>Ji;)Fi--}pt[2*gn+na]===Ji?le(mr,pt,gn,Fi):le(mr,pt,++Fi,Pi),Fi<=Ei&&(gn=Fi+1),Ei<=Fi&&(Pi=Fi-1)}})(Rr,er,qt,Or,Dn,In%2),zt(Rr,er,ar,Or,qt-1,In+1),zt(Rr,er,ar,qt+1,Dn,In+1)}})(_t,be,we,0,_t.length-1,0)};nr.prototype.range=function(q,ie,pe,we){return function(ze,rt,_t,be,We,zt,Rr){for(var er,ar,Or=[0,ze.length-1,0],Dn=[];Or.length;){var In=Or.pop(),qt=Or.pop(),Cn=Or.pop();if(qt-Cn<=Rr)for(var mr=Cn;mr<=qt;mr++)ar=rt[2*mr+1],(er=rt[2*mr])>=_t&&er<=We&&ar>=be&&ar<=zt&&Dn.push(ze[mr]);else{var pt=Math.floor((Cn+qt)/2);ar=rt[2*pt+1],(er=rt[2*pt])>=_t&&er<=We&&ar>=be&&ar<=zt&&Dn.push(ze[pt]);var Ei=(In+1)%2;(In===0?_t<=er:be<=ar)&&(Or.push(Cn),Or.push(pt-1),Or.push(Ei)),(In===0?We>=er:zt>=ar)&&(Or.push(pt+1),Or.push(qt),Or.push(Ei))}}return Dn}(this.ids,this.coords,q,ie,pe,we,this.nodeSize)},nr.prototype.within=function(q,ie,pe){return function(we,ze,rt,_t,be,We){for(var zt=[0,we.length-1,0],Rr=[],er=be*be;zt.length;){var ar=zt.pop(),Or=zt.pop(),Dn=zt.pop();if(Or-Dn<=We)for(var In=Dn;In<=Or;In++)Je(ze[2*In],ze[2*In+1],rt,_t)<=er&&Rr.push(we[In]);else{var qt=Math.floor((Dn+Or)/2),Cn=ze[2*qt],mr=ze[2*qt+1];Je(Cn,mr,rt,_t)<=er&&Rr.push(we[qt]);var pt=(ar+1)%2;(ar===0?rt-be<=Cn:_t-be<=mr)&&(zt.push(Dn),zt.push(qt-1),zt.push(pt)),(ar===0?rt+be>=Cn:_t+be>=mr)&&(zt.push(qt+1),zt.push(Or),zt.push(pt))}}return Rr}(this.ids,this.coords,q,ie,pe,this.nodeSize)};var Zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(q){return q}},Dr=function(q){this.options=Ri(Object.create(Zr),q),this.trees=new Array(this.options.maxZoom+1)};function Xn(q,ie,pe,we,ze){return{x:q,y:ie,zoom:1/0,id:pe,parentId:-1,numPoints:we,properties:ze}}function sn(q,ie){var pe=q.geometry.coordinates,we=pe[1];return{x:xi(pe[0]),y:si(we),zoom:1/0,index:ie,parentId:-1}}function Nn(q){return{type:"Feature",id:q.id,properties:ra(q),geometry:{type:"Point",coordinates:[(we=q.x,360*(we-.5)),(ie=q.y,pe=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(pe))/Math.PI-90)]}};var ie,pe,we}function ra(q){var ie=q.numPoints,pe=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Ri(Ri({},q.properties),{cluster:!0,cluster_id:q.id,point_count:ie,point_count_abbreviated:pe})}function xi(q){return q/360+.5}function si(q){var ie=Math.sin(q*Math.PI/180),pe=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return pe<0?0:pe>1?1:pe}function Ri(q,ie){for(var pe in ie)q[pe]=ie[pe];return q}function ki(q){return q.x}function di(q){return q.y}function Yn(q,ie,pe,we,ze,rt){var _t=ze-pe,be=rt-we;if(_t!==0||be!==0){var We=((q-pe)*_t+(ie-we)*be)/(_t*_t+be*be);We>1?(pe=ze,we=rt):We>0&&(pe+=_t*We,we+=be*We)}return(_t=q-pe)*_t+(be=ie-we)*be}function ri(q,ie,pe,we){var ze={id:q===void 0?null:q,type:ie,geometry:pe,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(rt){var _t=rt.geometry,be=rt.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")Ao(rt,_t);else if(be==="Polygon"||be==="MultiLineString")for(var We=0;We<_t.length;We++)Ao(rt,_t[We]);else if(be==="MultiPolygon")for(We=0;We<_t.length;We++)for(var zt=0;zt<_t[We].length;zt++)Ao(rt,_t[We][zt])}(ze),ze}function Ao(q,ie){for(var pe=0;pe<ie.length;pe+=3)q.minX=Math.min(q.minX,ie[pe]),q.minY=Math.min(q.minY,ie[pe+1]),q.maxX=Math.max(q.maxX,ie[pe]),q.maxY=Math.max(q.maxY,ie[pe+1])}function Na(q,ie,pe,we){if(ie.geometry){var ze=ie.geometry.coordinates,rt=ie.geometry.type,_t=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),be=[],We=ie.id;if(pe.promoteId?We=ie.properties[pe.promoteId]:pe.generateId&&(We=we||0),rt==="Point")ma(ze,be);else if(rt==="MultiPoint")for(var zt=0;zt<ze.length;zt++)ma(ze[zt],be);else if(rt==="LineString")wt(ze,be,_t,!1);else if(rt==="MultiLineString"){if(pe.lineMetrics){for(zt=0;zt<ze.length;zt++)wt(ze[zt],be=[],_t,!1),q.push(ri(We,"LineString",be,ie.properties));return}ve(ze,be,_t,!1)}else if(rt==="Polygon")ve(ze,be,_t,!0);else{if(rt!=="MultiPolygon"){if(rt==="GeometryCollection"){for(zt=0;zt<ie.geometry.geometries.length;zt++)Na(q,{id:We,geometry:ie.geometry.geometries[zt],properties:ie.properties},pe,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(zt=0;zt<ze.length;zt++){var Rr=[];ve(ze[zt],Rr,_t,!0),be.push(Rr)}}q.push(ri(We,rt,be,ie.properties))}}function ma(q,ie){ie.push(se(q[0])),ie.push(xe(q[1])),ie.push(0)}function wt(q,ie,pe,we){for(var ze,rt,_t=0,be=0;be<q.length;be++){var We=se(q[be][0]),zt=xe(q[be][1]);ie.push(We),ie.push(zt),ie.push(0),be>0&&(_t+=we?(ze*zt-We*rt)/2:Math.sqrt(Math.pow(We-ze,2)+Math.pow(zt-rt,2))),ze=We,rt=zt}var Rr=ie.length-3;ie[2]=1,function er(ar,Or,Dn,In){for(var qt,Cn=In,mr=Dn-Or>>1,pt=Dn-Or,Ei=ar[Or],gn=ar[Or+1],Pi=ar[Dn],na=ar[Dn+1],vt=Or+3;vt<Dn;vt+=3){var xt=Yn(ar[vt],ar[vt+1],Ei,gn,Pi,na);if(xt>Cn)qt=vt,Cn=xt;else if(xt===Cn){var Ii=Math.abs(vt-mr);Ii<pt&&(qt=vt,pt=Ii)}}Cn>In&&(qt-Or>3&&er(ar,Or,qt,In),ar[qt+2]=Cn,Dn-qt>3&&er(ar,qt,Dn,In))}(ie,0,Rr,pe),ie[Rr+2]=1,ie.size=Math.abs(_t),ie.start=0,ie.end=ie.size}function ve(q,ie,pe,we){for(var ze=0;ze<q.length;ze++){var rt=[];wt(q[ze],rt,pe,we),ie.push(rt)}}function se(q){return q/360+.5}function xe(q){var ie=Math.sin(q*Math.PI/180),pe=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return pe<0?0:pe>1?1:pe}function z(q,ie,pe,we,ze,rt,_t,be){if(we/=ie,rt>=(pe/=ie)&&_t<we)return q;if(_t<pe||rt>=we)return null;for(var We=[],zt=0;zt<q.length;zt++){var Rr=q[zt],er=Rr.geometry,ar=Rr.type,Or=ze===0?Rr.minX:Rr.minY,Dn=ze===0?Rr.maxX:Rr.maxY;if(Or>=pe&&Dn<we)We.push(Rr);else if(!(Dn<pe||Or>=we)){var In=[];if(ar==="Point"||ar==="MultiPoint")et(er,In,pe,we,ze);else if(ar==="LineString")Qt(er,In,pe,we,ze,!1,be.lineMetrics);else if(ar==="MultiLineString")Ke(er,In,pe,we,ze,!1);else if(ar==="Polygon")Ke(er,In,pe,we,ze,!0);else if(ar==="MultiPolygon")for(var qt=0;qt<er.length;qt++){var Cn=[];Ke(er[qt],Cn,pe,we,ze,!0),Cn.length&&In.push(Cn)}if(In.length){if(be.lineMetrics&&ar==="LineString"){for(qt=0;qt<In.length;qt++)We.push(ri(Rr.id,ar,In[qt],Rr.tags));continue}ar!=="LineString"&&ar!=="MultiLineString"||(In.length===1?(ar="LineString",In=In[0]):ar="MultiLineString"),ar!=="Point"&&ar!=="MultiPoint"||(ar=In.length===3?"Point":"MultiPoint"),We.push(ri(Rr.id,ar,In,Rr.tags))}}}return We.length?We:null}function et(q,ie,pe,we,ze){for(var rt=0;rt<q.length;rt+=3){var _t=q[rt+ze];_t>=pe&&_t<=we&&(ie.push(q[rt]),ie.push(q[rt+1]),ie.push(q[rt+2]))}}function Qt(q,ie,pe,we,ze,rt,_t){for(var be,We,zt=zr(q),Rr=ze===0?vr:Pr,er=q.start,ar=0;ar<q.length-3;ar+=3){var Or=q[ar],Dn=q[ar+1],In=q[ar+2],qt=q[ar+3],Cn=q[ar+4],mr=ze===0?Or:Dn,pt=ze===0?qt:Cn,Ei=!1;_t&&(be=Math.sqrt(Math.pow(Or-qt,2)+Math.pow(Dn-Cn,2))),mr<pe?pt>pe&&(We=Rr(zt,Or,Dn,qt,Cn,pe),_t&&(zt.start=er+be*We)):mr>we?pt<we&&(We=Rr(zt,Or,Dn,qt,Cn,we),_t&&(zt.start=er+be*We)):Rt(zt,Or,Dn,In),pt<pe&&mr>=pe&&(We=Rr(zt,Or,Dn,qt,Cn,pe),Ei=!0),pt>we&&mr<=we&&(We=Rr(zt,Or,Dn,qt,Cn,we),Ei=!0),!rt&&Ei&&(_t&&(zt.end=er+be*We),ie.push(zt),zt=zr(q)),_t&&(er+=be)}var gn=q.length-3;Or=q[gn],Dn=q[gn+1],In=q[gn+2],(mr=ze===0?Or:Dn)>=pe&&mr<=we&&Rt(zt,Or,Dn,In),gn=zt.length-3,rt&&gn>=3&&(zt[gn]!==zt[0]||zt[gn+1]!==zt[1])&&Rt(zt,zt[0],zt[1],zt[2]),zt.length&&ie.push(zt)}function zr(q){var ie=[];return ie.size=q.size,ie.start=q.start,ie.end=q.end,ie}function Ke(q,ie,pe,we,ze,rt){for(var _t=0;_t<q.length;_t++)Qt(q[_t],ie,pe,we,ze,rt,!1)}function Rt(q,ie,pe,we){q.push(ie),q.push(pe),q.push(we)}function vr(q,ie,pe,we,ze,rt){var _t=(rt-ie)/(we-ie);return q.push(rt),q.push(pe+(ze-pe)*_t),q.push(1),_t}function Pr(q,ie,pe,we,ze,rt){var _t=(rt-pe)/(ze-pe);return q.push(ie+(we-ie)*_t),q.push(rt),q.push(1),_t}function Xr(q,ie){for(var pe=[],we=0;we<q.length;we++){var ze,rt=q[we],_t=rt.type;if(_t==="Point"||_t==="MultiPoint"||_t==="LineString")ze=rn(rt.geometry,ie);else if(_t==="MultiLineString"||_t==="Polygon"){ze=[];for(var be=0;be<rt.geometry.length;be++)ze.push(rn(rt.geometry[be],ie))}else if(_t==="MultiPolygon")for(ze=[],be=0;be<rt.geometry.length;be++){for(var We=[],zt=0;zt<rt.geometry[be].length;zt++)We.push(rn(rt.geometry[be][zt],ie));ze.push(We)}pe.push(ri(rt.id,_t,ze,rt.tags))}return pe}function rn(q,ie){var pe=[];pe.size=q.size,q.start!==void 0&&(pe.start=q.start,pe.end=q.end);for(var we=0;we<q.length;we+=3)pe.push(q[we]+ie,q[we+1],q[we+2]);return pe}function jn(q,ie){if(q.transformed)return q;var pe,we,ze,rt=1<<q.z,_t=q.x,be=q.y;for(pe=0;pe<q.features.length;pe++){var We=q.features[pe],zt=We.geometry,Rr=We.type;if(We.geometry=[],Rr===1)for(we=0;we<zt.length;we+=2)We.geometry.push(Zn(zt[we],zt[we+1],ie,rt,_t,be));else for(we=0;we<zt.length;we++){var er=[];for(ze=0;ze<zt[we].length;ze+=2)er.push(Zn(zt[we][ze],zt[we][ze+1],ie,rt,_t,be));We.geometry.push(er)}}return q.transformed=!0,q}function Zn(q,ie,pe,we,ze,rt){return[Math.round(pe*(q*we-ze)),Math.round(pe*(ie*we-rt))]}function an(q,ie,pe,we,ze){for(var rt=ie===ze.maxZoom?0:ze.tolerance/((1<<ie)*ze.extent),_t={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:we,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<q.length;be++){_t.numFeatures++,ui(_t,q[be],rt,ze);var We=q[be].minX,zt=q[be].minY,Rr=q[be].maxX,er=q[be].maxY;We<_t.minX&&(_t.minX=We),zt<_t.minY&&(_t.minY=zt),Rr>_t.maxX&&(_t.maxX=Rr),er>_t.maxY&&(_t.maxY=er)}return _t}function ui(q,ie,pe,we){var ze=ie.geometry,rt=ie.type,_t=[];if(rt==="Point"||rt==="MultiPoint")for(var be=0;be<ze.length;be+=3)_t.push(ze[be]),_t.push(ze[be+1]),q.numPoints++,q.numSimplified++;else if(rt==="LineString")fi(_t,ze,q,pe,!1,!1);else if(rt==="MultiLineString"||rt==="Polygon")for(be=0;be<ze.length;be++)fi(_t,ze[be],q,pe,rt==="Polygon",be===0);else if(rt==="MultiPolygon")for(var We=0;We<ze.length;We++){var zt=ze[We];for(be=0;be<zt.length;be++)fi(_t,zt[be],q,pe,!0,be===0)}if(_t.length){var Rr=ie.tags||null;if(rt==="LineString"&&we.lineMetrics){for(var er in Rr={},ie.tags)Rr[er]=ie.tags[er];Rr.mapbox_clip_start=ze.start/ze.size,Rr.mapbox_clip_end=ze.end/ze.size}var ar={geometry:_t,type:rt==="Polygon"||rt==="MultiPolygon"?3:rt==="LineString"||rt==="MultiLineString"?2:1,tags:Rr};ie.id!==null&&(ar.id=ie.id),q.features.push(ar)}}function fi(q,ie,pe,we,ze,rt){var _t=we*we;if(we>0&&ie.size<(ze?_t:we))pe.numPoints+=ie.length/3;else{for(var be=[],We=0;We<ie.length;We+=3)(we===0||ie[We+2]>_t)&&(pe.numSimplified++,be.push(ie[We]),be.push(ie[We+1])),pe.numPoints++;ze&&function(zt,Rr){for(var er=0,ar=0,Or=zt.length,Dn=Or-2;ar<Or;Dn=ar,ar+=2)er+=(zt[ar]-zt[Dn])*(zt[ar+1]+zt[Dn+1]);if(er>0===Rr)for(ar=0,Or=zt.length;ar<Or/2;ar+=2){var In=zt[ar],qt=zt[ar+1];zt[ar]=zt[Or-2-ar],zt[ar+1]=zt[Or-1-ar],zt[Or-2-ar]=In,zt[Or-1-ar]=qt}}(be,rt),q.push(be)}}function Hi(q,ie){var pe=(ie=this.options=function(ze,rt){for(var _t in rt)ze[_t]=rt[_t];return ze}(Object.create(this.options),ie)).debug;if(pe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var we=function(ze,rt){var _t=[];if(ze.type==="FeatureCollection")for(var be=0;be<ze.features.length;be++)Na(_t,ze.features[be],rt,be);else Na(_t,ze.type==="Feature"?ze:{geometry:ze},rt);return _t}(q,ie);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(we=function(ze,rt){var _t=rt.buffer/rt.extent,be=ze,We=z(ze,1,-1-_t,_t,0,-1,2,rt),zt=z(ze,1,1-_t,2+_t,0,-1,2,rt);return(We||zt)&&(be=z(ze,1,-_t,1+_t,0,-1,2,rt)||[],We&&(be=Xr(We,1).concat(be)),zt&&(be=be.concat(Xr(zt,-1)))),be}(we,ie)).length&&this.splitTile(we,0,0,0),pe&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Aa(q,ie,pe){return 32*((1<<q)*pe+ie)+q}function Pa(q,ie){var pe=q.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var we=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!we)return ie(null,null);var ze=new It(we.features),rt=Tt(ze);rt.byteOffset===0&&rt.byteLength===rt.buffer.byteLength||(rt=new Uint8Array(rt)),ie(null,{vectorTile:ze,rawData:rt.buffer})}Dr.prototype.load=function(q){var ie=this.options,pe=ie.log,we=ie.minZoom,ze=ie.maxZoom,rt=ie.nodeSize;pe&&console.time("total time");var _t="prepare "+q.length+" points";pe&&console.time(_t),this.points=q;for(var be=[],We=0;We<q.length;We++)q[We].geometry&&be.push(sn(q[We],We));this.trees[ze+1]=new nr(be,ki,di,rt,Float32Array),pe&&console.timeEnd(_t);for(var zt=ze;zt>=we;zt--){var Rr=+Date.now();be=this._cluster(be,zt),this.trees[zt]=new nr(be,ki,di,rt,Float32Array),pe&&console.log("z%d: %d clusters in %dms",zt,be.length,+Date.now()-Rr)}return pe&&console.timeEnd("total time"),this},Dr.prototype.getClusters=function(q,ie){var pe=((q[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,q[1])),ze=q[2]===180?180:((q[2]+180)%360+360)%360-180,rt=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)pe=-180,ze=180;else if(pe>ze){var _t=this.getClusters([pe,we,180,rt],ie),be=this.getClusters([-180,we,ze,rt],ie);return _t.concat(be)}for(var We=this.trees[this._limitZoom(ie)],zt=[],Rr=0,er=We.range(xi(pe),si(rt),xi(ze),si(we));Rr<er.length;Rr+=1){var ar=We.points[er[Rr]];zt.push(ar.numPoints?Nn(ar):this.points[ar.index])}return zt},Dr.prototype.getChildren=function(q){var ie=this._getOriginId(q),pe=this._getOriginZoom(q),we="No cluster with the specified id.",ze=this.trees[pe];if(!ze)throw new Error(we);var rt=ze.points[ie];if(!rt)throw new Error(we);for(var _t=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),be=[],We=0,zt=ze.within(rt.x,rt.y,_t);We<zt.length;We+=1){var Rr=ze.points[zt[We]];Rr.parentId===q&&be.push(Rr.numPoints?Nn(Rr):this.points[Rr.index])}if(be.length===0)throw new Error(we);return be},Dr.prototype.getLeaves=function(q,ie,pe){var we=[];return this._appendLeaves(we,q,ie=ie||10,pe=pe||0,0),we},Dr.prototype.getTile=function(q,ie,pe){var we=this.trees[this._limitZoom(q)],ze=Math.pow(2,q),rt=this.options,_t=rt.radius/rt.extent,be=(pe-_t)/ze,We=(pe+1+_t)/ze,zt={features:[]};return this._addTileFeatures(we.range((ie-_t)/ze,be,(ie+1+_t)/ze,We),we.points,ie,pe,ze,zt),ie===0&&this._addTileFeatures(we.range(1-_t/ze,be,1,We),we.points,ze,pe,ze,zt),ie===ze-1&&this._addTileFeatures(we.range(0,be,_t/ze,We),we.points,-1,pe,ze,zt),zt.features.length?zt:null},Dr.prototype.getClusterExpansionZoom=function(q){for(var ie=this._getOriginZoom(q)-1;ie<=this.options.maxZoom;){var pe=this.getChildren(q);if(ie++,pe.length!==1)break;q=pe[0].properties.cluster_id}return ie},Dr.prototype._appendLeaves=function(q,ie,pe,we,ze){for(var rt=0,_t=this.getChildren(ie);rt<_t.length;rt+=1){var be=_t[rt],We=be.properties;if(We&&We.cluster?ze+We.point_count<=we?ze+=We.point_count:ze=this._appendLeaves(q,We.cluster_id,pe,we,ze):ze<we?ze++:q.push(be),q.length===pe)break}return ze},Dr.prototype._addTileFeatures=function(q,ie,pe,we,ze,rt){for(var _t=0,be=q;_t<be.length;_t+=1){var We=ie[be[_t]],zt=We.numPoints,Rr={type:1,geometry:[[Math.round(this.options.extent*(We.x*ze-pe)),Math.round(this.options.extent*(We.y*ze-we))]],tags:zt?ra(We):this.points[We.index].properties},er=void 0;zt?er=We.id:this.options.generateId?er=We.index:this.points[We.index].id&&(er=this.points[We.index].id),er!==void 0&&(Rr.id=er),rt.features.push(Rr)}},Dr.prototype._limitZoom=function(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))},Dr.prototype._cluster=function(q,ie){for(var pe=[],we=this.options,ze=we.reduce,rt=we.minPoints,_t=we.radius/(we.extent*Math.pow(2,ie)),be=0;be<q.length;be++){var We=q[be];if(!(We.zoom<=ie)){We.zoom=ie;for(var zt=this.trees[ie+1],Rr=zt.within(We.x,We.y,_t),er=We.numPoints||1,ar=er,Or=0,Dn=Rr;Or<Dn.length;Or+=1){var In=zt.points[Dn[Or]];In.zoom>ie&&(ar+=In.numPoints||1)}if(ar>=rt){for(var qt=We.x*er,Cn=We.y*er,mr=ze&&er>1?this._map(We,!0):null,pt=(be<<5)+(ie+1)+this.points.length,Ei=0,gn=Rr;Ei<gn.length;Ei+=1){var Pi=zt.points[gn[Ei]];if(!(Pi.zoom<=ie)){Pi.zoom=ie;var na=Pi.numPoints||1;qt+=Pi.x*na,Cn+=Pi.y*na,Pi.parentId=pt,ze&&(mr||(mr=this._map(We,!0)),ze(mr,this._map(Pi)))}}We.parentId=pt,pe.push(Xn(qt/ar,Cn/ar,pt,ar,mr))}else if(pe.push(We),ar>1)for(var vt=0,xt=Rr;vt<xt.length;vt+=1){var Ii=zt.points[xt[vt]];Ii.zoom<=ie||(Ii.zoom=ie,pe.push(Ii))}}}return pe},Dr.prototype._getOriginId=function(q){return q-this.points.length>>5},Dr.prototype._getOriginZoom=function(q){return(q-this.points.length)%32},Dr.prototype._map=function(q,ie){if(q.numPoints)return ie?Ri({},q.properties):q.properties;var pe=this.points[q.index].properties,we=this.options.map(pe);return ie&&we===pe?Ri({},we):we},Hi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hi.prototype.splitTile=function(q,ie,pe,we,ze,rt,_t){for(var be=[q,ie,pe,we],We=this.options,zt=We.debug;be.length;){we=be.pop(),pe=be.pop(),ie=be.pop(),q=be.pop();var Rr=1<<ie,er=Aa(ie,pe,we),ar=this.tiles[er];if(!ar&&(zt>1&&console.time("creation"),ar=this.tiles[er]=an(q,ie,pe,we,We),this.tileCoords.push({z:ie,x:pe,y:we}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,pe,we,ar.numFeatures,ar.numPoints,ar.numSimplified),console.timeEnd("creation"));var Or="z"+ie;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(ar.source=q,ze){if(ie===We.maxZoom||ie===ze)continue;var Dn=1<<ze-ie;if(pe!==Math.floor(rt/Dn)||we!==Math.floor(_t/Dn))continue}else if(ie===We.indexMaxZoom||ar.numPoints<=We.indexMaxPoints)continue;if(ar.source=null,q.length!==0){zt>1&&console.time("clipping");var In,qt,Cn,mr,pt,Ei,gn=.5*We.buffer/We.extent,Pi=.5-gn,na=.5+gn,vt=1+gn;In=qt=Cn=mr=null,pt=z(q,Rr,pe-gn,pe+na,0,ar.minX,ar.maxX,We),Ei=z(q,Rr,pe+Pi,pe+vt,0,ar.minX,ar.maxX,We),q=null,pt&&(In=z(pt,Rr,we-gn,we+na,1,ar.minY,ar.maxY,We),qt=z(pt,Rr,we+Pi,we+vt,1,ar.minY,ar.maxY,We),pt=null),Ei&&(Cn=z(Ei,Rr,we-gn,we+na,1,ar.minY,ar.maxY,We),mr=z(Ei,Rr,we+Pi,we+vt,1,ar.minY,ar.maxY,We),Ei=null),zt>1&&console.timeEnd("clipping"),be.push(In||[],ie+1,2*pe,2*we),be.push(qt||[],ie+1,2*pe,2*we+1),be.push(Cn||[],ie+1,2*pe+1,2*we),be.push(mr||[],ie+1,2*pe+1,2*we+1)}}},Hi.prototype.getTile=function(q,ie,pe){var we=this.options,ze=we.extent,rt=we.debug;if(q<0||q>24)return null;var _t=1<<q,be=Aa(q,ie=(ie%_t+_t)%_t,pe);if(this.tiles[be])return jn(this.tiles[be],ze);rt>1&&console.log("drilling down to z%d-%d-%d",q,ie,pe);for(var We,zt=q,Rr=ie,er=pe;!We&&zt>0;)zt--,Rr=Math.floor(Rr/2),er=Math.floor(er/2),We=this.tiles[Aa(zt,Rr,er)];return We&&We.source?(rt>1&&console.log("found parent tile z%d-%d-%d",zt,Rr,er),rt>1&&console.time("drilling down"),this.splitTile(We.source,zt,Rr,er,q,ie,pe),rt>1&&console.timeEnd("drilling down"),this.tiles[be]?jn(this.tiles[be],ze):null):null};var ba=function(q){function ie(pe,we,ze,rt){q.call(this,pe,we,ze,Pa),rt&&(this.loadGeoJSON=rt)}return q&&(ie.__proto__=q),(ie.prototype=Object.create(q&&q.prototype)).constructor=ie,ie.prototype.loadData=function(pe,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=we,this._pendingLoadDataParams=pe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var pe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var we=this._pendingCallback,ze=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var rt=!!(ze&&ze.request&&ze.request.collectResourceTiming)&&new y.RequestPerformance(ze.request);this.loadGeoJSON(ze,function(_t,be){if(_t||!be)return we(_t);if(typeof be!="object")return we(new Error("Input data given to '"+ze.source+"' is not a valid GeoJSON object."));(function ar(Or,Dn){var In,qt=Or&&Or.type;if(qt==="FeatureCollection")for(In=0;In<Or.features.length;In++)ar(Or.features[In],Dn);else if(qt==="GeometryCollection")for(In=0;In<Or.geometries.length;In++)ar(Or.geometries[In],Dn);else if(qt==="Feature")ar(Or.geometry,Dn);else if(qt==="Polygon")ur(Or.coordinates,Dn);else if(qt==="MultiPolygon")for(In=0;In<Or.coordinates.length;In++)ur(Or.coordinates[In],Dn);return Or})(be,!0);try{if(ze.filter){var We=y.createExpression(ze.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(function(ar){return ar.key+": "+ar.message}).join(", "));var zt=be.features.filter(function(ar){return We.value.evaluate({zoom:0},ar)});be={type:"FeatureCollection",features:zt}}pe._geoJSONIndex=ze.cluster?new Dr(function(ar){var Or=ar.superclusterOptions,Dn=ar.clusterProperties;if(!Dn||!Or)return Or;for(var In={},qt={},Cn={accumulated:null,zoom:0},mr={properties:null},pt=Object.keys(Dn),Ei=0,gn=pt;Ei<gn.length;Ei+=1){var Pi=gn[Ei],na=Dn[Pi],vt=na[0],xt=y.createExpression(na[1]),Ii=y.createExpression(typeof vt=="string"?[vt,["accumulated"],["get",Pi]]:vt);In[Pi]=xt.value,qt[Pi]=Ii.value}return Or.map=function(hi){mr.properties=hi;for(var Qi={},Ji=0,ia=pt;Ji<ia.length;Ji+=1){var Fi=ia[Ji];Qi[Fi]=In[Fi].evaluate(Cn,mr)}return Qi},Or.reduce=function(hi,Qi){mr.properties=Qi;for(var Ji=0,ia=pt;Ji<ia.length;Ji+=1){var Fi=ia[Ji];Cn.accumulated=hi[Fi],hi[Fi]=qt[Fi].evaluate(Cn,mr)}},Or}(ze)).load(be.features):function(ar,Or){return new Hi(ar,Or)}(be,ze.geojsonVtOptions)}catch(ar){return we(ar)}pe.loaded={};var Rr={};if(rt){var er=rt.finish();er&&(Rr.resourceTiming={},Rr.resourceTiming[ze.source]=JSON.parse(JSON.stringify(er)))}we(null,Rr)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(pe,we){var ze=this.loaded;return ze&&ze[pe.uid]?q.prototype.reloadTile.call(this,pe,we):this.loadTile(pe,we)},ie.prototype.loadGeoJSON=function(pe,we){if(pe.request)y.getJSON(pe.request,we);else{if(typeof pe.data!="string")return we(new Error("Input data given to '"+pe.source+"' is not a valid GeoJSON object."));try{return we(null,JSON.parse(pe.data))}catch(ze){return we(new Error("Input data given to '"+pe.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(pe,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),we()},ie.prototype.getClusterExpansionZoom=function(pe,we){try{we(null,this._geoJSONIndex.getClusterExpansionZoom(pe.clusterId))}catch(ze){we(ze)}},ie.prototype.getClusterChildren=function(pe,we){try{we(null,this._geoJSONIndex.getChildren(pe.clusterId))}catch(ze){we(ze)}},ie.prototype.getClusterLeaves=function(pe,we){try{we(null,this._geoJSONIndex.getLeaves(pe.clusterId,pe.limit,pe.offset))}catch(ze){we(ze)}},ie}(lt),Ki=function(q){var ie=this;this.self=q,this.actor=new y.Actor(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:lt,geojson:ba},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(pe,we){if(ie.workerSourceTypes[pe])throw new Error('Worker source with name "'+pe+'" already registered.');ie.workerSourceTypes[pe]=we},this.self.registerRTLTextPlugin=function(pe){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=pe.applyArabicShaping,y.plugin.processBidirectionalText=pe.processBidirectionalText,y.plugin.processStyledBidirectionalText=pe.processStyledBidirectionalText}};return Ki.prototype.setReferrer=function(q,ie){this.referrer=ie},Ki.prototype.setImages=function(q,ie,pe){for(var we in this.availableImages[q]=ie,this.workerSources[q]){var ze=this.workerSources[q][we];for(var rt in ze)ze[rt].availableImages=ie}pe()},Ki.prototype.setLayers=function(q,ie,pe){this.getLayerIndex(q).replace(ie),pe()},Ki.prototype.updateLayers=function(q,ie,pe){this.getLayerIndex(q).update(ie.layers,ie.removedIds),pe()},Ki.prototype.loadTile=function(q,ie,pe){this.getWorkerSource(q,ie.type,ie.source).loadTile(ie,pe)},Ki.prototype.loadDEMTile=function(q,ie,pe){this.getDEMWorkerSource(q,ie.source).loadTile(ie,pe)},Ki.prototype.reloadTile=function(q,ie,pe){this.getWorkerSource(q,ie.type,ie.source).reloadTile(ie,pe)},Ki.prototype.abortTile=function(q,ie,pe){this.getWorkerSource(q,ie.type,ie.source).abortTile(ie,pe)},Ki.prototype.removeTile=function(q,ie,pe){this.getWorkerSource(q,ie.type,ie.source).removeTile(ie,pe)},Ki.prototype.removeDEMTile=function(q,ie){this.getDEMWorkerSource(q,ie.source).removeTile(ie)},Ki.prototype.removeSource=function(q,ie,pe){if(this.workerSources[q]&&this.workerSources[q][ie.type]&&this.workerSources[q][ie.type][ie.source]){var we=this.workerSources[q][ie.type][ie.source];delete this.workerSources[q][ie.type][ie.source],we.removeSource!==void 0?we.removeSource(ie,pe):pe()}},Ki.prototype.loadWorkerSource=function(q,ie,pe){try{this.self.importScripts(ie.url),pe()}catch(we){pe(we.toString())}},Ki.prototype.syncRTLPluginState=function(q,ie,pe){try{y.plugin.setState(ie);var we=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&we!=null){this.self.importScripts(we);var ze=y.plugin.isParsed();pe(ze?void 0:new Error("RTL Text Plugin failed to import scripts from "+we),ze)}}catch(rt){pe(rt.toString())}},Ki.prototype.getAvailableImages=function(q){var ie=this.availableImages[q];return ie||(ie=[]),ie},Ki.prototype.getLayerIndex=function(q){var ie=this.layerIndexes[q];return ie||(ie=this.layerIndexes[q]=new ge),ie},Ki.prototype.getWorkerSource=function(q,ie,pe){var we=this;return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][ie]||(this.workerSources[q][ie]={}),this.workerSources[q][ie][pe]||(this.workerSources[q][ie][pe]=new this.workerSourceTypes[ie]({send:function(ze,rt,_t){we.actor.send(ze,rt,_t,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][ie][pe]},Ki.prototype.getDEMWorkerSource=function(q,ie){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][ie]||(this.demWorkerSources[q][ie]=new Pt),this.demWorkerSources[q][ie]},Ki.prototype.enforceCacheSizeLimit=function(q,ie){y.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ki(self)),Ki}),re(["./shared"],function(y){"use strict";var Se=y.createCommonjsModule(function(f){function d(C){return!h(C)}function h(C){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var k,D,G=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(G);try{D=new Worker(ee),k=!0}catch(_e){k=!1}return D&&D.terminate(),URL.revokeObjectURL(ee),k}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var k=document.createElement("canvas");k.width=k.height=1;var D=k.getContext("2d");if(!D)return!1;var G=D.getImageData(0,0,1,1);return G&&G.width===k.width}()?(g[T=C&&C.failIfMajorPerformanceCaveat]===void 0&&(g[T]=function(k){var D=function(ee){var _e=document.createElement("canvas"),Ee=Object.create(d.webGLContextAttributes);return Ee.failIfMajorPerformanceCaveat=ee,_e.probablySupportsContext?_e.probablySupportsContext("webgl",Ee)||_e.probablySupportsContext("experimental-webgl",Ee):_e.supportsContext?_e.supportsContext("webgl",Ee)||_e.supportsContext("experimental-webgl",Ee):_e.getContext("webgl",Ee)||_e.getContext("experimental-webgl",Ee)}(k);if(!D)return!1;var G=D.createShader(D.VERTEX_SHADER);return!(!G||D.isContextLost())&&(D.shaderSource(G,"void main() {}"),D.compileShader(G),D.getShaderParameter(G,D.COMPILE_STATUS)===!0)}(T)),g[T]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var T}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},ge=y.window.document&&y.window.document.documentElement.style;function ce(f){if(!ge)return f[0];for(var d=0;d<f.length;d++)if(f[d]in ge)return f[d];return f[0]}var Xe,me=ce(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){ge&&me&&(Xe=ge[me],ge[me]="none")},W.enableDrag=function(){ge&&me&&(ge[me]=Xe)};var qe=ce(["transform","WebkitTransform"]);W.setTransform=function(f,d){f.style[qe]=d};var lt=!1;try{var bt=Object.defineProperty({},"passive",{get:function(){lt=!0}});y.window.addEventListener("test",bt,bt),y.window.removeEventListener("test",bt,bt)}catch(f){lt=!1}W.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&lt?g:g.capture)},W.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&lt?g:g.capture)};var Pt=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",Pt,!0)};function ur(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}W.suppressClick=function(){y.window.addEventListener("click",Pt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Pt,!0)},0)},W.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},W.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],C=0;C<d.length;C++)g.push(new y.Point(d[C].clientX-h.left-f.clientLeft,d[C].clientY-h.top-f.clientTop));return g},W.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},W.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var Nt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,C=this.requestors;g<C.length;g+=1){var T=C[g];this._notify(T.ids,T.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var C=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),C=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),C=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),C=!1),C},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var C=0,T=0,k=h;T<k.length;T+=1){var D=k[T];if(D[0]<C||D[1]<D[0]||g<D[1])return!1;C=D[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var C=!0;if(!this.isLoaded())for(var T=0,k=h;T<k.length;T+=1)this.images[k[T]]||(C=!1);this.isLoaded()||C?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var C={},T=0,k=h;T<k.length;T+=1){var D=k[T];this.images[D]||this.fire(new y.Event("styleimagemissing",{id:D}));var G=this.images[D];G?C[D]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:y.warnOnce('Image "'+D+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,C)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],C=this.getImage(h);if(!C)return null;if(g&&g.position.version===C.version)return g.position;if(g)g.position.version=C.version;else{var T={w:C.data.width+2,h:C.data.height+2,x:0,y:0},k=new y.ImagePosition(T,C);this.patterns[h]={bin:T,position:k}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var C=y.potpack(h),T=C.w,k=C.h,D=this.atlasImage;for(var G in D.resize({width:T||1,height:k||1}),this.patterns){var ee=this.patterns[G].bin,_e=ee.x+1,Ee=ee.y+1,Ce=this.images[G].data,Re=Ce.width,Ze=Ce.height;y.RGBAImage.copy(Ce,D,{x:0,y:0},{x:_e,y:Ee},{width:Re,height:Ze}),y.RGBAImage.copy(Ce,D,{x:0,y:Ze-1},{x:_e,y:Ee-1},{width:Re,height:1}),y.RGBAImage.copy(Ce,D,{x:0,y:0},{x:_e,y:Ee+Ze},{width:Re,height:1}),y.RGBAImage.copy(Ce,D,{x:Re-1,y:0},{x:_e-1,y:Ee},{width:1,height:Ze}),y.RGBAImage.copy(Ce,D,{x:0,y:0},{x:_e+Re,y:Ee},{width:1,height:Ze})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,C=h;g<C.length;g+=1){var T=C[g];if(!this.callbackDispatchedThisFrame[T]){this.callbackDispatchedThisFrame[T]=!0;var k=this.images[T];ur(k)&&this.updateImage(T,k)}}},d}(y.Evented),pr=kt,Xt=kt,It=1e20;function kt(f,d,h,g,C,T){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=C||"sans-serif",this.fontWeight=T||"normal",this.radius=h||8;var k=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=k,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.d=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Int16Array(k),this.middle=Math.round(k/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _r(f,d,h,g,C,T,k){for(var D=0;D<d;D++){for(var G=0;G<h;G++)g[G]=f[G*d+D];for(J(g,C,T,k,h),G=0;G<h;G++)f[G*d+D]=C[G]}for(G=0;G<h;G++){for(D=0;D<d;D++)g[D]=f[G*d+D];for(J(g,C,T,k,d),D=0;D<d;D++)f[G*d+D]=Math.sqrt(C[D])}}function J(f,d,h,g,C){h[0]=0,g[0]=-It,g[1]=+It;for(var T=1,k=0;T<C;T++){for(var D=(f[T]+T*T-(f[h[k]]+h[k]*h[k]))/(2*T-2*h[k]);D<=g[k];)k--,D=(f[T]+T*T-(f[h[k]]+h[k]*h[k]))/(2*T-2*h[k]);h[++k]=T,g[k]=D,g[k+1]=+It}for(T=0,k=0;T<C;T++){for(;g[k+1]<T;)k++;d[T]=(T-h[k])*(T-h[k])+f[h[k]]}}kt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var C=d.data[4*g+3]/255;this.gridOuter[g]=C===1?0:C===0?It:Math.pow(Math.max(0,.5-C),2),this.gridInner[g]=C===1?It:C===0?0:Math.pow(Math.max(0,C-.5),2)}for(_r(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),_r(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},pr.default=Xt;var lr=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};lr.prototype.setURL=function(f){this.url=f},lr.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var C in f)for(var T=0,k=f[C];T<k.length;T+=1)g.push({stack:C,id:k[T]});y.asyncAll(g,function(D,G){var ee=D.stack,_e=D.id,Ee=h.entries[ee];Ee||(Ee=h.entries[ee]={glyphs:{},requests:{},ranges:{}});var Ce=Ee.glyphs[_e];if(Ce===void 0){if(Ce=h._tinySDF(Ee,ee,_e))return Ee.glyphs[_e]=Ce,void G(null,{stack:ee,id:_e,glyph:Ce});var Re=Math.floor(_e/256);if(256*Re>65535)G(new Error("glyphs > 65535 not supported"));else if(Ee.ranges[Re])G(null,{stack:ee,id:_e,glyph:Ce});else{var Ze=Ee.requests[Re];Ze||(Ze=Ee.requests[Re]=[],lr.loadGlyphRange(ee,Re,h.url,h.requestManager,function(nt,Fe){if(Fe){for(var at in Fe)h._doesCharSupportLocalGlyph(+at)||(Ee.glyphs[+at]=Fe[+at]);Ee.ranges[Re]=!0}for(var yt=0,Ut=Ze;yt<Ut.length;yt+=1)(0,Ut[yt])(nt,Fe);delete Ee.requests[Re]})),Ze.push(function(nt,Fe){nt?G(nt):Fe&&G(null,{stack:ee,id:_e,glyph:Fe[_e]||null})})}}else G(null,{stack:ee,id:_e,glyph:Ce})},function(D,G){if(D)d(D);else if(G){for(var ee={},_e=0,Ee=G;_e<Ee.length;_e+=1){var Ce=Ee[_e],Re=Ce.stack,Ze=Ce.id,nt=Ce.glyph;(ee[Re]||(ee[Re]={}))[Ze]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}d(null,ee)}})},lr.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},lr.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var C=f.tinySDF;if(!C){var T="400";/bold/i.test(d)?T="900":/medium/i.test(d)?T="500":/light/i.test(d)&&(T="200"),C=f.tinySDF=new lr.TinySDF(24,3,8,.25,g,T)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},C.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},lr.loadGlyphRange=function(f,d,h,g,C){var T=256*d,k=T+255,D=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",T+"-"+k),y.ResourceType.Glyphs);y.getArrayBuffer(D,function(G,ee){if(G)C(G);else if(ee){for(var _e={},Ee=0,Ce=y.parseGlyphPBF(ee);Ee<Ce.length;Ee+=1){var Re=Ce[Ee];_e[Re.id]=Re}C(null,_e)}})},lr.TinySDF=pr;var Tt=function(){this.specification=y.styleSpec.light.position};Tt.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},Tt.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var ht=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Tt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Wt=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(ht),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var C in h){var T=h[C];y.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-"-transition".length),T):this._transitionable.setValue(C,T)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,C){return(!C||C.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),mt=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};mt.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},mt.prototype.getDashRanges=function(f,d,h){var g=[],C=f.length%2==1?-f[f.length-1]*h:0,T=f[0]*h,k=!0;g.push({left:C,right:T,isDash:k,zeroLength:f[0]===0});for(var D=f[0],G=1;G<f.length;G++){var ee=f[G];g.push({left:C=D*h,right:T=(D+=ee)*h,isDash:k=!k,zeroLength:ee===0})}return g},mt.prototype.addRoundDash=function(f,d,h){for(var g=d/2,C=-h;C<=h;C++)for(var T=this.width*(this.nextRow+h+C),k=0,D=f[k],G=0;G<this.width;G++){G/D.right>1&&(D=f[++k]);var ee=Math.abs(G-D.left),_e=Math.abs(G-D.right),Ee=Math.min(ee,_e),Ce=void 0,Re=C/h*(g+1);if(D.isDash){var Ze=g-Math.abs(Re);Ce=Math.sqrt(Ee*Ee+Ze*Ze)}else Ce=g-Math.sqrt(Ee*Ee+Re*Re);this.data[T+G]=Math.max(0,Math.min(255,Ce+128))}},mt.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var C=f[0],T=f[f.length-1];C.isDash===T.isDash&&(C.left=T.left-this.width,T.right=C.right+this.width);for(var k=this.width*this.nextRow,D=0,G=f[D],ee=0;ee<this.width;ee++){ee/G.right>1&&(G=f[++D]);var _e=Math.abs(ee-G.left),Ee=Math.abs(ee-G.right),Ce=Math.min(_e,Ee);this.data[k+ee]=Math.max(0,Math.min(255,(G.isDash?Ce:-Ce)+128))}},mt.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var C=0,T=0;T<f.length;T++)C+=f[T];if(C!==0){var k=this.width/C,D=this.getDashRanges(f,this.width,k);d?this.addRoundDash(D,k,h):this.addRegularDash(D)}var G={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:C};return this.nextRow+=g,this.dirty=!0,G},mt.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var fr=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),C=0;C<g.length;C++){var T=new f.Actor(g[C],h,this.id);T.name="Worker "+C,this.actors.push(T)}};function Lr(f,d,h){var g=function(C,T){if(C)return h(C);if(T){var k=y.pick(y.extend(T,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(k.vectorLayers=T.vector_layers,k.vectorLayerIds=k.vectorLayers.map(function(D){return D.id})),k.tiles=d.canonicalizeTileset(k,f.url),h(null,k)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}fr.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,C){g.send(f,d,C)},h=h||function(){})},fr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},fr.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},fr.Actor=y.Actor;var te=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};te.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},te.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),C=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),T=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<C&&f.y>=g&&f.y<T};var Ne=function(f){function d(h,g,C,T){if(f.call(this),this.id=h,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lr(this._options,this.map._requestManager,function(g,C){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):C&&(y.extend(h,C),C.bounds&&(h.tileBounds=new te(C.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(C.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(C,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function k(D,G){return delete h.request,h.aborted?g(null):D&&D.status!==404?g(D):(G&&G.resourceTiming&&(h.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&h.setExpiryData(G),h.loadVectorData(G,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}T.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",T,k.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",T,k.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),N=function(f){function d(h,g,C,T){f.call(this),this.id=h,this.dispatcher=C,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lr(this._options,this.map._requestManager,function(g,C){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):C&&(y.extend(h,C),C.bounds&&(h.tileBounds=new te(C.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(C.tiles),y.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var C=this,T=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(T,y.ResourceType.Tile),function(k,D){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(k)h.state="errored",g(k);else if(D){C.map._refreshExpiredTiles&&h.setExpiryData(D),delete D.cacheControl,delete D.expires;var G=C.map.painter.context,ee=G.gl;h.texture=C.map.painter.getTileTexture(D.width),h.texture?h.texture.update(D,{useMipmap:!0}):(h.texture=new y.Texture(G,D,ee.RGBA,{useMipmap:!0}),h.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(C.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),U=function(f){function d(h,g,C,T){f.call(this,h,g,C,T),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function T(k,D){k&&(h.state="errored",g(k)),D&&(h.dem=D,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(C,y.ResourceType.Tile),function(k,D){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(k)h.state="errored",g(k);else if(D){this.map._refreshExpiredTiles&&h.setExpiryData(D),delete D.cacheControl,delete D.expires;var G=y.window.ImageBitmap&&D instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?D:y.browser.getImageData(D,1),ee={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:G,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",ee,T.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,C=Math.pow(2,g.z),T=(g.x-1+C)%C,k=g.x===0?h.wrap-1:h.wrap,D=(g.x+1+C)%C,G=g.x+1===C?h.wrap+1:h.wrap,ee={};return ee[new y.OverscaledTileID(h.overscaledZ,k,g.z,T,g.y).key]={backfilled:!1},ee[new y.OverscaledTileID(h.overscaledZ,G,g.z,D,g.y).key]={backfilled:!1},g.y>0&&(ee[new y.OverscaledTileID(h.overscaledZ,k,g.z,T,g.y-1).key]={backfilled:!1},ee[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},ee[new y.OverscaledTileID(h.overscaledZ,G,g.z,D,g.y-1).key]={backfilled:!1}),g.y+1<C&&(ee[new y.OverscaledTileID(h.overscaledZ,k,g.z,T,g.y+1).key]={backfilled:!1},ee[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},ee[new y.OverscaledTileID(h.overscaledZ,G,g.z,D,g.y+1).key]={backfilled:!1}),ee},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(N),le=function(f){function d(h,g,C,T){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=C.getActor(),this.setEventedParent(T),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var k=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*k,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*k,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*k,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var C={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(C.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",C))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(C){if(C)g.fire(new y.ErrorEvent(C));else{var T={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(T.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",T))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,C,T){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:C},T),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var C=y.extend({},this.workerOptions),T=this._data;typeof T=="string"?(C.request=this.map._requestManager.transformRequest(y.browser.resolveURL(T),y.ResourceType.Source),C.request.collectResourceTiming=this._collectResourceTiming):C.data=JSON.stringify(T),this.actor.send(this.type+".loadData",C,function(k,D){g._removed||D&&D.abandoned||(g._loaded=!0,D&&D.resourceTiming&&D.resourceTiming[g.id]&&(g._resourceTiming=D.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:C.source},null),h(k))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var C=this,T=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(T,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(k,D){return delete h.request,h.unloadVectorData(),h.aborted?g(null):k?g(k):(h.loadVectorData(D,C.map.painter,T==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),He=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Je=function(f){function d(h,g,C,T){f.call(this),this.id=h,this.dispatcher=C,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var C=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(T,k){C._loaded=!0,T?C.fire(new y.ErrorEvent(T)):k&&(C.image=k,h&&(C.coordinates=h),g&&g(),C._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var C=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(k){for(var D=1/0,G=1/0,ee=-1/0,_e=-1/0,Ee=0,Ce=k;Ee<Ce.length;Ee+=1){var Re=Ce[Ee];D=Math.min(D,Re.x),G=Math.min(G,Re.y),ee=Math.max(ee,Re.x),_e=Math.max(_e,Re.y)}var Ze=Math.max(ee-D,_e-G),nt=Math.max(0,Math.floor(-Math.log(Ze)/Math.LN2)),Fe=Math.pow(2,nt);return new y.CanonicalTileID(nt,Math.floor((D+ee)/2*Fe),Math.floor((G+_e)/2*Fe))}(C),this.minzoom=this.maxzoom=this.tileID.z;var T=C.map(function(k){return g.tileID.getTilePoint(k)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(T[0].x,T[0].y,0,0),this._boundsArray.emplaceBack(T[1].x,T[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(T[3].x,T[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(T[2].x,T[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),ft=function(f){function d(h,g,C,T){f.call(this,h,g,C,T),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var C=0,T=g.urls;C<T.length;C+=1)this.urls.push(this.map._requestManager.transformRequest(T[C],y.ResourceType.Source).url);y.getVideo(this.urls,function(k,D){h._loaded=!0,k?h.fire(new y.ErrorEvent(k)):D&&(h.video=D,h.video.loop=!0,h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(Je),Vt=function(f){function d(h,g,C,T){f.call(this,h,g,C,T),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(k){return!Array.isArray(k)||k.length!==2||k.some(function(D){return typeof D!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,C=g.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,C.RGBA,{premultiply:!0}),this.tiles){var k=this.tiles[T];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var C=g[h];if(isNaN(C)||C<=0)return!0}return!1},d}(Je),nr={vector:Ne,raster:N,"raster-dem":U,geojson:le,video:ft,image:Je,canvas:Vt};function Zr(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Dr(f,d,h,g,C,T){var k=function(nt,Fe,at){if(nt)for(var yt=0,Ut=nt;yt<Ut.length;yt+=1){var Zt=Fe[Ut[yt]];if(Zt&&Zt.source===at&&Zt.type==="fill-extrusion")return!0}else for(var Ct in Fe){var yr=Fe[Ct];if(yr.source===at&&yr.type==="fill-extrusion")return!0}return!1}(C&&C.layers,d,f.id),D=T.maxPitchScaleFactor(),G=f.tilesIn(g,D,k);G.sort(Xn);for(var ee=[],_e=0,Ee=G;_e<Ee.length;_e+=1){var Ce=Ee[_e];ee.push({wrappedTileID:Ce.tileID.wrapped().key,queryResults:Ce.tile.queryRenderedFeatures(d,h,f._state,Ce.queryGeometry,Ce.cameraQueryGeometry,Ce.scale,C,T,D,Zr(f.transform,Ce.tileID))})}var Re=function(nt){for(var Fe={},at={},yt=0,Ut=nt;yt<Ut.length;yt+=1){var Zt=Ut[yt],Ct=Zt.queryResults,yr=Zt.wrappedTileID,Et=at[yr]=at[yr]||{};for(var Qr in Ct)for(var Hr=Ct[Qr],An=Et[Qr]=Et[Qr]||{},Qn=Fe[Qr]=Fe[Qr]||[],Jn=0,ni=Hr;Jn<ni.length;Jn+=1){var Xi=ni[Jn];An[Xi.featureIndex]||(An[Xi.featureIndex]=!0,Qn.push(Xi))}}return Fe}(ee);for(var Ze in Re)Re[Ze].forEach(function(nt){var Fe=nt.feature,at=f.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=at});return Re}function Xn(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var sn=function(f,d){this.max=f,this.onRemove=d,this.reset()};sn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},sn.prototype.add=function(f,d,h){var g=this,C=f.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);var T={value:d,timeout:void 0};if(h!==void 0&&(T.timeout=setTimeout(function(){g.remove(f,T)},h)),this.data[C].push(T),this.order.push(C),this.order.length>this.max){var k=this._getAndRemoveByKey(this.order[0]);k&&this.onRemove(k)}return this},sn.prototype.has=function(f){return f.wrapped().key in this.data},sn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},sn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},sn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},sn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},sn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),C=this.data[h][g];return this.data[h].splice(g,1),C.timeout&&clearTimeout(C.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(C.value),this.order.splice(this.order.indexOf(h),1),this},sn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},sn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,C=this.data[h];g<C.length;g+=1){var T=C[g];f(T.value)||d.push(T)}for(var k=0,D=d;k<D.length;k+=1){var G=D[k];this.remove(G.value.tileID,G)}};var Nn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Nn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Nn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},Nn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},xi=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var C=f.gl;this.buffer=C.createBuffer(),f.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};xi.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},xi.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},xi.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},xi.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var C=this.attributes[g],T=d.attributes[C.name];T!==void 0&&f.vertexAttribPointer(T,C.components,f[ra[C.type]],!1,this.itemSize,C.offset+this.itemSize*(h||0))}},xi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};si.prototype.get=function(){return this.current},si.prototype.set=function(f){},si.prototype.getDefault=function(){return this.default},si.prototype.setDefault=function(){this.set(this.default)};var Ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(si),ki=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(si),di=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(si),Yn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(si),ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(si),Ao=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(si),Na=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(si),ma=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(si),wt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(si),ve=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(si),se=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(si),xe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(si),z=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(si),et=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(si),Qt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(si),zr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(si),Ke=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(si),Rt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(si),vr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(si),Pr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(si),Xr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(si),rn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(si),jn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(si),Zn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(si),an=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(si),ui=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(si),fi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(si),Hi=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(si),Aa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(si),Pa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(si),ba=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(si),Ki=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(si),q=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(Ki),ie=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Ki),pe=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var C=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new q(f,C),g&&(this.depthAttachment=new ie(f,C))};pe.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var we=function(f,d,h){this.func=f,this.mask=d,this.range=h};we.ReadOnly=!1,we.ReadWrite=!0,we.disabled=new we(519,we.ReadOnly,[0,1]);var ze=function(f,d,h,g,C,T){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=C,this.pass=T};ze.disabled=new ze({func:519,mask:0},0,0,7680,7680,7680);var rt=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};rt.disabled=new rt(rt.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),rt.unblended=new rt(rt.Replace,y.Color.transparent,[!0,!0,!0,!0]),rt.alphaBlended=new rt([1,771],y.Color.transparent,[!0,!0,!0,!0]);var _t=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};_t.disabled=new _t(!1,1029,2305),_t.backCCW=new _t(!0,1029,2305);var be=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ri(this),this.clearDepth=new ki(this),this.clearStencil=new di(this),this.colorMask=new Yn(this),this.depthMask=new ri(this),this.stencilMask=new Ao(this),this.stencilFunc=new Na(this),this.stencilOp=new ma(this),this.stencilTest=new wt(this),this.depthRange=new ve(this),this.depthTest=new se(this),this.depthFunc=new xe(this),this.blend=new z(this),this.blendFunc=new et(this),this.blendColor=new Qt(this),this.blendEquation=new zr(this),this.cullFace=new Ke(this),this.cullFaceSide=new Rt(this),this.frontFace=new vr(this),this.program=new Pr(this),this.activeTexture=new Xr(this),this.viewport=new rn(this),this.bindFramebuffer=new jn(this),this.bindRenderbuffer=new Zn(this),this.bindTexture=new an(this),this.bindVertexBuffer=new ui(this),this.bindElementBuffer=new fi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Hi(this),this.pixelStoreUnpack=new Aa(this),this.pixelStoreUnpackPremultiplyAlpha=new Pa(this),this.pixelStoreUnpackFlipY=new ba(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};be.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},be.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},be.prototype.createIndexBuffer=function(f,d){return new Nn(this,f,d)},be.prototype.createVertexBuffer=function(f,d,h){return new xi(this,f,d,h)},be.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,C=g.createRenderbuffer();return this.bindRenderbuffer.set(C),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),C},be.prototype.createFramebuffer=function(f,d,h){return new pe(this,f,d,h)},be.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,C=0;d&&(C|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(C|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(C)},be.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},be.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},be.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},be.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,rt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},be.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var We=function(f){function d(h,g,C){var T=this;f.call(this),this.id=h,this.dispatcher=C,this.on("data",function(k){k.dataType==="source"&&k.sourceDataType==="metadata"&&(T._sourceLoaded=!0),T._sourceLoaded&&!T._paused&&k.dataType==="source"&&k.sourceDataType==="content"&&(T.reload(),T.transform&&T.update(T.transform))}),this.on("error",function(){T._sourceErrored=!0}),this._source=function(k,D,G,ee){var _e=new nr[D.type](k,D,G,ee);if(_e.id!==k)throw new Error("Expected Source id to be "+k+" instead of "+_e.id);return y.bindAll(["load","abort","unload","serialize","prepare"],_e),_e}(h,g,C,this),this._tiles={},this._cache=new sn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var C=this._tiles[g];C.upload(h),C.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(zt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,C=[];for(var T in this._tiles)this._isIdRenderable(T,h)&&C.push(this._tiles[T]);return h?C.sort(function(k,D){var G=k.tileID,ee=D.tileID,_e=new y.Point(G.canonical.x,G.canonical.y)._rotate(g.transform.angle),Ee=new y.Point(ee.canonical.x,ee.canonical.y)._rotate(g.transform.angle);return G.overscaledZ-ee.overscaledZ||Ee.y-_e.y||Ee.x-_e.x}).map(function(k){return k.tileID.key}):C.map(function(k){return k.tileID}).sort(zt).map(function(k){return k.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var C=this._tiles[h];C&&(C.state!=="loading"&&(C.state=g),this._loadTile(C,this._tileLoaded.bind(this,C,h,g)))},d.prototype._tileLoaded=function(h,g,C,T){if(T)return h.state="errored",void(T.status!==404?this._source.fire(new y.ErrorEvent(T,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),C==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),C=0;C<g.length;C++){var T=g[C];if(h.neighboringTiles&&h.neighboringTiles[T]){var k=this.getTileByID(T);D(h,k),D(k,h)}}function D(G,ee){G.needsHillshadePrepare=!0;var _e=ee.tileID.canonical.x-G.tileID.canonical.x,Ee=ee.tileID.canonical.y-G.tileID.canonical.y,Ce=Math.pow(2,G.tileID.canonical.z),Re=ee.tileID.key;_e===0&&Ee===0||Math.abs(Ee)>1||(Math.abs(_e)>1&&(Math.abs(_e+Ce)===1?_e+=Ce:Math.abs(_e-Ce)===1&&(_e-=Ce)),ee.dem&&G.dem&&(G.dem.backfillBorder(ee.dem,_e,Ee),G.neighboringTiles&&G.neighboringTiles[Re]&&(G.neighboringTiles[Re].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,C,T){for(var k in this._tiles){var D=this._tiles[k];if(!(T[k]||!D.hasData()||D.tileID.overscaledZ<=g||D.tileID.overscaledZ>C)){for(var G=D.tileID;D&&D.tileID.overscaledZ>g+1;){var ee=D.tileID.scaledTo(D.tileID.overscaledZ-1);(D=this._tiles[ee.key])&&D.hasData()&&(G=ee)}for(var _e=G;_e.overscaledZ>g;)if(h[(_e=_e.scaledTo(_e.overscaledZ-1)).key]){T[G.key]=G;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var C=this._loadedParentTiles[h.key];return C&&C.tileID.overscaledZ>=g?C:null}for(var T=h.overscaledZ-1;T>=g;T--){var k=h.scaledTo(T),D=this._getLoadedTile(k);if(D)return D}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,C=Math.ceil(h.height/this._source.tileSize)+1,T=Math.floor(g*C*5),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(k)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var C={};for(var T in this._tiles){var k=this._tiles[T];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+g),C[k.tileID.key]=k}for(var D in this._tiles=C,this._timers)clearTimeout(this._timers[D]),delete this._timers[D];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var C;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?C=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Et){return new y.OverscaledTileID(Et.canonical.z,Et.wrap,Et.canonical.z,Et.canonical.x,Et.canonical.y)}):(C=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(C=C.filter(function(Et){return g._source.hasTile(Et)}))):C=[];var T=h.coveringZoomLevel(this._source),k=Math.max(T-d.maxOverzooming,this._source.minzoom),D=Math.max(T+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(C,T);if(Rr(this._source.type)){for(var ee={},_e={},Ee=0,Ce=Object.keys(G);Ee<Ce.length;Ee+=1){var Re=Ce[Ee],Ze=G[Re],nt=this._tiles[Re];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=y.browser.now())){var Fe=this.findLoadedParent(Ze,k);Fe&&(this._addTile(Fe.tileID),ee[Fe.tileID.key]=Fe.tileID),_e[Re]=Ze}}for(var at in this._retainLoadedChildren(_e,T,D,G),ee)G[at]||(this._coveredTiles[at]=!0,G[at]=ee[at])}for(var yt in G)this._tiles[yt].clearFadeHold();for(var Ut=0,Zt=y.keysDifference(this._tiles,G);Ut<Zt.length;Ut+=1){var Ct=Zt[Ut],yr=this._tiles[Ct];yr.hasSymbolBuckets&&!yr.holdingForFade()?yr.setHoldDuration(this.map._fadeDuration):yr.hasSymbolBuckets&&!yr.symbolFadeFinished()||this._removeTile(Ct)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var C={},T={},k=Math.max(g-d.maxOverzooming,this._source.minzoom),D=Math.max(g+d.maxUnderzooming,this._source.minzoom),G={},ee=0,_e=h;ee<_e.length;ee+=1){var Ee=_e[ee],Ce=this._addTile(Ee);C[Ee.key]=Ee,Ce.hasData()||g<this._source.maxzoom&&(G[Ee.key]=Ee)}this._retainLoadedChildren(G,g,D,C);for(var Re=0,Ze=h;Re<Ze.length;Re+=1){var nt=Ze[Re],Fe=this._tiles[nt.key];if(!Fe.hasData()){if(g+1>this._source.maxzoom){var at=nt.children(this._source.maxzoom)[0],yt=this.getTile(at);if(yt&&yt.hasData()){C[at.key]=at;continue}}else{var Ut=nt.children(this._source.maxzoom);if(C[Ut[0].key]&&C[Ut[1].key]&&C[Ut[2].key]&&C[Ut[3].key])continue}for(var Zt=Fe.wasRequested(),Ct=nt.overscaledZ-1;Ct>=k;--Ct){var yr=nt.scaledTo(Ct);if(T[yr.key]||(T[yr.key]=!0,!(Fe=this.getTile(yr))&&Zt&&(Fe=this._addTile(yr)),Fe&&(C[yr.key]=yr,Zt=Fe.wasRequested(),Fe.hasData())))break}}}return C},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],C=void 0,T=this._tiles[h].tileID;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){C=this._loadedParentTiles[T.key];break}g.push(T.key);var k=T.scaledTo(T.overscaledZ-1);if(C=this._getLoadedTile(k))break;T=k}for(var D=0,G=g;D<G.length;D+=1)this._loadedParentTiles[G[D]]=C}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var C=Boolean(g);return C||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,C||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var C=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var T=g.getExpiryTimeout();T&&(this._timers[h]=setTimeout(function(){C._reloadTile(h,"expired"),delete C._timers[h]},T))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,C){var T=this,k=[],D=this.transform;if(!D)return k;for(var G=C?D.getCameraQueryGeometry(h):h,ee=h.map(function(Ct){return D.pointCoordinate(Ct)}),_e=G.map(function(Ct){return D.pointCoordinate(Ct)}),Ee=this.getIds(),Ce=1/0,Re=1/0,Ze=-1/0,nt=-1/0,Fe=0,at=_e;Fe<at.length;Fe+=1){var yt=at[Fe];Ce=Math.min(Ce,yt.x),Re=Math.min(Re,yt.y),Ze=Math.max(Ze,yt.x),nt=Math.max(nt,yt.y)}for(var Ut=function(Ct){var yr=T._tiles[Ee[Ct]];if(!yr.holdingForFade()){var Et=yr.tileID,Qr=Math.pow(2,D.zoom-yr.tileID.overscaledZ),Hr=g*yr.queryPadding*y.EXTENT/yr.tileSize/Qr,An=[Et.getTilePoint(new y.MercatorCoordinate(Ce,Re)),Et.getTilePoint(new y.MercatorCoordinate(Ze,nt))];if(An[0].x-Hr<y.EXTENT&&An[0].y-Hr<y.EXTENT&&An[1].x+Hr>=0&&An[1].y+Hr>=0){var Qn=ee.map(function(ni){return Et.getTilePoint(ni)}),Jn=_e.map(function(ni){return Et.getTilePoint(ni)});k.push({tile:yr,tileID:Et,queryGeometry:Qn,cameraQueryGeometry:Jn,scale:Qr})}}},Zt=0;Zt<Ee.length;Zt++)Ut(Zt);return k},d.prototype.getVisibleCoordinates=function(h){for(var g=this,C=this.getRenderableIds(h).map(function(G){return g._tiles[G].tileID}),T=0,k=C;T<k.length;T+=1){var D=k[T];D.posMatrix=this.transform.calculatePosMatrix(D.toUnwrapped())}return C},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Rr(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,C){this._state.updateState(h=h||"_geojsonTileLayer",g,C)},d.prototype.removeFeatureState=function(h,g,C){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,C)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,C){var T=this._tiles[h];T&&T.setDependencies(g,C)},d.prototype.reloadTilesForDependencies=function(h,g){for(var C in this._tiles)this._tiles[C].hasDependency(h,g)&&this._reloadTile(C,"reloading");this._cache.filter(function(T){return!T.hasDependency(h,g)})},d}(y.Evented);function zt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function Rr(f){return f==="raster"||f==="image"||f==="video"}function er(){return new y.window.Worker($l.workerUrl)}We.maxOverzooming=10,We.maxUnderzooming=3;var ar="mapboxgl_preloaded_worker_pool",Or=function(){this.active={}};Or.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<Or.workerCount;)this.workers.push(new er);return this.active[f]=!0,this.workers.slice()},Or.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Or.prototype.isPreloaded=function(){return!!this.active[ar]},Or.prototype.numActive=function(){return Object.keys(this.active).length};var Dn,In=Math.floor(y.browser.hardwareConcurrency/2);function qt(){return Dn||(Dn=new Or),Dn}function Cn(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(C){C in d&&(h[C]=d[C])}),h}function mr(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=Cn(f[g],d[f[g].ref]));return f}Or.workerCount=Math.max(Math.min(In,6),1);var pt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ei(f,d,h){h.push({command:pt.addSource,args:[f,d[f]]})}function gn(f,d,h){d.push({command:pt.removeSource,args:[f]}),h[f]=!0}function Pi(f,d,h,g){gn(f,h,g),Ei(f,d,h)}function na(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function vt(f,d,h,g,C,T){var k;for(k in d=d||{},f=f||{})f.hasOwnProperty(k)&&(y.deepEqual(f[k],d[k])||h.push({command:T,args:[g,k,d[k],C]}));for(k in d)d.hasOwnProperty(k)&&!f.hasOwnProperty(k)&&(y.deepEqual(f[k],d[k])||h.push({command:T,args:[g,k,d[k],C]}))}function xt(f){return f.id}function Ii(f,d){return f[d.id]=d,f}var hi=function(f,d){this.reset(f,d)};hi.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},hi.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var C=d-1,T=this._distances[C],k=h-T,D=k>0?(g-T)/k:0;return this.points[C].mult(1-D).add(this.points[d].mult(D))};var Qi=function(f,d,h){var g=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function Ji(f,d,h,g,C){var T=y.create();return d?(y.scale(T,T,[1/C,1/C,1]),h||y.rotateZ(T,T,g.angle)):y.multiply(T,g.labelPlaneMatrix,f),T}function ia(f,d,h,g,C){if(d){var T=y.clone(f);return y.scale(T,T,[C,C,1]),h||y.rotateZ(T,T,-g.angle),T}return g.glCoordMatrix}function Fi(f,d){var h=[f.x,f.y,0,1];Wa(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function sr(f,d){return .5+f/d*.5}function xr(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function je(f,d,h,g,C,T,k,D){var G=g?f.textSizeData:f.iconSizeData,ee=y.evaluateSizeForZoom(G,h.transform.zoom),_e=[256/h.width*2+1,256/h.height*2+1],Ee=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Ee.clear();for(var Ce=f.lineVertexArray,Re=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ze=h.transform.width/h.transform.height,nt=!1,Fe=0;Fe<Re.length;Fe++){var at=Re.get(Fe);if(at.hidden||at.writingMode===y.WritingMode.vertical&&!nt)no(at.numGlyphs,Ee);else{nt=!1;var yt=[at.anchorX,at.anchorY,0,1];if(y.transformMat4(yt,yt,d),xr(yt,_e)){var Ut=sr(h.transform.cameraToCenterDistance,yt[3]),Zt=y.evaluateSizeForFeature(G,ee,at),Ct=k?Zt/Ut:Zt*Ut,yr=new y.Point(at.anchorX,at.anchorY),Et=Fi(yr,C).point,Qr={},Hr=As(at,Ct,!1,D,d,C,T,f.glyphOffsetArray,Ce,Ee,Et,yr,Qr,Ze);nt=Hr.useVertical,(Hr.notEnoughRoom||nt||Hr.needsFlipping&&As(at,Ct,!0,D,d,C,T,f.glyphOffsetArray,Ce,Ee,Et,yr,Qr,Ze).notEnoughRoom)&&no(at.numGlyphs,Ee)}else no(at.numGlyphs,Ee)}}g?f.text.dynamicLayoutVertexBuffer.updateData(Ee):f.icon.dynamicLayoutVertexBuffer.updateData(Ee)}function wa(f,d,h,g,C,T,k,D,G,ee,_e){var Ee=D.glyphStartIndex+D.numGlyphs,Ce=D.lineStartIndex,Re=D.lineStartIndex+D.lineLength,Ze=d.getoffsetX(D.glyphStartIndex),nt=d.getoffsetX(Ee-1),Fe=ta(f*Ze,h,g,C,T,k,D.segment,Ce,Re,G,ee,_e);if(!Fe)return null;var at=ta(f*nt,h,g,C,T,k,D.segment,Ce,Re,G,ee,_e);return at?{first:Fe,last:at}:null}function Le(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function As(f,d,h,g,C,T,k,D,G,ee,_e,Ee,Ce,Re){var Ze,nt=d/24,Fe=f.lineOffsetX*nt,at=f.lineOffsetY*nt;if(f.numGlyphs>1){var yt=f.glyphStartIndex+f.numGlyphs,Ut=f.lineStartIndex,Zt=f.lineStartIndex+f.lineLength,Ct=wa(nt,D,Fe,at,h,_e,Ee,f,G,T,Ce);if(!Ct)return{notEnoughRoom:!0};var yr=Fi(Ct.first.point,k).point,Et=Fi(Ct.last.point,k).point;if(g&&!h){var Qr=Le(f.writingMode,yr,Et,Re);if(Qr)return Qr}Ze=[Ct.first];for(var Hr=f.glyphStartIndex+1;Hr<yt-1;Hr++)Ze.push(ta(nt*D.getoffsetX(Hr),Fe,at,h,_e,Ee,f.segment,Ut,Zt,G,T,Ce));Ze.push(Ct.last)}else{if(g&&!h){var An=Fi(Ee,C).point,Qn=f.lineStartIndex+f.segment+1,Jn=new y.Point(G.getx(Qn),G.gety(Qn)),ni=Fi(Jn,C),Xi=ni.signedDistanceFromCamera>0?ni.point:us(Ee,Jn,An,1,C),wn=Le(f.writingMode,An,Xi,Re);if(wn)return wn}var Si=ta(nt*D.getoffsetX(f.glyphStartIndex),Fe,at,h,_e,Ee,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,G,T,Ce);if(!Si)return{notEnoughRoom:!0};Ze=[Si]}for(var Ai=0,vi=Ze;Ai<vi.length;Ai+=1){var ai=vi[Ai];y.addDynamicAttributes(ee,ai.point,ai.angle)}return{}}function us(f,d,h,g,C){var T=Fi(f.add(f.sub(d)._unit()),C).point,k=h.sub(T);return h.add(k._mult(g/k.mag()))}function ta(f,d,h,g,C,T,k,D,G,ee,_e,Ee){var Ce=g?f-d:f+d,Re=Ce>0?1:-1,Ze=0;g&&(Re*=-1,Ze=Math.PI),Re<0&&(Ze+=Math.PI);for(var nt=Re>0?D+k:D+k+1,Fe=C,at=C,yt=0,Ut=0,Zt=Math.abs(Ce),Ct=[];yt+Ut<=Zt;){if((nt+=Re)<D||nt>=G)return null;if(at=Fe,Ct.push(Fe),(Fe=Ee[nt])===void 0){var yr=new y.Point(ee.getx(nt),ee.gety(nt)),Et=Fi(yr,_e);if(Et.signedDistanceFromCamera>0)Fe=Ee[nt]=Et.point;else{var Qr=nt-Re;Fe=us(yt===0?T:new y.Point(ee.getx(Qr),ee.gety(Qr)),yr,at,Zt-yt+1,_e)}}yt+=Ut,Ut=at.dist(Fe)}var Hr=(Zt-yt)/Ut,An=Fe.sub(at),Qn=An.mult(Hr)._add(at);Qn._add(An._unit()._perp()._mult(h*Re));var Jn=Ze+Math.atan2(Fe.y-at.y,Fe.x-at.x);return Ct.push(Qn),{point:Qn,angle:Jn,path:Ct}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(f,d,h,g,C){this._forEachCell(d,h,g,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(C)},Qi.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Qi.prototype._insertBoxCell=function(f,d,h,g,C,T){this.boxCells[C].push(T)},Qi.prototype._insertCircleCell=function(f,d,h,g,C,T){this.circleCells[C].push(T)},Qi.prototype._query=function(f,d,h,g,C,T){if(h<0||f>this.width||g<0||d>this.height)return!C&&[];var k=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(C)return!0;for(var D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(var G=0;G<this.circleKeys.length;G++){var ee=this.circles[3*G],_e=this.circles[3*G+1],Ee=this.circles[3*G+2];k.push({key:this.circleKeys[G],x1:ee-Ee,y1:_e-Ee,x2:ee+Ee,y2:_e+Ee})}return T?k.filter(T):k}return this._forEachCell(f,d,h,g,this._queryCell,k,{hitTest:C,seenUids:{box:{},circle:{}}},T),C?k.length>0:k},Qi.prototype._queryCircle=function(f,d,h,g,C){var T=f-h,k=f+h,D=d-h,G=d+h;if(k<0||T>this.width||G<0||D>this.height)return!g&&[];var ee=[];return this._forEachCell(T,D,k,G,this._queryCellCircle,ee,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},C),g?ee.length>0:ee},Qi.prototype.query=function(f,d,h,g,C){return this._query(f,d,h,g,!1,C)},Qi.prototype.hitTest=function(f,d,h,g,C){return this._query(f,d,h,g,!0,C)},Qi.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},Qi.prototype._queryCell=function(f,d,h,g,C,T,k,D){var G=k.seenUids,ee=this.boxCells[C];if(ee!==null)for(var _e=this.bboxes,Ee=0,Ce=ee;Ee<Ce.length;Ee+=1){var Re=Ce[Ee];if(!G.box[Re]){G.box[Re]=!0;var Ze=4*Re;if(f<=_e[Ze+2]&&d<=_e[Ze+3]&&h>=_e[Ze+0]&&g>=_e[Ze+1]&&(!D||D(this.boxKeys[Re]))){if(k.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Re],x1:_e[Ze],y1:_e[Ze+1],x2:_e[Ze+2],y2:_e[Ze+3]})}}}var nt=this.circleCells[C];if(nt!==null)for(var Fe=this.circles,at=0,yt=nt;at<yt.length;at+=1){var Ut=yt[at];if(!G.circle[Ut]){G.circle[Ut]=!0;var Zt=3*Ut;if(this._circleAndRectCollide(Fe[Zt],Fe[Zt+1],Fe[Zt+2],f,d,h,g)&&(!D||D(this.circleKeys[Ut]))){if(k.hitTest)return T.push(!0),!0;var Ct=Fe[Zt],yr=Fe[Zt+1],Et=Fe[Zt+2];T.push({key:this.circleKeys[Ut],x1:Ct-Et,y1:yr-Et,x2:Ct+Et,y2:yr+Et})}}}},Qi.prototype._queryCellCircle=function(f,d,h,g,C,T,k,D){var G=k.circle,ee=k.seenUids,_e=this.boxCells[C];if(_e!==null)for(var Ee=this.bboxes,Ce=0,Re=_e;Ce<Re.length;Ce+=1){var Ze=Re[Ce];if(!ee.box[Ze]){ee.box[Ze]=!0;var nt=4*Ze;if(this._circleAndRectCollide(G.x,G.y,G.radius,Ee[nt+0],Ee[nt+1],Ee[nt+2],Ee[nt+3])&&(!D||D(this.boxKeys[Ze])))return T.push(!0),!0}}var Fe=this.circleCells[C];if(Fe!==null)for(var at=this.circles,yt=0,Ut=Fe;yt<Ut.length;yt+=1){var Zt=Ut[yt];if(!ee.circle[Zt]){ee.circle[Zt]=!0;var Ct=3*Zt;if(this._circlesCollide(at[Ct],at[Ct+1],at[Ct+2],G.x,G.y,G.radius)&&(!D||D(this.circleKeys[Zt])))return T.push(!0),!0}}},Qi.prototype._forEachCell=function(f,d,h,g,C,T,k,D){for(var G=this._convertToXCellCoord(f),ee=this._convertToYCellCoord(d),_e=this._convertToXCellCoord(h),Ee=this._convertToYCellCoord(g),Ce=G;Ce<=_e;Ce++)for(var Re=ee;Re<=Ee;Re++)if(C.call(this,f,d,h,g,this.xCellCount*Re+Ce,T,k,D))return},Qi.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},Qi.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},Qi.prototype._circlesCollide=function(f,d,h,g,C,T){var k=g-f,D=C-d,G=h+T;return G*G>k*k+D*D},Qi.prototype._circleAndRectCollide=function(f,d,h,g,C,T,k){var D=(T-g)/2,G=Math.abs(f-(g+D));if(G>D+h)return!1;var ee=(k-C)/2,_e=Math.abs(d-(C+ee));if(_e>ee+h)return!1;if(G<=D||_e<=ee)return!0;var Ee=G-D,Ce=_e-ee;return Ee*Ee+Ce*Ce<=h*h};var Ys=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function no(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(Ys,3*g)}}function Wa(f,d,h){var g=d[0],C=d[1];return f[0]=h[0]*g+h[4]*C+h[12],f[1]=h[1]*g+h[5]*C+h[13],f[3]=h[3]*g+h[7]*C+h[15],f}var io=function(f,d,h){d===void 0&&(d=new Qi(f.width+200,f.height+200,25)),h===void 0&&(h=new Qi(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function aa(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}io.prototype.placeCollisionBox=function(f,d,h,g,C){var T=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),k=h*T.perspectiveRatio,D=f.x1*k+T.point.x,G=f.y1*k+T.point.y,ee=f.x2*k+T.point.x,_e=f.y2*k+T.point.y;return!this.isInsideGrid(D,G,ee,_e)||!d&&this.grid.hitTest(D,G,ee,_e,C)?{box:[],offscreen:!1}:{box:[D,G,ee,_e],offscreen:this.isOffscreen(D,G,ee,_e)}},io.prototype.placeCollisionCircles=function(f,d,h,g,C,T,k,D,G,ee,_e,Ee,Ce){var Re=[],Ze=new y.Point(d.anchorX,d.anchorY),nt=Fi(Ze,T),Fe=sr(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),at=(ee?C/Fe:C*Fe)/y.ONE_EM,yt=Fi(Ze,k).point,Ut=wa(at,g,d.lineOffsetX*at,d.lineOffsetY*at,!1,yt,Ze,d,h,k,{}),Zt=!1,Ct=!1,yr=!0;if(Ut){for(var Et=.5*Ee*Fe+Ce,Qr=new y.Point(-100,-100),Hr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),An=new hi,Qn=Ut.first,Jn=Ut.last,ni=[],Xi=Qn.path.length-1;Xi>=1;Xi--)ni.push(Qn.path[Xi]);for(var wn=1;wn<Jn.path.length;wn++)ni.push(Jn.path[wn]);var Si=2.5*Et;if(D){var Ai=ni.map(function(Qs){return Fi(Qs,D)});ni=Ai.some(function(Qs){return Qs.signedDistanceFromCamera<=0})?[]:Ai.map(function(Qs){return Qs.point})}var vi=[];if(ni.length>0){for(var ai=ni[0].clone(),wi=ni[0].clone(),li=1;li<ni.length;li++)ai.x=Math.min(ai.x,ni[li].x),ai.y=Math.min(ai.y,ni[li].y),wi.x=Math.max(wi.x,ni[li].x),wi.y=Math.max(wi.y,ni[li].y);vi=ai.x>=Qr.x&&wi.x<=Hr.x&&ai.y>=Qr.y&&wi.y<=Hr.y?[ni]:wi.x<Qr.x||ai.x>Hr.x||wi.y<Qr.y||ai.y>Hr.y?[]:y.clipLine([ni],Qr.x,Qr.y,Hr.x,Hr.y)}for(var oi=0,xo=vi;oi<xo.length;oi+=1){var Ja;An.reset(xo[oi],.25*Et),Ja=An.length<=.5*Et?1:Math.ceil(An.paddedLength/Si)+1;for(var Io=0;Io<Ja;Io++){var Wo=Io/Math.max(Ja-1,1),eo=An.lerp(Wo),to=eo.x+100,Ps=eo.y+100;Re.push(to,Ps,Et,0);var hs=to-Et,Gu=Ps-Et,Es=to+Et,Ls=Ps+Et;if(yr=yr&&this.isOffscreen(hs,Gu,Es,Ls),Ct=Ct||this.isInsideGrid(hs,Gu,Es,Ls),!f&&this.grid.hitTestCircle(to,Ps,Et,_e)&&(Zt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Zt}}}}return{circles:!G&&Zt||!Ct?[]:Re,offscreen:yr,collisionDetected:Zt}},io.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,C=-1/0,T=-1/0,k=0,D=f;k<D.length;k+=1){var G=D[k],ee=new y.Point(G.x+100,G.y+100);h=Math.min(h,ee.x),g=Math.min(g,ee.y),C=Math.max(C,ee.x),T=Math.max(T,ee.y),d.push(ee)}for(var _e={},Ee={},Ce=0,Re=this.grid.query(h,g,C,T).concat(this.ignoredGrid.query(h,g,C,T));Ce<Re.length;Ce+=1){var Ze=Re[Ce],nt=Ze.key;if(_e[nt.bucketInstanceId]===void 0&&(_e[nt.bucketInstanceId]={}),!_e[nt.bucketInstanceId][nt.featureIndex]){var Fe=[new y.Point(Ze.x1,Ze.y1),new y.Point(Ze.x2,Ze.y1),new y.Point(Ze.x2,Ze.y2),new y.Point(Ze.x1,Ze.y2)];y.polygonIntersectsPolygon(d,Fe)&&(_e[nt.bucketInstanceId][nt.featureIndex]=!0,Ee[nt.bucketInstanceId]===void 0&&(Ee[nt.bucketInstanceId]=[]),Ee[nt.bucketInstanceId].push(nt.featureIndex))}}return Ee},io.prototype.insertCollisionBox=function(f,d,h,g,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:C},f[0],f[1],f[2],f[3])},io.prototype.insertCollisionCircles=function(f,d,h,g,C){for(var T=d?this.ignoredGrid:this.grid,k={bucketInstanceId:h,featureIndex:g,collisionGroupID:C},D=0;D<f.length;D+=4)T.insertCircle(k,f[D],f[D+1],f[D+2])},io.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Wa(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},io.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},io.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},io.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var jo=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};jo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Qo=function(f,d,h,g,C){this.text=new jo(f?f.text:null,d,h,C),this.icon=new jo(f?f.icon:null,d,g,C)};Qo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Au=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},wo=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},To=function(f,d,h,g,C){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=C},la=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function ao(f,d,h,g,C){var T=y.getAnchorAlignment(f),k=-(T.horizontalAlign-.5)*d,D=-(T.verticalAlign-.5)*h,G=y.evaluateVariableOffset(f,g);return new y.Point(k+G[0]*C,D+G[1]*C)}function Go(f,d,h,g,C,T){var k=f.x1,D=f.x2,G=f.y1,ee=f.y2,_e=f.anchorPointX,Ee=f.anchorPointY,Ce=new y.Point(d,h);return g&&Ce._rotate(C?T:-T),{x1:k+Ce.x,y1:G+Ce.y,x2:D+Ce.x,y2:ee+Ce.y,anchorPointX:_e,anchorPointY:Ee}}la.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var qa=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new io(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new la(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function nu(f,d,h,g,C){f.emplaceBack(d?1:0,h?1:0,g||0,C||0),f.emplaceBack(d?1:0,h?1:0,g||0,C||0),f.emplaceBack(d?1:0,h?1:0,g||0,C||0),f.emplaceBack(d?1:0,h?1:0,g||0,C||0)}qa.prototype.getBucketParts=function(f,d,h,g){var C=h.getBucket(d),T=h.latestFeatureIndex;if(C&&T&&d.id===C.layerIds[0]){var k=h.collisionBoxArray,D=C.layers[0].layout,G=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),ee=h.tileSize/y.EXTENT,_e=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Ee=D.get("text-pitch-alignment")==="map",Ce=D.get("text-rotation-alignment")==="map",Re=aa(h,1,this.transform.zoom),Ze=Ji(_e,Ee,Ce,this.transform,Re),nt=null;if(Ee){var Fe=ia(_e,Ee,Ce,this.transform,Re);nt=y.multiply([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[C.bucketInstanceId]=new To(C.bucketInstanceId,T,C.sourceLayerIndex,C.index,h.tileID);var at={bucket:C,layout:D,posMatrix:_e,textLabelPlaneMatrix:Ze,labelToScreenMatrix:nt,scale:G,textPixelRatio:ee,holdingForFade:h.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(g)for(var yt=0,Ut=C.sortKeyRanges;yt<Ut.length;yt+=1){var Zt=Ut[yt];f.push({sortKey:Zt.sortKey,symbolInstanceStart:Zt.symbolInstanceStart,symbolInstanceEnd:Zt.symbolInstanceEnd,parameters:at})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:at})}},qa.prototype.attemptAnchorPlacement=function(f,d,h,g,C,T,k,D,G,ee,_e,Ee,Ce,Re,Ze){var nt,Fe=[Ee.textOffset0,Ee.textOffset1],at=ao(f,h,g,Fe,C),yt=this.collisionIndex.placeCollisionBox(Go(d,at.x,at.y,T,k,this.transform.angle),_e,D,G,ee.predicate);if(!Ze||this.collisionIndex.placeCollisionBox(Go(Ze,at.x,at.y,T,k,this.transform.angle),_e,D,G,ee.predicate).box.length!==0)return yt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[Ee.crossTileID].anchor),this.variableOffsets[Ee.crossTileID]={textOffset:Fe,width:h,height:g,anchor:f,textBoxScale:C,prevAnchor:nt},this.markUsedJustification(Ce,f,Ee,Re),Ce.allowVerticalPlacement&&(this.markUsedOrientation(Ce,Re,Ee),this.placedOrientations[Ee.crossTileID]=Re),{shift:at,placedGlyphBoxes:yt}):void 0},qa.prototype.placeLayerBucketPart=function(f,d,h){var g=this,C=f.parameters,T=C.bucket,k=C.layout,D=C.posMatrix,G=C.textLabelPlaneMatrix,ee=C.labelToScreenMatrix,_e=C.textPixelRatio,Ee=C.holdingForFade,Ce=C.collisionBoxArray,Re=C.partiallyEvaluatedTextSize,Ze=C.collisionGroup,nt=k.get("text-optional"),Fe=k.get("icon-optional"),at=k.get("text-allow-overlap"),yt=k.get("icon-allow-overlap"),Ut=k.get("text-rotation-alignment")==="map",Zt=k.get("text-pitch-alignment")==="map",Ct=k.get("icon-text-fit")!=="none",yr=k.get("symbol-z-order")==="viewport-y",Et=at&&(yt||!T.hasIconData()||Fe),Qr=yt&&(at||!T.hasTextData()||nt);!T.collisionArrays&&Ce&&T.deserializeCollisionBoxes(Ce);var Hr=function(wn,Si){if(!d[wn.crossTileID])if(Ee)g.placements[wn.crossTileID]=new Au(!1,!1,!1);else{var Ai,vi=!1,ai=!1,wi=!0,li=null,oi={box:null,offscreen:null},xo={box:null,offscreen:null},Ja=null,Io=null,Wo=0,eo=0,to=0;Si.textFeatureIndex?Wo=Si.textFeatureIndex:wn.useRuntimeCollisionCircles&&(Wo=wn.featureIndex),Si.verticalTextFeatureIndex&&(eo=Si.verticalTextFeatureIndex);var Ps=Si.textBox;if(Ps){var hs=function(oa){var fu=y.WritingMode.horizontal;if(T.allowVerticalPlacement&&!oa&&g.prevPlacement){var Rs=g.prevPlacement.placedOrientations[wn.crossTileID];Rs&&(g.placedOrientations[wn.crossTileID]=Rs,g.markUsedOrientation(T,fu=Rs,wn))}return fu},Gu=function(oa,fu){if(T.allowVerticalPlacement&&wn.numVerticalGlyphVertices>0&&Si.verticalTextBox)for(var Rs=0,ol=T.writingModes;Rs<ol.length&&(ol[Rs]===y.WritingMode.vertical?(oi=fu(),xo=oi):oi=oa(),!(oi&&oi.box&&oi.box.length));Rs+=1);else oi=oa()};if(k.get("text-variable-anchor")){var Es=k.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[wn.crossTileID]){var Ls=g.prevPlacement.variableOffsets[wn.crossTileID];Es.indexOf(Ls.anchor)>0&&(Es=Es.filter(function(oa){return oa!==Ls.anchor})).unshift(Ls.anchor)}var Qs=function(oa,fu,Rs){for(var ol=oa.x2-oa.x1,rf=oa.y2-oa.y1,nf=wn.textBoxScale,Df=Ct&&!yt?fu:null,hu={box:[],offscreen:!1},Ec=at?2*Es.length:Es.length,bu=0;bu<Ec;++bu){var Pu=g.attemptAnchorPlacement(Es[bu%Es.length],oa,ol,rf,nf,Ut,Zt,_e,D,Ze,bu>=Es.length,wn,T,Rs,Df);if(Pu&&(hu=Pu.placedGlyphBoxes)&&hu.box&&hu.box.length){vi=!0,li=Pu.shift;break}}return hu};Gu(function(){return Qs(Ps,Si.iconBox,y.WritingMode.horizontal)},function(){var oa=Si.verticalTextBox;return T.allowVerticalPlacement&&!(oi&&oi.box&&oi.box.length)&&wn.numVerticalGlyphVertices>0&&oa?Qs(oa,Si.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),oi&&(vi=oi.box,wi=oi.offscreen);var xc=hs(oi&&oi.box);if(!vi&&g.prevPlacement){var ql=g.prevPlacement.variableOffsets[wn.crossTileID];ql&&(g.variableOffsets[wn.crossTileID]=ql,g.markUsedJustification(T,ql.anchor,wn,xc))}}else{var Hu=function(oa,fu){var Rs=g.collisionIndex.placeCollisionBox(oa,at,_e,D,Ze.predicate);return Rs&&Rs.box&&Rs.box.length&&(g.markUsedOrientation(T,fu,wn),g.placedOrientations[wn.crossTileID]=fu),Rs};Gu(function(){return Hu(Ps,y.WritingMode.horizontal)},function(){var oa=Si.verticalTextBox;return T.allowVerticalPlacement&&wn.numVerticalGlyphVertices>0&&oa?Hu(oa,y.WritingMode.vertical):{box:null,offscreen:null}}),hs(oi&&oi.box&&oi.box.length)}}if(vi=(Ai=oi)&&Ai.box&&Ai.box.length>0,wi=Ai&&Ai.offscreen,wn.useRuntimeCollisionCircles){var il=T.text.placedSymbolArray.get(wn.centerJustifiedTextSymbolIndex),bc=y.evaluateSizeForFeature(T.textSizeData,Re,il),Xo=k.get("text-padding");Ja=g.collisionIndex.placeCollisionCircles(at,il,T.lineVertexArray,T.glyphOffsetArray,bc,D,G,ee,h,Zt,Ze.predicate,wn.collisionCircleDiameter,Xo),vi=at||Ja.circles.length>0&&!Ja.collisionDetected,wi=wi&&Ja.offscreen}if(Si.iconFeatureIndex&&(to=Si.iconFeatureIndex),Si.iconBox){var Al=function(oa){var fu=Ct&&li?Go(oa,li.x,li.y,Ut,Zt,g.transform.angle):oa;return g.collisionIndex.placeCollisionBox(fu,yt,_e,D,Ze.predicate)};ai=xo&&xo.box&&xo.box.length&&Si.verticalIconBox?(Io=Al(Si.verticalIconBox)).box.length>0:(Io=Al(Si.iconBox)).box.length>0,wi=wi&&Io.offscreen}var Wu=nt||wn.numHorizontalGlyphVertices===0&&wn.numVerticalGlyphVertices===0,ko=Fe||wn.numIconVertices===0;if(Wu||ko?ko?Wu||(ai=ai&&vi):vi=ai&&vi:ai=vi=ai&&vi,vi&&Ai&&Ai.box&&g.collisionIndex.insertCollisionBox(Ai.box,k.get("text-ignore-placement"),T.bucketInstanceId,xo&&xo.box&&eo?eo:Wo,Ze.ID),ai&&Io&&g.collisionIndex.insertCollisionBox(Io.box,k.get("icon-ignore-placement"),T.bucketInstanceId,to,Ze.ID),Ja&&(vi&&g.collisionIndex.insertCollisionCircles(Ja.circles,k.get("text-ignore-placement"),T.bucketInstanceId,Wo,Ze.ID),h)){var al=T.bucketInstanceId,wl=g.collisionCircleArrays[al];wl===void 0&&(wl=g.collisionCircleArrays[al]=new wo);for(var Xu=0;Xu<Ja.circles.length;Xu+=4)wl.circles.push(Ja.circles[Xu+0]),wl.circles.push(Ja.circles[Xu+1]),wl.circles.push(Ja.circles[Xu+2]),wl.circles.push(Ja.collisionDetected?1:0)}g.placements[wn.crossTileID]=new Au(vi||Et,ai||Qr,wi||T.justReloaded),d[wn.crossTileID]=!0}};if(yr)for(var An=T.getSortedSymbolIndexes(this.transform.angle),Qn=An.length-1;Qn>=0;--Qn){var Jn=An[Qn];Hr(T.symbolInstances.get(Jn),T.collisionArrays[Jn])}else for(var ni=f.symbolInstanceStart;ni<f.symbolInstanceEnd;ni++)Hr(T.symbolInstances.get(ni),T.collisionArrays[ni]);if(h&&T.bucketInstanceId in this.collisionCircleArrays){var Xi=this.collisionCircleArrays[T.bucketInstanceId];y.invert(Xi.invProjMatrix,D),Xi.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1},qa.prototype.markUsedJustification=function(f,d,h,g){var C;C=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var T=0,k=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];T<k.length;T+=1){var D=k[T];D>=0&&(f.text.placedSymbolArray.get(D).crossTileID=C>=0&&D!==C?0:h.crossTileID)}},qa.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,C=d===y.WritingMode.vertical?d:0,T=0,k=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];T<k.length;T+=1)f.text.placedSymbolArray.get(k[T]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=C)},qa.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,C=d?d.opacities:{},T=d?d.variableOffsets:{},k=d?d.placedOrientations:{};for(var D in this.placements){var G=this.placements[D],ee=C[D];ee?(this.opacities[D]=new Qo(ee,g,G.text,G.icon),h=h||G.text!==ee.text.placed||G.icon!==ee.icon.placed):(this.opacities[D]=new Qo(null,g,G.text,G.icon,G.skipFade),h=h||G.text||G.icon)}for(var _e in C){var Ee=C[_e];if(!this.opacities[_e]){var Ce=new Qo(Ee,g,!1,!1);Ce.isHidden()||(this.opacities[_e]=Ce,h=h||Ee.text.placed||Ee.icon.placed)}}for(var Re in T)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=T[Re]);for(var Ze in k)this.placedOrientations[Ze]||!this.opacities[Ze]||this.opacities[Ze].isHidden()||(this.placedOrientations[Ze]=k[Ze]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},qa.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,C=d;g<C.length;g+=1){var T=C[g],k=T.getBucket(f);k&&T.latestFeatureIndex&&f.id===k.layerIds[0]&&this.updateBucketOpacities(k,h,T.collisionBoxArray)}},qa.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var C=f.layers[0].layout,T=new Qo(null,0,!1,!1,!0),k=C.get("text-allow-overlap"),D=C.get("icon-allow-overlap"),G=C.get("text-variable-anchor"),ee=C.get("text-rotation-alignment")==="map",_e=C.get("text-pitch-alignment")==="map",Ee=C.get("icon-text-fit")!=="none",Ce=new Qo(null,0,k&&(D||!f.hasIconData()||C.get("icon-optional")),D&&(k||!f.hasTextData()||C.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var Re=function(at,yt,Ut){for(var Zt=0;Zt<yt/4;Zt++)at.opacityVertexArray.emplaceBack(Ut)},Ze=function(at){var yt=f.symbolInstances.get(at),Ut=yt.numHorizontalGlyphVertices,Zt=yt.numVerticalGlyphVertices,Ct=yt.crossTileID,yr=g.opacities[Ct];d[Ct]?yr=T:yr||(g.opacities[Ct]=yr=Ce),d[Ct]=!0;var Et=yt.numIconVertices>0,Qr=g.placedOrientations[yt.crossTileID],Hr=Qr===y.WritingMode.vertical,An=Qr===y.WritingMode.horizontal||Qr===y.WritingMode.horizontalOnly;if(Ut>0||Zt>0){var Qn=Gn(yr.text);Re(f.text,Ut,Hr?Bi:Qn),Re(f.text,Zt,An?Bi:Qn);var Jn=yr.text.isHidden();[yt.rightJustifiedTextSymbolIndex,yt.centerJustifiedTextSymbolIndex,yt.leftJustifiedTextSymbolIndex].forEach(function(oi){oi>=0&&(f.text.placedSymbolArray.get(oi).hidden=Jn||Hr?1:0)}),yt.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(yt.verticalPlacedTextSymbolIndex).hidden=Jn||An?1:0);var ni=g.variableOffsets[yt.crossTileID];ni&&g.markUsedJustification(f,ni.anchor,yt,Qr);var Xi=g.placedOrientations[yt.crossTileID];Xi&&(g.markUsedJustification(f,"left",yt,Xi),g.markUsedOrientation(f,Xi,yt))}if(Et){var wn=Gn(yr.icon),Si=!(Ee&&yt.verticalPlacedIconSymbolIndex&&Hr);yt.placedIconSymbolIndex>=0&&(Re(f.icon,yt.numIconVertices,Si?wn:Bi),f.icon.placedSymbolArray.get(yt.placedIconSymbolIndex).hidden=yr.icon.isHidden()),yt.verticalPlacedIconSymbolIndex>=0&&(Re(f.icon,yt.numVerticalIconVertices,Si?Bi:wn),f.icon.placedSymbolArray.get(yt.verticalPlacedIconSymbolIndex).hidden=yr.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var Ai=f.collisionArrays[at];if(Ai){var vi=new y.Point(0,0);if(Ai.textBox||Ai.verticalTextBox){var ai=!0;if(G){var wi=g.variableOffsets[Ct];wi?(vi=ao(wi.anchor,wi.width,wi.height,wi.textOffset,wi.textBoxScale),ee&&vi._rotate(_e?g.transform.angle:-g.transform.angle)):ai=!1}Ai.textBox&&nu(f.textCollisionBox.collisionVertexArray,yr.text.placed,!ai||Hr,vi.x,vi.y),Ai.verticalTextBox&&nu(f.textCollisionBox.collisionVertexArray,yr.text.placed,!ai||An,vi.x,vi.y)}var li=Boolean(!An&&Ai.verticalIconBox);Ai.iconBox&&nu(f.iconCollisionBox.collisionVertexArray,yr.icon.placed,li,Ee?vi.x:0,Ee?vi.y:0),Ai.verticalIconBox&&nu(f.iconCollisionBox.collisionVertexArray,yr.icon.placed,!li,Ee?vi.x:0,Ee?vi.y:0)}}},nt=0;nt<f.symbolInstances.length;nt++)Ze(nt);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Fe=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Fe.invProjMatrix,f.placementViewportMatrix=Fe.viewportMatrix,f.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},qa.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},qa.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},qa.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},qa.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},qa.prototype.setStale=function(){this.stale=!0};var Rl=Math.pow(2,25),Jo=Math.pow(2,24),he=Math.pow(2,17),Pe=Math.pow(2,16),dt=Math.pow(2,9),Jt=Math.pow(2,8),en=Math.pow(2,1);function Gn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Rl+d*Jo+h*he+d*Pe+h*dt+d*Jt+h*en+d}var Bi=0,fo=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};fo.prototype.continuePlacement=function(f,d,h,g,C){for(var T=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(T,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(function(k,D){return k.sortKey-D.sortKey}));this._currentPartIndex<T.length;)if(d.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,C())return!0;return!1};var za=function(f,d,h,g,C,T,k){this.placement=new qa(f,C,T,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};za.prototype.isDone=function(){return this._done},za.prototype.continuePlacement=function(f,d,h){for(var g=this,C=y.browser.now(),T=function(){var G=y.browser.now()-C;return!g._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var k=d[f[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=D)&&(!k.maxzoom||k.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new fo(k)),this._inProgressLayer.continuePlacement(h[k.source],this.placement,this._showCollisionBoxes,k,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},za.prototype.commit=function(f){return this.placement.commit(f),this.placement};var Ka=512/y.EXTENT/2,es=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var C=d.get(g),T=C.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,f)})}};es.prototype.getScaledCoordinates=function(f,d){var h=Ka/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},es.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=0;C<f.length;C++){var T=f.get(C);if(!T.crossTileID){var k=this.indexedSymbolInstances[T.key];if(k)for(var D=this.getScaledCoordinates(T,d),G=0,ee=k;G<ee.length;G+=1){var _e=ee[G];if(Math.abs(_e.coord.x-D.x)<=g&&Math.abs(_e.coord.y-D.y)<=g&&!h[_e.crossTileID]){h[_e.crossTileID]=!0,T.crossTileID=_e.crossTileID;break}}}}};var Oo=function(){this.maxCrossTileID=0};Oo.prototype.generate=function(){return++this.maxCrossTileID};var go=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};go.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],C={};for(var T in g){var k=g[T];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+d),C[k.tileID.key]=k}this.indexes[h]=C}this.lng=f},go.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var C=this.usedCrossTileIDs[f.overscaledZ];for(var T in this.indexes){var k=this.indexes[T];if(Number(T)>f.overscaledZ)for(var D in k){var G=k[D];G.tileID.isChildOf(f)&&G.findMatches(d.symbolInstances,f,C)}else{var ee=k[f.scaledTo(Number(T)).key];ee&&ee.findMatches(d.symbolInstances,f,C)}}for(var _e=0;_e<d.symbolInstances.length;_e++){var Ee=d.symbolInstances.get(_e);Ee.crossTileID||(Ee.crossTileID=h.generate(),C[Ee.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new es(f,d.symbolInstances,d.bucketInstanceId),!0},go.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,C=d.indexedSymbolInstances[h];g<C.length;g+=1)delete this.usedCrossTileIDs[f][C[g].crossTileID]},go.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var C in g)f[g[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[C]),delete g[C],d=!0)}return d};var ws=function(){this.layerIndexes={},this.crossTileIDs=new Oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ws.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new go);var C=!1,T={};g.handleWrapJump(h);for(var k=0,D=d;k<D.length;k+=1){var G=D[k],ee=G.getBucket(f);ee&&f.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(G.tileID,ee,this.crossTileIDs)&&(C=!0),T[ee.bucketInstanceId]=!0)}return g.removeStaleBuckets(T)&&(C=!0),C},ws.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var Ts=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},Ms=y.pick(pt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),iu=y.pick(pt,["setCenter","setZoom","setBearing","setPitch"]),vu=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,C=y.styleSpec.$root[h];C.required&&(g=h==="version"?d:C.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),ys=function(f){function d(h,g){var C=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new fr(qt(),this),this.imageManager=new Nt,this.imageManager.setEventedParent(this),this.glyphManager=new lr(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new mt(256,512),this.crossTileSymbolIndex=new ws,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var T=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(k){T.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:k.pluginStatus,pluginURL:k.pluginURL},function(D,G){if(y.triggerPluginCompletionEvent(D),G&&G.every(function(_e){return _e}))for(var ee in T.sourceCaches)T.sourceCaches[ee].reload()})}),this.on("data",function(k){if(k.dataType==="source"&&k.sourceDataType==="metadata"){var D=C.sourceCaches[k.sourceId];if(D){var G=D.getSource();if(G&&G.vectorLayerIds)for(var ee in C._layers){var _e=C._layers[ee];_e.source===G.id&&C._validateLayer(_e)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var C=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var T=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var k=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(k,function(D,G){C._request=null,D?C.fire(new y.ErrorEvent(D)):G&&C._load(G,T)})},d.prototype.loadJSON=function(h,g){var C=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){C._request=null,C._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(vu,!1)},d.prototype._load=function(h,g){if(!g||!Ts(this,y.validateStyle(h))){for(var C in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(C,h.sources[C],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var T=mr(this.stylesheet.layers);this._order=T.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var k=0,D=T;k<D.length;k+=1){var G=D[k];(G=y.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Wt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(C,T,k){var D,G,ee,_e=y.browser.devicePixelRatio>1?"@2x":"",Ee=y.getJSON(T.transformRequest(T.normalizeSpriteURL(C,_e,".json"),y.ResourceType.SpriteJSON),function(Ze,nt){Ee=null,ee||(ee=Ze,D=nt,Re())}),Ce=y.getImage(T.transformRequest(T.normalizeSpriteURL(C,_e,".png"),y.ResourceType.SpriteImage),function(Ze,nt){Ce=null,ee||(ee=Ze,G=nt,Re())});function Re(){if(ee)k(ee);else if(D&&G){var Ze=y.browser.getImageData(G),nt={};for(var Fe in D){var at=D[Fe],yt=at.width,Ut=at.height,Zt=at.x,Ct=at.y,yr=at.sdf,Et=at.pixelRatio,Qr=at.stretchX,Hr=at.stretchY,An=at.content,Qn=new y.RGBAImage({width:yt,height:Ut});y.RGBAImage.copy(Ze,Qn,{x:Zt,y:Ct},{x:0,y:0},{width:yt,height:Ut}),nt[Fe]={data:Qn,pixelRatio:Et,sdf:yr,stretchX:Qr,stretchY:Hr,content:An}}k(null,nt)}}return{cancel:function(){Ee&&(Ee.cancel(),Ee=null),Ce&&(Ce.cancel(),Ce=null)}}}(h,this.map._requestManager,function(C,T){if(g._spriteRequest=null,C)g.fire(new y.ErrorEvent(C));else if(T)for(var k in T)g.imageManager.addImage(k,T[k]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var C=h.sourceLayer;if(C){var T=g.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(C)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+C+'" does not exist on source "'+T.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],C=0,T=h;C<T.length;C+=1){var k=this._layers[T[C]];k.type!=="custom"&&g.push(k.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var C=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);for(var k in(C.length||T.length)&&this._updateWorkerLayers(C,T),this._updatedSources){var D=this._updatedSources[k];D==="reload"?this._reloadSource(k):D==="clear"&&this._clearSource(k)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var ee={};for(var _e in this.sourceCaches){var Ee=this.sourceCaches[_e];ee[_e]=Ee.used,Ee.used=!1}for(var Ce=0,Re=this._order;Ce<Re.length;Ce+=1){var Ze=this._layers[Re[Ce]];Ze.recalculate(h,this._availableImages),!Ze.isHidden(h.zoom)&&Ze.source&&(this.sourceCaches[Ze.source].used=!0)}for(var nt in ee){var Fe=this.sourceCaches[nt];ee[nt]!==Fe.used&&Fe.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),Ts(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=mr(h.layers);var C=function(k,D){if(!k)return[{command:pt.setStyle,args:[D]}];var G=[];try{if(!y.deepEqual(k.version,D.version))return[{command:pt.setStyle,args:[D]}];y.deepEqual(k.center,D.center)||G.push({command:pt.setCenter,args:[D.center]}),y.deepEqual(k.zoom,D.zoom)||G.push({command:pt.setZoom,args:[D.zoom]}),y.deepEqual(k.bearing,D.bearing)||G.push({command:pt.setBearing,args:[D.bearing]}),y.deepEqual(k.pitch,D.pitch)||G.push({command:pt.setPitch,args:[D.pitch]}),y.deepEqual(k.sprite,D.sprite)||G.push({command:pt.setSprite,args:[D.sprite]}),y.deepEqual(k.glyphs,D.glyphs)||G.push({command:pt.setGlyphs,args:[D.glyphs]}),y.deepEqual(k.transition,D.transition)||G.push({command:pt.setTransition,args:[D.transition]}),y.deepEqual(k.light,D.light)||G.push({command:pt.setLight,args:[D.light]});var ee={},_e=[];(function(Ce,Re,Ze,nt){var Fe;for(Fe in Re=Re||{},Ce=Ce||{})Ce.hasOwnProperty(Fe)&&(Re.hasOwnProperty(Fe)||gn(Fe,Ze,nt));for(Fe in Re)Re.hasOwnProperty(Fe)&&(Ce.hasOwnProperty(Fe)?y.deepEqual(Ce[Fe],Re[Fe])||(Ce[Fe].type==="geojson"&&Re[Fe].type==="geojson"&&na(Ce,Re,Fe)?Ze.push({command:pt.setGeoJSONSourceData,args:[Fe,Re[Fe].data]}):Pi(Fe,Re,Ze,nt)):Ei(Fe,Re,Ze))})(k.sources,D.sources,_e,ee);var Ee=[];k.layers&&k.layers.forEach(function(Ce){ee[Ce.source]?G.push({command:pt.removeLayer,args:[Ce.id]}):Ee.push(Ce)}),G=G.concat(_e),function(Ce,Re,Ze){Re=Re||[];var nt,Fe,at,yt,Ut,Zt,Ct,yr=(Ce=Ce||[]).map(xt),Et=Re.map(xt),Qr=Ce.reduce(Ii,{}),Hr=Re.reduce(Ii,{}),An=yr.slice(),Qn=Object.create(null);for(nt=0,Fe=0;nt<yr.length;nt++)Hr.hasOwnProperty(at=yr[nt])?Fe++:(Ze.push({command:pt.removeLayer,args:[at]}),An.splice(An.indexOf(at,Fe),1));for(nt=0,Fe=0;nt<Et.length;nt++)An[An.length-1-nt]!==(at=Et[Et.length-1-nt])&&(Qr.hasOwnProperty(at)?(Ze.push({command:pt.removeLayer,args:[at]}),An.splice(An.lastIndexOf(at,An.length-Fe),1)):Fe++,Ze.push({command:pt.addLayer,args:[Hr[at],Zt=An[An.length-nt]]}),An.splice(An.length-nt,0,at),Qn[at]=!0);for(nt=0;nt<Et.length;nt++)if(yt=Qr[at=Et[nt]],Ut=Hr[at],!Qn[at]&&!y.deepEqual(yt,Ut))if(y.deepEqual(yt.source,Ut.source)&&y.deepEqual(yt["source-layer"],Ut["source-layer"])&&y.deepEqual(yt.type,Ut.type)){for(Ct in vt(yt.layout,Ut.layout,Ze,at,null,pt.setLayoutProperty),vt(yt.paint,Ut.paint,Ze,at,null,pt.setPaintProperty),y.deepEqual(yt.filter,Ut.filter)||Ze.push({command:pt.setFilter,args:[at,Ut.filter]}),y.deepEqual(yt.minzoom,Ut.minzoom)&&y.deepEqual(yt.maxzoom,Ut.maxzoom)||Ze.push({command:pt.setLayerZoomRange,args:[at,Ut.minzoom,Ut.maxzoom]}),yt)yt.hasOwnProperty(Ct)&&Ct!=="layout"&&Ct!=="paint"&&Ct!=="filter"&&Ct!=="metadata"&&Ct!=="minzoom"&&Ct!=="maxzoom"&&(Ct.indexOf("paint.")===0?vt(yt[Ct],Ut[Ct],Ze,at,Ct.slice(6),pt.setPaintProperty):y.deepEqual(yt[Ct],Ut[Ct])||Ze.push({command:pt.setLayerProperty,args:[at,Ct,Ut[Ct]]}));for(Ct in Ut)Ut.hasOwnProperty(Ct)&&!yt.hasOwnProperty(Ct)&&Ct!=="layout"&&Ct!=="paint"&&Ct!=="filter"&&Ct!=="metadata"&&Ct!=="minzoom"&&Ct!=="maxzoom"&&(Ct.indexOf("paint.")===0?vt(yt[Ct],Ut[Ct],Ze,at,Ct.slice(6),pt.setPaintProperty):y.deepEqual(yt[Ct],Ut[Ct])||Ze.push({command:pt.setLayerProperty,args:[at,Ct,Ut[Ct]]}))}else Ze.push({command:pt.removeLayer,args:[at]}),Zt=An[An.lastIndexOf(at)+1],Ze.push({command:pt.addLayer,args:[Ut,Zt]})}(Ee,D.layers,G)}catch(Ce){console.warn("Unable to compute style diff:",Ce),G=[{command:pt.setStyle,args:[D]}]}return G}(this.serialize(),h).filter(function(k){return!(k.command in iu)});if(C.length===0)return!1;var T=C.filter(function(k){return!(k.command in Ms)});if(T.length>0)throw new Error("Unimplemented: "+T.map(function(k){return k.command}).join(", ")+".");return C.forEach(function(k){k.command!=="setTransition"&&g[k.command].apply(g,k.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,C){var T=this;if(C===void 0&&(C={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,C))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var k=this.sourceCaches[h]=new We(h,g,this.dispatcher);k.style=this,k.setEventedParent(this,function(){return{isSourceLoaded:T.loaded(),source:k.serialize(),sourceId:h}}),k.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var C=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],C.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),C.setEventedParent(null),C.clearTiles(),C.onRemove&&C.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,C){C===void 0&&(C={}),this._checkLoaded();var T=h.id;if(this.getLayer(T))this.fire(new y.ErrorEvent(new Error('Layer with id "'+T+'" already exists on this map')));else{var k;if(h.type==="custom"){if(Ts(this,y.validateCustomStyleLayer(h)))return;k=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(T,h.source),h=y.clone$1(h),h=y.extend(h,{source:T})),this._validate(y.validateStyle.layer,"layers."+T,h,{arrayIndex:-1},C))return;k=y.createStyleLayer(h),this._validateLayer(k),k.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[k.id]=k.serialize()}var D=g?this._order.indexOf(g):this._order.length;if(g&&D===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(D,0,T),this._layerOrderChanged=!0,this._layers[T]=k,this._removedLayers[T]&&k.source&&k.type!=="custom"){var G=this._removedLayers[T];delete this._removedLayers[T],G.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var C=this._order.indexOf(h);this._order.splice(C,1);var T=g?this._order.indexOf(g):this._order.length;g&&T===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(T,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var C=this._order.indexOf(h);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,C){this._checkLoaded();var T=this.getLayer(h);T?T.minzoom===g&&T.maxzoom===C||(g!=null&&(T.minzoom=g),C!=null&&(T.maxzoom=C),this._updateLayer(T)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);if(T){if(!y.deepEqual(T.filter,g))return g==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(y.validateStyle.filter,"layers."+T.id+".filter",g,null,C)||(T.filter=y.clone$1(g),this._updateLayer(T)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,C,T){T===void 0&&(T={}),this._checkLoaded();var k=this.getLayer(h);k?y.deepEqual(k.getLayoutProperty(g),C)||(k.setLayoutProperty(g,C,T),this._updateLayer(k)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var C=this.getLayer(h);if(C)return C.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,C,T){T===void 0&&(T={}),this._checkLoaded();var k=this.getLayer(h);k?y.deepEqual(k.getPaintProperty(g),C)||(k.setPaintProperty(g,C,T)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var C=h.source,T=h.sourceLayer,k=this.sourceCaches[C];if(k!==void 0){var D=k.getSource().type;D==="geojson"&&T?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||T?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),k.setFeatureState(T,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var C=h.source,T=this.sourceCaches[C];if(T!==void 0){var k=T.getSource().type,D=k==="vector"?h.sourceLayer:void 0;k!=="vector"||D?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(D,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,C=h.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){if(T.getSource().type!=="vector"||C)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),T.getFeatureState(C,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,C=function(Qr){return g._layers[Qr].type==="fill-extrusion"},T={},k=[],D=this._order.length-1;D>=0;D--){var G=this._order[D];if(C(G)){T[G]=D;for(var ee=0,_e=h;ee<_e.length;ee+=1){var Ee=_e[ee][G];if(Ee)for(var Ce=0,Re=Ee;Ce<Re.length;Ce+=1)k.push(Re[Ce])}}}k.sort(function(Qr,Hr){return Hr.intersectionZ-Qr.intersectionZ});for(var Ze=[],nt=this._order.length-1;nt>=0;nt--){var Fe=this._order[nt];if(C(Fe))for(var at=k.length-1;at>=0;at--){var yt=k[at].feature;if(T[yt.layer.id]<nt)break;Ze.push(yt),k.pop()}else for(var Ut=0,Zt=h;Ut<Zt.length;Ut+=1){var Ct=Zt[Ut][Fe];if(Ct)for(var yr=0,Et=Ct;yr<Et.length;yr+=1)Ze.push(Et[yr].feature)}}return Ze},d.prototype.queryRenderedFeatures=function(h,g,C){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var T={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var k=0,D=g.layers;k<D.length;k+=1){var G=D[k],ee=this._layers[G];if(!ee)return this.fire(new y.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];T[ee.source]=!0}}var _e=[];for(var Ee in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!T[Ee]||_e.push(Dr(this.sourceCaches[Ee],this._layers,this._serializedLayers,h,g,C));return this.placement&&_e.push(function(Ce,Re,Ze,nt,Fe,at,yt){for(var Ut={},Zt=at.queryRenderedSymbols(nt),Ct=[],yr=0,Et=Object.keys(Zt).map(Number);yr<Et.length;yr+=1)Ct.push(yt[Et[yr]]);Ct.sort(Xn);for(var Qr=function(){var ni=An[Hr],Xi=ni.featureIndex.lookupSymbolFeatures(Zt[ni.bucketInstanceId],Re,ni.bucketIndex,ni.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,Ce);for(var wn in Xi){var Si=Ut[wn]=Ut[wn]||[],Ai=Xi[wn];Ai.sort(function(wi,li){var oi=ni.featureSortOrder;if(oi){var xo=oi.indexOf(wi.featureIndex);return oi.indexOf(li.featureIndex)-xo}return li.featureIndex-wi.featureIndex});for(var vi=0,ai=Ai;vi<ai.length;vi+=1)Si.push(ai[vi])}},Hr=0,An=Ct;Hr<An.length;Hr+=1)Qr();var Qn=function(ni){Ut[ni].forEach(function(Xi){var wn=Xi.feature,Si=Ze[Ce[ni].source].getFeatureState(wn.layer["source-layer"],wn.id);wn.source=wn.layer.source,wn.layer["source-layer"]&&(wn.sourceLayer=wn.layer["source-layer"]),wn.state=Si})};for(var Jn in Ut)Qn(Jn);return Ut}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_e)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var C=this.sourceCaches[h];return C?function(T,k){for(var D=T.getRenderableIds().map(function(Re){return T.getTileByID(Re)}),G=[],ee={},_e=0;_e<D.length;_e++){var Ee=D[_e],Ce=Ee.tileID.canonical.key;ee[Ce]||(ee[Ce]=!0,Ee.querySourceFeatures(G,k))}return G}(C,g):[]},d.prototype.addSourceType=function(h,g,C){return d.getSourceType(h)?C(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},C):C(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var C=this.light.getLight(),T=!1;for(var k in h)if(!y.deepEqual(h[k],C[k])){T=!0;break}if(T){var D={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(D)}},d.prototype._validate=function(h,g,C,T,k){return k===void 0&&(k={}),(!k||k.validate!==!1)&&Ts(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:C,styleSpec:y.styleSpec},T)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,C,T,k){k===void 0&&(k=!1);for(var D=!1,G=!1,ee={},_e=0,Ee=this._order;_e<Ee.length;_e+=1){var Ce=this._layers[Ee[_e]];if(Ce.type==="symbol"){if(!ee[Ce.source]){var Re=this.sourceCaches[Ce.source];ee[Ce.source]=Re.getRenderableIds(!0).map(function(yt){return Re.getTileByID(yt)}).sort(function(yt,Ut){return Ut.tileID.overscaledZ-yt.tileID.overscaledZ||(yt.tileID.isLessThan(Ut.tileID)?-1:1)})}var Ze=this.crossTileSymbolIndex.addLayer(Ce,ee[Ce.source],h.center.lng);D=D||Ze}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||C===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new za(h,this._order,k,g,C,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),G=!0),D&&this.pauseablePlacement.placement.setStale()),G||D)for(var nt=0,Fe=this._order;nt<Fe.length;nt+=1){var at=this._layers[Fe[nt]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,ee[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,C){this.imageManager.getImages(g.icons,C),this._updateTilesForChangedImages();var T=this.sourceCaches[g.source];T&&T.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,C){this.glyphManager.getGlyphs(g.stacks,C)},d.prototype.getResource=function(h,g,C){return y.makeRequest(g,C)},d}(y.Evented);ys.getSourceType=function(f){return nr[f]},ys.setSourceType=function(f,d){nr[f]=d},ys.registerForPluginStateChange=y.registerForPluginStateChange;var zi=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ia=qi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Hc=qi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yf=qi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Is=qi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),_f=qi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hl=qi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),el=qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),au=qi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ol=qi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=qi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Z=qi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),L=qi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ne=qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ke=qi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),st=qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ft=qi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Bt=qi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Sr=qi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Br=qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Hn=qi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Kn=qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),yi=qi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),$i=qi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ea=qi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),La=qi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function qi(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),C=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=T?T.concat(C):C,D={};return{fragmentSource:f=f.replace(h,function(G,ee,_e,Ee,Ce){return D[Ce]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
varying `+_e+" "+Ee+" "+Ce+`;
#else
uniform `+_e+" "+Ee+" u_"+Ce+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ce+`
    `+_e+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`}),vertexSource:d=d.replace(h,function(G,ee,_e,Ee,Ce){var Re=Ee==="float"?"vec2":"vec4",Ze=Ce.match(/color/)?"color":Re;return D[Ce]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
uniform lowp float u_`+Ce+`_t;
attribute `+_e+" "+Re+" a_"+Ce+`;
varying `+_e+" "+Ee+" "+Ce+`;
#else
uniform `+_e+" "+Ee+" u_"+Ce+`;
#endif
`:Ze==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+Ce+" = a_"+Ce+`;
#else
    `+_e+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+Ce+" = unpack_mix_"+Ze+"(a_"+Ce+", u_"+Ce+`_t);
#else
    `+_e+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
uniform lowp float u_`+Ce+`_t;
attribute `+_e+" "+Re+" a_"+Ce+`;
#else
uniform `+_e+" "+Ee+" u_"+Ce+`;
#endif
`:Ze==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+_e+" "+Ee+" "+Ce+" = a_"+Ce+`;
#else
    `+_e+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ce+`
    `+_e+" "+Ee+" "+Ce+" = unpack_mix_"+Ze+"(a_"+Ce+", u_"+Ce+`_t);
#else
    `+_e+" "+Ee+" "+Ce+" = u_"+Ce+`;
#endif
`}),staticAttributes:g,staticUniforms:k}}var _s=Object.freeze({__proto__:null,prelude:Ia,background:Hc,backgroundPattern:yf,circle:Is,clippingMask:_f,heatmap:hl,heatmapTexture:el,collisionBox:au,collisionCircle:Ol,debug:b,fill:M,fillOutline:Z,fillOutlinePattern:L,fillPattern:ne,fillExtrusion:ke,fillExtrusionPattern:st,hillshadePrepare:Ft,hillshade:Bt,line:Sr,lineGradient:Br,linePattern:Hn,lineSDF:Kn,raster:yi,symbolIcon:$i,symbolSDF:Ea,symbolTextAndIcon:La}),mu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function pl(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}mu.prototype.bind=function(f,d,h,g,C,T,k,D){this.context=f;for(var G=this.boundPaintVertexBuffers.length!==g.length,ee=0;!G&&ee<g.length;ee++)this.boundPaintVertexBuffers[ee]!==g[ee]&&(G=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!G&&this.boundIndexBuffer===C&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===k&&this.boundDynamicVertexBuffer2===D?(f.bindVertexArrayOES.set(this.vao),k&&k.bind(),C&&C.dynamicDraw&&C.bind(),D&&D.bind()):this.freshBind(d,h,g,C,T,k,D)},mu.prototype.freshBind=function(f,d,h,g,C,T,k){var D,G=f.numAttributes,ee=this.context,_e=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=k;else{D=ee.currentNumAttributes||0;for(var Ee=G;Ee<D;Ee++)_e.disableVertexAttribArray(Ee)}d.enableAttributes(_e,f);for(var Ce=0,Re=h;Ce<Re.length;Ce+=1)Re[Ce].enableAttributes(_e,f);T&&T.enableAttributes(_e,f),k&&k.enableAttributes(_e,f),d.bind(),d.setVertexAttribPointers(_e,f,C);for(var Ze=0,nt=h;Ze<nt.length;Ze+=1){var Fe=nt[Ze];Fe.bind(),Fe.setVertexAttribPointers(_e,f,C)}T&&(T.bind(),T.setVertexAttribPointers(_e,f,C)),g&&g.bind(),k&&(k.bind(),k.setVertexAttribPointers(_e,f,C)),ee.currentNumAttributes=G},mu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var xf=function(f,d,h,g,C,T){var k=f.gl;this.program=k.createProgram();for(var D=pl(h.staticAttributes),G=g?g.getBinderAttributes():[],ee=D.concat(G),_e=h.staticUniforms?pl(h.staticUniforms):[],Ee=g?g.getBinderUniforms():[],Ce=[],Re=0,Ze=_e.concat(Ee);Re<Ze.length;Re+=1){var nt=Ze[Re];Ce.indexOf(nt)<0&&Ce.push(nt)}var Fe=g?g.defines():[];T&&Fe.push("#define OVERDRAW_INSPECTOR;");var at=Fe.concat(Ia.fragmentSource,h.fragmentSource).join(`
`),yt=Fe.concat(Ia.vertexSource,h.vertexSource).join(`
`),Ut=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Ut,at),k.compileShader(Ut),k.attachShader(this.program,Ut);var Zt=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Zt,yt),k.compileShader(Zt),k.attachShader(this.program,Zt),this.attributes={};var Ct={};this.numAttributes=ee.length;for(var yr=0;yr<this.numAttributes;yr++)ee[yr]&&(k.bindAttribLocation(this.program,yr,ee[yr]),this.attributes[ee[yr]]=yr);k.linkProgram(this.program),k.deleteShader(Zt),k.deleteShader(Ut);for(var Et=0;Et<Ce.length;Et++){var Qr=Ce[Et];if(Qr&&!Ct[Qr]){var Hr=k.getUniformLocation(this.program,Qr);Hr&&(Ct[Qr]=Hr)}}this.fixedUniforms=C(f,Ct),this.binderUniforms=g?g.getUniforms(f,Ct):[]}}};function dl(f,d,h){var g=1/aa(h,1,d.transform.tileZoom),C=Math.pow(2,h.tileID.overscaledZ),T=h.tileSize*Math.pow(2,d.transform.tileZoom)/C,k=T*(h.tileID.canonical.x+h.tileID.wrap*C),D=T*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[k>>16,D>>16],u_pixel_coord_lower:[65535&k,65535&D]}}xf.prototype.draw=function(f,d,h,g,C,T,k,D,G,ee,_e,Ee,Ce,Re,Ze,nt){var Fe,at=f.gl;if(!this.failedToCreate){for(var yt in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(C),f.setCullFace(T),this.fixedUniforms)this.fixedUniforms[yt].set(k[yt]);Re&&Re.setUniforms(f,this.binderUniforms,Ee,{zoom:Ce});for(var Ut=(Fe={},Fe[at.LINES]=2,Fe[at.TRIANGLES]=3,Fe[at.LINE_STRIP]=1,Fe)[d],Zt=0,Ct=_e.get();Zt<Ct.length;Zt+=1){var yr=Ct[Zt],Et=yr.vaos||(yr.vaos={});(Et[D]||(Et[D]=new mu)).bind(f,this,G,Re?Re.getPaintVertexBuffers():[],ee,yr.vertexOffset,Ze,nt),at.drawElements(d,yr.primitiveLength*Ut,at.UNSIGNED_SHORT,yr.primitiveOffset*Ut*2)}}};var Wc=function(f,d,h,g){var C=d.style.light,T=C.properties.get("position"),k=[T.x,T.y,T.z],D=y.create$1();C.properties.get("anchor")==="viewport"&&y.fromRotation(D,-d.transform.angle),y.transformMat3(k,k,D);var G=C.properties.get("color");return{u_matrix:f,u_lightpos:k,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+h,u_opacity:g}},Nu=function(f,d,h,g,C,T,k){return y.extend(Wc(f,d,h,g),dl(T,d,k),{u_height_factor:-Math.pow(2,C.overscaledZ)/k.tileSize/8})},zu=function(f){return{u_matrix:f}},Zu=function(f,d,h,g){return y.extend(zu(f),dl(h,d,g))},yo=function(f,d){return{u_matrix:f,u_world:d}},th=function(f,d,h,g,C){return y.extend(Zu(f,d,h,g),{u_world:C})},Xc=function(f,d,h,g){var C,T,k=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var D=aa(h,1,k.zoom);C=!0,T=[D,D]}else C=!1,T=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:T}},xs=function(f,d,h){var g=aa(h,1,d.zoom),C=Math.pow(2,d.zoom-h.tileID.overscaledZ),T=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*C),d.pixelsToGLUnits[1]/(g*C)],u_overscale_factor:T}},bf=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},tl=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},ou=function(f){return{u_matrix:f}},rh=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:aa(d,1,h),u_intensity:g}},$s=function(f,d,h){var g=f.transform;return{u_matrix:Yc(f,d,h),u_ratio:1/aa(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ta=function(f,d,h,g){return y.extend($s(f,d,h),{u_image:0,u_image_height:g})},Dl=function(f,d,h,g){var C=f.transform,T=Uu(d,C);return{u_matrix:Yc(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/aa(d,1,C.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[T,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},Lh=function(f,d,h,g,C){var T=f.lineAtlas,k=Uu(d,f.transform),D=h.layout.get("line-cap")==="round",G=T.getDash(g.from,D),ee=T.getDash(g.to,D),_e=G.width*C.fromScale,Ee=ee.width*C.toScale;return y.extend($s(f,d,h),{u_patternscale_a:[k/_e,-G.height/2],u_patternscale_b:[k/Ee,-ee.height/2],u_sdfgamma:T.width/(256*Math.min(_e,Ee)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:ee.y,u_mix:C.t})};function Uu(f,d){return 1/aa(f,1,d.tileZoom)}function Yc(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var Sp=function(f,d,h,g,C){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(k=C.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(T=C.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Cp(C.paint.get("raster-hue-rotate"))};var T,k};function Cp(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var nh,$c=function(f,d,h,g,C,T,k,D,G,ee){var _e=C.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_pitch:_e.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:_e.width/_e.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:k,u_coord_matrix:D,u_is_text:+G,u_pitch_with_map:+g,u_texsize:ee,u_texture:0}},lc=function(f,d,h,g,C,T,k,D,G,ee,_e){var Ee=C.transform;return y.extend($c(f,d,h,g,C,T,k,D,G,ee),{u_gamma_scale:g?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+_e})},Fl=function(f,d,h,g,C,T,k,D,G,ee){return y.extend(lc(f,d,h,g,C,T,k,D,!0,G,!0),{u_texsize_icon:ee,u_texture_icon:1})},Bl=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},vl=function(f,d,h,g,C,T){return y.extend(function(k,D,G,ee){var _e=G.imageManager.getPattern(k.from.toString()),Ee=G.imageManager.getPattern(k.to.toString()),Ce=G.imageManager.getPixelSize(),Re=Ce.width,Ze=Ce.height,nt=Math.pow(2,ee.tileID.overscaledZ),Fe=ee.tileSize*Math.pow(2,G.transform.tileZoom)/nt,at=Fe*(ee.tileID.canonical.x+ee.tileID.wrap*nt),yt=Fe*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:_e.tl,u_pattern_br_a:_e.br,u_pattern_tl_b:Ee.tl,u_pattern_br_b:Ee.br,u_texsize:[Re,Ze],u_mix:D.t,u_pattern_size_a:_e.displaySize,u_pattern_size_b:Ee.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/aa(ee,1,G.transform.tileZoom),u_pixel_coord_upper:[at>>16,yt>>16],u_pixel_coord_lower:[65535&at,65535&yt]}}(g,T,h,C),{u_matrix:f,u_opacity:d})},ml={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function gl(f,d,h,g,C,T,k){for(var D=f.context,G=D.gl,ee=f.useProgram("collisionBox"),_e=[],Ee=0,Ce=0,Re=0;Re<g.length;Re++){var Ze=g[Re],nt=d.getTile(Ze),Fe=nt.getBucket(h);if(Fe){var at=Ze.posMatrix;C[0]===0&&C[1]===0||(at=f.translatePosMatrix(Ze.posMatrix,nt,C,T));var yt=k?Fe.textCollisionBox:Fe.iconCollisionBox,Ut=Fe.collisionCircleArray;if(Ut.length>0){var Zt=y.create(),Ct=at;y.mul(Zt,Fe.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(Zt,Zt,Fe.placementViewportMatrix),_e.push({circleArray:Ut,circleOffset:Ce,transform:Ct,invTransform:Zt}),Ce=Ee+=Ut.length/4}yt&&ee.draw(D,G.LINES,we.disabled,ze.disabled,f.colorModeForRenderPass(),_t.disabled,xs(at,f.transform,nt),h.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,f.transform.zoom,null,null,yt.collisionVertexBuffer)}}if(k&&_e.length){var yr=f.useProgram("collisionCircle"),Et=new y.StructArrayLayout2f1f2i16;Et.resize(4*Ee),Et._trim();for(var Qr=0,Hr=0,An=_e;Hr<An.length;Hr+=1)for(var Qn=An[Hr],Jn=0;Jn<Qn.circleArray.length/4;Jn++){var ni=4*Jn,Xi=Qn.circleArray[ni+0],wn=Qn.circleArray[ni+1],Si=Qn.circleArray[ni+2],Ai=Qn.circleArray[ni+3];Et.emplace(Qr++,Xi,wn,Si,Ai,0),Et.emplace(Qr++,Xi,wn,Si,Ai,1),Et.emplace(Qr++,Xi,wn,Si,Ai,2),Et.emplace(Qr++,Xi,wn,Si,Ai,3)}(!nh||nh.length<2*Ee)&&(nh=function(Ja){var Io=2*Ja,Wo=new y.StructArrayLayout3ui6;Wo.resize(Io),Wo._trim();for(var eo=0;eo<Io;eo++){var to=6*eo;Wo.uint16[to+0]=4*eo+0,Wo.uint16[to+1]=4*eo+1,Wo.uint16[to+2]=4*eo+2,Wo.uint16[to+3]=4*eo+2,Wo.uint16[to+4]=4*eo+3,Wo.uint16[to+5]=4*eo+0}return Wo}(Ee));for(var vi=D.createIndexBuffer(nh,!0),ai=D.createVertexBuffer(Et,y.collisionCircleLayout.members,!0),wi=0,li=_e;wi<li.length;wi+=1){var oi=li[wi],xo=bf(oi.transform,oi.invTransform,f.transform);yr.draw(D,G.TRIANGLES,we.disabled,ze.disabled,f.colorModeForRenderPass(),_t.disabled,xo,h.id,ai,vi,y.SegmentVector.simpleSegment(0,2*oi.circleOffset,oi.circleArray.length,oi.circleArray.length/2),null,f.transform.zoom,null,null,null)}ai.destroy(),vi.destroy()}}var su=y.identity(new Float32Array(16));function Ef(f,d,h,g,C,T){var k=y.getAnchorAlignment(f),D=-(k.horizontalAlign-.5)*d,G=-(k.verticalAlign-.5)*h,ee=y.evaluateVariableOffset(f,g);return new y.Point((D/C+ee[0])*T,(G/C+ee[1])*T)}function Sf(f,d,h,g,C,T,k,D,G,ee,_e){var Ee=f.text.placedSymbolArray,Ce=f.text.dynamicLayoutVertexArray,Re=f.icon.dynamicLayoutVertexArray,Ze={};Ce.clear();for(var nt=0;nt<Ee.length;nt++){var Fe=Ee.get(nt),at=Fe.hidden||!Fe.crossTileID||f.allowVerticalPlacement&&!Fe.placedOrientation?null:g[Fe.crossTileID];if(at){var yt=new y.Point(Fe.anchorX,Fe.anchorY),Ut=Fi(yt,h?D:k),Zt=sr(T.cameraToCenterDistance,Ut.signedDistanceFromCamera),Ct=C.evaluateSizeForFeature(f.textSizeData,ee,Fe)*Zt/y.ONE_EM;h&&(Ct*=f.tilePixelRatio/G);for(var yr=Ef(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,Ct),Et=h?Fi(yt.add(yr),k).point:Ut.point.add(d?yr.rotate(-T.angle):yr),Qr=f.allowVerticalPlacement&&Fe.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Hr=0;Hr<Fe.numGlyphs;Hr++)y.addDynamicAttributes(Ce,Et,Qr);_e&&Fe.associatedIconIndex>=0&&(Ze[Fe.associatedIconIndex]={shiftedAnchor:Et,angle:Qr})}else no(Fe.numGlyphs,Ce)}if(_e){Re.clear();for(var An=f.icon.placedSymbolArray,Qn=0;Qn<An.length;Qn++){var Jn=An.get(Qn);if(Jn.hidden)no(Jn.numGlyphs,Re);else{var ni=Ze[Qn];if(ni)for(var Xi=0;Xi<Jn.numGlyphs;Xi++)y.addDynamicAttributes(Re,ni.shiftedAnchor,ni.angle);else no(Jn.numGlyphs,Re)}}f.icon.dynamicLayoutVertexBuffer.updateData(Re)}f.text.dynamicLayoutVertexBuffer.updateData(Ce)}function Nl(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function yl(f,d,h,g,C,T,k,D,G,ee,_e,Ee){for(var Ce=f.context,Re=Ce.gl,Ze=f.transform,nt=D==="map",Fe=G==="map",at=nt&&h.layout.get("symbol-placement")!=="point",yt=nt&&!Fe&&!at,Ut=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Zt=!1,Ct=f.depthModeForSublayer(0,we.ReadOnly),yr=h.layout.get("text-variable-anchor"),Et=[],Qr=0,Hr=g;Qr<Hr.length;Qr+=1){var An=Hr[Qr],Qn=d.getTile(An),Jn=Qn.getBucket(h);if(Jn){var ni=C?Jn.text:Jn.icon;if(ni&&ni.segments.get().length){var Xi=ni.programConfigurations.get(h.id),wn=C||Jn.sdfIcons,Si=C?Jn.textSizeData:Jn.iconSizeData,Ai=Fe||Ze.pitch!==0,vi=f.useProgram(Nl(wn,C,Jn),Xi),ai=y.evaluateSizeForZoom(Si,Ze.zoom),wi=void 0,li=[0,0],oi=void 0,xo=void 0,Ja=null,Io=void 0;if(C)oi=Qn.glyphAtlasTexture,xo=Re.LINEAR,wi=Qn.glyphAtlasTexture.size,Jn.iconsInText&&(li=Qn.imageAtlasTexture.size,Ja=Qn.imageAtlasTexture,Io=Ai||f.options.rotating||f.options.zooming||Si.kind==="composite"||Si.kind==="camera"?Re.LINEAR:Re.NEAREST);else{var Wo=h.layout.get("icon-size").constantOr(0)!==1||Jn.iconsNeedLinear;oi=Qn.imageAtlasTexture,xo=wn||f.options.rotating||f.options.zooming||Wo||Ai?Re.LINEAR:Re.NEAREST,wi=Qn.imageAtlasTexture.size}var eo=aa(Qn,1,f.transform.zoom),to=Ji(An.posMatrix,Fe,nt,f.transform,eo),Ps=ia(An.posMatrix,Fe,nt,f.transform,eo),hs=yr&&Jn.hasTextData(),Gu=h.layout.get("icon-text-fit")!=="none"&&hs&&Jn.hasIconData();at&&je(Jn,An.posMatrix,f,C,to,Ps,Fe,ee);var Es=f.translatePosMatrix(An.posMatrix,Qn,T,k),Ls=at||C&&yr||Gu?su:to,Qs=f.translatePosMatrix(Ps,Qn,T,k,!0),xc=wn&&h.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ql={program:vi,buffers:ni,uniformValues:wn?Jn.iconsInText?Fl(Si.kind,ai,yt,Fe,f,Es,Ls,Qs,wi,li):lc(Si.kind,ai,yt,Fe,f,Es,Ls,Qs,C,wi,!0):$c(Si.kind,ai,yt,Fe,f,Es,Ls,Qs,C,wi),atlasTexture:oi,atlasTextureIcon:Ja,atlasInterpolation:xo,atlasInterpolationIcon:Io,isSDF:wn,hasHalo:xc};if(Ut&&Jn.canOverlap){Zt=!0;for(var Hu=0,il=ni.segments.get();Hu<il.length;Hu+=1){var bc=il[Hu];Et.push({segments:new y.SegmentVector([bc]),sortKey:bc.sortKey,state:ql})}}else Et.push({segments:ni.segments,sortKey:0,state:ql})}}}Zt&&Et.sort(function(wl,Xu){return wl.sortKey-Xu.sortKey});for(var Xo=0,Al=Et;Xo<Al.length;Xo+=1){var Wu=Al[Xo],ko=Wu.state;if(Ce.activeTexture.set(Re.TEXTURE0),ko.atlasTexture.bind(ko.atlasInterpolation,Re.CLAMP_TO_EDGE),ko.atlasTextureIcon&&(Ce.activeTexture.set(Re.TEXTURE1),ko.atlasTextureIcon&&ko.atlasTextureIcon.bind(ko.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),ko.isSDF){var al=ko.uniformValues;ko.hasHalo&&(al.u_is_halo=1,cc(ko.buffers,Wu.segments,h,f,ko.program,Ct,_e,Ee,al)),al.u_is_halo=0}cc(ko.buffers,Wu.segments,h,f,ko.program,Ct,_e,Ee,ko.uniformValues)}}function cc(f,d,h,g,C,T,k,D,G){var ee=g.context;C.draw(ee,ee.gl.TRIANGLES,T,k,D,_t.disabled,G,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function qc(f,d,h,g,C,T,k){var D,G,ee,_e,Ee,Ce=f.context.gl,Re=h.paint.get("fill-pattern"),Ze=Re&&Re.constantOr(1),nt=h.getCrossfadeParameters();k?(G=Ze&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=Ce.LINES):(G=Ze?"fillPattern":"fill",D=Ce.TRIANGLES);for(var Fe=0,at=g;Fe<at.length;Fe+=1){var yt=at[Fe],Ut=d.getTile(yt);if(!Ze||Ut.patternsLoaded()){var Zt=Ut.getBucket(h);if(Zt){var Ct=Zt.programConfigurations.get(h.id),yr=f.useProgram(G,Ct);Ze&&(f.context.activeTexture.set(Ce.TEXTURE0),Ut.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Ct.updatePaintBuffers(nt));var Et=Re.constantOr(null);if(Et&&Ut.imageAtlas){var Qr=Ut.imageAtlas,Hr=Qr.patternPositions[Et.to.toString()],An=Qr.patternPositions[Et.from.toString()];Hr&&An&&Ct.setConstantPatternPositions(Hr,An)}var Qn=f.translatePosMatrix(yt.posMatrix,Ut,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(k){_e=Zt.indexBuffer2,Ee=Zt.segments2;var Jn=[Ce.drawingBufferWidth,Ce.drawingBufferHeight];ee=G==="fillOutlinePattern"&&Ze?th(Qn,f,nt,Ut,Jn):yo(Qn,Jn)}else _e=Zt.indexBuffer,Ee=Zt.segments,ee=Ze?Zu(Qn,f,nt,Ut):zu(Qn);yr.draw(f.context,D,C,f.stencilModeForClipping(yt),T,_t.disabled,ee,h.id,Zt.layoutVertexBuffer,_e,Ee,h.paint,f.transform.zoom,Ct)}}}}function fc(f,d,h,g,C,T,k){for(var D=f.context,G=D.gl,ee=h.paint.get("fill-extrusion-pattern"),_e=ee.constantOr(1),Ee=h.getCrossfadeParameters(),Ce=h.paint.get("fill-extrusion-opacity"),Re=0,Ze=g;Re<Ze.length;Re+=1){var nt=Ze[Re],Fe=d.getTile(nt),at=Fe.getBucket(h);if(at){var yt=at.programConfigurations.get(h.id),Ut=f.useProgram(_e?"fillExtrusionPattern":"fillExtrusion",yt);_e&&(f.context.activeTexture.set(G.TEXTURE0),Fe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),yt.updatePaintBuffers(Ee));var Zt=ee.constantOr(null);if(Zt&&Fe.imageAtlas){var Ct=Fe.imageAtlas,yr=Ct.patternPositions[Zt.to.toString()],Et=Ct.patternPositions[Zt.from.toString()];yr&&Et&&yt.setConstantPatternPositions(yr,Et)}var Qr=f.translatePosMatrix(nt.posMatrix,Fe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Hr=h.paint.get("fill-extrusion-vertical-gradient"),An=_e?Nu(Qr,f,Hr,Ce,nt,Ee,Fe):Wc(Qr,f,Hr,Ce);Ut.draw(D,D.gl.TRIANGLES,C,T,k,_t.backCCW,An,h.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,h.paint,f.transform.zoom,yt)}}}function Cf(f,d,h,g,C,T){var k=f.context,D=k.gl,G=d.fbo;if(G){var ee=f.useProgram("hillshade");k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,G.colorAttachment.get());var _e=function(Ee,Ce,Re){var Ze=Re.paint.get("hillshade-shadow-color"),nt=Re.paint.get("hillshade-highlight-color"),Fe=Re.paint.get("hillshade-accent-color"),at=Re.paint.get("hillshade-illumination-direction")*(Math.PI/180);Re.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=Ee.transform.angle);var yt,Ut,Zt,Ct=!Ee.options.moving;return{u_matrix:Ee.transform.calculatePosMatrix(Ce.tileID.toUnwrapped(),Ct),u_image:0,u_latrange:(yt=Ce.tileID,Ut=Math.pow(2,yt.canonical.z),Zt=yt.canonical.y,[new y.MercatorCoordinate(0,Zt/Ut).toLngLat().lat,new y.MercatorCoordinate(0,(Zt+1)/Ut).toLngLat().lat]),u_light:[Re.paint.get("hillshade-exaggeration"),at],u_shadow:Ze,u_highlight:nt,u_accent:Fe}}(f,d,h);ee.draw(k,D.TRIANGLES,g,C,T,_t.disabled,_e,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function Ap(f,d,h,g,C,T){var k=f.context,D=k.gl,G=d.dem;if(G&&G.data){var ee=G.dim,_e=G.stride,Ee=G.getPixels();if(k.activeTexture.set(D.TEXTURE1),k.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(_e),d.demTexture){var Ce=d.demTexture;Ce.update(Ee,{premultiply:!1}),Ce.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(k,Ee,D.RGBA,{premultiply:!1}),d.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);k.activeTexture.set(D.TEXTURE0);var Re=d.fbo;if(!Re){var Ze=new y.Texture(k,{width:ee,height:ee,data:null},D.RGBA);Ze.bind(D.LINEAR,D.CLAMP_TO_EDGE),(Re=d.fbo=k.createFramebuffer(ee,ee,!0)).colorAttachment.set(Ze.texture)}k.bindFramebuffer.set(Re.framebuffer),k.viewport.set([0,0,ee,ee]),f.useProgram("hillshadePrepare").draw(k,D.TRIANGLES,g,C,T,_t.disabled,function(nt,Fe){var at=Fe.stride,yt=y.create();return y.ortho(yt,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(yt,yt,[0,-y.EXTENT,0]),{u_matrix:yt,u_image:1,u_dimension:[at,at],u_zoom:nt.overscaledZ,u_unpack:Fe.getUnpackVector()}}(d.tileID,G),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Af(f,d,h,g,C){var T=g.paint.get("raster-fade-duration");if(T>0){var k=y.browser.now(),D=(k-f.timeAdded)/T,G=d?(k-d.timeAdded)/T:-1,ee=h.getSource(),_e=C.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),Ee=!d||Math.abs(d.tileID.overscaledZ-_e)>Math.abs(f.tileID.overscaledZ-_e),Ce=Ee&&f.refreshedUponExpiration?1:y.clamp(Ee?D:1-G,0,1);return f.refreshedUponExpiration&&D>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-Ce}:{opacity:Ce,mix:0}}return{opacity:1,mix:0}}var _l=new y.Color(1,0,0,1),wf=new y.Color(0,1,0,1),ih=new y.Color(0,0,1,1),Vu=new y.Color(1,0,1,1),Rh=new y.Color(0,1,1,1);function Oh(f,d,h,g){zl(f,0,d+h/2,f.transform.width,h,g)}function Dh(f,d,h,g){zl(f,d-h/2,0,h,f.transform.height,g)}function zl(f,d,h,g,C,T){var k=f.context,D=k.gl;D.enable(D.SCISSOR_TEST),D.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,C*y.browser.devicePixelRatio),k.clear({color:T}),D.disable(D.SCISSOR_TEST)}function Fh(f,d,h){var g=f.context,C=g.gl,T=h.posMatrix,k=f.useProgram("debug"),D=we.disabled,G=ze.disabled,ee=f.colorModeForRenderPass();g.activeTexture.set(C.TEXTURE0),f.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),k.draw(g,C.LINE_STRIP,D,G,ee,_t.disabled,tl(T,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var _e=d.getTileByID(h.key).latestRawTileData,Ee=Math.floor((_e&&_e.byteLength||0)/1024),Ce=d.getTile(h).tileSize,Re=512/Math.min(Ce,512)*(h.overscaledZ/f.transform.zoom)*.5,Ze=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ze+=" => "+h.overscaledZ),function(nt,Fe){nt.initDebugOverlayCanvas();var at=nt.debugOverlayCanvas,yt=nt.context.gl,Ut=nt.debugOverlayCanvas.getContext("2d");Ut.clearRect(0,0,at.width,at.height),Ut.shadowColor="white",Ut.shadowBlur=2,Ut.lineWidth=1.5,Ut.strokeStyle="white",Ut.textBaseline="top",Ut.font="bold 36px Open Sans, sans-serif",Ut.fillText(Fe,5,5),Ut.strokeText(Fe,5,5),nt.debugOverlayTexture.update(at),nt.debugOverlayTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE)}(f,Ze+" "+Ee+"kb"),k.draw(g,C.TRIANGLES,D,G,rt.alphaBlended,_t.disabled,tl(T,y.Color.transparent,Re),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var ts={symbol:function(f,d,h,g,C){if(f.renderPass==="translucent"){var T=ze.disabled,k=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(D,G,ee,_e,Ee,Ce,Re){for(var Ze=G.transform,nt=Ee==="map",Fe=Ce==="map",at=0,yt=D;at<yt.length;at+=1){var Ut=yt[at],Zt=_e.getTile(Ut),Ct=Zt.getBucket(ee);if(Ct&&Ct.text&&Ct.text.segments.get().length){var yr=y.evaluateSizeForZoom(Ct.textSizeData,Ze.zoom),Et=aa(Zt,1,G.transform.zoom),Qr=Ji(Ut.posMatrix,Fe,nt,G.transform,Et),Hr=ee.layout.get("icon-text-fit")!=="none"&&Ct.hasIconData();if(yr){var An=Math.pow(2,Ze.zoom-Zt.tileID.overscaledZ);Sf(Ct,nt,Fe,Re,y.symbolSize,Ze,Qr,Ut.posMatrix,An,yr,Hr)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),C),h.paint.get("icon-opacity").constantOr(1)!==0&&yl(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),T,k),h.paint.get("text-opacity").constantOr(1)!==0&&yl(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),T,k),d.map.showCollisionBoxes&&(gl(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),gl(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var C=h.paint.get("circle-opacity"),T=h.paint.get("circle-stroke-width"),k=h.paint.get("circle-stroke-opacity"),D=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(C.constantOr(1)!==0||T.constantOr(1)!==0&&k.constantOr(1)!==0){for(var G=f.context,ee=G.gl,_e=f.depthModeForSublayer(0,we.ReadOnly),Ee=ze.disabled,Ce=f.colorModeForRenderPass(),Re=[],Ze=0;Ze<g.length;Ze++){var nt=g[Ze],Fe=d.getTile(nt),at=Fe.getBucket(h);if(at){var yt=at.programConfigurations.get(h.id),Ut={programConfiguration:yt,program:f.useProgram("circle",yt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:Xc(f,nt,Fe,h)};if(D)for(var Zt=0,Ct=at.segments.get();Zt<Ct.length;Zt+=1){var yr=Ct[Zt];Re.push({segments:new y.SegmentVector([yr]),sortKey:yr.sortKey,state:Ut})}else Re.push({segments:at.segments,sortKey:0,state:Ut})}}D&&Re.sort(function(Qn,Jn){return Qn.sortKey-Jn.sortKey});for(var Et=0,Qr=Re;Et<Qr.length;Et+=1){var Hr=Qr[Et],An=Hr.state;An.program.draw(G,ee.TRIANGLES,_e,Ee,Ce,_t.disabled,An.uniformValues,h.id,An.layoutVertexBuffer,An.indexBuffer,Hr.segments,h.paint,f.transform.zoom,An.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var C=f.context,T=C.gl,k=ze.disabled,D=new rt([T.ONE,T.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Re,Ze,nt){var Fe=Re.gl;Re.activeTexture.set(Fe.TEXTURE1),Re.viewport.set([0,0,Ze.width/4,Ze.height/4]);var at=nt.heatmapFbo;if(at)Fe.bindTexture(Fe.TEXTURE_2D,at.colorAttachment.get()),Re.bindFramebuffer.set(at.framebuffer);else{var yt=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,yt),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),at=nt.heatmapFbo=Re.createFramebuffer(Ze.width/4,Ze.height/4,!1),function(Ut,Zt,Ct,yr){var Et=Ut.gl;Et.texImage2D(Et.TEXTURE_2D,0,Et.RGBA,Zt.width/4,Zt.height/4,0,Et.RGBA,Ut.extRenderToTextureHalfFloat?Ut.extTextureHalfFloat.HALF_FLOAT_OES:Et.UNSIGNED_BYTE,null),yr.colorAttachment.set(Ct)}(Re,Ze,yt,at)}})(C,f,h),C.clear({color:y.Color.transparent});for(var G=0;G<g.length;G++){var ee=g[G];if(!d.hasRenderableParent(ee)){var _e=d.getTile(ee),Ee=_e.getBucket(h);if(Ee){var Ce=Ee.programConfigurations.get(h.id);f.useProgram("heatmap",Ce).draw(C,T.TRIANGLES,we.disabled,k,D,_t.disabled,rh(ee.posMatrix,_e,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,f.transform.zoom,Ce)}}}C.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(Re,Ze){var nt=Re.context,Fe=nt.gl,at=Ze.heatmapFbo;if(at){nt.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,at.colorAttachment.get()),nt.activeTexture.set(Fe.TEXTURE1);var yt=Ze.colorRampTexture;yt||(yt=Ze.colorRampTexture=new y.Texture(nt,Ze.colorRamp,Fe.RGBA)),yt.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Re.useProgram("heatmapTexture").draw(nt,Fe.TRIANGLES,we.disabled,ze.disabled,Re.colorModeForRenderPass(),_t.disabled,function(Ut,Zt,Ct,yr){var Et=y.create();y.ortho(Et,0,Ut.width,Ut.height,0,0,1);var Qr=Ut.context.gl;return{u_matrix:Et,u_world:[Qr.drawingBufferWidth,Qr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Zt.paint.get("heatmap-opacity")}}(Re,Ze),Ze.id,Re.viewportBuffer,Re.quadTriangleIndexBuffer,Re.viewportSegments,Ze.paint,Re.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var C=h.paint.get("line-opacity"),T=h.paint.get("line-width");if(C.constantOr(1)!==0&&T.constantOr(1)!==0)for(var k=f.depthModeForSublayer(0,we.ReadOnly),D=f.colorModeForRenderPass(),G=h.paint.get("line-dasharray"),ee=h.paint.get("line-pattern"),_e=ee.constantOr(1),Ee=h.paint.get("line-gradient"),Ce=h.getCrossfadeParameters(),Re=_e?"linePattern":G?"lineSDF":Ee?"lineGradient":"line",Ze=f.context,nt=Ze.gl,Fe=!0,at=0,yt=g;at<yt.length;at+=1){var Ut=yt[at],Zt=d.getTile(Ut);if(!_e||Zt.patternsLoaded()){var Ct=Zt.getBucket(h);if(Ct){var yr=Ct.programConfigurations.get(h.id),Et=f.context.program.get(),Qr=f.useProgram(Re,yr),Hr=Fe||Qr.program!==Et,An=ee.constantOr(null);if(An&&Zt.imageAtlas){var Qn=Zt.imageAtlas,Jn=Qn.patternPositions[An.to.toString()],ni=Qn.patternPositions[An.from.toString()];Jn&&ni&&yr.setConstantPatternPositions(Jn,ni)}var Xi=_e?Dl(f,Zt,h,Ce):G?Lh(f,Zt,h,G,Ce):Ee?Ta(f,Zt,h,Ct.lineClipsArray.length):$s(f,Zt,h);if(_e)Ze.activeTexture.set(nt.TEXTURE0),Zt.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),yr.updatePaintBuffers(Ce);else if(G&&(Hr||f.lineAtlas.dirty))Ze.activeTexture.set(nt.TEXTURE0),f.lineAtlas.bind(Ze);else if(Ee){var wn=Ct.gradients[h.id],Si=wn.texture;if(h.gradientVersion!==wn.version){var Ai=256;if(h.stepInterpolant){var vi=d.getSource().maxzoom,ai=Ut.canonical.z===vi?Math.ceil(1<<f.transform.maxZoom-Ut.canonical.z):1;Ai=y.clamp(y.nextPowerOfTwo(Ct.maxLineLength/y.EXTENT*1024*ai),256,Ze.maxTextureSize)}wn.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ai,image:wn.gradient||void 0,clips:Ct.lineClipsArray}),wn.texture?wn.texture.update(wn.gradient):wn.texture=new y.Texture(Ze,wn.gradient,nt.RGBA),wn.version=h.gradientVersion,Si=wn.texture}Ze.activeTexture.set(nt.TEXTURE0),Si.bind(h.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}Qr.draw(Ze,nt.TRIANGLES,k,f.stencilModeForClipping(Ut),D,_t.disabled,Xi,h.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,h.paint,f.transform.zoom,yr,Ct.layoutVertexBuffer2),Fe=!1}}}}},fill:function(f,d,h,g){var C=h.paint.get("fill-color"),T=h.paint.get("fill-opacity");if(T.constantOr(1)!==0){var k=f.colorModeForRenderPass(),D=h.paint.get("fill-pattern"),G=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&C.constantOr(y.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===G){var ee=f.depthModeForSublayer(1,f.renderPass==="opaque"?we.ReadWrite:we.ReadOnly);qc(f,d,h,g,ee,k,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var _e=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,we.ReadOnly);qc(f,d,h,g,_e,k,!0)}}},"fill-extrusion":function(f,d,h,g){var C=h.paint.get("fill-extrusion-opacity");if(C!==0&&f.renderPass==="translucent"){var T=new we(f.context.gl.LEQUAL,we.ReadWrite,f.depthRangeFor3D);if(C!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))fc(f,d,h,g,T,ze.disabled,rt.disabled),fc(f,d,h,g,T,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var k=f.colorModeForRenderPass();fc(f,d,h,g,T,ze.disabled,k)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var C=f.context,T=f.depthModeForSublayer(0,we.ReadOnly),k=f.colorModeForRenderPass(),D=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],G=D[0],ee=0,_e=D[1];ee<_e.length;ee+=1){var Ee=_e[ee],Ce=d.getTile(Ee);Ce.needsHillshadePrepare&&f.renderPass==="offscreen"?Ap(f,Ce,h,T,ze.disabled,k):f.renderPass==="translucent"&&Cf(f,Ce,h,T,G[Ee.overscaledZ],k)}C.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var C=f.context,T=C.gl,k=d.getSource(),D=f.useProgram("raster"),G=f.colorModeForRenderPass(),ee=k instanceof Je?[{},g]:f.stencilConfigForOverlap(g),_e=ee[0],Ee=ee[1],Ce=Ee[Ee.length-1].overscaledZ,Re=!f.options.moving,Ze=0,nt=Ee;Ze<nt.length;Ze+=1){var Fe=nt[Ze],at=f.depthModeForSublayer(Fe.overscaledZ-Ce,h.paint.get("raster-opacity")===1?we.ReadWrite:we.ReadOnly,T.LESS),yt=d.getTile(Fe),Ut=f.transform.calculatePosMatrix(Fe.toUnwrapped(),Re);yt.registerFadeDuration(h.paint.get("raster-fade-duration"));var Zt=d.findLoadedParent(Fe,0),Ct=Af(yt,Zt,d,h,f.transform),yr=void 0,Et=void 0,Qr=h.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;C.activeTexture.set(T.TEXTURE0),yt.texture.bind(Qr,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(T.TEXTURE1),Zt?(Zt.texture.bind(Qr,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),yr=Math.pow(2,Zt.tileID.overscaledZ-yt.tileID.overscaledZ),Et=[yt.tileID.canonical.x*yr%1,yt.tileID.canonical.y*yr%1]):yt.texture.bind(Qr,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);var Hr=Sp(Ut,Et||[0,0],yr||1,Ct,h);k instanceof Je?D.draw(C,T.TRIANGLES,at,ze.disabled,G,_t.disabled,Hr,h.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments):D.draw(C,T.TRIANGLES,at,_e[Fe.overscaledZ],G,_t.disabled,Hr,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(C!==0){var T=f.context,k=T.gl,D=f.transform,G=D.tileSize,ee=h.paint.get("background-pattern");if(!f.isPatternMissing(ee)){var _e=!ee&&g.a===1&&C===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===_e){var Ee=ze.disabled,Ce=f.depthModeForSublayer(0,_e==="opaque"?we.ReadWrite:we.ReadOnly),Re=f.colorModeForRenderPass(),Ze=f.useProgram(ee?"backgroundPattern":"background"),nt=D.coveringTiles({tileSize:G});ee&&(T.activeTexture.set(k.TEXTURE0),f.imageManager.bind(f.context));for(var Fe=h.getCrossfadeParameters(),at=0,yt=nt;at<yt.length;at+=1){var Ut=yt[at],Zt=f.transform.calculatePosMatrix(Ut.toUnwrapped()),Ct=ee?vl(Zt,C,f,ee,{tileID:Ut,tileSize:G},Fe):Bl(Zt,C,g);Ze.draw(T,k.TRIANGLES,Ce,Ee,Re,_t.disabled,Ct,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)Fh(f,d,h[g])},custom:function(f,d,h){var g=f.context,C=h.implementation;if(f.renderPass==="offscreen"){var T=C.prerender;T&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),T.call(C,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(ze.disabled);var k=C.renderingMode==="3d"?new we(f.context.gl.LEQUAL,we.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,we.ReadOnly);g.setDepthMode(k),C.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},Qa=function(f,d){this.context=new be(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=We.maxUnderzooming+We.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ws,this.gpuTimers={}};Qa.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},Qa.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,zi.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,zi.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,He.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var C=new y.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(C,zi.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var T=new y.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(T);var k=new y.StructArrayLayout3ui6;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(k),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var D=this.context.gl;this.stencilClearMode=new ze({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)},Qa.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,we.disabled,this.stencilClearMode,rt.disabled,_t.disabled,ou(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Qa.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(rt.disabled),h.setDepthMode(we.disabled);var C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var T=0,k=d;T<k.length;T+=1){var D=k[T],G=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;C.draw(h,g.TRIANGLES,we.disabled,new ze({func:g.ALWAYS,mask:0},G,255,g.KEEP,g.KEEP,g.REPLACE),rt.disabled,_t.disabled,ou(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Qa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new ze({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},Qa.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new ze({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},Qa.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(G,ee){return ee.overscaledZ-G.overscaledZ}),C=g[g.length-1].overscaledZ,T=g[0].overscaledZ-C+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();for(var k={},D=0;D<T;D++)k[D+C]=new ze({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=T,[k,g]}return[(d={},d[C]=ze.disabled,d),g]},Qa.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new rt([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?rt.unblended:rt.alphaBlended},Qa.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return we.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new we(h||this.context.gl.LEQUAL,d,[g,g])},Qa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Qa.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,C=this.style.sourceCaches;for(var T in C){var k=C[T];k.used&&k.prepare(this.context)}var D,G,ee={},_e={},Ee={};for(var Ce in C){var Re=C[Ce];ee[Ce]=Re.getVisibleCoordinates(),_e[Ce]=ee[Ce].slice().reverse(),Ee[Ce]=Re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ze=0;Ze<g.length;Ze++)if(this.style._layers[g[Ze]].is3D()){this.opaquePassCutoff=Ze;break}this.renderPass="offscreen";for(var nt=0,Fe=g;nt<Fe.length;nt+=1){var at=this.style._layers[Fe[nt]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var yt=_e[at.source];(at.type==="custom"||yt.length)&&this.renderLayer(this,C[at.source],at,yt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Ut=this.style._layers[g[this.currentLayer]],Zt=C[Ut.source],Ct=ee[Ut.source];this._renderTileClippingMasks(Ut,Ct),this.renderLayer(this,Zt,Ut,Ct)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var yr=this.style._layers[g[this.currentLayer]],Et=C[yr.source],Qr=(yr.type==="symbol"?Ee:_e)[yr.source];this._renderTileClippingMasks(yr,ee[yr.source]),this.renderLayer(this,Et,yr,Qr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Hr){Hr.source&&!Hr.isHidden(h.transform.zoom)&&(Hr.source!==(G&&G.id)&&(G=h.style.sourceCaches[Hr.source]),(!D||D.getSource().maxzoom<G.getSource().maxzoom)&&(D=G))}),D&&ts.debug(this,D,D.getVisibleCoordinates())),this.options.showPadding&&function(Hr){var An=Hr.transform.padding;Oh(Hr,Hr.transform.height-(An.top||0),3,_l),Oh(Hr,An.bottom||0,3,wf),Dh(Hr,An.left||0,3,ih),Dh(Hr,Hr.transform.width-(An.right||0),3,Vu);var Qn=Hr.transform.centerPoint;(function(Jn,ni,Xi,wn){zl(Jn,ni-1,Xi-10,2,20,wn),zl(Jn,ni-10,Xi-1,20,2,wn)})(Hr,Qn.x,Hr.transform.height-Qn.y,Rh)}(this),this.context.setDefault()},Qa.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),ts[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Qa.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Qa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},Qa.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},Qa.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],C=this.context.extTimerQuery,T=C.getQueryObjectEXT(g.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(g.query),d[h]=T}return d},Qa.prototype.translatePosMatrix=function(f,d,h,g,C){if(!h[0]&&!h[1])return f;var T=C?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(T){var k=Math.sin(T),D=Math.cos(T);h=[h[0]*D-h[1]*k,h[0]*k+h[1]*D]}var G=[C?h[0]:aa(d,h[0],this.transform.zoom),C?h[1]:aa(d,h[1],this.transform.zoom),0],ee=new Float32Array(16);return y.translate(ee,f,G),ee},Qa.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},Qa.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},Qa.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},Qa.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new xf(this.context,f,_s[f],d,ml[f],this._showOverdrawInspector)),this.cache[h]},Qa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Qa.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},Qa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Qa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ca=function(f,d){this.points=f,this.planes=d};ca.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(k){return y.transformMat4([],k,f)}).map(function(k){return y.scale$1([],k,1/k[3]/d*g)}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(k){var D=y.sub([],C[k[0]],C[k[1]]),G=y.sub([],C[k[2]],C[k[1]]),ee=y.normalize([],y.cross([],D,G)),_e=-y.dot(ee,C[k[1]]);return ee.concat(_e)});return new ca(C,T)};var Zl=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Zl.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),C=0;C<d.length;C++)h[C]=d[C]?this.min[C]:this.center[C],g[C]=d[C]?this.center[C]:this.max[C];return g[2]=this.max[2],new Zl(h,g)},Zl.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},Zl.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},Zl.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var C=f.planes[g],T=0,k=0;k<d.length;k++)T+=y.dot$1(C,d[k])>=0;if(T===0)return 0;T!==d.length&&(h=!1)}if(h)return 2;for(var D=0;D<3;D++){for(var G=Number.MAX_VALUE,ee=-Number.MAX_VALUE,_e=0;_e<f.points.length;_e++){var Ee=f.points[_e][D]-this.min[D];G=Math.min(G,Ee),ee=Math.max(ee,Ee)}if(ee<0||G>this.max[D]-this.min[D])return 0}return 1};var rl=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};rl.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},rl.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},rl.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},rl.prototype.clone=function(){return new rl(this.top,this.bottom,this.left,this.right)},rl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Wi=function(f,d,h,g,C){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=C===void 0||C,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new rl,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ra={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Wi.prototype.clone=function(){var f=new Wi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},Ra.minZoom.get=function(){return this._minZoom},Ra.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},Ra.maxZoom.get=function(){return this._maxZoom},Ra.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},Ra.minPitch.get=function(){return this._minPitch},Ra.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},Ra.maxPitch.get=function(){return this._maxPitch},Ra.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},Ra.renderWorldCopies.get=function(){return this._renderWorldCopies},Ra.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},Ra.worldSize.get=function(){return this.tileSize*this.scale},Ra.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ra.size.get=function(){return new y.Point(this.width,this.height)},Ra.bearing.get=function(){return-this.angle/Math.PI*180},Ra.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ra.pitch.get=function(){return this._pitch/Math.PI*180},Ra.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Ra.fov.get=function(){return this._fov/Math.PI*180},Ra.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},Ra.zoom.get=function(){return this._zoom},Ra.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Ra.center.get=function(){return this._center},Ra.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},Ra.padding.get=function(){return this._edgeInsets.toJSON()},Ra.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},Ra.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Wi.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},Wi.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},Wi.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},Wi.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),C=this.pointCoordinate(new y.Point(this.width,this.height)),T=this.pointCoordinate(new y.Point(0,this.height)),k=Math.floor(Math.min(h.x,g.x,C.x,T.x)),D=Math.floor(Math.max(h.x,g.x,C.x,T.x)),G=k-1;G<=D+1;G++)G!==0&&d.push(new y.UnwrappedTileID(G,f));return d},Wi.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,d),T=[C*g.x,C*g.y,0],k=ca.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),D=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(D=d);var G=function(Hr){return{aabb:new Zl([Hr*C,0,0],[(Hr+1)*C,C,0]),zoom:0,x:0,y:0,wrap:Hr,fullyVisible:!1}},ee=[],_e=[],Ee=d,Ce=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var Re=1;Re<=3;Re++)ee.push(G(-Re)),ee.push(G(Re));for(ee.push(G(0));ee.length>0;){var Ze=ee.pop(),nt=Ze.x,Fe=Ze.y,at=Ze.fullyVisible;if(!at){var yt=Ze.aabb.intersects(k);if(yt===0)continue;at=yt===2}var Ut=Ze.aabb.distanceX(T),Zt=Ze.aabb.distanceY(T),Ct=Math.max(Math.abs(Ut),Math.abs(Zt));if(Ze.zoom===Ee||Ct>3+(1<<Ee-Ze.zoom)-2&&Ze.zoom>=D)_e.push({tileID:new y.OverscaledTileID(Ze.zoom===Ee?Ce:Ze.zoom,Ze.wrap,Ze.zoom,nt,Fe),distanceSq:y.sqrLen([T[0]-.5-nt,T[1]-.5-Fe])});else for(var yr=0;yr<4;yr++){var Et=(nt<<1)+yr%2,Qr=(Fe<<1)+(yr>>1);ee.push({aabb:Ze.aabb.quadrant(yr),zoom:Ze.zoom+1,x:Et,y:Qr,wrap:Ze.wrap,fullyVisible:at})}}return _e.sort(function(Hr,An){return Hr.distanceSq-An.distanceSq}).map(function(Hr){return Hr.tileID})},Wi.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},Ra.unmodified.get=function(){return this._unmodified},Wi.prototype.zoomScale=function(f){return Math.pow(2,f)},Wi.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},Wi.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},Wi.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},Ra.point.get=function(){return this.project(this.center)},Wi.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(f),T=new y.MercatorCoordinate(C.x-(h.x-g.x),C.y-(h.y-g.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())},Wi.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},Wi.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},Wi.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},Wi.prototype.coordinateLocation=function(f){return f.toLngLat()},Wi.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],C=h[3],T=d[1]/g,k=h[1]/C,D=d[2]/g,G=h[2]/C,ee=D===G?0:(0-D)/(G-D);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/C,ee)/this.worldSize,y.number(T,k,ee)/this.worldSize)},Wi.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},Wi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Wi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Wi.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Wi.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var C=f.canonical,T=this.worldSize/this.zoomScale(C.z),k=C.x+Math.pow(2,C.z)*f.wrap,D=y.identity(new Float64Array(16));return y.translate(D,D,[k*T,C.y*T,0]),y.scale(D,D,[T/y.EXTENT,T/y.EXTENT,1]),y.multiply(D,d?this.alignedProjMatrix:this.projMatrix,D),g[h]=new Float32Array(D),g[h]},Wi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Wi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,C=-90,T=90,k=-180,D=180,G=this.size,ee=this._unmodified;if(this.latRange){var _e=this.latRange;C=y.mercatorYfromLat(_e[1])*this.worldSize,f=(T=y.mercatorYfromLat(_e[0])*this.worldSize)-C<G.y?G.y/(T-C):0}if(this.lngRange){var Ee=this.lngRange;k=y.mercatorXfromLng(Ee[0])*this.worldSize,d=(D=y.mercatorXfromLng(Ee[1])*this.worldSize)-k<G.x?G.x/(D-k):0}var Ce=this.point,Re=Math.max(d||0,f||0);if(Re)return this.center=this.unproject(new y.Point(d?(D+k)/2:Ce.x,f?(T+C)/2:Ce.y)),this.zoom+=this.scaleZoom(Re),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var Ze=Ce.y,nt=G.y/2;Ze-nt<C&&(g=C+nt),Ze+nt>T&&(g=T-nt)}if(this.lngRange){var Fe=Ce.x,at=G.x/2;Fe-at<k&&(h=k+at),Fe+at>D&&(h=D-at)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:Ce.x,g!==void 0?g:Ce.y))),this._unmodified=ee,this._constraining=!1}},Wi.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),C=this.point,T=C.x,k=C.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),G=this.height/50,ee=new Float64Array(16);y.perspective(ee,this._fov,this.width/this.height,G,D),ee[8]=2*-f.x/this.width,ee[9]=2*f.y/this.height,y.scale(ee,ee,[1,-1,1]),y.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),y.rotateX(ee,ee,this._pitch),y.rotateZ(ee,ee,this.angle),y.translate(ee,ee,[-T,-k,0]),this.mercatorMatrix=y.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),y.scale(ee,ee,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=y.invert([],this.projMatrix);var _e=this.width%2/2,Ee=this.height%2/2,Ce=Math.cos(this.angle),Re=Math.sin(this.angle),Ze=T-Math.round(T)+Ce*_e+Re*Ee,nt=k-Math.round(k)+Ce*Ee+Re*_e,Fe=new Float64Array(ee);if(y.translate(Fe,Fe,[Ze>.5?Ze-1:Ze,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Fe,ee=y.create(),y.scale(ee,ee,[this.width/2,-this.height/2,1]),y.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=y.create(),y.scale(ee,ee,[1,-1,1]),y.translate(ee,ee,[-1,-1,0]),y.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Wi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},Wi.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},Wi.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,C=d.x,T=d.y,k=0,D=f;k<D.length;k+=1){var G=D[k];h=Math.min(h,G.x),g=Math.min(g,G.y),C=Math.max(C,G.x),T=Math.max(T,G.y)}return[new y.Point(h,g),new y.Point(C,g),new y.Point(C,T),new y.Point(h,T),new y.Point(h,g)]},Object.defineProperties(Wi.prototype,Ra);var Fs=function(f){var d,h,g,C;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,C=function(){g=null,h&&(d(),g=setTimeout(C,300),h=!1)},function(){return h=!0,g||C(),g})};Fs.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Fs.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Fs.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,g),T=Math.round(d.lng*C)/C,k=Math.round(d.lat*C)/C,D=this._map.getBearing(),G=this._map.getPitch(),ee="";if(ee+=f?"/"+T+"/"+k+"/"+h:h+"/"+k+"/"+T,(D||G)&&(ee+="/"+Math.round(10*D)/10),G&&(ee+="/"+Math.round(G)),this._hashName){var _e=this._hashName,Ee=!1,Ce=y.window.location.hash.slice(1).split("&").map(function(Re){var Ze=Re.split("=")[0];return Ze===_e?(Ee=!0,Ze+"="+ee):Re}).filter(function(Re){return Re});return Ee||Ce.push(_e+"="+ee),"#"+Ce.join("&")}return"#"+ee},Fs.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},Fs.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},Fs.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var Kc={linearity:.3,easing:y.bezier(0,0,.3,1)},Ni=y.extend({deceleration:2500,maxSpeed:1400},Kc),ks=y.extend({deceleration:20,maxSpeed:1400},Kc),wu=y.extend({deceleration:1e3,maxSpeed:360},Kc),Ul=y.extend({deceleration:1e3,maxSpeed:90},Kc),Qc=function(f){this._map=f,this.clear()};function hc(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Tu(f,d,h){var g=h.maxSpeed,C=h.linearity,T=h.deceleration,k=y.clamp(f*C/(d/1e3),-g,g),D=Math.abs(k)/(T*C);return{easing:h.easing,duration:1e3*D,amount:k*(D/2)}}Qc.prototype.clear=function(){this._inertiaBuffer=[]},Qc.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},Qc.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},Qc.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var C=g[h].settings;d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround)}var T=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,k={};if(d.pan.mag()){var D=Tu(d.pan.mag(),T,y.extend({},Ni,f||{}));k.offset=d.pan.mult(D.amount/d.pan.mag()),k.center=this._map.transform.center,hc(k,D)}if(d.zoom){var G=Tu(d.zoom,T,ks);k.zoom=this._map.transform.zoom+G.amount,hc(k,G)}if(d.bearing){var ee=Tu(d.bearing,T,wu);k.bearing=this._map.transform.bearing+y.clamp(ee.amount,-179,179),hc(k,ee)}if(d.pitch){var _e=Tu(d.pitch,T,Ul);k.pitch=this._map.transform.pitch+_e.amount,hc(k,_e)}if(k.zoom||k.bearing){var Ee=d.pinchAround===void 0?d.around:d.pinchAround;k.around=Ee?this._map.unproject(Ee):this._map.getCenter()}return this.clear(),y.extend(k,{noMoveStart:!0})}};var Ho=function(f){function d(g,C,T,k){k===void 0&&(k={});var D=W.mousePos(C.getCanvasContainer(),T),G=C.unproject(D);f.call(this,g,y.extend({point:D,lngLat:G,originalEvent:T},k)),this._defaultPrevented=!1,this.target=C}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),pc=function(f){function d(g,C,T){var k=g==="touchend"?T.changedTouches:T.touches,D=W.touchPos(C.getCanvasContainer(),k),G=D.map(function(Ee){return C.unproject(Ee)}),ee=D.reduce(function(Ee,Ce,Re,Ze){return Ee.add(Ce.div(Ze.length))},new y.Point(0,0)),_e=C.unproject(ee);f.call(this,g,{points:D,point:ee,lngLats:G,lngLat:_e,originalEvent:T}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Vl=function(f){function d(g,C,T){f.call(this,g,{originalEvent:T}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Mo=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};Mo.prototype.reset=function(){delete this._mousedownPos},Mo.prototype.wheel=function(f){return this._firePreventable(new Vl(f.type,this._map,f))},Mo.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Ho(f.type,this._map,f))},Mo.prototype.mouseup=function(f){this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.dblclick=function(f){return this._firePreventable(new Ho(f.type,this._map,f))},Mo.prototype.mouseover=function(f){this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.mouseout=function(f){this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.touchstart=function(f){return this._firePreventable(new pc(f.type,this._map,f))},Mo.prototype.touchmove=function(f){this._map.fire(new pc(f.type,this._map,f))},Mo.prototype.touchend=function(f){this._map.fire(new pc(f.type,this._map,f))},Mo.prototype.touchcancel=function(f){this._map.fire(new pc(f.type,this._map,f))},Mo.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},Mo.prototype.isEnabled=function(){return!0},Mo.prototype.isActive=function(){return!1},Mo.prototype.enable=function(){},Mo.prototype.disable=function(){};var Fn=function(f){this._map=f};Fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fn.prototype.mousemove=function(f){this._map.fire(new Ho(f.type,this._map,f))},Fn.prototype.mousedown=function(){this._delayContextMenu=!0},Fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ho("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Ho(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},Fn.prototype.isEnabled=function(){return!0},Fn.prototype.isActive=function(){return!1},Fn.prototype.enable=function(){},Fn.prototype.disable=function(){};var ho=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function Oa(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}ho.prototype.isEnabled=function(){return!!this._enabled},ho.prototype.isActive=function(){return!!this._active},ho.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ho.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ho.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(W.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},ho.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var C=Math.min(g.x,h.x),T=Math.max(g.x,h.x),k=Math.min(g.y,h.y),D=Math.max(g.y,h.y);W.setTransform(this._box,"translate("+C+"px,"+k+"px)"),this._box.style.width=T-C+"px",this._box.style.height=D-k+"px"}}},ho.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,C=d;if(this.reset(),W.suppressClick(),g.x!==C.x||g.y!==C.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(T){return T.fitScreenCoordinates(g,C,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},ho.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},ho.prototype.blur=function(){this.reset()},ho.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},ho.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var xl=function(f){this.reset(),this.numTouches=f.numTouches};xl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},xl.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var C=new y.Point(0,0),T=0,k=g;T<k.length;T+=1)C._add(k[T]);return C.div(g.length)}(d),this.touches=Oa(h,d)))},xl.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=Oa(h,d);for(var C in this.touches){var T=g[C];(!T||T.dist(this.touches[C])>30)&&(this.aborted=!0)}}},xl.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var uu=function(f){this.singleTap=new xl(f),this.numTaps=f.numTaps,this.reset()};uu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},uu.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},uu.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},uu.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var C=f.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(C&&T||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var qs=function(){this._zoomIn=new uu({numTouches:1,numTaps:2}),this._zoomOut=new uu({numTouches:2,numTaps:1}),this.reset()};qs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},qs.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},qs.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},qs.prototype.touchend=function(f,d,h){var g=this,C=this._zoomIn.touchend(f,d,h),T=this._zoomOut.touchend(f,d,h);return C?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(C)},{originalEvent:f})}}):T?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(T)},{originalEvent:f})}}):void 0},qs.prototype.touchcancel=function(){this.reset()},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active};var Tf={0:1,2:2},dn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};dn.prototype.blur=function(){this.reset()},dn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},dn.prototype._correctButton=function(f,d){return!1},dn.prototype._move=function(f,d){return{}},dn.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=W.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},dn.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,C){var T=Tf[C];return g.buttons===void 0||(g.buttons&T)!==T}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},dn.prototype.mouseupWindow=function(f){this._lastPoint&&W.mouseButton(f)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},dn.prototype.enable=function(){this._enabled=!0},dn.prototype.disable=function(){this._enabled=!1,this.reset()},dn.prototype.isEnabled=function(){return this._enabled},dn.prototype.isActive=function(){return this._active};var dc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(dn),jl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var C=.8*(g.x-h.x);if(C)return this._active=!0,{bearingDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(dn),nl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var C=-.5*(g.y-h.y);if(C)return this._active=!0,{pitchDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(dn),Va=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};Va.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},Va.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},Va.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},Va.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},Va.prototype.touchcancel=function(){this.reset()},Va.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=Oa(h,d),C=new y.Point(0,0),T=new y.Point(0,0),k=0;for(var D in g){var G=g[D],ee=this._touches[D];ee&&(C._add(G),T._add(G.sub(ee)),k++,g[D]=G)}if(this._touches=g,!(k<this._minTouches)&&T.mag()){var _e=T.div(k);if(this._sum._add(_e),!(this._sum.mag()<this._clickTolerance))return{around:C.div(k),panDelta:_e}}},Va.prototype.enable=function(){this._enabled=!0},Va.prototype.disable=function(){this._enabled=!1,this.reset()},Va.prototype.isEnabled=function(){return this._enabled},Va.prototype.isActive=function(){return this._active};var Bs=function(){this.reset()};function vc(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function ju(f,d){return Math.log(f/d)/Math.LN2}Bs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Bs.prototype._start=function(f){},Bs.prototype._move=function(f,d,h){return{}},Bs.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Bs.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,C=g[1],T=vc(h,d,g[0]),k=vc(h,d,C);if(T&&k){var D=this._aroundCenter?null:T.add(k).div(2);return this._move([T,k],D,f)}}},Bs.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,C=g[1],T=vc(h,d,g[0]),k=vc(h,d,C);T&&k||(this._active&&W.suppressClick(),this.reset())}},Bs.prototype.touchcancel=function(){this.reset()},Bs.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Bs.prototype.disable=function(){this._enabled=!1,this.reset()},Bs.prototype.isEnabled=function(){return this._enabled},Bs.prototype.isActive=function(){return this._active};var Ns=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var C=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(ju(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ju(this._distance,C),pinchAround:g}},d}(Bs);function gu(f,d){return 180*f.angleWith(d)/Math.PI}var Mf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var C=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:gu(this._vector,C),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,C=gu(h,this._startVector);return Math.abs(C)<g},d}(Bs);function Jc(f){return Math.abs(f.y)>Math.abs(f.x)}var If=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Jc(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,C){var T=h[0].sub(this._lastPoints[0]),k=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(T,k,C.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(T.y+k.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,C){if(this._valid!==void 0)return this._valid;var T=h.mag()>=2,k=g.mag()>=2;if(T||k){if(!T||!k)return this._firstMove===void 0&&(this._firstMove=C),C-this._firstMove<100&&void 0;var D=h.y>0==g.y>0;return Jc(h)&&Jc(g)&&D}},d}(Bs),ah={panStep:100,bearingStep:15,pitchStep:10},lu=function(){var f=ah;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function bs(f){return f*(2-f)}lu.prototype.blur=function(){this.reset()},lu.prototype.reset=function(){this._active=!1},lu.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,C=0,T=0,k=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),T=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),T=1);break;case 38:f.shiftKey?C=1:(f.preventDefault(),k=-1);break;case 40:f.shiftKey?C=-1:(f.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(g=0,C=0),{cameraAnimation:function(D){var G=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:bs,zoom:h?Math.round(G)+h*(f.shiftKey?2:1):G,bearing:D.getBearing()+g*d._bearingStep,pitch:D.getPitch()+C*d._pitchStep,offset:[-T*d._panStep,-k*d._panStep],center:D.getCenter()},{originalEvent:f})}}}},lu.prototype.enable=function(){this._enabled=!0},lu.prototype.disable=function(){this._enabled=!1,this.reset()},lu.prototype.isEnabled=function(){return this._enabled},lu.prototype.isActive=function(){return this._active},lu.prototype.disableRotation=function(){this._rotationDisabled=!0},lu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(f){this._defaultZoomRate=f},Oi.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},Oi.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},Oi.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=W.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var C=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(C*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var T,k=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,D=this._startZoom,G=this._easing,ee=!1;if(this._type==="wheel"&&D&&G){var _e=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Ee=G(_e);T=y.number(D,k,Ee),_e<1?this._frameId||(this._frameId=!0):ee=!0}else T=k,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:T-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,C=h.easing(g+.01)-h.easing(g),T=.27/Math.sqrt(C*C+1e-4)*.01,k=Math.sqrt(.0729-T*T);d=y.bezier(T,k,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1};var Mu=function(f,d){this._clickZoom=f,this._tapZoom=d};Mu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Mu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Mu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Mu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var yu=function(){this.reset()};yu.prototype.reset=function(){this._active=!1},yu.prototype.blur=function(){this.reset()},yu.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},yu.prototype.enable=function(){this._enabled=!0},yu.prototype.disable=function(){this._enabled=!1,this.reset()},yu.prototype.isEnabled=function(){return this._enabled},yu.prototype.isActive=function(){return this._active};var ls=function(){this._tap=new uu({numTouches:1,numTaps:1}),this.reset()};ls.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ls.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},ls.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],C=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(f,d,h)},ls.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},ls.prototype.touchcancel=function(){this.reset()},ls.prototype.enable=function(){this._enabled=!0},ls.prototype.disable=function(){this._enabled=!1,this.reset()},ls.prototype.isEnabled=function(){return this._enabled},ls.prototype.isActive=function(){return this._active};var bl=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};bl.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},bl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},bl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},bl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var El=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};El.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},El.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},El.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},El.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var zs=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};zs.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},zs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},zs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},zs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},zs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},zs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Zs=function(f){return f.zoom||f.drag||f.pitch||f.rotate},cu=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function $n(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var Un=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qc(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,C=this._listeners;g<C.length;g+=1){var T=C[g],k=T[0];W.addEventListener(k,T[1],k===y.window.document?this.handleWindowEvent:this.handleEvent,T[2])}};Un.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];W.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},Un.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new Mo(d,f));var g=d.boxZoom=new ho(d,f);this._add("boxZoom",g);var C=new qs,T=new yu;d.doubleClickZoom=new Mu(T,C),this._add("tapZoom",C),this._add("clickZoom",T);var k=new ls;this._add("tapDragZoom",k);var D=d.touchPitch=new If;this._add("touchPitch",D);var G=new jl(f),ee=new nl(f);d.dragRotate=new El(f,G,ee),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var _e=new dc(f),Ee=new Va(f);d.dragPan=new bl(h,_e,Ee),this._add("mousePan",_e),this._add("touchPan",Ee,["touchZoom","touchRotate"]);var Ce=new Mf,Re=new Ns;d.touchZoomRotate=new zs(h,Re,Ce,k),this._add("touchRotate",Ce,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]);var Ze=d.scrollZoom=new Oi(d,this);this._add("scrollZoom",Ze,["mousePan"]);var nt=d.keyboard=new lu;this._add("keyboard",nt),this._add("blockableMapEvent",new Fn(d));for(var Fe=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Fe<at.length;Fe+=1){var yt=at[Fe];f.interactive&&f[yt]&&d[yt].enable(f[yt])}},Un.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},Un.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},Un.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},Un.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Un.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Un.prototype.isMoving=function(){return Boolean(Zs(this._eventsInProgress))||this.isZooming()},Un.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},Un.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},Un.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var C=g[h];this._el.contains(C.target)&&d.push(C)}return d},Un.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},C={},T={},k=f.touches?this._getMapTouches(f.touches):void 0,D=k?W.touchPos(this._el,k):W.mousePos(this._el,f),G=0,ee=this._handlers;G<ee.length;G+=1){var _e=ee[G],Ee=_e.handlerName,Ce=_e.handler,Re=_e.allowed;if(Ce.isEnabled()){var Ze=void 0;this._blockedByActive(T,Re,Ee)?Ce.reset():Ce[d||f.type]&&(Ze=Ce[d||f.type](f,D,k),this.mergeHandlerResult(g,C,Ze,Ee,h),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||Ce.isActive())&&(T[Ee]=Ce)}}var nt={};for(var Fe in this._previousActiveHandlers)T[Fe]||(nt[Fe]=h);this._previousActiveHandlers=T,(Object.keys(nt).length||$n(g))&&(this._changes.push([g,C,nt]),this._triggerRenderFrame()),(Object.keys(T).length||$n(g))&&this._map._stop(!0),this._updatingCamera=!1;var at=g.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))},Un.prototype.mergeHandlerResult=function(f,d,h,g,C){if(h){y.extend(f,h);var T={handlerName:g,originalEvent:h.originalEvent||C};h.zoomDelta!==void 0&&(d.zoom=T),h.panDelta!==void 0&&(d.drag=T),h.pitchDelta!==void 0&&(d.pitch=T),h.bearingDelta!==void 0&&(d.rotate=T)}},Un.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,C=this._changes;g<C.length;g+=1){var T=C[g],k=T[0],D=T[1],G=T[2];k.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(k.panDelta)),k.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+k.zoomDelta),k.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+k.bearingDelta),k.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+k.pitchDelta),k.around!==void 0&&(f.around=k.around),k.pinchAround!==void 0&&(f.pinchAround=k.pinchAround),k.noInertia&&(f.noInertia=k.noInertia),y.extend(d,D),y.extend(h,G)}this._updateMapTransform(f,d,h),this._changes=[]},Un.prototype._updateMapTransform=function(f,d,h){var g=this._map,C=g.transform;if(!$n(f))return this._fireEvents(d,h,!0);var T=f.panDelta,k=f.zoomDelta,D=f.bearingDelta,G=f.pitchDelta,ee=f.around,_e=f.pinchAround;_e!==void 0&&(ee=_e),g._stop(!0),ee=ee||g.transform.centerPoint;var Ee=C.pointLocation(T?ee.sub(T):ee);D&&(C.bearing+=D),G&&(C.pitch+=G),k&&(C.zoom+=k),C.setLocationAtPoint(Ee,ee),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},Un.prototype._fireEvents=function(f,d,h){var g=this,C=Zs(this._eventsInProgress),T=Zs(f),k={};for(var D in f)this._eventsInProgress[D]||(k[D+"start"]=f[D].originalEvent),this._eventsInProgress[D]=f[D];for(var G in!C&&T&&this._fireEvent("movestart",T.originalEvent),k)this._fireEvent(G,k[G]);for(var ee in T&&this._fireEvent("move",T.originalEvent),f)this._fireEvent(ee,f[ee].originalEvent);var _e,Ee={};for(var Ce in this._eventsInProgress){var Re=this._eventsInProgress[Ce],Ze=Re.handlerName,nt=Re.originalEvent;this._handlersById[Ze].isActive()||(delete this._eventsInProgress[Ce],Ee[Ce+"end"]=_e=d[Ze]||nt)}for(var Fe in Ee)this._fireEvent(Fe,Ee[Fe]);var at=Zs(this._eventsInProgress);if(h&&(C||T)&&!at){this._updatingCamera=!0;var yt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ut=function(Zt){return Zt!==0&&-g._bearingSnap<Zt&&Zt<g._bearingSnap};yt?(Ut(yt.bearing||this._map.getBearing())&&(yt.bearing=0),this._map.easeTo(yt,{originalEvent:_e})):(this._map.fire(new y.Event("moveend",{originalEvent:_e})),Ut(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Un.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},Un.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new cu("renderFrame",{timeStamp:d})),f._applyChanges()})},Un.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var kf=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,C){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),C)},d.prototype.panTo=function(h,g,C){return this.easeTo(y.extend({center:h},g),C)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,C){return this.easeTo(y.extend({zoom:h},g),C)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,C){return this.easeTo(y.extend({bearing:h},g),C)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var C=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),C,g)},d.prototype._cameraForBoxAndBearing=function(h,g,C,T){var k={top:0,bottom:0,right:0,left:0};if(typeof(T=y.extend({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){var D=T.padding;T.padding={top:D,bottom:D,right:D,left:D}}T.padding=y.extend(k,T.padding);var G=this.transform,ee=G.padding,_e=G.project(y.LngLat.convert(h)),Ee=G.project(y.LngLat.convert(g)),Ce=_e.rotate(-C*Math.PI/180),Re=Ee.rotate(-C*Math.PI/180),Ze=new y.Point(Math.max(Ce.x,Re.x),Math.max(Ce.y,Re.y)),nt=new y.Point(Math.min(Ce.x,Re.x),Math.min(Ce.y,Re.y)),Fe=Ze.sub(nt),at=(G.width-(ee.left+ee.right+T.padding.left+T.padding.right))/Fe.x,yt=(G.height-(ee.top+ee.bottom+T.padding.top+T.padding.bottom))/Fe.y;if(!(yt<0||at<0)){var Ut=Math.min(G.scaleZoom(G.scale*Math.min(at,yt)),T.maxZoom),Zt=typeof T.offset.x=="number"?new y.Point(T.offset.x,T.offset.y):y.Point.convert(T.offset),Ct=new y.Point((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(C*Math.PI/180),yr=Zt.add(Ct).mult(G.scale/G.zoomScale(Ut));return{center:G.unproject(_e.add(Ee).div(2).sub(yr)),zoom:Ut,bearing:C}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,C){return this._fitInternal(this.cameraForBounds(h,g),g,C)},d.prototype.fitScreenCoordinates=function(h,g,C,T,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),C,T),T,k)},d.prototype._fitInternal=function(h,g,C){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,C):this.flyTo(g,C)):this},d.prototype.jumpTo=function(h,g){this.stop();var C=this.transform,T=!1,k=!1,D=!1;return"zoom"in h&&C.zoom!==+h.zoom&&(T=!0,C.zoom=+h.zoom),h.center!==void 0&&(C.center=y.LngLat.convert(h.center)),"bearing"in h&&C.bearing!==+h.bearing&&(k=!0,C.bearing=+h.bearing),"pitch"in h&&C.pitch!==+h.pitch&&(D=!0,C.pitch=+h.pitch),h.padding==null||C.isPaddingEqual(h.padding)||(C.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),T&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),k&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),D&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var C=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var T=this.transform,k=this.getZoom(),D=this.getBearing(),G=this.getPitch(),ee=this.getPadding(),_e="zoom"in h?+h.zoom:k,Ee="bearing"in h?this._normalizeBearing(h.bearing,D):D,Ce="pitch"in h?+h.pitch:G,Re="padding"in h?h.padding:T.padding,Ze=y.Point.convert(h.offset),nt=T.centerPoint.add(Ze),Fe=T.pointLocation(nt),at=y.LngLat.convert(h.center||Fe);this._normalizeCenter(at);var yt,Ut,Zt=T.project(Fe),Ct=T.project(at).sub(Zt),yr=T.zoomScale(_e-k);h.around&&(yt=y.LngLat.convert(h.around),Ut=T.locationPoint(yt));var Et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_e!==k,this._rotating=this._rotating||D!==Ee,this._pitching=this._pitching||Ce!==G,this._padding=!T.isPaddingEqual(Re),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,Et),this._ease(function(Qr){if(C._zooming&&(T.zoom=y.number(k,_e,Qr)),C._rotating&&(T.bearing=y.number(D,Ee,Qr)),C._pitching&&(T.pitch=y.number(G,Ce,Qr)),C._padding&&(T.interpolatePadding(ee,Re,Qr),nt=T.centerPoint.add(Ze)),yt)T.setLocationAtPoint(yt,Ut);else{var Hr=T.zoomScale(T.zoom-k),An=_e>k?Math.min(2,yr):Math.max(.5,yr),Qn=Math.pow(An,1-Qr),Jn=T.unproject(Zt.add(Ct.mult(Qr*Qn)).mult(Hr));T.setLocationAtPoint(T.renderWorldCopies?Jn.wrap():Jn,nt)}C._fireMoveEvents(g)},function(Qr){C._afterEase(g,Qr)},h),this},d.prototype._prepareEase=function(h,g,C){C===void 0&&(C={}),this._moving=!0,g||C.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!C.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!C.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!C.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var C=this._zooming,T=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new y.Event("zoomend",h)),T&&this.fire(new y.Event("rotateend",h)),k&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var C=this;if(!h.essential&&y.browser.prefersReducedMotion){var T=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(T,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var k=this.transform,D=this.getZoom(),G=this.getBearing(),ee=this.getPitch(),_e=this.getPadding(),Ee="zoom"in h?y.clamp(+h.zoom,k.minZoom,k.maxZoom):D,Ce="bearing"in h?this._normalizeBearing(h.bearing,G):G,Re="pitch"in h?+h.pitch:ee,Ze="padding"in h?h.padding:k.padding,nt=k.zoomScale(Ee-D),Fe=y.Point.convert(h.offset),at=k.centerPoint.add(Fe),yt=k.pointLocation(at),Ut=y.LngLat.convert(h.center||yt);this._normalizeCenter(Ut);var Zt=k.project(yt),Ct=k.project(Ut).sub(Zt),yr=h.curve,Et=Math.max(k.width,k.height),Qr=Et/nt,Hr=Ct.mag();if("minZoom"in h){var An=y.clamp(Math.min(h.minZoom,D,Ee),k.minZoom,k.maxZoom),Qn=Et/k.zoomScale(An-D);yr=Math.sqrt(Qn/Hr*2)}var Jn=yr*yr;function ni(li){var oi=(Qr*Qr-Et*Et+(li?-1:1)*Jn*Jn*Hr*Hr)/(2*(li?Qr:Et)*Jn*Hr);return Math.log(Math.sqrt(oi*oi+1)-oi)}function Xi(li){return(Math.exp(li)-Math.exp(-li))/2}function wn(li){return(Math.exp(li)+Math.exp(-li))/2}var Si=ni(0),Ai=function(li){return wn(Si)/wn(Si+yr*li)},vi=function(li){return Et*((wn(Si)*(Xi(oi=Si+yr*li)/wn(oi))-Xi(Si))/Jn)/Hr;var oi},ai=(ni(1)-Si)/yr;if(Math.abs(Hr)<1e-6||!isFinite(ai)){if(Math.abs(Et-Qr)<1e-6)return this.easeTo(h,g);var wi=Qr<Et?-1:1;ai=Math.abs(Math.log(Qr/Et))/yr,vi=function(){return 0},Ai=function(li){return Math.exp(wi*yr*li)}}return h.duration="duration"in h?+h.duration:1e3*ai/("screenSpeed"in h?+h.screenSpeed/yr:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=G!==Ce,this._pitching=Re!==ee,this._padding=!k.isPaddingEqual(Ze),this._prepareEase(g,!1),this._ease(function(li){var oi=li*ai,xo=1/Ai(oi);k.zoom=li===1?Ee:D+k.scaleZoom(xo),C._rotating&&(k.bearing=y.number(G,Ce,li)),C._pitching&&(k.pitch=y.number(ee,Re,li)),C._padding&&(k.interpolatePadding(_e,Ze,li),at=k.centerPoint.add(Fe));var Ja=li===1?Ut:k.unproject(Zt.add(Ct.mult(vi(oi))).mult(xo));k.setLocationAtPoint(k.renderWorldCopies?Ja.wrap():Ja,at),C._fireMoveEvents(g)},function(){return C._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var C=this._onEaseEnd;delete this._onEaseEnd,C.call(this,g)}if(!h){var T=this.handlers;T&&T.stop(!1)}return this},d.prototype._ease=function(h,g,C){C.animate===!1||C.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=C,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var C=Math.abs(h-g);return Math.abs(h-360-g)<C&&(h-=360),Math.abs(h+360-g)<C&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var C=h.lng-g.center.lng;h.lng+=C>180?-360:C<-180?360:0}},d}(y.Evented),rs=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};rs.prototype.getDefaultPosition=function(){return"bottom-right"},rs.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},rs.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},rs.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},rs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},rs.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,C,T){return C.value&&(g+=C.key+"="+C.value+(T<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},rs.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},rs.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(D){return typeof D!="string"?"":D})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var C=h[g];if(C.used){var T=C.getSource();T.attribution&&f.indexOf(T.attribution)<0&&f.push(T.attribution)}}f.sort(function(D,G){return D.length-G.length});var k=(f=f.filter(function(D,G){for(var ee=G+1;ee<f.length;ee++)if(f[ee].indexOf(D)>=0)return!1;return!0})).join(" | ");k!==this._attribHTML&&(this._attribHTML=k,f.length?(this._innerContainer.innerHTML=k,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},rs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Iu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};Iu.prototype.onAdd=function(f){this._map=f,this._container=W.create("div","mapboxgl-ctrl");var d=W.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Iu.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Iu.prototype.getDefaultPosition=function(){return"bottom-left"},Iu.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Iu.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},Iu.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var cs=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};cs.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},cs.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var C=g[h];if(C.id===f)return void(C.cancelled=!0)}},cs.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var C=g[h];if(!C.cancelled&&(C.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},cs.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var _u={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Pf=y.window.HTMLImageElement,ef=y.window.HTMLElement,fa=y.window.ImageBitmap,Da={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},tf=function(f){function d(g){var C=this;if((g=y.extend({},Da,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var T=new Wi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,T,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new cs,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},_u,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof ef))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return C._update(!1)}),this.on("moveend",function(){return C._update(!1)}),this.on("zoom",function(){return C._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Un(this,g),this._hash=g.hash&&new Fs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new rs({customAttribution:g.customAttribution})),this.addControl(new Iu,g.logoPosition),this.on("style.load",function(){C.transform.unmodified&&C.jumpTo(C.style.stylesheet)}),this.on("data",function(k){C._update(k.dataType==="style"),C.fire(new y.Event(k.dataType+"data",k))}),this.on("dataloading",function(k){C.fire(new y.Event(k.dataType+"dataloading",k))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,C){if(C===void 0&&(C=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var T=g.onAdd(this);this._controls.push(g);var k=this._controlPositions[C];return C.indexOf("bottom")!==-1?k.insertBefore(T,k.firstChild):k.appendChild(T),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var C=this._controls.indexOf(g);return C>-1&&this._controls.splice(C,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var C=this._containerDimensions(),T=C[0],k=C[1];if(T===this.transform.width&&k===this.transform.height)return this;this._resizeCanvas(T,k),this.transform.resize(T,k),this.painter.resize(T,k);var D=!this._moving;return D&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),D&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,C,T){var k,D=this;if(g==="mouseenter"||g==="mouseover"){var G=!1;return{layer:C,listener:T,delegates:{mousemove:function(_e){var Ee=D.getLayer(C)?D.queryRenderedFeatures(_e.point,{layers:[C]}):[];Ee.length?G||(G=!0,T.call(D,new Ho(g,D,_e.originalEvent,{features:Ee}))):G=!1},mouseout:function(){G=!1}}}}if(g==="mouseleave"||g==="mouseout"){var ee=!1;return{layer:C,listener:T,delegates:{mousemove:function(_e){(D.getLayer(C)?D.queryRenderedFeatures(_e.point,{layers:[C]}):[]).length?ee=!0:ee&&(ee=!1,T.call(D,new Ho(g,D,_e.originalEvent)))},mouseout:function(_e){ee&&(ee=!1,T.call(D,new Ho(g,D,_e.originalEvent)))}}}}return{layer:C,listener:T,delegates:(k={},k[g]=function(_e){var Ee=D.getLayer(C)?D.queryRenderedFeatures(_e.point,{layers:[C]}):[];Ee.length&&(_e.features=Ee,T.call(D,_e),delete _e.features)},k)}},d.prototype.on=function(g,C,T){if(T===void 0)return f.prototype.on.call(this,g,C);var k=this._createDelegatedListener(g,C,T);for(var D in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(k),k.delegates)this.on(D,k.delegates[D]);return this},d.prototype.once=function(g,C,T){if(T===void 0)return f.prototype.once.call(this,g,C);var k=this._createDelegatedListener(g,C,T);for(var D in k.delegates)this.once(D,k.delegates[D]);return this},d.prototype.off=function(g,C,T){var k=this;return T===void 0?f.prototype.off.call(this,g,C):(this._delegatedListeners&&this._delegatedListeners[g]&&function(D){for(var G=D[g],ee=0;ee<G.length;ee++){var _e=G[ee];if(_e.layer===C&&_e.listener===T){for(var Ee in _e.delegates)k.off(Ee,_e.delegates[Ee]);return G.splice(ee,1),k}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,C){if(!this.style)return[];var T;if(C!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(C=g,g=void 0),C=C||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")T=[y.Point.convert(g)];else{var k=y.Point.convert(g[0]),D=y.Point.convert(g[1]);T=[k,new y.Point(D.x,k.y),D,new y.Point(k.x,D.y),k]}return this.style.queryRenderedFeatures(T,C,this.transform)},d.prototype.querySourceFeatures=function(g,C){return this.style.querySourceFeatures(g,C)},d.prototype.setStyle=function(g,C){return(C=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},C)).diff!==!1&&C.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,C),this):(this._localIdeographFontFamily=C.localIdeographFontFamily,this._updateStyle(g,C))},d.prototype._getUIString=function(g){var C=this._locale[g];if(C==null)throw new Error("Missing UI string '"+g+"'");return C},d.prototype._updateStyle=function(g,C){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new ys(this,C||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,C){var T=this;if(typeof g=="string"){var k=this._requestManager.normalizeStyleURL(g),D=this._requestManager.transformRequest(k,y.ResourceType.Style);y.getJSON(D,function(G,ee){G?T.fire(new y.ErrorEvent(G)):ee&&T._updateDiff(ee,C)})}else typeof g=="object"&&this._updateDiff(g,C)},d.prototype._updateDiff=function(g,C){try{this.style.setState(g)&&this._update(!0)}catch(T){y.warnOnce("Unable to perform style diff: "+(T.message||T.error||T)+".  Rebuilding the style from scratch."),this._updateStyle(g,C)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,C){return this._lazyInitEmptyStyle(),this.style.addSource(g,C),this._update(!0)},d.prototype.isSourceLoaded=function(g){var C=this.style&&this.style.sourceCaches[g];if(C!==void 0)return C.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var C in g){var T=g[C]._tiles;for(var k in T){var D=T[k];if(D.state!=="loaded"&&D.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,C,T){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,C,T)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,C,T){T===void 0&&(T={});var k=T.pixelRatio;k===void 0&&(k=1);var D=T.sdf;D===void 0&&(D=!1);var G=T.stretchX,ee=T.stretchY,_e=T.content;if(this._lazyInitEmptyStyle(),C instanceof Pf||fa&&C instanceof fa){var Ee=y.browser.getImageData(C);this.style.addImage(g,{data:new y.RGBAImage({width:Ee.width,height:Ee.height},Ee.data),pixelRatio:k,stretchX:G,stretchY:ee,content:_e,sdf:D,version:0})}else{if(C.width===void 0||C.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ce=C;this.style.addImage(g,{data:new y.RGBAImage({width:C.width,height:C.height},new Uint8Array(C.data)),pixelRatio:k,stretchX:G,stretchY:ee,content:_e,sdf:D,version:0,userImage:Ce}),Ce.onAdd&&Ce.onAdd(this,g)}},d.prototype.updateImage=function(g,C){var T=this.style.getImage(g);if(!T)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var k=C instanceof Pf||fa&&C instanceof fa?y.browser.getImageData(C):C,D=k.width,G=k.height,ee=k.data;return D===void 0||G===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):D!==T.data.width||G!==T.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(T.data.replace(ee,!(C instanceof Pf||fa&&C instanceof fa)),void this.style.updateImage(g,T))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,C){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),C)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,C){return this._lazyInitEmptyStyle(),this.style.addLayer(g,C),this._update(!0)},d.prototype.moveLayer=function(g,C){return this.style.moveLayer(g,C),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,C,T){return this.style.setLayerZoomRange(g,C,T),this._update(!0)},d.prototype.setFilter=function(g,C,T){return T===void 0&&(T={}),this.style.setFilter(g,C,T),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,C,T,k){return k===void 0&&(k={}),this.style.setPaintProperty(g,C,T,k),this._update(!0)},d.prototype.getPaintProperty=function(g,C){return this.style.getPaintProperty(g,C)},d.prototype.setLayoutProperty=function(g,C,T,k){return k===void 0&&(k={}),this.style.setLayoutProperty(g,C,T,k),this._update(!0)},d.prototype.getLayoutProperty=function(g,C){return this.style.getLayoutProperty(g,C)},d.prototype.setLight=function(g,C){return C===void 0&&(C={}),this._lazyInitEmptyStyle(),this.style.setLight(g,C),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,C){return this.style.setFeatureState(g,C),this._update()},d.prototype.removeFeatureState=function(g,C){return this.style.removeFeatureState(g,C),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,C=0;return this._container&&(g=this._container.clientWidth||400,C=this._container.clientHeight||300),[g,C]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var C=this._canvasContainer=W.create("div","mapboxgl-canvas-container",g);this._interactive&&C.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",C),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var T=this._containerDimensions();this._resizeCanvas(T[0],T[1]);var k=this._controlContainer=W.create("div","mapboxgl-control-container",g),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){D[G]=W.create("div","mapboxgl-ctrl-"+G,k)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,C){var T=y.browser.devicePixelRatio||1;this._canvas.width=T*g,this._canvas.height=T*C,this._canvas.style.width=g+"px",this._canvas.style.height=C+"px"},d.prototype._setupPainter=function(){var g=y.extend({},Se.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),C=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);C?(this.painter=new Qa(C,this.transform),y.webpSupported.testSupport(C)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var C,T=this,k=0,D=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(C=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,C),k=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,_e=y.browser.now();this.style.zoomHistory.update(ee,_e);var Ee=new y.EvaluationParameters(ee,{now:_e,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ce=Ee.crossFadingFactor();Ce===1&&Ce===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Ce),this.style.update(Ee)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Re=y.browser.now()-k;D.endQueryEXT(D.TIME_ELAPSED_EXT,C),setTimeout(function(){var Fe=D.getQueryObjectEXT(C,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(C),T.fire(new y.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:Fe}))},50)}if(this.listens("gpu-timing-layer")){var Ze=this.painter.collectGpuTimers();setTimeout(function(){var Fe=T.painter.queryGpuTimers(Ze);T.fire(new y.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,C=this._controls;g<C.length;g+=1)C[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var T=this.painter.context.gl.getExtension("WEBGL_lose_context");T&&T.loseContext(),Gl(this._canvasContainer),Gl(this._controlContainer),Gl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(C){g._frame=null,g._render(C)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,C){y.setCacheLimits(g,C)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(kf);function Gl(f){f.parentNode&&f.parentNode.removeChild(f)}var Ks={showCompass:!0,showZoom:!0,visualizePitch:!1},ku=function(f){var d=this;this.options=y.extend({},Ks,f),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ku.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},ku.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},ku.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Do(this._map,this._compass,this.options.visualizePitch)),this._container},ku.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ku.prototype._createButton=function(f,d){var h=W.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},ku.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Do=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new jl({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new nl({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(d,"mousedown",this.mousedown),W.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(d,"touchmove",this.touchmove),W.addEventListener(d,"touchend",this.touchend),W.addEventListener(d,"touchcancel",this.reset)};function Sl(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),C=new y.LngLat(f.lng+360,f.lat),T=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<T?f=g:h.locationPoint(C).distSqr(d)<T&&(f=C)}for(;Math.abs(f.lng-h.center.lng)>180;){var k=h.locationPoint(f);if(k.x>=0&&k.y>=0&&k.x<=h.width&&k.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Do.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),W.disableDrag()},Do.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var C=this.mousePitch.mousemoveWindow(f,d);C&&C.pitchDelta&&h.setPitch(h.getPitch()+C.pitchDelta)}},Do.prototype.off=function(){var f=this.element;W.removeEventListener(f,"mousedown",this.mousedown),W.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(f,"touchmove",this.touchmove),W.removeEventListener(f,"touchend",this.touchend),W.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Do.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(y.window,"mousemove",this.mousemove),W.removeEventListener(y.window,"mouseup",this.mouseup)},Do.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),W.mousePos(this.element,f)),W.addEventListener(y.window,"mousemove",this.mousemove),W.addEventListener(y.window,"mouseup",this.mouseup)},Do.prototype.mousemove=function(f){this.move(f,W.mousePos(this.element,f))},Do.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Do.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Do.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Do.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Do.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var xu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hl(f,d,h){var g=f.classList;for(var C in xu)g.remove("mapboxgl-"+h+"-anchor-"+C);g.add("mapboxgl-"+h+"-anchor-"+d)}var mc,gc=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var C=W.createNS("http://www.w3.org/2000/svg","svg");C.setAttributeNS(null,"display","block"),C.setAttributeNS(null,"height","41px"),C.setAttributeNS(null,"width","27px"),C.setAttributeNS(null,"viewBox","0 0 27 41");var T=W.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");var k=W.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");var D=W.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");for(var G=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<ee.length;G+=1){var _e=ee[G],Ee=W.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",_e.rx),Ee.setAttributeNS(null,"ry",_e.ry),D.appendChild(Ee)}var Ce=W.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"fill",this._color);var Re=W.createNS("http://www.w3.org/2000/svg","path");Re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ce.appendChild(Re);var Ze=W.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"opacity","0.25"),Ze.setAttributeNS(null,"fill","#000000");var nt=W.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ze.appendChild(nt);var Fe=W.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");var at=W.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var yt=W.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#000000"),yt.setAttributeNS(null,"opacity","0.25"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962");var Ut=W.createNS("http://www.w3.org/2000/svg","circle");Ut.setAttributeNS(null,"fill","#FFFFFF"),Ut.setAttributeNS(null,"cx","5.5"),Ut.setAttributeNS(null,"cy","5.5"),Ut.setAttributeNS(null,"r","5.4999962"),at.appendChild(yt),at.appendChild(Ut),k.appendChild(D),k.appendChild(Ce),k.appendChild(Ze),k.appendChild(Fe),k.appendChild(at),C.appendChild(k),C.setAttributeNS(null,"height",41*this._scale+"px"),C.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(C),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Zt){Zt.preventDefault()}),this._element.addEventListener("mousedown",function(Zt){Zt.preventDefault()}),Hl(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,C=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&C!==32&&C!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,C=this._element;this._popup&&(g===C||C.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Sl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,xu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+C+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),Lf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},yc=0,_o=!1,Bh=function(f){function d(h){f.call(this),this.options=y.extend({},Lf,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,mc!==void 0?g(mc):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(C){g(mc=C.state!=="denied")}):g(mc=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yc=0,_o=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),C=h.coords;return g&&(C.longitude<g.getWest()||C.longitude>g.getEast()||C.latitude<g.getSouth()||C.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),C=h.coords.accuracy,T=this._map.getBearing(),k=y.extend({bearing:T},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(C),k,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),C=this._map.unproject([1,h]),T=g.distanceTo(C),k=Math.ceil(2*this._accuracy/T);this._circleElement.style.width=k+"px",this._circleElement.style.height=k+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&_o)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(k){return k.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var C=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}else{var T=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new gc(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(k){k.geolocateSource||g._watchState!=="ACTIVE_LOCK"||k.originalEvent&&k.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yc--,_o=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++yc>1?(h={maximumAge:6e5,timeout:0},_o=!0):(h=this.options.positionOptions,_o=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),Wl={maxWidth:100,unit:"metric"},Xl=function(f){this.options=y.extend({},Wl,f),y.bindAll(["_onMove","setUnit"],this)};function Rf(f,d,h){var g=h&&h.maxWidth||100,C=f._container.clientHeight/2,T=f.unproject([0,C]),k=f.unproject([g,C]),D=T.distanceTo(k);if(h&&h.unit==="imperial"){var G=3.2808*D;G>5280?Yl(d,g,G/5280,f._getUIString("ScaleControl.Miles")):Yl(d,g,G,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Yl(d,g,D/1852,f._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Yl(d,g,D/1e3,f._getUIString("ScaleControl.Kilometers")):Yl(d,g,D,f._getUIString("ScaleControl.Meters"))}function Yl(f,d,h,g){var C,T,k,D=(C=h,(T=Math.pow(10,(""+Math.floor(C)).length-1))*(k=(k=C/T)>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(G){var ee=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*ee)/ee}(k)));f.style.width=d*(D/h)+"px",f.innerHTML=D+"&nbsp;"+g}Xl.prototype.getDefaultPosition=function(){return"bottom-left"},Xl.prototype._onMove=function(){Rf(this._map,this._container,this.options)},Xl.prototype.onAdd=function(f){return this._map=f,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Xl.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Xl.prototype.setUnit=function(f){this.options.unit=f,Rf(this._map,this._container,this.options)};var fs=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};fs.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},fs.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},fs.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},fs.prototype._setupUI=function(){var f=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},fs.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},fs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},fs.prototype._isFullscreen=function(){return this._fullscreen},fs.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},fs.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var _c={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Cl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Of=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(_c),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,C=y.window.document.createDocumentFragment(),T=y.window.document.createElement("body");for(T.innerHTML=h;g=T.firstChild;)C.appendChild(g);return this.setDOMContent(C)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ee){return g._container.classList.add(Ee)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var C=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),T=this.options.anchor,k=function Ee(Ce){if(Ce){if(typeof Ce=="number"){var Re=Math.round(Math.sqrt(.5*Math.pow(Ce,2)));return{center:new y.Point(0,0),top:new y.Point(0,Ce),"top-left":new y.Point(Re,Re),"top-right":new y.Point(-Re,Re),bottom:new y.Point(0,-Ce),"bottom-left":new y.Point(Re,-Re),"bottom-right":new y.Point(-Re,-Re),left:new y.Point(Ce,0),right:new y.Point(-Ce,0)}}if(Ce instanceof y.Point||Array.isArray(Ce)){var Ze=y.Point.convert(Ce);return{center:Ze,top:Ze,"top-left":Ze,"top-right":Ze,bottom:Ze,"bottom-left":Ze,"bottom-right":Ze,left:Ze,right:Ze}}return{center:y.Point.convert(Ce.center||[0,0]),top:y.Point.convert(Ce.top||[0,0]),"top-left":y.Point.convert(Ce["top-left"]||[0,0]),"top-right":y.Point.convert(Ce["top-right"]||[0,0]),bottom:y.Point.convert(Ce.bottom||[0,0]),"bottom-left":y.Point.convert(Ce["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Ce["bottom-right"]||[0,0]),left:y.Point.convert(Ce.left||[0,0]),right:y.Point.convert(Ce.right||[0,0])}}return Ee(new y.Point(0,0))}(this.options.offset);if(!T){var D,G=this._container.offsetWidth,ee=this._container.offsetHeight;D=C.y+k.bottom.y<ee?["top"]:C.y>this._map.transform.height-ee?["bottom"]:[],C.x<G/2?D.push("left"):C.x>this._map.transform.width-G/2&&D.push("right"),T=D.length===0?"bottom":D.join("-")}var _e=C.add(k[T]).round();W.setTransform(this._container,xu[T]+" translate("+_e.x+"px,"+_e.y+"px)"),Hl(this._container,T,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(Cl);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),$l={version:y.version,supported:Se,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:tf,NavigationControl:ku,GeolocateControl:Bh,AttributionControl:rs,ScaleControl:Xl,FullscreenControl:fs,Popup:Of,Marker:gc,Style:ys,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){qt().acquire(ar)},clearPrewarmedResources:function(){var f=Dn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(ar),Dn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return Or.workerCount},set workerCount(f){Or.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return $l}),Ae})},3614:function(Fr,fe,Q){"use strict";Fr.exports=re;var Ae=Q(80645);function re(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}re.Varint=0,re.Fixed64=1,re.Bytes=2,re.Fixed32=5;var y=(1<<16)*(1<<16),Se=1/y,W=12,ge=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");re.prototype={destroy:function(){this.buf=null},readFields:function(te,Ne,N){for(N=N||this.length;this.pos<N;){var U=this.readVarint(),le=U>>3,He=this.pos;this.type=U&7,te(le,Ne,this),this.pos===He&&this.skip(U)}return Ne},readMessage:function(te,Ne){return this.readFields(te,Ne,this.readVarint()+this.pos)},readFixed32:function(){var te=Tt(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=Wt(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=Tt(this.buf,this.pos)+Tt(this.buf,this.pos+4)*y;return this.pos+=8,te},readSFixed64:function(){var te=Tt(this.buf,this.pos)+Wt(this.buf,this.pos+4)*y;return this.pos+=8,te},readFloat:function(){var te=Ae.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=Ae.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var Ne=this.buf,N,U;return U=Ne[this.pos++],N=U&127,U<128||(U=Ne[this.pos++],N|=(U&127)<<7,U<128)||(U=Ne[this.pos++],N|=(U&127)<<14,U<128)||(U=Ne[this.pos++],N|=(U&127)<<21,U<128)?N:(U=Ne[this.pos],N|=(U&15)<<28,ce(N,te,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2==1?(te+1)/-2:te/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var te=this.readVarint()+this.pos,Ne=this.pos;return this.pos=te,te-Ne>=W&&ge?fr(this.buf,Ne,te):mt(this.buf,Ne,te)},readBytes:function(){var te=this.readVarint()+this.pos,Ne=this.buf.subarray(this.pos,te);return this.pos=te,Ne},readPackedVarint:function(te,Ne){if(this.type!==re.Bytes)return te.push(this.readVarint(Ne));var N=Xe(this);for(te=te||[];this.pos<N;)te.push(this.readVarint(Ne));return te},readPackedSVarint:function(te){if(this.type!==re.Bytes)return te.push(this.readSVarint());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==re.Bytes)return te.push(this.readBoolean());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==re.Bytes)return te.push(this.readFloat());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==re.Bytes)return te.push(this.readDouble());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==re.Bytes)return te.push(this.readFixed32());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==re.Bytes)return te.push(this.readSFixed32());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==re.Bytes)return te.push(this.readFixed64());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==re.Bytes)return te.push(this.readSFixed64());var Ne=Xe(this);for(te=te||[];this.pos<Ne;)te.push(this.readSFixed64());return te},skip:function(te){var Ne=te&7;if(Ne===re.Varint)for(;this.buf[this.pos++]>127;);else if(Ne===re.Bytes)this.pos=this.readVarint()+this.pos;else if(Ne===re.Fixed32)this.pos+=4;else if(Ne===re.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ne)},writeTag:function(te,Ne){this.writeVarint(te<<3|Ne)},realloc:function(te){for(var Ne=this.length||16;Ne<this.pos+te;)Ne*=2;if(Ne!==this.length){var N=new Uint8Array(Ne);N.set(this.buf),this.buf=N,this.length=Ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),ht(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),ht(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),ht(this.buf,te&-1,this.pos),ht(this.buf,Math.floor(te*Se),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),ht(this.buf,te&-1,this.pos),ht(this.buf,Math.floor(te*Se),this.pos+4),this.pos+=8},writeVarint:function(te){if(te=+te||0,te>268435455||te<0){qe(te,this);return}this.realloc(4),this.buf[this.pos++]=te&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=te>>>7&127)))},writeSVarint:function(te){this.writeVarint(te<0?-te*2-1:te*2)},writeBoolean:function(te){this.writeVarint(Boolean(te))},writeString:function(te){te=String(te),this.realloc(te.length*4),this.pos++;var Ne=this.pos;this.pos=Lr(this.buf,te,this.pos);var N=this.pos-Ne;N>=128&&Pt(Ne,N,this),this.pos=Ne-1,this.writeVarint(N),this.pos+=N},writeFloat:function(te){this.realloc(4),Ae.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),Ae.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var Ne=te.length;this.writeVarint(Ne),this.realloc(Ne);for(var N=0;N<Ne;N++)this.buf[this.pos++]=te[N]},writeRawMessage:function(te,Ne){this.pos++;var N=this.pos;te(Ne,this);var U=this.pos-N;U>=128&&Pt(N,U,this),this.pos=N-1,this.writeVarint(U),this.pos+=U},writeMessage:function(te,Ne,N){this.writeTag(te,re.Bytes),this.writeRawMessage(Ne,N)},writePackedVarint:function(te,Ne){Ne.length&&this.writeMessage(te,ur,Ne)},writePackedSVarint:function(te,Ne){Ne.length&&this.writeMessage(te,Nt,Ne)},writePackedBoolean:function(te,Ne){Ne.length&&this.writeMessage(te,It,Ne)},writePackedFloat:function(te,Ne){Ne.length&&this.writeMessage(te,pr,Ne)},writePackedDouble:function(te,Ne){Ne.length&&this.writeMessage(te,Xt,Ne)},writePackedFixed32:function(te,Ne){Ne.length&&this.writeMessage(te,kt,Ne)},writePackedSFixed32:function(te,Ne){Ne.length&&this.writeMessage(te,_r,Ne)},writePackedFixed64:function(te,Ne){Ne.length&&this.writeMessage(te,J,Ne)},writePackedSFixed64:function(te,Ne){Ne.length&&this.writeMessage(te,lr,Ne)},writeBytesField:function(te,Ne){this.writeTag(te,re.Bytes),this.writeBytes(Ne)},writeFixed32Field:function(te,Ne){this.writeTag(te,re.Fixed32),this.writeFixed32(Ne)},writeSFixed32Field:function(te,Ne){this.writeTag(te,re.Fixed32),this.writeSFixed32(Ne)},writeFixed64Field:function(te,Ne){this.writeTag(te,re.Fixed64),this.writeFixed64(Ne)},writeSFixed64Field:function(te,Ne){this.writeTag(te,re.Fixed64),this.writeSFixed64(Ne)},writeVarintField:function(te,Ne){this.writeTag(te,re.Varint),this.writeVarint(Ne)},writeSVarintField:function(te,Ne){this.writeTag(te,re.Varint),this.writeSVarint(Ne)},writeStringField:function(te,Ne){this.writeTag(te,re.Bytes),this.writeString(Ne)},writeFloatField:function(te,Ne){this.writeTag(te,re.Fixed32),this.writeFloat(Ne)},writeDoubleField:function(te,Ne){this.writeTag(te,re.Fixed64),this.writeDouble(Ne)},writeBooleanField:function(te,Ne){this.writeVarintField(te,Boolean(Ne))}};function ce(te,Ne,N){var U=N.buf,le,He;if(He=U[N.pos++],le=(He&112)>>4,He<128||(He=U[N.pos++],le|=(He&127)<<3,He<128)||(He=U[N.pos++],le|=(He&127)<<10,He<128)||(He=U[N.pos++],le|=(He&127)<<17,He<128)||(He=U[N.pos++],le|=(He&127)<<24,He<128)||(He=U[N.pos++],le|=(He&1)<<31,He<128))return me(te,le,Ne);throw new Error("Expected varint not more than 10 bytes")}function Xe(te){return te.type===re.Bytes?te.readVarint()+te.pos:te.pos+1}function me(te,Ne,N){return N?Ne*4294967296+(te>>>0):(Ne>>>0)*4294967296+(te>>>0)}function qe(te,Ne){var N,U;if(te>=0?(N=te%4294967296|0,U=te/4294967296|0):(N=~(-te%4294967296),U=~(-te/4294967296),N^4294967295?N=N+1|0:(N=0,U=U+1|0)),te>=18446744073709552e3||te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ne.realloc(10),lt(N,U,Ne),bt(U,Ne)}function lt(te,Ne,N){N.buf[N.pos++]=te&127|128,te>>>=7,N.buf[N.pos++]=te&127|128,te>>>=7,N.buf[N.pos++]=te&127|128,te>>>=7,N.buf[N.pos++]=te&127|128,te>>>=7,N.buf[N.pos]=te&127}function bt(te,Ne){var N=(te&7)<<4;Ne.buf[Ne.pos++]|=N|((te>>>=3)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127)))))}function Pt(te,Ne,N){var U=Ne<=16383?1:Ne<=2097151?2:Ne<=268435455?3:Math.floor(Math.log(Ne)/(Math.LN2*7));N.realloc(U);for(var le=N.pos-1;le>=te;le--)N.buf[le+U]=N.buf[le]}function ur(te,Ne){for(var N=0;N<te.length;N++)Ne.writeVarint(te[N])}function Nt(te,Ne){for(var N=0;N<te.length;N++)Ne.writeSVarint(te[N])}function pr(te,Ne){for(var N=0;N<te.length;N++)Ne.writeFloat(te[N])}function Xt(te,Ne){for(var N=0;N<te.length;N++)Ne.writeDouble(te[N])}function It(te,Ne){for(var N=0;N<te.length;N++)Ne.writeBoolean(te[N])}function kt(te,Ne){for(var N=0;N<te.length;N++)Ne.writeFixed32(te[N])}function _r(te,Ne){for(var N=0;N<te.length;N++)Ne.writeSFixed32(te[N])}function J(te,Ne){for(var N=0;N<te.length;N++)Ne.writeFixed64(te[N])}function lr(te,Ne){for(var N=0;N<te.length;N++)Ne.writeSFixed64(te[N])}function Tt(te,Ne){return(te[Ne]|te[Ne+1]<<8|te[Ne+2]<<16)+te[Ne+3]*16777216}function ht(te,Ne,N){te[N]=Ne,te[N+1]=Ne>>>8,te[N+2]=Ne>>>16,te[N+3]=Ne>>>24}function Wt(te,Ne){return(te[Ne]|te[Ne+1]<<8|te[Ne+2]<<16)+(te[Ne+3]<<24)}function mt(te,Ne,N){for(var U="",le=Ne;le<N;){var He=te[le],Je=null,ft=He>239?4:He>223?3:He>191?2:1;if(le+ft>N)break;var Vt,nr,Zr;ft===1?He<128&&(Je=He):ft===2?(Vt=te[le+1],(Vt&192)==128&&(Je=(He&31)<<6|Vt&63,Je<=127&&(Je=null))):ft===3?(Vt=te[le+1],nr=te[le+2],(Vt&192)==128&&(nr&192)==128&&(Je=(He&15)<<12|(Vt&63)<<6|nr&63,(Je<=2047||Je>=55296&&Je<=57343)&&(Je=null))):ft===4&&(Vt=te[le+1],nr=te[le+2],Zr=te[le+3],(Vt&192)==128&&(nr&192)==128&&(Zr&192)==128&&(Je=(He&15)<<18|(Vt&63)<<12|(nr&63)<<6|Zr&63,(Je<=65535||Je>=1114112)&&(Je=null))),Je===null?(Je=65533,ft=1):Je>65535&&(Je-=65536,U+=String.fromCharCode(Je>>>10&1023|55296),Je=56320|Je&1023),U+=String.fromCharCode(Je),le+=ft}return U}function fr(te,Ne,N){return ge.decode(te.subarray(Ne,N))}function Lr(te,Ne,N){for(var U=0,le,He;U<Ne.length;U++){if(le=Ne.charCodeAt(U),le>55295&&le<57344)if(He)if(le<56320){te[N++]=239,te[N++]=191,te[N++]=189,He=le;continue}else le=He-55296<<10|le-56320|65536,He=null;else{le>56319||U+1===Ne.length?(te[N++]=239,te[N++]=191,te[N++]=189):He=le;continue}else He&&(te[N++]=239,te[N++]=191,te[N++]=189,He=null);le<128?te[N++]=le:(le<2048?te[N++]=le>>6|192:(le<65536?te[N++]=le>>12|224:(te[N++]=le>>18|240,te[N++]=le>>12&63|128),te[N++]=le>>6&63|128),te[N++]=le&63|128)}return N}},32676:function(Fr,fe,Q){var Ae=Q(34155);(function(re,y){Fr.exports=y()})(this,function(){"use strict";function re(wt,ve){if(!(wt instanceof ve))throw new TypeError("Cannot call a class as a function")}function y(wt,ve){for(var se=0;se<ve.length;se++){var xe=ve[se];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(wt,xe.key,xe)}}function Se(wt,ve,se){return ve&&y(wt.prototype,ve),se&&y(wt,se),wt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var W=function(){function wt(ve,se){this.next=null,this.key=ve,this.data=se,this.left=null,this.right=null}return wt}();function ge(wt,ve){return wt>ve?1:wt<ve?-1:0}function ce(wt,ve,se){for(var xe=new W(null,null),z=xe,et=xe;;){var Qt=se(wt,ve.key);if(Qt<0){if(ve.left===null)break;if(se(wt,ve.left.key)<0){var zr=ve.left;if(ve.left=zr.right,zr.right=ve,ve=zr,ve.left===null)break}et.left=ve,et=ve,ve=ve.left}else if(Qt>0){if(ve.right===null)break;if(se(wt,ve.right.key)>0){var zr=ve.right;if(ve.right=zr.left,zr.left=ve,ve=zr,ve.right===null)break}z.right=ve,z=ve,ve=ve.right}else break}return z.right=ve.left,et.left=ve.right,ve.left=xe.right,ve.right=xe.left,ve}function Xe(wt,ve,se,xe){var z=new W(wt,ve);if(se===null)return z.left=z.right=null,z;se=ce(wt,se,xe);var et=xe(wt,se.key);return et<0?(z.left=se.left,z.right=se,se.left=null):et>=0&&(z.right=se.right,z.left=se,se.right=null),z}function me(wt,ve,se){var xe=null,z=null;if(ve){ve=ce(wt,ve,se);var et=se(ve.key,wt);et===0?(xe=ve.left,z=ve.right):et<0?(z=ve.right,ve.right=null,xe=ve):(xe=ve.left,ve.left=null,z=ve)}return{left:xe,right:z}}function qe(wt,ve,se){return ve===null?wt:(wt===null||(ve=ce(wt.key,ve,se),ve.left=wt),ve)}function lt(wt,ve,se,xe,z){if(wt){xe(""+ve+(se?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+z(wt)+`
`);var et=ve+(se?"    ":"\u2502   ");wt.left&&lt(wt.left,et,!1,xe,z),wt.right&&lt(wt.right,et,!0,xe,z)}}var bt=function(){function wt(ve){ve===void 0&&(ve=ge),this._root=null,this._size=0,this._comparator=ve}return wt.prototype.insert=function(ve,se){return this._size++,this._root=Xe(ve,se,this._root,this._comparator)},wt.prototype.add=function(ve,se){var xe=new W(ve,se);this._root===null&&(xe.left=xe.right=null,this._size++,this._root=xe);var z=this._comparator,et=ce(ve,this._root,z),Qt=z(ve,et.key);return Qt===0?this._root=et:(Qt<0?(xe.left=et.left,xe.right=et,et.left=null):Qt>0&&(xe.right=et.right,xe.left=et,et.right=null),this._size++,this._root=xe),this._root},wt.prototype.remove=function(ve){this._root=this._remove(ve,this._root,this._comparator)},wt.prototype._remove=function(ve,se,xe){var z;if(se===null)return null;se=ce(ve,se,xe);var et=xe(ve,se.key);return et===0?(se.left===null?z=se.right:(z=ce(ve,se.left,xe),z.right=se.right),this._size--,z):se},wt.prototype.pop=function(){var ve=this._root;if(ve){for(;ve.left;)ve=ve.left;return this._root=ce(ve.key,this._root,this._comparator),this._root=this._remove(ve.key,this._root,this._comparator),{key:ve.key,data:ve.data}}return null},wt.prototype.findStatic=function(ve){for(var se=this._root,xe=this._comparator;se;){var z=xe(ve,se.key);if(z===0)return se;z<0?se=se.left:se=se.right}return null},wt.prototype.find=function(ve){return this._root&&(this._root=ce(ve,this._root,this._comparator),this._comparator(ve,this._root.key)!==0)?null:this._root},wt.prototype.contains=function(ve){for(var se=this._root,xe=this._comparator;se;){var z=xe(ve,se.key);if(z===0)return!0;z<0?se=se.left:se=se.right}return!1},wt.prototype.forEach=function(ve,se){for(var xe=this._root,z=[],et=!1;!et;)xe!==null?(z.push(xe),xe=xe.left):z.length!==0?(xe=z.pop(),ve.call(se,xe),xe=xe.right):et=!0;return this},wt.prototype.range=function(ve,se,xe,z){for(var et=[],Qt=this._comparator,zr=this._root,Ke;et.length!==0||zr;)if(zr)et.push(zr),zr=zr.left;else{if(zr=et.pop(),Ke=Qt(zr.key,se),Ke>0)break;if(Qt(zr.key,ve)>=0&&xe.call(z,zr))return this;zr=zr.right}return this},wt.prototype.keys=function(){var ve=[];return this.forEach(function(se){var xe=se.key;return ve.push(xe)}),ve},wt.prototype.values=function(){var ve=[];return this.forEach(function(se){var xe=se.data;return ve.push(xe)}),ve},wt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},wt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},wt.prototype.minNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.left;)ve=ve.left;return ve},wt.prototype.maxNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.right;)ve=ve.right;return ve},wt.prototype.at=function(ve){for(var se=this._root,xe=!1,z=0,et=[];!xe;)if(se)et.push(se),se=se.left;else if(et.length>0){if(se=et.pop(),z===ve)return se;z++,se=se.right}else xe=!0;return null},wt.prototype.next=function(ve){var se=this._root,xe=null;if(ve.right){for(xe=ve.right;xe.left;)xe=xe.left;return xe}for(var z=this._comparator;se;){var et=z(ve.key,se.key);if(et===0)break;et<0?(xe=se,se=se.left):se=se.right}return xe},wt.prototype.prev=function(ve){var se=this._root,xe=null;if(ve.left!==null){for(xe=ve.left;xe.right;)xe=xe.right;return xe}for(var z=this._comparator;se;){var et=z(ve.key,se.key);if(et===0)break;et<0?se=se.left:(xe=se,se=se.right)}return xe},wt.prototype.clear=function(){return this._root=null,this._size=0,this},wt.prototype.toList=function(){return Nt(this._root)},wt.prototype.load=function(ve,se,xe){se===void 0&&(se=[]),xe===void 0&&(xe=!1);var z=ve.length,et=this._comparator;if(xe&&It(ve,se,0,z-1,et),this._root===null)this._root=Pt(ve,se,0,z),this._size=z;else{var Qt=Xt(this.toList(),ur(ve,se),et);z=this._size+z,this._root=pr({head:Qt},0,z)}return this},wt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(wt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(wt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),wt.prototype.toString=function(ve){ve===void 0&&(ve=function(z){return String(z.key)});var se=[];return lt(this._root,"",!0,function(xe){return se.push(xe)},ve),se.join("")},wt.prototype.update=function(ve,se,xe){var z=this._comparator,et=me(ve,this._root,z),Qt=et.left,zr=et.right;z(ve,se)<0?zr=Xe(se,xe,zr,z):Qt=Xe(se,xe,Qt,z),this._root=qe(Qt,zr,z)},wt.prototype.split=function(ve){return me(ve,this._root,this._comparator)},wt}();function Pt(wt,ve,se,xe){var z=xe-se;if(z>0){var et=se+Math.floor(z/2),Qt=wt[et],zr=ve[et],Ke=new W(Qt,zr);return Ke.left=Pt(wt,ve,se,et),Ke.right=Pt(wt,ve,et+1,xe),Ke}return null}function ur(wt,ve){for(var se=new W(null,null),xe=se,z=0;z<wt.length;z++)xe=xe.next=new W(wt[z],ve[z]);return xe.next=null,se.next}function Nt(wt){for(var ve=wt,se=[],xe=!1,z=new W(null,null),et=z;!xe;)ve?(se.push(ve),ve=ve.left):se.length>0?(ve=et=et.next=se.pop(),ve=ve.right):xe=!0;return et.next=null,z.next}function pr(wt,ve,se){var xe=se-ve;if(xe>0){var z=ve+Math.floor(xe/2),et=pr(wt,ve,z),Qt=wt.head;return Qt.left=et,wt.head=wt.head.next,Qt.right=pr(wt,z+1,se),Qt}return null}function Xt(wt,ve,se){for(var xe=new W(null,null),z=xe,et=wt,Qt=ve;et!==null&&Qt!==null;)se(et.key,Qt.key)<0?(z.next=et,et=et.next):(z.next=Qt,Qt=Qt.next),z=z.next;return et!==null?z.next=et:Qt!==null&&(z.next=Qt),xe.next}function It(wt,ve,se,xe,z){if(!(se>=xe)){for(var et=wt[se+xe>>1],Qt=se-1,zr=xe+1;;){do Qt++;while(z(wt[Qt],et)<0);do zr--;while(z(wt[zr],et)>0);if(Qt>=zr)break;var Ke=wt[Qt];wt[Qt]=wt[zr],wt[zr]=Ke,Ke=ve[Qt],ve[Qt]=ve[zr],ve[zr]=Ke}It(wt,ve,se,zr,z),It(wt,ve,zr+1,xe,z)}}var kt=function(ve,se){return ve.ll.x<=se.x&&se.x<=ve.ur.x&&ve.ll.y<=se.y&&se.y<=ve.ur.y},_r=function(ve,se){if(se.ur.x<ve.ll.x||ve.ur.x<se.ll.x||se.ur.y<ve.ll.y||ve.ur.y<se.ll.y)return null;var xe=ve.ll.x<se.ll.x?se.ll.x:ve.ll.x,z=ve.ur.x<se.ur.x?ve.ur.x:se.ur.x,et=ve.ll.y<se.ll.y?se.ll.y:ve.ll.y,Qt=ve.ur.y<se.ur.y?ve.ur.y:se.ur.y;return{ll:{x:xe,y:et},ur:{x:z,y:Qt}}},J=Number.EPSILON;J===void 0&&(J=Math.pow(2,-52));var lr=J*J,Tt=function(ve,se){if(-J<ve&&ve<J&&-J<se&&se<J)return 0;var xe=ve-se;return xe*xe<lr*ve*se?0:ve<se?-1:1},ht=function(){function wt(){re(this,wt),this.reset()}return Se(wt,[{key:"reset",value:function(){this.xRounder=new Wt,this.yRounder=new Wt}},{key:"round",value:function(se,xe){return{x:this.xRounder.round(se),y:this.yRounder.round(xe)}}}]),wt}(),Wt=function(){function wt(){re(this,wt),this.tree=new bt,this.round(0)}return Se(wt,[{key:"round",value:function(se){var xe=this.tree.add(se),z=this.tree.prev(xe);if(z!==null&&Tt(xe.key,z.key)===0)return this.tree.remove(se),z.key;var et=this.tree.next(xe);return et!==null&&Tt(xe.key,et.key)===0?(this.tree.remove(se),et.key):se}}]),wt}(),mt=new ht,fr=function(ve,se){return ve.x*se.y-ve.y*se.x},Lr=function(ve,se){return ve.x*se.x+ve.y*se.y},te=function(ve,se,xe){var z={x:se.x-ve.x,y:se.y-ve.y},et={x:xe.x-ve.x,y:xe.y-ve.y},Qt=fr(z,et);return Tt(Qt,0)},Ne=function(ve){return Math.sqrt(Lr(ve,ve))},N=function(ve,se,xe){var z={x:se.x-ve.x,y:se.y-ve.y},et={x:xe.x-ve.x,y:xe.y-ve.y};return fr(et,z)/Ne(et)/Ne(z)},U=function(ve,se,xe){var z={x:se.x-ve.x,y:se.y-ve.y},et={x:xe.x-ve.x,y:xe.y-ve.y};return Lr(et,z)/Ne(et)/Ne(z)},le=function(ve,se,xe){return se.y===0?null:{x:ve.x+se.x/se.y*(xe-ve.y),y:xe}},He=function(ve,se,xe){return se.x===0?null:{x:xe,y:ve.y+se.y/se.x*(xe-ve.x)}},Je=function(ve,se,xe,z){if(se.x===0)return He(xe,z,ve.x);if(z.x===0)return He(ve,se,xe.x);if(se.y===0)return le(xe,z,ve.y);if(z.y===0)return le(ve,se,xe.y);var et=fr(se,z);if(et==0)return null;var Qt={x:xe.x-ve.x,y:xe.y-ve.y},zr=fr(Qt,se)/et,Ke=fr(Qt,z)/et,Rt=ve.x+Ke*se.x,vr=xe.x+zr*z.x,Pr=ve.y+Ke*se.y,Xr=xe.y+zr*z.y,rn=(Rt+vr)/2,jn=(Pr+Xr)/2;return{x:rn,y:jn}},ft=function(){Se(wt,null,[{key:"compare",value:function(se,xe){var z=wt.comparePoints(se.point,xe.point);return z!==0?z:(se.point!==xe.point&&se.link(xe),se.isLeft!==xe.isLeft?se.isLeft?1:-1:nr.compare(se.segment,xe.segment))}},{key:"comparePoints",value:function(se,xe){return se.x<xe.x?-1:se.x>xe.x?1:se.y<xe.y?-1:se.y>xe.y?1:0}}]);function wt(ve,se){re(this,wt),ve.events===void 0?ve.events=[this]:ve.events.push(this),this.point=ve,this.isLeft=se}return Se(wt,[{key:"link",value:function(se){if(se.point===this.point)throw new Error("Tried to link already linked events");for(var xe=se.point.events,z=0,et=xe.length;z<et;z++){var Qt=xe[z];this.point.events.push(Qt),Qt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var se=this.point.events.length,xe=0;xe<se;xe++){var z=this.point.events[xe];if(z.segment.consumedBy===void 0)for(var et=xe+1;et<se;et++){var Qt=this.point.events[et];Qt.consumedBy===void 0&&z.otherSE.point.events===Qt.otherSE.point.events&&z.segment.consume(Qt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var se=[],xe=0,z=this.point.events.length;xe<z;xe++){var et=this.point.events[xe];et!==this&&!et.segment.ringOut&&et.segment.isInResult()&&se.push(et)}return se}},{key:"getLeftmostComparator",value:function(se){var xe=this,z=new Map,et=function(zr){var Ke=zr.otherSE;z.set(zr,{sine:N(xe.point,se.point,Ke.point),cosine:U(xe.point,se.point,Ke.point)})};return function(Qt,zr){z.has(Qt)||et(Qt),z.has(zr)||et(zr);var Ke=z.get(Qt),Rt=Ke.sine,vr=Ke.cosine,Pr=z.get(zr),Xr=Pr.sine,rn=Pr.cosine;return Rt>=0&&Xr>=0?vr<rn?1:vr>rn?-1:0:Rt<0&&Xr<0?vr<rn?-1:vr>rn?1:0:Xr<Rt?-1:Xr>Rt?1:0}}}]),wt}(),Vt=0,nr=function(){Se(wt,null,[{key:"compare",value:function(se,xe){var z=se.leftSE.point.x,et=xe.leftSE.point.x,Qt=se.rightSE.point.x,zr=xe.rightSE.point.x;if(zr<z)return 1;if(Qt<et)return-1;var Ke=se.leftSE.point.y,Rt=xe.leftSE.point.y,vr=se.rightSE.point.y,Pr=xe.rightSE.point.y;if(z<et){if(Rt<Ke&&Rt<vr)return 1;if(Rt>Ke&&Rt>vr)return-1;var Xr=se.comparePoint(xe.leftSE.point);if(Xr<0)return 1;if(Xr>0)return-1;var rn=xe.comparePoint(se.rightSE.point);return rn!==0?rn:-1}if(z>et){if(Ke<Rt&&Ke<Pr)return-1;if(Ke>Rt&&Ke>Pr)return 1;var jn=xe.comparePoint(se.leftSE.point);if(jn!==0)return jn;var Zn=se.comparePoint(xe.rightSE.point);return Zn<0?1:Zn>0?-1:1}if(Ke<Rt)return-1;if(Ke>Rt)return 1;if(Qt<zr){var an=xe.comparePoint(se.rightSE.point);if(an!==0)return an}if(Qt>zr){var ui=se.comparePoint(xe.rightSE.point);if(ui<0)return 1;if(ui>0)return-1}if(Qt!==zr){var fi=vr-Ke,Hi=Qt-z,Aa=Pr-Rt,Pa=zr-et;if(fi>Hi&&Aa<Pa)return 1;if(fi<Hi&&Aa>Pa)return-1}return Qt>zr?1:Qt<zr||vr<Pr?-1:vr>Pr?1:se.id<xe.id?-1:se.id>xe.id?1:0}}]);function wt(ve,se,xe,z){re(this,wt),this.id=++Vt,this.leftSE=ve,ve.segment=this,ve.otherSE=se,this.rightSE=se,se.segment=this,se.otherSE=ve,this.rings=xe,this.windings=z}return Se(wt,[{key:"replaceRightSE",value:function(se){this.rightSE=se,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var se=this.leftSE.point.y,xe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:se<xe?se:xe},ur:{x:this.rightSE.point.x,y:se>xe?se:xe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(se){return se.x===this.leftSE.point.x&&se.y===this.leftSE.point.y||se.x===this.rightSE.point.x&&se.y===this.rightSE.point.y}},{key:"comparePoint",value:function(se){if(this.isAnEndpoint(se))return 0;var xe=this.leftSE.point,z=this.rightSE.point,et=this.vector();if(xe.x===z.x)return se.x===xe.x?0:se.x<xe.x?1:-1;var Qt=(se.y-xe.y)/et.y,zr=xe.x+Qt*et.x;if(se.x===zr)return 0;var Ke=(se.x-xe.x)/et.x,Rt=xe.y+Ke*et.y;return se.y===Rt?0:se.y<Rt?-1:1}},{key:"getIntersection",value:function(se){var xe=this.bbox(),z=se.bbox(),et=_r(xe,z);if(et===null)return null;var Qt=this.leftSE.point,zr=this.rightSE.point,Ke=se.leftSE.point,Rt=se.rightSE.point,vr=kt(xe,Ke)&&this.comparePoint(Ke)===0,Pr=kt(z,Qt)&&se.comparePoint(Qt)===0,Xr=kt(xe,Rt)&&this.comparePoint(Rt)===0,rn=kt(z,zr)&&se.comparePoint(zr)===0;if(Pr&&vr)return rn&&!Xr?zr:!rn&&Xr?Rt:null;if(Pr)return Xr&&Qt.x===Rt.x&&Qt.y===Rt.y?null:Qt;if(vr)return rn&&zr.x===Ke.x&&zr.y===Ke.y?null:Ke;if(rn&&Xr)return null;if(rn)return zr;if(Xr)return Rt;var jn=Je(Qt,this.vector(),Ke,se.vector());return jn===null||!kt(et,jn)?null:mt.round(jn.x,jn.y)}},{key:"split",value:function(se){var xe=[],z=se.events!==void 0,et=new ft(se,!0),Qt=new ft(se,!1),zr=this.rightSE;this.replaceRightSE(Qt),xe.push(Qt),xe.push(et);var Ke=new wt(et,zr,this.rings.slice(),this.windings.slice());return ft.comparePoints(Ke.leftSE.point,Ke.rightSE.point)>0&&Ke.swapEvents(),ft.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),z&&(et.checkForConsuming(),Qt.checkForConsuming()),xe}},{key:"swapEvents",value:function(){var se=this.rightSE;this.rightSE=this.leftSE,this.leftSE=se,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var xe=0,z=this.windings.length;xe<z;xe++)this.windings[xe]*=-1}},{key:"consume",value:function(se){for(var xe=this,z=se;xe.consumedBy;)xe=xe.consumedBy;for(;z.consumedBy;)z=z.consumedBy;var et=wt.compare(xe,z);if(et!==0){if(et>0){var Qt=xe;xe=z,z=Qt}if(xe.prev===z){var zr=xe;xe=z,z=zr}for(var Ke=0,Rt=z.rings.length;Ke<Rt;Ke++){var vr=z.rings[Ke],Pr=z.windings[Ke],Xr=xe.rings.indexOf(vr);Xr===-1?(xe.rings.push(vr),xe.windings.push(Pr)):xe.windings[Xr]+=Pr}z.rings=null,z.windings=null,z.consumedBy=xe,z.leftSE.consumedBy=xe.leftSE,z.rightSE.consumedBy=xe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var se=this.prev.consumedBy||this.prev;this._beforeState=se.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var se=this.beforeState();this._afterState={rings:se.rings.slice(0),windings:se.windings.slice(0),multiPolys:[]};for(var xe=this._afterState.rings,z=this._afterState.windings,et=this._afterState.multiPolys,Qt=0,zr=this.rings.length;Qt<zr;Qt++){var Ke=this.rings[Qt],Rt=this.windings[Qt],vr=xe.indexOf(Ke);vr===-1?(xe.push(Ke),z.push(Rt)):z[vr]+=Rt}for(var Pr=[],Xr=[],rn=0,jn=xe.length;rn<jn;rn++)if(z[rn]!==0){var Zn=xe[rn],an=Zn.poly;if(Xr.indexOf(an)===-1)if(Zn.isExterior)Pr.push(an);else{Xr.indexOf(an)===-1&&Xr.push(an);var ui=Pr.indexOf(Zn.poly);ui!==-1&&Pr.splice(ui,1)}}for(var fi=0,Hi=Pr.length;fi<Hi;fi++){var Aa=Pr[fi].multiPoly;et.indexOf(Aa)===-1&&et.push(Aa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var se=this.beforeState().multiPolys,xe=this.afterState().multiPolys;switch(di.type){case"union":{var z=se.length===0,et=xe.length===0;this._isInResult=z!==et;break}case"intersection":{var Qt,zr;se.length<xe.length?(Qt=se.length,zr=xe.length):(Qt=xe.length,zr=se.length),this._isInResult=zr===di.numMultiPolys&&Qt<zr;break}case"xor":{var Ke=Math.abs(se.length-xe.length);this._isInResult=Ke%2==1;break}case"difference":{var Rt=function(Pr){return Pr.length===1&&Pr[0].isSubject};this._isInResult=Rt(se)!==Rt(xe);break}default:throw new Error("Unrecognized operation type found ".concat(di.type))}return this._isInResult}}],[{key:"fromRing",value:function(se,xe,z){var et,Qt,zr,Ke=ft.comparePoints(se,xe);if(Ke<0)et=se,Qt=xe,zr=1;else if(Ke>0)et=xe,Qt=se,zr=-1;else throw new Error("Tried to create degenerate segment at [".concat(se.x,", ").concat(se.y,"]"));var Rt=new ft(et,!0),vr=new ft(Qt,!1);return new wt(Rt,vr,[z],[zr])}}]),wt}(),Zr=function(){function wt(ve,se,xe){if(re(this,wt),!Array.isArray(ve)||ve.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=se,this.isExterior=xe,this.segments=[],typeof ve[0][0]!="number"||typeof ve[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var z=mt.round(ve[0][0],ve[0][1]);this.bbox={ll:{x:z.x,y:z.y},ur:{x:z.x,y:z.y}};for(var et=z,Qt=1,zr=ve.length;Qt<zr;Qt++){if(typeof ve[Qt][0]!="number"||typeof ve[Qt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ke=mt.round(ve[Qt][0],ve[Qt][1]);Ke.x===et.x&&Ke.y===et.y||(this.segments.push(nr.fromRing(et,Ke,this)),Ke.x<this.bbox.ll.x&&(this.bbox.ll.x=Ke.x),Ke.y<this.bbox.ll.y&&(this.bbox.ll.y=Ke.y),Ke.x>this.bbox.ur.x&&(this.bbox.ur.x=Ke.x),Ke.y>this.bbox.ur.y&&(this.bbox.ur.y=Ke.y),et=Ke)}(z.x!==et.x||z.y!==et.y)&&this.segments.push(nr.fromRing(et,z,this))}return Se(wt,[{key:"getSweepEvents",value:function(){for(var se=[],xe=0,z=this.segments.length;xe<z;xe++){var et=this.segments[xe];se.push(et.leftSE),se.push(et.rightSE)}return se}}]),wt}(),Dr=function(){function wt(ve,se){if(re(this,wt),!Array.isArray(ve))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Zr(ve[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var xe=1,z=ve.length;xe<z;xe++){var et=new Zr(ve[xe],this,!1);et.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=et.bbox.ll.x),et.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=et.bbox.ll.y),et.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=et.bbox.ur.x),et.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=et.bbox.ur.y),this.interiorRings.push(et)}this.multiPoly=se}return Se(wt,[{key:"getSweepEvents",value:function(){for(var se=this.exteriorRing.getSweepEvents(),xe=0,z=this.interiorRings.length;xe<z;xe++)for(var et=this.interiorRings[xe].getSweepEvents(),Qt=0,zr=et.length;Qt<zr;Qt++)se.push(et[Qt]);return se}}]),wt}(),Xn=function(){function wt(ve,se){if(re(this,wt),!Array.isArray(ve))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof ve[0][0][0]=="number"&&(ve=[ve])}catch(Qt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var xe=0,z=ve.length;xe<z;xe++){var et=new Dr(ve[xe],this);et.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=et.bbox.ll.x),et.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=et.bbox.ll.y),et.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=et.bbox.ur.x),et.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=et.bbox.ur.y),this.polys.push(et)}this.isSubject=se}return Se(wt,[{key:"getSweepEvents",value:function(){for(var se=[],xe=0,z=this.polys.length;xe<z;xe++)for(var et=this.polys[xe].getSweepEvents(),Qt=0,zr=et.length;Qt<zr;Qt++)se.push(et[Qt]);return se}}]),wt}(),sn=function(){Se(wt,null,[{key:"factory",value:function(se){for(var xe=[],z=0,et=se.length;z<et;z++){var Qt=se[z];if(!(!Qt.isInResult()||Qt.ringOut)){for(var zr=null,Ke=Qt.leftSE,Rt=Qt.rightSE,vr=[Ke],Pr=Ke.point,Xr=[];zr=Ke,Ke=Rt,vr.push(Ke),Ke.point!==Pr;)for(;;){var rn=Ke.getAvailableLinkedEvents();if(rn.length===0){var jn=vr[0].point,Zn=vr[vr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(jn.x,",")+" ".concat(jn.y,"]. Last matching segment found ends at")+" [".concat(Zn.x,", ").concat(Zn.y,"]."))}if(rn.length===1){Rt=rn[0].otherSE;break}for(var an=null,ui=0,fi=Xr.length;ui<fi;ui++)if(Xr[ui].point===Ke.point){an=ui;break}if(an!==null){var Hi=Xr.splice(an)[0],Aa=vr.splice(Hi.index);Aa.unshift(Aa[0].otherSE),xe.push(new wt(Aa.reverse()));continue}Xr.push({index:vr.length,point:Ke.point});var Pa=Ke.getLeftmostComparator(zr);Rt=rn.sort(Pa)[0].otherSE;break}xe.push(new wt(vr))}}return xe}}]);function wt(ve){re(this,wt),this.events=ve;for(var se=0,xe=ve.length;se<xe;se++)ve[se].segment.ringOut=this;this.poly=null}return Se(wt,[{key:"getGeom",value:function(){for(var se=this.events[0].point,xe=[se],z=1,et=this.events.length-1;z<et;z++){var Qt=this.events[z].point,zr=this.events[z+1].point;te(Qt,se,zr)!==0&&(xe.push(Qt),se=Qt)}if(xe.length===1)return null;var Ke=xe[0],Rt=xe[1];te(Ke,se,Rt)===0&&xe.shift(),xe.push(xe[0]);for(var vr=this.isExteriorRing()?1:-1,Pr=this.isExteriorRing()?0:xe.length-1,Xr=this.isExteriorRing()?xe.length:-1,rn=[],jn=Pr;jn!=Xr;jn+=vr)rn.push([xe[jn].x,xe[jn].y]);return rn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var se=this.enclosingRing();this._isExteriorRing=se?!se.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var se=this.events[0],xe=1,z=this.events.length;xe<z;xe++){var et=this.events[xe];ft.compare(se,et)>0&&(se=et)}for(var Qt=se.segment.prevInResult(),zr=Qt?Qt.prevInResult():null;;){if(!Qt)return null;if(!zr)return Qt.ringOut;if(zr.ringOut!==Qt.ringOut)return zr.ringOut.enclosingRing()!==Qt.ringOut?Qt.ringOut:Qt.ringOut.enclosingRing();Qt=zr.prevInResult(),zr=Qt?Qt.prevInResult():null}}}]),wt}(),Nn=function(){function wt(ve){re(this,wt),this.exteriorRing=ve,ve.poly=this,this.interiorRings=[]}return Se(wt,[{key:"addInterior",value:function(se){this.interiorRings.push(se),se.poly=this}},{key:"getGeom",value:function(){var se=[this.exteriorRing.getGeom()];if(se[0]===null)return null;for(var xe=0,z=this.interiorRings.length;xe<z;xe++){var et=this.interiorRings[xe].getGeom();et!==null&&se.push(et)}return se}}]),wt}(),ra=function(){function wt(ve){re(this,wt),this.rings=ve,this.polys=this._composePolys(ve)}return Se(wt,[{key:"getGeom",value:function(){for(var se=[],xe=0,z=this.polys.length;xe<z;xe++){var et=this.polys[xe].getGeom();et!==null&&se.push(et)}return se}},{key:"_composePolys",value:function(se){for(var xe=[],z=0,et=se.length;z<et;z++){var Qt=se[z];if(!Qt.poly)if(Qt.isExteriorRing())xe.push(new Nn(Qt));else{var zr=Qt.enclosingRing();zr.poly||xe.push(new Nn(zr)),zr.poly.addInterior(Qt)}}return xe}}]),wt}(),xi=function(){function wt(ve){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nr.compare;re(this,wt),this.queue=ve,this.tree=new bt(se),this.segments=[]}return Se(wt,[{key:"process",value:function(se){var xe=se.segment,z=[];if(se.consumedBy)return se.isLeft?this.queue.remove(se.otherSE):this.tree.remove(xe),z;var et=se.isLeft?this.tree.insert(xe):this.tree.find(xe);if(!et)throw new Error("Unable to find segment #".concat(xe.id," ")+"[".concat(xe.leftSE.point.x,", ").concat(xe.leftSE.point.y,"] -> ")+"[".concat(xe.rightSE.point.x,", ").concat(xe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Qt=et,zr=et,Ke=void 0,Rt=void 0;Ke===void 0;)Qt=this.tree.prev(Qt),Qt===null?Ke=null:Qt.key.consumedBy===void 0&&(Ke=Qt.key);for(;Rt===void 0;)zr=this.tree.next(zr),zr===null?Rt=null:zr.key.consumedBy===void 0&&(Rt=zr.key);if(se.isLeft){var vr=null;if(Ke){var Pr=Ke.getIntersection(xe);if(Pr!==null&&(xe.isAnEndpoint(Pr)||(vr=Pr),!Ke.isAnEndpoint(Pr)))for(var Xr=this._splitSafely(Ke,Pr),rn=0,jn=Xr.length;rn<jn;rn++)z.push(Xr[rn])}var Zn=null;if(Rt){var an=Rt.getIntersection(xe);if(an!==null&&(xe.isAnEndpoint(an)||(Zn=an),!Rt.isAnEndpoint(an)))for(var ui=this._splitSafely(Rt,an),fi=0,Hi=ui.length;fi<Hi;fi++)z.push(ui[fi])}if(vr!==null||Zn!==null){var Aa=null;if(vr===null)Aa=Zn;else if(Zn===null)Aa=vr;else{var Pa=ft.comparePoints(vr,Zn);Aa=Pa<=0?vr:Zn}this.queue.remove(xe.rightSE),z.push(xe.rightSE);for(var ba=xe.split(Aa),Ki=0,q=ba.length;Ki<q;Ki++)z.push(ba[Ki])}z.length>0?(this.tree.remove(xe),z.push(se)):(this.segments.push(xe),xe.prev=Ke)}else{if(Ke&&Rt){var ie=Ke.getIntersection(Rt);if(ie!==null){if(!Ke.isAnEndpoint(ie))for(var pe=this._splitSafely(Ke,ie),we=0,ze=pe.length;we<ze;we++)z.push(pe[we]);if(!Rt.isAnEndpoint(ie))for(var rt=this._splitSafely(Rt,ie),_t=0,be=rt.length;_t<be;_t++)z.push(rt[_t])}}this.tree.remove(xe)}return z}},{key:"_splitSafely",value:function(se,xe){this.tree.remove(se);var z=se.rightSE;this.queue.remove(z);var et=se.split(xe);return et.push(z),se.consumedBy===void 0&&this.tree.insert(se),et}}]),wt}(),si=typeof Ae!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ri=typeof Ae!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ki=function(){function wt(){re(this,wt)}return Se(wt,[{key:"run",value:function(se,xe,z){di.type=se,mt.reset();for(var et=[new Xn(xe,!0)],Qt=0,zr=z.length;Qt<zr;Qt++)et.push(new Xn(z[Qt],!1));if(di.numMultiPolys=et.length,di.type==="difference")for(var Ke=et[0],Rt=1;Rt<et.length;)_r(et[Rt].bbox,Ke.bbox)!==null?Rt++:et.splice(Rt,1);if(di.type==="intersection"){for(var vr=0,Pr=et.length;vr<Pr;vr++)for(var Xr=et[vr],rn=vr+1,jn=et.length;rn<jn;rn++)if(_r(Xr.bbox,et[rn].bbox)===null)return[]}for(var Zn=new bt(ft.compare),an=0,ui=et.length;an<ui;an++)for(var fi=et[an].getSweepEvents(),Hi=0,Aa=fi.length;Hi<Aa;Hi++)if(Zn.insert(fi[Hi]),Zn.size>si)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Pa=new xi(Zn),ba=Zn.size,Ki=Zn.pop();Ki;){var q=Ki.key;if(Zn.size===ba){var ie=q.segment;throw new Error("Unable to pop() ".concat(q.isLeft?"left":"right"," SweepEvent ")+"[".concat(q.point.x,", ").concat(q.point.y,"] from segment #").concat(ie.id," ")+"[".concat(ie.leftSE.point.x,", ").concat(ie.leftSE.point.y,"] -> ")+"[".concat(ie.rightSE.point.x,", ").concat(ie.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Zn.size>si)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Pa.segments.length>Ri)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var pe=Pa.process(q),we=0,ze=pe.length;we<ze;we++){var rt=pe[we];rt.consumedBy===void 0&&Zn.insert(rt)}ba=Zn.size,Ki=Zn.pop()}mt.reset();var _t=sn.factory(Pa.segments),be=new ra(_t);return be.getGeom()}}]),wt}(),di=new ki,Yn=function(ve){for(var se=arguments.length,xe=new Array(se>1?se-1:0),z=1;z<se;z++)xe[z-1]=arguments[z];return di.run("union",ve,xe)},ri=function(ve){for(var se=arguments.length,xe=new Array(se>1?se-1:0),z=1;z<se;z++)xe[z-1]=arguments[z];return di.run("intersection",ve,xe)},Ao=function(ve){for(var se=arguments.length,xe=new Array(se>1?se-1:0),z=1;z<se;z++)xe[z-1]=arguments[z];return di.run("xor",ve,xe)},Na=function(ve){for(var se=arguments.length,xe=new Array(se>1?se-1:0),z=1;z<se;z++)xe[z-1]=arguments[z];return di.run("difference",ve,xe)},ma={union:Yn,intersection:ri,xor:Ao,difference:Na};return ma})},28660:function(Fr,fe,Q){var Ae=Q(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var re;(function(y){(function(Se){var W=typeof Q.g=="object"?Q.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ge=ce(y);typeof W.Reflect=="undefined"?W.Reflect=y:ge=ce(W.Reflect,ge),Se(ge);function ce(Xe,me){return function(qe,lt){typeof Xe[qe]!="function"&&Object.defineProperty(Xe,qe,{configurable:!0,writable:!0,value:lt}),me&&me(qe,lt)}}})(function(Se){var W=Object.prototype.hasOwnProperty,ge=typeof Symbol=="function",ce=ge&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Xe=ge&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",me=typeof Object.create=="function",qe={__proto__:[]}instanceof Array,lt=!me&&!qe,bt={create:me?function(){return zr(Object.create(null))}:qe?function(){return zr({__proto__:null})}:function(){return zr({})},has:lt?function(Ke,Rt){return W.call(Ke,Rt)}:function(Ke,Rt){return Rt in Ke},get:lt?function(Ke,Rt){return W.call(Ke,Rt)?Ke[Rt]:void 0}:function(Ke,Rt){return Ke[Rt]}},Pt=Object.getPrototypeOf(Function),ur=typeof Ae=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Nt=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:z(),pr=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:et(),Xt=!ur&&typeof WeakMap=="function"?WeakMap:Qt(),It=new Xt;function kt(Ke,Rt,vr,Pr){if(Dr(vr)){if(!di(Ke))throw new TypeError;if(!ri(Rt))throw new TypeError;return te(Ke,Rt)}else{if(!di(Ke))throw new TypeError;if(!Nn(Rt))throw new TypeError;if(!Nn(Pr)&&!Dr(Pr)&&!Xn(Pr))throw new TypeError;return Xn(Pr)&&(Pr=void 0),vr=ki(vr),Ne(Ke,Rt,vr,Pr)}}Se("decorate",kt);function _r(Ke,Rt){function vr(Pr,Xr){if(!Nn(Pr))throw new TypeError;if(!Dr(Xr)&&!Ao(Xr))throw new TypeError;ft(Ke,Rt,Pr,Xr)}return vr}Se("metadata",_r);function J(Ke,Rt,vr,Pr){if(!Nn(vr))throw new TypeError;return Dr(Pr)||(Pr=ki(Pr)),ft(Ke,Rt,vr,Pr)}Se("defineMetadata",J);function lr(Ke,Rt,vr){if(!Nn(Rt))throw new TypeError;return Dr(vr)||(vr=ki(vr)),U(Ke,Rt,vr)}Se("hasMetadata",lr);function Tt(Ke,Rt,vr){if(!Nn(Rt))throw new TypeError;return Dr(vr)||(vr=ki(vr)),le(Ke,Rt,vr)}Se("hasOwnMetadata",Tt);function ht(Ke,Rt,vr){if(!Nn(Rt))throw new TypeError;return Dr(vr)||(vr=ki(vr)),He(Ke,Rt,vr)}Se("getMetadata",ht);function Wt(Ke,Rt,vr){if(!Nn(Rt))throw new TypeError;return Dr(vr)||(vr=ki(vr)),Je(Ke,Rt,vr)}Se("getOwnMetadata",Wt);function mt(Ke,Rt){if(!Nn(Ke))throw new TypeError;return Dr(Rt)||(Rt=ki(Rt)),Vt(Ke,Rt)}Se("getMetadataKeys",mt);function fr(Ke,Rt){if(!Nn(Ke))throw new TypeError;return Dr(Rt)||(Rt=ki(Rt)),nr(Ke,Rt)}Se("getOwnMetadataKeys",fr);function Lr(Ke,Rt,vr){if(!Nn(Rt))throw new TypeError;Dr(vr)||(vr=ki(vr));var Pr=N(Rt,vr,!1);if(Dr(Pr)||!Pr.delete(Ke))return!1;if(Pr.size>0)return!0;var Xr=It.get(Rt);return Xr.delete(vr),Xr.size>0||It.delete(Rt),!0}Se("deleteMetadata",Lr);function te(Ke,Rt){for(var vr=Ke.length-1;vr>=0;--vr){var Pr=Ke[vr],Xr=Pr(Rt);if(!Dr(Xr)&&!Xn(Xr)){if(!ri(Xr))throw new TypeError;Rt=Xr}}return Rt}function Ne(Ke,Rt,vr,Pr){for(var Xr=Ke.length-1;Xr>=0;--Xr){var rn=Ke[Xr],jn=rn(Rt,vr,Pr);if(!Dr(jn)&&!Xn(jn)){if(!Nn(jn))throw new TypeError;Pr=jn}}return Pr}function N(Ke,Rt,vr){var Pr=It.get(Ke);if(Dr(Pr)){if(!vr)return;Pr=new Nt,It.set(Ke,Pr)}var Xr=Pr.get(Rt);if(Dr(Xr)){if(!vr)return;Xr=new Nt,Pr.set(Rt,Xr)}return Xr}function U(Ke,Rt,vr){var Pr=le(Ke,Rt,vr);if(Pr)return!0;var Xr=xe(Rt);return Xn(Xr)?!1:U(Ke,Xr,vr)}function le(Ke,Rt,vr){var Pr=N(Rt,vr,!1);return Dr(Pr)?!1:si(Pr.has(Ke))}function He(Ke,Rt,vr){var Pr=le(Ke,Rt,vr);if(Pr)return Je(Ke,Rt,vr);var Xr=xe(Rt);if(!Xn(Xr))return He(Ke,Xr,vr)}function Je(Ke,Rt,vr){var Pr=N(Rt,vr,!1);if(!Dr(Pr))return Pr.get(Ke)}function ft(Ke,Rt,vr,Pr){var Xr=N(vr,Pr,!0);Xr.set(Ke,Rt)}function Vt(Ke,Rt){var vr=nr(Ke,Rt),Pr=xe(Ke);if(Pr===null)return vr;var Xr=Vt(Pr,Rt);if(Xr.length<=0)return vr;if(vr.length<=0)return Xr;for(var rn=new pr,jn=[],Zn=0,an=vr;Zn<an.length;Zn++){var ui=an[Zn],fi=rn.has(ui);fi||(rn.add(ui),jn.push(ui))}for(var Hi=0,Aa=Xr;Hi<Aa.length;Hi++){var ui=Aa[Hi],fi=rn.has(ui);fi||(rn.add(ui),jn.push(ui))}return jn}function nr(Ke,Rt){var vr=[],Pr=N(Ke,Rt,!1);if(Dr(Pr))return vr;for(var Xr=Pr.keys(),rn=ma(Xr),jn=0;;){var Zn=ve(rn);if(!Zn)return vr.length=jn,vr;var an=wt(Zn);try{vr[jn]=an}catch(ui){try{se(rn)}finally{throw ui}}jn++}}function Zr(Ke){if(Ke===null)return 1;switch(typeof Ke){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ke===null?1:6;default:return 6}}function Dr(Ke){return Ke===void 0}function Xn(Ke){return Ke===null}function sn(Ke){return typeof Ke=="symbol"}function Nn(Ke){return typeof Ke=="object"?Ke!==null:typeof Ke=="function"}function ra(Ke,Rt){switch(Zr(Ke)){case 0:return Ke;case 1:return Ke;case 2:return Ke;case 3:return Ke;case 4:return Ke;case 5:return Ke}var vr=Rt===3?"string":Rt===5?"number":"default",Pr=Na(Ke,ce);if(Pr!==void 0){var Xr=Pr.call(Ke,vr);if(Nn(Xr))throw new TypeError;return Xr}return xi(Ke,vr==="default"?"number":vr)}function xi(Ke,Rt){if(Rt==="string"){var vr=Ke.toString;if(Yn(vr)){var Pr=vr.call(Ke);if(!Nn(Pr))return Pr}var Xr=Ke.valueOf;if(Yn(Xr)){var Pr=Xr.call(Ke);if(!Nn(Pr))return Pr}}else{var Xr=Ke.valueOf;if(Yn(Xr)){var Pr=Xr.call(Ke);if(!Nn(Pr))return Pr}var rn=Ke.toString;if(Yn(rn)){var Pr=rn.call(Ke);if(!Nn(Pr))return Pr}}throw new TypeError}function si(Ke){return!!Ke}function Ri(Ke){return""+Ke}function ki(Ke){var Rt=ra(Ke,3);return sn(Rt)?Rt:Ri(Rt)}function di(Ke){return Array.isArray?Array.isArray(Ke):Ke instanceof Object?Ke instanceof Array:Object.prototype.toString.call(Ke)==="[object Array]"}function Yn(Ke){return typeof Ke=="function"}function ri(Ke){return typeof Ke=="function"}function Ao(Ke){switch(Zr(Ke)){case 3:return!0;case 4:return!0;default:return!1}}function Na(Ke,Rt){var vr=Ke[Rt];if(vr!=null){if(!Yn(vr))throw new TypeError;return vr}}function ma(Ke){var Rt=Na(Ke,Xe);if(!Yn(Rt))throw new TypeError;var vr=Rt.call(Ke);if(!Nn(vr))throw new TypeError;return vr}function wt(Ke){return Ke.value}function ve(Ke){var Rt=Ke.next();return Rt.done?!1:Rt}function se(Ke){var Rt=Ke.return;Rt&&Rt.call(Ke)}function xe(Ke){var Rt=Object.getPrototypeOf(Ke);if(typeof Ke!="function"||Ke===Pt||Rt!==Pt)return Rt;var vr=Ke.prototype,Pr=vr&&Object.getPrototypeOf(vr);if(Pr==null||Pr===Object.prototype)return Rt;var Xr=Pr.constructor;return typeof Xr!="function"||Xr===Ke?Rt:Xr}function z(){var Ke={},Rt=[],vr=function(){function jn(Zn,an,ui){this._index=0,this._keys=Zn,this._values=an,this._selector=ui}return jn.prototype["@@iterator"]=function(){return this},jn.prototype[Xe]=function(){return this},jn.prototype.next=function(){var Zn=this._index;if(Zn>=0&&Zn<this._keys.length){var an=this._selector(this._keys[Zn],this._values[Zn]);return Zn+1>=this._keys.length?(this._index=-1,this._keys=Rt,this._values=Rt):this._index++,{value:an,done:!1}}return{value:void 0,done:!0}},jn.prototype.throw=function(Zn){throw this._index>=0&&(this._index=-1,this._keys=Rt,this._values=Rt),Zn},jn.prototype.return=function(Zn){return this._index>=0&&(this._index=-1,this._keys=Rt,this._values=Rt),{value:Zn,done:!0}},jn}();return function(){function jn(){this._keys=[],this._values=[],this._cacheKey=Ke,this._cacheIndex=-2}return Object.defineProperty(jn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),jn.prototype.has=function(Zn){return this._find(Zn,!1)>=0},jn.prototype.get=function(Zn){var an=this._find(Zn,!1);return an>=0?this._values[an]:void 0},jn.prototype.set=function(Zn,an){var ui=this._find(Zn,!0);return this._values[ui]=an,this},jn.prototype.delete=function(Zn){var an=this._find(Zn,!1);if(an>=0){for(var ui=this._keys.length,fi=an+1;fi<ui;fi++)this._keys[fi-1]=this._keys[fi],this._values[fi-1]=this._values[fi];return this._keys.length--,this._values.length--,Zn===this._cacheKey&&(this._cacheKey=Ke,this._cacheIndex=-2),!0}return!1},jn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ke,this._cacheIndex=-2},jn.prototype.keys=function(){return new vr(this._keys,this._values,Pr)},jn.prototype.values=function(){return new vr(this._keys,this._values,Xr)},jn.prototype.entries=function(){return new vr(this._keys,this._values,rn)},jn.prototype["@@iterator"]=function(){return this.entries()},jn.prototype[Xe]=function(){return this.entries()},jn.prototype._find=function(Zn,an){return this._cacheKey!==Zn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Zn)),this._cacheIndex<0&&an&&(this._cacheIndex=this._keys.length,this._keys.push(Zn),this._values.push(void 0)),this._cacheIndex},jn}();function Pr(jn,Zn){return jn}function Xr(jn,Zn){return Zn}function rn(jn,Zn){return[jn,Zn]}}function et(){return function(){function Ke(){this._map=new Nt}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ke.prototype.has=function(Rt){return this._map.has(Rt)},Ke.prototype.add=function(Rt){return this._map.set(Rt,Rt),this},Ke.prototype.delete=function(Rt){return this._map.delete(Rt)},Ke.prototype.clear=function(){this._map.clear()},Ke.prototype.keys=function(){return this._map.keys()},Ke.prototype.values=function(){return this._map.values()},Ke.prototype.entries=function(){return this._map.entries()},Ke.prototype["@@iterator"]=function(){return this.keys()},Ke.prototype[Xe]=function(){return this.keys()},Ke}()}function Qt(){var Ke=16,Rt=bt.create(),vr=Pr();return function(){function an(){this._key=Pr()}return an.prototype.has=function(ui){var fi=Xr(ui,!1);return fi!==void 0?bt.has(fi,this._key):!1},an.prototype.get=function(ui){var fi=Xr(ui,!1);return fi!==void 0?bt.get(fi,this._key):void 0},an.prototype.set=function(ui,fi){var Hi=Xr(ui,!0);return Hi[this._key]=fi,this},an.prototype.delete=function(ui){var fi=Xr(ui,!1);return fi!==void 0?delete fi[this._key]:!1},an.prototype.clear=function(){this._key=Pr()},an}();function Pr(){var an;do an="@@WeakMap@@"+Zn();while(bt.has(Rt,an));return Rt[an]=!0,an}function Xr(an,ui){if(!W.call(an,vr)){if(!ui)return;Object.defineProperty(an,vr,{value:bt.create()})}return an[vr]}function rn(an,ui){for(var fi=0;fi<ui;++fi)an[fi]=Math.random()*255|0;return an}function jn(an){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(an)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(an)):rn(new Uint8Array(an),an):rn(new Array(an),an)}function Zn(){var an=jn(Ke);an[6]=an[6]&79|64,an[8]=an[8]&191|128;for(var ui="",fi=0;fi<Ke;++fi){var Hi=an[fi];(fi===4||fi===6||fi===8)&&(ui+="-"),Hi<16&&(ui+="0"),ui+=Hi.toString(16).toLowerCase()}return ui}}function zr(Ke){return Ke.__=void 0,delete Ke.__,Ke}})})(re||(re={}))},69848:function(Fr){(function(fe,Q){Fr.exports=Q()})(this,function(){"use strict";function fe(Tt,ht,Wt,mt,fr,Lr){if(!(fr-mt<=Wt)){var te=mt+fr>>1;Q(Tt,ht,te,mt,fr,Lr%2),fe(Tt,ht,Wt,mt,te-1,Lr+1),fe(Tt,ht,Wt,te+1,fr,Lr+1)}}function Q(Tt,ht,Wt,mt,fr,Lr){for(;fr>mt;){if(fr-mt>600){var te=fr-mt+1,Ne=Wt-mt+1,N=Math.log(te),U=.5*Math.exp(2*N/3),le=.5*Math.sqrt(N*U*(te-U)/te)*(Ne-te/2<0?-1:1),He=Math.max(mt,Math.floor(Wt-Ne*U/te+le)),Je=Math.min(fr,Math.floor(Wt+(te-Ne)*U/te+le));Q(Tt,ht,Wt,He,Je,Lr)}var ft=ht[2*Wt+Lr],Vt=mt,nr=fr;for(Ae(Tt,ht,mt,Wt),ht[2*fr+Lr]>ft&&Ae(Tt,ht,mt,fr);Vt<nr;){for(Ae(Tt,ht,Vt,nr),Vt++,nr--;ht[2*Vt+Lr]<ft;)Vt++;for(;ht[2*nr+Lr]>ft;)nr--}ht[2*mt+Lr]===ft?Ae(Tt,ht,mt,nr):(nr++,Ae(Tt,ht,nr,fr)),nr<=Wt&&(mt=nr+1),Wt<=nr&&(fr=nr-1)}}function Ae(Tt,ht,Wt,mt){re(Tt,Wt,mt),re(ht,2*Wt,2*mt),re(ht,2*Wt+1,2*mt+1)}function re(Tt,ht,Wt){var mt=Tt[ht];Tt[ht]=Tt[Wt],Tt[Wt]=mt}function y(Tt,ht,Wt,mt,fr,Lr,te){for(var Ne=[0,Tt.length-1,0],N=[],U,le;Ne.length;){var He=Ne.pop(),Je=Ne.pop(),ft=Ne.pop();if(Je-ft<=te){for(var Vt=ft;Vt<=Je;Vt++)U=ht[2*Vt],le=ht[2*Vt+1],U>=Wt&&U<=fr&&le>=mt&&le<=Lr&&N.push(Tt[Vt]);continue}var nr=Math.floor((ft+Je)/2);U=ht[2*nr],le=ht[2*nr+1],U>=Wt&&U<=fr&&le>=mt&&le<=Lr&&N.push(Tt[nr]);var Zr=(He+1)%2;(He===0?Wt<=U:mt<=le)&&(Ne.push(ft),Ne.push(nr-1),Ne.push(Zr)),(He===0?fr>=U:Lr>=le)&&(Ne.push(nr+1),Ne.push(Je),Ne.push(Zr))}return N}function Se(Tt,ht,Wt,mt,fr,Lr){for(var te=[0,Tt.length-1,0],Ne=[],N=fr*fr;te.length;){var U=te.pop(),le=te.pop(),He=te.pop();if(le-He<=Lr){for(var Je=He;Je<=le;Je++)W(ht[2*Je],ht[2*Je+1],Wt,mt)<=N&&Ne.push(Tt[Je]);continue}var ft=Math.floor((He+le)/2),Vt=ht[2*ft],nr=ht[2*ft+1];W(Vt,nr,Wt,mt)<=N&&Ne.push(Tt[ft]);var Zr=(U+1)%2;(U===0?Wt-fr<=Vt:mt-fr<=nr)&&(te.push(He),te.push(ft-1),te.push(Zr)),(U===0?Wt+fr>=Vt:mt+fr>=nr)&&(te.push(ft+1),te.push(le),te.push(Zr))}return Ne}function W(Tt,ht,Wt,mt){var fr=Tt-Wt,Lr=ht-mt;return fr*fr+Lr*Lr}var ge=function(Tt){return Tt[0]},ce=function(Tt){return Tt[1]},Xe=function(ht,Wt,mt,fr,Lr){Wt===void 0&&(Wt=ge),mt===void 0&&(mt=ce),fr===void 0&&(fr=64),Lr===void 0&&(Lr=Float64Array),this.nodeSize=fr,this.points=ht;for(var te=ht.length<65536?Uint16Array:Uint32Array,Ne=this.ids=new te(ht.length),N=this.coords=new Lr(ht.length*2),U=0;U<ht.length;U++)Ne[U]=U,N[2*U]=Wt(ht[U]),N[2*U+1]=mt(ht[U]);fe(Ne,N,fr,0,Ne.length-1,0)};Xe.prototype.range=function(ht,Wt,mt,fr){return y(this.ids,this.coords,ht,Wt,mt,fr,this.nodeSize)},Xe.prototype.within=function(ht,Wt,mt){return Se(this.ids,this.coords,ht,Wt,mt,this.nodeSize)};var me={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Tt){return Tt}},qe=Math.fround||function(Tt){return function(ht){return Tt[0]=+ht,Tt[0]}}(new Float32Array(1)),lt=function(ht){this.options=_r(Object.create(me),ht),this.trees=new Array(this.options.maxZoom+1)};lt.prototype.load=function(ht){var Wt=this.options,mt=Wt.log,fr=Wt.minZoom,Lr=Wt.maxZoom,te=Wt.nodeSize;mt&&console.time("total time");var Ne="prepare "+ht.length+" points";mt&&console.time(Ne),this.points=ht;for(var N=[],U=0;U<ht.length;U++)!ht[U].geometry||N.push(Pt(ht[U],U));this.trees[Lr+1]=new Xe(N,J,lr,te,Float32Array),mt&&console.timeEnd(Ne);for(var le=Lr;le>=fr;le--){var He=+Date.now();N=this._cluster(N,le),this.trees[le]=new Xe(N,J,lr,te,Float32Array),mt&&console.log("z%d: %d clusters in %dms",le,N.length,+Date.now()-He)}return mt&&console.timeEnd("total time"),this},lt.prototype.getClusters=function(ht,Wt){var mt=((ht[0]+180)%360+360)%360-180,fr=Math.max(-90,Math.min(90,ht[1])),Lr=ht[2]===180?180:((ht[2]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,ht[3]));if(ht[2]-ht[0]>=360)mt=-180,Lr=180;else if(mt>Lr){var Ne=this.getClusters([mt,fr,180,te],Wt),N=this.getClusters([-180,fr,Lr,te],Wt);return Ne.concat(N)}for(var U=this.trees[this._limitZoom(Wt)],le=U.range(pr(mt),Xt(te),pr(Lr),Xt(fr)),He=[],Je=0,ft=le;Je<ft.length;Je+=1){var Vt=ft[Je],nr=U.points[Vt];He.push(nr.numPoints?ur(nr):this.points[nr.index])}return He},lt.prototype.getChildren=function(ht){var Wt=this._getOriginId(ht),mt=this._getOriginZoom(ht),fr="No cluster with the specified id.",Lr=this.trees[mt];if(!Lr)throw new Error(fr);var te=Lr.points[Wt];if(!te)throw new Error(fr);for(var Ne=this.options.radius/(this.options.extent*Math.pow(2,mt-1)),N=Lr.within(te.x,te.y,Ne),U=[],le=0,He=N;le<He.length;le+=1){var Je=He[le],ft=Lr.points[Je];ft.parentId===ht&&U.push(ft.numPoints?ur(ft):this.points[ft.index])}if(U.length===0)throw new Error(fr);return U},lt.prototype.getLeaves=function(ht,Wt,mt){Wt=Wt||10,mt=mt||0;var fr=[];return this._appendLeaves(fr,ht,Wt,mt,0),fr},lt.prototype.getTile=function(ht,Wt,mt){var fr=this.trees[this._limitZoom(ht)],Lr=Math.pow(2,ht),te=this.options,Ne=te.extent,N=te.radius,U=N/Ne,le=(mt-U)/Lr,He=(mt+1+U)/Lr,Je={features:[]};return this._addTileFeatures(fr.range((Wt-U)/Lr,le,(Wt+1+U)/Lr,He),fr.points,Wt,mt,Lr,Je),Wt===0&&this._addTileFeatures(fr.range(1-U/Lr,le,1,He),fr.points,Lr,mt,Lr,Je),Wt===Lr-1&&this._addTileFeatures(fr.range(0,le,U/Lr,He),fr.points,-1,mt,Lr,Je),Je.features.length?Je:null},lt.prototype.getClusterExpansionZoom=function(ht){for(var Wt=this._getOriginZoom(ht)-1;Wt<=this.options.maxZoom;){var mt=this.getChildren(ht);if(Wt++,mt.length!==1)break;ht=mt[0].properties.cluster_id}return Wt},lt.prototype._appendLeaves=function(ht,Wt,mt,fr,Lr){for(var te=this.getChildren(Wt),Ne=0,N=te;Ne<N.length;Ne+=1){var U=N[Ne],le=U.properties;if(le&&le.cluster?Lr+le.point_count<=fr?Lr+=le.point_count:Lr=this._appendLeaves(ht,le.cluster_id,mt,fr,Lr):Lr<fr?Lr++:ht.push(U),ht.length===mt)break}return Lr},lt.prototype._addTileFeatures=function(ht,Wt,mt,fr,Lr,te){for(var Ne=0,N=ht;Ne<N.length;Ne+=1){var U=N[Ne],le=Wt[U],He=le.numPoints,Je=void 0,ft=void 0,Vt=void 0;if(He)Je=Nt(le),ft=le.x,Vt=le.y;else{var nr=this.points[le.index];Je=nr.properties,ft=pr(nr.geometry.coordinates[0]),Vt=Xt(nr.geometry.coordinates[1])}var Zr={type:1,geometry:[[Math.round(this.options.extent*(ft*Lr-mt)),Math.round(this.options.extent*(Vt*Lr-fr))]],tags:Je},Dr=void 0;He?Dr=le.id:this.options.generateId?Dr=le.index:this.points[le.index].id&&(Dr=this.points[le.index].id),Dr!==void 0&&(Zr.id=Dr),te.features.push(Zr)}},lt.prototype._limitZoom=function(ht){return Math.max(this.options.minZoom,Math.min(Math.floor(+ht),this.options.maxZoom+1))},lt.prototype._cluster=function(ht,Wt){for(var mt=[],fr=this.options,Lr=fr.radius,te=fr.extent,Ne=fr.reduce,N=fr.minPoints,U=Lr/(te*Math.pow(2,Wt)),le=0;le<ht.length;le++){var He=ht[le];if(!(He.zoom<=Wt)){He.zoom=Wt;for(var Je=this.trees[Wt+1],ft=Je.within(He.x,He.y,U),Vt=He.numPoints||1,nr=Vt,Zr=0,Dr=ft;Zr<Dr.length;Zr+=1){var Xn=Dr[Zr],sn=Je.points[Xn];sn.zoom>Wt&&(nr+=sn.numPoints||1)}if(nr>Vt&&nr>=N){for(var Nn=He.x*Vt,ra=He.y*Vt,xi=Ne&&Vt>1?this._map(He,!0):null,si=(le<<5)+(Wt+1)+this.points.length,Ri=0,ki=ft;Ri<ki.length;Ri+=1){var di=ki[Ri],Yn=Je.points[di];if(!(Yn.zoom<=Wt)){Yn.zoom=Wt;var ri=Yn.numPoints||1;Nn+=Yn.x*ri,ra+=Yn.y*ri,Yn.parentId=si,Ne&&(xi||(xi=this._map(He,!0)),Ne(xi,this._map(Yn)))}}He.parentId=si,mt.push(bt(Nn/nr,ra/nr,si,nr,xi))}else if(mt.push(He),nr>1)for(var Ao=0,Na=ft;Ao<Na.length;Ao+=1){var ma=Na[Ao],wt=Je.points[ma];wt.zoom<=Wt||(wt.zoom=Wt,mt.push(wt))}}}return mt},lt.prototype._getOriginId=function(ht){return ht-this.points.length>>5},lt.prototype._getOriginZoom=function(ht){return(ht-this.points.length)%32},lt.prototype._map=function(ht,Wt){if(ht.numPoints)return Wt?_r({},ht.properties):ht.properties;var mt=this.points[ht.index].properties,fr=this.options.map(mt);return Wt&&fr===mt?_r({},fr):fr};function bt(Tt,ht,Wt,mt,fr){return{x:qe(Tt),y:qe(ht),zoom:Infinity,id:Wt,parentId:-1,numPoints:mt,properties:fr}}function Pt(Tt,ht){var Wt=Tt.geometry.coordinates,mt=Wt[0],fr=Wt[1];return{x:qe(pr(mt)),y:qe(Xt(fr)),zoom:Infinity,index:ht,parentId:-1}}function ur(Tt){return{type:"Feature",id:Tt.id,properties:Nt(Tt),geometry:{type:"Point",coordinates:[It(Tt.x),kt(Tt.y)]}}}function Nt(Tt){var ht=Tt.numPoints,Wt=ht>=1e4?Math.round(ht/1e3)+"k":ht>=1e3?Math.round(ht/100)/10+"k":ht;return _r(_r({},Tt.properties),{cluster:!0,cluster_id:Tt.id,point_count:ht,point_count_abbreviated:Wt})}function pr(Tt){return Tt/360+.5}function Xt(Tt){var ht=Math.sin(Tt*Math.PI/180),Wt=.5-.25*Math.log((1+ht)/(1-ht))/Math.PI;return Wt<0?0:Wt>1?1:Wt}function It(Tt){return(Tt-.5)*360}function kt(Tt){var ht=(180-Tt*360)*Math.PI/180;return 360*Math.atan(Math.exp(ht))/Math.PI-90}function _r(Tt,ht){for(var Wt in ht)Tt[Wt]=ht[Wt];return Tt}function J(Tt){return Tt.x}function lr(Tt){return Tt.y}return lt})}}]);
