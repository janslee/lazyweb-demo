(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6955],{6955:function(Ie,$,z){"use strict";z.d($,{Z:function(){return hS}});var ae=z(67294),Y=z(70655),Z=z(41694),A=z(28991),W=z(28481),k=z(92137),R=z(6610),T=z(5991),ne=z(87757),y=z.n(ne),E=z(63349),F=z(10379),O=z(46070),b=z(77608),d=z(96156),Ee=z(28660),pe=z(26729),Qe=z.n(pe),j=z(86700),Q0=z(84879),w={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},q0=z(57869),hn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Pr(r){this.message=r}Pr.prototype=new Error,Pr.prototype.name="InvalidCharacterError";function J0(r){var a=String(r).replace(/=+$/,"");if(a.length%4==1)throw new Pr("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,e,i,o=0;i=a.charAt(o++);~i&&(e=n%4?e*64+i:i,n++%4)?t+=String.fromCharCode(255&e>>(-2*n&6)):0)i=hn.indexOf(i);return t}function Ma(r){r=String(r);for(var a,t,n,e,i="",o=0,u=r.length%3;o<r.length;){if((t=r.charCodeAt(o++))>255||(n=r.charCodeAt(o++))>255||(e=r.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=t<<16|n<<8|e,i+=hn.charAt(a>>18&63)+hn.charAt(a>>12&63)+hn.charAt(a>>6&63)+hn.charAt(a&63)}return u?i.slice(0,u-3)+"===".substring(u):i}var ep=function(){function r(a,t){(0,R.Z)(this,r),this.buffers=a,this.type=t}return(0,T.Z)(r,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,e){throw new Error("not implemented")}}]),r}(),Br,tp=function(){return Br||(Br=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof z.g!="undefined"?z.g:{})};Br=tp();var Ve;typeof window=="undefined"?Ve={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ve=window;var np=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,rp=np?my.getSystemInfoSync().pixelRatio:Ve.devicePixelRatio,dn=(0,T.Z)(function r(a,t){(0,R.Z)(this,r),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()});function ip(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=ap(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function ap(r,a){if(!!r){if(typeof r=="string")return La(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return La(r,a)}}function La(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var vn=new WeakMap,Nr=function(){function r(){(0,R.Z)(this,r),vn.set(this,{})}return(0,T.Z)(r,[{key:"addEventListener",value:function(t,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=vn.get(this);i||(i={}),i[t]||(i[t]=[]),i[t].push(n),vn.set(this,i),e.capture,e.once,e.passive}},{key:"removeEventListener",value:function(t,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=vn.get(this);if(i){var o=i[t];if(o&&o.length>0){for(var u=o.length;u--;u>0)if(o[u]===n){o.splice(u,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=vn.get(this)[t.type];if(n){var e=ip(n),i;try{for(e.s();!(i=e.n()).done;){var o=i.value;o(t)}}catch(u){e.e(u)}finally{e.f()}}}}]),r}();function op(r){var a=up();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function up(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ra=function(r){(0,F.Z)(t,r);var a=op(t);function t(){var n;return(0,R.Z)(this,t),n=a.call(this),n.childNodes=[],n}return(0,T.Z)(t,[{key:"appendChild",value:function(e){this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var i=this.childNodes.findIndex(function(o){return o===e});return i>-1?this.childNodes.splice(i,1):null}}]),t}(Nr);function sp(r){var a=lp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function lp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var ka=function(r){(0,F.Z)(t,r);var a=sp(t);function t(){var n;return(0,R.Z)(this,t),n=a.call(this),n.className="",n.children=[],n}return(0,T.Z)(t,[{key:"setAttribute",value:function(e,i){this[e]=i}},{key:"getAttribute",value:function(e){return this[e]}},{key:"setAttributeNS",value:function(e,i){this[e]=i}},{key:"getAttributeNS",value:function(e){return this[e]}}]),t}(Ra),cp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Zr,zr,Ur,Hr;if(cp){var Yn=my.getSystemInfoSync();Zr=Yn.screenWidth,zr=Yn.screenHeight,Ur=Yn.windowWidth,Hr=Yn.windowHeight}else{var Fa=Ve.innerWidth,wa=Ve.innerHeight;Zr=Fa,zr=wa,Ur=Fa,Hr=wa}var gn={width:Zr,height:zr,availWidth:Ur,availHeight:Hr,availLeft:0,availTop:0},Kn=gn.availWidth,Qn=gn.availHeight,Oa={style:[]};function Da(r,a){if(!("parentNode"in r)){var t;a===0?t=function(){return null}:a===1?t=function(){return Oa}:t=function(){return null},Object.defineProperty(r,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in r)){var n;a===0?n=function(){return null}:a===1?n=function(){return Oa}:n=function(){return null},Object.defineProperty(r,"parentElement",{enumerable:!0,get:n})}}function fp(r){r.style=r.style||{},Object.assign(r.style,{top:"0px",left:"0px",width:Kn+"px",height:Qn+"px",margin:"0px",padding:"0px"})}function pp(r){"clientLeft"in r||(r.clientLeft=0,r.clientTop=0),"clientWidth"in r||(r.clientWidth=Kn,r.clientHeight=Qn),"getBoundingClientRect"in r||(r.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function hp(r){"offsetLeft"in r||(r.offsetLeft=0,r.offsetTop=0),"offsetWidth"in r||(r.offsetWidth=Kn,r.offsetHeight=Qn)}function dp(r){"scrollLeft"in r||(r.scrollLeft=0,r.scrollTop=0),"scrollWidth"in r||(r.scrollWidth=Kn,r.scrollHeight=Qn)}function Ia(r){var a=function(){return!0};r.classList=[],r.classList.add=a,r.classList.remove=a,r.classList.contains=a,r.classList.toggle=a}function vp(r){var a=gp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function gp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}function $t(){}var Xt=function(r){(0,F.Z)(t,r);var a=vp(t);function t(){var n,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return(0,R.Z)(this,t),n=a.call(this),n.className="",n.children=[],n.focus=$t,n.blur=$t,n.insertBefore=$t,n.appendChild=$t,n.removeChild=$t,n.remove=$t,n.innerHTML="",n.tagName=e.toUpperCase(),Da((0,E.Z)(n),i),fp((0,E.Z)(n)),Ia((0,E.Z)(n)),pp((0,E.Z)(n)),hp((0,E.Z)(n)),dp((0,E.Z)(n)),n}return(0,T.Z)(t)}(ka);function mp(r){var a=yp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function yp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Pa=function(r){(0,F.Z)(t,r);var a=mp(t);function t(n){return(0,R.Z)(this,t),a.call(this,n)}return(0,T.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(Xt);function _p(r){var a=Ep();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Ep(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ba=function(r){(0,F.Z)(t,r);var a=_p(t);function t(){return(0,R.Z)(this,t),a.call(this,"video")}return(0,T.Z)(t)}(Pa),Pe={},Ge={};function vS(r,a){Pe=r,Pe.id=a,"tagName"in Pe||(Pe.tagName="CANVAS"),Pe.type="canvas",Mixin.parentNode(Pe),Mixin.style(Pe),Mixin.classList(Pe),Mixin.clientRegion(Pe),Mixin.offsetRegion(Pe),Pe.focus=function(){},Pe.blur=function(){}}function gS(r,a){var t=1024,n=1024;Ge={width:t,height:n,clientWidth:t/devicePixelRatio,clientHeight:n/devicePixelRatio,id:a,type:"canvas"},"tagName"in Ge||(Ge.tagName="CANVAS"),Mixin.parentNode(Ge),Mixin.style(Ge),Mixin.classList(Ge),Mixin.clientRegion(Ge),Mixin.offsetRegion(Ge),Ge.getContext=function(e){if(e==="2d")return r},Ge.focus=function(){},Ge.blur=function(){}}function ut(){return Pe}function mS(){return Ge}var Na=(0,T.Z)(function r(){(0,R.Z)(this,r);var a=ut(),t=a.createImage&&a.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=r.prototype),Da(t),Ia(t),Object.assign(t,{addEventListener:function(e,i){t["on".concat(e)]=i.bind(t)},removeEventListener:function(e){t["on".concat(e)]=null}}),t}),Za={href:"",protocol:"",host:""};function za(r){var a=xp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function xp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Cp=function(r){(0,F.Z)(t,r);var a=za(t);function t(){return(0,R.Z)(this,t),a.call(this,"body",0)}return(0,T.Z)(t,[{key:"addEventListener",value:function(e,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(e,i,o){}},{key:"dispatchEvent",value:function(e){}}]),t}(Xt),Sp=function(r){(0,F.Z)(t,r);var a=za(t);function t(){return(0,R.Z)(this,t),a.call(this,"html",0)}return(0,T.Z)(t,[{key:"addEventListener",value:function(e,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(e,i){}},{key:"dispatchEvent",value:function(e){}}]),t}(Xt),mn={},qe={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Za,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new Na:a==="video"?new Ba:new Xt(a)},createElementNS:function(a,t){return this.createElement(t)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,t){return this.getElementsByTagName(t)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,t,n){mn[a]||(mn[a]=[]),mn[a].push(t)},removeEventListener:function(a,t){var n=mn[a];if(n&&n.length>0){for(var e=n.length;e--;e>0)if(n[e]===t){n.splice(e,1);break}}},dispatchEvent:function(a){var t=a.type,n=mn[t];if(n)for(var e=0;e<n.length;e++)n[e](a);a.target&&typeof a.target["on"+t]=="function"&&a.target["on"+t](a)},createEvent:function(a){return new dn(a)}};qe.documentElement=new Sp,qe.head=new Xt("head"),qe.body=new Cp;var bp=Object,yn=z(90484),Ap=function(){function r(){(0,R.Z)(this,r);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,yn.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,T.Z)(r,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),r}(),Tp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,jr,Oe,qn;if(Tp){var Vr=my.getSystemInfoSync();jr=Vr.system,Oe=Vr.platform,qn=Vr.language}else{var Be={versions:function(){var r=Ve.navigator.userAgent;return{trident:r.indexOf("Trident")>-1,presto:r.indexOf("Presto")>-1,webKit:r.indexOf("AppleWebKit")>-1,gecko:r.indexOf("Gecko")>-1&&r.indexOf("KHTML")===-1,mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:r.indexOf("Android")>-1||r.indexOf("Linux")>-1,iPhone:r.indexOf("iPhone")>-1,iPad:r.indexOf("iPad")>-1,webApp:r.indexOf("Safari")===-1,weixin:r.indexOf("MicroMessenger")>-1,qq:r.match(/\sQQ/i)===" qq"}}(),language:(Ve.navigator.browserLanguage||Ve.navigator.language).toLowerCase()};Be.versions.android?Oe="android":Be.versions.trident?Oe="IE":Be.versions.presto?Oe="Opera":Be.versions.webKit?Oe="webKit":Be.versions.gecko?Oe="Firefox":Be.versions.mobile?Oe="mobile":Be.versions.ios?Oe="ios":Be.versions.iPhone?Oe="iPhone":Be.versions.iPad?Oe="ipad":Be.versions.webApp?Oe="webApp":Be.versions.weixin?Oe="weixin":Be.versions.qq&&(Oe="qq"),jr=Ve.navigator.userAgent,qn=Be.language}var Mp=jr.toLowerCase().indexOf("android")!==-1,Ua=Mp?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Lp="Mozilla/5.0 (".concat(Ua,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(qn),Rp={platform:Oe,language:qn,appVersion:"5.0 (".concat(Ua,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Lp},kp={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,n){return{duration:0}},now:function(){}},Ha=0,ja=0;function Fp(r){var a=Date.now(),t=Math.max(Ha+23,a);return ja=setTimeout(function(){r(Ha=t)},t-a),ja}function wp(r){var a=ut();return a.requestAnimationFrame?a.requestAnimationFrame(r):Fp(r)}function Op(r){var a=ut();return a.cancelAnimationFrame?a.cancelAnimationFrame(r):clearTimeout(r)}var Dp=function(){function r(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,R.Z)(this,r),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=t+a}return(0,T.Z)(r,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],e=t.type,i=Ip(n),o="data:".concat(e,";base64, ");return o+i}}]),r}();function Ip(r){for(var a="",t=new Uint8Array(r),n=t.byteLength,e=0;e<n;e++)a+=String.fromCharCode(t[e]);return Ma(a)}var Pp={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Bp={};function Np(r){var a=Zp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Zp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Gr=new Map,Va=new Map,zp=new Map,yS={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Up(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(r)]=="function"&&this["on".concat(r)].call(this,a)}function _S(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:r};this.readyState=r,Up.call(this,"readystatechange",a)}var Ft=function(r){(0,F.Z)(t,r);var a=Np(t);function t(){var n;return(0,R.Z)(this,t),n=a.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Gr.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,T.Z)(t,[{key:"responseType",set:function(e){this._responseType=e}},{key:"abort",value:function(){var e=zp.get("requestTask");e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=Va.get("responseHeader");return Object.keys(e).map(function(i){return"".concat(i,": ").concat(e[i])}).join(`
`)}},{key:"getResponseHeader",value:function(e){return Va.get("responseHeader")[e]}},{key:"open",value:function(e,i,o){this._method=e,this._url=i}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(e,i){var o=Gr.get("requestHeader");o[e]=i,Gr.set("requestHeader",o)}},{key:"addEventListener",value:function(e,i){var o=this;typeof i=="function"&&(this["on"+e]=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};u.target=u.target||o,i.call(o,u)})}},{key:"removeEventListener",value:function(e,i){this["on"+e]===i&&(this["on"+e]=null)}}]),t}(Nr);Ft.UNSEND=0,Ft.OPENED=1,Ft.HEADERS_RECEIVED=2,Ft.LOADING=3,Ft.DONE=4;function Hp(r){var a=jp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function jp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var ES=function(r){(0,F.Z)(t,r);var a=Hp(t);function t(n){return(0,R.Z)(this,t),a.call(this,n)}return(0,T.Z)(t)}(dn);function Wr(r){return function(a){a.type=r,qe.dispatchEvent(a)}}var xS=Wr("mousedown"),CS=Wr("mousemove"),SS=Wr("mouseup");function Vp(r){var a=Gp();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Gp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Wp=function(r){(0,F.Z)(t,r);var a=Vp(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this,n),e.target=ut(),e.currentTarget=ut(),e}return(0,T.Z)(t)}(dn),Ga=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],$p=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Xp="touch";function Yp(r,a,t){for(var n=new Wp(r),e=0;e<Ga.length;e++){var i=Ga[e];n[i]=a[i]||$p[e]}return n.type=r,n.target=ut(),n.currentTarget=ut(),n.buttons=Kp(r),n.which=n.buttons,n.pointerId=(a.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(a.radiusX||.5)*2,n.height=(a.radiusY||.5)*2,n.pressure=a.force||.5,n.isPrimary=Qp(a),n.pointerType=Xp,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function Kp(r){var a=0;return(r==="touchstart"||r==="touchmove"||r==="pointerdown"||r==="pointermove")&&(a=1),a}var _n=null;function Qp(r){return _n===r.identifier}function qp(r){_n===null&&(_n=r.identifier)}function Jp(r){_n===r.identifier&&(_n=null)}function $r(r){return function(a){for(var t=a.changedTouches,n=0;n<t.length;n++){var e=t[n];n===0&&r==="pointerdown"?qp(e):(r==="pointerup"||r==="pointercancel")&&Jp(e);var i=Yp(r,e,a);qe.dispatchEvent(i)}}}var bS=$r("pointerdown"),AS=$r("pointermove"),TS=$r("pointerup");function eh(r){var a=th();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function th(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var nh=function(r){(0,F.Z)(t,r);var a=eh(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this,n),e.touches=[],e.targetTouches=[],e.changedTouches=[],e.target=ut(),e.currentTarget=ut(),e}return(0,T.Z)(t)}(dn);function Xr(r){var a=r||{},t=a.x,n=t===void 0?0:t,e=a.y,i=e===void 0?0:e,o=a.clientX,u=o===void 0?0:o,s=a.clientY,l=s===void 0?0:s;Object.keys(r).indexOf("x")!==-1?(r.pageX=r.clientX=n,r.pageY=r.clientY=i):(r.x=u,r.y=l)}function Yr(r){return function(a){var t=new nh(r);t.changedTouches=a.changedTouches,t.touches=a.touches,t.targetTouches=Array.prototype.slice.call(a.touches),t.timeStamp=a.timeStamp,t.changedTouches.forEach(function(n){return Xr(n)}),t.touches.forEach(function(n){return Xr(n)}),t.targetTouches.forEach(function(n){return Xr(n)}),qe.dispatchEvent(t)}}function rh(r){return function(a){a.type=r,qe.dispatchEvent(a)}}var MS=Yr("touchstart"),LS=Yr("touchmove"),RS=Yr("touchend"),kS=rh("mapCameaParams"),Wa=!1;function ih(r){Wa=r}var ah=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,oh=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ne=(ah||oh)&&Wa,uh={atob:J0,btoa:Ma,devicePixelRatio:rp,Blob:ep,document:qe,Element:ka,Event:dn,EventTarget:Nr,HTMLCanvasElement:bp,HTMLElement:Xt,HTMLMediaElement:Pa,HTMLVideoElement:Ba,Image:Na,ImageData:Ap,navigator:Rp,Node:Ra,requestAnimationFrame:wp,cancelAnimationFrame:Op,screen:gn,XMLHttpRequest:Ft,performance:kp,URL:Dp,WebGLRenderingContext:Pp,WebGL2RenderingContext:Bp,addEventListener:function(a,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};qe.addEventListener(a,t,n)},removeEventListener:function(a,t,n){qe.removeEventListener(a,t)},dispatchEvent:function(a){qe.dispatchEvent(a)},innerWidth:gn.availWidth,innerHeight:gn.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},se=Ne?uh:Ve,sh=Ne?Ft:Ve.XMLHttpRequest,FS=Ne?Za:Ve.location;function lh(r){var a=ch();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function ch(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var fh=function(r){(0,F.Z)(t,r);var a=lh(t);function t(n,e,i,o){var u;return(0,R.Z)(this,t),u=a.call(this,"AJAXError: ".concat(e," (").concat(n,"): ").concat(i)),u.status=n,u.statusText=e,u.url=i,u.body=o,u}return(0,T.Z)(t)}((0,q0.Z)(Error));function $a(r,a){var t=new sh,n=Array.isArray(r.url)?r.url[0]:r.url;t.open(r.method||"GET",n,!0),r.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var e in r.headers)r.headers.hasOwnProperty(e)&&t.setRequestHeader(e,r.headers[e]);return r.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=r.credentials==="include",t.onerror=function(){a(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var i=t.response;if(r.type==="json")try{i=JSON.parse(t.response)}catch(u){return a(u)}a(null,i,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});a(new fh(t.status,t.statusText,n.toString(),o))}},t.send(r.body),t}function ph(r){return new Promise(function(a,t){$a(r,function(n,e,i,o,u){n?t({err:n,data:null,xhr:u}):a({err:null,data:e,cacheControl:i,expires:o,xhr:u})})})}function Kr(r,a){return $a(r,a)}var hh=function(a,t){return Kr((0,A.Z)((0,A.Z)({},a),{},{type:"json"}),t)},Qr=function(a,t){return Kr((0,A.Z)((0,A.Z)({},a),{},{type:"arrayBuffer"}),t)},wS=function(a,t){return Kr(_objectSpread(_objectSpread({},a),{},{method:"POST"}),t)};function OS(r){var a=$window.document.createElement("a");return a.href=r,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var Xa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ya(r,a){var t=new se.Image,n=se.URL||se.webkitURL;t.crossOrigin="anonymous",t.onload=function(){a(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Xa})},t.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var e=new Blob([new Uint8Array(r)],{type:"image/png"});t.src=r.byteLength?n.createObjectURL(e):Xa}function Ka(r,a){var t=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(t).then(function(n){a(null,n)}).catch(function(n){a(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var qr=function(a,t,n){var e=function(o,u){if(o)t(o);else if(u){var s=typeof createImageBitmap=="function",l=n?n(u):u;s?Ka(l,t):Ya(l,t)}};return a.type==="json"?hh(a,e):Qr(a,e)},dh=function(a,t){var n=typeof createImageBitmap=="function";n?Ka(a,t):Ya(a,t)},Jr=function(r){return r.CENTER="center",r.TOP="top",r["TOP-LEFT"]="top-left",r["TOP-RIGHT"]="top-right",r.BOTTOM="bottom",r["BOTTOM-LEFT"]="bottom-left",r["BOTTOM-RIGHT"]="bottom-right",r.LEFT="left",r.RIGHT="right",r}({}),Jn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qa(r,a,t){var n=r.classList;for(var e in Jn)Jn.hasOwnProperty(e)&&n.remove("l7-".concat(t,"-anchor-").concat(e));n.add("l7-".concat(t,"-anchor-").concat(a))}var qa=z(2650);function DS(r){return typeof r=="string"?!!d3.color(r):!1}function ue(r){var a=qa.ZP(r),t=[0,0,0,0];return a!=null&&(t[0]=a.r/255,t[1]=a.g/255,t[2]=a.b/255,t[3]=a.opacity),t}function wt(r){var a=r&&r[0],t=r&&r[1],n=r&&r[2],e=a+t*256+n*65536-1;return e}function st(r){return[r+1&255,r+1>>8&255,r+1>>8>>8&255]}function Ja(r){var a=se.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;for(var n=null,e=t.createLinearGradient(0,0,256,1),i=r.positions[0],o=r.positions[r.positions.length-1],u=0;u<r.colors.length;++u){var s=(r.positions[u]-i)/(o-i);e.addColorStop(s,r.colors[u])}if(t.fillStyle=e,t.fillRect(0,0,256,1),Ne)return n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),a=null,t=null,{data:n,width:256,height:1};n=t.getImageData(0,0,256,1).data;for(var l=t.createImageData(256,1),c=0;c<l.data.length;c+=4)l.data[c+0]=n[c+0],l.data[c+1]=n[c+1],l.data[c+2]=n[c+2],l.data[c+3]=n[c+3];return a=null,t=null,l}function vh(r,a){var t=se.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var e=n.createLinearGradient(0,0,256,1),i=a[1]-a[0],o=0;o<r.colors.length;++o){var u=Math.max((r.positions[o]-a[0])/i,0);e.addColorStop(u,r.colors[o])}n.fillStyle=e,n.fillRect(0,0,256,1);var s=n.getImageData(0,0,256,1).data,l=ei(n,s);return t=null,n=null,l}function gh(r){var a=se.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;var n=t.createImageData(256,1);return n.data.fill(0),r.positions.forEach(function(e,i){var o=ue(r.colors[i]);n.data[e*4+0]=o[0]*255,n.data[e*4+1]=o[1]*255,n.data[e*4+2]=o[2]*255,n.data[e*4+3]=o[3]*255}),a=null,t=null,n}function mh(r){var a=se.document.createElement("canvas"),t=a.getContext("2d");t.globalAlpha=1,a.width=256,a.height=1;for(var n=256/r.colors.length,e=0;e<r.colors.length;e++)t.beginPath(),t.lineWidth=2,t.strokeStyle=r.colors[e],t.moveTo(e*n,0),t.lineTo((e+1)*n,0),t.stroke();var i=t.getImageData(0,0,256,1).data,o=ei(t,i);return a=null,t=null,o}function yh(r,a){var t=se.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var e=a[1]-a[0];r.positions.length-r.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var i=0;i<r.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=r.colors[i],n.moveTo((r.positions[i]-a[0])/e*255,0),n.lineTo((r.positions[i+1]-a[0])/e*255,0),n.stroke();var o=n.getImageData(0,0,256,1).data,u=ei(n,o);return t=null,n=null,u}function ei(r,a){for(var t=r.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=a[n+0],t.data[n+1]=a[n+1],t.data[n+2]=a[n+2],t.data[n+3]=a[n+3];return t}function ti(r){switch(r.type){case"cat":return[0,255];default:return[0,1]}}var Ot={BACK:1029,FRONT:1028};function ni(r){switch(r){case"GAODE1.x":return Ot.BACK;case"GAODE2.x":return Ot.BACK;case"MAPBOX":return Ot.FRONT;case"SIMPLE":return Ot.FRONT;case"GLOBEL":return Ot.BACK;case"DEBAULT":return Ot.FRONT;default:return Ot.FRONT}}var G=z(85061),N=z(96486);function eo(r){var a=r;return typeof r=="string"&&(a=se.document.getElementById(r)),a}function to(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function no(r){return to(r).split(/\s+/)}function _h(r){var a,t,n=se==null||(a=se.document)===null||a===void 0||(t=a.documentElement)===null||t===void 0?void 0:t.style;if(!n)return r[0];for(var e in r)if(r[e]&&r[e]in n)return r[e];return r[0]}function re(r,a,t){var n=se.document.createElement(r);return a&&(n.className=a||""),t&&t.appendChild(n),n}function Ze(r){var a=r.parentNode;a&&a.removeChild(r)}function Je(r,a){if(r.classList!==void 0)for(var t=no(a),n=0,e=t.length;n<e;n++)r.classList.add(t[n]);else if(!Eh(r,a)){var i=ri(r);ro(r,(i?i+" ":"")+a)}}function Dt(r,a){if(r.classList!==void 0){var t=no(a);t.forEach(function(n){r.classList.remove(n)})}else ro(r,to((" "+ri(r)+" ").replace(" "+a+" "," ")))}function Eh(r,a){if(r.classList!==void 0)return r.classList.contains(a);var t=ri(r);return t.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(t)}function ro(r,a){r instanceof HTMLElement?r.className=a:r.className.baseVal=a}function ri(r){return r instanceof SVGElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function IS(r){for(;r&&r.firstChild;)r.removeChild(r.firstChild)}var xh=_h(["transform","WebkitTransform"]);function io(r,a){r.style[xh]=a}function Ch(){if(typeof Event=="function")se.dispatchEvent(new Event("resize"));else{var r=se.document.createEvent("UIEvents");r.initUIEvent("resize",!0,!1,se,0),se.dispatchEvent(r)}}function PS(r){var a=["padding: "+(r.height/2-8)+"px "+r.width/2+"px;","line-height: "+r.height+"px;","background-image: url("+r.toDataURL()+");"];console.log(`%c
`,a.join(""))}function Sh(){var r,a=se.document.querySelector('meta[name="viewport"]');if(!a)return 1;var t=(r=a.content)===null||r===void 0?void 0:r.split(","),n=t.find(function(e){var i=e.split("="),o=(0,W.Z)(i,1),u=o[0];return u==="initial-scale"});return n?n.split("=")[1]*1:1}var ve=Sh()<1?1:se.devicePixelRatio;function ao(r,a){r.setAttribute("style","".concat(r.style.cssText).concat(a))}function oo(r){return r.split(";").map(function(a){return a.trim()}).filter(function(a){return a})}function BS(r,a){var t,n=oo((t=r.getAttribute("style"))!==null&&t!==void 0?t:""),e=oo(a),i=N.pull.apply(void 0,[n].concat((0,G.Z)(e)));r.setAttribute("style",i.join(";"))}function bh(r){return Object.entries(r).map(function(a){var t=(0,W.Z)(a,2),n=t[0],e=t[1];return"".concat(n,": ").concat(e)}).join(";")}function Ah(r,a){return{left:r.left-a.left,top:r.top-a.top,right:a.left+a.width-r.left-r.width,bottom:a.top+a.height-r.top-r.height}}function ii(r,a){r.checked=a,a?r.setAttribute("checked","true"):r.removeAttribute("checked")}function En(r){r.innerHTML=""}function uo(r){r.setAttribute("draggable","false")}function It(r,a){if(typeof a=="string"){var t=document.createElement("div");for(t.innerHTML=a;t.firstChild;)r.append(t.firstChild)}else Array.isArray(a)?r.append.apply(r,(0,G.Z)(a)):r.append(a)}function Th(r){return typeof ImageBitmap!="undefined"&&r instanceof ImageBitmap}function Mh(){return typeof importScripts=="function"}var NS=Mh()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},ai=navigator.userAgent,Lh=!!ai.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ZS=ai.indexOf("Android")>-1||ai.indexOf("Adr")>-1;function Rh(){for(var r=navigator.userAgent,a=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,e=a;n<e.length;n++){var i=e[n];if(r.indexOf(i)>0){t=!1;break}}return t}function so(r,a){r.forEach(function(t){!a[t]||(a[t]=a[t].bind(a))})}var zS=null,kh=z(41672),mt=z(40271);function oi(r){return typeof r=="number"}var er=2*Math.PI*6378137/2;function Fh(r,a){var t=(0,W.Z)(a,4),n=t[0],e=t[1],i=t[2],o=t[3];return r.lng>n&&r.lng<=i&&r.lat>e&&r.lat<=o}function wh(r){var a=[Infinity,Infinity,-Infinity,-Infinity];return r.forEach(function(t){var n=t.coordinates;lo(a,n)}),a}function lo(r,a){return Array.isArray(a[0])?a.forEach(function(t){lo(r,t)}):(r[0]>a[0]&&(r[0]=a[0]),r[1]>a[1]&&(r[1]=a[1]),r[2]<a[0]&&(r[2]=a[0]),r[3]<a[1]&&(r[3]=a[1])),r}function US(r,a){return co(r,a)}function co(r,a){return Array.isArray(r[0])?r.map(function(t){return co(t,a)}):a(r)}function ui(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};r=Ih(r,a);var n=r[0],e=r[1],i=n*er/180,o=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return o=o*er/180,t.enable&&(i=Number(i.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),r.length===3?[i,o,r[2]]:[i,o]}function HS(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=r[0],n=r[1],e=t/er*180,i=n/er*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),a!=null&&(e=Number(e.toFixed(a)),i=Number(i.toFixed(a))),r.length===3?[e,i,r[2]]:[e,i]}function Oh(r){if(r==null)throw new Error("lng is required");return(r>180||r<-180)&&(r=r%360,r>180&&(r=-360+r),r<-180&&(r=360+r),r===0&&(r=0)),r}function Dh(r){if(r==null)throw new Error("lat is required");return(r>90||r<-90)&&(r=r%180,r>90&&(r=-180+r),r<-90&&(r=180+r),r===0&&(r=0)),r}function Ih(r,a){if(a===!1)return r;var t=Oh(r[0]),n=Dh(r[1]);return n>85&&(n=85),n<-85&&(n=-85),r.length===3?[t,n,r[2]]:[t,n]}function be(r){var a=85.0511287798,t=Math.max(Math.min(a,r[1]),-a),n=256<<20,e=Math.PI/180,i=r[0]*e,o=t*e;o=Math.log(Math.tan(Math.PI/4+o/2));var u=.5/Math.PI,s=.5,l=-.5/Math.PI;return e=.5,i=n*(u*i+s),o=n*(l*o+e),[Math.floor(i),Math.floor(o)]}function jS(r){var a=.5/Math.PI,t=.5,n=-.5/Math.PI,e=.5,i=256<<20,o=_slicedToArray(r,2),u=o[0],s=o[1];u=(u/i-t)/a,s=(s/i-e)/n,s=(Math.atan(Math.pow(Math.E,s))-Math.PI/4)*2,e=Math.PI/180;var l=s/e,c=u/e;return[c,l]}function tr(r,a){var t=85.0511287798,n=Math.PI/180,e=6378137;return a=Math.max(Math.min(t,a),-t),r*=n,a*=n,a=Math.log(Math.tan(Math.PI/4+a/2)),[r*e,a*e]}function VS(r,a){var t=Math.PI/180,n=6378137,e=r/n/t,i=2*(Math.atan(Math.exp(a/n))-Math.PI/4)/t;return[e,i]}function Ph(r,a,t){var n=(0,mt.Ht)(a[1]-r[1]),e=(0,mt.Ht)(a[0]-r[0]),i=(0,mt.Ht)(r[1]),o=(0,mt.Ht)(a[1]),u=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(e/2),2)*Math.cos(i)*Math.cos(o);return(0,mt.DL)(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t="meters")}function GS(r){var a=Math.PI/180,t=85.0511287798,n=6378137,e=Math.max(Math.min(t,r[1]),-t),i=Math.sin(e*a),o=n*r[0]*a,u=n*Math.log((1+i)/(1-i))/2;return[o,u]}function xn(r,a){var t=Math.abs(r[1][1]-r[0][1])*a,n=Math.abs(r[1][0]-r[0][0])*a;return[[r[0][0]-n,r[0][1]-t],[r[1][0]+n,r[1][1]+t]]}function si(r,a){return r[0][0]<=a[0][0]&&r[0][1]<=a[0][1]&&r[1][0]>=a[1][0]&&r[1][1]>=a[1][1]}function nr(r){return[[r[0],r[1]],[r[2],r[3]]]}function fo(r){var a=po(r,[0,0]);return[r[0]/a,r[1]/a]}function po(r,a){return Math.sqrt(Math.pow(r[0]-a[0],2)+Math.pow(r[1]-a[1],2))}function Bh(r,a){return r[0]*a[0]+r[1]*a[1]}function ho(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function WS(r,a){return Math.acos(Bh(r,a)/(ho(r)*ho(a)))*180/Math.PI}function Nh(r,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function $S(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!r||r.length<2)){for(var t=[0,1],n=0,e=[],i=0;i<r.length-1;i++){var o=r[i],u=r[i+1],s=po(o,u);n+=s;var l=[o[0]-u[0],o[1]-u[1]],c=Nh(t,l);if(i>0){var f=e[i-1].rotation;f-c>360-f+c&&(c=c+360)}e.push({start:o,end:u,dis:s,rotation:c,duration:0})}return e.map(function(p){p.duration=a*(p.dis/n)}),e}}function lt(r){if(oi(r[0]))return r;if(oi(r[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(oi(r[0][0][0])){var a=r,t=0,n=0,e=0;return a.forEach(function(i){i.forEach(function(o){t+=o[0],n+=o[1],e++})}),[t/e,n/e,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Zh(r){for(var a=r[0],t=r[1],n=r[0],e=r[1],i=0,o=0,u=0,s=0;s<r.length;s+=2){var l=r[s],c=r[s+1];l&&c&&(a=Math.max(l,a),t=Math.max(c,t),n=Math.min(l,n),e=Math.min(c,e),i+=l,o+=c,u++)}return{center:[i/u,o/u],radius:Math.sqrt(Math.pow(a-n,2)+Math.pow(t-e,2))/2}}function zh(r){return(0,kh.Z)((0,mt.uf)([(0,mt.Tu)(r)]))}function XS(r){var a=131,t=137,n=0;r+="x";for(var e=Math.floor(9007199254740991/t),i=0;i<r.length;i++)n>e&&(n=Math.floor(n/t)),n=n*a+r.charCodeAt(i);return n}function YS(r){r=r.toString();for(var a=5381,t=r.length;t;)a=a*33^r.charCodeAt(--t);return a>>>0}function Uh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var a=Math.random()*16|0,t=r==="x"?a:a&3|8;return t.toString(16)})}var KS=function(r){return r["GAODE1.x"]="GAODE1.x",r["GAODE2.x"]="GAODE2.x",r.MAPBOX="MAPBOX",r.DEFAULT="DEFAUlTMAP",r.SIMPLE="SIMPLE",r.GLOBEL="GLOBEL",r}({});function QS(r,a,t,n,e){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,u=t;return o&&(u=Math.round(t*(i-1))/(i-1)),n?go(r,a,u,n,e):go(r,a,u,.314,e)}function rr(r,a){var t=1-a;return(r[0]*t+r[1]*a)*t+(r[1]*t+r[2]*a)*a}function Hh(r,a){return Math.sqrt(Math.pow(r[0]-a[0],2)+Math.pow(r[1]-a[1],2))}function vo(r,a,t){var n=[a[0]-r[0],a[1]-r[1]],e=Hh(n,[0,0]),i=Math.atan2(n[1],n[0]),o=e/2/Math.cos(t),u=i+t,s=[o*Math.cos(u)+r[0],o*Math.sin(u)+r[1]];return s}function go(r,a,t,n,e){if(e===Version["GAODE2.x"]){var i=amap2Project(r[0],r[1]),o=amap2Project(a[0],a[1]),u=vo(i,o,n),s=[i[0],u[0],o[0]],l=[i[1],u[1],o[1]];return[].concat(_toConsumableArray(amap2UnProject(rr(s,t),rr(l,t))),[0])}else{var c=vo(r,a,n),f=[r[0],c[0],a[0]],p=[r[1],c[1],a[1]];return[rr(f,t),rr(p,t),0]}}function qS(r,a,t,n,e){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,u=t;return o&&(u=Math.round(t*29)/29),Gh(r,a,u,e)}function jh(r,a){var t=[a[0]-r[0],a[1]-r[1]],n=calDistance(t,[0,0]),e=Math.atan2(t[1],t[0]),i=.314,o=n/2/Math.cos(i),u=e+i,s=[o*Math.cos(u)+r[0],o*Math.sin(u)+r[1]];return s}function mo(r,a){var t=1-a;return(r[0]*t+r[1]*a)*t+(r[1]*t+r[2]*a)*a}function Vh(r,a){var t=[r[0]-a[0],r[1]-a[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],e=n[1]*n[1]+Math.cos(r[1])*Math.cos(a[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e))}function Gh(r,a,t,n){var e=[degreesToRadians(r[0]),degreesToRadians(r[1])],i=[degreesToRadians(a[0]),degreesToRadians(a[1])];if(n==="GAODE2.x"){var o=jh(e,i),u=[e[0],o[0],i[0]],s=[e[1],o[1],i[1]];return[mo(u,t),mo(s,t),0]}else{var l=Vh(e,i);if(Math.abs(l-Math.PI)<.001)return[(1-t)*e[0]+t*i[0],(1-t)*e[1]+t*i[1]];var c=Math.sin((1-t)*l)/Math.sin(l),f=Math.sin(t*l)/Math.sin(l),p=[Math.sin(e[0]),Math.sin(e[1])],h=[Math.cos(e[0]),Math.cos(e[1])],g=[Math.sin(i[0]),Math.sin(i[1])],v=[Math.cos(i[0]),Math.cos(i[1])],_=c*h[1]*h[0]+f*v[1]*v[0],x=c*h[1]*p[0]+f*v[1]*g[0],C=c*p[1]+f*g[1];return[radiansToDegrees(Math.atan2(x,_)),radiansToDegrees(Math.atan2(C,Math.sqrt(_*_+x*x)))]}}function JS(r,a){for(var t=0,n=[],e=0;e<r.length-1;e++){var i=r[e],o=r[e+1],u=$h(i,o),s=t;t+=u,n.push({p1:i,p2:o,totalDistance:t,distance:u,lastTotalDistance:s})}for(var l=t*a,c,f,p=0,h=n;p<h.length;p++){var g=h[p],v=g.totalDistance;if(v>l){var _=g.p1,x=g.p2,C=(l-g.lastTotalDistance)/g.distance,S=Wh(x,_,C);c=S[0],f=S[1];break}}return{lng:c,lat:f,height:0}}function Wh(r,a,t){return[r[0]*t+a[0]*(1-t),r[1]*t+a[1]*(1-t)]}function $h(r,a){return Math.sqrt(Math.pow(r[0]-a[0],2)+Math.pow(r[1]-a[1],2))}function yo(r,a){var t=a.featureId,n=r.data.dataArray;return typeof t=="number"&&(n=n.filter(function(e){var i=e.id;return i===t})),n.map(function(e){var i=Xh(e,a);return _objectSpread(_objectSpread({},e),i)})}function eb(r,a){return new Promise(function(t){r.inited?t(yo(r,a)):r.once("update",function(){t(yo(r,a))})})}function Xh(r,a){var t=a.offset,n=a.shape,e=a.thetaOffset,i=a.mapVersion,o=a.segmentNumber,u=o===void 0?30:o,s=a.autoFit,l=s===void 0?!0:s,c=r.coordinates;if(n==="line")return pathLineAtOffset(c,t);var f=c[0],p=c[1],h=typeof e=="string"?r[e]||0:e,g;switch(n){case"arc":g=arcLineAtOffset;break;case"greatcircle":g=greatCircleLineAtOffset;break;default:g=arcLineAtOffset}var v=g(f,p,t,h,i,u,l),_=_slicedToArray(v,3),x=_[0],C=_[1],S=_[2];return{lng:x,lat:C,height:S}}var Yh=function(){function r(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,R.Z)(this,r),this.limit=a,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,T.Z)(r,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(e){return e===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),r}();function Kh(r){if(r.length===0)throw new Error("max requires at least one data point");for(var a=r[0],t=1;t<r.length;t++)r[t]>a&&(a=r[t]);return a*1}function Qh(r){if(r.length===0)throw new Error("min requires at least one data point");for(var a=r[0],t=1;t<r.length;t++)r[t]<a&&(a=r[t]);return a*1}function _o(r){if(r.length===0)return 0;for(var a=r[0]*1,t=1;t<r.length;t++)a+=r[t]*1;return a}function qh(r){if(r.length===0)throw new Error("mean requires at least one data point");return _o(r)/r.length}function Jh(r){if(r.length===0)throw new Error("mean requires at least one data point");if(r.length<3)return r[0];r.sort();for(var a=r[0],t=NaN,n=0,e=1,i=1;i<r.length+1;i++)r[i]!==a?(e>n&&(n=e,t=a),e=1,a=r[i]):e++;return t*1}var li={min:Qh,max:Kh,mean:qh,sum:_o,mode:Jh};function ci(r,a){return r.map(function(t){return t[a]})}function ed(r,a){return li[r](a)}var td=z(38159),ir=function(r){return r.Realtime="realtime",r.Overlap="overlap",r.Replace="replace",r}({}),et=function(r){return r.Loading="Loading",r.Loaded="Loaded",r.Failure="Failure",r.Cancelled="Cancelled",r}({}),Eo=0,xo=1,ar=2;function nd(r){r.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function rd(r){r.forEach(function(a){a.properties.state=Eo}),r.forEach(function(a){a.isCurrent&&!Co(a)&&fi(a)}),r.forEach(function(a){a.isVisible=Boolean(a.properties.state&ar)})}function id(r){r.forEach(function(t){t.properties.state=Eo}),r.forEach(function(t){t.isCurrent&&Co(t)});var a=r.slice().sort(function(t,n){return t.z-n.z});a.forEach(function(t){t.isVisible=Boolean(t.properties.state&ar),t.children.length&&(t.isVisible||t.properties.state&xo)?t.children.forEach(function(n){n.properties.state=xo}):t.isCurrent&&fi(t)})}function Co(r){for(;r;){if(r.isLoaded)return r.properties.state|=ar,!0;r=r.parent}return!1}function fi(r){r.children.forEach(function(a){a.isLoaded?a.properties.state|=ar:fi(a)})}var Cn,tb=256,So=[-Infinity,-Infinity,Infinity,Infinity],ad=.2,od=5,ud=(Cn={},(0,d.Z)(Cn,ir.Realtime,nd),(0,d.Z)(Cn,ir.Overlap,rd),(0,d.Z)(Cn,ir.Replace,id),Cn),sd=function(){};function pi(r,a,t){var n=Math.floor((r+180)/360*Math.pow(2,t)),e=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,e]}function bo(r,a,t){var n=r/Math.pow(2,t)*360-180,e=Math.PI-2*Math.PI*a/Math.pow(2,t),i=180/Math.PI*Math.atan(.5*(Math.exp(e)-Math.exp(-e)));return[n,i]}var Ao=function(a,t,n){var e=bo(a,t,n),i=(0,W.Z)(e,2),o=i[0],u=i[1],s=bo(a+1,t+1,n),l=(0,W.Z)(s,2),c=l[0],f=l[1];return[o,f,c,u]};function ld(r){var a=r.zoom,t=r.latLonBounds,n=r.maxZoom,e=n===void 0?Infinity:n,i=r.minZoom,o=i===void 0?0:i,u=r.zoomOffset,s=u===void 0?0:u,l=r.extent,c=l===void 0?So:l,f=Math.ceil(a)+s;if(Number.isFinite(o)&&f<o)return[];Number.isFinite(e)&&f>e&&(f=e);for(var p=(0,W.Z)(t,4),h=p[0],g=p[1],v=p[2],_=p[3],x=[Math.max(h,c[0]),Math.max(g,c[1]),Math.min(v,c[2]),Math.min(_,c[3])],C=[],S=pi(x[0],x[1],f),M=(0,W.Z)(S,2),L=M[0],D=M[1],B=pi(x[2],x[3],f),I=(0,W.Z)(B,2),P=I[0],U=I[1],V=L;V<=P;V++)for(var K=U;K<=D;K++)C.push({x:V,y:K,z:f});var Q=(P+L)/2,te=(D+U)/2,ce=function(Ce,Se){return Math.abs(Ce-Q)+Math.abs(Se-te)};return C.sort(function(fe,Ce){return ce(fe.x,fe.y)-ce(Ce.x,Ce.y)}),C}var cd=function(a,t,n){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=Math.pow(2,n),o=i-1,u=i,s=a,l=t;return e&&(s<0?s=s+u:s>o&&(s=s%u)),{warpX:s,warpY:l}};function fd(r){var a=pd();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function pd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var hd=function(r){(0,F.Z)(t,r);var a=fd(t);function t(n){var e;(0,R.Z)(this,t),e=a.call(this),(0,d.Z)((0,E.Z)(e),"tileSize",256),(0,d.Z)((0,E.Z)(e),"isVisible",!1),(0,d.Z)((0,E.Z)(e),"isCurrent",!1),(0,d.Z)((0,E.Z)(e),"isVisibleChange",!1),(0,d.Z)((0,E.Z)(e),"loadedLayers",0),(0,d.Z)((0,E.Z)(e),"isLayerLoaded",!1),(0,d.Z)((0,E.Z)(e),"isLoad",!1),(0,d.Z)((0,E.Z)(e),"isChildLoad",!1),(0,d.Z)((0,E.Z)(e),"parent",null),(0,d.Z)((0,E.Z)(e),"children",[]),(0,d.Z)((0,E.Z)(e),"data",null),(0,d.Z)((0,E.Z)(e),"properties",{}),(0,d.Z)((0,E.Z)(e),"loadDataId",0);var i=n.x,o=n.y,u=n.z,s=n.tileSize,l=n.warp,c=l===void 0?!0:l;return e.x=i,e.y=o,e.z=u,e.warp=c||!0,e.tileSize=s,e}return(0,T.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===et.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===et.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===et.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===et.Cancelled}},{key:"isDone",get:function(){return[et.Loaded,et.Cancelled,et.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Ao(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=(0,W.Z)(this.bounds,4),i=e[0],o=e[1],u=e[2],s=e[3],l=[(u-i)/2,(s-o)/2],c=(0,td.Z)(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:l,meta:`
      `.concat(this.key,`
      `)}});return c}},{key:"key",get:function(){var e="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return e}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,k.Z)(y().mark(function i(o){var u,s,l,c,f,p,h,g,v,_,x,C,S,M,L,D,B;return y().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return u=o.getData,s=o.onLoad,l=o.onError,this.loadDataId++,c=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=et.Loading,f=null,P.prev=7,h=this.x,g=this.y,v=this.z,_=this.bounds,x=this.tileSize,C=this.warp,S=cd(h,g,v,C),M=S.warpX,L=S.warpY,D=this.abortController.signal,B={x:M,y:L,z:v,bounds:_,tileSize:x,signal:D,warp:C},P.next=14,u(B,this);case 14:f=P.sent,P.next=20;break;case 17:P.prev=17,P.t0=P.catch(7),p=P.t0;case 20:if(c===this.loadDataId){P.next=22;break}return P.abrupt("return");case 22:if(!(this.isCancelled&&!f)){P.next=24;break}return P.abrupt("return");case 24:if(!(p||!f)){P.next=28;break}return this.loadStatus=et.Failure,l(p,this),P.abrupt("return");case 28:this.loadStatus=et.Loaded,this.data=f,s(this);case 31:case"end":return P.stop()}},i,this,[[7,17]])}));function e(i){return n.apply(this,arguments)}return e}()},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=et.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(pe.EventEmitter),dd=function(a,t){var n=nr(a),e=xn(n,t),i=360*3-180,o=85.0511287798065,u=[Math.max(e[0][0],-i),Math.max(e[0][1],-o),Math.min(e[1][0],i),Math.min(e[1][1],o)];return u},vd=function(a,t){var n=nr(a),e=nr(t),i=si(n,e);return i};function yt(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=gd(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function gd(r,a){if(!!r){if(typeof r=="string")return To(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return To(r,a)}}function To(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function md(r){var a=yd();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function yd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var _d=function(r){(0,F.Z)(t,r);var a=md(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this),(0,d.Z)((0,E.Z)(e),"currentTiles",[]),(0,d.Z)((0,E.Z)(e),"cacheTiles",new Map),(0,d.Z)((0,E.Z)(e),"throttleUpdate",(0,N.throttle)(function(i,o){e.update(i,o)},16)),(0,d.Z)((0,E.Z)(e),"onTileLoad",function(i){e.emit("tile-loaded",i),e.updateTileVisible()}),(0,d.Z)((0,E.Z)(e),"onTileError",function(i,o){e.emit("tile-error",{error:i,tile:o}),e.updateTileVisible()}),(0,d.Z)((0,E.Z)(e),"onTileUnload",function(i){e.emit("tile-unload",i)}),e.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:So,getTileData:sd,warp:!0,updateStrategy:ir.Overlap},e.updateOptions(n),e}return(0,T.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(e){return e.isDone})}},{key:"tiles",get:function(){var e=Array.from(this.cacheTiles.values()).sort(function(i,o){return i.z-o.z});return e}},{key:"updateOptions",value:function(e){var i=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),o=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=(0,A.Z)((0,A.Z)((0,A.Z)({},this.options),e),{},{minZoom:i,maxZoom:o})}},{key:"update",value:function(e,i){var o=this,u=Math.max(0,Math.ceil(e));if(!(this.lastViewStates&&this.lastViewStates.zoom===u&&vd(this.lastViewStates.latLonBoundsBuffer,i))){var s=dd(i,ad);this.lastViewStates={zoom:u,latLonBounds:i,latLonBoundsBuffer:s};var l=!1,c=this.getTileIndices(u,s).filter(function(f){return o.options.warp||f.x>=0&&f.x<Math.pow(2,u)});this.currentTiles=c.map(function(f){var p=f.x,h=f.y,g=f.z,v=o.getTile(p,h,g);if(v){var _,x,C=((_=v)===null||_===void 0?void 0:_.isFailure)||((x=v)===null||x===void 0?void 0:x.isCancelled);return C&&v.loadData({getData:o.options.getTileData,onLoad:o.onTileLoad,onError:o.onTileError}),v}return v=o.createTile(p,h,g),l=!0,v}),l&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e=yt(this.cacheTiles),i;try{for(e.s();!(i=e.n()).done;){var o=(0,W.Z)(i.value,2),u=o[0],s=o[1];if(!this.currentTiles.includes(s)){this.cacheTiles.delete(u),this.onTileUnload(s);return}this.onTileUnload(s),s.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(l){e.e(l)}finally{e.f()}}},{key:"pruneRequests",value:function(){var e=[],i=yt(this.cacheTiles.values()),o;try{for(i.s();!(o=i.n()).done;){var u=o.value;u.isLoading&&!u.isCurrent&&!u.isVisible&&e.push(u)}}catch(l){i.e(l)}finally{i.f()}for(;e.length>0;){var s=e.shift();s.abortLoad()}}},{key:"getTileByLngLat",value:function(e,i,o){var u=this.options.zoomOffset,s=Math.ceil(o)+u,l=pi(e,i,s),c=this.tiles.filter(function(f){return f.key==="".concat(l[0],"_").concat(l[1],"_").concat(s)});return c[0]}},{key:"clear",value:function(){var e=yt(this.cacheTiles.values()),i;try{for(e.s();!(i=e.n()).done;){var o=i.value;o.isLoading?o.abortLoad():this.onTileUnload(o)}}catch(u){e.e(u)}finally{e.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e=this.options.updateStrategy,i=new Map,o=yt(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var s=u.value;i.set(s.key,s.isVisible),s.isCurrent=!1,s.isVisible=!1}}catch(g){o.e(g)}finally{o.f()}var l=yt(this.currentTiles),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.isCurrent=!0,f.isVisible=!0}}catch(g){l.e(g)}finally{l.f()}var p=Array.from(this.cacheTiles.values());typeof e=="function"?e(p):ud[e](p);var h=!1;Array.from(this.cacheTiles.values()).forEach(function(g){g.isVisible!==i.get(g.key)?(g.isVisibleChange=!0,h=!0):g.isVisibleChange=!1}),h&&this.emit("tile-update")}},{key:"getTileIndices",value:function(e,i){var o=this.options,u=o.tileSize,s=o.extent,l=o.zoomOffset,c=Math.floor(this.options.maxZoom),f=Math.ceil(this.options.minZoom),p=ld({maxZoom:c,minZoom:f,zoomOffset:l,tileSize:u,zoom:e,latLonBounds:i,extent:s});return p}},{key:"getTileId",value:function(e,i,o){var u="".concat(e,",").concat(i,",").concat(o);return u}},{key:"getTile",value:function(e,i,o){var u=this.getTileId(e,i,o),s=this.cacheTiles.get(u);return s}},{key:"createTile",value:function(e,i,o){var u=this.getTileId(e,i,o),s=new hd({x:e,y:i,z:o,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(u,s),s.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),s}},{key:"resizeCacheTiles",value:function(){var e=od*this.currentTiles.length,i=this.cacheTiles.size>e;if(i){var o=yt(this.cacheTiles),u;try{for(o.s();!(u=o.n()).done;){var s=(0,W.Z)(u.value,2),l=s[0],c=s[1];if(!c.isVisible&&!this.currentTiles.includes(c)&&(this.cacheTiles.delete(l),this.onTileUnload(c)),this.cacheTiles.size<=e)break}}catch(f){o.e(f)}finally{o.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e=yt(this.cacheTiles.values()),i;try{for(e.s();!(i=e.n()).done;){var o=i.value;o.parent=null,o.children.length=0}}catch(f){e.e(f)}finally{e.f()}var u=yt(this.cacheTiles.values()),s;try{for(u.s();!(s=u.n()).done;){var l=s.value,c=this.getNearestAncestor(l.x,l.y,l.z);l.parent=c,c!=null&&c.children&&c.children.push(l)}}catch(f){u.e(f)}finally{u.f()}}},{key:"getNearestAncestor",value:function(e,i,o){for(;o>this.options.minZoom;){e=Math.floor(e/2),i=Math.floor(i/2),o=o-1;var u=this.getTile(e,i,o);if(u)return u}return null}}]),t}(Qe());function nb(r){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(r)}function Ed(r){var a=[],t=/\{([a-z])-([a-z])\}/.exec(r);if(t){var n=t[1].charCodeAt(0),e=t[2].charCodeAt(0),i;for(i=n;i<=e;++i)a.push(r.replace(t[0],String.fromCharCode(i)));return a}if(t=/\{(\d+)-(\d+)\}/.exec(r),t){for(var o=parseInt(t[2],10),u=parseInt(t[1],10);u<=o;u++)a.push(r.replace(t[0],u.toString()));return a}return a.push(r),a}function Sn(r,a){if(!r||!r.length)throw new Error("url is not allowed to be empty");var t=a.x,n=a.y,e=a.z,i=Ed(r),o=Math.abs(t+n)%i.length,u=i[o];return u.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,e.toString()).replace(/\{bbox\}/g,Ao(t,n,e).join(",")).replace(/\{-y\}/g,(Math.pow(2,e)-n-1).toString())}function xd(r,a){var t=a.x,n=a.y,e=a.z,i=a.layer,o=a.version,u=o===void 0?"1.0.0":o,s=a.style,l=s===void 0?"default":s,c=a.format,f=a.service,p=f===void 0?"WMTS":f,h=a.tileMatrixset,g="".concat(r,"&SERVICE=").concat(p,"&REQUEST=GetTile&VERSION=").concat(u,"&LAYER=").concat(i,"&STYLE=").concat(l,"&TILEMATRIXSET=").concat(h,"&FORMAT=").concat(c,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(e);return g}var Mo=z(63797);function hi(r){var a=r.color;return!a||!a.length?[1,1,1,1]:a}function di(r,a,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function vi(r){var a=r.filter;return a?[1]:[0]}function gi(r,a){return[a]}var Cd=z(9187),_t=z.n(Cd),H=z(31437),or=H.Ue(),rb=H.Ue(),ye=H.Ue(),Et=H.Ue(),Yt=H.Ue();function mi(r,a,t,n,e){H.IH(r,t,n),H.Fv(r,r),a=H.al(-r[1],r[0]);var i=H.al(-t[1],t[0]);return[e/H.AK(a,i),a]}function xt(r,a){return H.t8(r,-a[1],a[0])}function Kt(r,a,t){return H.lu(r,a,t),H.Fv(r,r),r}function yi(r,a){return r[0]===a[0]&&r[1]===a[1]}function ib(r){for(var a=new Map,t=0;t<r.length;t++){var n=r[0].toString()+"-"+r[1].toString();a.get(n)?(r.splice(t,1),t++):a.set(n,n)}return r}var Sd=function(){function r(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,R.Z)(this,r),(0,d.Z)(this,"lastFlip",-1),(0,d.Z)(this,"miter",H.al(0,0)),(0,d.Z)(this,"started",!1),(0,d.Z)(this,"dash",!1),(0,d.Z)(this,"totalDistance",0),(0,d.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,T.Z)(r,[{key:"extrude_gaode2",value:function(t,n){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=t[u-1];f.push((s=n[u-1][2])!==null&&s!==void 0?s:0);var p=n[u-1],h=t[u];h.push((l=n[u][2])!==null&&l!==void 0?l:0);var g=n[u],v=u<t.length-1?[].concat((0,G.Z)(t[u+1]),[(c=n[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<n.length-1?n[u+1]:null,x=this.segment_gaode2(e,o,f,h,v,p,g,_);o+=x}if(this.dash)for(var C=0;C<e.positions.length/6;C++)e.positions[C*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(t,n){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=t[u-1];f.push((s=n[u-1][2])!==null&&s!==void 0?s:0);var p=n[u-1],h=t[u];h.push((l=n[u][2])!==null&&l!==void 0?l:0);var g=n[u],v=u<t.length-1?[].concat((0,G.Z)(t[u+1]),[(c=n[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<n.length-1?n[u+1]:null,x=this.simpleSegment(e,o,f,h,v,p,g,_);o+=x}if(this.dash)for(var C=0;C<e.positions.length/6;C++)e.positions[C*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=t.length,i=n.startIndex,o=1;o<e;o++){var u=t[o-1],s=t[o],l=o<t.length-1?t[o+1]:null,c=this.segment(n,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<n.positions.length/6;f++)n.positions[f*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=t.length,i=n.startIndex,o=1;o<e;o++){var u=t[o-1],s=t[o],l=o<t.length-1?t[o+1]:null,c=this.simpleSegment(n,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<n.positions.length/6;f++)n.positions[f*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,e,i,o,u,s,l){var c=0,f=t.indices,p=t.positions,h=t.normals,g=this.cap==="square",v=this.join==="bevel",_=be([s[0],s[1]]),x=be([u[0],u[1]]);Kt(ye,i,e);var C=0;if(this.dash&&(C=this.lineSegmentDistance(_,x),this.totalDistance+=C),this.normal||(this.normal=H.Ue(),xt(this.normal,ye)),!this.started)if(this.started=!0,g){var S=H.Ue(),M=H.Ue();H.IH(S,this.normal,ye),H.IH(M,this.normal,ye),h.push(M[0],M[1],0),h.push(S[0],S[1],0),p.push(e[0],e[1],e[2]|0,this.totalDistance-C,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),p.push(e[0],e[1],e[2]|0,this.totalDistance-C,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,h,e,this.normal,this.thickness,this.totalDistance-C);if(f.push(n+0,n+1,n+2),o){yi(i,o)&&H.IH(o,i,H.Fv(o,H.$X(o,i,e))),Kt(Et,o,i);var B=mi(Yt,H.Ue(),ye,Et,this.thickness),I=(0,W.Z)(B,2),P=I[0],U=I[1],V=H.AK(Yt,this.normal)<0?-1:1,K=v;if(!K&&this.join==="miter"){var Q=P;Q>this.miterLimit&&(K=!0)}K?(h.push(this.normal[0],this.normal[1],0),h.push(U[0],U[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*V,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*V,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,G.Z)(this.lastFlip!==-V?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),xt(or,Et),H.JG(this.normal,or),h.push(this.normal[0],this.normal[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*V,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(p,h,i,U,P,this.totalDistance),f.push.apply(f,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),V=-1,H.JG(this.normal,U),c+=2),this.lastFlip=V}else{if(xt(this.normal,ye),g){var L=H.Ue(),D=H.Ue();H.lu(D,ye,this.normal),H.IH(L,ye,this.normal),h.push(D[0],D[1],0),h.push(L[0],L[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,h,i,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2}return c}},{key:"simpleSegment",value:function(t,n,e,i,o){var u=0,s=t.indices,l=t.positions,c=t.normals,f=be([i[0],i[1]]),p=be([e[0],e[1]]);Kt(ye,f,p);var h=0;if(this.dash&&(h=this.lineSegmentDistance(f,p),this.totalDistance+=h),this.normal||(this.normal=H.Ue(),xt(this.normal,ye)),this.started||(this.started=!0,this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-h)),s.push(n+0,n+1,n+2),!o)xt(this.normal,ye),this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2;else{var g=be([o[0],o[1]]);yi(f,g)&&H.IH(g,f,H.Fv(g,H.$X(g,f,p))),Kt(Et,g,f);var v=mi(Yt,H.Ue(),ye,Et,this.thickness),_=(0,W.Z)(v,2),x=_[0],C=_[1],S=H.AK(Yt,this.normal)<0?-1:1;this.extrusions(l,c,i,C,x,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),S=-1,H.JG(this.normal,C),u+=2,this.lastFlip=S}return u}},{key:"segment",value:function(t,n,e,i,o){var u=0,s=t.indices,l=t.positions,c=t.normals,f=this.cap==="square",p=this.join==="bevel",h=be([i[0],i[1]]),g=be([e[0],e[1]]);Kt(ye,h,g);var v=0;if(this.dash&&(v=this.lineSegmentDistance(h,g),this.totalDistance+=v),this.normal||(this.normal=H.Ue(),xt(this.normal,ye)),!this.started)if(this.started=!0,f){var _=H.Ue(),x=H.Ue();H.IH(_,this.normal,ye),H.IH(x,this.normal,ye),c.push(x[0],x[1],0),c.push(_[0],_[1],0),l.push(e[0],e[1],e[2]|0,this.totalDistance-v,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),l.push(e[0],e[1],e[2]|0,this.totalDistance-v,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-v);if(s.push(n+0,n+1,n+2),o){var M=be([o[0],o[1]]);yi(h,M)&&H.IH(M,h,H.Fv(M,H.$X(M,h,g))),Kt(Et,M,h);var L=mi(Yt,H.Ue(),ye,Et,this.thickness),D=(0,W.Z)(L,2),B=D[0],I=D[1],P=H.AK(Yt,this.normal)<0?-1:1,U=p;if(!U&&this.join==="miter"){var V=B;V>this.miterLimit&&(U=!0)}U?(c.push(this.normal[0],this.normal[1],0),c.push(I[0],I[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*P,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*P,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push.apply(s,(0,G.Z)(this.lastFlip!==-P?[n,n+2,n+3]:[n+2,n+1,n+3])),s.push(n+2,n+3,n+4),xt(or,Et),H.JG(this.normal,or),c.push(this.normal[0],this.normal[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*P,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,c,i,I,B,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),P=-1,H.JG(this.normal,I),u+=2),this.lastFlip=P}else{if(xt(this.normal,ye),f){var C=H.Ue(),S=H.Ue();H.lu(S,ye,this.normal),H.IH(C,ye,this.normal),c.push(S[0],S[1],0),c.push(C[0],C[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance);s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2}return u}},{key:"extrusions",value:function(t,n,e,i,o,u){n.push(i[0],i[1],0),n.push(i[0],i[1],0),t.push(e[0],e[1],e[2]|0,u,-o,e[2]|0),this.complex.indexes.push(this.currentIndex),t.push(e[0],e[1],e[2]|0,u,o,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var e=n[0]-t[0],i=n[1]-t[1];return Math.sqrt(e*e+i*i)}}]),r}(),ur=85.0511287798;function _i(r){var a=r.coordinates,t=r.originCoordinates,n=r.version,e=new Sd({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var i=a;Array.isArray(i[0][0])||(i=[a]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var u=0;u<i.length;u++){var s=i[u],l=o[u];e.extrude_gaode2(s,l)}}else{var c=a;c[0]&&!Array.isArray(c[0][0])&&(c=[a]),c.forEach(function(p){e.extrude(p)})}var f=e.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function sr(r){var a=lt(r.coordinates);return{vertices:[].concat((0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function Lo(r){var a=r.coordinates,t=_t().flatten(a),n=t.vertices,e=t.dimensions,i=t.holes,o=_t()(n,i,e);return{indices:o,vertices:n,size:e}}function ab(r,a){var t=a;return a>ur&&(t=ur),a<-ur&&(t=-ur),[Math.PI*r/180+Math.PI,Math.PI-Math.log(Math.tan(Math.PI*.25+Math.PI*t/180*.5))]}function ob(r,a){return[(r-Math.PI)*180/Math.PI,(Math.atan(Math.exp(Math.PI-a))-Math.PI*.25)*2*180/Math.PI]}var bd=function(){var r=(0,k.Z)(y().mark(function a(t){var n,e,i,o,u,s,l,c,f;return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n=t.descriptors,e=t.features,i=t.enablePicking,o=t.iconMap,u={a_Color:hi,a_Position:di,filter:vi,a_vertexId:gi,a_PickingColor:function(v){var _=v.id;return i?st(_):[0,0,0]},a_DistanceAndIndex:function(v,_,x,C,S,M){return M===void 0?[x[3],10]:[x[3],M]},a_Total_Distance:function(v,_,x){return[x[5]]},a_Size:function(v){var _=v.size,x=_===void 0?1:_;return Array.isArray(x)?[x[0],x[1]]:[x,0]},a_Normal:function(v,_,x,C,S){return S},a_Miter:function(v,_,x){return[x[4]]},a_iconMapUV:function(v){var _=v.texture,x=o[_]||{x:0,y:0},C=x.x,S=x.y;return[C,S]}},s={sizePerElement:0,elements:[]},l=0,c=[],f=3,e.forEach(function(g,v){var _=_i(g),x=_.indices,C=_.vertices,S=_.normals,M=_.size,L=_.indexes;x.forEach(function(P){c.push(P+l)}),f=M;var D=C.length/M;s.sizePerElement=f,s.elements.push({featureIdx:v,vertices:C,normals:S,offset:l}),l+=D;for(var B=function(U){var V=(S==null?void 0:S.slice(U*3,U*3+3))||[],K=C.slice(U*M,U*M+M),Q=0;L&&L[U]!==void 0&&(Q=L[U]),n.forEach(function(te){if(te&&u[te.name]){var ce;(ce=te.buffer.data).push.apply(ce,(0,G.Z)(u[te.name](g,v,K,U,V,Q)))}})},I=0;I<D;I++)B(I)}),h.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return h.stop()}},a)}));return function(t){return r.apply(this,arguments)}}(),Ad=function(){var r=(0,k.Z)(y().mark(function a(t){var n,e,i,o,u,s,l,c,f;return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n=t.descriptors,e=t.features,i=t.enablePicking,o=t.shape2d,u={a_Color:hi,a_Position:di,filter:vi,a_vertexId:gi,a_PickingColor:function(v){var _=v.id;return i?st(_):[0,0,0]},a_Shape:function(v){var _=v.shape,x=_===void 0?2:_,C=o.indexOf(x);return[C]},a_Extrude:function(v,_,x,C){var S=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],M=C%4*3;return[S[M],S[M+1],S[M+2]]},a_Size:function(v){var _=v.size,x=_===void 0?5:_;return Array.isArray(x)?[x[0]]:[x]}},s={sizePerElement:0,elements:[]},l=0,c=[],f=3,e.forEach(function(g,v){var _=sr(g),x=_.indices,C=_.vertices,S=_.normals,M=_.size,L=_.indexes;x.forEach(function(P){c.push(P+l)}),f=M;var D=C.length/M;s.sizePerElement=f,s.elements.push({featureIdx:v,vertices:C,normals:S,offset:l}),l+=D;for(var B=function(U){var V=(S==null?void 0:S.slice(U*3,U*3+3))||[],K=C.slice(U*M,U*M+M),Q=0;L&&L[U]!==void 0&&(Q=L[U]),n.forEach(function(te){if(te&&u[te.name]){var ce;(ce=te.buffer.data).push.apply(ce,(0,G.Z)(u[te.name](g,v,K,U,V,Q)))}})},I=0;I<D;I++)B(I)}),h.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return h.stop()}},a)}));return function(t){return r.apply(this,arguments)}}(),Td=function(){var r=(0,k.Z)(y().mark(function a(t){var n,e,i,o,u,s,l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=t.descriptors,e=t.features,i=t.enablePicking,o={a_Color:hi,a_Position:di,filter:vi,a_vertexId:gi,a_PickingColor:function(g){var v=g.id;return i?st(v):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,l=[],c=3,e.forEach(function(h,g){var v=Lo(h),_=v.indices,x=v.vertices,C=v.normals,S=v.size,M=v.indexes;_.forEach(function(I){l.push(I+s)}),c=S;var L=x.length/S;u.sizePerElement=c,u.elements.push({featureIdx:g,vertices:x,normals:C,offset:s}),s+=L;for(var D=function(P){var U=(C==null?void 0:C.slice(P*3,P*3+3))||[],V=x.slice(P*S,P*S+S),K=0;M&&M[P]!==void 0&&(K=M[P]),n.forEach(function(Q){if(Q&&o[Q.name]){var te;(te=Q.buffer.data).push.apply(te,(0,G.Z)(o[Q.name](h,g,V,P,U,K)))}})},B=0;B<L;B++)D(B)}),p.abrupt("return",{descriptors:n,featureLayout:u,indices:l});case 8:case"end":return p.stop()}},a)}));return function(t){return r.apply(this,arguments)}}(),Ro={pointFill:Ad,line:bd,polygonFill:Td},ko=(0,A.Z)({},Ro);function Md(r){return Ei.apply(this,arguments)}function Ei(){return Ei=(0,k.Z)(y().mark(function r(a){var t,n;return y().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(t=a.workerType,n=a.data,!ko[t]){i.next=3;break}return i.abrupt("return",ko[t](n));case 3:return i.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return i.stop()}},r)})),Ei.apply(this,arguments)}(0,Mo.ez)(Md);var Fo=new Map;function Ld(r,a){Fo.set(r,a)}function Rd(r){var a=Fo.get(r);return a}var kd=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var b=d.prototype=p.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=l(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(b,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],s=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var E,A,O=function(t){return t&&t.Math==Math&&t},S=O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof x&&x)||function(){return this}()||Function("return this")(),T=Object.defineProperty,k=function(t,e){try{T(S,t,{value:e,configurable:!0,writable:!0})}catch(r){S[t]=e}return e},I=S["__core-js_shared__"]||k("__core-js_shared__",{}),j=w((function(t){(t.exports=function(t,e){return I[t]||(I[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.1",mode:"global",copyright:"\xA9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),P=function(t){try{return!!t()}catch(t){return!0}},_=!P((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=Function.prototype,L=M.call,R=_&&M.bind.bind(L,L),N=_?R:function(t){return function(){return L.apply(t,arguments)}},C=function(t){return null==t},D=TypeError,F=function(t){if(C(t))throw D("Can't call method on "+t);return t},W=Object,z=function(t){return W(F(t))},B=N({}.hasOwnProperty),U=Object.hasOwn||function(t,e){return B(z(t),e)},G=0,V=Math.random(),H=N(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++G+V,36)},Z="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Y=S.process,$=S.Deno,K=Y&&Y.versions||$&&$.version,Q=K&&K.v8;Q&&(A=(E=Q.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!A&&Z&&(!(E=Z.match(/Edge\\/(\\d+)/))||E[1]>=74)&&(E=Z.match(/Chrome\\/(\\d+)/))&&(A=+E[1]);var X=A,J=!!Object.getOwnPropertySymbols&&!P((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),tt=J&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,et=S.Symbol,rt=j("wks"),nt=tt?et.for||et:et&&et.withoutSetter||q,ot=function(t){return U(rt,t)||(rt[t]=J&&U(et,t)?et[t]:nt("Symbol."+t)),rt[t]},it={};it[ot("toStringTag")]="z";var at="[object z]"===String(it),ut="object"==typeof document&&document.all,st={all:ut,IS_HTMLDDA:void 0===ut&&void 0!==ut},ct=st.all,ft=st.IS_HTMLDDA?function(t){return"function"==typeof t||t===ct}:function(t){return"function"==typeof t},lt=!P((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),ht=st.all,pt=st.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:ft(t)||t===ht}:function(t){return"object"==typeof t?null!==t:ft(t)},vt=S.document,dt=pt(vt)&&pt(vt.createElement),yt=function(t){return dt?vt.createElement(t):{}},gt=!lt&&!P((function(){return 7!=Object.defineProperty(yt("div"),"a",{get:function(){return 7}}).a})),mt=lt&&P((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),bt=String,xt=TypeError,wt=function(t){if(pt(t))return t;throw xt(bt(t)+" is not an object")},Et=Function.prototype.call,At=_?Et.bind(Et):function(){return Et.apply(Et,arguments)},Ot=function(t){return ft(t)?t:void 0},St=function(t,e){return arguments.length<2?Ot(S[t]):S[t]&&S[t][e]},Tt=N({}.isPrototypeOf),kt=Object,It=tt?function(t){return"symbol"==typeof t}:function(t){var e=St("Symbol");return ft(e)&&Tt(e.prototype,kt(t))},jt=String,Pt=function(t){try{return jt(t)}catch(t){return"Object"}},_t=TypeError,Mt=function(t){if(ft(t))return t;throw _t(Pt(t)+" is not a function")},Lt=function(t,e){var r=t[e];return C(r)?void 0:Mt(r)},Rt=TypeError,Nt=TypeError,Ct=ot("toPrimitive"),Dt=function(t,e){if(!pt(t)||It(t))return t;var r,n=Lt(t,Ct);if(n){if(void 0===e&&(e="default"),r=At(n,t,e),!pt(r)||It(r))return r;throw Nt("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&ft(r=t.toString)&&!pt(n=At(r,t)))return n;if(ft(r=t.valueOf)&&!pt(n=At(r,t)))return n;if("string"!==e&&ft(r=t.toString)&&!pt(n=At(r,t)))return n;throw Rt("Can't convert object to primitive value")}(t,e)},Ft=function(t){var e=Dt(t,"string");return It(e)?e:e+""},Wt=TypeError,zt=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,Ut={f:lt?mt?function(t,e,r){if(wt(t),e=Ft(e),wt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Bt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return zt(t,e,r)}:zt:function(t,e,r){if(wt(t),e=Ft(e),wt(r),gt)try{return zt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Wt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Gt=Function.prototype,Vt=lt&&Object.getOwnPropertyDescriptor,Ht=U(Gt,"name"),qt={EXISTS:Ht,PROPER:Ht&&"something"===function(){}.name,CONFIGURABLE:Ht&&(!lt||lt&&Vt(Gt,"name").configurable)},Zt=N(Function.toString);ft(I.inspectSource)||(I.inspectSource=function(t){return Zt(t)});var Yt,$t,Kt,Qt=I.inspectSource,Xt=S.WeakMap,Jt=ft(Xt)&&/native code/.test(String(Xt)),te=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ee=lt?function(t,e,r){return Ut.f(t,e,te(1,r))}:function(t,e,r){return t[e]=r,t},re=j("keys"),ne=function(t){return re[t]||(re[t]=q(t))},oe={},ie=S.TypeError,ae=S.WeakMap;if(Jt||I.state){var ue=I.state||(I.state=new ae);ue.get=ue.get,ue.has=ue.has,ue.set=ue.set,Yt=function(t,e){if(ue.has(t))throw ie("Object already initialized");return e.facade=t,ue.set(t,e),e},$t=function(t){return ue.get(t)||{}},Kt=function(t){return ue.has(t)}}else{var se=ne("state");oe[se]=!0,Yt=function(t,e){if(U(t,se))throw ie("Object already initialized");return e.facade=t,ee(t,se,e),e},$t=function(t){return U(t,se)?t[se]:{}},Kt=function(t){return U(t,se)}}var ce={set:Yt,get:$t,has:Kt,enforce:function(t){return Kt(t)?$t(t):Yt(t,{})},getterFor:function(t){return function(e){var r;if(!pt(e)||(r=$t(e)).type!==t)throw ie("Incompatible receiver, "+t+" required");return r}}},fe=w((function(t){var e=qt.CONFIGURABLE,r=ce.enforce,n=ce.get,o=String,i=Object.defineProperty,a=N("".slice),u=N("".replace),s=N([].join),c=lt&&!P((function(){return 8!==i((function(){}),"length",{value:8}).length})),f=String(String).split("String"),l=t.exports=function(t,n,l){"Symbol("===a(o(n),0,7)&&(n="["+u(o(n),/^Symbol\\(([^)]*)\\)/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!U(t,"name")||e&&t.name!==n)&&(lt?i(t,"name",{value:n,configurable:!0}):t.name=n),c&&l&&U(l,"arity")&&t.length!==l.arity&&i(t,"length",{value:l.arity});try{l&&U(l,"constructor")&&l.constructor?lt&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var h=r(t);return U(h,"source")||(h.source=s(f,"string"==typeof n?n:"")),t};Function.prototype.toString=l((function(){return ft(this)&&n(this).source||Qt(this)}),"toString")})),le=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(ft(r)&&fe(r,i,n),n.global)o?t[e]=r:k(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ut.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},he=N({}.toString),pe=N("".slice),ve=function(t){return pe(he(t),8,-1)},de=ot("toStringTag"),ye=Object,ge="Arguments"==ve(function(){return arguments}()),me=at?ve:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ye(t),de))?r:ge?ve(e):"Object"==(n=ve(e))&&ft(e.callee)?"Arguments":n},be=at?{}.toString:function(){return"[object "+me(this)+"]"};at||le(Object.prototype,"toString",be,{unsafe:!0});var xe={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,Ee={f:we&&!xe.call({1:2},1)?function(t){var e=we(this,t);return!!e&&e.enumerable}:xe},Ae=Object,Oe=N("".split),Se=P((function(){return!Ae("z").propertyIsEnumerable(0)}))?function(t){return"String"==ve(t)?Oe(t,""):Ae(t)}:Ae,Te=function(t){return Se(F(t))},ke=Object.getOwnPropertyDescriptor,Ie={f:lt?ke:function(t,e){if(t=Te(t),e=Ft(e),gt)try{return ke(t,e)}catch(t){}if(U(t,e))return te(!At(Ee.f,t,e),t[e])}},je=Math.ceil,Pe=Math.floor,_e=Math.trunc||function(t){var e=+t;return(e>0?Pe:je)(e)},Me=function(t){var e=+t;return e!=e||0===e?0:_e(e)},Le=Math.max,Re=Math.min,Ne=function(t,e){var r=Me(t);return r<0?Le(r+e,0):Re(r,e)},Ce=Math.min,De=function(t){return t>0?Ce(Me(t),9007199254740991):0},Fe=function(t){return De(t.length)},We=function(t){return function(e,r,n){var o,i=Te(e),a=Fe(i),u=Ne(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},ze={includes:We(!0),indexOf:We(!1)},Be=ze.indexOf,Ue=N([].push),Ge=function(t,e){var r,n=Te(t),o=0,i=[];for(r in n)!U(oe,r)&&U(n,r)&&Ue(i,r);for(;e.length>o;)U(n,r=e[o++])&&(~Be(i,r)||Ue(i,r));return i},Ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],He=Ve.concat("length","prototype"),qe={f:Object.getOwnPropertyNames||function(t){return Ge(t,He)}},Ze={f:Object.getOwnPropertySymbols},Ye=N([].concat),$e=St("Reflect","ownKeys")||function(t){var e=qe.f(wt(t)),r=Ze.f;return r?Ye(e,r(t)):e},Ke=function(t,e,r){for(var n=$e(e),o=Ut.f,i=Ie.f,a=0;a<n.length;a++){var u=n[a];U(t,u)||r&&U(r,u)||o(t,u,i(e,u))}},Qe=/#|\\.prototype\\./,Xe=function(t,e){var r=tr[Je(t)];return r==rr||r!=er&&(ft(e)?P(e):!!e)},Je=Xe.normalize=function(t){return String(t).replace(Qe,".").toLowerCase()},tr=Xe.data={},er=Xe.NATIVE="N",rr=Xe.POLYFILL="P",nr=Xe,or=Ie.f,ir=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?S:c?S[u]||k(u,{}):(S[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=or(r,n))&&a.value:r[n],!nr(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Ke(i,o)}(t.sham||o&&o.sham)&&ee(i,"sham",!0),le(r,n,i,t)}},ar="undefined"!=typeof process&&"process"==ve(process),ur=String,sr=TypeError,cr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=function(t,e,r){try{return N(Mt(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return wt(r),function(t){if("object"==typeof t||ft(t))return t;throw sr("Can't set "+ur(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),fr=Ut.f,lr=ot("toStringTag"),hr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!U(t,lr)&&fr(t,lr,{configurable:!0,value:e})},pr=function(t,e,r){return r.get&&fe(r.get,e,{getter:!0}),r.set&&fe(r.set,e,{setter:!0}),Ut.f(t,e,r)},vr=ot("species"),dr=function(t){var e=St(t);lt&&e&&!e[vr]&&pr(e,vr,{configurable:!0,get:function(){return this}})},yr=TypeError,gr=function(t,e){if(Tt(e,t))return t;throw yr("Incorrect invocation")},mr=function(){},br=[],xr=St("Reflect","construct"),wr=/^\\s*(?:class|function)\\b/,Er=N(wr.exec),Ar=!wr.exec(mr),Or=function(t){if(!ft(t))return!1;try{return xr(mr,br,t),!0}catch(t){return!1}},Sr=function(t){if(!ft(t))return!1;switch(me(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ar||!!Er(wr,Qt(t))}catch(t){return!0}};Sr.sham=!0;var Tr,kr,Ir,jr,Pr=!xr||P((function(){var t;return Or(Or.call)||!Or(Object)||!Or((function(){t=!0}))||t}))?Sr:Or,_r=TypeError,Mr=function(t){if(Pr(t))return t;throw _r(Pt(t)+" is not a constructor")},Lr=ot("species"),Rr=function(t,e){var r,n=wt(t).constructor;return void 0===n||C(r=wt(n)[Lr])?e:Mr(r)},Nr=Function.prototype,Cr=Nr.apply,Dr=Nr.call,Fr="object"==typeof Reflect&&Reflect.apply||(_?Dr.bind(Cr):function(){return Dr.apply(Cr,arguments)}),Wr=function(t){if("Function"===ve(t))return N(t)},zr=Wr(Wr.bind),Br=function(t,e){return Mt(t),void 0===e?t:_?zr(t,e):function(){return t.apply(e,arguments)}},Ur=St("document","documentElement"),Gr=N([].slice),Vr=TypeError,Hr=function(t,e){if(t<e)throw Vr("Not enough arguments");return t},qr=/(?:ipad|iphone|ipod).*applewebkit/i.test(Z),Zr=S.setImmediate,Yr=S.clearImmediate,$r=S.process,Kr=S.Dispatch,Qr=S.Function,Xr=S.MessageChannel,Jr=S.String,tn=0,en={};P((function(){Tr=S.location}));var rn=function(t){if(U(en,t)){var e=en[t];delete en[t],e()}},nn=function(t){return function(){rn(t)}},on=function(t){rn(t.data)},an=function(t){S.postMessage(Jr(t),Tr.protocol+"//"+Tr.host)};Zr&&Yr||(Zr=function(t){Hr(arguments.length,1);var e=ft(t)?t:Qr(t),r=Gr(arguments,1);return en[++tn]=function(){Fr(e,void 0,r)},kr(tn),tn},Yr=function(t){delete en[t]},ar?kr=function(t){$r.nextTick(nn(t))}:Kr&&Kr.now?kr=function(t){Kr.now(nn(t))}:Xr&&!qr?(jr=(Ir=new Xr).port2,Ir.port1.onmessage=on,kr=Br(jr.postMessage,jr)):S.addEventListener&&ft(S.postMessage)&&!S.importScripts&&Tr&&"file:"!==Tr.protocol&&!P(an)?(kr=an,S.addEventListener("message",on,!1)):kr="onreadystatechange"in yt("script")?function(t){Ur.appendChild(yt("script")).onreadystatechange=function(){Ur.removeChild(this),rn(t)}}:function(t){setTimeout(nn(t),0)});var un={set:Zr,clear:Yr},sn=function(){this.head=null,this.tail=null};sn.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var cn,fn,ln,hn,pn,vn=sn,dn=/ipad|iphone|ipod/i.test(Z)&&"undefined"!=typeof Pebble,yn=/web0s(?!.*chrome)/i.test(Z),gn=Ie.f,mn=un.set,bn=S.MutationObserver||S.WebKitMutationObserver,xn=S.document,wn=S.process,En=S.Promise,An=gn(S,"queueMicrotask"),On=An&&An.value;if(!On){var Sn=new vn,Tn=function(){var t,e;for(ar&&(t=wn.domain)&&t.exit();e=Sn.get();)try{e()}catch(t){throw Sn.head&&cn(),t}t&&t.enter()};qr||ar||yn||!bn||!xn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=Br(hn.then,hn),cn=function(){pn(Tn)}):ar?cn=function(){wn.nextTick(Tn)}:(mn=Br(mn,S),cn=function(){mn(Tn)}):(fn=!0,ln=xn.createTextNode(""),new bn(Tn).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}),On=function(t){Sn.head||cn(),Sn.add(t)}}var kn,In,jn,Pn=On,_n=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Mn=S.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ar&&"object"==typeof window&&"object"==typeof document,Nn=(Mn&&Mn.prototype,ot("species")),Cn=!1,Dn=ft(S.PromiseRejectionEvent),Fn={CONSTRUCTOR:nr("Promise",(function(){var t=Qt(Mn),e=t!==String(Mn);if(!e&&66===X)return!0;if(!X||X<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Nn]=n,!(Cn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Cn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Mt(e),this.reject=Mt(r)},Bn={f:function(t){return new zn(t)}},Un=un.set,Gn=Fn.CONSTRUCTOR,Vn=Fn.REJECTION_EVENT,Hn=Fn.SUBCLASSING,qn=ce.getterFor("Promise"),Zn=ce.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=S.TypeError,Xn=S.document,Jn=S.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&S.dispatchEvent),no=function(t){var e;return!(!pt(t)||!ft(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?At(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Pn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),S.dispatchEvent(n)):n={promise:e,reason:r},!Vn&&(o=S["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}}("Unhandled promise rejection",r)},uo=function(t){At(Un,S,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=_n((function(){ar?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ar||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){At(Un,S,(function(){var e=t.facade;ar?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Pn((function(){var r={done:!1};try{At(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){gr(this,Kn),Mt(t),At(kn,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(kn=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new vn,rejection:!1,state:0,value:void 0})}).prototype=le(Kn,"then",(function(t,e){var r=qn(this),n=to(Rr(this,$n));return r.parent=!0,n.ok=!ft(t)||t,n.fail=ft(e)&&e,n.domain=ar?Jn.domain:void 0,0==r.state?r.reactions.add(n):Pn((function(){oo(n,r)})),n.promise})),In=function(){var t=new kn,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new In(t):eo(t)},ft(Mn)&&Yn!==Object.prototype)){jn=Yn.then,Hn||le(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){At(jn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}cr&&cr(Yn,Kn)}ir({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),hr($n,"Promise",!1),dr("Promise");var po={},vo=ot("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=ot("iterator"),bo=function(t){if(!C(t))return Lt(t,mo)||Lt(t,"@@iterator")||po[me(t)]},xo=TypeError,wo=function(t,e){var r=arguments.length<2?bo(t):e;if(Mt(r))return wt(At(r,t));throw xo(Pt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;wt(t);try{if(!(n=Lt(t,"return"))){if("throw"===e)throw r;return r}n=At(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return wt(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Br(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(wt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=bo(t)))throw Ao(Pt(t)+" is not iterable");if(go(o)){for(i=0,a=Fe(t);a>i;i++)if((u=g(t[i]))&&Tt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=At(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Tt(So,u))return u}return new Oo(!1)},ko=ot("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ir({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=_n((function(){var r=Mt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,At(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ir({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),ft(Mn)){var No=St("Promise").prototype.catch;Ro.catch!==No&&le(Ro,"catch",No,{unsafe:!0})}ir({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=_n((function(){var o=Mt(e.resolve);To(t,(function(t){At(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ir({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return At(e.reject,void 0,t),e.promise}});var Co=Fn.CONSTRUCTOR;St("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ir({target:"Promise",stat:!0,forced:Co},{resolve:function(t){return function(t,e){if(wt(t),pt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Vo(t))n.add(t);else if(Vo(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Vo(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Ho=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Ho,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Ho,this.onError=Ho,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=yt("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==ve(t)},gi=ot("species"),mi=Array,bi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(Pr(e)&&(e===mi||yi(e.prototype))||pt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},xi=N([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=z(s),d=Se(v),y=Br(c,f),g=Fe(d),m=0,b=l||bi,x=e?b(s,g):r||a?b(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)x[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:xi(x,h)}else switch(t){case 4:return!1;case 7:xi(x,h)}return i?-1:n||o?o:x}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&P((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ee(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(S[ki]&&S[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ft(e);n in t?Ut.f(t,n,te(0,r)):t[n]=r},ji=ot("species"),Pi=function(t){return X>=51||!P((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=ot("species"),Li=Array,Ri=Math.max;ir({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=Te(this),a=Fe(i),u=Ne(t,a),s=Ne(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(Pr(r)&&(r===Li||yi(r.prototype))||pt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Gr(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ni=qt.EXISTS,Ci=Function.prototype,Di=N(Ci.toString),Fi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,Wi=N(Fi.exec);lt&&!Ni&&pr(Ci,"name",{configurable:!0,get:function(){try{return Wi(Fi,Di(this))[1]}catch(t){return""}}});var zi,Bi=Object.keys||function(t){return Ge(t,Ve)},Ui={f:lt&&!mt?Object.defineProperties:function(t,e){wt(t);for(var r,n=Te(e),o=Bi(e),i=o.length,a=0;i>a;)Ut.f(t,r=o[a++],n[r]);return t}},Gi=ne("IE_PROTO"),Vi=function(){},Hi=function(t){return"<script>"+t+"<\\/script>"},qi=function(t){t.write(Hi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Zi=function(){try{zi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Zi="undefined"!=typeof document?document.domain&&zi?qi(zi):((e=yt("iframe")).style.display="none",Ur.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Hi("document.F=Object")),t.close(),t.F):qi(zi);for(var r=Ve.length;r--;)delete Zi.prototype[Ve[r]];return Zi()};oe[Gi]=!0;var Yi=Object.create||function(t,e){var r;return null!==t?(Vi.prototype=wt(t),r=new Vi,Vi.prototype=null,r[Gi]=t):r=Zi(),void 0===e?r:Ui.f(r,e)},$i=Ut.f,Ki=ot("unscopables"),Qi=Array.prototype;null==Qi[Ki]&&$i(Qi,Ki,{configurable:!0,value:Yi(null)});var Xi,Ji,ta,ea=function(t){Qi[Ki][t]=!0},ra=!P((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),na=ne("IE_PROTO"),oa=Object,ia=oa.prototype,aa=ra?oa.getPrototypeOf:function(t){var e=z(t);if(U(e,na))return e[na];var r=e.constructor;return ft(r)&&e instanceof r?r.prototype:e instanceof oa?ia:null},ua=ot("iterator"),sa=!1;[].keys&&("next"in(ta=[].keys())?(Ji=aa(aa(ta)))!==Object.prototype&&(Xi=Ji):sa=!0),(!pt(Xi)||P((function(){var t={};return Xi[ua].call(t)!==t})))&&(Xi={}),ft(Xi[ua])||le(Xi,ua,(function(){return this}));var ca={IteratorPrototype:Xi,BUGGY_SAFARI_ITERATORS:sa},fa=ca.IteratorPrototype,la=function(){return this},ha=qt.PROPER,pa=qt.CONFIGURABLE,va=ca.IteratorPrototype,da=ca.BUGGY_SAFARI_ITERATORS,ya=ot("iterator"),ga=function(){return this},ma=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Yi(fa,{next:te(+!n,r)}),hr(t,o,!1),po[o]=la}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!da&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ya]||p["@@iterator"]||o&&p[o],d=!da&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=aa(y.call(new t)))!==Object.prototype&&u.next&&(aa(u)!==va&&(cr?cr(u,va):ft(u[ya])||le(u,ya,ga)),hr(u,l,!0)),ha&&"values"==o&&v&&"values"!==v.name&&(pa?ee(p,"name","values"):(h=!0,d=function(){return At(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(da||h||!(c in p))&&le(p,c,s[c]);else ir({target:e,proto:!0,forced:da||h},s);return p[ya]!==d&&le(p,ya,d,{name:o}),po[e]=d,s},ba=function(t,e){return{value:t,done:e}},xa=Ut.f,wa=ce.set,Ea=ce.getterFor("Array Iterator"),Aa=ma(Array,"Array",(function(t,e){wa(this,{type:"Array Iterator",target:Te(t),index:0,kind:e})}),(function(){var t=Ea(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,ba(void 0,!0)):ba("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),Oa=po.Arguments=po.Array;if(ea("keys"),ea("values"),ea("entries"),lt&&"values"!==Oa.name)try{xa(Oa,"name",{value:"values"})}catch(t){}var Sa,Ta,ka,Ia="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,ja=ce.enforce,Pa=ce.get,_a=S.Int8Array,Ma=_a&&_a.prototype,La=S.Uint8ClampedArray,Ra=La&&La.prototype,Na=_a&&aa(_a),Ca=Ma&&aa(Ma),Da=Object.prototype,Fa=S.TypeError,Wa=ot("toStringTag"),za=q("TYPED_ARRAY_TAG"),Ba=Ia&&!!cr&&"Opera"!==me(S.opera),Ua=!1,Ga={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Va={BigInt64Array:8,BigUint64Array:8},Ha=function(t){var e=aa(t);if(pt(e)){var r=Pa(e);return r&&U(r,"TypedArrayConstructor")?r.TypedArrayConstructor:Ha(e)}},qa=function(t){if(!pt(t))return!1;var e=me(t);return U(Ga,e)||U(Va,e)};for(Sa in Ga)(ka=(Ta=S[Sa])&&Ta.prototype)?ja(ka).TypedArrayConstructor=Ta:Ba=!1;for(Sa in Va)(ka=(Ta=S[Sa])&&Ta.prototype)&&(ja(ka).TypedArrayConstructor=Ta);if((!Ba||!ft(Na)||Na===Function.prototype)&&(Na=function(){throw Fa("Incorrect invocation")},Ba))for(Sa in Ga)S[Sa]&&cr(S[Sa],Na);if((!Ba||!Ca||Ca===Da)&&(Ca=Na.prototype,Ba))for(Sa in Ga)S[Sa]&&cr(S[Sa].prototype,Ca);if(Ba&&aa(Ra)!==Ca&&cr(Ra,Ca),lt&&!U(Ca,Wa))for(Sa in Ua=!0,pr(Ca,Wa,{configurable:!0,get:function(){return pt(this)?this[za]:void 0}}),Ga)S[Sa]&&ee(S[Sa],za,Sa);var Za={NATIVE_ARRAY_BUFFER_VIEWS:Ba,TYPED_ARRAY_TAG:Ua&&za,aTypedArray:function(t){if(qa(t))return t;throw Fa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(ft(t)&&(!cr||Tt(Na,t)))return t;throw Fa(Pt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(lt){if(r)for(var o in Ga){var i=S[o];if(i&&U(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Ca[t]&&!r||le(Ca,t,r?e:Ba&&Ma[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(lt){if(cr){if(r)for(n in Ga)if((o=S[n])&&U(o,t))try{delete o[t]}catch(t){}if(Na[t]&&!r)return;try{return le(Na,t,r?e:Ba&&Na[t]||e)}catch(t){}}for(n in Ga)!(o=S[n])||o[t]&&!r||le(o,t,e)}},getTypedArrayConstructor:Ha,isView:function(t){if(!pt(t))return!1;var e=me(t);return"DataView"===e||U(Ga,e)||U(Va,e)},isTypedArray:qa,TypedArray:Na,TypedArrayPrototype:Ca},Ya=Za.NATIVE_ARRAY_BUFFER_VIEWS,$a=S.ArrayBuffer,Ka=S.Int8Array,Qa=!Ya||!P((function(){Ka(1)}))||!P((function(){new Ka(-1)}))||!_o((function(t){new Ka,new Ka(null),new Ka(1.5),new Ka(t)}),!0)||P((function(){return 1!==new Ka(new $a(2),1,void 0).length})),Xa=function(t,e,r){for(var n in e)le(t,n,e[n],r);return t},Ja=RangeError,tu=function(t){if(void 0===t)return 0;var e=Me(t),r=De(e);if(e!==r)throw Ja("Wrong length or index");return r},eu=Array,ru=Math.abs,nu=Math.pow,ou=Math.floor,iu=Math.log,au=Math.LN2,uu=function(t,e,r){var n,o,i,a=eu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?nu(2,-24)-nu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=ru(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=ou(iu(t)/au),t*(i=nu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*nu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*nu(2,e),n+=c):(o=t*nu(2,c-1)*nu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},su=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=nu(2,e),f-=a}return(c?-1:1)*r*nu(2,f-e)},cu=function(t){for(var e=z(this),r=Fe(e),n=arguments.length,o=Ne(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ne(i,r);a>o;)e[o++]=t;return e},fu=Array,lu=Math.max,hu=function(t,e,r){for(var n=Fe(t),o=Ne(e,n),i=Ne(void 0===r?n:r,n),a=fu(lu(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},pu=qe.f,vu=qt.PROPER,du=qt.CONFIGURABLE,yu=ce.getterFor("ArrayBuffer"),gu=ce.getterFor("DataView"),mu=ce.set,bu=S.ArrayBuffer,xu=bu,wu=xu&&xu.prototype,Eu=S.DataView,Au=Eu&&Eu.prototype,Ou=Object.prototype,Su=S.Array,Tu=S.RangeError,ku=N(cu),Iu=N([].reverse),ju=uu,Pu=su,_u=function(t){return[255&t]},Mu=function(t){return[255&t,t>>8&255]},Lu=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Ru=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Nu=function(t){return ju(t,23,4)},Cu=function(t){return ju(t,52,8)},Du=function(t,e,r){pr(t.prototype,e,{configurable:!0,get:function(){return r(this)[e]}})},Fu=function(t,e,r,n){var o=tu(r),i=gu(t);if(o+e>i.byteLength)throw Tu("Wrong index");var a=i.bytes,u=o+i.byteOffset,s=hu(a,u,u+e);return n?s:Iu(s)},Wu=function(t,e,r,n,o,i){var a=tu(r),u=gu(t);if(a+e>u.byteLength)throw Tu("Wrong index");for(var s=u.bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(Ia){var zu=vu&&"ArrayBuffer"!==bu.name;if(P((function(){bu(1)}))&&P((function(){new bu(-1)}))&&!P((function(){return new bu,new bu(1.5),new bu(NaN),1!=bu.length||zu&&!du})))zu&&du&&ee(bu,"name","ArrayBuffer");else{(xu=function(t){return gr(this,wu),new bu(tu(t))}).prototype=wu;for(var Bu,Uu=pu(bu),Gu=0;Uu.length>Gu;)(Bu=Uu[Gu++])in xu||ee(xu,Bu,bu[Bu]);wu.constructor=xu}cr&&aa(Au)!==Ou&&cr(Au,Ou);var Vu=new Eu(new xu(2)),Hu=N(Au.setInt8);Vu.setInt8(0,2147483648),Vu.setInt8(1,2147483649),!Vu.getInt8(0)&&Vu.getInt8(1)||Xa(Au,{setInt8:function(t,e){Hu(this,t,e<<24>>24)},setUint8:function(t,e){Hu(this,t,e<<24>>24)}},{unsafe:!0})}else wu=(xu=function(t){gr(this,wu);var e=tu(t);mu(this,{type:"ArrayBuffer",bytes:ku(Su(e),0),byteLength:e}),lt||(this.byteLength=e,this.detached=!1)}).prototype,Au=(Eu=function(t,e,r){gr(this,Au),gr(t,wu);var n=yu(t),o=n.byteLength,i=Me(e);if(i<0||i>o)throw Tu("Wrong offset");if(i+(r=void 0===r?o-i:De(r))>o)throw Tu("Wrong length");mu(this,{type:"DataView",buffer:t,byteLength:r,byteOffset:i,bytes:n.bytes}),lt||(this.buffer=t,this.byteLength=r,this.byteOffset=i)}).prototype,lt&&(Du(xu,"byteLength",yu),Du(Eu,"buffer",gu),Du(Eu,"byteLength",gu),Du(Eu,"byteOffset",gu)),Xa(Au,{getInt8:function(t){return Fu(this,1,t)[0]<<24>>24},getUint8:function(t){return Fu(this,1,t)[0]},getInt16:function(t){var e=Fu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Fu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Ru(Fu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Ru(Fu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Pu(Fu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Pu(Fu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Wu(this,1,t,_u,e)},setUint8:function(t,e){Wu(this,1,t,_u,e)},setInt16:function(t,e){Wu(this,2,t,Mu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Wu(this,2,t,Mu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Wu(this,4,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Wu(this,4,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Wu(this,4,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Wu(this,8,t,Cu,e,arguments.length>2?arguments[2]:void 0)}});hr(xu,"ArrayBuffer"),hr(Eu,"DataView");var qu={ArrayBuffer:xu,DataView:Eu},Zu=Math.floor,Yu=Number.isInteger||function(t){return!pt(t)&&isFinite(t)&&Zu(t)===t},$u=RangeError,Ku=RangeError,Qu=function(t,e){var r=function(t){var e=Me(t);if(e<0)throw $u("The argument can't be less than 0");return e}(t);if(r%e)throw Ku("Wrong offset");return r},Xu=function(t){var e=me(t);return"BigInt64Array"==e||"BigUint64Array"==e},Ju=TypeError,ts=function(t){var e=Dt(t,"number");if("number"==typeof e)throw Ju("Can't convert number to bigint");return BigInt(e)},es=Za.aTypedArrayConstructor,rs=function(t){var e,r,n,o,i,a,u,s,c=Mr(this),f=z(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=bo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=At(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=Br(h,arguments[2])),r=Fe(f),n=new(es(c))(r),o=Xu(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?ts(i):+i;return n},ns=function(t,e,r){var n,o;return cr&&ft(n=e.constructor)&&n!==r&&pt(o=n.prototype)&&o!==r.prototype&&cr(t,o),t},os=w((function(t){var e=qe.f,r=Ei.forEach,n=ce.get,o=ce.set,i=ce.enforce,a=Ut.f,u=Ie.f,s=Math.round,c=S.RangeError,f=qu.ArrayBuffer,l=f.prototype,h=qu.DataView,p=Za.NATIVE_ARRAY_BUFFER_VIEWS,v=Za.TYPED_ARRAY_TAG,d=Za.TypedArray,y=Za.TypedArrayPrototype,g=Za.aTypedArrayConstructor,m=Za.isTypedArray,b=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},x=function(t,e){pr(t,e,{configurable:!0,get:function(){return n(this)[e]}})},w=function(t){var e;return Tt(l,t)||"ArrayBuffer"==(e=me(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!It(e)&&e in t&&Yu(+e)&&e>=0},A=function(t,e){return e=Ft(e),E(t,e)?te(2,t[e]):u(t,e)},O=function(t,e,r){return e=Ft(e),!(E(t,e)&&pt(r)&&U(r,"value"))||U(r,"get")||U(r,"set")||r.configurable||U(r,"writable")&&!r.writable||U(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};lt?(p||(Ie.f=A,Ut.f=O,x(y,"buffer"),x(y,"byteOffset"),x(y,"byteLength"),x(y,"length")),ir({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:O}),t.exports=function(t,u,l){var g=t.match(/\\d+/)[0]/8,x=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,O=S[x],T=O,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Qa&&(T=u((function(t,e,r,n){return gr(t,k),ns(pt(e)?w(e)?void 0!==n?new O(e,Qu(r,g),n):void 0!==r?new O(e,Qu(r,g)):new O(e):m(e)?b(T,e):At(rs,T,e):new O(tu(e)),t,T)})),cr&&cr(T,d),r(e(O),(function(t){t in T||ee(T,t,O[t])})),T.prototype=k):(T=u((function(t,e,r,n){gr(t,k);var i,a,u,s=0,l=0;if(pt(e)){if(!w(e))return m(e)?b(T,e):At(rs,T,e);i=e,l=Qu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=De(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=tu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),cr&&cr(T,d),k=T.prototype=Yi(y)),k.constructor!==T&&ee(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ee(k,v,x);var P=T!=O;I[x]=T,ir({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ee(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ee(k,"BYTES_PER_ELEMENT",g),dr(x)}):t.exports=function(){}}));os("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var is=TypeError,as=function(t,e){if(!delete t[e])throw is("Cannot delete property "+Pt(e)+" of "+Pt(t))},us=Math.min,ss=N([].copyWithin||function(t,e){var r=z(this),n=Fe(r),o=Ne(t,n),i=Ne(e,n),a=arguments.length>2?arguments[2]:void 0,u=us((void 0===a?n:Ne(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:as(r,o),o+=s,i+=s;return r}),cs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("copyWithin",(function(t,e){return ss(cs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var fs=Ei.every,ls=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("every",(function(t){return fs(ls(this),t,arguments.length>1?arguments[1]:void 0)}));var hs=Za.aTypedArray,ps=Za.exportTypedArrayMethod,vs=N("".slice);ps("fill",(function(t){var e=arguments.length;hs(this);var r="Big"===vs(me(this),0,3)?ts(t):+t;return At(cu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),P((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var ds=Za.aTypedArrayConstructor,ys=Za.getTypedArrayConstructor,gs=function(t){return ds(Rr(t,ys(t)))},ms=function(t,e){return function(t,e){for(var r=0,n=Fe(e),o=new t(n);n>r;)o[r]=e[r++];return o}(gs(t),e)},bs=Ei.filter,xs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("filter",(function(t){var e=bs(xs(this),t,arguments.length>1?arguments[1]:void 0);return ms(this,e)}));var ws=Ei.find,Es=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("find",(function(t){return ws(Es(this),t,arguments.length>1?arguments[1]:void 0)}));var As=Ei.findIndex,Os=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("findIndex",(function(t){return As(Os(this),t,arguments.length>1?arguments[1]:void 0)}));var Ss=Ei.forEach,Ts=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("forEach",(function(t){Ss(Ts(this),t,arguments.length>1?arguments[1]:void 0)}));var ks=ze.includes,Is=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("includes",(function(t){return ks(Is(this),t,arguments.length>1?arguments[1]:void 0)}));var js=ze.indexOf,Ps=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("indexOf",(function(t){return js(Ps(this),t,arguments.length>1?arguments[1]:void 0)}));var _s=ot("iterator"),Ms=S.Uint8Array,Ls=N(Aa.values),Rs=N(Aa.keys),Ns=N(Aa.entries),Cs=Za.aTypedArray,Ds=Za.exportTypedArrayMethod,Fs=Ms&&Ms.prototype,Ws=!P((function(){Fs[_s].call([1])})),zs=!!Fs&&Fs.values&&Fs[_s]===Fs.values&&"values"===Fs.values.name,Bs=function(){return Ls(Cs(this))};Ds("entries",(function(){return Ns(Cs(this))}),Ws),Ds("keys",(function(){return Rs(Cs(this))}),Ws),Ds("values",Bs,Ws||!zs,{name:"values"}),Ds(_s,Bs,Ws||!zs,{name:"values"});var Us=Za.aTypedArray,Gs=Za.exportTypedArrayMethod,Vs=N([].join);Gs("join",(function(t){return Vs(Us(this),t)}));var Hs=Math.min,qs=[].lastIndexOf,Zs=!!qs&&1/[1].lastIndexOf(1,-0)<0,Ys=Ai("lastIndexOf"),$s=Zs||!Ys?function(t){if(Zs)return Fr(qs,this,arguments)||0;var e=Te(this),r=Fe(e),n=r-1;for(arguments.length>1&&(n=Hs(n,Me(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:qs,Ks=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Fr($s,Ks(this),e>1?[t,arguments[1]]:[t])}));var Qs=Ei.map,Xs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("map",(function(t){return Qs(Xs(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(gs(t))(e)}))}));var Js=TypeError,tc=function(t){return function(e,r,n,o){Mt(r);var i=z(e),a=Se(i),u=Fe(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw Js("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ec={left:tc(!1),right:tc(!0)},rc=ec.left,nc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return rc(nc(this),t,e,e>1?arguments[1]:void 0)}));var oc=ec.right,ic=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return oc(ic(this),t,e,e>1?arguments[1]:void 0)}));var ac=Za.aTypedArray,uc=Za.exportTypedArrayMethod,sc=Math.floor;uc("reverse",(function(){for(var t,e=ac(this).length,r=sc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var cc=S.RangeError,fc=S.Int8Array,lc=fc&&fc.prototype,hc=lc&&lc.set,pc=Za.aTypedArray,vc=Za.exportTypedArrayMethod,dc=!P((function(){var t=new Uint8ClampedArray(2);return At(hc,t,{length:1,0:3},1),3!==t[1]})),yc=dc&&Za.NATIVE_ARRAY_BUFFER_VIEWS&&P((function(){var t=new fc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));vc("set",(function(t){pc(this);var e=Qu(arguments.length>1?arguments[1]:void 0,1),r=z(t);if(dc)return At(hc,this,r,e);var n=this.length,o=Fe(r),i=0;if(o+e>n)throw cc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!dc||yc);var gc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Gr(gc(this),t,e),n=gs(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),P((function(){new Int8Array(1).slice()})));var mc=Ei.some,bc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("some",(function(t){return mc(bc(this),t,arguments.length>1?arguments[1]:void 0)}));var xc=Math.floor,wc=function(t,e){var r=t.length,n=xc(r/2);return r<8?Ec(t,e):Ac(t,wc(hu(t,0,n),e),wc(hu(t,n),e),e)},Ec=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ac=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Oc=wc,Sc=Z.match(/firefox\\/(\\d+)/i),Tc=!!Sc&&+Sc[1],kc=/MSIE|Trident/.test(Z),Ic=Z.match(/AppleWebKit\\/(\\d+)\\./),jc=!!Ic&&+Ic[1],Pc=Za.aTypedArray,_c=Za.exportTypedArrayMethod,Mc=S.Uint16Array,Lc=Mc&&Wr(Mc.prototype.sort),Rc=!(!Lc||P((function(){Lc(new Mc(2),null)}))&&P((function(){Lc(new Mc(2),{})}))),Nc=!!Lc&&!P((function(){if(X)return X<74;if(Tc)return Tc<67;if(kc)return!0;if(jc)return jc<602;var t,e,r=new Mc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Lc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));_c("sort",(function(t){return void 0!==t&&Mt(t),Nc?Lc(this,t):Oc(Pc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Nc||Rc);var Cc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("subarray",(function(t,e){var r=Cc(this),n=r.length,o=Ne(t,n);return new(gs(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,De((void 0===e?n:Ne(e,n))-o))}));var Dc=S.Int8Array,Fc=Za.aTypedArray,Wc=Za.exportTypedArrayMethod,zc=[].toLocaleString,Bc=!!Dc&&P((function(){zc.call(new Dc(1))}));Wc("toLocaleString",(function(){return Fr(zc,Bc?Gr(Fc(this)):Fc(this),Gr(arguments))}),P((function(){return[1,2].toLocaleString()!=new Dc([1,2]).toLocaleString()}))||!P((function(){Dc.prototype.toLocaleString.call([1,2])})));var Uc=Za.exportTypedArrayMethod,Gc=S.Uint8Array,Vc=Gc&&Gc.prototype||{},Hc=[].toString,qc=N([].join);P((function(){Hc.call({})}))&&(Hc=function(){return qc(this)});var Zc=Vc.toString!=Hc;Uc("toString",Hc,Zc),ir({target:"Array",proto:!0},{fill:cu}),ea("fill");var Yc,$c,Kc=String,Qc=function(t){if("Symbol"===me(t))throw TypeError("Cannot convert a Symbol value to a string");return Kc(t)},Xc=function(){var t=wt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Jc=S.RegExp,tf=P((function(){var t=Jc("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),ef=tf||P((function(){return!Jc("a","y").sticky})),rf={BROKEN_CARET:tf||P((function(){var t=Jc("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:ef,UNSUPPORTED_Y:tf},nf=S.RegExp,of=P((function(){var t=nf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),af=S.RegExp,uf=P((function(){var t=af("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),sf=ce.get,cf=j("native-string-replace",String.prototype.replace),ff=RegExp.prototype.exec,lf=ff,hf=N("".charAt),pf=N("".indexOf),vf=N("".replace),df=N("".slice),yf=($c=/b*/g,At(ff,Yc=/a/,"a"),At(ff,$c,"a"),0!==Yc.lastIndex||0!==$c.lastIndex),gf=rf.BROKEN_CARET,mf=void 0!==/()??/.exec("")[1];(yf||mf||gf||of||uf)&&(lf=function(t){var e,r,n,o,i,a,u,s=this,c=sf(s),f=Qc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=At(lf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=gf&&s.sticky,v=At(Xc,s),d=s.source,y=0,g=f;if(p&&(v=vf(v,"y",""),-1===pf(v,"g")&&(v+="g"),g=df(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==hf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),mf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),yf&&(n=s.lastIndex),o=At(ff,p?r:s,g),p?o?(o.input=df(o.input,y),o[0]=df(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:yf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),mf&&o&&o.length>1&&At(cf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Yi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var bf=lf;ir({target:"RegExp",proto:!0,forced:/./.exec!==bf},{exec:bf});var xf,wf=ot("species"),Ef=RegExp.prototype,Af=function(t,e,r,n){var o=ot(t),i=!P((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!P((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[wf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=Wr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=Wr(t),s=e.exec;return s===bf||s===Ef.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));le(String.prototype,t,s[0]),le(Ef,o,s[1])}n&&ee(Ef[o],"sham",!0)},Of=N("".charAt),Sf=N("".charCodeAt),Tf=N("".slice),kf=function(t){return function(e,r){var n,o,i=Qc(F(e)),a=Me(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Sf(i,a))<55296||n>56319||a+1===u||(o=Sf(i,a+1))<56320||o>57343?t?Of(i,a):n:t?Tf(i,a,a+2):o-56320+(n-55296<<10)+65536}},If={codeAt:kf(!1),charAt:kf(!0)},jf=If.charAt,Pf=function(t,e,r){return e+(r?jf(t,e).length:1)},_f=Math.floor,Mf=N("".charAt),Lf=N("".replace),Rf=N("".slice),Nf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Cf=/\\$([$&'\`]|\\d{1,2})/g,Df=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Cf;return void 0!==o&&(o=z(o),s=Nf),Lf(i,s,(function(i,s){var c;switch(Mf(s,0)){case"$":return"$";case"&":return t;case"\`":return Rf(e,0,r);case"'":return Rf(e,a);case"<":c=o[Rf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=_f(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Mf(s,1):n[l-1]+Mf(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Ff=TypeError,Wf=function(t,e){var r=t.exec;if(ft(r)){var n=At(r,t,e);return null!==n&&wt(n),n}if("RegExp"===ve(t))return At(bf,t,e);throw Ff("RegExp#exec called on incompatible receiver")},zf=ot("replace"),Bf=Math.max,Uf=Math.min,Gf=N([].concat),Vf=N([].push),Hf=N("".indexOf),qf=N("".slice),Zf="$0"==="a".replace(/./,"$0"),Yf=!!/./[zf]&&""===/./[zf]("a","$0");function $f(t){this.message=t}Af("replace",(function(t,e,r){var n=Yf?"$":"$0";return[function(t,r){var n=F(this),o=C(t)?void 0:Lt(t,zf);return o?At(o,t,n,r):At(e,Qc(n),t,r)},function(t,o){var i=wt(this),a=Qc(t);if("string"==typeof o&&-1===Hf(o,n)&&-1===Hf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=ft(o);s||(o=Qc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Wf(i,a);if(null===h)break;if(Vf(l,h),!c)break;""===Qc(h[0])&&(i.lastIndex=Pf(a,De(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Qc((h=l[y])[0]),m=Bf(Uf(Me(h.index),a.length),0),b=[],x=1;x<h.length;x++)Vf(b,void 0===(p=h[x])?p:String(p));var w=h.groups;if(s){var E=Gf([g],b,m,a);void 0!==w&&Vf(E,w);var A=Qc(Fr(o,void 0,E))}else A=Df(g,a,m,b,w,o);m>=d&&(v+=qf(a,d,m)+A,d=m+g.length)}return v+qf(a,d)}]}),!!P((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Zf||Yf),$f.prototype=new Error,$f.prototype.name="InvalidCharacterError",ir({global:!0,forced:S.globalThis!==S},{globalThis:S}),xf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:xf.devicePixelRatio;var Kf=TypeError,Qf=Object.getOwnPropertyDescriptor,Xf=lt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!Qf(t,"length").writable)throw Kf("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},Jf=TypeError,tl=function(t){if(t>9007199254740991)throw Jf("Maximum allowed index exceeded");return t},el=Pi("splice"),rl=Math.max,nl=Math.min;ir({target:"Array",proto:!0,forced:!el},{splice:function(t,e){var r,n,o,i,a,u,s=z(this),c=Fe(s),f=Ne(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=nl(rl(Me(e),0),c-f)),tl(c+r-n),o=bi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:as(s,u);for(i=c;i>c-n+r;i--)as(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:as(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return Xf(s,c-n+r),o}});var ol=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),il=Object.assign,al=Object.defineProperty,ul=N([].concat),sl=!il||P((function(){if(lt&&1!==il({b:1},il(al({},"a",{enumerable:!0,get:function(){al(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=il({},t)[r]||"abcdefghijklmnopqrst"!=Bi(il({},e)).join("")}))?function(t,e){for(var r=z(t),n=arguments.length,o=1,i=Ze.f,a=Ee.f;n>o;)for(var u,s=Se(arguments[o++]),c=i?ul(Bi(s),i(s)):Bi(s),f=c.length,l=0;f>l;)u=c[l++],lt&&!At(a,s,u)||(r[u]=s[u]);return r}:il;ir({target:"Object",stat:!0,arity:2,forced:Object.assign!==sl},{assign:sl});var cl=Ei.findIndex,fl=!0;"findIndex"in[]&&Array(1).findIndex((function(){fl=!1})),ir({target:"Array",proto:!0,forced:fl},{findIndex:function(t){return cl(this,t,arguments.length>1?arguments[1]:void 0)}}),ea("findIndex");var ll=If.charAt,hl=ce.set,pl=ce.getterFor("String Iterator");ma(String,"String",(function(t){hl(this,{type:"String Iterator",string:Qc(t),index:0})}),(function(){var t,e=pl(this),r=e.string,n=e.index;return n>=r.length?ba(void 0,!0):(t=ll(r,n),e.index+=t.length,ba(t,!1))}));var vl=!P((function(){return Object.isExtensible(Object.preventExtensions({}))})),dl=qe.f,yl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],gl={f:function(t){return yl&&"Window"==ve(t)?function(t){try{return dl(t)}catch(t){return hu(yl)}}(t):dl(Te(t))}},ml=P((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),bl=Object.isExtensible,xl=P((function(){bl(1)}))||ml?function(t){return!!pt(t)&&((!ml||"ArrayBuffer"!=ve(t))&&(!bl||bl(t)))}:bl,wl=w((function(t){var e=Ut.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=qe.f,e=N([].splice),o={};o[n]=1,t(o).length&&(qe.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ir({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:gl.f}))},fastKey:function(t,e){if(!pt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!U(t,n)){if(!xl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!U(t,n)){if(!xl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return vl&&r&&xl(t)&&!U(t,n)&&i(t),t}};oe[n]=!0})),El=(wl.enable,wl.fastKey,wl.getWeakData,wl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=S[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=N(u[t]);le(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!pt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!pt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!pt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(nr(t,!ft(a)||!(o||u.forEach&&!P((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),wl.enable();else if(nr(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=P((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&P((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){gr(t,u);var r=ns(new a,t,s);return C(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ir({global:!0,constructor:!0,forced:s!=a},c),hr(s,t),o||r.setStrong(s,t,n),s}),Al=wl.getWeakData,Ol=ce.set,Sl=ce.getterFor,Tl=Ei.find,kl=Ei.findIndex,Il=N([].splice),jl=0,Pl=function(t){return t.frozen||(t.frozen=new _l)},_l=function(){this.entries=[]},Ml=function(t,e){return Tl(t.entries,(function(t){return t[0]===e}))};_l.prototype={get:function(t){var e=Ml(this,t);if(e)return e[1]},has:function(t){return!!Ml(this,t)},set:function(t,e){var r=Ml(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=kl(this.entries,(function(e){return e[0]===t}));return~e&&Il(this.entries,e,1),!!~e}};var Ll,Rl={getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Ol(t,{type:e,id:jl++,frozen:void 0}),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Sl(e),u=function(t,e,r){var n=a(t),o=Al(wt(e),!0);return!0===o?Pl(n).set(e,r):o[n.id]=r,t};return Xa(i,{delete:function(t){var e=a(this);if(!pt(t))return!1;var r=Al(t);return!0===r?Pl(e).delete(t):r&&U(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!pt(t))return!1;var r=Al(t);return!0===r?Pl(e).has(t):r&&U(r,e.id)}}),Xa(i,r?{get:function(t){var e=a(this);if(pt(t)){var r=Al(t);return!0===r?Pl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},Nl=ce.enforce,Cl=Object,Dl=Array.isArray,Fl=Cl.isExtensible,Wl=Cl.isFrozen,zl=Cl.isSealed,Bl=Cl.freeze,Ul=Cl.seal,Gl={},Vl={},Hl=!S.ActiveXObject&&"ActiveXObject"in S,ql=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Zl=El("WeakMap",ql,Rl),Yl=Zl.prototype,$l=N(Yl.set);if(Jt)if(Hl){Ll=Rl.getConstructor(ql,"WeakMap",!0),wl.enable();var Kl=N(Yl.delete),Ql=N(Yl.has),Xl=N(Yl.get);Xa(Yl,{delete:function(t){if(pt(t)&&!Fl(t)){var e=Nl(this);return e.frozen||(e.frozen=new Ll),Kl(this,t)||e.frozen.delete(t)}return Kl(this,t)},has:function(t){if(pt(t)&&!Fl(t)){var e=Nl(this);return e.frozen||(e.frozen=new Ll),Ql(this,t)||e.frozen.has(t)}return Ql(this,t)},get:function(t){if(pt(t)&&!Fl(t)){var e=Nl(this);return e.frozen||(e.frozen=new Ll),Ql(this,t)?Xl(this,t):e.frozen.get(t)}return Xl(this,t)},set:function(t,e){if(pt(t)&&!Fl(t)){var r=Nl(this);r.frozen||(r.frozen=new Ll),Ql(this,t)?$l(this,t,e):r.frozen.set(t,e)}else $l(this,t,e);return this}})}else vl&&P((function(){var t=Bl([]);return $l(new Zl,t,1),!Wl(t)}))&&Xa(Yl,{set:function(t,e){var r;return Dl(t)&&(Wl(t)?r=Gl:zl(t)&&(r=Vl)),$l(this,t,e),r==Gl&&Bl(t),r==Vl&&Ul(t),this}});var Jl=ot("iterator"),th=ot("toStringTag"),eh=Aa.values,rh=function(t,e){if(t){if(t[Jl]!==eh)try{ee(t,Jl,eh)}catch(e){t[Jl]=eh}if(t[th]||ee(t,th,e),hi[e])for(var r in Aa)if(t[r]!==Aa[r])try{ee(t,r,Aa[r])}catch(e){t[r]=Aa[r]}}};for(var nh in hi)rh(S[nh]&&S[nh].prototype,nh);rh(di,"DOMTokenList");var oh,ih,ah,uh,sh=new WeakMap,ch=function(){function t(){i(this,t),sh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=sh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),sh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=sh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=sh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),fh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ch));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var lh=my.getSystemInfoSync();oh=lh.screenWidth,ih=lh.screenHeight,ah=lh.windowWidth,uh=lh.windowHeight}else{var hh=xf.innerWidth,ph=xf.innerHeight;oh=hh,ih=ph,ah=hh,uh=ph}var vh={width:oh,height:ih,availWidth:ah,availHeight:uh,availLeft:0,availTop:0},dh=vh.availWidth,yh=vh.availHeight,gh={style:[]};function mh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return gh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return gh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function bh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:dh+"px",height:yh+"px",margin:"0px",padding:"0px"})}function xh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=dh,t.clientHeight=yh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function wh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=dh,t.offsetHeight=yh)}function Eh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=dh,t.scrollHeight=yh)}function Ah(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function Oh(){}var Sh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=Oh,t.blur=Oh,t.insertBefore=Oh,t.appendChild=Oh,t.removeChild=Oh,t.remove=Oh,t.innerHTML="",t.tagName=n.toUpperCase(),mh(h(t),o),bh(h(t)),Ah(h(t)),xh(h(t)),wh(h(t)),Eh(h(t)),t}return u(r)}(fh),Th=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Sh)),kh={};function Ih(){return kh}var jh=u((function t(){i(this,t);var e=Ih(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),mh(r),Ah(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Ph={href:"",protocol:"",host:""},_h=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(Sh),Mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(Sh),Lh={},Rh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ph,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new jh:"video"===t?new Th:new Sh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){Lh[t]||(Lh[t]=[]),Lh[t].push(e)},removeEventListener:function(t,e){var r=Lh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=Lh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new ol(t)}};Rh.documentElement=new Mh,Rh.head=new Sh("head"),Rh.body=new _h,Af("match",(function(t,e,r){return[function(e){var r=F(this),n=C(e)?void 0:Lt(e,t);return n?At(n,e,r):new RegExp(e)[t](Qc(r))},function(t){var n=wt(this),o=Qc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Wf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Wf(n,o));){var f=Qc(u[0]);s[c]=f,""===f&&(n.lastIndex=Pf(o,De(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Nh,Ch,Dh=ot("isConcatSpreadable"),Fh=X>=51||!P((function(){var t=[];return t[Dh]=!1,t.concat()[0]!==t})),Wh=function(t){if(!pt(t))return!1;var e=t[Dh];return void 0!==e?!!e:yi(t)},zh=!Fh||!Pi("concat");if(ir({target:"Array",proto:!0,arity:1,forced:zh},{concat:function(t){var e,r,n,o,i,a=z(this),u=bi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Wh(i=-1===e?a:arguments[e]))for(o=Fe(i),tl(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else tl(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Bh=my.getSystemInfoSync();Nh=Bh.system,Bh.platform,Bh.language}else{var Uh={versions:(Ch=xf.navigator.userAgent,{trident:Ch.indexOf("Trident")>-1,presto:Ch.indexOf("Presto")>-1,webKit:Ch.indexOf("AppleWebKit")>-1,gecko:Ch.indexOf("Gecko")>-1&&-1===Ch.indexOf("KHTML"),mobile:!!Ch.match(/AppleWebKit.*Mobile.*/),ios:!!Ch.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Ch.indexOf("Android")>-1||Ch.indexOf("Linux")>-1,iPhone:Ch.indexOf("iPhone")>-1,iPad:Ch.indexOf("iPad")>-1,webApp:-1===Ch.indexOf("Safari"),weixin:Ch.indexOf("MicroMessenger")>-1,qq:" qq"===Ch.match(/\\sQQ/i)}),language:(xf.navigator.browserLanguage||xf.navigator.language).toLowerCase()};Uh.versions.android?"android":Uh.versions.trident?"IE":Uh.versions.presto?"Opera":Uh.versions.webKit?"webKit":Uh.versions.gecko?"Firefox":Uh.versions.mobile?"mobile":Uh.versions.ios?"ios":Uh.versions.iPhone?"iPhone":Uh.versions.iPad?"ipad":Uh.versions.webApp?"webApp":Uh.versions.weixin?"weixin":Uh.versions.qq&&"qq",Nh=xf.navigator.userAgent,Uh.language}Nh.toLowerCase().indexOf("android");os("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Gh=wl.fastKey,Vh=ce.set,Hh=ce.getterFor;El("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Vh(t,{type:e,index:Yi(null),first:void 0,last:void 0,size:0}),lt||(t.size=0),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Hh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=Gh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),lt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=Gh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Xa(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,lt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),lt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Br(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Xa(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),lt&&pr(i,"size",{configurable:!0,get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Hh(e),i=Hh(n);ma(t,e,(function(t,e){Vh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?ba("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,ba(void 0,!0))}),r?"entries":"values",!r,!0),dr(e)}});var qh=N([].join),Zh=Se!=Object||!Ai("join",",");ir({target:"Array",proto:!0,forced:Zh},{join:function(t){return qh(Te(this),void 0===t?",":t)}});var Yh=Ei.map,$h=Pi("map");ir({target:"Array",proto:!0,forced:!$h},{map:function(t){return Yh(this,t,arguments.length>1?arguments[1]:void 0)}});var Kh=P((function(){Bi(1)}));ir({target:"Object",stat:!0,forced:Kh},{keys:function(t){return Bi(z(t))}});var Qh=new Map,Xh=new Map,Jh=new Map,tp=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Qh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=Jh.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Xh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Xh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Qh.get("requestHeader");r[t]=e,Qh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ch);s(tp,"UNSEND",void 0),s(tp,"OPENED",void 0),s(tp,"HEADERS_RECEIVED",void 0),s(tp,"LOADING",void 0),s(tp,"DONE",void 0),tp.UNSEND=0,tp.OPENED=1,tp.HEADERS_RECEIVED=2,tp.LOADING=3,tp.DONE=4;var ep="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,rp="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),np=(ep||rp)&&!1;np||xf.XMLHttpRequest,np||xf.location;function op(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ip=Ei.filter,ap=Pi("filter");function up(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function sp(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function cp(t){return t.filter?[1]:[0]}function fp(t,e){return[e]}ir({target:"Array",proto:!0,forced:!ap},{filter:function(t){return ip(this,t,arguments.length>1?arguments[1]:void 0)}});var lp=pp,hp=pp;function pp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=vp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=vp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(Sp(s));for(c.sort(wp),o=0;o<c.length;o++)r=Ep(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return yp(h,p,r,n,o,c,0),p}function vp(t,e,r,n,o){var i,a;if(o===Fp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Np(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Np(i,t[i],t[i+1],a);return a&&jp(a,a.next)&&(Cp(a),a=a.next),a}function dp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!jp(n,n.next)&&0!==Ip(n.prev,n,n.next))n=n.next;else{if(Cp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function yp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=Op(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?mp(t,n,o,i):gp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Cp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?yp(t=bp(dp(t),e,r),e,r,n,o,i,2):2===a&&xp(t,e,r,n,o,i):yp(dp(t),e,r,n,o,i,1);break}}}function gp(t){var e=t.prev,r=t,n=t.next;if(Ip(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Tp(o,u,i,s,a,c,v.x,v.y)&&Ip(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function mp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Ip(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=Op(p,v,e,r,n),m=Op(d,y,e,r,n),b=t.prevZ,x=t.nextZ;b&&b.z>=g&&x&&x.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Tp(u,f,s,l,c,h,b.x,b.y)&&Ip(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Tp(u,f,s,l,c,h,x.x,x.y)&&Ip(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Tp(u,f,s,l,c,h,b.x,b.y)&&Ip(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Tp(u,f,s,l,c,h,x.x,x.y)&&Ip(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function bp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!jp(o,i)&&Pp(o,n,n.next,i)&&Lp(o,i)&&Lp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Cp(n),Cp(n.next),n=t=i),n=n.next}while(n!==t);return dp(n)}function xp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&kp(a,u)){var s=Rp(a,u);return a=dp(a,a.next),s=dp(s,s.next),yp(a,e,r,n,o,i,0),void yp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function wp(t,e){return t.x-e.x}function Ep(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Tp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),Lp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&Ap(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Rp(r,t);return dp(n,n.next),dp(r,r.next)}function Ap(t,e){return Ip(t.prev,t,e.prev)<0&&Ip(e.next,t,t.next)<0}function Op(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Sp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Tp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function kp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Pp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Lp(t,e)&&Lp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Ip(t.prev,t,e.prev)||Ip(t,e.prev,e))||jp(t,e)&&Ip(t.prev,t,t.next)>0&&Ip(e.prev,e,e.next)>0)}function Ip(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function jp(t,e){return t.x===e.x&&t.y===e.y}function Pp(t,e,r,n){var o=Mp(Ip(t,e,r)),i=Mp(Ip(t,e,n)),a=Mp(Ip(r,n,t)),u=Mp(Ip(r,n,e));return o!==i&&a!==u||(!(0!==o||!_p(t,r,e))||(!(0!==i||!_p(t,n,e))||(!(0!==a||!_p(r,t,n))||!(0!==u||!_p(r,e,n)))))}function _p(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Mp(t){return t>0?1:t<0?-1:0}function Lp(t,e){return Ip(t.prev,t,t.next)<0?Ip(t,e,t.next)>=0&&Ip(t,t.prev,e)>=0:Ip(t,e,t.prev)<0||Ip(t,t.next,e)<0}function Rp(t,e){var r=new Dp(t.i,t.x,t.y),n=new Dp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Np(t,e,r,n){var o=new Dp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Cp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Dp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}pp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Fp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Fp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},pp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},lp.default=hp;var Wp=S,zp=N(1..valueOf),Bp="\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff",Up=N("".replace),Gp=RegExp("^["+Bp+"]+"),Vp=RegExp("(^|[^"+Bp+"])["+Bp+"]+$"),Hp=function(t){return function(e){var r=Qc(F(e));return 1&t&&(r=Up(r,Gp,"")),2&t&&(r=Up(r,Vp,"$1")),r}},qp={start:Hp(1),end:Hp(2),trim:Hp(3)},Zp=qe.f,Yp=Ie.f,$p=Ut.f,Kp=qp.trim,Qp=S.Number,Xp=(Wp.Number,Qp.prototype),Jp=S.TypeError,tv=N("".slice),ev=N("".charCodeAt),rv=function(t){var e=Dt(t,"number");return"bigint"==typeof e?e:nv(e)},nv=function(t){var e,r,n,o,i,a,u,s,c=Dt(t,"number");if(It(c))throw Jp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Kp(c),43===(e=ev(c,0))||45===e){if(88===(r=ev(c,2))||120===r)return NaN}else if(48===e){switch(ev(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=tv(c,2)).length,u=0;u<a;u++)if((s=ev(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c},ov=nr("Number",!Qp(" 0o1")||!Qp("0b1")||Qp("+0x1")),iv=function(t){return Tt(Xp,t)&&P((function(){zp(t)}))},av=function(t){var e=arguments.length<1?0:Qp(rv(t));return iv(this)?ns(Object(e),this,av):e};av.prototype=Xp,ov&&(Xp.constructor=av),ir({global:!0,constructor:!0,wrap:!0,forced:ov},{Number:av});ov&&function(t,e){for(var r,n=lt?Zp(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0;n.length>o;o++)U(e,r=n[o])&&!U(t,r)&&$p(t,r,Yp(e,r))}(Wp.Number,Qp);var uv=RangeError,sv=RangeError,cv=String,fv=Math.floor,lv=N((function(t){var e=Qc(F(this)),r="",n=Me(t);if(n<0||n==1/0)throw uv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),hv=N("".slice),pv=N(1..toFixed),vv=function(t,e,r){return 0===e?r:e%2==1?vv(t,e-1,r*t):vv(t*t,e/2,r)},dv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=fv(o/1e7)},yv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=fv(n/e),n=n%e*1e7},gv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=cv(t[e]);r=""===r?n:r+lv("0",7-n.length)+n}return r},mv=P((function(){return"0.000"!==pv(8e-5,3)||"1"!==pv(.9,0)||"1.25"!==pv(1.255,2)||"1000000000000000128"!==pv(0xde0b6b3a7640080,0)}))||!P((function(){pv({})}));function bv(t){return"number"==typeof t}function xv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ir({target:"Number",proto:!0,forced:mv},{toFixed:function(t){var e,r,n,o,i=zp(this),a=Me(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw sv("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return cv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*vv(2,69,1))-69)<0?i*vv(2,-e,1):i/vv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(dv(u,0,r),n=a;n>=7;)dv(u,1e7,0),n-=7;for(dv(u,vv(10,n,1),0),n=e-1;n>=23;)yv(u,1<<23),n-=23;yv(u,1<<n),dv(u,1,1),yv(u,2),c=gv(u)}else dv(u,0,r),dv(u,1<<-e,0),c=gv(u)+lv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+lv("0",a-o)+c:hv(c,0,o-a)+"."+hv(c,o-a)):s+c}});var wv,Ev=/"/g,Av=N("".replace);ir({target:"String",proto:!0,forced:(wv="sub",P((function(){var t=""[wv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=Qc(F(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+Av(Qc(r),Ev,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var Ov=RegExp.prototype,Sv=qt.PROPER,Tv=RegExp.prototype.toString,kv=P((function(){return"/a/b"!=Tv.call({source:"a",flags:"b"})})),Iv=Sv&&"toString"!=Tv.name;(kv||Iv)&&le(RegExp.prototype,"toString",(function(){var t=wt(this);return"/"+Qc(t.source)+"/"+Qc(function(t){var e=t.flags;return void 0!==e||"flags"in Ov||U(t,"flags")||!Tt(Ov,t)?e:At(Xc,t)}(t))}),{unsafe:!0});var jv="undefined"!=typeof Float32Array?Float32Array:Array;function Pv(){var t=new jv(2);return jv!=Float32Array&&(t[0]=0,t[1]=0),t}function _v(t,e){var r=new jv(2);return r[0]=t,r[1]=e,r}function Mv(t,e){return t[0]=e[0],t[1]=e[1],t}function Lv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Rv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Nv(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Cv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Dv,Fv=Rv,Wv=(Dv=Pv(),Pv()),zv=(Pv(),Pv()),Bv=Pv(),Uv=Pv();function Gv(t,e,r,n,o){return Lv(t,r,n),Nv(t,t),[o/Cv(e=_v(-t[1],t[0]),_v(-r[1],r[0])),e]}function Vv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Hv(t,e,r){return Fv(t,e,r),Nv(t,t),t}function qv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Zv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",_v(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=xv([a[0],a[1]]),g=xv([i[0],i[1]]);Hv(zv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Pv(),Vv(this.normal,zv)),!this.started)if(this.started=!0,h){var b=Pv(),x=Pv();Lv(b,this.normal,zv),Lv(x,this.normal,zv),l.push(x[0],x[1],0),l.push(b[0],b[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){qv(n,o)&&Lv(o,n,Nv(o,Rv(o,n,r))),Hv(Bv,o,n);var w=d(Gv(Uv,Pv(),zv,Bv,this.thickness),2),E=w[0],A=w[1],O=Cv(Uv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),Vv(Wv,Bv),Mv(this.normal,Wv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Mv(this.normal,A),s+=2),this.lastFlip=O}else{if(Vv(this.normal,zv),h){var T=Pv(),k=Pv();Fv(k,zv,this.normal),Lv(T,zv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=xv([n[0],n[1]]),f=xv([r[0],r[1]]);Hv(zv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Pv(),Vv(this.normal,zv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=xv([o[0],o[1]]);qv(c,h)&&Lv(h,c,Nv(h,Rv(h,c,f))),Hv(Bv,h,c);var p=d(Gv(Uv,Pv(),zv,Bv,this.thickness),2),v=p[0],g=p[1];Cv(Uv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Mv(this.normal,g),i+=2,this.lastFlip=-1}else Vv(this.normal,zv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=xv([n[0],n[1]]),h=xv([r[0],r[1]]);Hv(zv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Pv(),Vv(this.normal,zv)),!this.started)if(this.started=!0,c){var v=Pv(),g=Pv();Lv(v,this.normal,zv),Lv(g,this.normal,zv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=xv([o[0],o[1]]);qv(l,m)&&Lv(m,l,Nv(m,Rv(m,l,h))),Hv(Bv,m,l);var b=d(Gv(Uv,Pv(),zv,Bv,this.thickness),2),x=b[0],w=b[1],E=Cv(Uv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)x>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Vv(Wv,Bv),Mv(this.normal,Wv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,x,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Mv(this.normal,w),i+=2),this.lastFlip=E}else{if(Vv(this.normal,zv),c){var O=Pv(),S=Pv();Fv(S,zv,this.normal),Lv(O,zv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Yv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Zv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function $v(t){var e=function(t){if(bv(t[0]))return t;if(bv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(bv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Kv(t){var e=t.coordinates,r=lp.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:lp(n,i,o),vertices:n,size:o}}var Qv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:up,a_Position:sp,filter:cp,a_vertexId:fp,a_PickingColor:function(t){var e=t.id;return i?op(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Yv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Xv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:up,a_Position:sp,filter:cp,a_vertexId:fp,a_PickingColor:function(t){var e=t.id;return i?op(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=$v(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Qv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:up,a_Position:sp,filter:cp,a_vertexId:fp,a_PickingColor:function(t){var e=t.id;return i?op(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Kv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Jv=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Xv);function td(t){return ed.apply(this,arguments)}function ed(){return(ed=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!Jv[n]){t.next=3;break}return t.abrupt("return",Jv[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(td),t.WorkerSourceMap=Xv,t.createWorker=fi,t.worker=td,t}({});
`,bn="l7-worker",Fd=3,wd=!0;function Od(r){Ld(bn,r)}function Dd(){var r=Rd(bn);if(!r)throw new Error("get worker failed by workerName: ".concat(bn,"."));return r}function Id(r,a){return xi.apply(this,arguments)}function xi(){return xi=(0,k.Z)(y().mark(function r(a,t){var n,e,i,o,u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=Dd(),e=Mo.qH.getWorkerFarm({maxConcurrency:Fd,reuseWorkers:wd}),i=e.getWorkerPool({name:bn,source:n}),l.next=5,i.startJob(bn,function(c,f,p){return c.done(p)});case 5:return o=l.sent,o.postMessage("process",{input:{workerType:a,data:t}}),l.next=9,o.result;case 9:return u=l.sent,l.abrupt("return",u.result);case 11:case"end":return l.stop()}},r)})),xi.apply(this,arguments)}Od(kd);var Pd=z(99653),Bd=z.n(Pd);function wo(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=Nd(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function Nd(r,a){if(!!r){if(typeof r=="string")return Oo(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Oo(r,a)}}function Oo(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var An=30;function Zd(r){var a=r.characterSet,t=r.getFontWidth,n=r.fontHeight,e=r.buffer,i=r.maxCanvasWidth,o=r.mapping,u=o===void 0?{}:o,s=r.xOffset,l=s===void 0?0:s,c=r.yOffset,f=c===void 0?0:c,p=0,h=l;Array.from(a).forEach(function(v,_){if(!u[v]){var x=t(v,_);h+An>i&&(h=0,p++),u[v]={x:h,y:f+p*An,width:An,height:An,advance:x},h+=An}});var g=n+e*2;return{mapping:u,xOffset:h,yOffset:f+p*g,canvasHeight:Io(f+(p+1)*g)}}function zd(r,a,t){var n=0,e=0,i=0,o=[],u={},s=wo(r),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;if(!u[c.id]){var f=c.size;n+f+a>t&&(Do(u,o,e),n=0,e=i+e+a,i=0,o=[]),o.push({icon:c,xOffset:n}),n=n+f+a,i=Math.max(i,f)}}}catch(h){s.e(h)}finally{s.f()}o.length>0&&Do(u,o,e);var p=Io(i+e+a);return{mapping:u,canvasHeight:p}}function Do(r,a,t){var n=wo(a),e;try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.icon,u=i.xOffset;r[o.id]=(0,A.Z)((0,A.Z)({},o),{},{x:u,y:t,image:o.image,width:o.width,height:o.height})}}catch(s){n.e(s)}finally{n.f()}}function Io(r){return Math.pow(2,Math.ceil(Math.log2(r)))}var Po,Bo;function No(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=Ud(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function Ud(r,a){if(!!r){if(typeof r=="string")return Zo(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Zo(r,a)}}function Zo(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function Hd(r){var a=jd();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function jd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Vd=Jd(),Gd="sans-serif",Wd="normal",$d=24,Xd=3,Yd=.25,Kd=8,zo=1024,Qd=1,Uo=1,qd=3,ub=null;function Jd(){for(var r=[],a=32;a<128;a++)r.push(String.fromCharCode(a));return r}function Ho(r,a,t,n){r.font="".concat(n," ").concat(t,"px ").concat(a),r.fillStyle="black",r.textBaseline="middle"}function jo(r,a){for(var t=0;t<r.length;t++)a.data[4*t+3]=r[t]}var ev=(Po=(0,j.b2)(),Po(Bo=function(r){(0,F.Z)(t,r);var a=Hd(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"fontAtlas",void 0),(0,d.Z)((0,E.Z)(n),"iconFontMap",void 0),(0,d.Z)((0,E.Z)(n),"iconFontGlyphs",{}),(0,d.Z)((0,E.Z)(n),"fontOptions",void 0),(0,d.Z)((0,E.Z)(n),"key",void 0),(0,d.Z)((0,E.Z)(n),"cache",new Yh(qd)),n}return(0,T.Z)(t,[{key:"scale",get:function(){return Uo}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var i=this.cache.get(e);return i&&i.data}},{key:"getMappingByKey",value:function(e){var i=this.cache.get(e);return i&&i.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Gd,fontWeight:Wd,characterSet:Vd,fontSize:$d,buffer:Xd,sdf:!0,cutoff:Yd,radius:Kd,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var i=this;e.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(e,i){this.iconFontMap.set(e,i)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=(0,A.Z)((0,A.Z)({},this.fontOptions),e),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var u=this.generateFontAtlas(this.key,i,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"addFontFace",value:function(e,i){var o=this,u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(e,`';
            src: url('`).concat(i,`') format('woff2'),
            url('`).concat(i,`') format('woff'),
            url('`).concat(i,`') format('truetype');
        }`),u.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then(function(){o.emit("fontloaded",{fontFamily:e})})}catch(s){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(s)}},document.getElementsByTagName("head")[0].appendChild(u)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,i,o){var u=this.fontOptions,s=u.fontFamily,l=u.fontWeight,c=u.fontSize,f=u.buffer,p=u.sdf,h=u.radius,g=u.cutoff,v=u.iconfont,_=o&&o.data;_||(_=se.document.createElement("canvas"),_.width=zo);var x=_.getContext("2d",{willReadFrequently:!0});Ho(x,s,c,l);var C=Zd((0,A.Z)({getFontWidth:function(nt){return x.measureText(nt).width},fontHeight:c*Uo,buffer:f,characterSet:i,maxCanvasWidth:zo},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),S=C.mapping,M=C.canvasHeight,L=C.xOffset,D=C.yOffset,B=x.getImageData(0,0,_.width,_.height);if(_.height=M,x.putImageData(B,0,0),Ho(x,s,c,l),p){var I=new(Bd())(c,f,h,g,s,l),P=x.getImageData(0,0,I.size,I.size),U=No(i),V;try{for(U.s();!(V=U.n()).done;){var K=V.value;if(v){var Q=String.fromCharCode(parseInt(K.replace("&#x","").replace(";",""),16)),te=I.draw(Q);jo(te,P)}else jo(I.draw(K),P);x.putImageData(P,S[K].x,S[K].y)}}catch(Se){U.e(Se)}finally{U.f()}}else{var ce=No(i),fe;try{for(ce.s();!(fe=ce.n()).done;){var Ce=fe.value;x.fillText(Ce,S[Ce].x,S[Ce].y+c*Qd)}}catch(Se){ce.e(Se)}finally{ce.f()}}return{xOffset:L,yOffset:D,mapping:S,data:_,width:_.width,height:_.height}}},{key:"getKey",value:function(){var e=this.fontOptions,i=e.fontFamily,o=e.fontWeight;return"".concat(i,"_").concat(o)}},{key:"getNewChars",value:function(e,i){var o=this.cache.get(e);if(!o)return i;var u=[],s=o.mapping,l=new Set(Object.keys(s)),c=new Set(i);return c.forEach(function(f){l.has(f)||u.push(f)}),u}}]),t}(pe.EventEmitter))||Bo),Vo,Go;function tv(r){var a=nv();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function nv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var rv=3,Wo=1024,Tn=64,iv=(Vo=(0,j.b2)(),Vo(Go=function(r){(0,F.Z)(t,r);var a=tv(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"canvasHeight",128),(0,d.Z)((0,E.Z)(n),"texture",void 0),(0,d.Z)((0,E.Z)(n),"canvas",void 0),(0,d.Z)((0,E.Z)(n),"iconData",void 0),(0,d.Z)((0,E.Z)(n),"iconMap",void 0),(0,d.Z)((0,E.Z)(n),"ctx",void 0),(0,d.Z)((0,E.Z)(n),"loadingImageCount",0),n}return(0,T.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=se.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,k.Z)(y().mark(function i(o,u){var s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=new Image,this.loadingImageCount++,this.hasImage(o)?console.warn("Image Id already exists"):this.iconData.push({id:o,size:Tn}),this.updateIconMap(),f.next=6,this.loadImage(u);case 6:s=f.sent,l=this.iconData.find(function(p){return p.id===o}),l&&(l.image=s,l.width=s.width,l.height=s.height),this.update();case 10:case"end":return f.stop()}},i,this)}));function e(i,o){return n.apply(this,arguments)}return e}()},{key:"addImageMini",value:function(e,i,o){var u=this,s=o.getSceneConfig().canvas,l=s.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:Tn}),this.updateIconMap(),this.loadImageMini(i,s).then(function(c){l=c;var f=u.iconData.find(function(p){return p.id===e});f&&(f.image=l,f.width=l.width,f.height=l.height),u.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter(function(i){return i.id!==e}),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise(function(i,o){if(e instanceof HTMLImageElement){i(e);return}var u=new Image;u.crossOrigin="anonymous",u.onload=function(){i(u)},u.onerror=function(){o(new Error("Could not load image at "+e))},u.src=e instanceof File?URL.createObjectURL(e):e})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=Wo,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(i){var o=e.iconMap[i],u=o.x,s=o.y,l=o.image,c=o.width,f=c===void 0?64:c,p=o.height,h=p===void 0?64:p,g=Math.max(f,h),v=g/Tn,_=h/v,x=f/v;l&&e.ctx.drawImage(l,u+(Tn-x)/2,s+(Tn-_)/2,x,_)})}},{key:"updateIconMap",value:function(){var e=zd(this.iconData,rv,Wo),i=e.mapping,o=e.canvasHeight;this.iconMap=i,this.canvasHeight=o}},{key:"loadImageMini",value:function(e,i){return new Promise(function(o,u){var s=i.createImage();s.crossOrigin="anonymous",s.onload=function(){o(s)},s.onerror=function(){u(new Error("Could not load image at "+e))},s.src=e})}}]),t}(pe.EventEmitter))||Go),ee=z(85975),$o,Xo,av=($o=(0,j.b2)(),$o(Xo=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"viewport",void 0),(0,d.Z)(this,"overridedViewProjectionMatrix",void 0),(0,d.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,d.Z)(this,"jitteredProjectionMatrix",void 0),(0,d.Z)(this,"viewMatrixInverse",void 0),(0,d.Z)(this,"cameraPosition",void 0)}return(0,T.Z)(r,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=ee.create(),ee.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,W.Z)(t,2),e=n[0],i=n[1];return[e,i]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var e=ee.fromTranslation(ee.create(),[t,n,0]);this.jitteredProjectionMatrix=ee.multiply(ee.create(),e,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ee.multiply(ee.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),r}())||Xo),ct;(function(r){r.TOPRIGHT="topright",r.TOPLEFT="topleft",r.BOTTOMRIGHT="bottomright",r.BOTTOMLEFT="bottomleft",r.TOPCENTER="topcenter",r.BOTTOMCENTER="bottomcenter",r.LEFTCENTER="leftcenter",r.RIGHTCENTER="rightcenter",r.LEFTTOP="lefttop",r.RIGHTTOP="righttop",r.LEFTBOTTOM="leftbottom",r.RIGHTBOTTOM="rightbottom"})(ct||(ct={}));var Yo,Ko;function ov(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=uv(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function uv(r,a){if(!!r){if(typeof r=="string")return Qo(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qo(r,a)}}function Qo(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var sv={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},lv=(Yo=(0,j.b2)(),Yo(Ko=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"container",void 0),(0,d.Z)(this,"controlCorners",void 0),(0,d.Z)(this,"controlContainer",void 0),(0,d.Z)(this,"scene",void 0),(0,d.Z)(this,"mapsService",void 0),(0,d.Z)(this,"controls",[]),(0,d.Z)(this,"unAddControls",[])}return(0,T.Z)(r,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(w.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var e=n.get(w.IMapService);e.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=ov(this.controls),n;try{for(t.s();!(n=t.n()).done;){var e=n.value;e.remove()}}catch(i){t.e(i)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",e=this.controlContainer=re("div",n+"control-container",this.container);function i(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=u.map(function(l){return n+l}).join(" ");t[u.filter(function(l){return!["row","column"].includes(l)}).join("")]=re("div",s,e)}function o(u){var s=u.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,G.Z)(s),[sv[u]])}Object.values(ct).forEach(function(u){i(o(u))})}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ze(this.controlCorners[t]);this.controlContainer&&Ze(this.controlContainer)}}]),r}())||Ko),qo,Jo,cv=(qo=(0,j.b2)(),qo(Jo=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"container",void 0),(0,d.Z)(this,"scene",void 0),(0,d.Z)(this,"mapsService",void 0),(0,d.Z)(this,"markers",[]),(0,d.Z)(this,"markerLayers",[]),(0,d.Z)(this,"unAddMarkers",[]),(0,d.Z)(this,"unAddMarkerLayers",[])}return(0,T.Z)(r,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(w.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),r}())||Jo),eu,tu,fv=(eu=(0,j.b2)(),eu(tu=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"scene",void 0),(0,d.Z)(this,"mapsService",void 0),(0,d.Z)(this,"popups",[]),(0,d.Z)(this,"unAddPopups",[])}return(0,T.Z)(r,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var e=this.unAddPopups.indexOf(t);e>-1&&this.unAddPopups.splice(e,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,G.Z)(this.popups),(0,G.Z)(this.unAddPopups)).forEach(function(e){e.getOptions().autoClose&&n.removePopup(e)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(w.IMapService)}}]),r}())||tu),tt;(function(r){r.normal="normal",r.additive="additive",r.subtractive="subtractive",r.min="min",r.max="max",r.none="none"})(tt||(tt={}));var ft;(function(r){r.MULTIPLE="MULTIPLE",r.SINGLE="SINGLE"})(ft||(ft={}));var Qt;(function(r){r.AND="and",r.OR="or"})(Qt||(Qt={}));var ge;(function(r){r.INIT="init",r.UPDATE="update"})(ge||(ge={}));var pv={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},hv=pv,nu,ru,dv={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},vv={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Qt.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},gv=(nu=(0,j.b2)(),nu(ru=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"sceneConfigCache",{}),(0,d.Z)(this,"layerConfigCache",{}),(0,d.Z)(this,"layerAttributeConfigCache",{})}return(0,T.Z)(r,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return hv[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,A.Z)((0,A.Z)({},dv),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,e){this.layerConfigCache[n]=(0,A.Z)({},(0,N.merge)({},this.sceneConfigCache[t],vv,e))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,A.Z)((0,A.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),r}())||ru),J=z(55770),q=z(3473),lr=z(98333),Ci=Math.PI/180,mv=512,iu=4003e4;function au(r){var a=r.latitude,t=a===void 0?0:a,n=r.zoom,e=n===void 0?0:n,i=r.scale,o=r.highPrecision,u=o===void 0?!1:o,s=r.flipY,l=s===void 0?!1:s;i=i!==void 0?i:Math.pow(2,e);var c={},f=mv*i,p=Math.cos(t*Ci),h=f/360,g=h/p,v=f/iu/p;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[h,-g,v],c.degreesPerPixel=[1/h,-1/g,1/v],u){var _=Ci*Math.tan(t*Ci)/p,x=h*_/2,C=f/iu*_,S=C/g*v;c.pixelsPerDegree2=[0,-x,C],c.pixelsPerMeter2=[S,0,S],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var We;(function(r){r[r.LNGLAT=1]="LNGLAT",r[r.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",r[r.VECTOR_TILE=3]="VECTOR_TILE",r[r.IDENTITY=4]="IDENTITY",r[r.P20=5]="P20",r[r.P20_OFFSET=6]="P20_OFFSET",r[r.METER_OFFSET=7]="METER_OFFSET",r[r.P20_2=8]="P20_2"})(We||(We={}));var Pt={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},ou,uu,su,Si,lu,yv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],_v=(ou=(0,j.b2)(),uu=(0,j.f3)(w.ICameraService),ou(su=(Si=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"needRefresh",!0),(0,J.Z)(this,"cameraService",lu,this),(0,d.Z)(this,"coordinateSystem",void 0),(0,d.Z)(this,"viewportCenter",void 0),(0,d.Z)(this,"viewportCenterProjection",void 0),(0,d.Z)(this,"pixelsPerDegree",void 0),(0,d.Z)(this,"pixelsPerDegree2",void 0),(0,d.Z)(this,"pixelsPerMeter",void 0)}return(0,T.Z)(r,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),e=this.cameraService.getZoomScale(),i=t||this.cameraService.getCenter(),o=au({latitude:i[1],zoom:n}),u=o.pixelsPerMeter,s=o.pixelsPerDegree;this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=u,this.pixelsPerDegree=s,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===We.LNGLAT||this.coordinateSystem===We.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===We.LNGLAT_OFFSET?this.calculateLnglatOffset(i,n):this.coordinateSystem===We.P20_OFFSET&&this.calculateLnglatOffset(i,n,e,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,e,i){var o=au({latitude:t[1],zoom:n,scale:e,flipY:i,highPrecision:!0}),u=o.pixelsPerMeter,s=o.pixelsPerDegree,l=o.pixelsPerDegree2,c=this.cameraService.getViewMatrix(),f=this.cameraService.getProjectionMatrix(),p=ee.multiply([],f,c),h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=lr.fF([],[h[0],h[1],0,1],p),c=this.cameraService.getViewMatrixUncentered()||c,p=ee.multiply([],f,c),p=ee.multiply([],p,yv),this.cameraService.setViewProjectionMatrix(p),this.pixelsPerMeter=u,this.pixelsPerDegree=s,this.pixelsPerDegree2=l}}]),r}(),lu=(0,q.Z)(Si.prototype,"cameraService",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Si))||su),cu,fu;function Ev(r){var a=xv();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function xv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Cv=(cu=(0,j.b2)(),cu(fu=function(r){(0,F.Z)(t,r);var a=Ev(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"renderMap",new Map),(0,d.Z)((0,E.Z)(n),"enable",!1),(0,d.Z)((0,E.Z)(n),"renderEnable",!1),(0,d.Z)((0,E.Z)(n),"cacheLogs",{}),n}return(0,T.Z)(t,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,i){var o=this;if(!!this.enable){var u=e.split("."),s=null;u.forEach(function(l,c){s!==null?(s[l]||(s[l]={}),c!==u.length-1&&(s=s[l])):(o.cacheLogs[l]||(o.cacheLogs[l]={}),c!==u.length-1&&(s=o.cacheLogs[l])),c===u.length-1&&(s[l]=(0,A.Z)((0,A.Z)({time:Date.now()},s[l]),i))})}}},{key:"getLog",value:function(e){var i=this;switch((0,yn.Z)(e)){case"string":return this.cacheLogs[e];case"object":return e.map(function(o){return i.cacheLogs[o]}).filter(function(o){return o!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Uh():""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(!(!this.renderEnable||!this.enable)){var i=this.renderMap.get(e)||{};this.renderMap.set(e,(0,A.Z)((0,A.Z)({},i),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(!(!this.renderEnable||!this.enable)){var i=this.renderMap.get(e);if(i){var o=i.renderStart,u=Date.now();this.emit("renderEnd",(0,A.Z)((0,A.Z)({},i),{},{renderEnd:u,renderDuration:u-o})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(pe.EventEmitter))||fu),Sv=z(20396),Mn=z.n(Sv),Me;(function(r){r.Hover="hover",r.Click="click",r.Select="select",r.Active="active",r.Drag="drag"})(Me||(Me={}));var pu,hu,du,bi,vu;function bv(r){var a=Av();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Av(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Tv={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Mv=(pu=(0,j.b2)(),hu=(0,j.f3)(w.IMapService),pu(du=(bi=function(r){(0,F.Z)(t,r);var a=bv(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"indragging",!1),(0,J.Z)((0,E.Z)(n),"mapService",vu,(0,E.Z)(n)),(0,d.Z)((0,E.Z)(n),"hammertime",void 0),(0,d.Z)((0,E.Z)(n),"lastClickTime",0),(0,d.Z)((0,E.Z)(n),"lastClickXY",[-1,-1]),(0,d.Z)((0,E.Z)(n),"clickTimer",void 0),(0,d.Z)((0,E.Z)(n),"$containter",void 0),(0,d.Z)((0,E.Z)(n),"onDrag",function(u){var s=n.interactionEvent(u);s.type=Tv[s.type],s.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Me.Drag,s)}),(0,d.Z)((0,E.Z)(n),"onHammer",function(u){u.srcEvent.stopPropagation();var s=n.interactionEvent(u);n.emit(Me.Hover,s)}),(0,d.Z)((0,E.Z)(n),"onTouch",function(u){var s=u.touches[0];n.onHover({x:s.pageX,y:s.pageY,type:"touch"})}),(0,d.Z)((0,E.Z)(n),"onHover",function(u){var s=u.clientX,l=u.clientY,c=s,f=l,p=u.type,h=n.mapService.getMapContainer();if(h)if(Ne)c=c-h.left-0,f=f-h.top-0;else{var g=h.getBoundingClientRect(),v=g.top,_=g.left;c=c-_-h.clientLeft,f=f-v-h.clientTop}var x=n.mapService.containerToLngLat([c,f]);if(p==="click"){if(!Ne&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(c,f,x);return}if(p==="touch"){n.isDoubleTap(c,f,x);return}p!=="click"&&p!=="dblclick"&&n.emit(Me.Hover,{x:c,y:f,lngLat:x,type:p,target:u})}),n}return(0,T.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Me.Hover)}},{key:"triggerHover",value:function(e){var i=e.x,o=e.y;this.emit(Me.Hover,{x:i,y:o})}},{key:"triggerSelect",value:function(e){this.emit(Me.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(Me.Active,{featureId:e})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e)if(Ne)se.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=new(Mn()).Manager(e);i.add(new(Mn()).Tap({event:"dblclick",taps:2})),i.add(new(Mn()).Tap({event:"click"})),i.add(new(Mn()).Pan({threshold:0,pointers:0})),i.add(new(Mn()).Press({})),i.on("dblclick click",this.onHammer),i.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=i}}},{key:"removeEventListenerOnMap",value:function(){if(Ne)se.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(e){var i=e.type,o=e.pointerType,u,s;o==="touch"?(s=Math.floor(e.pointers[0].clientY),u=Math.floor(e.pointers[0].clientX)):(s=Math.floor(e.srcEvent.y),u=Math.floor(e.srcEvent.x));var l=this.mapService.getMapContainer();if(l){var c=l.getBoundingClientRect(),f=c.top,p=c.left;u-=p,s-=f}var h=this.mapService.containerToLngLat([u,s]);return{x:u,y:s,lngLat:h,type:i,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,i,o){var u=this,s=new Date().getTime(),l="click";s-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-i)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),l="dblclick",this.emit(Me.Hover,{x:e,y:i,lngLat:o,type:l})):(this.lastClickTime=s,this.lastClickXY=[e,i],this.clickTimer=setTimeout(function(){l="click",u.emit(Me.Hover,{x:e,y:i,lngLat:o,type:l})},400))}}]),t}(Qe()),vu=(0,q.Z)(bi.prototype,"mapService",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bi))||du),Lv=0;function Rv(r){if(Ne)return null;var a=r;if(typeof r=="string"&&(a=document.getElementById(r)),a){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Lv++),t.classList.add("l7-scene"),a.appendChild(t),t}return null}function kv(r){var a,t=!0;if((r==null||(a=r.target)===null||a===void 0?void 0:a.target)instanceof HTMLElement)for(var n,e=r==null||(n=r.target)===null||n===void 0?void 0:n.target;e;){var i,o=Array.from(e.classList);if(o.includes("l7-marker")||o.includes("l7-popup")){t=!1;break}e=(i=e)===null||i===void 0?void 0:i.parentElement}return t}var m;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.MAX_EXT=32776]="MAX_EXT",r[r.MIN_EXT=32775]="MIN_EXT",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.CULL_FACE=2884]="CULL_FACE",r[r.BLEND=3042]="BLEND",r[r.DITHER=3024]="DITHER",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.TEXTURE1=33985]="TEXTURE1",r[r.TEXTURE2=33986]="TEXTURE2",r[r.TEXTURE3=33987]="TEXTURE3",r[r.TEXTURE4=33988]="TEXTURE4",r[r.TEXTURE5=33989]="TEXTURE5",r[r.TEXTURE6=33990]="TEXTURE6",r[r.TEXTURE7=33991]="TEXTURE7",r[r.TEXTURE8=33992]="TEXTURE8",r[r.TEXTURE9=33993]="TEXTURE9",r[r.TEXTURE10=33994]="TEXTURE10",r[r.TEXTURE11=33995]="TEXTURE11",r[r.TEXTURE12=33996]="TEXTURE12",r[r.TEXTURE13=33997]="TEXTURE13",r[r.TEXTURE14=33998]="TEXTURE14",r[r.TEXTURE15=33999]="TEXTURE15",r[r.TEXTURE16=34e3]="TEXTURE16",r[r.TEXTURE17=34001]="TEXTURE17",r[r.TEXTURE18=34002]="TEXTURE18",r[r.TEXTURE19=34003]="TEXTURE19",r[r.TEXTURE20=34004]="TEXTURE20",r[r.TEXTURE21=34005]="TEXTURE21",r[r.TEXTURE22=34006]="TEXTURE22",r[r.TEXTURE23=34007]="TEXTURE23",r[r.TEXTURE24=34008]="TEXTURE24",r[r.TEXTURE25=34009]="TEXTURE25",r[r.TEXTURE26=34010]="TEXTURE26",r[r.TEXTURE27=34011]="TEXTURE27",r[r.TEXTURE28=34012]="TEXTURE28",r[r.TEXTURE29=34013]="TEXTURE29",r[r.TEXTURE30=34014]="TEXTURE30",r[r.TEXTURE31=34015]="TEXTURE31",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(m||(m={}));var gu,mu,yu,_u,Eu,xu,Cu,Bt,Su,bu,Au,Tu,Mu,Fv=(gu=(0,j.b2)(),mu=(0,j.f3)(w.IMapService),yu=(0,j.f3)(w.IRendererService),_u=(0,j.f3)(w.IGlobalConfigService),Eu=(0,j.f3)(w.IInteractionService),xu=(0,j.f3)(w.ILayerService),gu(Cu=(Bt=function(){function r(){var a=this;(0,R.Z)(this,r),(0,d.Z)(this,"pickedColors",void 0),(0,d.Z)(this,"pickedTileLayers",[]),(0,J.Z)(this,"mapService",Su,this),(0,J.Z)(this,"rendererService",bu,this),(0,J.Z)(this,"configService",Au,this),(0,J.Z)(this,"interactionService",Tu,this),(0,J.Z)(this,"layerService",Mu,this),(0,d.Z)(this,"pickingFBO",void 0),(0,d.Z)(this,"width",0),(0,d.Z)(this,"height",0),(0,d.Z)(this,"alreadyInPicking",!1),(0,d.Z)(this,"pickBufferScale",1),(0,d.Z)(this,"pickFromPickingFBO",function(t,n){var e=n.x,i=n.y,o=n.lngLat,u=n.type,s=n.target,l=!1,c=a.rendererService,f=c.readPixels,p=c.getContainer,h=a.getContainerSize(p()),g=h.width,v=h.height;g*=ve,v*=ve;var _=t.getLayerConfig(),x=_.enableHighlight,C=_.enableSelect,S=e*ve,M=i*ve;if(S>g-1*ve||S<0||M>v-1*ve||M<0)return!1;var L=f({x:Math.floor(S/a.pickBufferScale),y:Math.floor((v-(i+1)*ve)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=L,L[0]!==0||L[1]!==0||L[2]!==0){var D=wt(L),B=t.layerPickService.getFeatureById(D);D!==t.getCurrentPickId()&&u==="mousemove"&&(u="mouseenter");var I={x:e,y:i,type:u,lngLat:o,featureId:D,feature:B,target:s};B&&(l=!0,t.setCurrentPickId(D),a.triggerHoverOnLayer(t,I))}else{var P={x:e,y:i,lngLat:o,type:t.getCurrentPickId()!==null&&u==="mousemove"?"mouseout":"un"+u,featureId:null,target:s,feature:null};a.triggerHoverOnLayer(t,(0,A.Z)((0,A.Z)({},P),{},{type:"unpick"})),a.triggerHoverOnLayer(t,P),t.setCurrentPickId(null)}if(x&&t.layerPickService.highlightPickedFeature(L),C&&u==="click"&&(L==null?void 0:L.toString())!==[0,0,0,0].toString()){var U=wt(L);t.getCurrentSelectedId()===null||U!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(L),t.setCurrentSelectedId(U)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return l})}return(0,T.Z)(r,[{key:"init",value:function(t){var n=this.rendererService,e=n.createTexture2D,i=n.createFramebuffer,o=n.getContainer,u=this.getContainerSize(o()),s=u.width,l=u.height;s*=ve,l*=ve,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=i({color:e({width:Math.round(s/this.pickBufferScale),height:Math.round(l/this.pickBufferScale),wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.interactionService.on(Me.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,k.Z)(y().mark(function n(e,i,o){var u=this,s,l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:s=this.rendererService,l=s.useFramebuffer,c=s.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){c({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels({ispick:!0}),e.hooks.afterPickingEncode.call();var h=u.pickBox(e,i);o(h)});case 3:case"end":return p.stop()}},n,this)}));function t(n,e,i){return a.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var e=this,i=n.map(function(U){var V=U<0?0:U;return Math.floor(V*ve/e.pickBufferScale)}),o=(0,W.Z)(i,4),u=o[0],s=o[1],l=o[2],c=o[3],f=this.rendererService,p=f.readPixels,h=f.getContainer,g=this.getContainerSize(h()),v=g.width,_=g.height;if(v*=ve,_*=ve,u>(v-1)*ve/this.pickBufferScale||l<0||s>(_-1)*ve/this.pickBufferScale||c<0)return[];for(var x=Math.min(v/this.pickBufferScale,l)-u,C=Math.min(_/this.pickBufferScale,c)-s,S=p({x:u,y:Math.floor(_/this.pickBufferScale-(c+1)),width:x,height:C,data:new Uint8Array(x*C*4),framebuffer:this.pickingFBO}),M=[],L={},D=0;D<S.length/4;D=D+1){var B=S.slice(D*4,D*4+4),I=wt(B);if(I!==-1&&!L[I]){var P=t.layerPickService.getFeatureById(I);M.push((0,A.Z)((0,A.Z)({},P),{},{pickedFeatureIdx:I})),L[I]=!0}}return M}},{key:"handleCursor",value:function(t,n){var e=t.getLayerConfig(),i=e.cursor,o=i===void 0?"":i,u=e.cursorEnabled;if(u){var s=this.mapService.version,l=s==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),c=l==null?void 0:l.style.getPropertyValue("cursor");n==="unmousemove"&&c!==""?l==null||l.style.setProperty("cursor",""):n==="mousemove"&&(l==null||l.style.setProperty("cursor",o))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/ve,height:t.height/ve}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,k.Z)(y().mark(function n(e){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!this.layerService.needPick(e.type)||!this.isPickingAllLayer())){o.next=2;break}return o.abrupt("return");case 2:return this.alreadyInPicking=!0,o.next=5,this.pickingLayers(e);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return o.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),e=n.width,i=n.height;e*=ve,i*=ve,(this.width!==e||this.height!==i)&&(this.pickingFBO.resize({width:Math.round(e/this.pickBufferScale),height:Math.round(i/this.pickBufferScale)}),this.width=e,this.height=i)}},{key:"pickingLayers",value:function(){var a=(0,k.Z)(y().mark(function n(e){var i=this,o,u,s;return y().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=this.rendererService,u=o.useFramebuffer,s=o.clear,this.resizePickingFBO(),u(this.pickingFBO,function(){var f=i.layerService.getRenderList();f.filter(function(p){return p.needPick(e.type)}).reverse().some(function(p){s({framebuffer:i.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),p.layerPickService.pickRender(e);var h=i.pickFromPickingFBO(p,e);return i.layerService.pickedLayerId=h?+p.id:-1,h&&!p.getLayerConfig().enablePropagation})});case 3:case"end":return c.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){kv(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),r}(),Su=(0,q.Z)(Bt.prototype,"mapService",[mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bu=(0,q.Z)(Bt.prototype,"rendererService",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=(0,q.Z)(Bt.prototype,"configService",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tu=(0,q.Z)(Bt.prototype,"interactionService",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu=(0,q.Z)(Bt.prototype,"layerService",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bt))||Cu),wv=function(){function r(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,R.Z)(this,r),(0,d.Z)(this,"autoStart",void 0),(0,d.Z)(this,"startTime",0),(0,d.Z)(this,"oldTime",0),(0,d.Z)(this,"running",!1),(0,d.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,T.Z)(r,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),r}(),Lu,Ru,ku,Fu,wu,Ln,Ou,Du,Iu;function Ai(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=Ov(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function Ov(r,a){if(!!r){if(typeof r=="string")return Pu(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Pu(r,a)}}function Pu(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function Dv(r){var a=Iv();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Iv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Pv=(Lu=(0,j.b2)(),Ru=(0,j.f3)(w.IRendererService),ku=(0,j.f3)(w.IMapService),Fu=(0,j.f3)(w.IDebugService),Lu(wu=(Ln=function(r){(0,F.Z)(t,r);var a=Dv(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"pickedLayerId",-1),(0,d.Z)((0,E.Z)(n),"clock",new wv),(0,d.Z)((0,E.Z)(n),"alreadyInRendering",!1),(0,d.Z)((0,E.Z)(n),"layers",[]),(0,d.Z)((0,E.Z)(n),"layerList",[]),(0,d.Z)((0,E.Z)(n),"layerRenderID",void 0),(0,d.Z)((0,E.Z)(n),"sceneInited",!1),(0,d.Z)((0,E.Z)(n),"animateInstanceCount",0),(0,d.Z)((0,E.Z)(n),"shaderPicking",!0),(0,d.Z)((0,E.Z)(n),"enableRender",!0),(0,J.Z)((0,E.Z)(n),"renderService",Ou,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"mapService",Du,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"debugService",Iu,(0,E.Z)(n)),(0,d.Z)((0,E.Z)(n),"reRender",(0,N.throttle)(function(){n.renderLayers()},32)),(0,d.Z)((0,E.Z)(n),"throttleRenderLayers",(0,N.throttle)(function(){n.renderLayers()},16)),n}return(0,T.Z)(t,[{key:"needPick",value:function(e){return this.layerList.some(function(i){return i.needPick(e)})}},{key:"add",value:function(e){var i=this;this.layers.push(e),this.sceneInited&&e.init().then(function(){i.renderLayers()})}},{key:"addMask",value:function(e){var i=this;this.sceneInited&&e.init().then(function(){i.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,k.Z)(y().mark(function i(){var o=this;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var l=(0,k.Z)(y().mark(function c(f){return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(f.startInit){h.next=4;break}return h.next=3,f.init();case 3:o.updateLayerRenderList();case 4:case"end":return h.stop()}},c)}));return function(c){return l.apply(this,arguments)}}());case 2:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find(function(i){return i.id===e})}},{key:"getLayerByName",value:function(e){return this.layers.find(function(i){return i.name===e})}},{key:"remove",value:function(){var n=(0,k.Z)(y().mark(function i(o,u){var s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:u?(s=u.layerChildren.indexOf(o),s>-1&&u.layerChildren.splice(s,1)):(l=this.layers.indexOf(o),l>-1&&this.layers.splice(l,1)),o.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return f.stop()}},i,this)}));function e(i,o){return n.apply(this,arguments)}return e}()},{key:"removeAllLayers",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this.destroy(),this.reRender();case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f;return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){h.next=2;break}return h.abrupt("return");case 2:this.updateLayerRenderList(),o=this.debugService.generateRenderUid(),this.debugService.renderStart(o),this.alreadyInRendering=!0,this.clear(),u=Ai(this.layerList),h.prev=8,u.s();case 10:if((s=u.n()).done){h.next=23;break}if(l=s.value,c=l.getLayerConfig(),f=c.enableMask,l.masks.filter(function(g){return g.inited}).length>0&&f&&this.renderMask(l.masks),!l.getLayerConfig().enableMultiPassRenderer){h.next=19;break}return h.next=17,l.renderMultiPass();case 17:h.next=21;break;case 19:return h.next=21,l.render();case 21:h.next=10;break;case 23:h.next=28;break;case 25:h.prev=25,h.t0=h.catch(8),u.e(h.t0);case 28:return h.prev=28,u.f(),h.finish(28);case 31:this.debugService.renderEnd(o),this.alreadyInRendering=!1;case 33:case"end":return h.stop()}},i,this,[[8,25,28,31]])}));function e(){return n.apply(this,arguments)}return e}()},{key:"renderMask",value:function(e){var i=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var o=e.length>1?ft.MULTIPLE:ft.SINGLE,u=Ai(e),s;try{for(u.s();!(s=u.n()).done;){var l=s.value;l.render({isStencil:!0,stencilType:o,stencilIndex:i++})}}catch(c){u.e(c)}finally{u.f()}}},{key:"beforeRenderData",value:function(){var n=(0,k.Z)(y().mark(function i(o){var u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,o.hooks.beforeRenderData.promise();case 2:u=l.sent,u&&this.renderLayers();case 4:case"end":return l.stop()}},i,this)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"renderTileLayerMask",value:function(e){var i=0,o=e.getLayerConfig(),u=o.enableMask,s=u===void 0?!0:u,l=e.tileMask?1:0,c=e.masks.filter(function(v){return v.inited});l=l+(s?c.length:1);var f=l>1?ft.MULTIPLE:ft.SINGLE;if((e.tileMask||c.length&&s)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),c.length&&s){var p=Ai(c),h;try{for(p.s();!(h=p.n()).done;){var g=h.value;g.render({isStencil:!0,stencilType:f,stencilIndex:i++})}}catch(v){p.e(v)}finally{p.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:f,stencilIndex:i++,stencilOperation:Qt.OR})}},{key:"renderTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(o){return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(this.renderTileLayerMask(o),!o.getLayerConfig().enableMultiPassRenderer){s.next=6;break}return s.next=4,o.renderMultiPass();case 4:s.next=8;break;case 6:return s.next=8,o.render();case 8:case"end":return s.stop()}},i,this)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).sort(function(i,o){return i.zIndex-o.zIndex}).forEach(function(i){e.layerList.push(i)})}},{key:"destroy",value:function(){this.layers.forEach(function(e){e.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=ue(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=se.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){se.cancelAnimationFrame(this.layerRenderID)}}]),t}(pe.EventEmitter),Ou=(0,q.Z)(Ln.prototype,"renderService",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du=(0,q.Z)(Ln.prototype,"mapService",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iu=(0,q.Z)(Ln.prototype,"debugService",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ln))||wu),Re=z(81253),Bv=function(){function r(a){var t=this;(0,R.Z)(this,r),(0,d.Z)(this,"name",void 0),(0,d.Z)(this,"type",void 0),(0,d.Z)(this,"scale",void 0),(0,d.Z)(this,"descriptor",void 0),(0,d.Z)(this,"featureBufferLayout",[]),(0,d.Z)(this,"needRescale",!1),(0,d.Z)(this,"needRemapping",!1),(0,d.Z)(this,"needRegenerateVertices",!1),(0,d.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,d.Z)(this,"vertexAttribute",void 0),(0,d.Z)(this,"defaultCallback",function(n){if(n.length===0){var e;return((e=t.scale)===null||e===void 0?void 0:e.defaultValues)||[]}return n.map(function(i,o){var u,s=(u=t.scale)===null||u===void 0?void 0:u.scalers[o].func,l=s(i);return l})}),this.setProps(a)}return(0,T.Z)(r,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var e,i=(e=this.scale)===null||e===void 0?void 0:e.callback.apply(e,(0,G.Z)(t));if(!(0,N.isNil)(i))return[i]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),r}(),Nv=["modelType"],Zv=["buffer","update","name"],zv=["buffer","update","name"],Uv=["buffer","update","name"],Rn,Bu,Nu,Zu,Ti,zu,Hv=(Rn={},(0,d.Z)(Rn,m.FLOAT,4),(0,d.Z)(Rn,m.UNSIGNED_BYTE,1),(0,d.Z)(Rn,m.UNSIGNED_SHORT,2),Rn),jv=(Bu=(0,j.b2)(),Nu=(0,j.f3)(w.IRendererService),Bu(Zu=(Ti=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"attributesAndIndices",void 0),(0,J.Z)(this,"rendererService",zu,this),(0,d.Z)(this,"attributes",[]),(0,d.Z)(this,"triangulation",void 0),(0,d.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,T.Z)(r,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Bv(t),this.attributes.push(n)),n}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var e,i=n.name,o=(e=n.scale)===null||e===void 0?void 0:e.field;(t[i]||o&&t[o])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,e){var i=this.getLayerStyleAttribute(t);i||(i=this.registerStyleAttribute((0,A.Z)((0,A.Z)({},n),{},{name:t})));var o=n.scale;o&&i&&(i.scale=o,i.needRescale=!0,i.needRemapping=!0,i.needRegenerateVertices=!0,e&&e.featureRange&&(i.featureRange=e.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,e=this.getLayerStyleAttribute(t),i=e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers;return i&&i[0]?i[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,u=this.attributes.find(function(L){return L.name===t});if(u&&u.descriptor){var s=u.descriptor,l=s.update,c=s.buffer,f=s.size,p=f===void 0?0:f,h=Hv[c.type||m.FLOAT];if(l){var g=this.featureLayout,v=g.elements,_=g.sizePerElement,x=v.slice(e,i);if(!x.length)return;var C=x[0].offset,S=C*p*h,M=x.map(function(L,D){for(var B=L.featureIdx,I=L.vertices,P=L.normals,U=I.length/_,V=[],K=0;K<U;K++){var Q=P?P.slice(K*3,K*3+3):[];V.push.apply(V,(0,G.Z)(l(n[B],B,I.slice(K*_,K*_+_),D,Q)))}return V}).reduce(function(L,D){return L.push.apply(L,(0,G.Z)(D)),L},[]);u.vertexAttribute.updateBuffer({data:M,offset:S}),o==null||o.emit("legend:".concat(t),{type:t,attr:u})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,e){var i=this;this.featureLayout={sizePerElement:0,elements:[]};var o=this.attributes.map(function(g){return g.resetDescriptor(),g.descriptor}).filter(function(g){return g}),u=e.modelType,s=(0,Re.Z)(e,Nv),l=this.rendererService,c=l.createAttribute,f=l.createBuffer,p=l.createElements,h={};return new Promise(function(g,v){Id(u,(0,A.Z)({descriptors:i.getDescriptorsWithOutFunc(o),features:t,segmentNumber:n},s)).then(function(_){_.descriptors.forEach(function(C,S){if(C){var M=C.buffer,L=C.update,D=C.name,B=(0,Re.Z)(C,Zv),I=c((0,A.Z)({buffer:f(M)},B));h[C.name||""]=I,i.attributes[S].vertexAttribute=I}}),i.featureLayout=_.featureLayout;var x=p({data:_.indices,type:m.UNSIGNED_INT,count:_.indices.length});i.attributesAndIndices={attributes:h,elements:x,count:null},g(i.attributesAndIndices)}).catch(function(_){console.warn(_),v(_)})})}},{key:"createAttributesAndIndices",value:function(t,n,e){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(S){return S.resetDescriptor(),S.descriptor}),u=0,s=0,l=[],c=[],f=[],p=3;t.forEach(function(S,M){var L=i.triangulation(S,e),D=L.indices,B=L.vertices,I=L.normals,P=L.size,U=L.indexes,V=L.count;typeof V=="number"&&(s+=V),D.forEach(function(ce){c.push(ce+u)}),p=P;var K=B.length/P;i.featureLayout.sizePerElement=p,i.featureLayout.elements.push({featureIdx:M,vertices:B,normals:I,offset:u}),u+=K;for(var Q=function(fe){var Ce=(I==null?void 0:I.slice(fe*3,fe*3+3))||[],Se=B.slice(fe*P,fe*P+P),nt=0;U&&U[fe]!==void 0&&(nt=U[fe]),o.forEach(function(Ke,Aa){if(Ke&&Ke.update){var Ir;(Ir=Ke.buffer.data).push.apply(Ir,(0,G.Z)(Ke.update(S,M,Se,fe,Ce,nt)))}})},te=0;te<K;te++)Q(te)});var h=this.rendererService,g=h.createAttribute,v=h.createBuffer,_=h.createElements,x={};o.forEach(function(S,M){if(S){var L=S.buffer,D=S.update,B=S.name,I=(0,Re.Z)(S,zv),P=g((0,A.Z)({buffer:v(L)},I));x[S.name||""]=P,i.attributes[M].vertexAttribute=P}});var C=_({data:c,type:m.UNSIGNED_INT,count:c.length});return this.attributesAndIndices={attributes:x,elements:C,count:s},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var e=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var i=this.attributes.map(function(h){return h.resetDescriptor(),h.descriptor}),o=0,u=[],s=3;t.forEach(function(h,g){var v=e.triangulation(h),_=v.indices,x=v.vertices,C=v.normals,S=v.size,M=v.indexes;_.forEach(function(I){u.push(I+o)}),s=S;var L=x.length/S;e.featureLayout.sizePerElement=s,e.featureLayout.elements.push({featureIdx:g,vertices:x,normals:C,offset:o}),o+=L;for(var D=function(P){var U=(C==null?void 0:C.slice(P*3,P*3+3))||[],V=x.slice(P*S,P*S+S),K=0;M&&M[P]!==void 0&&(K=M[P]),i.forEach(function(Q,te){if(Q&&Q.update){var ce;(ce=Q.buffer.data).push.apply(ce,(0,G.Z)(Q.update(h,g,V,P,U,K)))}})},B=0;B<L;B++)D(B)});var l=this.rendererService,c=l.createAttribute,f=l.createBuffer,p={};return i.forEach(function(h,g){if(h){var v=h.buffer,_=h.update,x=h.name,C=(0,Re.Z)(h,Uv),S=c((0,A.Z)({buffer:f(v)},C));p[h.name||""]=S,e.attributes[g].vertexAttribute=S}}),{attributes:p}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),r}(),zu=(0,q.Z)(Ti.prototype,"rendererService",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti))||Zu),ke=z(46343),Uu=z(67709),Vv=z.n(Uu),Hu,ju,Vu,Gu,Wu,$u,Xu,Yu,Ku,Qu,qu,Ju,es,ts,ns,rs,is,as,Ae,os,us,ss,ls,cs,fs,ps,hs,ds,vs,gs,ms,ys,_s,Es,xs;function Gv(r){var a=Wv();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Wv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var $v=(Hu=(0,j.b2)(),ju=(0,j.f3)(w.SceneID),Vu=(0,j.f3)(w.IIconService),Gu=(0,j.f3)(w.IFontService),Wu=(0,j.f3)(w.IControlService),$u=(0,j.f3)(w.IGlobalConfigService),Xu=(0,j.f3)(w.IMapService),Yu=(0,j.f3)(w.ICoordinateSystemService),Ku=(0,j.f3)(w.IRendererService),Qu=(0,j.f3)(w.ILayerService),qu=(0,j.f3)(w.IDebugService),Ju=(0,j.f3)(w.ICameraService),es=(0,j.f3)(w.IInteractionService),ts=(0,j.f3)(w.IPickingService),ns=(0,j.f3)(w.IShaderModuleService),rs=(0,j.f3)(w.IMarkerService),is=(0,j.f3)(w.IPopupService),Hu(as=(Ae=function(r){(0,F.Z)(t,r);var a=Gv(t);function t(){var n;return(0,R.Z)(this,t),n=a.call(this),(0,d.Z)((0,E.Z)(n),"destroyed",!1),(0,d.Z)((0,E.Z)(n),"loaded",!1),(0,J.Z)((0,E.Z)(n),"id",os,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"iconService",us,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"fontService",ss,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"controlService",ls,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"configService",cs,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"map",fs,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"coordinateSystemService",ps,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"rendererService",hs,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"layerService",ds,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"debugService",vs,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"cameraService",gs,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"interactionService",ms,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"pickingService",ys,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"shaderModuleService",_s,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"markerService",Es,(0,E.Z)(n)),(0,J.Z)((0,E.Z)(n),"popupService",xs,(0,E.Z)(n)),(0,d.Z)((0,E.Z)(n),"inited",!1),(0,d.Z)((0,E.Z)(n),"initPromise",void 0),(0,d.Z)((0,E.Z)(n),"rendering",!1),(0,d.Z)((0,E.Z)(n),"$container",void 0),(0,d.Z)((0,E.Z)(n),"canvas",void 0),(0,d.Z)((0,E.Z)(n),"markerContainer",void 0),(0,d.Z)((0,E.Z)(n),"hooks",void 0),(0,d.Z)((0,E.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Ch(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,d.Z)((0,E.Z)(n),"handleMapCameraChanged",function(e){n.cameraService.update(e),n.render()}),n.hooks={init:new ke.sX},n}return(0,T.Z)(t,[{key:"init",value:function(e){var i=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return i.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,k.Z)(y().mark(function o(){return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.debugService.log("map.mapInitStart",{type:i.map.version}),s.next=3,new Promise(function(l){i.map.onCameraChanged(function(c){i.cameraService.init(),i.cameraService.update(c),l()}),i.map.init()});case 3:i.map.onCameraChanged(i.handleMapCameraChanged),i.map.addMarkerContainer(),i.markerService.addMarkers(),i.markerService.addMarkerLayers(),i.popupService.initPopup(),i.interactionService.init(),i.interactionService.on(Me.Drag,i.addSceneEvent.bind(i));case 10:case"end":return s.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",(0,k.Z)(y().mark(function o(){var u,s;return y().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(u=i.map.getOverlayContainer(),u?i.$container=u:i.$container=Rv(i.configService.getSceneConfig(i.id).id||""),!i.$container){c.next=13;break}return i.canvas=re("canvas","",i.$container),i.setCanvas(),c.next=7,i.rendererService.init(i.canvas,i.configService.getSceneConfig(i.id),e.gl);case 7:i.registerContextLost(),i.initContainer(),Vv()(i.$container,i.handleWindowResized),se.matchMedia&&((s=se.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||s===void 0||s.addListener(i.handleWindowResized)),c.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:i.pickingService.init(i.id);case 15:case"end":return c.stop()}},o)}))),this.render()}},{key:"registerContextLost",value:function(){var e=this,i=this.rendererService.getCanvas();i&&i.addEventListener("webglcontextlost",function(){return e.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(e){var i=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return i.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,k.Z)(y().mark(function o(){return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,new Promise(function(l){i.map.onCameraChanged(function(c){i.cameraService.init(),i.cameraService.update(c),i.map.version!=="GAODE2.x"&&l()}),i.map.initMiniMap()});case 2:i.map.onCameraChanged(i.handleMapCameraChanged),i.interactionService.init(),i.interactionService.on(Me.Drag,i.addSceneEvent.bind(i));case 5:case"end":return s.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",(0,k.Z)(y().mark(function o(){var u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(u=e.canvas,i.$container=u||null,!i.$container){l.next=7;break}return l.next=5,i.rendererService.init(e.canvas,i.configService.getSceneConfig(i.id),void 0);case 5:l.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:i.pickingService.init(i.id);case 9:case"end":return l.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.rendering||this.destroyed)){u.next=2;break}return u.abrupt("return");case 2:if(this.rendering=!0,this.inited){u.next=16;break}return u.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),u.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,u.next=20;break;case 16:return u.next=18,this.layerService.initLayers();case 18:return u.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"addFontFace",value:function(e,i){this.fontService.addFontFace(e,i)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,k.Z)(y().mark(function i(o){var u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0],f.next=3,this.render();case 3:return l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png"),f.abrupt("return",l);case 5:case"end":return f.stop()}},i,this)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;e!==null&&(this.markerContainer=re("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e=this,i,o;if(!this.inited){this.destroyed=!0;return}if((0,Uu.unbind)(this.$container,this.handleWindowResized),se.matchMedia){var u;(u=se.matchMedia("screen and (min-resolution: 2dppx)"))===null||u===void 0||u.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var s;(s=e.$container)===null||s===void 0||s.removeChild(e.canvas),e.canvas=null,e.rendererService.destroy()}),(i=this.$container)===null||i===void 0||(o=i.parentNode)===null||o===void 0||o.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var e,i,o=ve,u=((e=this.$container)===null||e===void 0?void 0:e.clientWidth)||400,s=((i=this.$container)===null||i===void 0?void 0:i.clientHeight)||300,l=this.canvas;l&&(l.width=u*o,l.height=s*o),this.rendererService.viewport({x:0,y:0,width:o*u,height:o*s})}},{key:"setCanvas",value:function(){var e,i,o=ve,u=((e=this.$container)===null||e===void 0?void 0:e.clientWidth)||400,s=((i=this.$container)===null||i===void 0?void 0:i.clientHeight)||300,l=this.canvas;l.width=u*o,l.height=s*o,l.style.width="100%",l.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),t}(pe.EventEmitter),os=(0,q.Z)(Ae.prototype,"id",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),us=(0,q.Z)(Ae.prototype,"iconService",[Vu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ss=(0,q.Z)(Ae.prototype,"fontService",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ls=(0,q.Z)(Ae.prototype,"controlService",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs=(0,q.Z)(Ae.prototype,"configService",[$u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs=(0,q.Z)(Ae.prototype,"map",[Xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps=(0,q.Z)(Ae.prototype,"coordinateSystemService",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hs=(0,q.Z)(Ae.prototype,"rendererService",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds=(0,q.Z)(Ae.prototype,"layerService",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vs=(0,q.Z)(Ae.prototype,"debugService",[qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gs=(0,q.Z)(Ae.prototype,"cameraService",[Ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ms=(0,q.Z)(Ae.prototype,"interactionService",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ys=(0,q.Z)(Ae.prototype,"pickingService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_s=(0,q.Z)(Ae.prototype,"shaderModuleService",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Es=(0,q.Z)(Ae.prototype,"markerService",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xs=(0,q.Z)(Ae.prototype,"popupService",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ae))||as);function Xv(r){var a=0;switch(r){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var Yv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Cs(r){var a={};return r=r.replace(Yv,function(t,n,e){var i=e.split(":"),o=i[0].trim(),u="";switch(i.length>1&&(u=i[1].trim()),n){case"bool":u=u==="true";break;case"float":case"int":u=Number(u);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":u?u=u.replace("[","").replace("]","").split(",").reduce(function(s,l){return s.push(Number(l.trim())),s},[]):u=new Array(Xv(n)).fill(0);break;default:}return a[o]=u,"uniform ".concat(n," ").concat(o,`;
`)}),{content:r,uniforms:a}}var Ss,bs,As="#define PI 3.14159265359",Kv=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Qv=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,qv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Jv=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,eg=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,tg=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ng=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,rg=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,ig=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,ag=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,og=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,ug=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,sg=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,lg=/precision\s+(high|low|medium)p\s+float/,cg=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,fg=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,pg=(Ss=(0,j.b2)(),Ss(bs=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"moduleCache",{}),(0,d.Z)(this,"rawContentCache",{})}return(0,T.Z)(r,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:As,fs:As}),this.registerModule("decode",{vs:Kv,fs:""}),this.registerModule("projection",{vs:ng,fs:""}),this.registerModule("project",{vs:tg,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:rg}),this.registerModule("lighting",{vs:qv,fs:""}),this.registerModule("light",{vs:Qv,fs:""}),this.registerModule("picking",{vs:eg,fs:Jv}),this.registerModule("styleMapping",{vs:ig,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:sg,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:ag,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:og,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:ug,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var e=n.vs,i=n.fs,o=n.uniforms,u=Cs(e),s=u.content,l=u.uniforms,c=Cs(i),f=c.content,p=c.uniforms;this.rawContentCache[t]={fs:f,uniforms:(0,A.Z)((0,A.Z)((0,A.Z)({},l),p),o),vs:s}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var e=this.rawContentCache[t].vs,i=this.rawContentCache[t].fs,o=this.processModule(e,[],"vs"),u=o.content,s=o.includeList,l=this.processModule(i,[],"fs"),c=l.content,f=l.includeList,p=c,h=(0,N.uniq)(s.concat(f).concat(t)).reduce(function(g,v){return(0,A.Z)((0,A.Z)({},g),n.rawContentCache[v].uniforms)},{});return lg.test(c)||(p=cg+c),this.moduleCache[t]={fs:p.trim(),uniforms:h,vs:u.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,e){var i=this,o=t.replace(fg,function(u,s){var l=s.split(" "),c=l[0].replace(/"/g,"");if(n.indexOf(c)>-1)return"";var f=i.rawContentCache[c][e];n.push(c);var p=i.processModule(f,n,e),h=p.content;return h});return{content:o,includeList:n}}}]),r}())||bs),oe=z(66213),Ct;(function(r){r.Normal="normal",r.PostProcessing="post-processing"})(Ct||(Ct={}));var Ts,Ms,cr=(Ts=(0,j.b2)(),Ts(Ms=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"shaderModuleService",void 0),(0,d.Z)(this,"rendererService",void 0),(0,d.Z)(this,"cameraService",void 0),(0,d.Z)(this,"mapService",void 0),(0,d.Z)(this,"interactionService",void 0),(0,d.Z)(this,"layerService",void 0),(0,d.Z)(this,"config",void 0)}return(0,T.Z)(r,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Ct.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(w.IRendererService),this.cameraService=t.getContainer().get(w.ICameraService),this.mapService=t.getContainer().get(w.IMapService),this.interactionService=t.getContainer().get(w.IInteractionService),this.layerService=t.getContainer().get(w.ILayerService),this.shaderModuleService=t.getContainer().get(w.IShaderModuleService)}},{key:"render",value:function(t){}}]),r}())||Ms),Ls,Rs;function hg(r){var a=dg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function dg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var vg=(Ls=(0,j.b2)(),Ls(Rs=function(r){(0,F.Z)(t,r);var a=hg(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,i){(0,oe.Z)((0,b.Z)(t.prototype),"init",this).call(this,e,i)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(cr))||Rs),ks,Fs,ws,Mi,Os;function gg(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=mg(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function mg(r,a){if(!!r){if(typeof r=="string")return Ds(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ds(r,a)}}function Ds(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var yg=(ks=(0,j.b2)(),Fs=(0,j.f3)(w.IPostProcessor),ks(ws=(Mi=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"passes",[]),(0,J.Z)(this,"postProcessor",Os,this),(0,d.Z)(this,"layer",void 0),(0,d.Z)(this,"renderFlag",void 0),(0,d.Z)(this,"width",0),(0,d.Z)(this,"height",0)}return(0,T.Z)(r,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,k.Z)(y().mark(function n(){var e,i,o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=gg(this.passes),s.prev=1,e.s();case 3:if((i=e.n()).done){s.next=9;break}return o=i.value,s.next=7,o.render(this.layer);case 7:s.next=3;break;case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(1),e.e(s.t0);case 14:return s.prev=14,e.f(),s.finish(14);case 17:return s.next=19,this.postProcessor.render(this.layer);case 19:case"end":return s.stop()}},n,this,[[1,11,14,17]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===Ct.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,e){t.init(this.layer,n),this.passes.splice(e,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),r}(),Os=(0,q.Z)(Mi.prototype,"postProcessor",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi))||ws),Is,Ps;function _g(r){var a=Eg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Eg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var xg=(Is=(0,j.b2)(),Is(Ps=function(r){(0,F.Z)(t,r);var a=_g(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"pickingFBO",void 0),(0,d.Z)((0,E.Z)(n),"layer",void 0),(0,d.Z)((0,E.Z)(n),"width",0),(0,d.Z)((0,E.Z)(n),"height",0),(0,d.Z)((0,E.Z)(n),"alreadyInRendering",!1),(0,d.Z)((0,E.Z)(n),"pickFromPickingFBO",function(u){var s=u.x,l=u.y,c=u.lngLat,f=u.type;if(!(!n.layer.isVisible()||!n.layer.needPick(f))){var p=n.rendererService,h=p.getViewportSize,g=p.readPixels,v=p.useFramebuffer,_=h(),x=_.width,C=_.height,S=n.layer.getLayerConfig(),M=S.enableHighlight,L=S.enableSelect,D=s*ve,B=l*ve;if(!(D>x||D<0||B>C||B<0)){var I;v(n.pickingFBO,function(){var P;if(I=g({x:Math.round(D),y:Math.round(C-(l+1)*ve),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),I[0]!==0||I[1]!==0||I[2]!==0){var U=wt(I),V=n.layer.getSource().getFeatureById(U),K={x:s,y:l,type:f,lngLat:c,featureId:U,feature:V};V&&(n.layer.setCurrentPickId(U),n.triggerHoverOnLayer(K))}else{var Q={x:s,y:l,lngLat:c,type:n.layer.getCurrentPickId()===null?"un"+f:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,A.Z)((0,A.Z)({},Q),{},{type:"unpick"})),n.triggerHoverOnLayer(Q),n.layer.setCurrentPickId(null)}M&&n.highlightPickedFeature(I),L&&f==="click"&&((P=I)===null||P===void 0?void 0:P.toString())!==[0,0,0,0].toString()&&n.selectFeature(I)})}}}),n}return(0,T.Z)(t,[{key:"getType",value:function(){return Ct.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,i){(0,oe.Z)((0,b.Z)(t.prototype),"init",this).call(this,e,i),this.layer=e;var o=this.rendererService,u=o.createTexture2D,s=o.createFramebuffer,l=o.getViewportSize,c=l(),f=c.width,p=c.height;this.pickingFBO=s({color:u({width:f,height:p,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.interactionService.on(Me.Hover,this.pickFromPickingFBO),this.interactionService.on(Me.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Me.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var i=this;if(!this.alreadyInRendering){var o=this.rendererService,u=o.getViewportSize,s=o.useFramebuffer,l=o.clear,c=u(),f=c.width,p=c.height;this.alreadyInRendering=!0,(this.width!==f||this.height!==p)&&(this.pickingFBO.resize({width:f,height:p}),this.width=f,this.height=p),s(this.pickingFBO,function(){l({framebuffer:i.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var h=i.layer.multiPassRenderer.getRenderFlag();i.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),i.layer.multiPassRenderer.setRenderFlag(h),i.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var i=(0,W.Z)(e,3),o=i[0],u=i[1],s=i[2];this.layer.hooks.beforeHighlight.call([o,u,s]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var i=(0,W.Z)(e,3),o=i[0],u=i[1],s=i[2];this.layer.hooks.beforeSelect.call([o,u,s]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var i=e.featureId,o=st(i);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(e){var i=e.featureId,o=st(i);this.highlightPickedFeature(new Uint8Array(o))}}]),t}(cr))||Ps),Bs,Ns,Zs,Li,zs,Cg=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pt=(Bs=(0,j.b2)(),Ns=(0,j.f3)(w.IShaderModuleService),Bs(Zs=(Li=function(){function r(){(0,R.Z)(this,r),(0,J.Z)(this,"shaderModuleService",zs,this),(0,d.Z)(this,"rendererService",void 0),(0,d.Z)(this,"config",void 0),(0,d.Z)(this,"quad",Cg),(0,d.Z)(this,"enabled",!0),(0,d.Z)(this,"renderToScreen",!1),(0,d.Z)(this,"model",void 0),(0,d.Z)(this,"name",void 0),(0,d.Z)(this,"optionsToUpdate",{})}return(0,T.Z)(r,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Ct.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(w.IRendererService),this.shaderModuleService=t.getContainer().get(w.IShaderModuleService);var e=this.rendererService,i=e.createAttribute,o=e.createBuffer,u=e.createModel,s=this.setupShaders(),l=s.vs,c=s.fs,f=s.uniforms;this.model=u({vs:l,fs:c,attributes:{a_Position:i({buffer:o({data:[-4,-4,4,-4,0,4],type:m.FLOAT}),size:2})},uniforms:(0,A.Z)((0,A.Z)({u_Texture:null},f),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var e=this,i=t.multiPassRenderer.getPostProcessor(),o=this.rendererService,u=o.useFramebuffer,s=o.getViewportSize,l=o.clear,c=s(),f=c.width,p=c.height;u(this.renderToScreen?null:i.getWriteFBO(),function(){l({framebuffer:i.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var h=(0,A.Z)({u_BloomFinal:0,u_Texture:i.getReadFBO(),u_ViewportSize:[f,p]},e.convertOptionsToUniforms(e.optionsToUpdate));n&&(h.u_BloomFinal=1,h.u_Texture2=n),e.model.draw({uniforms:h})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,A.Z)((0,A.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(e){(0,N.isNil)(t[e])||(n["u_".concat((0,N.upperFirst)((0,N.camelCase)(e)))]=t[e])}),n}}]),r}(),zs=(0,q.Z)(Li.prototype,"shaderModuleService",[Ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li))||Zs),Us,Hs;function Sg(r){var a=bg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function bg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ag=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Tg=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Mg=(Us=(0,j.b2)(),Us(Hs=function(r){(0,F.Z)(t,r);var a=Sg(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Tg,fs:Ag});var e=this.shaderModuleService.getModule("blur-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,A.Z)((0,A.Z)({},u),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(e){var i={};return(0,N.isNil)(e.bloomRadius)||(i.u_radius=e.bloomRadius),(0,N.isNil)(e.bloomIntensity)||(i.u_intensity=e.bloomIntensity),(0,N.isNil)(e.bloomBaseRadio)||(i.u_baseRadio=e.bloomBaseRadio),i}}]),t}(pt))||Hs),js,Vs;function Lg(r){var a=Rg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Rg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var kg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Fg=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wg=(js=(0,j.b2)(),js(Vs=function(r){(0,F.Z)(t,r);var a=Lg(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Fg,fs:kg});var e=this.shaderModuleService.getModule("blur-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,A.Z)((0,A.Z)({},u),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(e){var i={};return(0,N.isNil)(e.blurRadius)||(i.u_BlurDir=[e.blurRadius,0]),i}}]),t}(pt))||Vs),Gs,Ws;function Og(r){var a=Dg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Dg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ig=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Pg=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bg=(Gs=(0,j.b2)(),Gs(Ws=function(r){(0,F.Z)(t,r);var a=Og(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Pg,fs:Ig});var e=this.shaderModuleService.getModule("blur-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,A.Z)((0,A.Z)({},u),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(e){var i={};return(0,N.isNil)(e.blurRadius)||(i.u_BlurDir=[0,e.blurRadius]),i}}]),t}(pt))||Ws),$s,Xs;function Ng(r){var a=Zg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Zg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var zg=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ug=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hg=($s=(0,j.b2)(),$s(Xs=function(r){(0,F.Z)(t,r);var a=Ng(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ug,fs:zg});var e=this.shaderModuleService.getModule("colorhalftone-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,A.Z)((0,A.Z)({},u),{},{u_ViewportSize:[l,c]})}}}]),t}(pt))||Xs),Ys,Ks;function jg(r){var a=Vg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Vg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Gg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Wg=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$g=(Ys=(0,j.b2)(),Ys(Ks=function(r){(0,F.Z)(t,r);var a=jg(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Wg,fs:Gg}),this.shaderModuleService.getModule("copy-pass")}}]),t}(pt))||Ks),Qs,qs;function Xg(r){var a=Yg();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Yg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Kg=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Qg=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qg=(Qs=(0,j.b2)(),Qs(qs=function(r){(0,F.Z)(t,r);var a=Xg(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Qg,fs:Kg});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,A.Z)((0,A.Z)({},u),{},{u_ViewportSize:[l,c]})}}}]),t}(pt))||qs),Js,el;function Jg(r){var a=em();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function em(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var tm=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,nm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,rm=(Js=(0,j.b2)(),Js(el=function(r){(0,F.Z)(t,r);var a=Jg(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:nm,fs:tm});var e=this.shaderModuleService.getModule("ink-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,A.Z)((0,A.Z)({},u),{},{u_ViewportSize:[l,c]})}}}]),t}(pt))||el),tl,nl;function im(r){var a=am();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function am(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var om=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,um=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sm=(tl=(0,j.b2)(),tl(nl=function(r){(0,F.Z)(t,r);var a=im(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:um,fs:om}),this.shaderModuleService.getModule("noise-pass")}}]),t}(pt))||nl),rl,il;function lm(r){var a=cm();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function cm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var fm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,hm=(rl=(0,j.b2)(),rl(il=function(r){(0,F.Z)(t,r);var a=lm(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:fm,fs:pm}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(pt))||il),al,ol,ul,sl,qt,ll,dm=(al=(0,j.b2)(),ol=(0,j.f3)(w.IRendererService),ul=(0,j.zY)(),al(sl=(qt=function(){function r(){(0,R.Z)(this,r),(0,J.Z)(this,"rendererService",ll,this),(0,d.Z)(this,"passes",[]),(0,d.Z)(this,"readFBO",void 0),(0,d.Z)(this,"writeFBO",void 0)}return(0,T.Z)(r,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,e=t.createTexture2D,i=n(),o=i.width,u=i.height;return e({x:0,y:0,width:o,height:u,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(e){n(t.readFBO,(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e(t.getCurrentFBOTex());case 1:case"end":return u.stop()}},i)})))})}},{key:"renderBloomPass",value:function(){var a=(0,k.Z)(y().mark(function n(e,i){var o,u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.getReadFBOTex();case 2:o=l.sent,u=0;case 4:if(!(u<4)){l.next=11;break}return l.next=7,i.render(e,o);case 7:this.swap(),u++,l.next=4;break;case 11:case"end":return l.stop()}},n,this)}));function t(n,e){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){var a=(0,k.Z)(y().mark(function n(e){var i,o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i=0;case 1:if(!(i<this.passes.length)){s.next=15;break}if(o=this.passes[i],o.setRenderToScreen(this.isLastEnabledPass(i)),o.getName()!=="bloom"){s.next=9;break}return s.next=7,this.renderBloomPass(e,o);case 7:s.next=12;break;case 9:return s.next=11,o.render(e);case 11:i!==this.passes.length-1&&this.swap();case 12:i++,s.next=1;break;case 15:case"end":return s.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,e){t.init(n,e),this.passes.push(t)}},{key:"insert",value:function(t,n,e,i){t.init(e,i),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,e=t.createTexture2D;this.readFBO=n({color:e({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.writeFBO=n({color:e({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),r}(),ll=(0,q.Z)(qt.prototype,"rendererService",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,q.Z)(qt.prototype,"init",[ul],Object.getOwnPropertyDescriptor(qt.prototype,"init"),qt.prototype),qt))||sl),cl,fl;function vm(r){var a=gm();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function gm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var mm=(cl=(0,j.b2)(),cl(fl=function(r){(0,F.Z)(t,r);var a=vm(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getType",value:function(){return Ct.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,i){(0,oe.Z)((0,b.Z)(t.prototype),"init",this).call(this,e,i)}},{key:"render",value:function(e){var i=this.rendererService,o=i.useFramebuffer,u=i.clear,s=e.multiPassRenderer.getPostProcessor().getReadFBO();o(s,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach(function(l){l.draw({uniforms:e.layerModel.getUninforms()})}),e.multiPassRenderer.setRenderFlag(!0)})}}]),t}(cr))||fl),pl,hl,dl,Ri,vl;function ym(r){var a=_m();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function _m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Em=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,gl=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,xm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function ml(r,a){for(var t=0,n=1/a,e=r;e>0;)t=t+n*(e%a),e=Math.floor(e/a),n=n/a;return t}var Cm=1,Sm=(pl=(0,j.b2)(),hl=(0,j.f3)(w.IShaderModuleService),pl(dl=(Ri=function(r){(0,F.Z)(t,r);var a=ym(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,J.Z)((0,E.Z)(n),"shaderModuleService",vl,(0,E.Z)(n)),(0,d.Z)((0,E.Z)(n),"haltonSequence",[]),(0,d.Z)((0,E.Z)(n),"accumulatingId",0),(0,d.Z)((0,E.Z)(n),"frame",0),(0,d.Z)((0,E.Z)(n),"timer",void 0),(0,d.Z)((0,E.Z)(n),"sampleRenderTarget",void 0),(0,d.Z)((0,E.Z)(n),"prevRenderTarget",void 0),(0,d.Z)((0,E.Z)(n),"outputRenderTarget",void 0),(0,d.Z)((0,E.Z)(n),"copyRenderTarget",void 0),(0,d.Z)((0,E.Z)(n),"blendModel",void 0),(0,d.Z)((0,E.Z)(n),"outputModel",void 0),(0,d.Z)((0,E.Z)(n),"copyModel",void 0),n}return(0,T.Z)(t,[{key:"getType",value:function(){return Ct.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,i){(0,oe.Z)((0,b.Z)(t.prototype),"init",this).call(this,e,i);var o=this.rendererService,u=o.createFramebuffer,s=o.createTexture2D;this.sampleRenderTarget=u({color:s({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.prevRenderTarget=u({color:s({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.outputRenderTarget=u({color:s({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.copyRenderTarget=u({color:s({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})});for(var l=0;l<30;l++)this.haltonSequence.push([ml(l,2),ml(l,3)]);this.blendModel=this.createTriangleModel("blend-pass",Em),this.outputModel=this.createTriangleModel("copy-pass",gl,{blend:{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE_MINUS_SRC_ALPHA,srcAlpha:m.ONE,dstAlpha:m.ONE_MINUS_SRC_ALPHA},equation:{rgb:m.FUNC_ADD,alpha:m.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",gl)}},{key:"render",value:function(e){var i=this,o=this.rendererService,u=o.clear,s=o.getViewportSize,l=o.useFramebuffer,c=s(),f=c.width,p=c.height;this.sampleRenderTarget.resize({width:f,height:p}),this.prevRenderTarget.resize({width:f,height:p}),this.outputRenderTarget.resize({width:f,height:p}),this.copyRenderTarget.resize({width:f,height:p}),this.resetFrame(),this.stopAccumulating();var h=e.multiPassRenderer.getPostProcessor().getReadFBO();l(h,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:h}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)});var g=function v(_){!i.accumulatingId||_!==i.accumulatingId||i.isFinished()||(i.doRender(e),se.requestAnimationFrame(function(){v(_)}))};this.accumulatingId=Cm++,this.timer=se.setTimeout(function(){g(i.accumulatingId)},50)}},{key:"doRender",value:function(e){var i=this,o=this.rendererService,u=o.clear,s=o.getViewportSize,l=o.useFramebuffer,c=s(),f=c.width,p=c.height,h=e.getLayerConfig(),g=h.jitterScale,v=g===void 0?1:g,_=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((_[0]*2-1)/f*v,(_[1]*2-1)/p*v),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),l(this.sampleRenderTarget,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.sampleRenderTarget}),e.render()}),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var x=e.getLayerConfig();l(this.outputRenderTarget,function(){i.blendModel.draw({uniforms:{u_opacity:x.opacity||1,u_MixRatio:i.frame===0?1:.9,u_Diffuse1:i.sampleRenderTarget,u_Diffuse2:i.frame===0?e.multiPassRenderer.getPostProcessor().getReadFBO():i.prevRenderTarget}})}),this.frame===0&&u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(l(this.copyRenderTarget,function(){i.outputModel.draw({uniforms:{u_Texture:i.outputRenderTarget}})}),l(e.multiPassRenderer.getPostProcessor().getReadFBO(),function(){i.copyModel.draw({uniforms:{u_Texture:i.copyRenderTarget}})}),e.multiPassRenderer.getPostProcessor().render(e));var C=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=C,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,se.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,i,o){this.shaderModuleService.registerModule(e,{vs:xm,fs:i});var u=this.shaderModuleService.getModule(e),s=u.vs,l=u.fs,c=u.uniforms,f=this.rendererService,p=f.createAttribute,h=f.createBuffer,g=f.createModel;return g((0,A.Z)({vs:s,fs:l,attributes:{a_Position:p({buffer:h({data:[-4,-4,4,-4,0,4],type:m.FLOAT}),size:2})},uniforms:(0,A.Z)({},c),depth:{enable:!1},count:3},o))}}]),t}(cr),vl=(0,q.Z)(Ri.prototype,"shaderModuleService",[hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri))||dl),kn=new j.W2;kn.bind(w.IGlobalConfigService).to(gv).inSingletonScope(),(0,j.GW)((0,j.b2)(),pe.EventEmitter),kn.bind(w.IEventEmitter).to(pe.EventEmitter);var yl=(0,Q0.Z)(kn,!1),ki=function(a){var t=yl.lazyInject(a);return function(n,e,i){t.call(this,n,e),i&&(i.initializer=function(){return n[e]})}},sb=function(a){var t=yl.lazyMultiInject(a);return function(n,e,i){t.call(this,n,e),i&&(i.initializer=function(){return n[e]})}},De=kn,bm=0;function Am(){var r=new j.W2;return r.parent=kn,r.bind(w.SceneID).toConstantValue("".concat(bm++)),r.bind(w.IShaderModuleService).to(pg).inSingletonScope(),r.bind(w.ILayerService).to(Pv).inSingletonScope(),r.bind(w.IDebugService).to(Cv).inSingletonScope(),r.bind(w.ISceneService).to($v).inSingletonScope(),r.bind(w.ICameraService).to(av).inSingletonScope(),r.bind(w.ICoordinateSystemService).to(_v).inSingletonScope(),r.bind(w.IInteractionService).to(Mv).inSingletonScope(),r.bind(w.IPickingService).to(Fv).inSingletonScope(),r.bind(w.IControlService).to(lv).inSingletonScope(),r.bind(w.IMarkerService).to(cv).inSingletonScope(),r.bind(w.IIconService).to(iv).inSingletonScope(),r.bind(w.IFontService).to(ev).inSingletonScope(),r.bind(w.IPopupService).to(fv).inSingletonScope(),r.bind(w.INormalPass).to(vg).whenTargetNamed("clear"),r.bind(w.INormalPass).to(xg).whenTargetNamed("pixelPicking"),r.bind(w.INormalPass).to(mm).whenTargetNamed("render"),r.bind(w.INormalPass).to(Sm).whenTargetNamed("taa"),r.bind(w.IFactoryNormalPass).toFactory(function(a){return function(t){return a.container.getNamed(w.INormalPass,t)}}),r.bind(w.IPostProcessingPass).to($g).whenTargetNamed("copy"),r.bind(w.IPostProcessingPass).to(Mg).whenTargetNamed("bloom"),r.bind(w.IPostProcessingPass).to(wg).whenTargetNamed("blurH"),r.bind(w.IPostProcessingPass).to(Bg).whenTargetNamed("blurV"),r.bind(w.IPostProcessingPass).to(sm).whenTargetNamed("noise"),r.bind(w.IPostProcessingPass).to(hm).whenTargetNamed("sepia"),r.bind(w.IPostProcessingPass).to(Hg).whenTargetNamed("colorHalftone"),r.bind(w.IPostProcessingPass).to(qg).whenTargetNamed("hexagonalPixelate"),r.bind(w.IPostProcessingPass).to(rm).whenTargetNamed("ink"),r.bind(w.IFactoryPostProcessingPass).toFactory(function(a){return function(t){var n=a.container.getNamed(w.IPostProcessingPass,t);return n.setName(t),n}}),r}function Fn(r){var a=new j.W2;return a.parent=r,a.bind(w.IStyleAttributeService).to(jv).inSingletonScope(),a.bind(w.IMultiPassRenderer).to(yg).inSingletonScope(),a.bind(w.IPostProcessor).to(dm).inSingletonScope(),a}var Tm=null;function lb(r){return Tm.indexOf(r)}var Mm=2,cb=4,Lm=64,fb=128,Rm=256,km=512,pb=8192,hb=16384,db=32768,Fm=null,_l=131072,vb=262144,wm=524288,gb=1048576,Om=2097152,mb=4194304,Dm=8388608,Im=16777216,Pm=null;function fr(r,a){return r=clamp(Math.floor(r),0,255),a=clamp(Math.floor(a),0,255),256*r+a}function yb(r){var a=r.color,t=r.radius,n=r.tileX,e=r.tileY,i=r.shape,o=r.opacity,u=r.stroke,s=r.strokeWidth,l=r.strokeOpacity,c=[],f=[],p=[],h=[fr(a[0],a[1]),fr(a[2],a[3])],g=[fr(u[0],u[1]),fr(u[2],u[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(v){var _=_slicedToArray(v,2),x=_[0],C=_[1];c.push([].concat(h,[(x+1)*Dm+(C+1)*Om+getShapeIndex(i)*_l+t,(n+512)*wm+(e+512)*Lm])),f.push([].concat(g,[s,l])),p.push([o,0,0,0])}),{packedBuffer:c,packedBuffer2:f,packedBuffer3:p}}function _b(r,a){if(r===0&&!a)return 0;if(r===1&&a)return 4294967295;var t=a?1:0,n=Math.floor(r*127);return n*Pm+t*Im+n*_l+t*Fm+n*km+t*Rm+n*Mm+t}var Nt={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},me={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},le;(function(r){r.LINEAR="linear",r.SEQUENTIAL="sequential",r.POWER="power",r.LOG="log",r.IDENTITY="identity",r.TIME="time",r.QUANTILE="quantile",r.QUANTIZE="quantize",r.THRESHOLD="threshold",r.CAT="cat",r.DIVERGING="diverging"})(le||(le={}));var St;(function(r){r.CONSTANT="constant",r.VARIABLE="variable"})(St||(St={}));var X;(function(r){r[r.Attribute=0]="Attribute",r[r.InstancedAttribute=1]="InstancedAttribute",r[r.Uniform=2]="Uniform"})(X||(X={}));var Fi=["mapload","mapchange","mapAfterFrameChange"],pr=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],xe;(function(r){r.IMAGE="image",r.CUSTOMIMAGE="customImage",r.ARRAYBUFFER="arraybuffer",r.RGB="rgb",r.TERRAINRGB="terrainRGB",r.CUSTOMRGB="customRGB",r.CUSTOMARRAYBUFFER="customArrayBuffer",r.CUSTOMTERRAINRGB="customTerrainRGB"})(xe||(xe={}));function Bm(r){var a=Nm();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Nm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var wi=function(r){(0,F.Z)(t,r);var a=Bm(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this),(0,d.Z)((0,E.Z)(e),"added",!1),(0,d.Z)((0,E.Z)(e),"eventHandle",function(i){e.polyfillEvent(i),e.emit(i.type,{target:i,data:e.markerOption.extData,lngLat:e.lngLat})}),e.markerOption=(0,A.Z)((0,A.Z)({},e.getDefault()),n),so(["update","onMove","onMapClick"],(0,E.Z)(e)),e.init(),e}return(0,T.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Jr.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(w.IMapService),this.sceneSerive=e.get(w.ISceneService);var i=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&Ze(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var i=this;if(!this.added)return this.once("added",function(){i.setElement(e)}),this;var o=this.markerOption.element;return o&&Ze(o),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",function(){e.openPopup()}),this;var i=this.popup;return i?(i.isOpen()||i.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",function(){e.closePopup()});var i=this.popup;return i&&i.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;if(e)e.isOpen()?e.remove():e.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(!!this.mapsService){var e=this.markerOption,i=e.element,o=e.anchor;this.updatePosition(),io(i,"".concat(Jn[o]))}}},{key:"onMapClick",value:function(e){var i=this.markerOption.element;this.popup&&i&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(e==null?void 0:e.scrollHeight)||0,containerWidth:(e==null?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var e=this.markerOption,i=e.element,o=e.offsets,u=this.lngLat,s=u.lng,l=u.lat,c=this.mapsService.lngLatToContainer([s,l]);if(i){i.style.display="block",i.style.whiteSpace="nowrap";var f=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),p=f.containerHeight,h=f.containerWidth,g=f.bounds;if(!g)return;if(Math.abs(g[0][0])>180||Math.abs(g[1][0])>180){if(c.x>h){var v=this.mapsService.lngLatToContainer([s-360,l]);c.x=v.x}if(c.x<0){var _=this.mapsService.lngLatToContainer([s+360,l]);c.x=_.x}}(c.x>h||c.x<0||c.y>p||c.y<0)&&(i.style.display="none"),i.style.left=c.x+o[0]+"px",i.style.top=c.y-o[1]+"px"}}}},{key:"init",value:function(){var e=this,i=this.markerOption.element,o=this.markerOption,u=o.color,s=o.anchor;if(!i){this.defaultMarker=!0,i=re("div"),this.markerOption.element=i;var l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height","48px"),l.setAttributeNS(null,"width","48px"),l.setAttributeNS(null,"viewBox","0 0 1024 1024");var c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),c.setAttributeNS(null,"fill",u),l.appendChild(c),i.appendChild(l)}Je(i,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(f){var p,h,g=((p=e.markerOption)===null||p===void 0?void 0:p.style)&&((h=e.markerOption)===null||h===void 0?void 0:h.style[f]);i&&(i.style[f]=g)}),Qa(i,s,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){!this.mapsService||this.mapsService.version!=="GAODE2.x"||!Rh()&&Lh&&(e.type==="touchstart"&&(this.touchStartTime=Date.now()),e.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),t}(pe.EventEmitter),Zm=z(69848),El=z.n(Zm);function zm(r){var a=Um();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Um(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Eb=function(r){(0,F.Z)(t,r);var a=zm(t);function t(n){var e,i;return(0,R.Z)(this,t),i=a.call(this),(0,d.Z)((0,E.Z)(i),"markers",[]),(0,d.Z)((0,E.Z)(i),"points",[]),(0,d.Z)((0,E.Z)(i),"clusterMarkers",[]),i.markerLayerOption=(0,N.merge)(i.getDefault(),n),so(["update"],(0,E.Z)(i)),i.zoom=((e=i.markerLayerOption.clusterOption)===null||e===void 0?void 0:e.zoom)||-99,i}return(0,T.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(w.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(e==null?void 0:e.scrollWidth)||0,containerHeight:(e==null?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var i=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),i&&(this.addPoint(e,this.markers.length),this.mapsService)){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();this.bbox=xn(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var i=this.markers.indexOf(e);i>-1&&this.markers.splice(i,1)}},{key:"hide",value:function(){this.markers.map(function(e){e.getElement().style.opacity="0"}),this.clusterMarkers.map(function(e){e.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(e){e.getElement().style.opacity="1"}),this.clusterMarkers.map(function(e){e.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var e=this.markerLayerOption.cluster;return e?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach(function(i){i.addTo(e.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(e){e.remove()}),this.clusterMarkers.forEach(function(e){e.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,i){var o=e.getLnglat(),u=o.lng,s=o.lat,l={geometry:{type:"Point",coordinates:[u,s]},properties:(0,A.Z)((0,A.Z)({},e.getExtData()),{},{marker_id:i})};this.points.push(l),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,i=e.radius,o=e.minZoom,u=o===void 0?0:o,s=e.maxZoom;this.clusterIndex=new(El())({radius:i,minZoom:u,maxZoom:s}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,i){var o=this,u=e[0].concat(e[1]),s=this.clusterIndex.getClusters(u,i);this.clusterMarkers.forEach(function(l){l.remove()}),this.clusterMarkers=[],s.forEach(function(l){var c,f=o.markerLayerOption.clusterOption,p=f.field,h=f.method;if((c=l.properties)!==null&&c!==void 0&&c.cluster_id){var g,v=o.getLeaves((g=l.properties)===null||g===void 0?void 0:g.cluster_id);if(l.properties.clusterData=v,p&&h){var _=v==null?void 0:v.map(function(L){var D=(0,d.Z)({},p,L.properties[p]);return D}),x=ci(_,p),C=ed(h,x),S="point_"+h;l.properties[S]=C.toFixed(2)}}var M=o.clusterMarker(l);o.clusterMarkers.push(M),M.addTo(o.scene)})}},{key:"getLeaves",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,i,o):null}},{key:"clusterMarker",value:function(e){var i=this.markerLayerOption.clusterOption,o=i,u=o.element,s=u===void 0?this.generateElement.bind(this):u,l=new wi({element:s(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]});return l}},{key:"normalMarker",value:function(e){var i=e.properties.marker_id;return this.markers[i]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var e=this.mapsService.getZoom(),i=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!si(this.bbox,i))&&(this.bbox=xn(i,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var i=re("div","l7-marker-cluster"),o=re("div","",i),u=re("span","",o),s=this.markerLayerOption.clusterOption,l=s.field,c=s.method;e.properties.point_count=e.properties.point_count||1;var f=l&&c?e.properties["point_"+c]||e.properties[l]:e.properties.point_count;return u.textContent=f,i}}]),t}(pe.EventEmitter),xb=z(23620);function Hm(r){var a=jm();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function jm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Zt=function(r){(0,F.Z)(t,r);var a=Hm(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this),t.controlCount++,e.controlOption=(0,A.Z)((0,A.Z)({},e.getDefault(n)),n||{}),e}return(0,T.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var i=this.getDefault(e);Object.entries(e).forEach(function(o){var u=(0,W.Z)(o,2),s=u[0],l=u[1];l===void 0&&(e[s]=i[s])}),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=(0,A.Z)((0,A.Z)({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(w.IMapService),this.renderService=e.get(w.IRendererService),this.layerService=e.get(w.ILayerService),this.controlService=e.get(w.IControlService),this.configService=e.get(w.IGlobalConfigService),this.scene=e.get(w.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),Je(this.container,"l7-control");var i=this.controlOption,o=i.className,u=i.style;return o&&this.setClassName(o),u&&this.setStyle(u),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ze(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return re("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var e=this.container;Dt(e,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e=this.container;Je(e,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:ct.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var i=this.mapsService.getContainer();i!==null&&i.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ct.TOPLEFT,i=this.controlService;return i&&i.removeControl(this),this.controlOption.position=e,i&&i.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var i=this.container,o=this.controlOption.className;o&&Dt(i,o),e&&Je(i,e)}},{key:"setStyle",value:function(e){var i=this.container;e?i.setAttribute("style",e):i.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,i=this.container;if(e instanceof Element)e.appendChild(i);else{var o=this.controlService.controlCorners[e];e.indexOf("bottom")!==-1?o.insertBefore(i,o.firstChild):o.appendChild(i)}}},{key:"checkUpdateOption",value:function(e,i){return i.some(function(o){return o in e})}}]),t}(Qe());(0,d.Z)(Zt,"controlCount",0);function Vm(r){var a=Gm();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Gm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var hr=function(r){(0,F.Z)(t,r);var a=Vm(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"isDisable",!1),n}return(0,T.Z)(t,[{key:"setIsDisable",value:function(e){if(this.isDisable=e,e){var i;(i=this.button)===null||i===void 0||i.setAttribute("disabled","true")}else{var o;(o=this.button)===null||o===void 0||o.removeAttribute("disabled")}}},{key:"createButton",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return re("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,i=e.title,o=e.btnText,u=e.btnIcon;return this.setBtnTitle(i),this.setBtnText(o),this.setBtnIcon(u),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var i=e.title,o=e.btnText,u=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(i),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(o),(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var i;(i=this.button)===null||i===void 0||i.setAttribute("title",e!=null?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&Ze(this.buttonIcon),e){var i,o=(i=this.button)===null||i===void 0?void 0:i.firstChild;if(o){var u;(u=this.button)===null||u===void 0||u.insertBefore(e,o)}else{var s;(s=this.button)===null||s===void 0||s.appendChild(e)}this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(!!this.button)if(Dt(this.button,"l7-button-control--row"),Dt(this.button,"l7-button-control--column"),e){var i=this.buttonText;if(!i){var o;i=re("div","l7-button-control__text"),(o=this.button)===null||o===void 0||o.appendChild(i),this.buttonText=i}i.innerText=e,Je(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(Ze(this.buttonText),this.buttonText=void 0)}}]),t}(Zt);function Wm(r){var a=$m();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function $m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var xl=function(r){(0,F.Z)(t,r);var a=Wm(t);function t(n,e){var i;return(0,R.Z)(this,t),i=a.call(this),(0,d.Z)((0,E.Z)(i),"isShow",!1),(0,d.Z)((0,E.Z)(i),"timeout",null),(0,d.Z)((0,E.Z)(i),"show",function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),Dt(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&t.conflictPopperList.forEach(function(o){o!==(0,E.Z)(i)&&o.isShow&&o.hide()}),i.emit("show")),(0,E.Z)(i)}),(0,d.Z)((0,E.Z)(i),"hide",function(){return i.isShow&&(Je(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide")),(0,E.Z)(i)}),(0,d.Z)((0,E.Z)(i),"setHideTimeout",function(){i.timeout||(i.timeout=window.setTimeout(function(){!i.isShow||(i.hide(),i.timeout=null)},300))}),(0,d.Z)((0,E.Z)(i),"clearHideTimeout",function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)}),(0,d.Z)((0,E.Z)(i),"onBtnClick",function(){i.isShow?i.hide():i.show()}),(0,d.Z)((0,E.Z)(i),"onBtnMouseLeave",function(){i.setHideTimeout()}),(0,d.Z)((0,E.Z)(i),"onBtnMouseMove",function(){i.clearHideTimeout(),!i.isShow&&i.show()}),i.button=n,i.option=e,i.init(),e.unique&&t.conflictPopperList.push((0,E.Z)(i)),i}return(0,T.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){typeof e=="string"?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(En(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),e==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ze(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},i=this.option,o=i.container,u=i.offset,s=u===void 0?[0,0]:u,l=i.placement,c=(0,W.Z)(s,2),f=c[0],p=c[1],h=this.button.getBoundingClientRect(),g=o.getBoundingClientRect(),v=Ah(h,g),_=v.left,x=v.right,C=v.top,S=v.bottom,M=!1,L=!1;/^(left|right)/.test(l)?(l.includes("left")?e.right="".concat(h.width+x,"px"):l.includes("right")&&(e.left="".concat(h.width+_,"px")),l.includes("start")?e.top="".concat(C,"px"):l.includes("end")?e.bottom="".concat(S,"px"):(e.top="".concat(C+h.height/2,"px"),L=!0,e.transform="translate(".concat(f,"px, calc(").concat(p,"px - 50%))"))):/^(top|bottom)/.test(l)&&(l.includes("top")?e.bottom="".concat(h.height+S,"px"):l.includes("bottom")&&(e.top="".concat(h.height+C,"px")),l.includes("start")?e.left="".concat(_,"px"):l.includes("end")?e.right="".concat(x,"px"):(e.left="".concat(_+h.width/2,"px"),M=!0,e.transform="translate(calc(".concat(f,"px - 50%), ").concat(p,"px)"))),e.transform="translate(calc(".concat(f,"px - ").concat(M?"50%":"0%","), calc(").concat(p,"px - ").concat(L?"50%":"0%",")");var D=l.split("-");D.length&&Je(this.popperDOM,D.map(function(B){return"l7-popper-".concat(B)}).join(" ")),ao(this.popperDOM,bh(e))}},{key:"createPopper",value:function(){var e=this.option,i=e.container,o=e.className,u=o===void 0?"":o,s=e.content,l=re("div","l7-popper l7-popper-hide ".concat(u)),c=re("div","l7-popper-content"),f=re("div","l7-popper-arrow");return l.appendChild(c),l.appendChild(f),i.appendChild(l),this.popperDOM=l,this.contentDOM=c,s&&this.setContent(s),l}}]),t}(pe.EventEmitter);(0,d.Z)(xl,"conflictPopperList",[]);function Xm(r){var a=Ym();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Ym(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Km={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},Qm=function(r){(0,F.Z)(t,r);var a=Xm(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,oe.Z)((0,b.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var i,o=(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e),u=(i=e==null?void 0:e.position)!==null&&i!==void 0?i:o.position;return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:u instanceof Element?"bottom":Km[u],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,i=this.controlOption,o=i.popperClassName,u=i.popperPlacement,s=i.popperTrigger,l=this.mapsService.getMapContainer();return this.popper=new xl(this.button,{className:o,placement:u,trigger:s,container:l,unique:!0}),this.popper.on("show",function(){e.emit("popperShow",e)}).on("hide",function(){e.emit("popperHide",e)}),this.popper}},{key:"setOptions",value:function(e){if((0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var i=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(i)}}}]),t}(hr);function qm(r){var a=Jm();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Jm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var bt=function(r){return r.ActiveOptionClassName="l7-select-control-item-active",r.OptionValueAttrKey="data-option-value",r.OptionIndexAttrKey="data-option-index",r}(bt||{}),Cl=function(r){(0,F.Z)(t,r);var a=qm(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"selectValue",[]),(0,d.Z)((0,E.Z)(n),"createNormalOption",function(u){var s=n.selectValue.includes(u.value),l=re("div","l7-select-control-item ".concat(s?bt.ActiveOptionClassName:""));n.getIsMultiple()&&l.appendChild(n.createCheckbox(s)),u.icon&&l.appendChild(u.icon);var c=re("span");return c.innerText=u.text,l.appendChild(c),l}),(0,d.Z)((0,E.Z)(n),"onItemClick",function(u){if(n.getIsMultiple()){var s=n.selectValue.findIndex(function(l){return l===u.value});s>-1?n.selectValue.splice(s,1):n.selectValue=[].concat((0,G.Z)(n.selectValue),[u.value])}else n.selectValue=[u.value];n.setSelectValue(n.selectValue)}),n}return(0,T.Z)(t,[{key:"setOptions",value:function(e){(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e);var i=e.options;i&&this.popper.setContent(this.getPopperContent(i))}},{key:"onAdd",value:function(){var e=(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this),i=this.controlOption.defaultValue;return i&&(this.selectValue=this.transSelectValue(i)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=this.transSelectValue(e);this.optionDOMList.forEach(function(s){var l=s.getAttribute(bt.OptionValueAttrKey),c=i.getIsMultiple()?s.querySelector("input[type=checkbox]"):void 0;u.includes(l)?(Je(s,bt.ActiveOptionClassName),c&&ii(c,!0)):(Dt(s,bt.ActiveOptionClassName),c&&ii(c,!1))}),this.selectValue=u,o&&this.emit("selectChange",this.getIsMultiple()?u:u[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var i=this,o=this.isImageOptions(),u=re("div",o?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Je(u,"l7-select-control--multiple");var s=e.map(function(l,c){var f=o?i.createImageOption(l):i.createNormalOption(l);return f.setAttribute(bt.OptionValueAttrKey,l.value),f.setAttribute(bt.OptionIndexAttrKey,window.String(c)),f.addEventListener("click",i.onItemClick.bind(i,l)),f});return u.append.apply(u,(0,G.Z)(s)),this.optionDOMList=s,u}},{key:"createImageOption",value:function(e){var i=this.selectValue.includes(e.value),o=re("div","l7-select-control-item ".concat(i?bt.ActiveOptionClassName:"")),u=re("img");u.setAttribute("src",e.img),uo(u),o.appendChild(u);var s=re("div","l7-select-control-item-row");this.getIsMultiple()&&o.appendChild(this.createCheckbox(i));var l=re("span");return l.innerText=e.text,s.appendChild(l),o.appendChild(s),o}},{key:"createCheckbox",value:function(e){var i=re("input");return i.setAttribute("type","checkbox"),e&&ii(i,!0),i}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(e){return e.img})}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),t}(Qm),ht=function(a){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(a)),t.appendChild(n),t};function ey(r){var a=ty();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function ty(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Cb=function(r){(0,F.Z)(t,r);var a=ey(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"onClick",(0,k.Z)(y().mark(function u(){var s;return y().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s=n.controlOption.onExport,s!=null){c.next=5;break}c.next=10;break;case 5:return c.t0=s,c.next=8,n.getImage();case 8:c.t1=c.sent,(0,c.t0)(c.t1);case 10:case"end":return c.stop()}},u)}))),(0,d.Z)((0,E.Z)(n),"mergeImage",(0,k.Z)(y().mark(function u(){var s,l,c,f,p,h,g,v,_,x,C,S,M,L,D=arguments;return y().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:for(c=n.controlOption.imageType,f=(s=(l=n.mapsService.getContainer())===null||l===void 0?void 0:l.getBoundingClientRect())!==null&&s!==void 0?s:{},p=f.width,h=p===void 0?0:p,g=f.height,v=g===void 0?0:g,_=document.createElement("canvas"),_.width=h,_.height=v,x=_.getContext("2d"),C=D.length,S=new Array(C),M=0;M<C;M++)S[M]=D[M];return I.next=9,Promise.all(S.map(function(P){return new Promise(function(U){var V=new Image;V.onload=function(){U(V)},V.src=P})}));case 9:return L=I.sent,L.forEach(function(P){x==null||x.drawImage(P,0,0,h,v)}),I.abrupt("return",_.toDataURL("image/".concat(c)));case 12:case"end":return I.stop()}},u)}))),n}return(0,T.Z)(t,[{key:"onAdd",value:function(){var e=(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:ht("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.mapsService.exportMap("png");case 2:return o=l.sent,l.next=5,this.scene.exportPng("png");case 5:return u=l.sent,l.abrupt("return",this.mergeImage.apply(this,(0,G.Z)([o,u].filter(function(c){return c}))));case 7:case"end":return l.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()}]),t}(hr);function ny(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=ry(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function ry(r,a){if(!!r){if(typeof r=="string")return Sl(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sl(r,a)}}function Sl(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var bl=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],dt=function(){if(typeof document=="undefined")return!1;for(var r=bl[0],a={},t=0,n=bl;t<n.length;t++){var e=n[t],i=e==null?void 0:e[1];if(i in document){var o=ny(e.entries()),u;try{for(o.s();!(u=o.n()).done;){var s=(0,W.Z)(u.value,2),l=s[0],c=s[1];a[r[l]]=c}}catch(f){o.e(f)}finally{o.f()}return a}}return!1}(),Al={change:dt.fullscreenchange,error:dt.fullscreenerror},ze={request:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,e){var i=function u(){ze.off("change",u),n()};ze.on("change",i);var o=a[dt.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(e)})},exit:function(){return new Promise(function(a,t){if(!ze.isFullscreen){a();return}var n=function i(){ze.off("change",i),a()};ze.on("change",n);var e=document[dt.exitFullscreen]();e instanceof Promise&&e.then(n).catch(t)})},toggle:function(a,t){return ze.isFullscreen?ze.exit():ze.request(a,t)},onchange:function(a){ze.on("change",a)},onerror:function(a){ze.on("error",a)},on:function(a,t){var n=Al[a];n&&document.addEventListener(n,t,!1)},off:function(a,t){var n=Al[a];n&&document.removeEventListener(n,t,!1)},raw:dt};Object.defineProperties(ze,{isFullscreen:{get:function(){return Boolean(document[dt.fullscreenElement])}},element:{enumerable:!0,get:function(){var a;return(a=document[dt.fullscreenElement])!==null&&a!==void 0?a:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[dt.fullscreenEnabled])}}}),dt||(ze={isEnabled:!1});var Oi=ze;function iy(r){var a=ay();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function ay(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Sb=function(r){(0,F.Z)(t,r);var a=iy(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this,n),(0,d.Z)((0,E.Z)(e),"isFullscreen",!1),(0,d.Z)((0,E.Z)(e),"toggleFullscreen",(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Oi.isEnabled){u.next=3;break}return u.next=3,Oi.toggle(e.mapContainer);case 3:case"end":return u.stop()}},i)}))),(0,d.Z)((0,E.Z)(e),"onClick",function(){e.toggleFullscreen()}),(0,d.Z)((0,E.Z)(e),"onFullscreenChange",function(){e.isFullscreen=!!document.fullscreenElement;var i=e.controlOption,o=i.btnText,u=i.btnIcon,s=i.title,l=i.exitBtnText,c=i.exitBtnIcon,f=i.exitTitle;e.isFullscreen?(e.setBtnTitle(f),e.setBtnText(l),e.setBtnIcon(c)):(e.setBtnTitle(s),e.setBtnText(o),e.setBtnIcon(u)),e.emit("fullscreenChange",e.isFullscreen)}),Oi.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),e}return(0,T.Z)(t,[{key:"setOptions",value:function(e){var i=e.exitBtnText,o=e.exitBtnIcon,u=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(o),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(i),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(u)),(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=eo(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){(0,oe.Z)((0,b.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{title:"\u5168\u5C4F",btnIcon:ht("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:ht("l7-icon-exit-fullscreen")})}}]),t}(hr);function oy(r){var a=uy();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function uy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var bb=function(r){(0,F.Z)(t,r);var a=oy(t);function t(n){var e;return(0,R.Z)(this,t),e=a.call(this,n),(0,d.Z)((0,E.Z)(e),"getGeoLocation",function(){return new Promise(function(i,o){window.navigator.geolocation.getCurrentPosition(function(u){var s=u.coords,l=s!=null?s:{},c=l.longitude,f=l.latitude;!(0,N.isNaN)(c)&&!(0,N.isNaN)(f)?i([c,f]):o()},function(u){o(u)})})}),(0,d.Z)((0,E.Z)(e),"onClick",(0,k.Z)(y().mark(function i(){var o,u,s;return y().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(window.navigator.geolocation){c.next=2;break}return c.abrupt("return");case 2:return o=e.controlOption.transform,c.next=5,e.getGeoLocation();case 5:if(u=c.sent,s=e.mapsService.getZoom(),c.t0=e.mapsService,c.t1=s>15?s:15,!o){c.next=15;break}return c.next=12,o(u);case 12:c.t2=c.sent,c.next=16;break;case 15:c.t2=u;case 16:c.t3=c.t2,c.t0.setZoomAndCenter.call(c.t0,c.t1,c.t3);case 18:case"end":return c.stop()}},i)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),e}return(0,T.Z)(t,[{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{title:"\u5B9A\u4F4D",btnIcon:ht("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),t}(hr);function sy(r){var a=ly();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function ly(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ab=function(r){(0,F.Z)(t,r);var a=sy(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"onLayerChange",function(){var u;(u=n.controlOption.layers)!==null&&u!==void 0&&u.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,d.Z)((0,E.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,d.Z)((0,E.Z)(n),"onSelectChange",function(){n.layers.forEach(function(u){var s=n.selectValue.includes(u.name),l=u.isVisible();s&&!l&&u.show(),!s&&l&&u.hide()})}),n}return(0,T.Z)(t,[{key:"layers",get:function(){var e=this.layerService,i=this.controlOption.layers;if(Array.isArray(i)&&i.length){var o=[];return i.forEach(function(u){if(u instanceof Object&&o.push(u),typeof u=="string"){var s=e.getLayer(u)||e.getLayerByName(u);s&&o.push(s)}}),o}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:ht("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(e){return e.isVisible()}).map(function(e){return e.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(e){return{text:e.name,value:e.name}})}},{key:"setOptions",value:function(e){var i=this.checkUpdateOption(e,["layers"]);(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e),i&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return(e=this.controlOption.options)!==null&&e!==void 0&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(Cl);function cy(r){var a=fy();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function fy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var py=function(r){(0,F.Z)(t,r);var a=cy(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getDefault",value:function(){return{position:ct.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=re("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(En(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var i=this.controlOption,o=i.href,u=i.img,s=re("img");if(s.setAttribute("src",u),s.setAttribute("aria-label","AntV logo"),uo(s),o){var l=re("a","l7-control-logo-link");l.target="_blank",l.href=o,l.rel="noopener nofollow",l.setAttribute("rel","noopener nofollow"),l.appendChild(s),e.appendChild(l)}else e.appendChild(s)}}]),t}(Zt),hy={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},dy={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function vy(r){var a=gy();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function gy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Tb=function(r){(0,F.Z)(t,r);var a=vy(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,T.Z)(t,[{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:ht("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e=this.mapsService.getType()==="mapbox"?dy:hy;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(i){var o=(0,W.Z)(i,2),u=o[0],s=o[1];return typeof s=="string"&&u!=="blank"}).map(function(i){var o,u=(0,W.Z)(i,2),s=u[0],l=u[1],c=(o=e[s])!==null&&o!==void 0?o:{},f=c.text,p=c.img;return{text:f!=null?f:s,value:l,img:p,key:s}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,i=this;if((e=this.controlOption.options)!==null&&e!==void 0&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var o,u,s=this.controlOption.defaultValue;this.controlOption.defaultValue=(o=(u=this.controlOption.options.find(function(c){return c.key===s}))===null||u===void 0?void 0:u.value)!==null&&o!==void 0?o:s}else{var l=this.getMapStyle();l?this.controlOption.defaultValue=l:this.mapsService.map.once("styledata",function(){var c=i.mapsService.getMapStyle();i.controlOption.defaultValue=c,i.setSelectValue(c,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,oe.Z)((0,b.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(Cl);function yy(r){var a=_y();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function _y(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Mb=function(r){(0,F.Z)(t,r);var a=yy(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"location",[0,0]),(0,d.Z)((0,E.Z)(n),"onMouseMove",function(u){var s=n.location,l=u.lngLat||u.lnglat,c=n.controlOption.transform;l&&(s=[l.lng,l.lat]),n.location=s,c&&(s=c(s)),n.insertLocation2HTML(s),n.emit("locationChange",s)}),n}return(0,T.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{position:ct.BOTTOMLEFT,transform:function(o){var u=(0,W.Z)(o,2),s=u[0],l=u[1];return[+(+s).toFixed(6),+(+l).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=re("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),t}(Zt);function Ey(r){var a=xy();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function xy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Cy=function(r){(0,F.Z)(t,r);var a=Ey(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"update",function(){var u=n.mapsService,s=n.controlOption.maxWidth,l=u.getSize()[1]/2,c=u.containerToLngLat([0,l]),f=u.containerToLngLat([s,l]),p=Ph([c.lng,c.lat],[f.lng,f.lat]);n.updateScales(p)}),n}return(0,T.Z)(t,[{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:ct.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e="l7-control-scale",i=re("div",e);this.resetScaleLines(i);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),i}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var i=this.controlOption,o=i.metric,u=i.imperial;o&&e&&this.updateMetric(e),u&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){En(e);var i=this.controlOption,o=i.metric,u=i.imperial,s=i.maxWidth,l=i.lockWidth;l&&ao(e,"width: ".concat(s,"px")),o&&(this.mScale=re("div","l7-control-scale-line",e)),u&&(this.iScale=re("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,i,o){var u=this.controlOption.maxWidth;e.style.width=Math.round(u*o)+"px",e.innerHTML=i}},{key:"getRoundNum",value:function(e){var i=Math.pow(10,(Math.floor(e)+"").length-1),o=e/i;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,i*o}},{key:"updateMetric",value:function(e){var i=this.getRoundNum(e),o=i<1e3?i+" m":i/1e3+" km";this.updateScale(this.mScale,o,i/e)}},{key:"updateImperial",value:function(e){var i=e*3.2808399,o,u,s;i>5280?(o=i/5280,u=this.getRoundNum(o),this.updateScale(this.iScale,u+" mi",u/o)):(s=this.getRoundNum(i),this.updateScale(this.iScale,s+" ft",s/i))}}]),t}(Zt);function Sy(r){var a=by();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function by(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ay=function(r){(0,F.Z)(t,r);var a=Sy(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,d.Z)((0,E.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,d.Z)((0,E.Z)(n),"updateDisabled",function(){var u=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||u.getZoom()<=u.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),(n.disabled||u.getZoom()>=u.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,T.Z)(t,[{key:"getDefault",value:function(e){return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{position:ct.BOTTOMRIGHT,name:"zoom",zoomInText:ht("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:ht("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(e){(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=re("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){En(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,i,o,u,s){var l=re("button",o,u);return typeof e=="string"?l.innerHTML=e:l.append(e),l.title=i,l.addEventListener("click",s),l}}]),t}(Zt);function Ty(r){var a=My();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function My(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ly=function(r){(0,F.Z)(t,r);var a=Ty(t);function t(n){var e;(0,R.Z)(this,t),e=a.call(this),(0,d.Z)((0,E.Z)(e),"isShow",!0),(0,d.Z)((0,E.Z)(e),"onMouseMove",function(o){var u,s=e.mapsService.getMapContainer(),l=(u=s==null?void 0:s.getBoundingClientRect())!==null&&u!==void 0?u:{},c=l.left,f=c===void 0?0:c,p=l.top,h=p===void 0?0:p;e.setPopupPosition(o.clientX-f,o.clientY-h)}),(0,d.Z)((0,E.Z)(e),"updateLngLatPosition",function(){if(!(!e.mapsService||e.popupOption.followCursor)){var o=e.lngLat,u=o.lng,s=o.lat,l=e.mapsService.lngLatToContainer([u,s]),c=l.x,f=l.y;e.setPopupPosition(c,f)}}),(0,d.Z)((0,E.Z)(e),"onKeyDown",function(o){o.keyCode===27&&e.remove()}),(0,d.Z)((0,E.Z)(e),"onCloseButtonClick",function(o){o.stopPropagation&&o.stopPropagation(),e.hide()}),(0,d.Z)((0,E.Z)(e),"update",function(){var o=!!e.lngLat,u=e.popupOption,s=u.className,l=u.style,c=u.maxWidth,f=u.anchor,p=u.stopPropagation;if(!(!e.mapsService||!o||!e.content)){var h=e.mapsService.getMarkerContainer();if(!e.container&&h&&(e.container=re("div","l7-popup ".concat(s!=null?s:""," ").concat(e.isShow?"":"l7-popup-hide"),h),l&&e.container.setAttribute("style",l),e.tip=re("div","l7-popup-tip",e.container),e.container.appendChild(e.content),p&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(_){e.container.addEventListener(_,function(x){x.stopPropagation()})}),e.container.style.whiteSpace="nowrap"),e.updateLngLatPosition(),io(e.container,"".concat(Jn[f])),Qa(e.container,f,"popup"),c){var g=e.container.getBoundingClientRect(),v=g.width;v>parseFloat(c)&&(e.container.style.width=c)}else e.container.style.removeProperty("width")}}),e.popupOption=(0,A.Z)((0,A.Z)({},e.getDefault(n!=null?n:{})),n);var i=e.popupOption.lngLat;return i&&(e.lngLat=i),e}return(0,T.Z)(t,[{key:"lngLat",get:function(){var e;return(e=this.popupOption.lngLat)!==null&&e!==void 0?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(w.IMapService),this.sceneService=e.get(w.ISceneService),this.layerService=e.get(w.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var i=this.popupOption,o=i.html,u=i.text,s=i.title;return o?this.setHTML(o):u&&this.setText(u),s&&this.setTitle(s),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&Ze(this.content),this.container&&(Ze(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.show(),this.popupOption=(0,A.Z)((0,A.Z)({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ze(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Dt(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Je(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=re("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),En(this.contentTitle),It(this.contentTitle,e)):this.contentTitle&&(Ze(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,i=e.lng,o=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([i,o]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var i=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){i.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Jr.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),It(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var i=this,o=this.mapsService;o&&(o==null||o.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame(function(){o==null||o.on("click",i.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var i,o=(i=this.mapsService)===null||i===void 0?void 0:i.getContainer();o&&(o==null||o.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(o==null||o.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&Ze(this.content),this.contentTitle=void 0,this.content=re("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var i=ht("l7-icon-guanbi");Je(i,"l7-popup-close-button"),this.content.appendChild(i),this.popupOption.closeButtonOffsets&&(i.style.right=this.popupOption.closeButtonOffsets[0]+"px",i.style.top=this.popupOption.closeButtonOffsets[1]+"px"),i.setAttribute("aria-label","Close popup"),i.addEventListener("click",function(){e.hide()}),this.closeButton=i}else this.closeButton=void 0;this.contentPanel=re("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,i){if(this.container){var o=this.popupOption.offsets;this.container.style.left=e+o[0]+"px",this.container.style.top=i-o[1]+"px"}}},{key:"checkUpdateOption",value:function(e,i){return i.some(function(o){return o in e})}}]),t}(pe.EventEmitter);function Ry(r){var a=ky();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function ky(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Lb=function(r){(0,F.Z)(t,r);var a=Ry(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"layerConfigMap",new WeakMap),n}return(0,T.Z)(t,[{key:"layerConfigItems",get:function(){var e,i=this.popupOption,o=i.config,u=i.items;return(e=o!=null?o:u)!==null&&e!==void 0?e:[]}},{key:"addTo",value:function(e){return(0,oe.Z)((0,b.Z)(t.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,oe.Z)((0,b.Z)(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),(0,oe.Z)((0,b.Z)(t.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var i=e.trigger==="click";return(0,A.Z)((0,A.Z)({},(0,oe.Z)((0,b.Z)(t.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!i,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,i=this.popupOption.trigger;this.layerConfigItems.forEach(function(o){var u,s=e.getLayerByConfig(o);if(!!s){var l=(0,A.Z)({},o);if(i==="hover"){var c=e.onLayerMouseMove.bind(e,s),f=e.onLayerMouseOut.bind(e,s);l.onMouseMove=c,l.onMouseOut=f,s==null||s.on("mousemove",c),s==null||s.on("mouseout",f)}else{var p=e.onLayerClick.bind(e,s);l.onClick=p,s==null||s.on("click",p)}var h=s==null||(u=s.getSource)===null||u===void 0?void 0:u.call(s),g=e.onSourceUpdate.bind(e,s);h==null||h.on("update",g),l.onSourceUpdate=g,e.layerConfigMap.set(s,l)}})}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach(function(i){var o=e.getLayerByConfig(i),u=o&&e.layerConfigMap.get(o);if(!!u){var s=u.onMouseMove,l=u.onMouseOut,c=u.onClick,f=u.onSourceUpdate;if(s&&o.off("mousemove",s),l&&o.off("mouseout",l),c&&o.off("click",c),f){var p;o==null||(p=o.getSource())===null||p===void 0||p.off("update",f)}}})}},{key:"onLayerMouseMove",value:function(e,i){if(!this.isSameFeature(e,i.featureId)){var o=this.getLayerInfoFrag(e,i),u=o.title,s=o.content;this.setDOMContent(s),this.setTitle(u),this.displayFeatureInfo={layer:e,featureId:i.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(e,i){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,i){if(this.isShow&&this.isSameFeature(e,i.featureId))this.hide();else{var o=this.getLayerInfoFrag(e,i),u=o.title,s=o.content;this.setDOMContent(s),this.setLnglat(i.lngLat),this.setTitle(u),this.displayFeatureInfo={layer:e,featureId:i.featureId},this.show()}}},{key:"onSourceUpdate",value:function(e){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(e,i){var o=this.layerConfigMap.get(e),u,s=document.createDocumentFragment();if(o){var l=i.feature;l.type==="Feature"&&"properties"in l&&"geometry"in l&&(l=l.properties);var c=o.title,f=o.fields,p=o.customContent;if(c){u=document.createDocumentFragment();var h=c instanceof Function?c(l):c;It(u,h)}if(p){var g=p instanceof Function?p(l):p;It(s,g)}else f!=null&&f.length&&(f==null||f.forEach(function(v){var _,x,C=typeof v=="string"?{field:v}:v,S=C.field,M=C.formatField,L=C.formatValue,D=C.getValue,B=re("div","l7-layer-popup__row"),I=D?D(i.feature):(0,N.get)(l,S),P=(_=M instanceof Function?M(S,l):M)!==null&&_!==void 0?_:S,U=(x=L instanceof Function?L(I,l):L)!==null&&x!==void 0?x:I,V=re("span","l7-layer-popup__key",B);It(V,P),It(V,document.createTextNode("\uFF1A"));var K=re("span","l7-layer-popup__value",B);Array.isArray(U)&&U.every(function(Q){return!(Q instanceof Object)})&&(U=U.map(function(Q){return String(Q)}).join(",")),It(K,U),s.appendChild(B)}))}return{title:u,content:s}}},{key:"getLayerByConfig",value:function(e){var i=e.layer;if(i instanceof Object)return i;if(typeof i=="string")return this.layerService.getLayer(i)||this.layerService.getLayerByName(i)}},{key:"isSameFeature",value:function(e,i){var o=this.displayFeatureInfo;return o&&e===o.layer&&i===o.featureId}}]),t}(Ly);function Fy(r,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(a.createTextNode(r)),e.appendChild(o),o}}Fy(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Tl={},Ml={},Ll=function(a){return Ml[a]},rt=function(a,t){Ml[a]=t},wy=function(a){return Tl[a]},Jt=function(a,t){Tl[a]=t},Oy=z(18904),Dy=z(38163),Di=z.n(Dy),Rl=z(83996),kl=z(92322);function Fl(r,a){var t=a.x,n=a.y,e=a.x1,i=a.y1,o=a.coordinates,u=a.geometry,s=[];if(!Array.isArray(r))return{dataArray:[]};if(u)return r.filter(function(x){return x[u]&&x[u].type&&x[u].coordinates&&x[u].coordinates.length>0}).forEach(function(x,C){var S=Di()((0,A.Z)({},x[u]),!0);(0,kl.nG)(S,function(M){var L=(0,Rl.r7)(M),D=(0,A.Z)((0,A.Z)({},x),{},{_id:C,coordinates:L});s.push(D)})}),{dataArray:s};for(var l=0;l<r.length;l++){var c=r[l],f=[];if(o){var p="Polygon";Array.isArray(o[0])||(p="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(p="LineString");var h=Di()({type:p,coordinates:(0,G.Z)(c[o])},!0);f=h.coordinates}else if(t&&n&&e&&i){var g=[parseFloat(c[t]),parseFloat(c[n])],v=[parseFloat(c[e]),parseFloat(c[i])];f=[g,v]}else t&&n&&(f=[parseFloat(c[t]),parseFloat(c[n])]);var _=(0,A.Z)((0,A.Z)({},c),{},{_id:l,coordinates:f});s.push(_)}return{dataArray:s}}function Iy(r,a){var t=(0,Oy.ue)(r);return Fl(t,a)}function Py(r){for(var a=r.toString(),t=5381,n=a.length;n;)t=t*33^a.charCodeAt(--n);return t>>>0}function By(r,a){return a===void 0?null:(0,yn.Z)(r.properties[a])*1==="number"?r.properties[a]*1:r.properties&&r.properties[a]?Py(r.properties[a]+"")%1000019:null}function Ny(r,a){var t=[],n={};return r.features?(r.features=r.features.filter(function(e){var i=e.geometry;return e!=null&&i&&i.type&&i.coordinates&&i.coordinates.length>0}),Di()(r,!0),r.features.length===0?{dataArray:[],featureKeys:n}:((0,kl.nG)(r,function(e,i){var o=By(e,a==null?void 0:a.featureId);o===null&&(o=i);var u=o,s=(0,Rl.r7)(e),l=(0,A.Z)((0,A.Z)({},e.properties),{},{coordinates:s,_id:u});t.push(l)}),{dataArray:t,featureKeys:n})):(r.features=[],{dataArray:[]})}var Zy=z(98592),zy=function(){function r(a,t,n,e){(0,R.Z)(this,r),(0,d.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=e,this.vectorTile=a}return(0,T.Z)(r,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),r}(),Uy={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Hy(r){for(var a=0,t=0,n=r.length,e=n-1,i,o;t<n;e=t++)i=r[t],o=r[e],a+=(o.x-i.x)*(i.y+o.y);return a}function jy(r){var a=r.length;if(a<=1)return[r];for(var t=[],n,e,i=0;i<a;i++){var o=Hy(r[i]);o!==0&&(e===void 0&&(e=o<0),e===o<0?(n&&t.push(n),n=[r[i]]):n.push(r[i]))}return n&&t.push(n),t}var Vy=["Unknown","Point","LineString","Polygon"];function Gy(r,a,t,n,e){var i=e.geometry,o=e.type,u=e.tags,s=e.id,l=r*Math.pow(2,n),c=r*a,f=r*t,p=Vy[o],h,g;function v(C){for(var S=0;S<C.length;S++){var M=C[S];if(M[3])break;var L=180-(M[1]+f)*360/l,D=(M[0]+c)*360/l-180,B=360/Math.PI*Math.atan(Math.exp(L*Math.PI/180))-90;C[S]=[D,B,0,1]}}switch(o){case 1:var _=[];for(h=0;h<i.length;h++)_[h]=i[h][0];i=_,v(i);break;case 2:for(h=0;h<i.length;h++)v(i[h]);break;case 3:for(i=jy(i),h=0;h<i.length;h++)for(g=0;g<i[h].length;g++)v(i[h][g]);break}i.length===1?i=i[0]:p="Multi"+p;var x={type:"Feature",geometry:{type:p,coordinates:i},properties:u,id:s,tileOrigin:[0,0],coord:""};return x}var Wy=function(){var r=(0,k.Z)(y().mark(function a(t,n,e,i){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(s){var l=n.getTile(t.z,t.x,t.y),c=l?l.features.map(function(h){return Gy(i,e.x,e.y,e.z,h)}):[],f={layers:{defaultLayer:{features:c}}},p=new zy(f,t.x,t.y,t.z);s(p)}));case 1:case"end":return u.stop()}},a)}));return function(t,n,e,i){return r.apply(this,arguments)}}();function $y(r){var a={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return r===void 0||typeof r.geojsonvtOptions=="undefined"?a:(0,A.Z)((0,A.Z)({},a),r.geojsonvtOptions)}function Xy(r,a){var t=$y(a),n=t.extent||4096,e=(0,Zy.Z)(r,t),i=function(s,l){return Wy(l,e,s,n)},o=(0,A.Z)((0,A.Z)((0,A.Z)({},Uy),a),{},{getTileData:i});return{data:r,dataArray:[],tilesetOptions:o,isTile:!0}}function wl(r,a){var t=a.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,e=new Promise(function(o){r instanceof HTMLImageElement||Th(r)?o([r]):Yy(r,function(u){o(u)})}),i={originData:r,images:e,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return i}function Yy(r,a){var t=r,n=[];if(typeof t=="string")qr({url:t},function(o,u){u&&(n.push(u),a(n))});else{var e=t.length,i=0;t.forEach(function(o){qr({url:o},function(u,s){i++,s&&n.push(s),i===e&&a(n)})})}return wl}var Ky=z(38929),Qy=z(3614),qy=z.n(Qy),Ol=function(){function r(a,t,n,e){(0,R.Z)(this,r),(0,d.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=e,this.vectorTile=new Ky.VectorTile(new(qy())(a))}return(0,T.Z)(r,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var e=[],i=0;i<n.length;i++){var o=n.feature(i),u=o.toGeoJSON(this.x,this.y,this.z);e.push((0,A.Z)((0,A.Z)({},u),{},{properties:(0,A.Z)({id:u.id},u.properties)}))}return this.vectorLayerCache[t]=e,e}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),r}(),Jy={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},e1=function(){var r=(0,k.Z)(y().mark(function a(t,n,e,i,o){var u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return u=Sn(t,n),l.abrupt("return",new Promise(function(c){if(o)o({x:e.x,y:e.y,z:e.z},function(p,h){if(p||!h)c(void 0);else{var g=new Ol(h,e.x,e.y,e.z);c(g)}});else{var f=Qr((0,A.Z)((0,A.Z)({},i),{},{url:u}),function(p,h){if(p||!h)c(void 0);else{var g=new Ol(h,e.x,e.y,e.z);c(g)}});e.xhrCancel=function(){return f.abort()}}}));case 2:case"end":return l.stop()}},a)}));return function(t,n,e,i,o){return r.apply(this,arguments)}}();function t1(r,a){var t=Array.isArray(r)?r[0]:r,n=function(o,u){return e1(t,o,u,a==null?void 0:a.requestParameters,a==null?void 0:a.getCustomData)},e=(0,A.Z)((0,A.Z)((0,A.Z)({},Jy),a),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:e,isTile:!0}}function n1(r,a,t){switch(r){case"+":return a+t;case"-":return a-t;case"*":return a*t;case"/":return a/t;case"%":return a%t;case"^":return Math.pow(a,t);case"abs":return Math.abs(a);case"floor":return Math.floor(a);case"round":return Math.round(a);case"ceil":return Math.ceil(a);case"sin":return Math.sin(a);case"cos":return Math.cos(a);case"atan":return t===-1?Math.atan(a):Math.atan2(a,t);case"min":return Math.min(a,t);case"max":return Math.max(a,t);case"log10":return Math.log(a);case"log2":return Math.log2(a);default:return console.warn("Calculate symbol err! Return default 0"),0}}function wn(r,a){for(var t=a[0],n=t.width,e=t.height,i=a.map(function(h){return h.rasterData}),o=n*e,u=[],s=JSON.stringify(r),l=0;l<o;l++){var c=JSON.parse(s),f=Dl(c,i,l);if(typeof f=="number")u.push(f);else{var p=Ii(c);u.push(p)}}return u}function Dl(r,a,t){if(r.length===2&&r[0]==="band"&&typeof r[1]=="number")try{return a[r[1]][t]}catch(n){return console.warn("Raster Data err!"),0}r.map(function(n,e){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{r[e]=a[n[1]][t]}catch(i){console.warn("Raster Data err!"),r[e]=0}break;default:Dl(n,a,t)}})}function r1(r){var a=(0,W.Z)(r,3),t=a[0],n=a[1],e=n===void 0?-1:n,i=a[2],o=i===void 0?-1:i;if(t===void 0)return console.warn("Express err!"),["+",0,0];var u=t.replace(/\s+/g,"");return[u,e,o]}function Ii(r){var a=r1(r),t=a[0],n=a[1],e=a[2];return Array.isArray(n)&&(n=Ii(r[1])),Array.isArray(e)&&(e=Ii(r[2])),n1(t,n,e)}var i1={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:a1}};function a1(r,a){for(var t=r[0].rasterData,n=r[1].rasterData,e=r[2].rasterData,i=[],o=(a==null?void 0:a.countCut)||[2,98],u=(0,W.Z)(o,2),s=u[0],l=u[1],c=(a==null?void 0:a.RMinMax)||Pi(t,s,l),f=(a==null?void 0:a.GMinMax)||Pi(n,s,l),p=(a==null?void 0:a.BMinMax)||Pi(e,s,l),h=0;h<t.length;h++)i.push(Math.max(0,t[h]-c[0])),i.push(Math.max(0,n[h]-f[0])),i.push(Math.max(0,e[h]-p[0]));return{rasterData:i,rMinMax:c,gMinMax:f,bMinMax:p}}function Pi(r,a,t){var n=r.slice().sort(function(u,s){return u-s}),e=n.length,i=n[Math.ceil(e*a/100)],o=n[Math.ceil(e*t/100)];return[i,o]}function Bi(r,a,t){return Ni.apply(this,arguments)}function Ni(){return Ni=(0,k.Z)(y().mark(function r(a,t,n){var e,i,o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a.length!==0){f.next=2;break}return f.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return f.next=4,Promise.all(a.map(function(p){var h=p.data,g=p.bands,v=g===void 0?[0]:g;return t(h,v)}));case 4:e=f.sent,i=[],e.forEach(function(p){Array.isArray(p)?i.push.apply(i,(0,G.Z)(p)):i.push(p)}),o=i[0],u=o.width,s=o.height,f.t0=(0,yn.Z)(n),f.next=f.t0==="function"?11:f.t0==="object"?13:15;break;case 11:return l=n(i),f.abrupt("break",16);case 13:return Array.isArray(n)?l={rasterData:wn(n,i)}:l=o1(n,i),f.abrupt("break",16);case 15:l={rasterData:i[0].rasterData};case 16:return f.abrupt("return",(0,A.Z)((0,A.Z)({},l),{},{width:u,height:s}));case 17:case"end":return f.stop()}},r)})),Ni.apply(this,arguments)}function o1(r,a){var t=i1[r.type];if(t.type==="function")return t.method(a,r==null?void 0:r.options);if(t.type==="operation")return r.type==="rgb"?u1(t.expression,a):{rasterData:wn(t.expression,a)}}function u1(r,a){r.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),r.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),r.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=wn(r.r||["band",0],a),n=wn(r.g||["band",0],a),e=wn(r.b||["band",0],a);return[t,n,e]}function Zi(r,a,t,n){return zi.apply(this,arguments)}function zi(){return zi=(0,k.Z)(y().mark(function r(a,t,n,e){var i;return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,Bi(a,t,n);case 2:i=u.sent,e(null,{data:i});case 4:case"end":return u.stop()}},r)})),zi.apply(this,arguments)}function s1(r,a){return r.map(function(t){return t[a]*1})}function l1(r){return r===void 0?!1:!Array.isArray(r)&&r.data!==void 0}function Rb(r){return Array.isArray(r)?r.length===0?!1:!!l1(r[0]):!1}function Il(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function c1(r,a){var t=a.extent,n=a.width,e=a.height,i=a.min,o=a.max,u=a.format,s=a.operation,l,c,f;if(u===void 0||Il(r))l=Array.from(r),c=n,f=e;else{var p=Array.isArray(r)?r:[r];l=Bi(p,u,s)}var h={_id:1,dataArray:[{_id:1,data:l,width:c,height:f,min:i,max:o,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return h}var f1=function(){var r=(0,k.Z)(y().mark(function a(t,n,e,i){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(s,l){n({x:t.x,y:t.y,z:t.z},function(c,f){if(c||f.length===0){l(c);return}f&&Zi([{data:f,bands:[0]}],e,i,function(p,h){p?l(p):h&&s(h)})})}));case 1:case"end":return u.stop()}},a)}));return function(t,n,e,i){return r.apply(this,arguments)}}(),p1=function(){var r=(0,k.Z)(y().mark(function a(t,n){return y().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(o,u){n({x:t.x,y:t.y,z:t.z},function(s,l){if(s||!l){u(s);return}l instanceof ArrayBuffer?dh(l,function(c,f){c&&u(c),o(f)}):l instanceof HTMLImageElement?o(l):u(s)})}));case 1:case"end":return i.stop()}},a)}));return function(t,n){return r.apply(this,arguments)}}();function h1(r,a){return Array.isArray(r)?typeof r[0]=="string"?r.map(function(t){return Sn(t,a)}):r.map(function(t){return{url:Sn(t.url,a),bands:t.bands||[0]}}):Sn(r,a)}function d1(r){return typeof r=="string"?[{url:r,bands:[0]}]:typeof r[0]=="string"?r.map(function(a){return{url:a,bands:[0]}}):r}function Pl(r,a){r.xhrCancel=function(){a.map(function(t){t.abort()})}}var v1=function(){var r=(0,k.Z)(y().mark(function a(t,n,e,i,o){var u,s,l,c,f,p;return y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=d1(n.url),!(u.length>1)){g.next=15;break}return g.next=4,g1(u,n);case 4:if(s=g.sent,l=s.rasterFiles,c=s.xhrList,f=s.errList,Pl(t,c),!(f.length>0)){g.next=12;break}return e(f,null),g.abrupt("return");case 12:Zi(l,i,o,e),g.next=17;break;case 15:p=Qr(n,function(v,_){if(v)e(v);else if(_){var x=[{data:_,bands:u[0].bands}];Zi(x,i,o,e)}}),Pl(t,[p]);case 17:case"end":return g.stop()}},a)}));return function(t,n,e,i,o){return r.apply(this,arguments)}}();function g1(r,a){return Ui.apply(this,arguments)}function Ui(){return Ui=(0,k.Z)(y().mark(function r(a,t){var n,e,i,o,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:n=[],e=[],i=[],o=0;case 4:if(!(o<a.length)){v.next=20;break}return u=a[o],s=(0,A.Z)((0,A.Z)({},t),{},{url:u.url}),l=u.bands,v.next=10,ph((0,A.Z)((0,A.Z)({},s),{},{type:"arrayBuffer"}));case 10:c=v.sent,f=c.err,p=c.data,h=c.xhr,f&&i.push(f),e.push(h),n.push({data:p,bands:l});case 17:o++,v.next=4;break;case 20:return v.abrupt("return",{rasterFiles:n,xhrList:e,errList:i});case 21:case"end":return v.stop()}},r)})),Ui.apply(this,arguments)}var m1=function(){var r=(0,k.Z)(y().mark(function a(t,n,e,i,o){var u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return u={url:h1(t,n)},l.abrupt("return",new Promise(function(c,f){v1(e,u,function(p,h){p?f(p):h&&c(h)},i,o)}));case 2:case"end":return l.stop()}},a)}));return function(t,n,e,i,o){return r.apply(this,arguments)}}(),Bl=function(){var r=(0,k.Z)(y().mark(function a(t,n,e,i){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return u=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(i==null?void 0:i.getURLFromTemplate)||xd,o=s(u,(0,A.Z)((0,A.Z)({},n),i.wmtsOptions))):(l=(i==null?void 0:i.getURLFromTemplate)||Sn,o=l(u,n)),f.abrupt("return",new Promise(function(p,h){var g,v=qr({url:o,type:(i==null||(g=i.requestParameters)===null||g===void 0?void 0:g.type)||"arrayBuffer"},function(_,x){_?h(_):x&&p(x)},i.transformResponse);e.xhrCancel=function(){return v.abort()}}));case 3:case"end":return f.stop()}},a)}));return function(t,n,e,i){return r.apply(this,arguments)}}(),Nl=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},y1={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},kb=[xe.ARRAYBUFFER,xe.RGB];function _1(r){return!!(Array.isArray(r)&&r.length===0||!Array.isArray(r)&&typeof r!="string")}function E1(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(_1(r))throw new Error("tile server url is error");var t=(a==null?void 0:a.dataType)||xe.IMAGE;t===xe.RGB&&(t=xe.ARRAYBUFFER);var n=function(o,u){switch(t){case xe.IMAGE:return Bl(r,o,u,a);case xe.CUSTOMIMAGE:case xe.CUSTOMTERRAINRGB:return p1(u,a==null?void 0:a.getCustomData);case xe.ARRAYBUFFER:return m1(r,o,u,(a==null?void 0:a.format)||Nl,a==null?void 0:a.operation);case xe.CUSTOMARRAYBUFFER:case xe.CUSTOMRGB:return f1(u,a==null?void 0:a.getCustomData,(a==null?void 0:a.format)||Nl,a==null?void 0:a.operation);default:return Bl(r,o,u,a)}},e=(0,A.Z)((0,A.Z)((0,A.Z)({},y1),a),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:e,isTile:!0}}var x1=["extent","min","max","width","height","format","operation"];function C1(r,a){var t=a.extent,n=a.min,e=a.max,i=a.width,o=a.height,u=a.format,s=a.operation,l=(0,Re.Z)(a,x1),c;if(u===void 0||Il(r))c=Array.from(r);else{var f=Array.isArray(r)?r:[r];c=Bi(f,u,s)}var p={_id:1,dataArray:[(0,A.Z)((0,A.Z)({_id:1,data:c,width:i,height:o},l),{},{min:n,max:e,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return p}var S1={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},b1=function(){var r=(0,k.Z)(y().mark(function a(t){return y().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(i){var o=(0,W.Z)(t.bounds,4),u=o[0],s=o[1],l=o[2],c=o[3],f={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(u+l)/2,textLat:(s+c)/2},geometry:{type:"LineString",coordinates:[[l,c],[l,s],[u,s],[u,s]]}}]}}};i(f)}));case 1:case"end":return e.stop()}},a)}));return function(t){return r.apply(this,arguments)}}();function A1(r,a){var t=function(i){return b1(i)},n=(0,A.Z)((0,A.Z)((0,A.Z)({},S1),a),{},{getTileData:t});return{data:r,dataArray:[],tilesetOptions:n,isTile:!0}}function Zl(r,a){var t=a.radius,n=t===void 0?40:t,e=a.maxZoom,i=e===void 0?18:e,o=a.minZoom,u=o===void 0?0:o,s=a.zoom,l=s===void 0?2:s;if(r.pointIndex){var c=r.pointIndex.getClusters(r.extent,Math.floor(l));return r.dataArray=T1(c),r}var f=new(El())({radius:n,minZoom:u,maxZoom:i}),p={type:"FeatureCollection",features:[]};return p.features=r.dataArray.map(function(h){return{type:"Feature",geometry:{type:"Point",coordinates:h.coordinates},properties:(0,A.Z)({},h)}}),f.load(p.features),f}function T1(r){return r.map(function(a,t){return(0,A.Z)({coordinates:a.geometry.coordinates,_id:t+1},a.properties)})}function M1(r){if(r.length===0)throw new Error("max requires at least one data point");for(var a=r[0],t=1;t<r.length;t++)r[t]>a&&(a=r[t]);return a}function L1(r){if(r.length===0)throw new Error("min requires at least one data point");for(var a=r[0],t=1;t<r.length;t++)r[t]<a&&(a=r[t]);return a}function zl(r){if(r.length===0)return 0;for(var a=r[0],t=0,n,e=1;e<r.length;e++)n=a+r[e]*1,Math.abs(a)>=Math.abs(r[e])?t+=a-n+r[e]:t+=r[e]-n+a,a=n;return a+t*1}function R1(r){if(r.length===0)throw new Error("mean requires at least one data point");return zl(r)/r.length}var k1={min:L1,max:M1,mean:R1,sum:zl};function F1(r){var a=w1();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function w1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}function O1(r,a){if(Array.isArray(a))return a}var D1=function(r){(0,F.Z)(t,r);var a=F1(t);function t(n,e){var i;return(0,R.Z)(this,t),i=a.call(this),(0,d.Z)((0,E.Z)(i),"type","source"),(0,d.Z)((0,E.Z)(i),"isTile",!1),(0,d.Z)((0,E.Z)(i),"inited",!1),(0,d.Z)((0,E.Z)(i),"hooks",{init:new ke.ni}),(0,d.Z)((0,E.Z)(i),"parser",{type:"geojson"}),(0,d.Z)((0,E.Z)(i),"transforms",[]),(0,d.Z)((0,E.Z)(i),"cluster",!1),(0,d.Z)((0,E.Z)(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,d.Z)((0,E.Z)(i),"invalidExtent",!1),(0,d.Z)((0,E.Z)(i),"dataArrayChanged",!1),(0,d.Z)((0,E.Z)(i),"cfg",{autoRender:!0}),i.originData=n,i.initCfg(e),i.init().then(function(){i.inited=!0,i.emit("update",{type:"inited"})}),i}return(0,T.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var i=this,o=this.clusterOptions,u=o.method,s=u===void 0?"sum":u,l=o.field,c=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,c.forEach(function(f){f.id||(f.properties.point_count=1)}),(l||(0,N.isFunction)(s))&&(c=c.map(function(f){var p=f.id;if(p){var h=i.clusterIndex.getLeaves(p,Infinity),g=h.map(function(x){return x.properties}),v;if((0,N.isString)(s)&&l){var _=s1(g,l);v=k1[s](_)}(0,N.isFunction)(s)&&(v=s(g)),f.properties.stat=v}else f.properties.point_count=1;return f})),this.data=Ll("geojson")({type:"FeatureCollection",features:c}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var i=this.parser,o=i.type,u=o===void 0?"geojson":o,s=i.geometry;if(u==="geojson"&&!this.cluster){var l=e<this.originData.features.length?this.originData.features[e]:"null",c=(0,N.cloneDeep)(l);if(c!=null&&c.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var f=this.data.dataArray.find(function(p){return p._id===e});c.properties=f}return c}else return u==="json"&&s?this.data.dataArray.find(function(p){return p._id===e}):e<this.data.dataArray.length?this.data.dataArray[e]:"null"}},{key:"updateFeaturePropertiesById",value:function(e,i){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===e?(0,A.Z)((0,A.Z)({},o),i):o}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,i){var o=this.data.dataArray.find(function(u){return u[e]===i});return o==null?void 0:o._id}},{key:"setData",value:function(e,i){var o=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(i),this.init().then(function(){o.emit("update",{type:"update"})})}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)===null||e===void 0||e.destroy()}},{key:"processData",value:function(){var n=(0,k.Z)(y().mark(function i(){var o=this;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",new Promise(function(l,c){try{o.excuteParser(),o.initCluster(),o.executeTrans(),l({})}catch(f){c(f)}}));case 1:case"end":return s.stop()}},i)}));function e(){return n.apply(this,arguments)}return e}()},{key:"initCfg",value:function(e){this.cfg=(0,N.mergeWith)(this.cfg,e,O1);var i=this.cfg;i&&(i.parser&&(this.parser=i.parser),i.transforms&&(this.transforms=i.transforms),this.cluster=i.cluster||!1,i.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,A.Z)((0,A.Z)({},this.clusterOptions),i.clusterOptions)))}},{key:"init",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.inited=!1,u.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"excuteParser",value:function(){var e=this.parser,i=e.type||"geojson",o=Ll(i);this.data=o(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=wh(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(!!e){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(e),this.tileset;var i=new _d((0,A.Z)({},e));return i}}},{key:"executeTrans",value:function(){var e=this,i=this.transforms;i.forEach(function(o){var u=o.type,s=wy(u)(e.data,o);Object.assign(e.data,s)})}},{key:"initCluster",value:function(){if(!!this.cluster){var e=this.clusterOptions||{};this.clusterIndex=Zl(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var i=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(i=xn(nr(this.extent),e)),i[0].concat(i[1])}}]),t}(pe.EventEmitter);function I1(r,a){var t=a.callback;return t&&(r.dataArray=r.dataArray.filter(t)),r}function Ul(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=P1(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function P1(r,a){if(!!r){if(typeof r=="string")return Hl(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hl(r,a)}}function Hl(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var Hi=6378e3;function B1(r,a){var t=r.dataArray,n=a.size,e=n===void 0?10:n,i=e/(2*Math.PI*Hi)*(256<<20)/2,o=N1(t,e),u=o.gridHash,s=o.gridOffset,l=H1(u,s,a);return{yOffset:i,xOffset:i,radius:i,type:"grid",dataArray:l}}function N1(r,a){var t=Infinity,n=-Infinity,e,i=Ul(r),o;try{for(i.s();!(o=i.n()).done;){var u=o.value;e=u.coordinates[1],Number.isFinite(e)&&(t=e<t?e:t,n=e>n?e:n)}}catch(S){i.e(S)}finally{i.f()}var s=(t+n)/2,l=Z1(a,s);if(l.xOffset<=0||l.yOffset<=0)return{gridHash:{},gridOffset:l};var c={},f=Ul(r),p;try{for(f.s();!(p=f.n()).done;){var h=p.value,g=h.coordinates[1],v=h.coordinates[0];if(Number.isFinite(g)&&Number.isFinite(v)){var _=Math.floor((g+90)/l.yOffset),x=Math.floor((v+180)/l.xOffset),C="".concat(_,"-").concat(x);c[C]=c[C]||{count:0,points:[]},c[C].count+=1,c[C].points.push(h)}}}catch(S){f.e(S)}finally{f.f()}return{gridHash:c,gridOffset:l}}function Z1(r,a){var t=z1(r),n=U1(a,r);return{yOffset:t,xOffset:n}}function z1(r){return r/Hi*(180/Math.PI)}function U1(r,a){return a/Hi*(180/Math.PI)/Math.cos(r*Math.PI/180)}function H1(r,a,t){return Object.keys(r).reduce(function(n,e,i){var o=e.split("-"),u=parseInt(o[0],10),s=parseInt(o[1],10),l={};if(t.field&&t.method){var c=ci(r[e].points,t.field);l[t.method]=li[t.method](c)}return Object.assign(l,{_id:i,coordinates:be([-180+a.xOffset*(s+.5),-90+a.yOffset*(u+.5)]),rawData:r[e].points,count:r[e].count}),n.push(l),n},[])}var j1=z(43774),V1=6378e3;function G1(r,a){var t=r.dataArray,n=a.size,e=n===void 0?10:n,i=a.method,o=i===void 0?"sum":i,u=e/(2*Math.PI*V1)*(256<<20)/2,s=t.map(function(p){var h=be(p.coordinates),g=(0,W.Z)(h,2),v=g[0],_=g[1];return(0,A.Z)((0,A.Z)({},p),{},{coordinates:[v,_]})}),l=(0,j1.g)().radius(u).x(function(p){return p.coordinates[0]}).y(function(p){return p.coordinates[1]}),c=l(s),f={dataArray:c.map(function(p,h){var g;if(a.field&&o){var v=ci(p,a.field);p[o]=li[o](v)}return g={},(0,d.Z)(g,a.method,p[o]),(0,d.Z)(g,"count",p.length),(0,d.Z)(g,"rawData",p),(0,d.Z)(g,"coordinates",[p.x,p.y]),(0,d.Z)(g,"_id",h),g}),radius:u,xOffset:u,yOffset:u,type:"hexagon"};return f}function W1(r,a){var t=a.sourceField,n=a.targetField,e=a.data,i={};return e.forEach(function(o){i[o[t]]=o}),r.dataArray=r.dataArray.map(function(o){var u=o[n];return(0,A.Z)((0,A.Z)({},o),i[u])}),r}function $1(r,a){var t=a.callback;return t&&(r.dataArray=r.dataArray.map(t)),r}rt("rasterTile",E1),rt("mvt",t1),rt("geojsonvt",Xy),rt("testTile",A1),rt("geojson",Ny),rt("image",wl),rt("csv",Iy),rt("json",Fl),rt("raster",c1),rt("rasterRgb",C1),Jt("cluster",Zl),Jt("filter",I1),Jt("join",W1),Jt("map",$1),Jt("grid",B1),Jt("hexagon",G1);var On=D1,At,ji=(At={},(0,d.Z)(At,tt.additive,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE,srcAlpha:1,dstAlpha:1}}),(0,d.Z)(At,tt.none,{enable:!1}),(0,d.Z)(At,tt.normal,{enable:!0,func:{srcRGB:m.SRC_ALPHA,dstRGB:m.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,d.Z)(At,tt.subtractive,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE,srcAlpha:m.ZERO,dstAlpha:m.ONE_MINUS_SRC_COLOR},equation:{rgb:m.FUNC_SUBTRACT,alpha:m.FUNC_SUBTRACT}}),(0,d.Z)(At,tt.max,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE},equation:{rgb:m.MAX_EXT}}),(0,d.Z)(At,tt.min,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE},equation:{rgb:m.MIN_EXT}}),At);function Ue(r,a,t,n,e){a.updateStyleAttribute(r,t,n,e)}function X1(r,a){a.tileLayer||a.isTileLayer||(r.opacity&&dr("opacity",a,r.opacity),r.strokeWidth&&dr("strokeWidth",a,r.strokeWidth),r.strokeOpacity&&dr("strokeOpacity",a,r.strokeOpacity),r.stroke&&Y1("stroke",a,r.stroke),r.offsets&&jl("offsets",a,r.offsets),r.textOffset&&jl("textOffset",a,r.textOffset),r.thetaOffset&&dr("thetaOffset",a,r.thetaOffset))}function dr(r,a,t){(0,N.isString)(t)?Ue(r,a,t,function(n){return n}):(0,N.isNumber)(t)||(Array.isArray(t)&&t.length===2?(0,N.isString)(t[0])&&(0,N.isFunction)(t[1])||(0,N.isString)(t[0])&&Array.isArray(t[1])&&(0,N.isNumber)(t[1][0])&&(0,N.isNumber)(t[1][1])?Ue(r,a,t[0],t[1]):Ue(r,a,[1],void 0):Ue(r,a,[1],void 0))}function jl(r,a,t){(0,N.isString)(t)?Ue(r,a,t,function(n){return n}):Array.isArray(t)&&t.length===2&&(0,N.isString)(t[0])&&(0,N.isFunction)(t[1])?Ue(r,a,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,N.isNumber)(t[0])&&(0,N.isNumber)(t[1])?Ue(r,a,t,void 0):Ue(r,a,[0,0],void 0)}function Y1(r,a,t){(0,N.isString)(t)||(Array.isArray(t)&&t.length===2&&((0,N.isString)(t[0])&&(0,N.isFunction)(t[1])||(0,N.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?Ue(r,a,t[0],t[1]):Ue(r,a,"#fff",void 0))}var Fe=function(r){return r["GAODE1.x"]="GAODE1.x",r["GAODE2.x"]="GAODE2.x",r.MAPBOX="MAPBOX",r.DEFUALT="DEFUALTMAP",r.SIMPLE="SIMPLE",r.GLOBEL="GLOBEL",r}({});function K1(r,a){var t=[a[0]-r[0],a[1]-r[1]],n=fo(t),e=[r[0]+n[0]*1e-4,r[1]+n[1]*1e-4];return e}function Q1(r,a,t){if(r.length>0&&a.version===Fe["GAODE2.x"]){var n=t.coordCenter;typeof r[0].coordinates[0]=="number"?r.filter(function(e){return!e.originCoordinates}).map(function(e){e.version=Fe["GAODE2.x"],e.originCoordinates=(0,N.cloneDeep)(e.coordinates),e.coordinates=a.lngLatToCoordByLayer(e.coordinates,n)}):r.filter(function(e){return!e.originCoordinates}).map(function(e){e.version=Fe["GAODE2.x"],e.originCoordinates=(0,N.cloneDeep)(e.coordinates),e.coordinates=a.lngLatToCoordsByLayer(e.coordinates,n)})}}function q1(r,a){r.length>0&&a.version===Fe.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=J1(t.coordinates,a),t.simpleCoordinate=!0)})}function J1(r,a){if(typeof r[0]=="number")return a.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(e){var i=[];e.map(function(o){i.push(a.simpleMapCoord.unproject(o))}),t.push(i)}),t}else{var n=[];return r.map(function(e){n.push(a.simpleMapCoord.unproject(e))}),n}}function e_(r,a){var t;if(!r.scale)return[];var n=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],e=[];n.forEach(function(o){var u,s=o.field;(a.hasOwnProperty(s)||((u=r.scale)===null||u===void 0?void 0:u.type)==="variable")&&e.push(a[s])});var i=r.mapping?r.mapping(e):[];return i}function t_(r,a,t,n,e){var i=e==null?void 0:e.getLayerConfig(),o=i.arrow,u=o===void 0?{enable:!1}:o,s=a.map(function(l){var c={id:l._id,coordinates:l.coordinates};if(r.filter(function(h){return h.scale!==void 0}).forEach(function(h){var g=e_(h,l);h.needRemapping=!1,h.name==="color"&&(g=g.map(function(v){return ue(v)})),c[h.name]=Array.isArray(g)&&g.length===1?g[0]:g,h.name==="shape"&&(c.shape=t.getIconFontKey(c[h.name]))}),c.shape==="line"&&u.enable){var f=c.coordinates,p=K1(f[0],f[1]);c.coordinates.splice(1,0,p,p)}return c});return Q1(s,n,e),q1(s,n),s}function n_(r,a,t,n,e,i){var o=new On(e,i),u=n.getLayerStyleAttributes()||[],s=o.data.dataArray,l=s,c=t_(u,l,a,t,r);return o.destroy(),c}function Vl(r){return r.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function Gl(r,a,t,n){var e=r.multiPassRenderer,i=r.getLayerConfig(),o=i.enableTAA;return o?e.add(n("taa")):e.add(n("render")),Vl(a).forEach(function(u){var s=(0,W.Z)(u,2),l=s[0],c=s[1];e.add(t(l),c)}),e.add(t("copy")),e}var r_=function(){function r(a){(0,R.Z)(this,r),this.layer=a}return(0,T.Z)(r,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),e=n.get(w.ILayerService),i=this.layer;if(i.tileLayer)return i.tileLayer.pickRender(t);i.hooks.beforePickingEncode.call(),e.renderTileLayerMask(i),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var e=this.layer.getContainer(),i=e.get(w.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),i.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,e){var i=this.layer.getContainer(),o=i.get(w.IPickingService),u=i.get(w.IMapService),s=this.layer.getSource().extent,l=Fh(n.lngLat,s),c={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},f=e||t;if(l){var p=this.readRasterValue(t,s,u,n.x,n.y);return c.rasterValue=p,o.triggerHoverOnLayer(f,c),!0}else return c.type=n.type==="mousemove"?"mouseout":"un"+n.type,o.triggerHoverOnLayer(f,(0,A.Z)((0,A.Z)({},c),{},{type:"unpick"})),o.triggerHoverOnLayer(f,c),!1}},{key:"readRasterValue",value:function(t,n,e,i,o){var u=t.getSource().data.dataArray[0],s=(0,W.Z)(n,4),l=s[0],c=l===void 0?0:l,f=s[1],p=f===void 0?0:f,h=s[2],g=h===void 0?10:h,v=s[3],_=v===void 0?-10:v,x=e.lngLatToContainer([c,p]),C=e.lngLatToContainer([g,_]),S=C.x-x.x,M=x.y-C.y,L=[(i-x.x)/S,(o-C.y)/M],D=u.width||1,B=u.height||1,I=Math.floor(L[0]*D),P=Math.floor(L[1]*B),U=Math.max(0,P-1)*D+I,V=u.data[U];return V}},{key:"selectFeature",value:function(t){var n=this.layer,e=(0,W.Z)(t,3),i=e[0],o=e[1],u=e[2];n.hooks.beforeSelect.call([i,o,u])}},{key:"highlightPickedFeature",value:function(t){var n=(0,W.Z)(t,3),e=n[0],i=n[1],o=n[2];this.layer.hooks.beforeHighlight.call([e,i,o])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),r}(),i_=function(){function r(a){(0,R.Z)(this,r),this.layer=a;var t=this.layer.getContainer();this.rendererService=t.get(w.IRendererService)}return(0,T.Z)(r,[{key:"getColorTexture",value:function(t,n){var e=this.getTextureKey(t,n);return this.key===e?this.colorTexture:(this.createColorTexture(t,n),this.key=e,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var e=this.rendererService.createTexture2D,i=this.getColorRampBar(t,n),o=e({data:new Uint8Array(i.data),width:i.width,height:i.height,flipY:!1});return this.colorTexture=o,o}},{key:"setColorTexture",value:function(t,n,e){this.key=this.getTextureKey(n,e),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return gh(t);case"quantize":return mh(t);case"custom":return yh(t,n);case"linear":return vh(t,n);default:return Ja(t)}}},{key:"getTextureKey",value:function(t,n){var e;return"".concat(t.colors.join("_"),"_").concat(t==null||(e=t.positions)===null||e===void 0?void 0:e.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),r}(),a_=["passes"],o_=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],Wl,Vi,$l;function u_(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=s_(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function s_(r,a){if(!!r){if(typeof r=="string")return Xl(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xl(r,a)}}function Xl(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function l_(r){var a=c_();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function c_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Yl=0,en=(Wl=ki(w.IGlobalConfigService),Vi=function(r){(0,F.Z)(t,r);var a=l_(t);function t(){var n,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,R.Z)(this,t),n=a.call(this),(0,d.Z)((0,E.Z)(n),"id","".concat(Yl++)),(0,d.Z)((0,E.Z)(n),"name","".concat(Yl)),(0,d.Z)((0,E.Z)(n),"visible",!0),(0,d.Z)((0,E.Z)(n),"zIndex",0),(0,d.Z)((0,E.Z)(n),"inited",!1),(0,d.Z)((0,E.Z)(n),"layerModelNeedUpdate",!1),(0,d.Z)((0,E.Z)(n),"pickedFeatureID",null),(0,d.Z)((0,E.Z)(n),"selectedFeatureID",null),(0,d.Z)((0,E.Z)(n),"styleNeedUpdate",!1),(0,d.Z)((0,E.Z)(n),"forceRender",!1),(0,d.Z)((0,E.Z)(n),"clusterZoom",0),(0,d.Z)((0,E.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,d.Z)((0,E.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,d.Z)((0,E.Z)(n),"hooks",{init:new ke.S$,afterInit:new ke.oI,beforeRender:new ke.oI,beforeRenderData:new ke.bf,afterRender:new ke.ni,beforePickingEncode:new ke.ni,afterPickingEncode:new ke.ni,beforeHighlight:new ke.ni(["pickedColor"]),afterHighlight:new ke.ni,beforeSelect:new ke.ni(["pickedColor"]),afterSelect:new ke.ni,beforeDestroy:new ke.ni,afterDestroy:new ke.ni}),(0,d.Z)((0,E.Z)(n),"models",[]),(0,d.Z)((0,E.Z)(n),"startInit",!1),(0,d.Z)((0,E.Z)(n),"layerChildren",[]),(0,d.Z)((0,E.Z)(n),"masks",[]),(0,J.Z)((0,E.Z)(n),"configService",$l,(0,E.Z)(n)),(0,d.Z)((0,E.Z)(n),"animateOptions",{enable:!1}),(0,d.Z)((0,E.Z)(n),"currentPickId",null),(0,d.Z)((0,E.Z)(n),"pendingStyleAttributes",[]),(0,d.Z)((0,E.Z)(n),"scaleOptions",{}),(0,d.Z)((0,E.Z)(n),"animateStatus",!1),(0,d.Z)((0,E.Z)(n),"isDestroyed",!1),(0,d.Z)((0,E.Z)(n),"encodeDataLength",0),(0,d.Z)((0,E.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var i=n.getLayerConfig();i&&i.autoFit&&n.fitBounds(i.fitBoundsOptions);var o=n.layerSource.getSourceCfg().autoRender;o&&n.reRender()}),n.name=e.name||n.id,n.zIndex=e.zIndex||0,n.rawConfig=e,n}return(0,T.Z)(t,[{key:"addMask",value:function(e){this.masks.push(e),this.enableMask()}},{key:"removeMask",value:function(e){var i=this.masks.indexOf(e);i>-1&&this.masks.splice(i,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var i=this.masks.indexOf(e);i>-1&&this.masks.splice(i,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var i=this;if(Object.keys(e).map(function(u){u in i.rawConfig&&(i.rawConfig[u]=e[u])}),!this.startInit)this.needUpdateConfig=(0,A.Z)((0,A.Z)({},this.needUpdateConfig),e);else{var o=this.container.get(w.SceneID);X1(e,this),this.configService.setLayerConfig(o,this.id,(0,A.Z)((0,A.Z)((0,A.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(e,i){this.container=e,this.sceneContainer=i}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var n=(0,k.Z)(y().mark(function i(){var o=this,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:u=this.container.get(w.SceneID),this.startInit=!0,this.configService.setLayerConfig(u,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(w.IIconService),this.fontService=this.container.get(w.IFontService),this.rendererService=this.container.get(w.IRendererService),this.layerService=this.container.get(w.ILayerService),this.debugService=this.container.get(w.IDebugService),this.interactionService=this.container.get(w.IInteractionService),this.pickingService=this.container.get(w.IPickingService),this.mapService=this.container.get(w.IMapService),s=this.getLayerConfig(),l=s.enableMultiPassRenderer,c=s.passes,l&&c!==null&&c!==void 0&&c.length&&c.length>0&&this.mapService.on("mapAfterFrameChange",function(){o.renderLayers()}),this.cameraService=this.container.get(w.ICameraService),this.coordinateService=this.container.get(w.ICoordinateSystemService),this.shaderModuleService=this.container.get(w.IShaderModuleService),this.postProcessingPassFactory=this.container.get(w.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(w.IFactoryNormalPass),this.styleAttributeService=this.container.get(w.IStyleAttributeService),l&&(this.multiPassRenderer=this.container.get(w.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(_){var x=_.attributeName,C=_.attributeField,S=_.attributeValues,M=_.updateOptions;o.styleAttributeService.updateStyleAttribute(x,{scale:(0,A.Z)({field:C},o.splitValuesAndCallbackInAttribute(S,o.getLayerConfig()[x]))},M)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(w.ILayerPlugin),f=u_(this.plugins);try{for(f.s();!(p=f.n()).done;)h=p.value,h.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(_){f.e(_)}finally{f.f()}return this.layerPickService=new r_(this),this.textureService=new i_(this),this.log(me.LayerInitStart),v.next=31,this.hooks.init.promise();case 31:this.log(me.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return v.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"log",value:function(e){var i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var u="".concat(this.id,".").concat(o,".").concat(e),s={id:this.id,type:this.type};(i=this.debugService)===null||i===void 0||i.log(u,s)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map(function(i){i.updateAttributesAndElements(e.attributes,e.elements)}):console.warn("data error")}},{key:"createModelData",value:function(e,i){var o;if((o=this.layerModel)!==null&&o!==void 0&&o.createModelData)return this.layerModel.createModelData(i);var u=this.calculateEncodeData(e,i),s=this.triangulation;return u&&s?this.styleAttributeService.createAttributesAndIndices(u,s):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"calculateEncodeData",value:function(e,i){return this.inited?n_(this,this.fontService,this.mapService,this.styleAttributeService,e,i):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.updateLayerConfig((0,A.Z)((0,A.Z)((0,A.Z)({},this.getDefaultConfig()),this.rawConfig),this.needUpdateConfig));var e=this.getLayerConfig(),i=e.animateOption;i!=null&&i.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,i,o){return this.updateStyleAttribute("color",e,i,o),this}},{key:"texture",value:function(e,i,o){return this.updateStyleAttribute("texture",e,i,o),this}},{key:"rotate",value:function(e,i,o){return this.updateStyleAttribute("rotate",e,i,o),this}},{key:"size",value:function(e,i,o){return this.updateStyleAttribute("size",e,i,o),this}},{key:"filter",value:function(e,i,o){var u=this.updateStyleAttribute("filter",e,i,o);return this.dataState.dataSourceNeedUpdate=u&&this.inited,this}},{key:"shape",value:function(e,i,o){this.shapeOption={field:e,values:i};var u=this.updateStyleAttribute("shape",e,i,o);return this.dataState.dataSourceNeedUpdate=u&&this.inited,this}},{key:"label",value:function(e,i,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:i,updateOptions:o}),this}},{key:"animate",value:function(e){var i={};return(0,N.isObject)(e)?(i.enable=!0,i=(0,A.Z)((0,A.Z)({},i),e)):i.enable=e,this.updateLayerConfig({animateOption:i}),this}},{key:"source",value:function(e,i){return(e==null?void 0:e.type)==="source"?(this.setSource(e),this):(this.sourceOption={data:e,options:i},this.clusterZoom=0,this)}},{key:"setData",value:function(e,i){var o=this;return this.inited?(this.log(me.SourceInitStart,ge.UPDATE),this.layerSource.setData(e,i),this.log(me.SourceInitEnd,ge.UPDATE)):this.on("inited",function(){o.log(me.SourceInitStart,ge.UPDATE);var u=o.getSource();u?o.layerSource.setData(e,i):o.source(new On(e,i)),o.layerSource.once("update",function(){o.log(me.SourceInitEnd,ge.UPDATE)})}),this}},{key:"style",value:function(e){var i=this,o=e.passes,u=(0,Re.Z)(e,a_);return o&&Vl(o).forEach(function(s){var l=i.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(s[0]);l&&l.updateOptions(s[1])}),this.rawConfig=(0,A.Z)((0,A.Z)({},this.rawConfig),u),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(e,i){var o=(0,A.Z)({},this.scaleOptions);if((0,N.isObject)(e)?this.scaleOptions=(0,A.Z)((0,A.Z)({},this.scaleOptions),e):this.scaleOptions[e]=i,this.styleAttributeService&&!(0,N.isEqual)(o,this.scaleOptions)){var u=(0,N.isObject)(e)?e:(0,d.Z)({},e,i);this.styleAttributeService.updateScaleAttribute(u)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(e),this))}},{key:"renderMultiPass",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){u.next=2;break}return u.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){u.next=7;break}return u.next=5,this.multiPassRenderer.render();case 5:u.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"active",value:function(e){var i={};return i.enableHighlight=(0,N.isObject)(e)?!0:e,(0,N.isObject)(e)?(i.enableHighlight=!0,e.color&&(i.highlightColor=e.color),e.mix&&(i.activeMix=e.mix)):i.enableHighlight=!!e,this.updateLayerConfig(i),this}},{key:"setActive",value:function(e,i){var o=this;if((0,N.isObject)(e)){var u=e.x,s=u===void 0?0:u,l=e.y,c=l===void 0?0:l;this.updateLayerConfig({highlightColor:(0,N.isObject)(i)?i.color:this.getLayerConfig().highlightColor,activeMix:(0,N.isObject)(i)?i.mix:this.getLayerConfig().activeMix}),this.pick({x:s,y:c})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:(0,N.isObject)(i)?i.color:this.getLayerConfig().highlightColor,activeMix:(0,N.isObject)(i)?i.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(st(e)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(e){var i={};return i.enableSelect=(0,N.isObject)(e)?!0:e,(0,N.isObject)(e)?(i.enableSelect=!0,e.color&&(i.selectColor=e.color),e.mix&&(i.selectMix=e.mix)):i.enableSelect=!!e,this.updateLayerConfig(i),this}},{key:"setSelect",value:function(e,i){var o=this;if((0,N.isObject)(e)){var u=e.x,s=u===void 0?0:u,l=e.y,c=l===void 0?0:l;this.updateLayerConfig({selectColor:(0,N.isObject)(i)?i.color:this.getLayerConfig().selectColor,selectMix:(0,N.isObject)(i)?i.mix:this.getLayerConfig().selectMix}),this.pick({x:s,y:c})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:(0,N.isObject)(i)?i.color:this.getLayerConfig().selectColor,selectMix:(0,N.isObject)(i)?i.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(st(e)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),i=this.getLayerConfig(),o=i.visible,u=i.minZoom,s=u===void 0?-Infinity:u,l=i.maxZoom,c=l===void 0?Infinity:l;return!!o&&e>=s&&e<c}},{key:"setMultiPass",value:function(e,i){if(this.updateLayerConfig({enableMultiPassRenderer:e}),i&&this.updateLayerConfig({passes:i}),e){var o=this.getLayerConfig(),u=o.passes,s=u===void 0?[]:u;this.multiPassRenderer=Gl(this,s,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var l=this.rendererService.getViewportSize(),c=l.width,f=l.height;this.multiPassRenderer.resize(c,f)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){var e=this.getLayerConfig(),i=e.minZoom;return i}},{key:"getMaxZoom",value:function(){var e=this.getLayerConfig(),i=e.maxZoom;return i}},{key:"get",value:function(e){var i=this.getLayerConfig();return i[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var i=this.getSource(),o=i.extent,u=o.some(function(s){return Math.abs(s)===Infinity});return u?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],e),this)}},{key:"destroy",value:function(){var e,i,o,u,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){this.layerChildren.map(function(f){return f.destroy(!1)}),this.layerChildren=[];var l=this.getLayerConfig(),c=l.maskfence;c&&(this.masks.map(function(f){return f.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(e=this.multiPassRenderer)===null||e===void 0||e.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(i=this.layerModel)===null||i===void 0||i.clearModels(s),(o=this.tileLayer)===null||o===void 0||o.destroy(),this.models=[],(u=this.debugService)===null||u===void 0||u.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach(function(i){return i.destroy()}),(e=this.layerModel)===null||e===void 0||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices}).length}},{key:"setSource",value:function(e){var i=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var o=this.mapService.getZoom();this.layerSource.updateClusterData(o)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(u){var s=u.type;if(i.coordCenter===void 0){var l,c=i.layerSource.center;i.coordCenter=c,(l=i.mapService)!==null&&l!==void 0&&l.setCoordCenter&&i.mapService.setCoordCenter(c)}if(s==="update"){if(i.tileLayer){i.tileLayer.reload();return}i.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var i,o,u,s=this.styleAttributeService.getLayerStyleAttribute(e),l=(s==null||(i=s.scale)===null||i===void 0?void 0:i.scalers)||[];return{type:(o=l[0].option)===null||o===void 0?void 0:o.type,field:s==null||(u=s.scale)===null||u===void 0?void 0:u.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var i=this.styleAttributeService.getLayerAttributeScale(e);if(!i)return[];if(i.invertExtent){var o=i.range().map(function(l){return(0,d.Z)({value:i.invertExtent(l)},e,l)});return o}else if(i.ticks){var u=i.ticks().map(function(l){return(0,d.Z)({value:l},e,i(l))});return u}else if(i!=null&&i.domain){var s=i.domain().filter(function(l){return!(0,N.isUndefined)(l)}).map(function(l){return(0,d.Z)({value:l},e,i(l))});return s}return[]}},{key:"pick",value:function(e){var i=e.x,o=e.y;this.interactionService.triggerHover({x:i,y:o})}},{key:"boxSelect",value:function(e,i){this.pickingService.boxPickLayer(this,e,i)}},{key:"buildLayerModel",value:function(){var n=(0,k.Z)(y().mark(function i(o){var u=this,s,l,c,f,p,h,g,v,_,x,C,S,M,L;return y().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return s=o.moduleName,l=o.vertexShader,c=o.fragmentShader,f=o.triangulation,p=o.segmentNumber,h=o.workerEnabled,g=h===void 0?!1:h,v=o.workerOptions,_=(0,Re.Z)(o,o_),this.shaderModuleService.registerModule(s,{vs:l,fs:c}),x=this.shaderModuleService.getModule(s),C=x.vs,S=x.fs,M=x.uniforms,L=this.rendererService.createModel,B.abrupt("return",new Promise(function(I,P){if(v&&v.modelType in Ro&&g)u.styleAttributeService.createAttributesAndIndicesAscy(u.encodedData,p,v).then(function(fe){var Ce=fe.attributes,Se=fe.elements,nt=L((0,A.Z)({attributes:Ce,uniforms:M,fs:S,vs:C,elements:Se,blend:ji[tt.normal]},_));I(nt)}).catch(function(fe){return P(fe)});else{var U=u.styleAttributeService.createAttributesAndIndices(u.encodedData,f,p),V=U.attributes,K=U.elements,Q=U.count,te=(0,A.Z)({attributes:V,uniforms:M,fs:S,vs:C,elements:K,blend:ji[tt.normal]},_);Q&&(te.count=Q);var ce=L(te);I(ce)}}));case 5:case"end":return B.stop()}},i,this)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"createAttributes",value:function(e){var i=e.triangulation,o=this.styleAttributeService.createAttributes(this.encodedData,i),u=o.attributes;return u}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var i=this.getLayerConfig(),o=i.enableHighlight,u=o===void 0?!0:o,s=i.enableSelect,l=s===void 0?!0:s,c=this.eventNames().indexOf(e)!==-1||this.eventNames().indexOf("un"+e)!==-1;return(e==="click"||e==="dblclick")&&l&&(c=!0),e==="mousemove"&&(u||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(c=!0),this.isVisible()&&c}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return u.stop()}},i)}));function e(){return n.apply(this,arguments)}return e}()},{key:"rebuildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.buildModels();case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"renderMulPass",value:function(){var n=(0,k.Z)(y().mark(function i(o){return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,o.render();case 2:case"end":return s.stop()}},i)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"renderModels",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(o){o.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(i)},(i==null?void 0:i.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,i,o,u){var s=this.configService.getAttributeConfig(this.id)||{};return(0,N.isEqual)(s[e],{field:i,values:o})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(e)!==-1&&this.configService.setAttributeConfig(this.id,(0,d.Z)({},e,{field:i,values:o})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:(0,A.Z)({field:i},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[i]))},u):this.pendingStyleAttributes.push({attributeName:e,attributeField:i,attributeValues:o,updateOptions:u}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.models.forEach(function(s){return s.destroy()}),this.models=[],u.next=4,this.layerModel.initModels();case 4:this.models=u.sent;case 5:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,i){return{values:(0,N.isFunction)(e)?void 0:e||i,callback:(0,N.isFunction)(e)?e:void 0}}}]),t}(pe.EventEmitter),$l=(0,q.Z)(Vi.prototype,"configService",[Wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vi);function f_(r,a){return{enable:r,mask:255,func:{cmp:m.EQUAL,ref:a?1:0,mask:1}}}function Kl(r){return r.maskOperation===Qt.OR?{enable:!0,mask:255,func:{cmp:m.ALWAYS,ref:1,mask:255},opFront:{fail:m.KEEP,zfail:m.REPLACE,zpass:m.REPLACE}}:{enable:!0,mask:255,func:{cmp:r.stencilType===ft.SINGLE||r.stencilIndex===0?m.ALWAYS:m.LESS,ref:r.stencilType===ft.SINGLE?1:r.stencilIndex===0?2:1,mask:255},opFront:{fail:m.KEEP,zfail:m.REPLACE,zpass:m.REPLACE}}}var Ql,Gi,ql;function p_(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=h_(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function h_(r,a){if(!!r){if(typeof r=="string")return Jl(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Jl(r,a)}}function Jl(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var he=(Ql=ki(w.IGlobalConfigService),Gi=function(){function r(a){(0,R.Z)(this,r),(0,J.Z)(this,"configService",ql,this),this.layer=a,this.rendererService=a.getContainer().get(w.IRendererService),this.pickingService=a.getContainer().get(w.IPickingService),this.shaderModuleService=a.getContainer().get(w.IShaderModuleService),this.styleAttributeService=a.getContainer().get(w.IStyleAttributeService),this.mapService=a.getContainer().get(w.IMapService),this.iconService=a.getContainer().get(w.IIconService),this.fontService=a.getContainer().get(w.IFontService),this.cameraService=a.getContainer().get(w.ICameraService),this.layerService=a.getContainer().get(w.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:m.NEAREST,min:m.NEAREST,width:1,height:1}))}return(0,T.Z)(r,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return(0,N.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,N.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),(0,N.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,N.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,N.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),(0,N.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,N.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,N.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,N.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,N.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,N.isString)(t)?!!(0,qa.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=ue(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,N.isNumber)(t[0])&&(0,N.isNumber)(t[1]))}},{key:"patchMod",value:function(t,n){for(var e=0;e<n;e++)t.push(-1)}},{key:"patchData",value:function(t,n,e){var i=p_(e),o;try{for(i.s();!(o=i.n()).done;){var u=o.value,s=u.attr,l=u.count,c=n[s];c!==void 0?s==="stroke"?t.push.apply(t,(0,G.Z)(ue(c))):s==="offsets"?this.isOffsetStatic(c)?t.push(-c[0],c[1]):t.push(0,0):t.push((0,N.isNumber)(c)?c:1):this.patchMod(t,l)}}catch(f){i.e(f)}finally{i.f()}}},{key:"calDataFrame",value:function(t,n,e){for(var i=n.length,o=Math.ceil(i*t/this.DATA_TEXTURE_WIDTH),u=o*this.DATA_TEXTURE_WIDTH,s=[],l=0;l<i;l++){var c=n[l];this.patchData(s,c,e)}for(var f=s.length;f<u;f++)s.push(-1);return{data:s,width:this.DATA_TEXTURE_WIDTH,height:o}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,e=n===void 0?"normal":n;return ji[tt[e]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),e=n.mask,i=e===void 0?!1:e,o=n.maskInside,u=o===void 0?!0:o,s=n.enableMask,l=n.maskOperation,c=l===void 0?Qt.AND:l;if(this.layer.type==="MaskLayer")return Kl({isStencil:!0,stencilType:ft.SINGLE});if(t.isStencil)return Kl((0,A.Z)((0,A.Z)({},t),{},{maskOperation:c}));var f=i||s&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return f_(f,u)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var a=(0,k.Z)(y().mark(function n(){return y().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",!1);case 1:case"end":return i.stop()}},n)}));function t(){return a.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var a=(0,k.Z)(y().mark(function n(){return y().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return i.stop()}},n)}));function t(){return a.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var a=(0,k.Z)(y().mark(function n(){return y().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return i.stop()}},n)}));function t(){return a.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),r}(),ql=(0,q.Z)(Gi.prototype,"configService",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gi),Wi=100,Fb=36,wb=40;function ec(r){return r/180*Math.acos(-1)}function tc(r){var a=ec(r[0])+Math.PI/2,t=ec(r[1]),n=Wi+Math.random()*.4,e=n*Math.cos(t)*Math.cos(a),i=n*Math.cos(t)*Math.sin(a),o=n*Math.sin(t);return[i,o,e]}function Ob(r,a){var t=mat4.create(),n=mat4.create(),e=vec3.fromValues(0,1,0),i=vec3.fromValues(0,0,0);a=a||{},r=typeof r!="undefined"?r:1;for(var o=typeof a.segments!="undefined"?a.segments:32,u=2+o,s=2*u,l=[],c=[],f=[],p=[],h=[],g=[],v=0;v<=u;v++){for(var _=v/u,x=_*Math.PI,C=0;C<=s;C++){var S=C/s,M=S*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-x),mat4.identity(t),mat4.rotateY(t,t,M),vec3.transformMat4(i,e,n),vec3.transformMat4(i,i,t),vec3.scale(i,i,-r),f.push(i.slice()),p.push.apply(p,_toConsumableArray(i.slice())),vec3.normalize(i,i),h.push.apply(h,_toConsumableArray(i.slice())),g.push([S,1-_]),p.push(S,1-_)}if(v>0)for(var L=f.length,D=L-2*(s+1);D+s+2<L;D++)l.push([D,D+1,D+s+1]),c.push(D,D+1,D+s+1),l.push([D+s+1,D+1,D+s+2]),c.push(D+s+1,D+1,D+s+2)}return{cells:l,positions:f,uvs:g,positionsArr:p,indicesArr:c,normalArr:h}}var vr=H.Ue(),Db=H.Ue(),_e=H.Ue(),Tt=H.Ue(),tn=H.Ue();function $i(r,a,t,n,e){H.IH(r,t,n),H.Fv(r,r),a=H.al(-r[1],r[0]);var i=H.al(-t[1],t[0]);return[e/H.AK(a,i),a]}function Mt(r,a){return H.t8(r,-a[1],a[0])}function nn(r,a,t){return H.lu(r,a,t),H.Fv(r,r),r}function Xi(r,a){return r[0]===a[0]&&r[1]===a[1]}function Ib(r){for(var a=new Map,t=0;t<r.length;t++){var n=r[0].toString()+"-"+r[1].toString();a.get(n)?(r.splice(t,1),t++):a.set(n,n)}return r}var d_=function(){function r(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,R.Z)(this,r),(0,d.Z)(this,"lastFlip",-1),(0,d.Z)(this,"miter",H.al(0,0)),(0,d.Z)(this,"started",!1),(0,d.Z)(this,"dash",!1),(0,d.Z)(this,"totalDistance",0),(0,d.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,T.Z)(r,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=t.length,i=n.startIndex,o=1;o<e;o++){var u=t[o-1],s=t[o],l=o<t.length-1?t[o+1]:null,c=this.simpleSegment(n,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<n.positions.length/6;f++)n.positions[f*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=t[u-1];f.push((s=n[u-1][2])!==null&&s!==void 0?s:0);var p=n[u-1],h=t[u];h.push((l=n[u][2])!==null&&l!==void 0?l:0);var g=n[u],v=u<t.length-1?[].concat((0,G.Z)(t[u+1]),[(c=n[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<n.length-1?n[u+1]:null,x=this.simpleSegment(e,o,f,h,v,p,g,_);o+=x}if(this.dash)for(var C=0;C<e.positions.length/6;C++)e.positions[C*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"extrude_gaode2",value:function(t,n){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=t[u-1];f.push((s=n[u-1][2])!==null&&s!==void 0?s:0);var p=n[u-1],h=t[u];h.push((l=n[u][2])!==null&&l!==void 0?l:0);var g=n[u],v=u<t.length-1?[].concat((0,G.Z)(t[u+1]),[(c=n[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<n.length-1?n[u+1]:null,x=this.segment_gaode2(e,o,f,h,v,p,g,_);o+=x}if(this.dash)for(var C=0;C<e.positions.length/6;C++)e.positions[C*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=t.length,i=n.startIndex,o=1;o<e;o++){var u=t[o-1],s=t[o],l=o<t.length-1?t[o+1]:null,c=this.segment(n,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<n.positions.length/6;f++)n.positions[f*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,e,i,o){var u=0,s=t.indices,l=t.positions,c=t.normals,f=be([i[0],i[1]]),p=be([e[0],e[1]]);nn(_e,f,p);var h=0;if(this.dash&&(h=this.lineSegmentDistance(f,p),this.totalDistance+=h),this.normal||(this.normal=H.Ue(),Mt(this.normal,_e)),this.started||(this.started=!0,this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-h)),s.push(n+0,n+1,n+2),!o)Mt(this.normal,_e),this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2;else{var g=be([o[0],o[1]]);Xi(f,g)&&H.IH(g,f,H.Fv(g,H.$X(g,f,p))),nn(Tt,g,f);var v=$i(tn,H.Ue(),_e,Tt,this.thickness),_=(0,W.Z)(v,2),x=_[0],C=_[1],S=H.AK(tn,this.normal)<0?-1:1;this.extrusions(l,c,i,C,x,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),S=-1,H.JG(this.normal,C),u+=2,this.lastFlip=S}return u}},{key:"segment_gaode2",value:function(t,n,e,i,o,u,s,l){var c=0,f=t.indices,p=t.positions,h=t.normals,g=this.cap==="square",v=this.join==="bevel",_=be([s[0],s[1]]),x=be([u[0],u[1]]);nn(_e,i,e);var C=0;if(this.dash&&(C=this.lineSegmentDistance(_,x),this.totalDistance+=C),this.normal||(this.normal=H.Ue(),Mt(this.normal,_e)),!this.started)if(this.started=!0,g){var S=H.Ue(),M=H.Ue();H.IH(S,this.normal,_e),H.IH(M,this.normal,_e),h.push(M[0],M[1],0),h.push(S[0],S[1],0),p.push(e[0],e[1],e[2]|0,this.totalDistance-C,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),p.push(e[0],e[1],e[2]|0,this.totalDistance-C,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,h,e,this.normal,this.thickness,this.totalDistance-C);if(f.push(n+0,n+1,n+2),o){Xi(i,o)&&H.IH(o,i,H.Fv(o,H.$X(o,i,e))),nn(Tt,o,i);var B=$i(tn,H.Ue(),_e,Tt,this.thickness),I=(0,W.Z)(B,2),P=I[0],U=I[1],V=H.AK(tn,this.normal)<0?-1:1,K=v;if(!K&&this.join==="miter"){var Q=P;Q>this.miterLimit&&(K=!0)}K?(h.push(this.normal[0],this.normal[1],0),h.push(U[0],U[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*V,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*V,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,G.Z)(this.lastFlip!==-V?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Mt(vr,Tt),H.JG(this.normal,vr),h.push(this.normal[0],this.normal[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*V,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(p,h,i,U,P,this.totalDistance),f.push.apply(f,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),V=-1,H.JG(this.normal,U),c+=2),this.lastFlip=V}else{if(Mt(this.normal,_e),g){var L=H.Ue(),D=H.Ue();H.lu(D,_e,this.normal),H.IH(L,_e,this.normal),h.push(D[0],D[1],0),h.push(L[0],L[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,h,i,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2}return c}},{key:"segment",value:function(t,n,e,i,o){var u=0,s=t.indices,l=t.positions,c=t.normals,f=this.cap==="square",p=this.join==="bevel",h=be([i[0],i[1]]),g=be([e[0],e[1]]);nn(_e,h,g);var v=0;if(this.dash&&(v=this.lineSegmentDistance(h,g),this.totalDistance+=v),this.normal||(this.normal=H.Ue(),Mt(this.normal,_e)),!this.started)if(this.started=!0,f){var _=H.Ue(),x=H.Ue();H.IH(_,this.normal,_e),H.IH(x,this.normal,_e),c.push(x[0],x[1],0),c.push(_[0],_[1],0),l.push(e[0],e[1],e[2]|0,this.totalDistance-v,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),l.push(e[0],e[1],e[2]|0,this.totalDistance-v,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-v);if(s.push(n+0,n+1,n+2),o){var M=be([o[0],o[1]]);Xi(h,M)&&H.IH(M,h,H.Fv(M,H.$X(M,h,g))),nn(Tt,M,h);var L=$i(tn,H.Ue(),_e,Tt,this.thickness),D=(0,W.Z)(L,2),B=D[0],I=D[1],P=H.AK(tn,this.normal)<0?-1:1,U=p;if(!U&&this.join==="miter"){var V=B;V>this.miterLimit&&(U=!0)}U?(c.push(this.normal[0],this.normal[1],0),c.push(I[0],I[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*P,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*P,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push.apply(s,(0,G.Z)(this.lastFlip!==-P?[n,n+2,n+3]:[n+2,n+1,n+3])),s.push(n+2,n+3,n+4),Mt(vr,Tt),H.JG(this.normal,vr),c.push(this.normal[0],this.normal[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*P,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,c,i,I,B,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),P=-1,H.JG(this.normal,I),u+=2),this.lastFlip=P}else{if(Mt(this.normal,_e),f){var C=H.Ue(),S=H.Ue();H.lu(S,_e,this.normal),H.IH(C,_e,this.normal),c.push(S[0],S[1],0),c.push(C[0],C[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance);s.push.apply(s,(0,G.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),u+=2}return u}},{key:"extrusions",value:function(t,n,e,i,o,u){n.push(i[0],i[1],0),n.push(i[0],i[1],0),t.push(e[0],e[1],e[2]|0,u,-o,e[2]|0),this.complex.indexes.push(this.currentIndex),t.push(e[0],e[1],e[2]|0,u,o,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var e=n[0]-t[0],i=n[1]-t[1];return Math.sqrt(e*e+i*i)}}]),r}(),ie=z(77160);function Pb(r){var a=r[0][0],t=r[0][r[0].length-1];a[0]===t[0]&&a[1]===t[1]&&(r[0]=r[0].slice(0,r[0].length-1));for(var n=r[0].length,e=earcut.flatten(r),i=e.vertices,o=e.dimensions,u=[],s=[],l=0;l<i.length/o;l++)o===2?u.push(i[l*2],i[l*2+1],1):u.push(i[l*3],i[l*3+1],1);var c=earcut(e.vertices,e.holes,e.dimensions);s.push.apply(s,_toConsumableArray(c));for(var f=function(){var g=e.vertices.slice(p*o,(p+1)*o),v=e.vertices.slice((p+1)*o,(p+2)*o);v.length===0&&(v=e.vertices.slice(0,o));var _=u.length/3;u.push(g[0],g[1],1,v[0],v[1],1,g[0],g[1],0,v[0],v[1],0),s.push.apply(s,_toConsumableArray([0,2,1,2,3,1].map(function(x){return x+_})))},p=0;p<n;p++)f();return{positions:u,index:s}}function Bb(r){var a=earcut.flatten(r),t=earcut(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:t}}function nc(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=r[0][0],n=r[0][r[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(r[0]=r[0].slice(0,r[0].length-1));for(var e=r[0].length,i=_t().flatten(r),o=i.vertices,u=i.dimensions,s=[],l=[],c=[],f=0;f<o.length/u;f++)u===2?s.push(o[f*2],o[f*2+1],1,-1,-1):s.push(o[f*3],o[f*3+1],1,-1,-1),c.push(0,0,1);var p=_t()(i.vertices,i.holes,i.dimensions);l.push.apply(l,(0,G.Z)(p));for(var h=function(){var _=i.vertices.slice(g*u,(g+1)*u),x=i.vertices.slice((g+1)*u,(g+2)*u);x.length===0&&(x=i.vertices.slice(0,u));var C=s.length/5;s.push(_[0],_[1],1,0,0,x[0],x[1],1,.1,0,_[0],_[1],0,0,.8,x[0],x[1],0,.1,.8);var S=v_([x[0],x[1],1],[_[0],_[1],0],[_[0],_[1],1],a);c.push.apply(c,(0,G.Z)(S).concat((0,G.Z)(S),(0,G.Z)(S),(0,G.Z)(S))),l.push.apply(l,(0,G.Z)([1,2,0,3,2,1].map(function(M){return M+C})))},g=0;g<e;g++)h();return{positions:s,index:l,normals:c}}function v_(r,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,e=ie.create(),i=ie.create(),o=ie.create();n&&(r=ui(r),a=ui(a),t=ui(t));var u=ie.fromValues.apply(ie,(0,G.Z)(r)),s=ie.fromValues.apply(ie,(0,G.Z)(a)),l=ie.fromValues.apply(ie,(0,G.Z)(t));ie.sub(e,l,s),ie.sub(i,u,s),ie.cross(o,e,i);var c=ie.create();return ie.normalize(c,o),c}var $e,Dn=function(r){return r.CYLINDER="cylinder",r.SQUARECOLUMN="squareColumn",r.TRIANGLECOLUMN="triangleColumn",r.HEXAGONCOLUMN="hexagonColumn",r.PENTAGONCOLUMN="pentagonColumn",r}({}),In=function(r){return r.CIRCLE="circle",r.SQUARE="square",r.TRIANGLE="triangle",r.HEXAGON="hexagon",r.PENTAGON="pentagon",r}({});function Pn(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/r,n=[],e=0;e<r;e++)n.push(t*e+a*Math.PI/12);var i=n.map(function(o){var u=Math.sin(o+Math.PI/4),s=Math.cos(o+Math.PI/4);return[u,s,0]});return i}function rc(){return Pn(30)}function ic(){return Pn(4)}function ac(){return Pn(3)}function oc(){return Pn(6,1)}function uc(){return Pn(5)}var Yi=($e={},(0,d.Z)($e,In.CIRCLE,rc),(0,d.Z)($e,In.HEXAGON,oc),(0,d.Z)($e,In.TRIANGLE,ac),(0,d.Z)($e,In.SQUARE,ic),(0,d.Z)($e,In.PENTAGON,uc),(0,d.Z)($e,Dn.CYLINDER,rc),(0,d.Z)($e,Dn.HEXAGONCOLUMN,oc),(0,d.Z)($e,Dn.TRIANGLECOLUMN,ac),(0,d.Z)($e,Dn.SQUARECOLUMN,ic),(0,d.Z)($e,Dn.PENTAGONCOLUMN,uc),$e),gr={};function mr(r){var a=lt(r.coordinates);return{vertices:[].concat((0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function sc(r){var a=lt(r.coordinates),t=tc(a);return{vertices:[].concat((0,G.Z)(t),(0,G.Z)(t),(0,G.Z)(t),(0,G.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function lc(r){var a=r.shape,t=S_(a,!1),n=t.positions,e=t.index,i=t.normals;return{vertices:n,indices:e,normals:i,size:5}}function g_(r){var a=lt(r.coordinates);return{vertices:(0,G.Z)(a),indices:[0],size:a.length}}function Bn(r){var a=r.coordinates,t=r.originCoordinates,n=r.version,e=new d_({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var i=a;Array.isArray(i[0][0])||(i=[a]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var u=0;u<i.length;u++){var s=i[u],l=o[u];e.extrude_gaode2(s,l)}}else{var c=a;c[0]&&!Array.isArray(c[0][0])&&(c=[a]),c.forEach(function(p){e.extrude(p)})}var f=e.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function m_(r){var a=r.coordinates,t=[];if(!Array.isArray(a[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=y_(a),e=n.results,i=n.totalDistance;return e.map(function(o){t.push(o[0],o[1],o[2],o[3],0,i)}),{vertices:t,indices:[],normals:[],size:6,count:e.length}}function Nb(r){var a=r.coordinates,t=[];if(!Array.isArray(a[0]))return{vertices:[],indices:[],size:4,count:0};var n=__(a),e=n.results;return e.map(function(i){t.push(i[0],i[1],i[2],i[3])}),{vertices:t,indices:[],size:4,count:e.length}}function cc(r,a){var t=a[0]-r[0],n=a[1]-r[1];return Math.sqrt(t*t+n*n)}function rn(r,a){return r.length<3&&r.push(0),a!==void 0&&r.push(a),r}function y_(r){var a=r;Array.isArray(a)&&Array.isArray(a[0])&&Array.isArray(a[0][0])&&(a=r.flat());var t=0;if(a.length<2)return{results:a,totalDistance:0};var n=[],e=rn(a[0],t);n.push(e);for(var i=1;i<a.length-1;i++){var o=cc(a[i-1],a[i]);t+=o;var u=rn(a[i],t);n.push(u),n.push(u)}var s=cc(a[a.length-2],a[a.length-1]);return t+=s,n.push(rn(a[a.length-1],t)),{results:n,totalDistance:t}}function __(r){if(r.length<2)return{results:r};var a=[],t=rn(r[0]);a.push(t);for(var n=1;n<r.length-1;n++){var e=rn(r[n]);a.push(e),a.push(e)}return a.push(rn(r[r.length-1])),{results:a}}function Ki(r){var a=r.coordinates,t=_t().flatten(a),n=t.vertices,e=t.dimensions,i=t.holes;return{indices:_t()(n,i,e),vertices:n,size:e}}function E_(r){var a=r.coordinates,t=_t().flatten(a),n=t.vertices,e=t.dimensions,i=t.holes;return{indices:_t()(n,i,e),vertices:x_(n),size:e+4}}function x_(r){for(var a=[],t=Zh(r),n=t.center,e=t.radius,i=0;i<r.length;i+=2){var o=r[i],u=r[i+1];a.push.apply(a,[o,u,0].concat((0,G.Z)(n),[e]))}return a}function C_(r){var a=r.coordinates,t=nc(a,!0),n=t.positions,e=t.index,i=t.normals;return{vertices:n,indices:e,normals:i,size:5}}function Zb(r){var a=r.shape,t=A_(a),n=t.positions,e=t.index;return{vertices:n,indices:e,size:3}}function yr(r){var a=r.coordinates,t=[].concat((0,G.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,G.Z)(a[1]),[0,1,0],(0,G.Z)(a[0]),[0,0,1],(0,G.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function _r(r,a){for(var t=a||30,n=r.coordinates,e=[],i=[],o=function(l){e.push(l,1,l,n[0][0],n[0][1],n[1][0],n[1][1],l,-1,l,n[0][0],n[0][1],n[1][0],n[1][1]),l!==t-1&&i.push.apply(i,(0,G.Z)([0,1,2,1,3,2].map(function(c){return l*2+c})))},u=0;u<t;u++)o(u);return{vertices:e,indices:i,size:7}}function zb(r){var a=r.coordinates;a.length===2&&a.push(0);var t=Er(-1,1),n=Er(1,1),e=Er(-1,-1),i=Er(1,-1),o=[].concat(_toConsumableArray(a),_toConsumableArray(t),_toConsumableArray(a),_toConsumableArray(e),_toConsumableArray(a),_toConsumableArray(i),_toConsumableArray(a),_toConsumableArray(n)),u=[0,1,2,3,0,2];return{vertices:o,indices:u,size:5}}function S_(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(gr&&gr[r])return gr[r];var t=Yi[r]?Yi[r]():Yi.cylinder(),n=nc([t],a);return gr[r]=n,n}function Ub(r,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,e=new Float32Array(r.length/t*3),i,o,u,s=vec3.create(),l=vec3.create(),c=vec3.create(),f=0,p=a.length;f<p;f+=3){i=a[f+0]*3,o=a[f+1]*3,u=a[f+2]*3;var h=[r[i],r[i+1]],g=[r[o],r[o+1]],v=[r[u],r[u+1]];n&&(h=lngLatToMeters(h),g=lngLatToMeters(g),v=lngLatToMeters(v));var _=h,x=_slicedToArray(_,2),C=x[0],S=x[1],M=vec3.fromValues(C,S,r[i+2]),L=g,D=_slicedToArray(L,2),B=D[0],I=D[1],P=vec3.fromValues(B,I,r[o+2]),U=v,V=_slicedToArray(U,2),K=V[0],Q=V[1],te=vec3.fromValues(K,Q,r[u+2]);vec3.sub(s,te,P),vec3.sub(l,M,P),vec3.cross(c,s,l),e[i]+=s[0],e[i+1]+=s[1],e[i+2]+=s[2],e[o]+=s[0],e[o+1]+=s[1],e[o+2]+=s[2],e[u]+=s[0],e[u+1]+=s[1],e[u+2]+=s[2]}return b_(e),e}function b_(r){for(var a=0,t=r.length;a<t;a+=3){var n=vec3.fromValues(r[a],r[a+1],r[a+2]),e=vec3.create();vec3.normalize(e,n),r.set(e,a)}}function Hb(r){var a=r[0][0],t=r[0][r[0].length-1];return a[0]===t[0]&&a[1]===t[1]}function A_(r){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=geometryShape[r]?geometryShape[r]():geometryShape.circle(),n=a.indexOf(r)===-1?fillPolygon([t]):extrudePolygon([t]);return n}function Er(r,a){var t=(r+1)/2,n=(a+1)/2;return[t,n]}function jb(){var r=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=r.positionsArr,t=r.indicesArr,n=r.normalArr;return{vertices:a,indices:t,size:5,normals:n}}function Vb(){var r=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=r.positionsArr,t=r.indicesArr,n=r.normalArr;return{vertices:a,indices:t,size:5,normals:n}}function T_(r){var a=M_();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function M_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var L_=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,R_=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,k_=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,F_=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,w_=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,O_=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,D_={solid:0,dash:1},I_=function(r){(0,F.Z)(t,r);var a=T_(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,h=e.dashArray,g=h===void 0?[10,5]:h,v=e.forward,_=v===void 0?!0:v,x=e.lineTexture,C=x===void 0?!1:x,S=e.iconStep,M=S===void 0?100:S,L=e.segmentNumber,D=L===void 0?30:L,B=e.thetaOffset,I=B===void 0?.314:B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,thetaOffset:I})){this.judgeStyleAttributes({opacity:o,thetaOffset:I});var P=this.layer.getEncodedData(),U=this.calDataFrame(this.cellLength,P,this.cellProperties),V=U.data,K=U.width,Q=U.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:m.LUMINANCE,type:m.FLOAT,width:K,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}g.length===2&&g.push(0,0);var te=0,ce=[0,0,0,0],fe=[0,0,0,0];return u&&s&&(ce=ue(u),fe=ue(s),te=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,N.isNumber)(I)?I:0,u_opacity:(0,N.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:D,u_line_type:D_[p||"solid"],u_dash_array:g,u_blur:.9,u_lineDir:_?1:-1,u_texture:this.texture,u_line_texture:C?1:0,u_icon_step:M,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:te,u_sourceColor:ce,u_targetColor:fe}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor,u=e.lineType;return u==="dash"?{frag:L_,vert:R_,type:"Dash"}:i&&o?{frag:w_,vert:O_,type:"Linear"}:{frag:k_,vert:F_,type:""}}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=this.layer.getLayerConfig(),u=o.segmentNumber,s=u===void 0?30:u,l=this.getShaders(),c=l.frag,f=l.vert,p=l.type,v.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+p,vertexShader:f,fragmentShader:c,triangulation:_r,depth:{enable:!1},segmentNumber:s});case 4:return h=v.sent,v.abrupt("return",[h]);case 6:case"end":return v.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:X.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he);function P_(r){var a=B_();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function B_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var N_=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Z_=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,z_=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,U_=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,H_={solid:0,dash:1},j_=function(r){(0,F.Z)(t,r);var a=P_(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,h=e.dashArray,g=h===void 0?[10,5]:h,v=e.lineTexture,_=v===void 0?!1:v,x=e.iconStep,C=x===void 0?100:x,S=e.segmentNumber,M=S===void 0?30:S,L=e.globalArcHeight,D=L===void 0?10:L;g.length===2&&g.push(0,0);var B=0,I=[0,0,0,0],P=[0,0,0,0];if(u&&s&&(I=ue(u),P=ue(s),B=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var U=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,U,this.cellProperties),K=V.data,Q=V.width,te=V.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:m.LUMINANCE,type:m.FLOAT,width:Q,height:te}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Wi,u_global_height:D,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:M,u_line_type:H_[p]||0,u_dash_array:g,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:C,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:B,u_sourceColor:I,u_targetColor:P}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor;return i&&o?{frag:z_,vert:U_,type:"Linear"}:{frag:N_,vert:Z_,type:""}}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=this.layer.getLayerConfig(),u=o.segmentNumber,s=u===void 0?30:u,l=this.getShaders(),c=l.frag,f=l.vert,p=l.type,v.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+p,vertexShader:f,fragmentShader:c,triangulation:_r,segmentNumber:s});case 4:return h=v.sent,v.abrupt("return",[h]);case 6:case"end":return v.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:X.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he);function V_(r){var a=G_();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function G_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var W_=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,$_=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,X_=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Y_=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,K_={solid:0,dash:1},Q_=function(r){(0,F.Z)(t,r);var a=V_(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,h=e.dashArray,g=h===void 0?[10,5]:h,v=e.lineTexture,_=v===void 0?!1:v,x=e.iconStep,C=x===void 0?100:x,S=e.segmentNumber,M=S===void 0?30:S,L=e.globalArcHeight,D=L===void 0?10:L;g.length===2&&g.push(0,0);var B=0,I=[0,0,0,0],P=[0,0,0,0];if(u&&s&&(I=ue(u),P=ue(s),B=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var U=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,U,this.cellProperties),K=V.data,Q=V.width,te=V.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:m.LUMINANCE,type:m.FLOAT,width:Q,height:te}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:Wi,u_global_height:D,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:M,u_line_type:K_[p]||0,u_dash_array:g,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:C,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:B,u_sourceColor:I,u_targetColor:P}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor;return i&&o?{frag:X_,vert:Y_,type:"Linear"}:{frag:W_,vert:$_,type:""}}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=this.layer.getLayerConfig(),u=o.segmentNumber,s=u===void 0?30:u,l=this.getShaders(),c=l.frag,f=l.vert,p=l.type,v.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+p,vertexShader:f,fragmentShader:c,triangulation:_r,depth:{enable:!0},segmentNumber:s});case 4:return h=v.sent,v.abrupt("return",[h]);case 6:case"end":return v.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:X.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he);function q_(r){var a=J_();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function J_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var e2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,t2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,n2={solid:0,dash:1},r2=function(r){(0,F.Z)(t,r);var a=q_(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,h=e.dashArray,g=h===void 0?[10,5]:h,v=e.lineTexture,_=v===void 0?!1:v,x=e.iconStep,C=x===void 0?100:x,S=e.segmentNumber,M=S===void 0?30:S;g.length===2&&g.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var L=0,D=[0,0,0,0],B=[0,0,0,0];if(u&&s&&(D=ue(u),B=ue(s),L=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var I=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,I,this.cellProperties),U=P.data,V=P.width,K=P.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&U.length>0?this.createTexture2D({flipY:!0,data:U,format:m.LUMINANCE,type:m.FLOAT,width:V,height:K}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:M,u_line_type:n2[p]||0,u_dash_array:g,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:C,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:L,u_sourceColor:D,u_targetColor:B}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:t2,fragmentShader:e2,triangulation:_r,depth:{enable:!1}});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:X.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he);function i2(r){var a=a2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var o2=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,u2=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,s2=function(r){(0,F.Z)(t,r);var a=i2(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.arrow,c=l===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:l,f=0,p=[0,0,0,0],h=[0,0,0,0];if(u&&s&&(p=ue(u),h=ue(s),f=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),v=this.calDataFrame(this.cellLength,g,this.cellProperties),_=v.data,x=v.width,C=v.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:m.LUMINANCE,type:m.FLOAT,width:x,height:C}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_linearColor:f,u_sourceColor:p,u_targetColor:h,u_arrow:Number(c.enable),u_arrowHeight:c.arrowHeight||3,u_arrowWidth:c.arrowWidth||2,u_tailWidth:c.tailWidth===void 0?1:c.tailWidth}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p;return y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o=this.layer.getLayerConfig(),u=o.depth,s=u===void 0?!1:u,l=this.getShaders(),c=l.frag,f=l.vert,this.layer.triangulation=Bn,g.next=5,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:f,fragmentShader:c,triangulation:Bn,depth:{enable:s}});case 5:return p=g.sent,g.abrupt("return",[p]);case 7:case"end":return g.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){return{frag:o2,vert:u2,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:X.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i,o,u,s,l,c){return c===void 0?[u[3],10,u[5]]:[u[3],c,u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:X.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(i){var o=i.coordinates[0]||[0,0],u=i.coordinates[3]||[0,0];return[o[0],o[1],u[0],u[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:X.Attribute,descriptor:{name:"a_Miter",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i,o,u){return[u[4]]}}})}}]),t}(he),Gb=function(r){return r[r.solid=0]="solid",r[r.dash=1]="dash",r}({}),xr=function(r){return r.VERTICAL="vertical",r.HORIZONTAL="horizontal",r}({}),l2=function(r){return r.NORMAL="normal",r.REPLACE="replace",r}({}),Qi=function(r){return r[r.pixel=0]="pixel",r[r.meter=1]="meter",r}({}),Wb=function(r){return r.ALWAYS="always",r.DRAGEND="dragend",r}({});function c2(r){var a=f2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function f2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var p2=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,h2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,d2=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,fc=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,v2=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,g2={solid:0,dash:1},pc=function(r){(0,F.Z)(t,r);var a=c2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"textureEventFlag",!1),(0,d.Z)((0,E.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,h=e.dashArray,g=h===void 0?[10,5,0,0]:h,v=e.lineTexture,_=v===void 0?!1:v,x=e.iconStep,C=x===void 0?100:x,S=e.vertexHeightScale,M=S===void 0?20:S,L=e.borderWidth,D=L===void 0?0:L,B=e.borderColor,I=B===void 0?"#ccc":B,P=e.raisingHeight,U=P===void 0?0:P,V=e.heightfixed,K=V===void 0?!1:V,Q=e.linearDir,te=Q===void 0?xr.VERTICAL:Q,ce=e.blur,fe=ce===void 0?[1,1,1]:ce,Ce=e.arrow,Se=Ce===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ce;g.length===2&&g.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var nt=0,Ke=[0,0,0,0],Aa=[0,0,0,0];if(u&&s&&(Ke=ue(u),Aa=ue(s),nt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var Ir=this.layer.getEncodedData(),Ta=this.calDataFrame(this.cellLength,Ir,this.cellProperties),Y0=Ta.data,dS=Ta.width,K0=Ta.height;this.rowCount=K0,this.dataTexture=this.cellLength>0&&Y0.length>0?this.createTexture2D({flipY:!0,data:Y0,format:m.LUMINANCE,type:m.FLOAT,width:dS,height:K0}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_textureBlend:c===l2.NORMAL?0:1,u_line_type:g2[p],u_dash_array:g,u_blur:fe,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:C,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:D,u_borderColor:ue(I),u_linearDir:te===xr.VERTICAL?1:0,u_linearColor:nt,u_sourceColor:Ke,u_targetColor:Aa,u_heightfixed:Number(K),u_vertexScale:M,u_raisingHeight:Number(U),u_arrow:Number(Se.enable),u_arrowHeight:Se.arrowHeight||3,u_arrowWidth:Se.arrowWidth||2,u_tailWidth:Se.tailWidth===void 0?1:Se.tailWidth}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h,g,v,_;return y().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return o=this.layer.getLayerConfig(),u=o.depth,s=u===void 0?!1:u,l=o.workerEnabled,c=l===void 0?!1:l,f=o.enablePicking,p=this.getShaders(),h=p.frag,g=p.vert,v=p.type,this.layer.triangulation=_i,C.next=5,this.layer.buildLayerModel({moduleName:"line"+v,vertexShader:g,fragmentShader:h,triangulation:_i,depth:{enable:s},workerEnabled:c,workerOptions:{modelType:"line"+v,enablePicking:f,iconMap:this.iconService.getIconMap()}});case 5:return _=C.sent,C.abrupt("return",[_]);case 7:case"end":return C.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor,u=e.lineType;return u==="dash"?{frag:p2,vert:h2,type:"Dash"}:i&&o?{frag:v2,vert:fc,type:"Linear"}:{frag:d2,vert:fc,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:X.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o,u,s,l,c,f){return f===void 0?[s[3],10]:[s[3],f]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:X.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u,s){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(o,u,s,l,c){return c}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:X.Attribute,descriptor:{name:"a_Miter",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u,s){return[s[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he);function m2(r){var a=y2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var _2=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,E2=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,x2=function(r){(0,F.Z)(t,r);var a=m2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var s=n.layer.getLayerConfig(),l=s.rampColors,c=Ja(l);n.colorTexture=u({data:new Uint8Array(c.data),width:c.width,height:c.height,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE,min:m.NEAREST,mag:m.NEAREST,flipY:!1})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.vertexHeightScale,s=u===void 0?20:u,l=e.raisingHeight,c=l===void 0?0:l,f=e.heightfixed,p=f===void 0?!1:f,h=e.linearDir,g=h===void 0?xr.VERTICAL:h;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var v=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,v,this.cellProperties),x=_.data,C=_.width,S=_.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&x.length>0?this.createTexture2D({flipY:!0,data:x,format:m.LUMINANCE,type:m.FLOAT,width:C,height:S}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:g===xr.VERTICAL?1:0,u_opacity:(0,N.isNumber)(o)?o:1,u_texture:this.colorTexture,u_heightfixed:Number(p),u_vertexScale:s,u_raisingHeight:Number(c)}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.colorTexture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.layer.getLayerConfig(),u=o.depth,s=u===void 0?!1:u,this.layer.triangulation=Bn,f.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:E2,fragmentShader:_2,triangulation:Bn,depth:{enable:s}});case 4:return l=f.sent,f.abrupt("return",[l]);case 6:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:X.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u,s,l,c){return c===void 0?[u[3],10]:[u[3],c]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:X.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i,o,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:X.Attribute,descriptor:{name:"a_Miter",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i,o,u){return[u[4]]}}})}}]),t}(he);function C2(r){var a=S2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var b2=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,A2=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,hc=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,T2=function(r){(0,F.Z)(t,r);var a=C2(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.vertexHeightScale,c=l===void 0?20:l,f=0,p=[0,0,0,0],h=[0,0,0,0];if(u&&s&&(p=ue(u),h=ue(s),f=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),v=this.calDataFrame(this.cellLength,g,this.cellProperties),_=v.data,x=v.width,C=v.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:m.LUMINANCE,type:m.FLOAT,width:x,height:C}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_linearColor:f,u_sourceColor:p,u_targetColor:h,u_vertexScale:c}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor;return i&&o?{frag:A2,vert:hc,type:"lineSimpleLinear"}:{frag:b2,vert:hc,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=this.getShaders(),u=o.frag,s=o.vert,l=o.type,p.next=3,this.layer.buildLayerModel({moduleName:l,vertexShader:s,fragmentShader:u,triangulation:m_,primitive:m.LINES,depth:{enable:!1},pick:!1});case 3:return c=p.sent,p.abrupt("return",[c]);case 5:case"end":return p.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:X.Attribute,descriptor:{name:"a_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i,o,u){return[u[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:X.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i,o,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}})}}]),t}(he);function M2(r){var a=L2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var R2=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,k2=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,F2=function(r){(0,F.Z)(t,r);var a=M2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.heightfixed,p=f===void 0?!1:f,h=e.lineTexture,g=h===void 0?!1:h,v=e.iconStep,_=v===void 0?100:v,x=e.iconStepCount,C=x===void 0?1:x;this.rendererService.getDirty()&&this.texture.bind();var S=0,M=[0,0,0,0],L=[0,0,0,0];return u&&s&&(M=ue(u),L=ue(s),S=1),{u_heightfixed:Number(p),u_opacity:(0,N.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,u_texture:this.texture,u_line_texture:g?1:0,u_iconStepCount:C,u_icon_step:_,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:S,u_sourceColor:M,u_targetColor:L}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:k2,fragmentShader:R2,triangulation:Bn,depth:{enable:!1},blend:this.getBlend()});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:X.Attribute,descriptor:{name:"a_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u,s){return[s[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:X.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u,s){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(o,u,s,l,c){return c}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:X.Attribute,descriptor:{name:"a_Miter",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u,s){return[s[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he),w2={arc:I_,arc3d:j_,greatcircle:r2,wall:F2,line:pc,halfLine:s2,simple:T2,linearline:x2,earthArc3d:Q_},O2=w2;function D2(r){var a=I2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function I2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Nn=function(r){(0,F.Z)(t,r);var a=D2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"type","LineLayer"),(0,d.Z)((0,E.Z)(n),"arrowInsertCount",0),(0,d.Z)((0,E.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,T.Z)(t,[{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=this.getModelType(),this.layerModel=new O2[o](this),s.next=4,this.initLayerModels();case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},halfLine:{},earthArc3d:{}};return i[e]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var i=this.styleAttributeService.getLayerStyleAttribute("shape"),o=i==null||(e=i.scale)===null||e===void 0?void 0:e.field;return o||"line"}},{key:"processData",value:function(e){if(this.getModelType()!=="simple")return e;var i=[];return e.map(function(o){if(Array.isArray(o.coordinates)&&Array.isArray(o.coordinates[0])&&Array.isArray(o.coordinates[0][0])){var u=(0,A.Z)({},o);o.coordinates.map(function(s){i.push((0,A.Z)((0,A.Z)({},u),{},{coordinates:s}))})}else i.push(o)}),i}}]),t}(en);function P2(r){var a=B2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var N2=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Z2=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,z2=function(r){(0,F.Z)(t,r);var a=P2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"raiseCount",0),(0,d.Z)((0,E.Z)(n),"raiseRepeat",0),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1,speed:.01,repeat:!1}:i,u=e.opacity,s=u===void 0?1:u,l=e.sourceColor,c=e.targetColor,f=e.pickLight,p=f===void 0?!1:f,h=e.heightfixed,g=h===void 0?!1:h,v=e.opacityLinear,_=v===void 0?{enable:!1,dir:"up"}:v,x=e.lightEnable,C=x===void 0?!0:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var S=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,S,this.cellProperties),L=M.data,D=M.width,B=M.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:m.LUMINANCE,type:m.FLOAT,width:D,height:B}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}var I=0,P=[0,0,0,0],U=[0,0,0,0];if(l&&c&&(P=ue(l),U=ue(c),I=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var V=o.speed,K=V===void 0?.01:V;this.raiseCount+=K,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(p),u_heightfixed:Number(g),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(s)?s:1,u_linearColor:I,u_sourceColor:P,u_targetColor:U,u_opacitylinear:Number(_.enable),u_opacitylinear_dir:_.dir==="up"?1:0,u_lightEnable:Number(C)}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.layer.getLayerConfig(),u=o.animateOption.repeat,s=u===void 0?1:u,this.raiseRepeat=s,f.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:Z2,fragmentShader:N2,triangulation:lc,depth:{enable:!0},cull:{enable:!0,face:ni(this.mapService.version)},blend:this.getBlend()});case 4:return l=f.sent,f.abrupt("return",[l]);case 6:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i){var o=i.size;if(o){var u=[];return Array.isArray(o)&&(u=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(u=[o,o,o]),u}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:X.Attribute,descriptor:{name:"a_Pos",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i){var o=lt(i.coordinates);return tc([o[0],o[1]])}}})}}]),t}(he);function U2(r){var a=H2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function H2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var j2=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,V2=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,G2=function(r){(0,F.Z)(t,r);var a=U2(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.strokeOpacity,s=u===void 0?1:u,l=e.strokeWidth,c=l===void 0?0:l,f=e.stroke,p=f===void 0?"rgba(0,0,0,0)":f,h=e.offsets,g=h===void 0?[0,0]:h,v=e.blend,_=e.blur,x=_===void 0?0:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g})){this.judgeStyleAttributes({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g});var C=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,C,this.cellProperties),M=S.data,L=S.width,D=S.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&M.length>0?this.createTexture2D({flipY:!0,data:M,format:m.LUMINANCE,type:m.FLOAT,width:L,height:D}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_blur:x,u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_stroke_opacity:(0,N.isNumber)(s)?s:1,u_stroke_width:(0,N.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(p),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1}:i;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.layer.triangulation=sc,s.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:V2,fragmentShader:j2,triangulation:sc,depth:{enable:!0},blend:this.getBlend()});case 3:return o=s.sent,s.abrupt("return",[o]);case 5:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:X.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(o,u,s,l){var c=(0,W.Z)(s,3),f=c[0],p=c[1],h=c[2],g=ie.fromValues(0,0,1),v=ie.fromValues(f,0,h),_=f>=0?ie.angle(g,v):Math.PI*2-ie.angle(g,v),x=Math.PI*2-Math.asin(p/100),C=ee.create();ee.rotateY(C,C,_),ee.rotateX(C,C,x);var S=ie.fromValues(1,1,0);ie.transformMat4(S,S,C),ie.normalize(S,S);var M=ie.fromValues(-1,1,0);ie.transformMat4(M,M,C),ie.normalize(M,M);var L=ie.fromValues(-1,-1,0);ie.transformMat4(L,L,C),ie.normalize(L,L);var D=ie.fromValues(1,-1,0);ie.transformMat4(D,D,C),ie.normalize(D,D);var B=[].concat((0,G.Z)(S),(0,G.Z)(M),(0,G.Z)(L),(0,G.Z)(D)),I=l%4*3;return[B[I],B[I+1],B[I+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:X.Attribute,descriptor:{name:"a_Shape",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.shape,s=u===void 0?2:u,l=e.layer.getLayerConfig().shape2d,c=l.indexOf(s);return[c]}}})}}]),t}(he);function W2(r){var a=$2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function $2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var X2=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Y2=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,dc=function(r){(0,F.Z)(t,r);var a=W2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"raiseCount",0),(0,d.Z)((0,E.Z)(n),"raiseRepeat",0),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1,speed:.01,repeat:!1}:i,u=e.opacity,s=u===void 0?1:u,l=e.sourceColor,c=e.targetColor,f=e.pickLight,p=f===void 0?!1:f,h=e.heightfixed,g=h===void 0?!1:h,v=e.opacityLinear,_=v===void 0?{enable:!1,dir:"up"}:v,x=e.lightEnable,C=x===void 0?!0:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var S=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,S,this.cellProperties),L=M.data,D=M.width,B=M.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:m.LUMINANCE,type:m.FLOAT,width:D,height:B}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}var I=0,P=[0,0,0,0],U=[0,0,0,0];if(l&&c&&(P=ue(l),U=ue(c),I=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var V=o.speed,K=V===void 0?.01:V;this.raiseCount+=K,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(p),u_heightfixed:Number(g),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(s)?s:1,u_linearColor:I,u_sourceColor:P,u_targetColor:U,u_opacitylinear:Number(_.enable),u_opacitylinear_dir:_.dir==="up"?1:0,u_lightEnable:Number(C)}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f;return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=this.layer.getLayerConfig(),u=o.depth,s=u===void 0?!0:u,l=o.animateOption.repeat,c=l===void 0?1:l,this.raiseRepeat=c,h.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:Y2,fragmentShader:X2,triangulation:lc,cull:{enable:!0,face:ni(this.mapService.version)},depth:{enable:s}});case 4:return f=h.sent,h.abrupt("return",[f]);case 6:case"end":return h.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i){var o=i.size;if(o){var u=[];return Array.isArray(o)&&(u=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(u=[o,o,o]),u}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:X.Attribute,descriptor:{name:"a_Pos",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i){var o=lt(i.coordinates);return[o[0],o[1],0]}}})}}]),t}(he);function K2(r){var a=Q2();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var vc=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,q2=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(gl_FragColor.a < 0.01) {
    discard;
  } 
}
`,qi=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_Size_Unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;
if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,gc=function(r){(0,F.Z)(t,r);var a=K2(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.strokeOpacity,s=u===void 0?1:u,l=e.strokeWidth,c=l===void 0?0:l,f=e.stroke,p=f===void 0?"rgba(0,0,0,0)":f,h=e.offsets,g=h===void 0?[0,0]:h,v=e.blend,_=e.blur,x=_===void 0?0:_,C=e.raisingHeight,S=C===void 0?0:C,M=e.heightfixed,L=M===void 0?!1:M,D=e.unit,B=D===void 0?"pixel":D;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g})){this.judgeStyleAttributes({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g});var I=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,I,this.cellProperties),U=P.data,V=P.width,K=P.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&U.length>0?this.createTexture2D({flipY:!0,data:U,format:m.LUMINANCE,type:m.FLOAT,width:V,height:K}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(S),u_heightfixed:Number(L),u_blur:x,u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_stroke_opacity:(0,N.isNumber)(s)?s:1,u_stroke_width:(0,N.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(p),u_Size_Unit:Qi[B],u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1}:i;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),sr)}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h,g,v,_,x;return y().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return o=this.layer.getLayerConfig(),u=o.animateOption,s=u===void 0?{enable:!1}:u,l=o.workerEnabled,c=l===void 0?!1:l,f=o.enablePicking,p=o.shape2d,h=this.getShaders(s),g=h.frag,v=h.vert,_=h.type,this.layer.triangulation=sr,S.next=5,this.layer.buildLayerModel({moduleName:_,vertexShader:v,fragmentShader:g,triangulation:sr,depth:{enable:!1},workerEnabled:c,workerOptions:{modelType:_,enablePicking:f,shape2d:p}});case 5:return x=S.sent,S.abrupt("return",[x]);case 7:case"end":return S.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getShaders",value:function(e){if(e.enable)switch(e.type){case"wave":return{frag:vc,vert:qi,type:"pointWave"};default:return{frag:vc,vert:qi,type:"pointWave"}}else return{frag:q2,vert:qi,type:"pointFill"}}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:X.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(o,u,s,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:X.Attribute,descriptor:{name:"a_Shape",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.shape,s=u===void 0?2:u,l=e.indexOf(s);return[l]}}})}}]),t}(he);function J2(r){var a=eE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var tE=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,nE=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform int u_Size_Unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float newSize = a_Size;
  if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,rE=function(r){(0,F.Z)(t,r);var a=J2(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"meter2coord",1),(0,d.Z)((0,E.Z)(n),"isMeter",!1),(0,d.Z)((0,E.Z)(n),"radian",0),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=u({data:n.iconService.getCanvas(),mag:m.LINEAR,min:m.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.offsets,s=u===void 0?[0,0]:u,l=e.rotation,c=e.raisingHeight,f=c===void 0?0:c,p=e.heightfixed,h=p===void 0?!1:p,g=e.unit,v=g===void 0?"pixel":g;this.rendererService.getDirty()&&this.texture.bind();var _=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(_=-1),this.radian=l!==void 0?_*Math.PI*l/180:_*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:s})){this.judgeStyleAttributes({opacity:o,offsets:s});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),S=C.data,M=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:m.LUMINANCE,type:m.FLOAT,width:M,height:L}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(f),u_heightfixed:Number(h),u_Size_Unit:Qi[v],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,N.isNumber)(o)?o:1,u_offsets:this.isOffsetStatic(s)?s:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),mr)}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:nE,fragmentShader:tE,triangulation:mr,depth:{enable:!1},cull:{enable:!0,face:ni(this.mapService.version)}});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;this.iconService.off("imageUpdate",this.updateTexture),(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:X.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.rotate,s=u===void 0?0:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.shape,l=u[s]||{x:-64,y:-64},c=l.x,f=l.y;return[c,f]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:X.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(o,u,s,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}})}}]),t}(he);function iE(r){var a=aE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function aE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var oE=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,uE=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,mc=function(r){(0,F.Z)(t,r);var a=iE(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"updateTexture",function(){var u=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=u({data:n.iconService.getCanvas(),mag:m.LINEAR,min:m.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.offsets,s=u===void 0?[0,0]:u,l=e.raisingHeight,c=l===void 0?0:l,f=e.heightfixed,p=f===void 0?!1:f;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:s})){this.judgeStyleAttributes({opacity:o,offsets:s});var h=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,h,this.cellProperties),v=g.data,_=g.width,x=g.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:m.LUMINANCE,type:m.FLOAT,width:_,height:x}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(c),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,N.isNumber)(o)?o:1,u_offsets:this.isOffsetStatic(s)?s:[0,0]}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),u.abrupt("return",this.buildModels());case 3:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:uE,fragmentShader:oE,triangulation:g_,depth:{enable:!1},primitive:m.POINTS});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.shape,l=u[s]||{x:-64,y:-64},c=l.x,f=l.y;return[c,f]}}})}}]),t}(he);function sE(r){var a=lE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function lE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var cE=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,fE=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function yc(r){var a=r.coordinates;return{vertices:(0,G.Z)(a),indices:[0],size:a.length}}var _c=function(r){(0,F.Z)(t,r);var a=sE(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i;return{u_opacity:(0,N.isNumber)(o)?o:1}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.layer.triangulation=yc,s.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:fE,fragmentShader:cE,triangulation:yc,depth:{enable:!1},primitive:m.POINTS,pick:!1});case 3:return o=s.sent,s.abrupt("return",[o]);case 5:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0]]:[u]}}})}}]),t}(he);function pE(r){var a=hE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function hE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var dE=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,vE=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_Size_Unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;



  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,gE=function(r){(0,F.Z)(t,r);var a=pE(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.blend,s=e.speed,l=s===void 0?1:s,c=e.unit,f=c===void 0?"pixel":c;return{u_Size_Unit:Qi[f],u_speed:l,u_additive:u==="additive"?1:0,u_opacity:(0,N.isNumber)(o)?o:1}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1}:i;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),mr)}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:vE,fragmentShader:dE,triangulation:mr,depth:{enable:!1}});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:X.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(i,o,u,s){var l=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],c=s%4*3;return[l[c],l[c+1],l[c+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?5:o;return Array.isArray(u)?[u[0]]:[u]}}})}}]),t}(he);function mE(r){var a=yE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function yE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var _E=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,EE=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ec(r){var a=r.coordinates;return{vertices:(0,G.Z)(a),indices:[0],size:a.length}}var xE=function(r){(0,F.Z)(t,r);var a=mE(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.offsets,s=u===void 0?[0,0]:u,l=e.blend,c=e.strokeOpacity,f=c===void 0?1:c,p=e.strokeWidth,h=p===void 0?0:p,g=e.stroke,v=g===void 0?"#fff":g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:s})){this.judgeStyleAttributes({opacity:o,offsets:s});var _=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,_,this.cellProperties),C=x.data,S=x.width,M=x.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:m.LUMINANCE,type:m.FLOAT,width:S,height:M}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_additive:l==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,N.isNumber)(o)?o:1,u_offsets:this.isOffsetStatic(s)?s:[0,0],u_stroke_opacity:(0,N.isNumber)(f)?f:1,u_stroke_width:(0,N.isNumber)(h)?h:1,u_stroke_color:this.getStrokeColor(v)}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.layer.triangulation=Ec,s.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:EE,fragmentShader:_E,triangulation:Ec,depth:{enable:!1},primitive:m.POINTS});case 3:return o=s.sent,s.abrupt("return",[o]);case 5:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0]]:[u]}}})}}]),t}(he);function CE(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=SE(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function SE(r,a){if(!!r){if(typeof r=="string")return xc(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xc(r,a)}}function xc(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}var bE=function(){function r(a,t,n){(0,R.Z)(this,r),(0,d.Z)(this,"boxCells",[]);var e=this.boxCells;this.xCellCount=Math.ceil(a/n),this.yCellCount=Math.ceil(t/n);for(var i=0;i<this.xCellCount*this.yCellCount;i++)e.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=t,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,T.Z)(r,[{key:"insert",value:function(t,n,e,i,o){this.forEachCell(n,e,i,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o)}},{key:"query",value:function(t,n,e,i,o){return this.queryHitTest(t,n,e,i,!1,o)}},{key:"hitTest",value:function(t,n,e,i,o){return this.queryHitTest(t,n,e,i,!0,o)}},{key:"insertBoxCell",value:function(t,n,e,i,o,u){this.boxCells[o].push(u)}},{key:"queryHitTest",value:function(t,n,e,i,o,u){if(e<0||t>this.width||i<0||n>this.height)return o?!1:[];var s=[];if(t<=0&&n<=0&&this.width<=e&&this.height<=i){if(o)return!0;for(var l=0;l<this.boxKeys.length;l++)s.push({key:this.boxKeys[l],x1:this.bboxes[l*4],y1:this.bboxes[l*4+1],x2:this.bboxes[l*4+2],y2:this.bboxes[l*4+3]});return u?s.filter(u):s}var c={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,e,i,this.queryCell,s,c,u),o?s.length>0:s}},{key:"queryCell",value:function(t,n,e,i,o,u,s,l){var c=s.seenUids,f=this.boxCells[o];if(f!==null){var p=this.bboxes,h=CE(f),g;try{for(h.s();!(g=h.n()).done;){var v=g.value;if(!c.box[v]){c.box[v]=!0;var _=v*4;if(t<=p[_+2]&&n<=p[_+3]&&e>=p[_+0]&&i>=p[_+1]&&(!l||l(this.boxKeys[v]))){if(s.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[v],x1:p[_],y1:p[_+1],x2:p[_+2],y2:p[_+3]})}}}}catch(x){h.e(x)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(t,n,e,i,o,u,s,l){for(var c=this.convertToXCellCoord(t),f=this.convertToYCellCoord(n),p=this.convertToXCellCoord(e),h=this.convertToYCellCoord(i),g=c;g<=p;g++)for(var v=f;v<=h;v++){var _=this.xCellCount*v+g;if(o.call(this,t,n,e,i,_,u,s,l))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),r}(),AE=bE,TE=function(){function r(a,t){(0,R.Z)(this,r),(0,d.Z)(this,"viewportPadding",100),this.width=a,this.height=t,this.viewportPadding=Math.max(a,t),this.grid=new AE(a+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,T.Z)(r,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,e=t.y1+t.anchorPointY+this.viewportPadding,i=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,e,i,o)||this.grid.hitTest(n,e,i,o)?{box:[]}:{box:[n,e,i,o]}}},{key:"insertCollisionBox",value:function(t,n){var e={featureIndex:n};this.grid.insert(e,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,e){var i=lr.al(n,e,0,1),o=lr.Ue(),u=ee.fromValues.apply(ee,(0,G.Z)(t));return lr.fF(o,i,u),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,e,i){return e>=0&&t<this.gridRightBoundary&&i>=0&&n<this.gridBottomBoundary}}]),r}();function Cc(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=ME(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function ME(r,a){if(!!r){if(typeof r=="string")return Sc(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sc(r,a)}}function Sc(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function bc(r){var a=.5,t=.5;switch(r){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(r){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:a,verticalAlign:t}}function Ac(r,a,t,n,e){if(!!e){var i=r[n],o=i.glyph;if(o)for(var u=a[o].advance*i.scale,s=(r[n].x+u)*e,l=t;l<=n;l++)r[l].x-=s}}function Tc(r,a,t,n,e,i,o){var u=(a-t)*e,s=(-n*o+.5)*i,l=Cc(r),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.x+=u,f.y+=s}}catch(p){l.e(p)}finally{l.f()}}function LE(r,a,t,n,e,i,o){var u=-8,s=0,l=u,c=0,f=r.positionedGlyphs,p=i==="right"?1:i==="left"?0:.5,h=f.length;t.forEach(function(C){if(C.split("").forEach(function(M){var L=a[M],D=0;L&&(f.push({glyph:M,x:s,y:l+D,vertical:!1,scale:1,metrics:L}),s+=L.advance+o)}),f.length!==h){var S=s-o;c=Math.max(S,c),Ac(f,a,h,f.length-1,p)}s=0,l-=n+5});var g=bc(e),v=g.horizontalAlign,_=g.verticalAlign;Tc(f,p,v,_,c,n,t.length);var x=l-u;r.top+=-_*x,r.bottom=r.top-x,r.left+=-v*c,r.right=r.left+c}function RE(r,a,t,n,e,i,o){var u=-8,s=0,l=u,c=0,f=r.positionedGlyphs,p=i==="right"?1:i==="left"?0:.5,h=f.length;t.forEach(function(C){var S=a[C],M=0;if(S&&(f.push({glyph:C,x:S.advance/2,y:l+M,vertical:!1,scale:1,metrics:S}),s+=S.advance+o),f.length!==h){var L=s-o;c=Math.max(L,c),Ac(f,a,h,f.length-1,p)}s=0,l-=n+5});var g=bc(e),v=g.horizontalAlign,_=g.verticalAlign;Tc(f,p,v,_,c,n,t.length);var x=l-u;r.top+=-_*x,r.bottom=r.top-x,r.left+=-v*c,r.right=r.left+c}function kE(r,a,t,n,e,i){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],u=arguments.length>7?arguments[7]:void 0,s=r.split(`
`),l=[],c={positionedGlyphs:l,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:s.length,text:r};return u?RE(c,a,s,t,n,e,i):LE(c,a,s,t,n,e,i),l.length?c:!1}function FE(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=r.positionedGlyphs,e=n===void 0?[]:n,i=[],o=Cc(e),u;try{for(o.s();!(u=o.n()).done;){var s=u.value,l=s.metrics,c=4,f=l.advance*s.scale/2,p=t?[s.x+f,s.y]:[0,0],h=t?[0,0]:[s.x+f+a[0],s.y+a[1]],g=(0-c)*s.scale-f+h[0],v=(0-c)*s.scale+h[1],_=g+l.width*s.scale,x=v+l.height*s.scale,C={x:g,y:v},S={x:_,y:v},M={x:g,y:x},L={x:_,y:x};i.push({tl:C,tr:S,bl:M,br:L,tex:l,glyphOffset:p})}}catch(D){o.e(D)}finally{o.f()}return i}function wE(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=OE(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function OE(r,a){if(!!r){if(typeof r=="string")return Mc(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Mc(r,a)}}function Mc(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function DE(r){var a=IE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Lc=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,Rc=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function kc(r){var a=this,t=r.id,n=[],e=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=a.glyphInfoMap[t].centroid,o=i.length===2?[i[0],i[1],0]:i;return a.glyphInfoMap[t].glyphQuads.forEach(function(u,s){n.push.apply(n,(0,G.Z)(o).concat([u.tex.x,u.tex.y+u.tex.height,u.tl.x,u.tl.y],(0,G.Z)(o),[u.tex.x+u.tex.width,u.tex.y+u.tex.height,u.tr.x,u.tr.y],(0,G.Z)(o),[u.tex.x+u.tex.width,u.tex.y,u.br.x,u.br.y],(0,G.Z)(o),[u.tex.x,u.tex.y,u.bl.x,u.bl.y])),e.push(0+s*4,1+s*4,2+s*4,2+s*4,3+s*4,0+s*4)}),{vertices:n,indices:e,size:7}}var Fc=function(r){(0,F.Z)(t,r);var a=DE(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"glyphInfoMap",{}),(0,d.Z)((0,E.Z)(n),"currentZoom",-1),(0,d.Z)((0,E.Z)(n),"textureHeight",0),(0,d.Z)((0,E.Z)(n),"textCount",0),(0,d.Z)((0,E.Z)(n),"preTextStyle",{}),(0,d.Z)((0,E.Z)(n),"mapping",(0,k.Z)(y().mark(function u(){return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n.initGlyph(),n.updateTexture(),l.next=4,n.reBuildModel();case 4:case"end":return l.stop()}},u)}))),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.stroke,s=u===void 0?"#fff":u,l=e.strokeWidth,c=l===void 0?0:l,f=e.halo,p=f===void 0?.5:f,h=e.gamma,g=h===void 0?2:h,v=e.raisingHeight,_=v===void 0?0:v,x=this.getFontServiceMapping(),C=this.getFontServiceCanvas();if(x&&Object.keys(x).length!==this.textCount&&C&&(this.updateTexture(),this.textCount=Object.keys(x).length),this.preTextStyle=this.getTextStyle(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeWidth:c,stroke:s})){this.judgeStyleAttributes({opacity:o,strokeWidth:c,stroke:s});var S=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,S,this.cellProperties),L=M.data,D=M.width,B=M.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:m.LUMINANCE,type:m.FLOAT,width:D,height:B}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(_),u_opacity:(0,N.isNumber)(o)?o:1,u_stroke_width:(0,N.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(s),u_sdf_map:this.texture,u_halo_blur:p,u_gamma_scale:g,u_sdf_map_size:[(C==null?void 0:C.width)||1,(C==null?void 0:C.height)||1]}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.preTextStyle=this.getTextStyle(),u.abrupt("return",this.buildModels());case 4:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.layer.getLayerConfig(),u=o.textAllowOverlap,s=u===void 0?!1:u,this.initGlyph(),this.updateTexture(),s||this.filterGlyphs(),f.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Rc,fragmentShader:Lc,triangulation:kc.bind(this),depth:{enable:!1}});case 6:return l=f.sent,f.abrupt("return",[l]);case 8:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"needUpdate",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h,g,v,_,x;return y().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(o=this.getTextStyle(),u=o.textAllowOverlap,s=u===void 0?!1:u,l=o.textAnchor,c=l===void 0?"center":l,f=o.textOffset,p=o.padding,h=o.fontFamily,g=o.fontWeight,!(!(0,N.isEqual)(p,this.preTextStyle.padding)||!(0,N.isEqual)(f,this.preTextStyle.textOffset)||!(0,N.isEqual)(c,this.preTextStyle.textAnchor)||!(0,N.isEqual)(h,this.preTextStyle.fontFamily)||!(0,N.isEqual)(g,this.preTextStyle.fontWeight))){S.next=5;break}return S.next=4,this.mapping();case 4:return S.abrupt("return",!0);case 5:if(!s){S.next=7;break}return S.abrupt("return",!1);case 7:if(v=this.mapService.getZoom(),_=this.mapService.getBounds(),x=si(this.extent,_),!(Math.abs(this.currentZoom-v)>.5||!x||s!==this.preTextStyle.textAllowOverlap)){S.next=14;break}return S.next=13,this.reBuildModel();case 13:return S.abrupt("return",!0);case 14:return S.abrupt("return",!1);case 15:case"end":return S.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:X.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i){var o=i.rotate,u=o===void 0?0:o;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:X.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u){return[u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?12:o;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:X.Attribute,descriptor:{name:"a_tex",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return xn(e,.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),i=e.fontWeight,o=e.fontFamily,u=this.layer.getEncodedData(),s=[];u.forEach(function(l){var c=l.shape,f=c===void 0?"":c;f=f.toString();var p=wE(f),h;try{for(p.s();!(h=p.n()).done;){var g=h.value;s.indexOf(g)===-1&&s.push(g)}}catch(v){p.e(v)}finally{p.f()}}),this.fontService.setFontOptions({characterSet:s,fontWeight:i,fontFamily:o,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),i=e.fontWeight,o=e.fontFamily,u=this.layer.getEncodedData(),s=[];u.forEach(function(l){var c=l.shape,f=c===void 0?"":c;f="".concat(f),s.indexOf(f)===-1&&s.push(f)}),this.fontService.setFontOptions({characterSet:s,fontWeight:i,fontFamily:o,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),i=e.fontWeight,o=i===void 0?"400":i,u=e.fontFamily,s=u===void 0?"sans-serif":u,l=e.textAllowOverlap,c=l===void 0?!1:l,f=e.padding,p=f===void 0?[0,0]:f,h=e.textAnchor,g=h===void 0?"center":h,v=e.textOffset,_=v===void 0?[0,0]:v,x=e.opacity,C=x===void 0?1:x,S=e.strokeOpacity,M=S===void 0?1:S,L=e.strokeWidth,D=L===void 0?0:L,B=e.stroke,I=B===void 0?"#000":B;return{fontWeight:o,fontFamily:s,textAllowOverlap:c,padding:p,textAnchor:g,textOffset:_,opacity:C,strokeOpacity:M,strokeWidth:D,stroke:I}}},{key:"generateGlyphLayout",value:function(e){var i=this,o=this.getFontServiceMapping(),u=this.layer.getLayerConfig(),s=u.spacing,l=s===void 0?2:s,c=u.textAnchor,f=c===void 0?"center":c,p=u.textOffset,h=this.layer.getEncodedData();this.glyphInfo=h.map(function(g){var v=g.shape,_=v===void 0?"":v,x=g.id,C=g.size,S=C===void 0?1:C,M=kE(_.toString(),o,S,f,"left",l,p||g.textOffset||[0,0],e),L=FE(M,p,!1);return g.shaping=M,g.glyphQuads=L,g.centroid=lt(g.coordinates),g.originCentroid=g.version==="GAODE2.x"?lt(g.originCoordinates):g.originCentroid=g.centroid,i.glyphInfoMap[x]={shaping:M,glyphQuads:L,centroid:lt(g.coordinates)},g})}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),i=e.fontWeight,o=i===void 0?"400":i,u=e.fontFamily,s=u===void 0?"sans-serif":u;return this.fontService.getMappingByKey("".concat(s,"_").concat(o))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),i=e.fontWeight,o=i===void 0?"400":i,u=e.fontFamily,s=u===void 0?"sans-serif":u;return this.fontService.getCanvasByKey("".concat(s,"_").concat(o))}},{key:"filterGlyphs",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.padding,u=o===void 0?[0,0]:o,s=i.textAllowOverlap,l=s===void 0?!1:s;if(!l){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var c=this.rendererService.getViewportSize(),f=c.width,p=c.height,h=new TE(f,p),g=this.glyphInfo.filter(function(v){var _=v.shaping,x=v.id,C=x===void 0?0:x,S=v.version==="GAODE2.x"?v.originCentroid:v.centroid,M=v.size,L=M/16,D=e.mapService.lngLatToContainer(S),B=h.placeCollisionBox({x1:_.left*L-u[0],x2:_.right*L+u[0],y1:_.top*L-u[1],y2:_.bottom*L+u[1],anchorPointX:D.x,anchorPointY:D.y}),I=B.box;return I&&I.length?(h.insertCollisionBox(I,C),!0):!1});g.forEach(function(v){e.glyphInfoMap[v.id]=v})}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig(),i=e.iconfont,o=i===void 0?!1:i;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,i=this.getFontServiceCanvas();this.textureHeight=i.height,this.texture&&this.texture.destroy(),this.texture=e({data:i,mag:m.LINEAR,min:m.LINEAR,width:i.width,height:i.height})}},{key:"reBuildModel",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.filterGlyphs(),s.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Rc,fragmentShader:Lc,triangulation:kc.bind(this),depth:{enable:!1}});case 3:o=s.sent,this.layer.models=[o];case 5:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()}]),t}(he),PE={fillImage:rE,fill:gc,radar:gE,image:mc,normal:_c,simplePoint:xE,extrude:dc,text:Fc,earthFill:G2,earthExtrude:z2},BE=PE;function NE(r,a){var t=typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=ZE(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var n=0,e=function(){};return{s:e,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function ZE(r,a){if(!!r){if(typeof r=="string")return wc(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wc(r,a)}}function wc(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=r[t];return n}function zE(r){var a=UE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function UE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Cr=function(r){(0,F.Z)(t,r);var a=zE(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"type","PointLayer"),(0,d.Z)((0,E.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,T.Z)(t,[{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new BE[o](this),s.next=5,this.initLayerModels();case 5:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"rebuildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.buildModels();case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,i=e.field,o=e.values,u=this.getLayerConfig(),s=u.shape2d,l=this.iconService.getIconMap();if(i&&(s==null?void 0:s.indexOf(i))!==-1)return"fill";if(o==="text")return"text";if(o&&o instanceof Array){var c=NE(o),f;try{for(c.s();!(f=c.n()).done;){var p=f.value;if(typeof p=="string"&&l.hasOwnProperty(p))return"image"}}catch(h){c.e(h)}finally{c.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return i[e]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),i=this.getLayerConfig(),o=i.shape2d,u=i.shape3d,s=this.iconService.getIconMap(),l=e.find(function(f){return f.hasOwnProperty("shape")});if(l){var c=l.shape;return c==="dot"?"normal":c==="simple"?"simplePoint":c==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(o==null?void 0:o.indexOf(c))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(u==null?void 0:u.indexOf(c))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":s.hasOwnProperty(c)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(en);function HE(r){var a=jE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var VE=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,GE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,WE=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$E=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,XE=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,YE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,KE=function(r){(0,F.Z)(t,r);var a=HE(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.heightfixed,s=u===void 0?!1:u,l=e.raisingHeight,c=l===void 0?0:l,f=e.topsurface,p=f===void 0?!0:f,h=e.sidesurface,g=h===void 0?!0:h,v=e.sourceColor,_=e.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),S=C.data,M=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:m.LUMINANCE,type:m.FLOAT,width:M,height:L}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}var D=0,B=[1,1,1,1],I=[1,1,1,1];return v&&_&&(B=ue(v),I=ue(_),D=1),{u_topsurface:Number(p),u_sidesurface:Number(g),u_heightfixed:Number(s),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(c),u_opacity:(0,N.isNumber)(o)?o:1,u_linearColor:D,u_sourceColor:B,u_targetColor:I,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.loadTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=this.getShaders(),u=o.frag,s=o.vert,l=o.type,p.next=3,this.layer.buildLayerModel({moduleName:l,vertexShader:s,fragmentShader:u,triangulation:C_});case 3:return c=p.sent,p.abrupt("return",[c]);case 5:case"end":return p.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.pickLight,o=e.mapTexture;return o?{frag:WE,vert:$E,type:"polygonExtrudeTexture"}:i?{frag:XE,vert:YE,type:"polygonExtrudePickLight"}:{frag:VE,vert:GE,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e,i;(e=this.dataTexture)===null||e===void 0||e.destroy(),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,i=(0,W.Z)(e,4),o=i[0],u=i[1],s=i[2],l=i[3],c=s-o,f=l-u;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:X.Attribute,descriptor:{name:"a_uvs",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(h,g,v){var _=v[0],x=v[1];return[(_-o)/c,(x-u)/f,v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:X.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(h,g,v,_,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:X.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(h){var g=h.size,v=g===void 0?10:g;return Array.isArray(v)?[v[0]]:[v]}}})}},{key:"loadTexture",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.mapTexture,u=this.rendererService.createTexture2D;if(this.texture=u({height:0,width:0}),o){var s=new Image;s.crossOrigin="",s.src=o,s.onload=function(){e.texture=u({data:s,width:s.width,height:s.height,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE,min:m.LINEAR,mag:m.LINEAR}),e.layerService.reRender()}}}}]),t}(he);function QE(r){var a=qE();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var JE=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ex=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tx=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,nx=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,rx=function(r){(0,F.Z)(t,r);var a=QE(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.raisingHeight,o=i===void 0?0:i,u=e.opacity,s=u===void 0?1:u,l=e.opacityLinear,c=l===void 0?{enable:!1,dir:"in"}:l;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var f=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,f,this.cellProperties),h=p.data,g=p.width,v=p.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&h.length>0?this.createTexture2D({flipY:!0,data:h,format:m.LUMINANCE,type:m.FLOAT,width:g,height:v}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(o),u_opacity:(0,N.isNumber)(s)?s:1,u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h,g,v;return y().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.getModelParams(),u=o.frag,s=o.vert,l=o.triangulation,c=o.type,f=this.layer.getLayerConfig(),p=f.workerEnabled,h=p===void 0?!1:p,g=f.enablePicking,this.layer.triangulation=l,x.next=5,this.layer.buildLayerModel({moduleName:c,vertexShader:s,fragmentShader:u,triangulation:l,primitive:m.TRIANGLES,depth:{enable:!1},workerEnabled:h,workerOptions:{modelType:c,enablePicking:g}});case 5:return v=x.sent,x.abrupt("return",[v]);case 7:case"end":return x.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig(),i=e.opacityLinear,o=i===void 0?{enable:!1,dir:"in"}:i;o.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:X.Attribute,descriptor:{name:"a_linear",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(s,l,c){return[c[3],c[4],c[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig(),i=e.opacityLinear,o=i===void 0?{enable:!1}:i;return o.enable?{frag:ex,vert:tx,type:"polygonLinear",triangulation:E_}:{frag:JE,vert:nx,type:"polygonFill",triangulation:Lo}}}]),t}(he);function ix(r){var a=ax();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function ax(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var ox=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,ux=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,sx=function(r){(0,F.Z)(t,r);var a=ix(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.watercolor,s=u===void 0?"#6D99A8":u,l=e.watercolor2,c=l===void 0?"#0F121C":l;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:ue(s),u_watercolor2:ue(c),u_opacity:(0,N.isNumber)(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.loadTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:ux,fragmentShader:ox,triangulation:Ki,primitive:m.TRIANGLES,depth:{enable:!1}});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i,o;(e=this.texture1)===null||e===void 0||e.destroy(),(i=this.texture2)===null||i===void 0||i.destroy(),(o=this.texture3)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,i=(0,W.Z)(e,4),o=i[0],u=i[1],s=i[2],l=i[3],c=s-o,f=l-u;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:X.Attribute,descriptor:{name:"a_uv",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(h,g,v,_){var x=h.version===Fe["GAODE2.x"]?h.originCoordinates[0][_]:v,C=(0,W.Z)(x,2),S=C[0],M=C[1];return[(S-o)/c,(M-u)/f]}}})}},{key:"loadTexture",value:function(){var e=this,i=this.rendererService.createTexture2D,o={height:0,width:0};this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),u(function(l){e.texture1=s(l[0]),e.texture2=s(l[1]),e.texture3=s(l[2]),e.layerService.reRender()});function u(l){var c=0,f=[],p=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];p.map(function(h){var g=new Image;g.crossOrigin="",g.src=h,f.push(g),g.onload=function(){c++,c===3&&l(f)}})}function s(l){return i({data:l,width:l.width,height:l.height,wrapS:m.MIRRORED_REPEAT,wrapT:m.MIRRORED_REPEAT,min:m.LINEAR,mag:m.LINEAR})}}}]),t}(he);function lx(r){var a=cx();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function cx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var fx=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,px=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,hx=function(r){(0,F.Z)(t,r);var a=lx(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.speed,s=u===void 0?.5:u;return{u_texture:this.texture,u_speed:s,u_opacity:(0,N.isNumber)(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.loadTexture(),u.abrupt("return",this.buildModels());case 2:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:px,fragmentShader:fx,triangulation:Ki,primitive:m.TRIANGLES,depth:{enable:!1}});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,i=(0,W.Z)(e,4),o=i[0],u=i[1],s=i[2],l=i[3],c=s-o,f=l-u;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:X.Attribute,descriptor:{name:"a_uv",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(h,g,v,_){var x=h.version===Fe["GAODE2.x"]?h.originCoordinates[0][_]:v,C=(0,W.Z)(x,2),S=C[0],M=C[1];return[(S-o)/c,(M-u)/f]}}})}},{key:"loadTexture",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.waterTexture,u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0});var s=new Image;s.crossOrigin="",o?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),s.src=o):s.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",s.onload=function(){e.texture=u({data:s,width:s.width,height:s.height,wrapS:m.MIRRORED_REPEAT,wrapT:m.MIRRORED_REPEAT,min:m.LINEAR,mag:m.LINEAR}),e.layerService.reRender()}}}]),t}(he),dx={fill:rx,line:pc,extrude:KE,text:Fc,point_fill:gc,point_image:mc,point_normal:_c,point_extrude:dc,water:hx,ocean:sx},vx=dx;function gx(r){var a=mx();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function mx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Sr=function(r){(0,F.Z)(t,r);var a=gx(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"type","PolygonLayer"),n}return(0,T.Z)(t,[{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=this.getModelType(),this.layerModel=new vx[o](this),s.next=4,this.initLayerModels();case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getModelType",value:function(){var e,i=this.styleAttributeService.getLayerStyleAttribute("shape"),o=i==null||(e=i.scale)===null||e===void 0?void 0:e.field;return o==="fill"||!o?"fill":o==="extrude"?"extrude":o==="water"?"water":o==="ocean"?"ocean":o==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),i=this.getLayerConfig(),o=i.shape2d,u=i.shape3d,s=this.iconService.getIconMap(),l=e.find(function(f){return f.hasOwnProperty("shape")});if(l){var c=l.shape;return c==="dot"?"point_normal":(o==null?void 0:o.indexOf(c))!==-1?"point_fill":(u==null?void 0:u.indexOf(c))!==-1?"point_extrude":s.hasOwnProperty(c)?"point_image":"text"}else return"fill"}}]),t}(en);function yx(r){var a=_x();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function _x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ex=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,xx=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Cx=function(r){(0,F.Z)(t,r);var a=yx(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.color,s=u===void 0?"#000":u;return{u_opacity:(0,N.isNumber)(o)?o:0,u_color:ue(s)}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.buildModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:xx,fragmentShader:Ex,triangulation:Ki,depth:{enable:!1},pick:!1});case 2:return o=s.sent,s.abrupt("return",[o]);case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(he),Sx={fill:Cx},bx=Sx;function Ax(r){var a=Tx();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Tx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Oc=function(r){(0,F.Z)(t,r);var a=Ax(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"type","MaskLayer"),n}return(0,T.Z)(t,[{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=this.getModelType(),this.layerModel=new bx[o](this),s.next=4,this.initLayerModels();case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getModelType",value:function(){return"fill"}}]),t}(en),Dc,Ic,Pc,Bc,br,Nc,Zc,Mx=(Dc=(0,j.b2)(),Ic=(0,j.f3)(w.IMapService),Pc=(0,j.f3)(w.IFontService),Dc(Bc=(br=function(){function r(){(0,R.Z)(this,r),(0,J.Z)(this,"mapService",Nc,this),(0,J.Z)(this,"fontService",Zc,this)}return(0,T.Z)(r,[{key:"apply",value:function(t,n){var e=this,i=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,k.Z)(y().mark(function o(){return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t.log(me.MappingStart,ge.INIT),e.generateMaping(t,{styleAttributeService:i}),t.log(me.MappingEnd,ge.INIT);case 3:case"end":return s.stop()}},o)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var o=(0,k.Z)(y().mark(function u(s){var l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s){f.next=2;break}return f.abrupt("return",s);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(me.MappingStart,ge.UPDATE),l=e.generateMaping(t,{styleAttributeService:i}),t.log(me.MappingEnd,ge.UPDATE),f.abrupt("return",l);case 7:case"end":return f.stop()}},u)}));return function(u){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var o=t.getSource();if(!(t.layerModelNeedUpdate||!o||!o.inited)){var u=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter"),l=o.data.dataArray;if(!(Array.isArray(l)&&l.length===0)){var c=u.filter(function(h){return h.needRemapping}),f=l;if(s!=null&&s.needRemapping&&s!==null&&s!==void 0&&s.scale&&(f=l.filter(function(h){return e.applyAttributeMapping(s,h)[0]})),c.length){var p=e.mapping(t,c,f,t.getEncodedData());t.setEncodedData(p)}}}})}},{key:"generateMaping",value:function(t,n){var e=this,i=n.styleAttributeService,o=i.getLayerStyleAttributes()||[],u=i.getLayerStyleAttribute("filter"),s=t.getSource().data.dataArray,l=s;u!=null&&u.scale&&(l=s.filter(function(f){return e.applyAttributeMapping(u,f)[0]})),l=t.processData(l);var c=this.mapping(t,o,l,void 0);return t.setEncodedData(c),s.length===0&&t.encodeDataLength===0?!1:(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,n,e,i){var o=this,u=t.getLayerConfig(),s=u.arrow,l=s===void 0?{enable:!1}:s,c=n.filter(function(p){return p.scale!==void 0}).filter(function(p){return p.name!=="filter"}),f=e.map(function(p,h){var g=i?i[h]:{},v=(0,A.Z)({id:p._id,coordinates:p.coordinates},g);if(c.forEach(function(C){var S=o.applyAttributeMapping(C,p);C.name==="color"&&(S=S.map(function(M){return ue(M)})),v[C.name]=Array.isArray(S)&&S.length===1?S[0]:S,C.name==="shape"&&(v.shape=o.fontService.getIconFontKey(v[C.name]))}),l.enable&&(v.shape==="line"||v.shape==="halfLine")){var _=v.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var x=o.getArrowPoints(_[0],_[1]);v.coordinates.splice(1,0,x,x),t.arrowInsertCount++}}return v});return n.forEach(function(p){p.needRemapping=!1}),this.adjustData2Amap2Coordinates(f,t),this.adjustData2SimpleCoordinates(f),f}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var e=this;if(t.length>0&&this.mapService.version===Fe["GAODE2.x"]){var i=n.coordCenter||n.getSource().center;typeof t[0].coordinates[0]=="number"?t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=Fe["GAODE2.x"],o.originCoordinates=(0,N.cloneDeep)(o.coordinates),o.coordinates=e.mapService.lngLatToCoordByLayer(o.coordinates,i)}):t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=Fe["GAODE2.x"],o.originCoordinates=(0,N.cloneDeep)(o.coordinates),o.coordinates=e.mapService.lngLatToCoordsByLayer(o.coordinates,i)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===Fe.SIMPLE&&t.map(function(e){e.simpleCoordinate||(e.coordinates=n.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var e=[];return t.map(function(o){var u=[];o.map(function(s){u.push(n.mapService.simpleMapCoord.unproject(s))}),e.push(u)}),e}else{var i=[];return t.map(function(o){i.push(n.mapService.simpleMapCoord.unproject(o))}),i}}},{key:"applyAttributeMapping",value:function(t,n){var e;if(!t.scale)return[];var i=(t==null||(e=t.scale)===null||e===void 0?void 0:e.scalers)||[],o=[];i.forEach(function(s){var l,c=s.field;(n.hasOwnProperty(c)||((l=t.scale)===null||l===void 0?void 0:l.type)==="variable")&&o.push(n[c])});var u=t.mapping?t.mapping(o):[];return u}},{key:"getArrowPoints",value:function(t,n){var e=[n[0]-t[0],n[1]-t[1]],i=fo(e),o=[t[0]+i[0]*1e-4,t[1]+i[1]*1e-4];return o}}]),r}(),Nc=(0,q.Z)(br.prototype,"mapService",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zc=(0,q.Z)(br.prototype,"fontService",[Pc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),br))||Bc),zc,Uc,Lx=(zc=(0,j.b2)(),zc(Uc=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(w.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,k.Z)(y().mark(function e(){var i,o,u,s;return y().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(t.log(me.SourceInitStart,ge.INIT),i=t.getSource(),i||(o=t.sourceOption||t.defaultSourceConfig,u=o.data,s=o.options,i=new On(u,s),t.setSource(i)),!i.inited){c.next=8;break}n.updateClusterData(t),t.log(me.SourceInitEnd,ge.INIT),c.next=10;break;case 8:return c.next=10,new Promise(function(f){i.on("update",function(p){p.type==="inited"&&(n.updateClusterData(t),t.log(me.SourceInitEnd,ge.INIT)),f(null)})});case 10:case"end":return c.stop()}},e)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,k.Z)(y().mark(function e(){var i,o,u;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return i=n.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,u=i||o,l.abrupt("return",u);case 5:case"end":return l.stop()}},e)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),e=n.cluster,i=n.clusterOptions.zoom,o=i===void 0?0:i,u=this.mapService.getZoom()-1,s=t.dataState.dataSourceNeedUpdate;return e&&s&&n.updateClusterData(Math.floor(u)),e&&Math.abs(t.clusterZoom-u)>=1?(o!==Math.floor(u)&&n.updateClusterData(Math.floor(u)),t.clusterZoom=u,!0):!1}}]),r}())||Uc),Hc=z(94587),Rx=z(87765),Xe=z(16050);function jc(r){var a,t=[];function n(e){return e==null?a:e}return n.invert=n,n.domain=n.range=function(e){return e?(t=e,e):t},n.unknown=function(e){return e?(a=e,e):a},n.copy=function(){return jc(r).unknown(a)},n}var He,Vc,Gc,kx=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Fx=(He={},(0,d.Z)(He,le.LINEAR,Xe.BY),(0,d.Z)(He,le.POWER,Xe.vY),(0,d.Z)(He,le.LOG,Xe.p2),(0,d.Z)(He,le.IDENTITY,jc),(0,d.Z)(He,le.SEQUENTIAL,Xe.cJ),(0,d.Z)(He,le.TIME,Xe.Xf),(0,d.Z)(He,le.QUANTILE,Xe.FT),(0,d.Z)(He,le.QUANTIZE,Xe.aE),(0,d.Z)(He,le.THRESHOLD,Xe.ut),(0,d.Z)(He,le.CAT,Xe.PK),(0,d.Z)(He,le.DIVERGING,Xe.AB),He),Ox=(Vc=(0,j.b2)(),Vc(Gc=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"scaleOptions",{})}return(0,T.Z)(r,[{key:"apply",value:function(t,n){var e=this,i=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,k.Z)(y().mark(function o(){var u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(t.log(me.ScaleInitStart,ge.INIT),e.scaleOptions=t.getScaleOptions(),s=i.getLayerStyleAttributes(),l=(u=t.getSource())===null||u===void 0?void 0:u.data.dataArray,!(Array.isArray(l)&&l.length===0)){f.next=8;break}return f.abrupt("return");case 8:e.caculateScalesForAttributes(s||[],l);case 9:t.log(me.ScaleInitEnd,ge.INIT);case 10:case"end":return f.stop()}},o)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var o=(0,k.Z)(y().mark(function u(s){var l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(s){p.next=2;break}return p.abrupt("return",s);case 2:if(t.log(me.ScaleInitStart,ge.UPDATE),e.scaleOptions=t.getScaleOptions(),l=i.getLayerStyleAttributes(),c=t.getSource().data.dataArray,!(Array.isArray(c)&&c.length===0)){p.next=8;break}return p.abrupt("return",!0);case 8:return e.caculateScalesForAttributes(l||[],c),t.log(me.ScaleInitEnd,ge.UPDATE),t.layerModelNeedUpdate=!0,p.abrupt("return",!0);case 12:case"end":return p.stop()}},u)}));return function(u){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){e.scaleOptions=t.getScaleOptions();var o=i.getLayerStyleAttributes(),u=t.getSource().data.dataArray;if(!(Array.isArray(u)&&u.length===0)&&o){var s=o.filter(function(l){return l.needRescale});s.length&&e.caculateScalesForAttributes(s,u)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var e=this;t.forEach(function(i){if(i.scale){var o=i.scale;o.names=e.parseFields(i.scale.field||[]);var u=[];o.names.forEach(function(s){var l;u.push(e.createScale(s,i.name,(l=i.scale)===null||l===void 0?void 0:l.values,n))}),u.some(function(s){return s.type===St.VARIABLE})?(o.type=St.VARIABLE,u.forEach(function(s){if(!o.callback&&o.values!=="text"){var l;switch((l=s.option)===null||l===void 0?void 0:l.type){case le.LOG:case le.LINEAR:case le.POWER:if(o.values&&o.values.length>2){var c=s.scale.ticks(o.values.length);s.scale.domain(c)}o.values?s.scale.range(o.values):s.scale.range(s.option.domain);break;case le.QUANTILE:case le.QUANTIZE:case le.THRESHOLD:s.scale.range(o.values);break;case le.IDENTITY:break;case le.CAT:o.values?s.scale.range(o.values):s.scale.range(s.option.domain);break;case le.DIVERGING:case le.SEQUENTIAL:s.scale.interpolator(Rx.hD(o.values));break}}if(o.values==="text"){var f;s.scale.range((f=s.option)===null||f===void 0?void 0:f.domain)}})):(o.type=St.CONSTANT,o.defaultValues=u.map(function(s,l){return s.scale(o.names[l])})),o.scalers=u.map(function(s){return{field:s.field,func:s.scale,option:s.option}}),i.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,N.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,e,i){var o,u,s=this.scaleOptions[n]&&((o=this.scaleOptions[n])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],l={field:t,scale:void 0,type:St.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?l.scale=this.createDefaultScale(s):(l.scale=Xe.PK([t]),l.type=St.CONSTANT),l;var c=(u=i.find(function(h){return!(0,N.isNil)(h[t])}))===null||u===void 0?void 0:u[t];if(this.isNumber(t)||(0,N.isNil)(c)&&!s)l.scale=Xe.PK([t]),l.type=St.CONSTANT;else{var f=s&&s.type||this.getDefaultType(c);e==="text"&&(f=le.CAT);var p=this.createScaleConfig(f,t,s,i);l.scale=this.createDefaultScale(p),l.option=p}return l}},{key:"getDefaultType",value:function(t){var n=le.LINEAR;return typeof t=="string"&&(n=kx.test(t)?le.TIME:le.CAT),n}},{key:"createScaleConfig",value:function(t,n,e,i){var o={type:t},u=(i==null?void 0:i.map(function(c){return c[n]}))||[];if(e!=null&&e.domain)o.domain=e==null?void 0:e.domain;else if(t===le.CAT||t===le.IDENTITY)o.domain=(0,N.uniq)(u);else if(t===le.QUANTILE)o.domain=u;else if(t===le.DIVERGING){var s=(0,Hc.We)(u),l=(e==null?void 0:e.neutral)!==void 0?e==null?void 0:e.neutral:(s[0]+s[1])/2;o.domain=[s[0],l,s[1]]}else o.domain=(0,Hc.We)(u);return(0,A.Z)((0,A.Z)({},o),e)}},{key:"createDefaultScale",value:function(t){var n=t.type,e=t.domain,i=t.unknown,o=t.clamp,u=t.nice,s=Fx[n]();return e&&s.domain&&s.domain(e),i&&s.unknown(i),o!==void 0&&s.clamp&&s.clamp(o),u!==void 0&&s.nice&&s.nice(u),s}}]),r}())||Gc),Wc,$c,Dx=(Wc=(0,j.b2)(),Wc($c=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(e){e.addUniforms((0,A.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),r}())||$c),Xc,Yc,Ix=(Xc=(0,j.b2)(),Xc(Yc=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),e=n.maskLayers,i=n.enableMask;if(!t.tileLayer&&e&&e.length>0){var o;(o=t.masks).push.apply(o,(0,G.Z)(e)),t.updateLayerConfig({mask:i})}})}}]),r}())||Yc),Px=function(){function r(a){var t=a.rendererService,n=a.layerService,e=a.parent;(0,R.Z)(this,r),(0,d.Z)(this,"tileResource",new Map),(0,d.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=e}return(0,T.Z)(r,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(i){return i.key===t}),e=this.layerTiles.splice(n,1);e[0]&&e[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);n==null||n.updateVisible(t.isVisible)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var e=this.getTile(n==null?void 0:n.key);return!!(e!=null&&e.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,e=t==null?void 0:t.children;return e.length===0?!0:e.some(function(i){var o=n.getTile(i==null?void 0:i.key);return(o==null?void 0:o.isLoaded)===!1})}},{key:"render",value:function(){var a=(0,k.Z)(y().mark(function n(){var e=this,i,o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i=this.getRenderLayers(),o=i.map(function(){var l=(0,k.Z)(y().mark(function c(f){return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.layerService.renderTileLayer(f);case 2:case"end":return h.stop()}},c)}));return function(c){return l.apply(this,arguments)}}()),Promise.all(o);case 3:case"end":return s.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(e){return e.visible&&e.isLoaded}),n=[];return t.map(function(e){return n.push.apply(n,(0,G.Z)(e.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(e){return e.isLoaded}),n=[];return t.map(function(e){return n.push.apply(n,(0,G.Z)(e.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),r}(),Bx=z(95335),Nx=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"getCombineFeature",value:function(t){var n=null,e=t[0];return t.map(function(i){var o=mt.yu(i.coordinates);n===null?n=o:n=(0,Bx.Z)(n,o)}),e&&(n.properties=(0,A.Z)({},e)),n}}]),r}(),Zn="select",zn="active",Zx=function(){function r(a){var t=a.layerService,n=a.tileLayerService,e=a.parent;(0,R.Z)(this,r),(0,d.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=e,this.tileSourceService=new Nx}return(0,T.Z)(r,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var e=n.getMainLayer();e==null||e.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var e=this.parent.getContainer(),i=e.get(w.IPickingService);if(t.type==="RasterLayer"){var o=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(o&&o.getMainLayer()!==void 0){var u=o.getMainLayer();return u.layerPickService.pickRasterLayer(u,n,this.parent)}return!1}return this.pickRender(n),i.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=(0,W.Z)(t,3),e=n[0],i=n[1],o=n[2],u=this.color2PickId(e,i,o);this.tilePickID.set(Zn,u),this.updateHighLight(e,i,o,Zn)}},{key:"highlightPickedFeature",value:function(t){var n=(0,W.Z)(t,3),e=n[0],i=n[1],o=n[2],u=this.color2PickId(e,i,o);this.tilePickID.set(zn,u),this.updateHighLight(e,i,o,zn)}},{key:"updateHighLight",value:function(t,n,e,i){this.tileLayerService.tiles.map(function(o){var u=o.getMainLayer();switch(i){case Zn:u==null||u.hooks.beforeSelect.call([t,n,e]);break;case zn:u==null||u.hooks.beforeHighlight.call([t,n,e]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Zn),n=this.tilePickID.get(zn);if(t){var e=this.pickId2Color(t),i=(0,W.Z)(e,3),o=i[0],u=i[1],s=i[2];this.updateHighLight(o,u,s,Zn);return}if(n){var l=this.pickId2Color(n),c=(0,W.Z)(l,3),f=c[0],p=c[1],h=c[2];this.updateHighLight(f,p,h,zn);return}}},{key:"color2PickId",value:function(t,n,e){return wt(new Uint8Array([t,n,e]))}},{key:"pickId2Color",value:function(t){return st(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(i){return i.visible}),e=[];return n.forEach(function(i){e.push.apply(e,(0,G.Z)(i.getFeatureById(t)))}),e}},{key:"pickRasterLayer",value:function(t,n,e){return!1}}]),r}(),zx=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function Ux(r){return r==="PolygonLayer"?Sr:r==="LineLayer"?Nn:Cr}function Hx(r){return["PolygonLayer","LineLayer"].indexOf(r)!==-1}var zt=function(){function r(a,t){(0,R.Z)(this,r),(0,d.Z)(this,"visible",!0),(0,d.Z)(this,"layers",[]),(0,d.Z)(this,"isLoaded",!1),(0,d.Z)(this,"tileMaskLayers",[]),this.parent=t,this.sourceTile=a,this.x=a.x,this.y=a.y,this.z=a.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return(0,T.Z)(r,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var n=(0,W.Z)(this.sourceTile.bounds,4),e=n[0],i=n[1],o=n[2],u=n[3],s=t.lng,l=t.lat;return s>=e&&s<=o&&l>=i&&l<=u}},{key:"getLayerOptions",value:function(){var t,n=this.parent.getLayerConfig();return(0,A.Z)((0,A.Z)({},n),{},{autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Hx(this.parent.type),mask:n.mask||((t=n.maskLayers)===null||t===void 0?void 0:t.length)!==0&&n.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,n=this.parent.getLayerConfig(),e=n.maskLayers,i=[];return e==null||e.forEach(function(o){if(!o.tileLayer)return i.push(o),o;var u=o.tileLayer,s=u.getTile(t.sourceTile.key),l=s==null?void 0:s.getLayers()[0];l&&i.push(l)}),i}},{key:"addTileMask",value:function(){var a=(0,k.Z)(y().mark(function n(){var e,i,o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=new Sr({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),i=Fn(this.parent.sceneContainer),e.setContainer(i,this.parent.sceneContainer),s.next=5,e.init();case 5:return this.tileMask=e,o=this.getMainLayer(),o!==void 0&&(o.tileMask=e),s.abrupt("return",e);case 9:case"end":return s.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"addMask",value:function(){var a=(0,k.Z)(y().mark(function n(e,i){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=Fn(this.parent.sceneContainer),i.setContainer(o,this.parent.sceneContainer),s.next=4,i.init();case 4:e.addMask(i),this.tileMaskLayers.push(i);case 6:case"end":return s.stop()}},n,this)}));function t(n,e){return a.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var a=(0,k.Z)(y().mark(function n(e){var i;return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return e.isTileLayer=!0,i=Fn(this.parent.sceneContainer),e.setContainer(i,this.parent.sceneContainer),this.layers.push(e),u.next=6,e.init();case 6:case"end":return u.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,n){this.layers.forEach(function(e){e.updateLayerConfig((0,d.Z)({},t,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(function(n){return n.destroy()})}}]),r}();function jx(r){var a=Vx();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function Vx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Gx=function(r){(0,F.Z)(t,r);var a=jx(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.getSourceOption(),u=o.data.features[0].properties,s=new Nn().source(o.data,o.options).size(1).shape("line").color("red"),l=new Cr({minZoom:this.z-1,maxZoom:this.z+1}).source([u],{parser:{type:"json",x:"textLng",y:"textLat"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),f.next=6,this.addLayer(s);case 6:return f.next=8,this.addLayer(l);case 8:this.isLoaded=!0;case 9:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),i=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:i},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),t}(zt);function Wx(r){var a=$x();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function $x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Xx=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,Yx=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Kx=function(r){(0,F.Z)(t,r);var a=Wx(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity;return{u_opacity:i||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o=this,u,s,l,c,f,p;return y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=this.layer.getSource(),s=this.rendererService.createTexture2D,this.texture=s({height:0,width:0}),!Ne){g.next=11;break}l=this.layerService.sceneService.getSceneConfig().canvas,c=l.createImage(),c.crossOrigin="anonymous",c.src=u.data.originData,c.onload=function(){o.texture=s({data:c,width:c.width,height:c.height}),o.layerService.reRender()},g.next=15;break;case 11:return g.next=13,u.data.images;case 13:f=g.sent,this.texture=s({data:f[0],width:f[0].width,height:f[0].height,mag:m.LINEAR,min:m.LINEAR});case 15:return g.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:Yx,fragmentShader:Xx,triangulation:yr,primitive:m.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return p=g.sent,g.abrupt("return",[p]);case 19:case"end":return g.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),t}(he),Qx={image:Kx},qx=Qx;function Jx(r){var a=eC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var tC=function(r){(0,F.Z)(t,r);var a=Jx(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"type","ImageLayer"),n}return(0,T.Z)(t,[{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=this.getModelType(),this.layerModel=new qx[o](this),s.next=4,this.initLayerModels();case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={image:{}};return i[e]}},{key:"getModelType",value:function(){return"image"}}]),t}(en);function nC(r){var a=rC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var iC=function(r){(0,F.Z)(t,r);var a=nC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),s=this.getSourceOption(),l=new tC((0,A.Z)({},u)).source(s.data,s.options),o&&Object.keys(o).forEach(function(p){var h,g,v=p;l[v]((h=o[v])===null||h===void 0?void 0:h.field,(g=o[v])===null||g===void 0?void 0:g.values)}),f.next=7,this.addLayer(l);case 7:this.isLoaded=!0;case 8:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),t}(zt);function aC(r){var a=oC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function oC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var uC=function(r){(0,F.Z)(t,r);var a=aC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),s=this.getSourceOption(),l=new Oc((0,A.Z)({},u)).source(s.data,s.options),o&&Object.keys(o).forEach(function(p){var h,g,v=p;l[v]((h=o[v])===null||h===void 0?void 0:h.field,(g=o[v])===null||g===void 0?void 0:g.values)}),f.next=7,this.addLayer(l);case 7:this.isLoaded=!0;case 8:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getFeatures",value:function(e){if(!e)return[];var i=this.sourceTile.data;return i.getTileData(e)}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),i=this.parent.getLayerConfig(),o=i.sourceLayer,u=i.featureId,s=this.getFeatures(o);return{data:{type:"FeatureCollection",features:s},options:{parser:{type:"geojson",featureId:u},transforms:e.transforms}}}}]),t}(zt);function sC(r){var a=lC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var cC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,fC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Kc=function(r){(0,F.Z)(t,r);var a=sC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.clampLow,s=u===void 0?!0:u,l=e.clampHigh,c=l===void 0?!0:l,f=e.noDataValue,p=f===void 0?-9999999:f,h=e.domain,g=e.rampColors,v=h||ti(g);return this.colorTexture=this.layer.textureService.getColorTexture(g,v),{u_opacity:o||1,u_texture:this.texture,u_domain:v,u_clampLow:s,u_clampHigh:typeof c!="undefined"?c:s,u_noDataValue:p,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,k.Z)(y().mark(function i(o){var u,s,l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!Array.isArray(o.data)){p.next=4;break}return p.abrupt("return",{data:o.data,width:o.width,height:o.height});case 4:return p.next=6,o.data;case 6:return u=p.sent,s=u.rasterData,l=u.width,c=u.height,p.abrupt("return",{data:Array.from(s),width:l,height:c});case 11:case"end":return p.stop()}},i)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=this.layer.getSource(),u=this.rendererService.createTexture2D,s=o.data.dataArray[0],v.next=5,this.getRasterData(s);case 5:return l=v.sent,c=l.data,f=l.width,p=l.height,this.texture=u({data:c,width:f,height:p,format:m.LUMINANCE,type:m.FLOAT}),v.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:fC,fragmentShader:cC,triangulation:yr,primitive:m.TRIANGLES,depth:{enable:!1}});case 12:return h=v.sent,v.abrupt("return",[h]);case 14:case"end":return v.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),t}(he),pC=["data"],hC=["rasterData"];function dC(r){var a=vC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var gC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,mC=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,yC=function(r){(0,F.Z)(t,r);var a=dC(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"dataOption",{}),n}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.noDataValue,s=u===void 0?0:u,l=this.dataOption,c=l.rMinMax,f=l.gMinMax,p=l.bMinMax;return{u_opacity:o||1,u_texture:this.texture,u_noDataValue:s,u_rminmax:c,u_gminmax:f,u_bminmax:p}}},{key:"getRasterData",value:function(){var n=(0,k.Z)(y().mark(function i(o){var u,s,l,c,f;return y().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!Array.isArray(o.data)){h.next=4;break}return u=o.data,s=(0,Re.Z)(o,pC),this.dataOption=s,h.abrupt("return",(0,A.Z)({data:u},s));case 4:return h.next=6,o.data;case 6:if(l=h.sent,c=l.rasterData,f=(0,Re.Z)(l,hC),this.dataOption=f,!Array.isArray(c)){h.next=14;break}return h.abrupt("return",(0,A.Z)({data:c},f));case 14:return h.abrupt("return",(0,A.Z)({data:Array.from(c)},f));case 15:case"end":return h.stop()}},i,this)}));function e(i){return n.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=this.layer.getSource(),u=this.rendererService.createTexture2D,s=o.data.dataArray[0],v.next=5,this.getRasterData(s);case 5:return l=v.sent,c=l.data,f=l.width,p=l.height,this.texture=u({data:c,width:f,height:p,format:m.RGB,type:m.FLOAT}),v.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:gC,fragmentShader:mC,triangulation:yr,primitive:m.TRIANGLES,depth:{enable:!1}});case 12:return h=v.sent,v.abrupt("return",[h]);case 14:case"end":return v.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),t}(he);function _C(r){var a=EC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var xC=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,CC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,SC=function(r){(0,F.Z)(t,r);var a=_C(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=e.clampLow,u=o===void 0?!0:o,s=e.clampHigh,l=s===void 0?!0:s,c=e.noDataValue,f=c===void 0?-9999999:c,p=e.domain,h=e.rampColors,g=e.colorTexture,v=e.rScaler,_=v===void 0?6553.6:v,x=e.gScaler,C=x===void 0?25.6:x,S=e.bScaler,M=S===void 0?.1:S,L=e.offset,D=L===void 0?1e4:L,B=p||ti(h),I=g;return g?this.layer.textureService.setColorTexture(g,h,B):I=this.layer.textureService.getColorTexture(h,B),{u_opacity:i||1,u_texture:this.texture,u_domain:B,u_clampLow:u,u_clampHigh:typeof l!="undefined"?l:u,u_noDataValue:f,u_unpack:[_,C,M,D],u_colorTexture:I}}},{key:"initModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.layer.getSource(),u=this.rendererService.createTexture2D,f.next=4,o.data.images;case 4:return s=f.sent,this.texture=u({data:s[0],width:s[0].width,height:s[0].height,min:m.LINEAR,mag:m.LINEAR}),f.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:CC,fragmentShader:xC,triangulation:yr,primitive:m.TRIANGLES,depth:{enable:!1}});case 8:return l=f.sent,f.abrupt("return",[l]);case 10:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.initModels());case 1:case"end":return u.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:X.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),t}(he),bC={raster:Kc,rasterRgb:yC,raster3d:Kc,rasterTerrainRgb:SC},AC=bC;function TC(r){var a=MC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ji=function(r){(0,F.Z)(t,r);var a=TC(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"type","RasterLayer"),n}return(0,T.Z)(t,[{key:"buildModels",value:function(){var n=(0,k.Z)(y().mark(function i(){var o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=this.getModelType(),this.layerModel=new AC[o](this),s.next=4,this.initLayerModels();case 4:case"end":return s.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return i[e]}},{key:"getModelType",value:function(){var e=this.layerSource.getParserType();switch(e){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(en),LC=["rasterData"];function RC(r){var a=kC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var FC=function(r){(0,F.Z)(t,r);var a=RC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),s=this.getSourceOption(),l=new Ji((0,A.Z)({},u)).source(s.data,s.options),o&&Object.keys(o).forEach(function(p){var h,g,v=p;l[v]((h=o[v])===null||h===void 0?void 0:h.field,(g=o[v])===null||g===void 0?void 0:g.values)}),f.next=7,this.addLayer(l);case 7:this.isLoaded=!0;case 8:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),i=this.sourceTile.data.data,o=i.rasterData,u=(0,Re.Z)(i,LC);return{data:o,options:{parser:(0,A.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},u),transforms:e.transforms}}}}]),t}(zt);function wC(r){var a=OC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function OC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var DC=function(r){(0,F.Z)(t,r);var a=wC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),s=this.getSourceOption(),l=new Ji((0,A.Z)({},u)).source(s.data,s.options),o&&Object.keys(o).forEach(function(p){var h,g,v=p;l[v]((h=o[v])===null||h===void 0?void 0:h.field,(g=o[v])===null||g===void 0?void 0:g.values)}),f.next=7,this.addLayer(l);case 7:this.isLoaded=!0;case 8:case"end":return f.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),t}(zt),IC=["rasterData"];function PC(r){var a=BC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function BC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var NC={positions:[0,1],colors:["#000","#fff"]},ZC=function(r){(0,F.Z)(t,r);var a=PC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p;return y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),s=this.getSourceOption(),l=this.getLayerOptions(),c=l.rampColors,f=l.domain,this.colorTexture=this.parent.textureService.getColorTexture(c,f),p=new Ji((0,A.Z)((0,A.Z)({},u),{},{colorTexture:this.colorTexture})).source(s.data,s.options),o&&Object.keys(o).forEach(function(v){var _,x,C=v;p[C]((_=o[C])===null||_===void 0?void 0:_.field,(x=o[C])===null||x===void 0?void 0:x.values)}),g.next=9,this.addLayer(p);case 9:this.isLoaded=!0;case 10:case"end":return g.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),i=this.sourceTile.data.data,o=i.rasterData,u=(0,Re.Z)(i,IC);return{data:o,options:{parser:(0,A.Z)({type:"raster",extent:this.sourceTile.bounds},u),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];var s=o,l=s.rampColors,c=l===void 0?NC:l,f=s.domain;this.colorTexture=this.parent.textureService.getColorTexture(c,f||ti(c)),this.layers.forEach(function(p){return p.style({colorTexture:e.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(e){return e.destroy()})}}]),t}(zt);function zC(r){var a=UC();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var Ar=function(r){(0,F.Z)(t,r);var a=zC(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c;return y().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=this.parent.getLayerAttributeConfig(),u=this.getLayerOptions(),s=Ux(this.parent.type),l=this.getSourceOption(),l){p.next=7;break}return this.isLoaded=!0,p.abrupt("return");case 7:return c=new s((0,A.Z)({},u)).source(l.data,l.options),Object.keys(o).forEach(function(h){var g,v,_=h;c[_]((g=o[_])===null||g===void 0?void 0:g.field,(v=o[_])===null||v===void 0?void 0:v.values)}),p.next=11,this.addLayer(c);case 11:if(!u.tileMask){p.next=14;break}return p.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(c),this.isLoaded=!0;case 16:case"end":return p.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),i=this.parent.getLayerConfig(),o=i.sourceLayer,u=o===void 0?"defaultLayer":o,s=i.featureId,l=s===void 0?"id":s,c=this.getFeatures(u);return{data:{type:"FeatureCollection",features:c},options:{parser:{type:"geojson",featureId:l},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){e.getModelType()==="text"&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){var i=this.sourceTile.data;return i.getTileData(e)}},{key:"getFeatureById",value:function(e){var i=this.getMainLayer();if(!i)return[];var o=i.getSource().data.dataArray.filter(function(u){return u._id===e});return o}}]),t}(zt);function HC(r){var a=r.type;switch(a){case"PolygonLayer":return Ar;case"LineLayer":return Ar;case"PointLayer":return Ar;case"TileDebugLayer":return Gx;case"MaskLayer":return uC;case"RasterLayer":var t=r.getSource().parser.dataType;switch(t){case xe.RGB:case xe.CUSTOMRGB:return FC;case xe.ARRAYBUFFER:case xe.CUSTOMARRAYBUFFER:return ZC;case xe.TERRAINRGB:case xe.CUSTOMTERRAINRGB:return DC;default:return iC}default:return Ar}}var Qc=function(){function r(a){var t=this;(0,R.Z)(this,r),(0,d.Z)(this,"initedTileset",!1),(0,d.Z)(this,"mapchange",function(){var e,i=t.getCurrentView(),o=i.latLonBounds,u=i.zoom;if(t.mapService.version==="GAODE1.x"){var s=t.parent.getLayerConfig(),l=s.visible;u<2&&l?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):u>=2&&!l&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===u&&t.lastViewStates.latLonBounds.toString()===o.toString()||(t.lastViewStates={zoom:u,latLonBounds:o},(e=t.tilesetManager)===null||e===void 0||e.throttleUpdate(u,o))}),(0,d.Z)(this,"viewchange",(0,N.debounce)(this.mapchange,24)),this.parent=a;var n=this.parent.getContainer();this.rendererService=n.get(w.IRendererService),this.layerService=n.get(w.ILayerService),this.mapService=n.get(w.IMapService),this.pickingService=n.get(w.IPickingService),this.tileLayerService=new Px({rendererService:this.rendererService,layerService:this.layerService,parent:a}),this.tilePickService=new Zx({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:a}),this.parent.setLayerPickService(this.tilePickService),this.proxy(a),this.initTileSetManager()}return(0,T.Z)(r,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var e=this.getCurrentView(),i=e.latLonBounds,o=e.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,i)}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],e=this.mapService.getZoom();return{latLonBounds:n,zoom:e}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,e){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),e=n.latLonBounds,i=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(i,e)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var a=(0,k.Z)(y().mark(function n(){var e=this,i,o;return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(this.tilesetManager){s.next=2;break}return s.abrupt("return");case 2:return i=this.parent.getMinZoom(),o=this.parent.getMaxZoom(),s.next=6,Promise.all(this.tilesetManager.tiles.filter(function(l){return l.isLoaded}).filter(function(l){return l.isVisibleChange}).filter(function(l){return l.data}).filter(function(l){return l.z>=i&&l.z<o}).map(function(){var l=(0,k.Z)(y().mark(function c(f){var p,h;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e.tileLayerService.hasTile(f.key)){v.next=9;break}return p=HC(e.parent),h=new p(f,e.parent),v.next=5,h.initTileLayer();case 5:e.tilePickService.setPickState(),h.getLayers().length!==0&&(e.tileLayerService.addTile(h),e.tileLayerService.updateTileVisible(f),e.layerService.reRender()),v.next=12;break;case 9:e.tileLayerService.updateTileVisible(f),e.tilePickService.setPickState(),e.layerService.reRender();case 12:case"end":return v.stop()}},c)}));return function(c){return l.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return s.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;zx.forEach(function(e){var i=t[e].bind(t);t[e]=function(){for(var o=arguments.length,u=new Array(o),s=0;s<o;s++)u[s]=arguments[s];return i.apply(void 0,u),n.getLayers().map(function(l){l[e].apply(l,u)}),e==="style"&&n.getTiles().forEach(function(l){return l.styleUpdate.apply(l,u)}),t}})}}]),r}(),qc,Jc,jC=(qc=(0,j.b2)(),qc(Jc=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"build",value:function(){var a=(0,k.Z)(y().mark(function n(e){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return e.prepareBuildModel(),o.next=3,e.buildModels();case 3:case"end":return o.stop()}},n)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var a=(0,k.Z)(y().mark(function n(e){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return o.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var a=(0,k.Z)(y().mark(function n(e){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.build(e);case 2:case"end":return o.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,k.Z)(y().mark(function e(){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!t.getSource().isTile){o.next=4;break}return t.prepareBuildModel(),t.tileLayer=new Qc(t),o.abrupt("return");case 4:return t.log(me.BuildModelStart,ge.INIT),o.next=7,n.initLayerModel(t);case 7:t.log(me.BuildModelEnd,ge.INIT);case 8:case"end":return o.stop()}},e)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var e=(0,k.Z)(y().mark(function i(o){return y().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(o){s.next=2;break}return s.abrupt("return",!1);case 2:if(!t.getSource().isTile){s.next=5;break}return t.tileLayer=new Qc(t),s.abrupt("return",!1);case 5:return t.log(me.BuildModelStart,ge.UPDATE),s.next=8,n.prepareLayerModel(t);case 8:return t.log(me.BuildModelEnd,ge.UPDATE),s.abrupt("return",!0);case 10:case"end":return s.stop()}},i)}));return function(i){return e.apply(this,arguments)}}())}}]),r}())||Jc),ef,tf,VC=(ef=(0,j.b2)(),ef(tf=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),e=n.autoFit,i=n.fitBoundsOptions;e&&t.fitBounds(i)})}}]),r}())||tf),nf,rf,GC=["type"],af={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},WC={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},$C={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},XC={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function YC(r){var a={u_DirectionalLights:new Array(3).fill((0,A.Z)({},$C)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,A.Z)({},XC)),u_NumOfSpotLights:0};return(!r||!r.length)&&(r=[WC]),r.forEach(function(t){var n=t.type,e=n===void 0?"directional":n,i=(0,Re.Z)(t,GC),o=af[e].lights,u=af[e].num,s=a[u];a[o][s]=(0,A.Z)((0,A.Z)({},a[o][s]),i),a[u]++}),a}var KC=(nf=(0,j.b2)(),nf(rf=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),e=n.enableLighting;e&&t.models.forEach(function(i){return i.addUniforms((0,A.Z)({},YC()))})})}}]),r}())||rf),of,uf,QC=(of=(0,j.b2)(),of(uf=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t,n){var e=this,i=n.rendererService,o=n.postProcessingPassFactory,u=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var s=t.getLayerConfig(),l=s.enableMultiPassRenderer,c=s.passes,f=c===void 0?[]:c;e.enabled=!!l&&t.getLayerConfig().enableMultiPassRenderer!==!1,e.enabled&&(t.multiPassRenderer=Gl(t,f,o,u),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(e.enabled){var s=i.getViewportSize(),l=s.width,c=s.height;t.multiPassRenderer.resize(l,c)}})}}]),r}())||uf),sf,lf,Tr={NONE:0,ENCODE:1,HIGHLIGHT:2},qC=(sf=(0,j.b2)(),sf(lf=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t,n){var e=n.styleAttributeService;t.hooks.init.tapPromise("PixelPickingPlugin",function(){var i=t.getLayerConfig(),o=i.enablePicking;e.registerStyleAttribute({name:"pickingColor",type:X.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:m.FLOAT},size:3,update:function(s){var l=s.id;return o?st(l):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var i=t.getLayerConfig(),o=i.enablePicking;o&&t.isVisible()&&t.models.forEach(function(u){return u.addUniforms({u_PickingStage:Tr.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var i=t.getLayerConfig(),o=i.enablePicking;o&&t.isVisible()&&t.models.forEach(function(u){return u.addUniforms({u_PickingStage:Tr.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(i){var o=t.getLayerConfig(),u=o.highlightColor,s=o.activeMix,l=s===void 0?0:s,c=typeof u=="string"?ue(u):u||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:wt(new Uint8Array(i))}),t.models.forEach(function(f){return f.addUniforms({u_PickingStage:Tr.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:c.map(function(p){return p*255}),u_activeMix:l})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(i){var o=t.getLayerConfig(),u=o.selectColor,s=o.selectMix,l=s===void 0?0:s,c=typeof u=="string"?ue(u):u||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:wt(new Uint8Array(i))}),t.models.forEach(function(f){return f.addUniforms({u_PickingStage:Tr.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:c.map(function(p){return p*255}),u_activeMix:l,u_CurrentSelectedId:i,u_SelectColor:c.map(function(p){return p*255}),u_EnableSelect:1})})})}}]),r}())||lf),JC=["mvt","geojsonvt","testTile"];function e3(r){var a=r.getSource();return JC.includes(a.parser.type)}function $b(r){return r.getContext?{width:r.width/DOM.DPR,height:r.height/DOM.DPR}:r.getBoundingClientRect()}var cf,ff,t3=(cf=(0,j.b2)(),cf(ff=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t,n){var e=this,i=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){e3(t)||e.registerBuiltinAttributes(i,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:X.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:m.FLOAT},size:3,update:function(e,i,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:X.Attribute,descriptor:{name:"filter",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(e){var i=e.filter;return i?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:X.Attribute,descriptor:{name:"a_Color",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:X.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(e,i){return[i]}}})}}]),r}())||ff),pf,hf,df,vf,gf,mf,an,yf,_f,Ef,xf,n3=(pf=(0,j.b2)(),hf=(0,j.f3)(w.ICameraService),df=(0,j.f3)(w.ICoordinateSystemService),vf=(0,j.f3)(w.IRendererService),gf=(0,j.f3)(w.IMapService),pf(mf=(an=function(){function r(){(0,R.Z)(this,r),(0,J.Z)(this,"cameraService",yf,this),(0,J.Z)(this,"coordinateSystemService",_f,this),(0,J.Z)(this,"rendererService",Ef,this),(0,J.Z)(this,"mapService",xf,this)}return(0,T.Z)(r,[{key:"apply",value:function(t){var n=this,e=this.mapService.version,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var u=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(u),e==="GAODE2.x"&&(n.setLayerCenter(t),i=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter());var s=n.rendererService.getViewportSize(),l=s.width,c=s.height;t.models.forEach(function(f){var p;f.addUniforms((p={},(0,d.Z)(p,Nt.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,d.Z)(p,Nt.ViewMatrix,n.cameraService.getViewMatrix()),(0,d.Z)(p,Nt.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,d.Z)(p,Nt.Zoom,n.cameraService.getZoom()),(0,d.Z)(p,Nt.ZoomScale,n.cameraService.getZoomScale()),(0,d.Z)(p,Nt.FocalDistance,n.cameraService.getFocalDistance()),(0,d.Z)(p,Nt.CameraPosition,n.cameraService.getCameraPosition()),(0,d.Z)(p,Pt.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,d.Z)(p,Pt.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,d.Z)(p,Pt.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,d.Z)(p,Pt.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,d.Z)(p,Pt.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,d.Z)(p,Pt.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,d.Z)(p,Pt.Mvp,i),(0,d.Z)(p,"u_SceneCenterMKT",o),(0,d.Z)(p,"u_ViewportSize",[l,c]),(0,d.Z)(p,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,d.Z)(p,"u_DevicePixelRatio",se.devicePixelRatio),(0,d.Z)(p,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,d.Z)(p,"u_shaderPick",Number(t.getShaderPickStat())),p))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}}]),r}(),yf=(0,q.Z)(an.prototype,"cameraService",[hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f=(0,q.Z)(an.prototype,"coordinateSystemService",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ef=(0,q.Z)(an.prototype,"rendererService",[vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xf=(0,q.Z)(an.prototype,"mapService",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),an))||mf),Cf,Sf,r3=(Cf=(0,j.b2)(),Cf(Sf=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),r}())||Sf),bf,Af,i3=(bf=(0,j.b2)(),bf(Af=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"apply",value:function(t,n){var e=this,i=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){e.initStyleAttribute(t,{styleAttributeService:i})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&e.updateStyleAttribute(t,{styleAttributeService:i})})}},{key:"updateStyleAttribute",value:function(t,n){var e=n.styleAttributeService,i=e.getLayerStyleAttributes()||[],o=e.getLayerStyleAttribute("filter");if(o&&o.needRegenerateVertices){t.layerModelNeedUpdate=!0,i.forEach(function(u){return u.needRegenerateVertices=!1});return}i.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){e.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex,t),u.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var e=n.styleAttributeService,i=e.getLayerStyleAttributes()||[];i.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){e.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),r}())||Af);De.bind(w.ILayerPlugin).to(Lx).inRequestScope(),De.bind(w.ILayerPlugin).to(t3).inRequestScope(),De.bind(w.ILayerPlugin).to(Ox).inRequestScope(),De.bind(w.ILayerPlugin).to(Mx).inRequestScope(),De.bind(w.ILayerPlugin).to(VC).inRequestScope(),De.bind(w.ILayerPlugin).to(Ix).inRequestScope(),De.bind(w.ILayerPlugin).to(i3).inRequestScope(),De.bind(w.ILayerPlugin).to(r3).inRequestScope(),De.bind(w.ILayerPlugin).to(QC).inRequestScope(),De.bind(w.ILayerPlugin).to(n3).inRequestScope(),De.bind(w.ILayerPlugin).to(Dx).inRequestScope(),De.bind(w.ILayerPlugin).to(KC).inRequestScope(),De.bind(w.ILayerPlugin).to(qC).inRequestScope(),De.bind(w.ILayerPlugin).to(jC).inRequestScope();var a3=z(88307),o3=z.n(a3),u3=function(){function r(a,t){(0,R.Z)(this,r);var n=t.buffer,e=t.offset,i=t.stride,o=t.normalized,u=t.size,s=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:e||0,stride:i||0,normalized:o||!1,divisor:s||0},u&&(this.attribute.size=u)}return(0,T.Z)(r,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),r}(),vt,Un,gt,Ye,Hn,Lt,jn,Mr,it,Ut,Le,at,ot,Lr,s3=(vt={},(0,d.Z)(vt,m.POINTS,"points"),(0,d.Z)(vt,m.LINES,"lines"),(0,d.Z)(vt,m.LINE_LOOP,"line loop"),(0,d.Z)(vt,m.LINE_STRIP,"line strip"),(0,d.Z)(vt,m.TRIANGLES,"triangles"),(0,d.Z)(vt,m.TRIANGLE_FAN,"triangle fan"),(0,d.Z)(vt,m.TRIANGLE_STRIP,"triangle strip"),vt),Tf=(Un={},(0,d.Z)(Un,m.STATIC_DRAW,"static"),(0,d.Z)(Un,m.DYNAMIC_DRAW,"dynamic"),(0,d.Z)(Un,m.STREAM_DRAW,"stream"),Un),ea=(gt={},(0,d.Z)(gt,m.BYTE,"int8"),(0,d.Z)(gt,m.UNSIGNED_INT,"int16"),(0,d.Z)(gt,m.INT,"int32"),(0,d.Z)(gt,m.UNSIGNED_BYTE,"uint8"),(0,d.Z)(gt,m.UNSIGNED_SHORT,"uint16"),(0,d.Z)(gt,m.UNSIGNED_INT,"uint32"),(0,d.Z)(gt,m.FLOAT,"float"),gt),l3=(Ye={},(0,d.Z)(Ye,m.ALPHA,"alpha"),(0,d.Z)(Ye,m.LUMINANCE,"luminance"),(0,d.Z)(Ye,m.LUMINANCE_ALPHA,"luminance alpha"),(0,d.Z)(Ye,m.RGB,"rgb"),(0,d.Z)(Ye,m.RGBA,"rgba"),(0,d.Z)(Ye,m.RGBA4,"rgba4"),(0,d.Z)(Ye,m.RGB5_A1,"rgb5 a1"),(0,d.Z)(Ye,m.RGB565,"rgb565"),(0,d.Z)(Ye,m.DEPTH_COMPONENT,"depth"),(0,d.Z)(Ye,m.DEPTH_STENCIL,"depth stencil"),Ye),c3=(Hn={},(0,d.Z)(Hn,m.DONT_CARE,"dont care"),(0,d.Z)(Hn,m.NICEST,"nice"),(0,d.Z)(Hn,m.FASTEST,"fast"),Hn),Mf=(Lt={},(0,d.Z)(Lt,m.NEAREST,"nearest"),(0,d.Z)(Lt,m.LINEAR,"linear"),(0,d.Z)(Lt,m.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,d.Z)(Lt,m.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,d.Z)(Lt,m.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,d.Z)(Lt,m.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Lt),Lf=(jn={},(0,d.Z)(jn,m.REPEAT,"repeat"),(0,d.Z)(jn,m.CLAMP_TO_EDGE,"clamp"),(0,d.Z)(jn,m.MIRRORED_REPEAT,"mirror"),jn),f3=(Mr={},(0,d.Z)(Mr,m.NONE,"none"),(0,d.Z)(Mr,m.BROWSER_DEFAULT_WEBGL,"browser"),Mr),p3=(it={},(0,d.Z)(it,m.NEVER,"never"),(0,d.Z)(it,m.ALWAYS,"always"),(0,d.Z)(it,m.LESS,"less"),(0,d.Z)(it,m.LEQUAL,"lequal"),(0,d.Z)(it,m.GREATER,"greater"),(0,d.Z)(it,m.GEQUAL,"gequal"),(0,d.Z)(it,m.EQUAL,"equal"),(0,d.Z)(it,m.NOTEQUAL,"notequal"),it),Rf=(Ut={},(0,d.Z)(Ut,m.FUNC_ADD,"add"),(0,d.Z)(Ut,m.MIN_EXT,"min"),(0,d.Z)(Ut,m.MAX_EXT,"max"),(0,d.Z)(Ut,m.FUNC_SUBTRACT,"subtract"),(0,d.Z)(Ut,m.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ut),Rr=(Le={},(0,d.Z)(Le,m.ZERO,"zero"),(0,d.Z)(Le,m.ONE,"one"),(0,d.Z)(Le,m.SRC_COLOR,"src color"),(0,d.Z)(Le,m.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,d.Z)(Le,m.SRC_ALPHA,"src alpha"),(0,d.Z)(Le,m.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,d.Z)(Le,m.DST_COLOR,"dst color"),(0,d.Z)(Le,m.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,d.Z)(Le,m.DST_ALPHA,"dst alpha"),(0,d.Z)(Le,m.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,d.Z)(Le,m.CONSTANT_COLOR,"constant color"),(0,d.Z)(Le,m.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,d.Z)(Le,m.CONSTANT_ALPHA,"constant alpha"),(0,d.Z)(Le,m.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,d.Z)(Le,m.SRC_ALPHA_SATURATE,"src alpha saturate"),Le),h3=(at={},(0,d.Z)(at,m.NEVER,"never"),(0,d.Z)(at,m.ALWAYS,"always"),(0,d.Z)(at,m.LESS,"less"),(0,d.Z)(at,m.LEQUAL,"lequal"),(0,d.Z)(at,m.GREATER,"greater"),(0,d.Z)(at,m.GEQUAL,"gequal"),(0,d.Z)(at,m.EQUAL,"equal"),(0,d.Z)(at,m.NOTEQUAL,"notequal"),at),on=(ot={},(0,d.Z)(ot,m.ZERO,"zero"),(0,d.Z)(ot,m.KEEP,"keep"),(0,d.Z)(ot,m.REPLACE,"replace"),(0,d.Z)(ot,m.INVERT,"invert"),(0,d.Z)(ot,m.INCR,"increment"),(0,d.Z)(ot,m.DECR,"decrement"),(0,d.Z)(ot,m.INCR_WRAP,"increment wrap"),(0,d.Z)(ot,m.DECR_WRAP,"decrement wrap"),ot),v3=(Lr={},(0,d.Z)(Lr,m.FRONT,"front"),(0,d.Z)(Lr,m.BACK,"back"),Lr),g3=function(){function r(a,t){(0,R.Z)(this,r);var n=t.data,e=t.usage,i=t.type;this.buffer=a.buffer({data:n,usage:Tf[e||m.STATIC_DRAW],type:ea[i||m.UNSIGNED_BYTE]})}return(0,T.Z)(r,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,e=t.offset;this.buffer.subdata(n,e)}}]),r}(),m3=function(){function r(a,t){(0,R.Z)(this,r);var n=t.data,e=t.usage,i=t.type,o=t.count;this.elements=a.elements({data:n,usage:Tf[e||m.STATIC_DRAW],type:ea[i||m.UNSIGNED_BYTE],count:o})}return(0,T.Z)(r,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),r}(),y3=function(){function r(a,t){(0,R.Z)(this,r);var n=t.width,e=t.height,i=t.color,o=t.colors,u={width:n,height:e};Array.isArray(o)&&(u.colors=o.map(function(s){return s.get()})),i&&typeof i!="boolean"&&(u.color=i.get()),this.framebuffer=a.framebuffer(u)}return(0,T.Z)(r,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,e=t.height;this.framebuffer.resize(n,e)}}]),r}(),_3=function(){function r(a,t){(0,R.Z)(this,r),(0,d.Z)(this,"destroyed",!1),(0,d.Z)(this,"uniforms",{}),this.reGl=a;var n=t.vs,e=t.fs,i=t.attributes,o=t.uniforms,u=t.primitive,s=t.count,l=t.elements,c=t.depth,f=t.cull,p=t.instances,h={};this.options=t,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach(function(_){h[_]=a.prop(_)}));var g={};Object.keys(i).forEach(function(_){g[_]=i[_].get()});var v={attributes:g,frag:e,uniforms:h,vert:n,colorMask:a.prop("colorMask"),blend:{enable:a.prop("blend.enable"),func:a.prop("blend.func"),equation:a.prop("blend.equation"),color:a.prop("blend.color")},stencil:{enable:a.prop("stencil.enable"),mask:a.prop("stencil.mask"),func:a.prop("stencil.func"),opFront:a.prop("stencil.opFront"),opBack:a.prop("stencil.opBack")},primitive:s3[u===void 0?m.TRIANGLES:u]};p&&(v.instances=p),s?v.count=s:l&&(v.elements=l.get()),this.initDepthDrawParams({depth:c},v),this.initCullDrawParams({cull:f},v),this.drawCommand=a(v),this.drawParams=v}return(0,T.Z)(r,[{key:"updateAttributesAndElements",value:function(t,n){var e={};Object.keys(t).forEach(function(i){e[i]=t[i].get()}),this.drawParams.attributes=e,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(e){n[e]=t[e].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,A.Z)((0,A.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var e=(0,A.Z)((0,A.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),i={};Object.keys(e).forEach(function(o){var u=(0,yn.Z)(e[o]);u==="boolean"||u==="number"||Array.isArray(e[o])||e[o].BYTES_PER_ELEMENT?i[o]=e[o]:i[o]=e[o].get()}),i.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),i.stencil=this.getStencilDrawParams(t),i.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(i)}}},{key:"destroy",value:function(){var t,n;(t=this.drawParams)===null||t===void 0||(n=t.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(e){e==null||e.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var e=t.depth;e&&(n.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:p3[e.func||m.LESS],range:e.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,e=n||{},i=e.enable,o=e.func,u=e.equation,s=e.color,l=s===void 0?[0,0,0,0]:s;return{enable:!!i,func:{srcRGB:Rr[o&&o.srcRGB||m.SRC_ALPHA],srcAlpha:Rr[o&&o.srcAlpha||m.SRC_ALPHA],dstRGB:Rr[o&&o.dstRGB||m.ONE_MINUS_SRC_ALPHA],dstAlpha:Rr[o&&o.dstAlpha||m.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Rf[u&&u.rgb||m.FUNC_ADD],alpha:Rf[u&&u.alpha||m.FUNC_ADD]},color:l}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,e=n||{},i=e.enable,o=e.mask,u=o===void 0?-1:o,s=e.func,l=s===void 0?{cmp:m.ALWAYS,ref:0,mask:-1}:s,c=e.opFront,f=c===void 0?{fail:m.KEEP,zfail:m.KEEP,zpass:m.KEEP}:c,p=e.opBack,h=p===void 0?{fail:m.KEEP,zfail:m.KEEP,zpass:m.KEEP}:p;return{enable:!!i,mask:u,func:(0,A.Z)((0,A.Z)({},l),{},{cmp:h3[l.cmp]}),opFront:{fail:on[f.fail],zfail:on[f.zfail],zpass:on[f.zpass]},opBack:{fail:on[h.fail],zfail:on[h.zfail],zpass:on[h.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var e=t.stencil,i=e!=null&&e.enable&&e.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return i}},{key:"initCullDrawParams",value:function(t,n){var e=t.cull;if(e){var i=e.enable,o=e.face,u=o===void 0?m.BACK:o;n.cull={enable:!!i,face:v3[u]}}}},{key:"extractUniforms",value:function(t){var n=this,e={};return Object.keys(t).forEach(function(i){n.extractUniformsRecursively(i,t[i],e,"")}),e}},{key:"extractUniformsRecursively",value:function(t,n,e,i){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,N.isTypedArray)(n)||n===""||"resize"in n){e["".concat(i&&i+".").concat(t)]=n;return}(0,N.isPlainObject)(n)&&Object.keys(n).forEach(function(u){o.extractUniformsRecursively(u,n[u],e,"".concat(i&&i+".").concat(t))}),Array.isArray(n)&&n.forEach(function(u,s){Object.keys(u).forEach(function(l){o.extractUniformsRecursively(l,u[l],e,"".concat(i&&i+".").concat(t,"[").concat(s,"]"))})})}}]),r}(),E3=function(){function r(a,t){(0,R.Z)(this,r),(0,d.Z)(this,"isDestroy",!1);var n=t.data,e=t.type,i=e===void 0?m.UNSIGNED_BYTE:e,o=t.width,u=t.height,s=t.flipY,l=s===void 0?!1:s,c=t.format,f=c===void 0?m.RGBA:c,p=t.mipmap,h=p===void 0?!1:p,g=t.wrapS,v=g===void 0?m.CLAMP_TO_EDGE:g,_=t.wrapT,x=_===void 0?m.CLAMP_TO_EDGE:_,C=t.aniso,S=C===void 0?0:C,M=t.alignment,L=M===void 0?1:M,D=t.premultiplyAlpha,B=D===void 0?!1:D,I=t.mag,P=I===void 0?m.NEAREST:I,U=t.min,V=U===void 0?m.NEAREST:U,K=t.colorSpace,Q=K===void 0?m.BROWSER_DEFAULT_WEBGL:K,te=t.x,ce=te===void 0?0:te,fe=t.y,Ce=fe===void 0?0:fe,Se=t.copy,nt=Se===void 0?!1:Se;this.width=o,this.height=u;var Ke={width:o,height:u,type:ea[i],format:l3[f],wrapS:Lf[v],wrapT:Lf[x],mag:Mf[P],min:Mf[V],alignment:L,flipY:l,colorSpace:f3[Q],premultiplyAlpha:B,aniso:S,x:ce,y:Ce,copy:nt};n&&(Ke.data=n),typeof h=="number"?Ke.mipmap=c3[h]:typeof h=="boolean"&&(Ke.mipmap=h),this.texture=a.texture(Ke)}return(0,T.Z)(r,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,e=t.height;this.texture.resize(n,e),this.width=n,this.height=e}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),r}(),kf,Ff,x3=(kf=(0,j.b2)(),kf(Ff=function(){function r(){var a=this;(0,R.Z)(this,r),(0,d.Z)(this,"createModel",function(t){return new _3(a.gl,t)}),(0,d.Z)(this,"createAttribute",function(t){return new u3(a.gl,t)}),(0,d.Z)(this,"createBuffer",function(t){return new g3(a.gl,t)}),(0,d.Z)(this,"createElements",function(t){return new m3(a.gl,t)}),(0,d.Z)(this,"createTexture2D",function(t){return new E3(a.gl,t)}),(0,d.Z)(this,"createFramebuffer",function(t){return new y3(a.gl,t)}),(0,d.Z)(this,"useFramebuffer",function(t,n){a.gl({framebuffer:t?t.get():null})(n)}),(0,d.Z)(this,"clear",function(t){var n,e=t.color,i=t.depth,o=t.stencil,u=t.framebuffer,s=u===void 0?null:u,l={color:e,depth:i,stencil:o};l.framebuffer=s===null?s:s.get(),(n=a.gl)===null||n===void 0||n.clear(l)}),(0,d.Z)(this,"viewport",function(t){var n=t.x,e=t.y,i=t.width,o=t.height;a.gl._gl.viewport(n,e,i,o),a.width=i,a.height=o,a.gl._refresh()}),(0,d.Z)(this,"readPixels",function(t){var n=t.framebuffer,e=t.x,i=t.y,o=t.width,u=t.height,s={x:e,y:i,width:o,height:u};return n&&(s.framebuffer=n.get()),a.gl.read(s)}),(0,d.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,d.Z)(this,"getContainer",function(){if(Ne)return a.canvas;var t;return(t=a.canvas)===null||t===void 0?void 0:t.parentElement}),(0,d.Z)(this,"getCanvas",function(){return a.canvas}),(0,d.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,d.Z)(this,"destroy",function(){var t,n,e;a.canvas=null,(t=a.gl)===null||t===void 0||(n=t._gl)===null||n===void 0||(e=n.getExtension("WEBGL_lose_context"))===null||e===void 0||e.loseContext(),a.gl.destroy(),a.gl=null})}return(0,T.Z)(r,[{key:"init",value:function(){var a=(0,k.Z)(y().mark(function n(e,i,o){var u=this;return y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.canvas=e,!o){l.next=5;break}this.gl=o,l.next=8;break;case 5:return l.next=7,new Promise(function(c,f){o3()({canvas:u.canvas,attributes:{alpha:!0,antialias:i.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,stencil:i.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(h,g){(h||!g)&&f(h),c(g)}})});case 7:this.gl=l.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return l.stop()}},n,this)}));function t(n,e,i){return a.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),r}())||Ff);function C3(r){var a=S3();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var ta=["selectstart","selecting","selectend"],b3=function(r){(0,F.Z)(t,r);var a=C3(t);function t(n){var e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,R.Z)(this,t),e=a.call(this),(0,d.Z)((0,E.Z)(e),"isEnable",!1),(0,d.Z)((0,E.Z)(e),"onDragStart",function(o){e.box.style.display="block",e.startEvent=e.endEvent=o,e.syncBoxBound(),e.emit("selectstart",e.getLngLatBox(),e.startEvent,e.endEvent)}),(0,d.Z)((0,E.Z)(e),"onDragging",function(o){e.endEvent=o,e.syncBoxBound(),e.emit("selecting",e.getLngLatBox(),e.startEvent,e.endEvent)}),(0,d.Z)((0,E.Z)(e),"onDragEnd",function(o){e.endEvent=o,e.box.style.display="none",e.emit("selectend",e.getLngLatBox(),e.startEvent,e.endEvent)}),e.scene=n,e.options=i,e}return(0,T.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var i=re("div",void 0,this.container);i.classList.add("l7-select-box"),e&&i.classList.add(e),i.style.display="none",this.box=i}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,i=e.x,o=e.y,u=this.endEvent,s=u.x,l=u.y,c=Math.min(i,s),f=Math.min(o,l),p=Math.abs(i-s),h=Math.abs(o-l);this.box.style.top="".concat(f,"px"),this.box.style.left="".concat(c,"px"),this.box.style.width="".concat(p,"px"),this.box.style.height="".concat(h,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,i=e.lng,o=e.lat,u=this.endEvent.lngLat,s=u.lng,l=u.lat;return zh([[i,o],[s,l]])}}]),t}(pe.EventEmitter),A3=function(){function r(a){(0,R.Z)(this,r);var t=a.id,n=a.map,e=a.canvas,i=a.hasBaseMap,o=Am();this.container=o,n.setContainer(o,t,e,i),o.bind(w.IRendererService).to(x3).inSingletonScope(),this.sceneService=o.get(w.ISceneService),this.mapService=o.get(w.IMapService),this.iconService=o.get(w.IIconService),this.fontService=o.get(w.IFontService),this.controlService=o.get(w.IControlService),this.layerService=o.get(w.ILayerService),this.debugService=o.get(w.IDebugService),this.debugService.setEnable(a.debug),this.markerService=o.get(w.IMarkerService),this.interactionService=o.get(w.IInteractionService),this.popupService=o.get(w.IPopupService),this.boxSelect=new b3(this,{}),ih((a==null?void 0:a.isMini)||!1),Ne?this.sceneService.initMiniScene(a):(this.initComponent(t),this.sceneService.init(a),this.initControl())}return(0,T.Z)(r,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var a=(0,k.Z)(y().mark(function n(e){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return o.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var a=(0,k.Z)(y().mark(function n(e){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return o.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var e=new t(this);e.init()}else this.on("loaded",function(){var i=new t(n);i.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,e=Fn(this.container);if(t.setContainer(e,this.container),this.sceneService.addLayer(t),t.inited){var i=this.initMask(t);this.addMask(i,t.id)}else t.on("inited",function(){var o=n.initMask(t);n.addMask(o,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),e=n.mask,i=n.maskfence,o=n.maskColor,u=o===void 0?"#000":o,s=n.maskOpacity,l=s===void 0?0:s;if(!(!e||!i)){var c=new Oc().source(i).shape("fill").style({color:u,opacity:l});return c}}},{key:"addMask",value:function(t,n){if(!!t){var e=this.getLayer(n);if(e){var i=Fn(this.container);t.setContainer(i,this.container),e.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var a=(0,k.Z)(y().mark(function n(e,i){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.layerService.remove(e,i);case 2:case"end":return u.stop()}},n,this)}));function t(n,e){return a.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var a=(0,k.Z)(y().mark(function n(){return y().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.layerService.removeAllLayers();case 2:case"end":return i.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(e){var i=(0,W.Z)(e,2),o=i[0],u=i[1];n.fontService.addIconFont(o,u)})}},{key:"addFontFace",value:function(t,n){var e=this;this.fontService.once("fontloaded",function(i){e.emit("fontloaded",i)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var a=(0,k.Z)(y().mark(function n(e,i){return y().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(Ne){u.next=5;break}return u.next=3,this.iconService.addImage(e,i);case 3:u.next=6;break;case 5:this.iconService.addImageMini(e,i,this.sceneService);case 6:case"end":return u.stop()}},n,this)}));function t(n,e){return a.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(ta.includes(t)){var e;(e=this.boxSelect)===null||e===void 0||e.on(t,n)}else pr.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(ta.includes(t)){var e;(e=this.boxSelect)===null||e===void 0||e.once(t,n)}else pr.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){pr.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(ta.includes(t)){var e;(e=this.boxSelect)===null||e===void 0||e.off(t,n)}else pr.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var e=this.sceneService.getSceneConfig(),i=e.fitBoundsOptions,o=e.animate;this.mapService.fitBounds(t,n||(0,A.Z)((0,A.Z)({},i),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(w.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:eo(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,e=t.logoPosition;n&&this.addControl(new py({position:e}))}}]),r}(),wf,na,Of,Df=(wf=ki(w.IGlobalConfigService),na=function(){function r(a){(0,R.Z)(this,r),(0,J.Z)(this,"configService",Of,this),this.config=a}return(0,T.Z)(r,[{key:"setContainer",value:function(t,n,e,i){t.bind(w.MapConfig).toConstantValue((0,A.Z)((0,A.Z)({},this.config),{},{id:n,canvas:e,hasBaseMap:i})),t.bind(w.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),r}(),Of=(0,q.Z)(na.prototype,"configService",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),na),T3=z(69498),If=z.n(T3),Pf=z(6481),Bf=function(){function r(a){(0,R.Z)(this,r),(0,d.Z)(this,"size",1e4),this.size=a||1e4}return(0,T.Z)(r,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),e=this.mercatorYfromLat(t[1]);return[n,e]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),e=this.latFromMercatorY(t[1]);return[n,e]}}]),r}();function Nf(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={top:0,right:0,bottom:0,left:0};if(typeof r=="number")return{top:r,right:r,bottom:r,left:r};if(Array.isArray(r)){if(r.length===4)return{top:r[0],right:r[1],bottom:r[2],left:r[3]};if(r.length===2)return{top:r[0],right:r[1],bottom:r[0],left:r[1]}}return(0,A.Z)((0,A.Z)({},a),r)}var Zf=z(81458),M3=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"syncWithMapCamera",value:function(t){var n=t.center,e=t.zoom,i=t.pitch,o=t.bearing,u=t.viewportHeight,s=t.viewportWidth,l=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new Zf.Z((0,A.Z)((0,A.Z)({},l),{},{width:s,height:u,longitude:n&&n[0],latitude:n&&n[1],zoom:e,pitch:i,bearing:o}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),r}(),L3={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},R3=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],zf,Uf,Hf,jf,Vf,Gf,un,Wf,$f,Xf,Yf;function k3(r,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(a.createTextNode(r)),e.appendChild(o),o}}k3(`.amap-logo{
 display: none !important;
}
`);var F3={contextmenu:"rightclick"},w3={contextmenu:"rightclick",camerachange:"viewchange"},Kf={"GAODE1.x":F3,"GAODE2.x":w3},O3=0;window.forceWebGL=!0;var Qf="15cd8a57710d40c9b7c0e3cc120f1200",D3="1.4.15",I3="amap-script",ra=!1,kr=[],P3=12,B3=(zf=(0,j.b2)(),Uf=(0,j.f3)(w.IGlobalConfigService),Hf=(0,j.f3)(w.MapConfig),jf=(0,j.f3)(w.ICoordinateSystemService),Vf=(0,j.f3)(w.IEventEmitter),zf(Gf=(un=function(){function r(){var a=this;(0,R.Z)(this,r),(0,d.Z)(this,"version",Fe["GAODE1.x"]),(0,d.Z)(this,"simpleMapCoord",new Bf),(0,d.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),(0,J.Z)(this,"configService",Wf,this),(0,J.Z)(this,"config",$f,this),(0,J.Z)(this,"coordinateSystemService",Xf,this),(0,J.Z)(this,"eventEmitter",Yf,this),(0,d.Z)(this,"handleCameraChanged",function(t){var n=t.camera,e=n.fov,i=n.near,o=n.far,u=n.height,s=n.pitch,l=n.rotation,c=n.aspect,f=n.position,p=a.getCenter(),h=p.lng,g=p.lat;if(a.emit("mapchange"),a.cameraChangedCallback){a.viewport.syncWithMapCamera({aspect:c,bearing:360-l,far:o,fov:e,cameraHeight:u,near:i,pitch:s,zoom:a.map.getZoom()-1,center:[h,g],offsetOrigin:[f.x,f.y]});var v=a.config.offsetZoom,_=v===void 0?P3:v;a.viewport.getZoom()>_?a.coordinateSystemService.setCoordinateSystem(We.P20_OFFSET):a.coordinateSystemService.setCoordinateSystem(We.P20),a.cameraChangedCallback(a.viewport)}})}return(0,T.Z)(r,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];this.markerContainer=re("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Fi.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(Kf[this.version][t]||t,n)}},{key:"off",value:function(t,n){Fi.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(Kf[this.version][t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),e=Nf(t.padding),i=this.lngLatToPixel([n.lng,n.lat]),o=[(e.right-e.left)/2,(e.bottom-e.top)/2],u=this.pixelToLngLat([i.x-o[0],i.y-o[1]]);return u}var s=this.map.getCenter();return{lng:s.getLng(),lat:s.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var e=Nf(n.padding),i=this.lngLatToPixel(t),o=[(e.right-e.left)/2,(e.bottom-e.top)/2],u=this.pixelToLngLat([i.x+o[0],i.y+o[1]]);this.map.setCenter([u.lng,u.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),n=t.getNorthEast(),e=t.getSouthWest(),i=this.getCenter(),o=i.lng>n.getLng()||i.lng<e.getLng()?180-n.getLng():n.getLng(),u=i.lng<e.getLng()?e.getLng()-180:e.getLng();return[[u,e.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t+1,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyleValue(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"getMapStyleConfig",value:function(){return L3}},{key:"getMapStyleValue",value:function(t){return this.getMapStyleConfig()[t]||t}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),e=this.map.containerToLngLat(n);return{lng:e==null?void 0:e.getLng(),lat:e==null?void 0:e.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),e=this.map.lngLatToContainer(n);return{x:e.getX(),y:e.getY()}}},{key:"lngLatToCoord",value:function(t){var n=this.map.lngLatToGeodeticCoord(t),e=n.x,i=n.y;return[e,-i]}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=this.viewport.projectFlat(t),u=ee.create();return ee.translate(u,u,ie.fromValues(o[0],o[1],n)),ee.scale(u,u,ie.fromValues(i[0],i[1],i[2])),ee.rotateX(u,u,e[0]),ee.rotateY(u,u,e[1]),ee.rotateZ(u,u,e[2]),u}},{key:"init",value:function(){var a=(0,k.Z)(y().mark(function n(){var e=this,i,o,u,s,l,c,f,p,h,g,v,_,x,C;return y().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return i=this.config,o=i.id,u=i.style,s=u===void 0?"light":u,l=i.minZoom,c=l===void 0?0:l,f=i.maxZoom,p=f===void 0?18:f,h=i.token,g=h===void 0?Qf:h,v=i.mapInstance,_=i.plugin,x=_===void 0?[]:_,C=(0,Re.Z)(i,R3),M.next=3,new Promise(function(L){var D=function(){if(v)e.map=v,e.$mapContainer=e.map.getContainer(),setTimeout(function(){e.map.on("camerachange",e.handleCameraChanged),L()},30);else{e.$mapContainer=e.creatMapContainer(o);var I=(0,A.Z)({mapStyle:e.getMapStyleValue(s),zooms:[c,p],viewMode:"3D"},C);I.zoom&&(I.zoom+=1);var P=new AMap.Map(e.$mapContainer,I);P.on("camerachange",e.handleCameraChanged),P.on("camerachange",function(){setTimeout(function(){return e.handleAfterMapChange()})}),e.map=P,setTimeout(function(){L()},10)}};!ra&&!v?(g===Qf&&console.warn("%c".concat(e.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),ra=!0,x.push("Map3D"),If().load({key:g,version:D3,plugins:x}).then(function(){D(),kr.length&&(kr.forEach(function(B){return B()}),kr=[])}).catch(function(B){throw new Error(B)})):ra&&window.AMap||v?D():kr.push(D)});case 3:this.viewport=new M3;case 4:case"end":return M.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var e=AMap.GeometryUtil.distance((0,Pf.Z)(AMap.LngLat,(0,G.Z)(t)),(0,Pf.Z)(AMap.LngLat,(0,G.Z)(n))),i=this.lngLatToCoord(t),o=(0,W.Z)(i,2),u=o[0],s=o[1],l=this.lngLatToCoord(n),c=(0,W.Z)(l,2),f=c[0],p=c[1],h=Math.sqrt(Math.pow(u-f,2)+Math.pow(s-p,2));return h/e}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var n,e=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],i=t==="jpg"?e==null?void 0:e.toDataURL("image/jpeg"):e==null?void 0:e.toDataURL("image/png");return i}},{key:"emit",value:function(t){for(var n,e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(i))}},{key:"once",value:function(t){for(var n,e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(i))}},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var e=document.getElementById(I3);e&&document.head.removeChild(e),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var e=document.createElement("div");return e.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,e.id="l7_amap_div"+O3++,n.appendChild(e),e}}]),r}(),Wf=(0,q.Z)(un.prototype,"configService",[Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$f=(0,q.Z)(un.prototype,"config",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=(0,q.Z)(un.prototype,"coordinateSystemService",[jf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=(0,q.Z)(un.prototype,"eventEmitter",[Vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),un))||Gf),N3=function(){function r(){(0,R.Z)(this,r),(0,d.Z)(this,"projectionMatrix",ee.create()),(0,d.Z)(this,"viewMatrix",ee.create()),(0,d.Z)(this,"viewProjectionMatrix",ee.create()),(0,d.Z)(this,"ViewProjectionMatrixUncentered",ee.create()),(0,d.Z)(this,"viewUncenteredMatrix",ee.create())}return(0,T.Z)(r,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,e=n===void 0?1:n,i=t.center,o=i===void 0?[0,0]:i,u=t.offsetOrigin,s=u===void 0?[0,0]:u,l=t.cameraPosition,c=l===void 0?[0,0,0]:l,f=t.up,p=f===void 0?[0,1,0]:f,h=t.lookAt,g=h===void 0?[0,0,0]:h,v=t.aspect,_=v===void 0?1:v,x=t.near,C=x===void 0?.1:x,S=t.far,M=S===void 0?1e3:S,L=t.fov,D=L===void 0?45:L;this.zoom=e,this.center=o,ee.perspective(this.projectionMatrix,D/180*Math.PI,_,C,M);var B=ie.fromValues.apply(ie,(0,G.Z)(c)),I=ie.fromValues.apply(ie,(0,G.Z)(g)),P=ie.fromValues.apply(ie,(0,G.Z)(p));ee.lookAt(this.viewMatrix,B,I,P),this.viewUncenteredMatrix=ee.clone(this.viewMatrix),ee.translate(this.viewMatrix,this.viewMatrix,ie.fromValues(-s[0],s[1],0)),ee.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),ee.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=(0,W.Z)(this.center,2),n=t[0],e=t[1];return[n,e]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(t){var n=85.0511287798,e=Math.max(Math.min(n,t[1]),-n),i=256<<20,o=Math.PI/180,u=t[0]*o,s=e*o;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,c=.5,f=-.5/Math.PI;return o=.5,u=i*(l*u+c)-215440491,s=-(i*(f*s+o)-106744817),[u,s]}}]),r}(),Z3=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],qf,Jf;function z3(r){var a=U3();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function U3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}function H3(r,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(a.createTextNode(r)),e.appendChild(o),o}}H3(`.amap-logo{
 display: none !important;
}
`);var e0=[108.92361,34.54083];window.forceWebGL=!0;var t0="ff533602d57df6f8ab3b0fea226ae52f",n0="2.0",Xb=!1,Yb=null,j3=(qf=(0,j.b2)(),qf(Jf=function(r){(0,F.Z)(t,r);var a=z3(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"version",Fe["GAODE2.x"]),(0,d.Z)((0,E.Z)(n),"handleViewChanged",function(u){var s=n.map.customCoords.getCameraParams(),l=s.fov,c=s.near,f=s.far,p=s.aspect,h=s.position,g=s.lookAt,v=s.up;n.emit("mapchange");var _=n.map.customCoords.getCenter();n.cameraChangedCallback&&(n.viewport.syncWithMapCamera({aspect:p,far:f,fov:l,cameraPosition:h,lookAt:g,up:v,near:c,zoom:n.map.getZoom()-1,center:_,offsetOrigin:[h[0],h[1]]}),n.coordinateSystemService.setCoordinateSystem(We.P20_2),n.cameraChangedCallback(n.viewport))}),n}return(0,T.Z)(t,[{key:"setCustomCoordCenter",value:function(e){this.sceneCenter=e,this.sceneCenterMKT=tr.apply(void 0,(0,G.Z)(e))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoordByLayer",value:function(e,i){var o=i||this.sceneCenter,u=tr.apply(void 0,(0,G.Z)(o)),s=this._sub(tr(e[0],e[1]),u);return e[2]&&s.push(e[2]),s}},{key:"lngLatToCoordsByLayer",value:function(e,i){var o=this;return e.map(function(u){return typeof u[0]=="number"?o.lngLatToCoordByLayer(u,i):u.map(function(s){return o.lngLatToCoordByLayer(s,i)})})}},{key:"setCoordCenter",value:function(e){this.map.customCoords.setCenter(e||e0),this.setCustomCoordCenter(e||e0)}},{key:"lngLatToCoord",value:function(e){return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub(tr(e[0],e[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(e){var i=this;return e.map(function(o){return typeof o[0]=="number"?i.lngLatToCoord(o):o.map(function(u){return i.lngLatToCoord(u)})})}},{key:"addMarkerContainer",value:function(){if(!!this.map){var e=this.map.getContainer();if(e!==null){var i=e.getElementsByClassName("amap-maps")[0];i.style.zIndex="auto",this.markerContainer=re("div","l7-marker-container2",i)}}}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var e=this.map.getBounds(),i=e.getNorthEast(),o=e.getSouthWest(),u=this.getCenter(),s=u.lng>i.getLng()||u.lng<o.getLng()?180-i.getLng():i.getLng(),l=u.lng<o.getLng()?o.getLng()-180:o.getLng();return[[l,o.getLat()],[s,i.getLat()]]}},{key:"getMinZoom",value:function(){var e=this.map.getZooms();return e[0]-1}},{key:"getMaxZoom",value:function(){var e=this.map.getZooms();return e[1]-1}},{key:"lngLatToContainer",value:function(e){var i=this.map.lngLatToContainer(e);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToPixel",value:function(e){var i=this.map.lngLatToPixel(new AMap.LngLat(e[0],e[1]));return{x:i.getX(),y:i.getY()}}},{key:"getModelMatrix",value:function(e,i,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],s=this.map.customCoords.lngLatToCoord(e),l=ee.create();return ee.translate(l,l,ie.fromValues(s[0],s[1],i)),ee.scale(l,l,ie.fromValues(u[0],u[1],u[2])),ee.rotateX(l,l,o[0]),ee.rotateY(l,l,o[1]),ee.rotateZ(l,l,o[2]),l}},{key:"init",value:function(){var n=(0,k.Z)(y().mark(function i(){var o,u,s,l,c,f,p,h,g,v,_,x,C,S,M,L,D,B,I,P,U,V;return y().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(o=this.config,u=o.id,s=o.style,l=s===void 0?"light":s,c=o.minZoom,f=c===void 0?0:c,p=o.maxZoom,h=p===void 0?18:p,g=o.token,v=g===void 0?t0:g,_=o.mapInstance,x=o.plugin,C=x===void 0?[]:x,S=o.version,M=S===void 0?n0:S,L=(0,Re.Z)(o,Z3),this.viewport=new N3,window.AMap||_){Q.next=6;break}return C.push("Map3D"),Q.next=6,If().load({key:v,version:n0,plugins:C});case 6:_?(this.map=_,this.$mapContainer=this.map.getContainer(),B=this.map.getCenter(),(D=this.map.customCoords)===null||D===void 0||D.setCenter([B.lng,B.lat]),this.setCustomCoordCenter([B.lng,B.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(u),P=(0,A.Z)({mapStyle:this.getMapStyleValue(l),zooms:[f,h],viewMode:"3D"},L),P.zoom&&(P.zoom+=1),v===t0&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),U=new AMap.Map(this.$mapContainer,P),this.map=U,V=U.getCenter(),(I=this.map.customCoords)===null||I===void 0||I.setCenter([V.lng,V.lat]),this.setCustomCoordCenter([V.lng,V.lat]),U.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return Q.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var e,i=(e=this.map.customCoords)===null||e===void 0?void 0:e.getCameraParams(),o=i.fov,u=i.near,s=i.far,l=i.aspect,c=i.position,f=i.lookAt,p=i.up;this.emit("mapchange");var h=this.map.customCoords.getCenter(),g=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:l,far:s,fov:o,cameraPosition:c,lookAt:f,near:u,up:p,zoom:g-1,center:h,offsetOrigin:[c[0],c[1]]}),this.coordinateSystemService.setCoordinateSystem(We.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,i){var o=[0,0];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o}}]),t}(B3))||Jf);function V3(r){var a=G3();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}var W3=function(r){(0,F.Z)(t,r);var a=V3(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getServiceConstructor",value:function(){return j3}}]),t}(Df),$3=z(6158),Vn=z.n($3),X3={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},r0,i0,a0,o0,u0,s0,sn,l0,c0,f0,p0,h0={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Y3=12,K3=(r0=(0,j.b2)(),i0=(0,j.f3)(w.MapConfig),a0=(0,j.f3)(w.IGlobalConfigService),o0=(0,j.f3)(w.ICoordinateSystemService),u0=(0,j.f3)(w.IEventEmitter),r0(s0=(sn=function(){function r(){var a=this;(0,R.Z)(this,r),(0,d.Z)(this,"version",Fe.DEFUALT),(0,d.Z)(this,"simpleMapCoord",new Bf),(0,d.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,J.Z)(this,"config",l0,this),(0,J.Z)(this,"configService",c0,this),(0,J.Z)(this,"coordinateSystemService",f0,this),(0,J.Z)(this,"eventEmitter",p0,this),(0,d.Z)(this,"handleCameraChanged",function(t){var n=a.map.getCenter(),e=n.lat,i=n.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[i,e],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0}),a.updateCoordinateSystemService(),a.cameraChangedCallback(a.viewport)})}return(0,T.Z)(r,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=re("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){Fi.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(h0[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(h0[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===Fe.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return X3}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(i))}},{key:"once",value:function(t){for(var n,e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(i))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),e=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return e}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>Y3&&n?this.coordinateSystemService.setCoordinateSystem(We.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(We.LNGLAT)}}]),r}(),l0=(0,q.Z)(sn.prototype,"config",[i0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c0=(0,q.Z)(sn.prototype,"configService",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f0=(0,q.Z)(sn.prototype,"coordinateSystemService",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0=(0,q.Z)(sn.prototype,"eventEmitter",[u0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn))||s0),Q3=function(){function r(){(0,R.Z)(this,r)}return(0,T.Z)(r,[{key:"syncWithMapCamera",value:function(t){var n=t.center,e=t.zoom,i=t.pitch,o=t.bearing,u=t.viewportHeight,s=t.viewportWidth;this.viewport=new Zf.Z({width:s,height:u,longitude:n&&n[0],latitude:n&&n[1],zoom:e,pitch:i,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),r}(),q3=["id","attributionControl","style","token","rotation","mapInstance"],d0,v0;function J3(r){var a=e5();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function e5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}function t5(r,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(a.createTextNode(r)),e.appendChild(o),o}}t5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Vn();var n5=0,g0="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",r5=(d0=(0,j.b2)(),d0(v0=function(r){(0,F.Z)(t,r);var a=J3(t);function t(){var n;(0,R.Z)(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return n=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,E.Z)(n),"version",Fe.MAPBOX),n}return(0,T.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(e,0),u=o.x,s=o.y;return[u-i.x,s-i.y]}},{key:"lngLatToMercator",value:function(e,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,i),u=o.x,s=u===void 0?0:u,l=o.y,c=l===void 0?0:l,f=o.z,p=f===void 0?0:f;return{x:s,y:c,z:p}}},{key:"getModelMatrix",value:function(e,i,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=window.mapboxgl.MercatorCoordinate.fromLngLat(e,i),c=l.meterInMercatorCoordinateUnits(),f=ee.create();return ee.translate(f,f,ie.fromValues(l.x-s.x,l.y-s.y,l.z||0-s.z)),ee.scale(f,f,ie.fromValues(c*u[0],-c*u[1],c*u[2])),ee.rotateX(f,f,o[0]),ee.rotateY(f,f,o[1]),ee.rotateZ(f,f,o[2]),f}},{key:"init",value:function(){var n=(0,k.Z)(y().mark(function i(){var o=this,u,s,l,c,f,p,h,g,v,_,x,C,S;return y().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:u=this.config,s=u.id,l=s===void 0?"map":s,c=u.attributionControl,f=c===void 0?!1:c,p=u.style,h=p===void 0?"light":p,g=u.token,v=g===void 0?g0:g,_=u.rotation,x=_===void 0?0:_,C=u.mapInstance,S=(0,Re.Z)(u,q3),this.viewport=new Q3,!C&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),v===g0&&h!=="blank"&&!window.mapboxgl.accessToken&&!C&&console.warn(this.configService.getSceneWarninfo("MapToken")),!C&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=v),C?(this.map=C,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(l),this.map=new window.mapboxgl.Map((0,A.Z)({container:this.$mapContainer,style:this.getMapStyleValue(h),attributionControl:f,bearing:x},S))),this.map.on("load",function(){o.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return L.stop()}},i,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var e,i;(e=this.$mapContainer)===null||e===void 0||(i=e.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];(i=this.eventEmitter).emit.apply(i,[e].concat(u))}},{key:"once",value:function(e){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];(i=this.eventEmitter).once.apply(i,[e].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,i){var o=new(Vn()).LngLat(e[0],e[1]),u=new(Vn()).LngLat(i[0],i[1]),s=o.distanceTo(u),l=Vn().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),c=Vn().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),f=l.x,p=l.y,h=c.x,g=c.y,v=Math.sqrt(Math.pow(f-h,2)+Math.pow(p-g,2))*4194304*2;return v/s}},{key:"exportMap",value:function(e){var i=this.map.getCanvas(),o=e==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"creatMapContainer",value:function(e){var i=e;typeof e=="string"&&(i=document.getElementById(e));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+n5++,i.appendChild(o),o}}]),t}(K3))||v0);function i5(r){var a=a5();return function(){var n=(0,b.Z)(r),e;if(a){var i=(0,b.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,O.Z)(this,e)}}function a5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}function o5(r,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(a.createTextNode(r)),e.appendChild(o),o}}o5(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var u5=function(r){(0,F.Z)(t,r);var a=i5(t);function t(){return(0,R.Z)(this,t),a.apply(this,arguments)}return(0,T.Z)(t,[{key:"getServiceConstructor",value:function(){return r5}}]),t}(Df),Fr=z(90494),we=z(45442),ia={fontFamily:`
  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`},aa="l7plot-tooltip",oa="l7plot-tooltip__title",ua="l7plot-tooltip__list",m0="l7plot-tooltip__list-item",y0="l7plot-tooltip__name",_0="l7plot-tooltip__value",s5='<div class="'.concat(aa,`">
  <div class="`).concat(oa,`"></div>
  <ul class="`).concat(ua,`"></ul>
</div>`),E0='<li class="'.concat(m0,`" data-index={index}>
  <span class="`).concat(y0,`">{name}</span>
  <span class="`).concat(_0,`">{value}</span>
</li>`),Rt,l5=(Rt={},Rt[aa]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:ia.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},Rt[oa]={marginBottom:"4px"},Rt[ua]={margin:"0px",listStyleType:"none",padding:"0px"},Rt[m0]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},Rt[y0]={},Rt[_0]={marginLeft:"30px"},Rt),c5=z(6056);function f5(r,a){return!!r.className.match(new RegExp("(\\s|^)".concat(a,"(\\s|$)")))}function sa(r){for(var a=r.childNodes,t=a.length,n=t-1;n>=0;n--)r.removeChild(a[n])}var la=function(){function r(a){this.destroyed=!1,this.options=(0,Z.b$)({},this.getDefaultOptions(),a),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return r.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},r.prototype.getContainer=function(){return this.container},r.prototype.getParentContainer=function(){var a=this.options.parent,t;if(!a)return t;if((0,Z.HD)(a)){var n=document.getElementById(a);if(n)t=n;else throw new Error("No parent id ".concat(a))}else t=a;return t},r.prototype.initContainer=function(){var a=this.createDom(this.options.containerTpl),t=this.getParentContainer();return t&&t.appendChild(a),a},r.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},r.prototype.initCapture=function(){this.setCapture(this.options.capture)},r.prototype.update=function(a){this.options=(0,Z.b$)({},this.options,a),this.updateInner(a),this.afterUpdate(a)},r.prototype.updateInner=function(a){a.domStyles&&this.applyStyles()},r.prototype.afterUpdate=function(a){a.capture&&this.setCapture(a.capture)},r.prototype.setCapture=function(a){var t=this.container,n=a?"auto":"none";t.style.pointerEvents=n},r.prototype.applyStyles=function(){var a=this.options.domStyles;if(!!a){var t=this.container;this.applyChildrenStyles(t,a);var n=this.options.className;if(n&&f5(t,n)){var e=a[n];(0,we.Z)(t,e)}}},r.prototype.applyChildrenStyles=function(a,t){(0,Z.S6)(t,function(n,e){var i=a.getElementsByClassName(e);(0,Z.S6)(i,function(o){(0,we.Z)(o,n)})})},r.prototype.applyStyle=function(a,t){var n=this.options.domStyles;n&&(0,we.Z)(t,n[a])},r.prototype.createDom=function(a){return a===void 0&&(a="<div></div>"),(0,c5.Z)(a)},r.prototype.removeDom=function(){var a=this.container;a&&a.parentNode&&a.parentNode.removeChild(a)},r.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},r}(),p5=function(r){(0,Y.ZT)(a,r);function a(){return r!==null&&r.apply(this,arguments)||this}return a.prototype.getDefaultOptions=function(){return(0,Z.b$)({},r.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:s5,itemTpl:E0,domStyles:l5,className:aa})},a.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),e=this.getParentContainer();return e&&e.appendChild(n),n}else return r.prototype.initContainer.call(this)},a.prototype.initDom=function(){this.cacheDoms()},a.prototype.initEvent=function(){},a.prototype.removeEvent=function(){},a.prototype.cacheDoms=function(){var t=this.container,n=t.getElementsByClassName(oa)[0],e=t.getElementsByClassName(ua)[0];this.titleDom=n,this.listDom=e},a.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},a.prototype.show=function(){var t=this.container;!t||this.destroyed||(0,we.Z)(t,{visibility:"visible"})},a.prototype.hide=function(){var t=this.container;!t||this.destroyed||(0,we.Z)(t,{visibility:"hidden"})},a.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),r.prototype.updateInner.call(this,t)},a.prototype.renderCustomContent=function(t){var n=this.container.parentNode,e=this.getHtmlContentNode(t),i=this.container;n&&n.replaceChild(e,i),this.container=e,this.applyStyles()},a.prototype.getHtmlContentNode=function(t){var n,e=t(this.options.title||"",this.options.items);return(0,Z.HD)(e)?n=this.createDom(e):n=e,n},a.prototype.resetTitle=function(){var t=this.options.title,n=this.options.showTitle;n&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},a.prototype.showTitle=function(){var t=this.titleDom;t&&(0,we.Z)(t,{display:"block"})},a.prototype.hideTitle=function(){var t=this.titleDom;t&&(0,we.Z)(t,{display:"none"})},a.prototype.setTitle=function(t){var n=this.titleDom;n&&(n.innerHTML=t)},a.prototype.renderItems=function(){var t=this;this.clearItemDoms();var n=this.options.items,e=this.options.itemTpl||E0,i=this.listDom;i&&(n.forEach(function(o){var u=(0,Y.pi)({},o),s=(0,Z.ng)(e,u),l=t.createDom(s);i.appendChild(l)}),this.applyChildrenStyles(i,this.options.domStyles))},a.prototype.clearItemDoms=function(){this.listDom&&sa(this.listDom)},a.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},a}(la),x0=z(77398),h5=5,d5=new Object().toString,C0=function(r,a){return d5.call(r)==="[object "+a+"]"},v5=function(r){return C0(r,"Array")},g5=function(r){return typeof r=="object"&&r!==null},S0=function(r){if(!g5(r)||!C0(r,"Object"))return!1;for(var a=r;Object.getPrototypeOf(a)!==null;)a=Object.getPrototypeOf(a);return Object.getPrototypeOf(r)===a},b0=function(r,a,t,n){t=t||0,n=n||h5;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var i=a[e];i?S0(i)?(S0(r[e])||(r[e]={}),t<n?b0(r[e],i,t+1,n):r[e]=a[e]):v5(i)?(r[e]=[],r[e]=r[e].concat(i)):r[e]=i:r[e]=i}},je=function(r){for(var a=[],t=1;t<arguments.length;t++)a[t-1]=arguments[t];for(var n=0;n<a.length;n+=1)b0(r,a[n]);return r},m5=["mousemove","click"],y5=function(r){(0,Y.ZT)(a,r);function a(t,n,e){var i=r.call(this)||this;i.currentVisible=!1,i.interactionTriggerHander=function(g){var v=g.feature,_=g.featureId,x=i.options,C=x.title,S=x.customTitle,M=x.items,L=x.customItems,D=v.type==="Feature"&&v.geometry&&v.properties,B=D?v.properties:v,I=[];if(L){var P=L(v);if(Array.isArray(P))I=P;else throw new Error("customItems return array")}else M&&M.forEach(function(V){if((0,Z.HD)(V)){var K=V.split(".").pop()||V,Q=(0,x0.Z)(B,V);Q!==void 0&&I.push({name:K,value:Q})}else{var te=V.field,ce=V.alias,fe=V.customValue,Ce=ce||te.split(".").pop()||te,Q=(0,x0.Z)(B,te);Q!==void 0&&I.push({name:Ce,value:fe?fe(Q,B,_):Q})}});var U={title:S?S(B):C,items:I};i.updateTooltip(g,U)},i.interactionUntriggerHander=function(){i.hideTooltip()},i.scene=t,i.interactionLayers=n,i.options=je({},i.getDefaultOptions(),e);var o=i.options,u=o.offsets,s=o.title,l=o.showTitle,c=o.customContent,f=o.domStyles,p=o.anchor,h=o.className;return i.marker=new wi({offsets:u,anchor:p,draggable:!1}),i.tooltipComponent=new p5({title:s,showTitle:l,items:[],customContent:c,domStyles:f,className:h}),i.setComponent(),i.initInteractionEvent(),i}return a.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:Jr["TOP-LEFT"]}},a.prototype.update=function(t){this.marker.remove(),this.currentVisible=!1,this.options=je({},this.options,t);var n=this.options,e=n.offsets,i=n.showTitle,o=n.customContent,u=n.domStyles,s=n.anchor,l=n.className;this.marker=new wi({offsets:e,anchor:s,draggable:!1}),this.tooltipComponent.update({showTitle:i,customContent:o,domStyles:u,className:l}),this.setComponent()},a.prototype.initInteractionEvent=function(){var t=this,n=this.options.trigger||"mousemove";if(!m5.includes(n))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach(function(e){var i=e.layer;i.on(n,t.interactionTriggerHander),i.on("un".concat(n),t.interactionUntriggerHander)})},a.prototype.unBindInteractionEvent=function(){var t=this,n=this.options.trigger||"mousemove";this.interactionLayers.forEach(function(e){var i=e.layer;i.off(n,t.interactionTriggerHander),i.off("un".concat(n),t.interactionUntriggerHander)})},a.prototype.updateTooltip=function(t,n){var e=t.lngLat,i=t.x,o=t.y;if(this.options.showComponent&&(this.updateComponent(n),this.setPostion(e)),this.currentVisible){var u={type:"tooltip:change",data:n,lngLat:e,x:i,y:o};this.emit("tooltip:change",u)}else{this.showTooltip();var s={type:"tooltip:show",data:n,lngLat:e,x:i,y:o};this.emit("tooltip:show",s)}},a.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},a.prototype.hideTooltip=function(){if(!!this.currentVisible){this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;var t={type:"tooltip:hide"};this.emit("tooltip:hide",t)}},a.prototype.updateComponent=function(t){(0,Z.Xy)(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)},a.prototype.setComponent=function(){var t=this.tooltipComponent.getContainer(),n=window.document.createElement("div");n.style.cursor="auto",n.style.userSelect="text",n.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(e){n.addEventListener(e,function(i){return i.stopPropagation()})}),n.appendChild(t),this.marker.setElement(n)},a.prototype.setPostion=function(t){this.marker.setLnglat(t)},a.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},a}(Fr.Z),ca="l7plot-legend l7plot-legend__category",fa="l7plot-legend__title",pa="l7plot-legend__category-list",A0="l7plot-legend__list-item",T0="l7plot-legend__category-marker",M0="l7plot-legend__category-value",_5='<div class="'.concat(ca,`">
  <div class="`).concat(fa,`"></div>
  <ul class="`).concat(pa,`"></ul>
</div>`),L0='<li class="'.concat(A0,`" data-index={index}>
  <span class="`).concat(T0,`" style="background:{color}"></span>
  <span class="`).concat(M0,`">{value}</span>
</li>`),kt,E5=(kt={},kt[ca]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:ia.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},kt[fa]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},kt[pa]={margin:"0px",listStyleType:"none",padding:"0px"},kt[A0]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},kt[T0]={width:"10px",height:"10px"},kt[M0]={paddingLeft:"8px"},kt),x5=function(r){(0,Y.ZT)(a,r);function a(){return r!==null&&r.apply(this,arguments)||this}return a.prototype.getDefaultOptions=function(){return(0,Z.b$)({},r.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:_5,itemTpl:L0,domStyles:E5,className:ca})},a.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),e=this.getParentContainer();return e&&e.appendChild(n),n}else return r.prototype.initContainer.call(this)},a.prototype.initDom=function(){this.cacheDoms()},a.prototype.initEvent=function(){},a.prototype.removeEvent=function(){},a.prototype.cacheDoms=function(){var t=this.container,n=t.getElementsByClassName(fa)[0],e=t.getElementsByClassName(pa)[0];this.titleDom=n,this.listDom=e},a.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},a.prototype.show=function(){var t=this.container;!t||this.destroyed||(0,we.Z)(t,{visibility:"visible"})},a.prototype.hide=function(){var t=this.container;!t||this.destroyed||(0,we.Z)(t,{visibility:"hidden"})},a.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),r.prototype.updateInner.call(this,t)},a.prototype.renderCustomContent=function(t){var n=this.container.parentNode,e=this.getHtmlContentNode(t),i=this.container;n&&n.replaceChild(e,i),this.container=e,this.applyStyles()},a.prototype.getHtmlContentNode=function(t){var n,e=t(this.options.title||"",this.options.items);return(0,Z.HD)(e)?n=this.createDom(e):n=e,n},a.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},a.prototype.showTitle=function(){var t=this.titleDom;t&&(0,we.Z)(t,{display:"block"})},a.prototype.hideTitle=function(){var t=this.titleDom;t&&(0,we.Z)(t,{display:"none"})},a.prototype.setTitle=function(t){var n=this.titleDom;n&&(n.innerHTML=t)},a.prototype.renderItems=function(){var t=this;this.clearItemDoms();var n=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,e=this.options.itemTpl||L0,i=this.listDom;i&&(n.forEach(function(o){var u=o.value==="",s=u?"\u2014":Array.isArray(o.value)?o.value.join(" - "):o.value,l=(0,Y.pi)((0,Y.pi)({},o),{value:s}),c=(0,Z.ng)(e,l),f=t.createDom(c);i.appendChild(f)}),this.applyChildrenStyles(i,this.options.domStyles))},a.prototype.clearItemDoms=function(){this.listDom&&sa(this.listDom)},a.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},a}(la),ha="l7plot-legend l7plot-legend__continue",da="l7plot-legend__title",R0="l7plot-legend__ribbon-container",k0="l7plot-legend__ribbon",F0="l7plot-legend__gradient-bar",va="l7plot-legend__value-range",C5='<div class="'.concat(ha,`">
  <div class="`).concat(da,`"></div>
  <div class="`).concat(R0,`"></div>
</div>`),w0='<div class="'.concat(k0,`">
  <span class="`).concat(va,`">{min}</span>
  <div class="`).concat(F0,`" style="background-image: {backgroundImage}"></div>
  <span class="`).concat(va,`">{max}</span>
</div>`),Ht,S5=(Ht={},Ht[ha]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:ia.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},Ht[da]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},Ht[k0]={display:"flex",alignItems:"center"},Ht[F0]={width:"140px",height:"14px",margin:"0px 5px"},Ht[va]={padding:"0px"},Ht),b5=function(r){(0,Y.ZT)(a,r);function a(){return r!==null&&r.apply(this,arguments)||this}return a.prototype.getDefaultOptions=function(){return(0,Z.b$)({},r.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:C5,ribbonTpl:w0,domStyles:S5,className:ha})},a.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),e=this.getParentContainer();return e&&e.appendChild(n),n}else return r.prototype.initContainer.call(this)},a.prototype.initDom=function(){this.cacheDoms()},a.prototype.initEvent=function(){},a.prototype.removeEvent=function(){},a.prototype.cacheDoms=function(){var t=this.container,n=t.getElementsByClassName(da)[0],e=t.getElementsByClassName(R0)[0];this.titleDom=n,this.ribbonContainerDom=e},a.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},a.prototype.show=function(){var t=this.container;!t||this.destroyed||(0,we.Z)(t,{visibility:"visible"})},a.prototype.hide=function(){var t=this.container;!t||this.destroyed||(0,we.Z)(t,{visibility:"hidden"})},a.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),r.prototype.updateInner.call(this,t)},a.prototype.renderCustomContent=function(t){var n=this.container.parentNode,e=this.getHtmlContentNode(t),i=this.container;n&&n.replaceChild(e,i),this.container=e,this.applyStyles()},a.prototype.getHtmlContentNode=function(t){var n,e=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return(0,Z.HD)(e)?n=this.createDom(e):n=e,n},a.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},a.prototype.showTitle=function(){var t=this.titleDom;t&&(0,we.Z)(t,{display:"block"})},a.prototype.hideTitle=function(){var t=this.titleDom;t&&(0,we.Z)(t,{display:"none"})},a.prototype.setTitle=function(t){var n=this.titleDom;n&&(n.innerHTML=t)},a.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var t=this.options,n=t.min,e=t.max,i=t.colors,o=t.ribbonTpl,u=o===void 0?w0:o,s=this.ribbonContainerDom;if(s){var l="linear-gradient(to right, ".concat(i.join(", "),")"),c={min:n,max:e,backgroundImage:l},f=(0,Z.ng)(u,c),p=this.createDom(f);s.appendChild(p),this.applyChildrenStyles(s,this.options.domStyles)}},a.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&sa(this.ribbonContainerDom)},a.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},a}(la),A5=function(r){(0,Y.ZT)(a,r);function a(t){var n=r.call(this,t)||this;return n.legendComponents=[],n.options=t,n.legendComponents=n.initLegendComponents(t.items),n}return a.prototype.initLegendComponents=function(t){for(var n=[],e=0;e<t.length;e++){var i=t[e];if(i.type==="category"){var o=new x5({title:i.options.title,items:i.options.items,className:i.options.className,customContent:i.options.customContent,domStyles:i.options.domStyles});n.push(o)}else if(i.type==="continue"){var o=new b5({title:i.options.title,min:i.options.min,max:i.options.max,colors:i.options.colors,className:i.options.className,customContent:i.options.customContent,domStyles:i.options.domStyles});n.push(o)}}return n},a.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},a.prototype.onAdd=function(){var t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach(function(n){var e=n.getContainer();t.appendChild(e)}),t},a.prototype.onRemove=function(){this.legendComponents.forEach(function(t){t.destroy()})},a}(Zt),ln;(function(r){r.Amap="amap",r.Mapbox="mapbox"})(ln||(ln={}));var O0=function(r){(0,Y.ZT)(a,r);function a(t,n){t===void 0&&(t=[]),n===void 0&&(n={});var e=r.call(this)||this;return e.name=n.name?n.name:(0,Z.EL)("layerGroup"),e.layers=t,e}return a.prototype.addTo=function(t){var n=this;this.scene=t;var e=0,i=this.layers.length;this.layers.forEach(function(o){o.once("inited",function(u){e++,n.emit("inited",u),e===i&&n.emit("inited-all")}),o.addTo(t)})},a.prototype.hasLayer=function(t){return this.layers.some(function(n){return n===t})},a.prototype.addLayer=function(t){var n=this;this.layers.push(t),this.scene&&(t.once("inited",function(e){return n.emit("inited",e)}),t.addTo(this.scene))},a.prototype.removeLayer=function(t){var n=this.layers.findIndex(function(e){return e===t});return n===-1?!1:(this.layers.splice(n,1),this.scene&&t.remove(this.scene),!0)},a.prototype.getLayers=function(){return this.layers},a.prototype.getInteractionLayers=function(){return this.layers.filter(function(t){var n=t.interaction;return n})},a.prototype.getLayer=function(t){return this.layers.find(function(n){var e=n.layer;return e.id===t})},a.prototype.getLayerByName=function(t){return this.layers.find(function(n){return n.name===t})},a.prototype.removeAllLayer=function(){var t=this;this.layers.forEach(function(n){t.scene&&n.remove(t.scene)}),this.layers=[]},a.prototype.isEmpty=function(){return this.layers.length===0},a}(Fr.Z),T5=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],M5=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],wr=["inited","add","remove","dataUpdate","click","unclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"],jt=new Map;function Kb(r,a){jt.set(r,a)}function Qb(r){r.forEach(function(a){jt.set(a.id,a.image)})}function qb(r){return jt.get(r)}function Jb(r){return jt.has(r)}function eA(r){return jt.delete(r)}var Or=new Map;function tA(r,a){Or.set(r,a)}function nA(r){return Or.delete(r)}var Gn=new Map;function rA(r,a){Gn.set(r,a)}function iA(r){r.forEach(function(a){Gn.set(a.name,a.fontUnicode)})}function aA(r){return Gn.delete(r)}var cn=z(77972),fn=z(3876),Wn=z(56992);function D0(r){var a,t,n,e={point:{default:{fill:r.pointFillColor,size:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{fill:r.pointActiveFillColor},selected:{fill:r.pointSelectedFillColor}}};return{mapStyle:r.mapStyle,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,fontFamily:r.fontFamily,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:e.point.default},active:{style:e.point.active},selected:{style:e.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(a={},a[fn.rC]={visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:"".concat(r.legendContainerBorderRadius,"px"),color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(r.legendTextFontSize,"px")},a[fn.O6]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},a[fn.fL]={margin:"0px",padding:"0px"},a[fn.jp]={marginBottom:"2px"},a[fn.Bc]={width:"10px",height:"10px"},a[fn.Tf]={paddingLeft:"8px"},a)},continue:{domStyles:(t={},t[Wn.rC]={visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:"".concat(r.legendContainerBorderRadius,"px"),color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(r.legendTextFontSize,"px")},t[Wn.O6]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},t[Wn.el]={display:"flex",alignItems:"center"},t[Wn.bl]={width:"140px",height:"14px",margin:"0px 5px"},t[Wn.VI]={padding:"0px"},t)}},tooltip:{domStyles:(n={},n[cn.rC]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:r.tooltipContainerFillColor,boxShadow:r.tooltipContainerShadow,borderRadius:"".concat(r.tooltipContainerBorderRadius,"px"),color:r.tooltipTextFillColor,fontSize:"".concat(r.tooltipTextFontSize,"px"),fontFamily:r.fontFamily,lineHeight:r.tooltipTextLineHeight},n[cn.O6]={marginBottom:"4px"},n[cn.fL]={margin:"0px",padding:"0px"},n[cn.jp]={marginBottom:"4px"},n[cn.bX]={color:r.tooltipItemNameFillColor},n[cn.Tf]={color:r.tooltipItemValueFillColor,marginLeft:"30px"},n)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight}}}}}var Vt={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},L5={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},R5=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],k5=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],F5=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],I0=function(r){r===void 0&&(r={});var a=r.mapStyle,t=a===void 0?"light":a,n=r.subColor,e=n===void 0?"rgba(0,0,0,0.05)":n,i=r.paletteQualitative10,o=i===void 0?R5:i,u=r.paletteQualitative20,s=u===void 0?k5:u,l=r.paletteSemanticRed,c=l===void 0?"#F4664A":l,f=r.paletteSemanticGreen,p=f===void 0?"#30BF78":f,h=r.paletteSemanticYellow,g=h===void 0?"#FAAD14":h,v=r.paletteSequence,_=v===void 0?F5:v,x=r.fontFamily,C=x===void 0?`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`:x,S=r.brandColor,M=S===void 0?o[0]:S;return{mapStyle:t,brandColor:M,subColor:e,paletteQualitative10:o,paletteQualitative20:s,paletteSemanticRed:c,paletteSemanticGreen:p,paletteSemanticYellow:g,paletteSequence:_,fontFamily:C,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:Vt[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:Vt[65],tooltipItemNameFillColor:Vt[65],tooltipItemValueFillColor:Vt[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:Vt[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:M,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:L5[100],pointActiveBorderColor:Vt[100],pointSelectedBorderColor:Vt[100]}},oA=I0(),w5={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Gt={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},P0=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],O5=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],D5=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],B0=function(r){r===void 0&&(r={});var a=r.mapStyle,t=a===void 0?"dark":a,n=r.subColor,e=n===void 0?"rgba(255,255,255,0.05)":n,i=r.paletteQualitative10,o=i===void 0?P0:i,u=r.paletteQualitative20,s=u===void 0?O5:u,l=r.paletteSemanticRed,c=l===void 0?"#F4664A":l,f=r.paletteSemanticGreen,p=f===void 0?"#30BF78":f,h=r.paletteSemanticYellow,g=h===void 0?"#FAAD14":h,v=r.paletteSequence,_=v===void 0?D5:v,x=r.fontFamily,C=x===void 0?`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`:x,S=r.brandColor,M=S===void 0?o[0]:S;return{mapStyle:t,brandColor:M,subColor:e,paletteQualitative10:o,paletteQualitative20:s,paletteSemanticRed:c,paletteSemanticGreen:p,paletteSemanticYellow:g,paletteSequence:_,fontFamily:C,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:Gt[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:Gt[65],tooltipItemNameFillColor:Gt[65],tooltipItemValueFillColor:Gt[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:Gt[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:P0[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:w5[100],pointActiveBorderColor:Gt[100],pointSelectedBorderColor:Gt[100]}},uA=B0();function N0(r){var a=r.styleSheet,t=a===void 0?{}:a,n=(0,Y._T)(r,["styleSheet"]),e=I0(t);return(0,Z.b$)({},D0(e),n)}function I5(r){var a=r.styleSheet,t=a===void 0?{}:a,n=(0,Y._T)(r,["styleSheet"]),e=B0(t);return(0,Z.b$)({},D0(e),n)}var Z0=N0({}),P5=I5({}),ga={default:Z0,light:Z0,dark:P5};function ma(r){return r===void 0&&(r="default"),(0,Z.U2)(ga,(0,Z.vl)(r),ga.default)}function sA(r,a,t){t===void 0&&(t="light"),ga[lowerCase(r)]=t==="light"?createTheme(a):createDarkTheme(a)}var z0={map:{type:ln.Amap},logo:!0},B5=function(r){(0,Y.ZT)(a,r);function a(t){var n=r.call(this)||this;return n.inited=!1,n.sceneLoaded=!1,n.layersLoaded=!1,n.loaded=!1,n.layerGroup=new O0,n.options=je({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return a.prototype.getDefaultOptions=function(){return a.DefaultOptions},a.prototype.createContainer=function(t){var n=this.options,e=n.width,i=n.height,o=typeof t=="string"?document.getElementById(t):t;return o.style.position||(o.style.position="relative"),e&&(o.style.width||(o.style.width="".concat(e,"px"))),i&&(o.style.height||(o.style.height="".concat(i,"px"))),o},a.prototype.createTheme=function(){var t=(0,Z.Kn)(this.options.theme)?je({},ma("default"),N0(this.options.theme)):ma(this.options.theme);return t},a.prototype.createMap=function(){var t=this.options.map?this.options.map:z0.map,n=t.type,e=(0,Y._T)(t,["type"]),i=Object.assign({style:this.theme.mapStyle},e);return n===ln.Amap?new W3(i):new u5(i)},a.prototype.createScene=function(){var t=this.options,n=t.logo,e=t.antialias,i=t.preserveDrawingBuffer,o=(0,Z.jn)(n)?{logoVisible:n}:{logoVisible:n==null?void 0:n.visible,logoPosition:n==null?void 0:n.position},u=Object.assign({antialias:e,preserveDrawingBuffer:i},o),s=this.createMap(),l=new A3((0,Y.pi)({id:this.container,map:s},u));return l},a.prototype.registerResources=function(){var t=this;jt.size&&jt.forEach(function(n,e){!t.scene.hasImage(e)&&t.scene.addImage(e,n)}),Or.size&&Or.forEach(function(n,e){t.scene.addFontFace(e,n)}),Gn.size&&Gn.forEach(function(n,e){t.scene.addIconFont(e,n)})},a.prototype.update=function(t){this.updateOption(t),t.map&&!(0,Z.Xy)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")},a.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=je({},this.options,t)},a.prototype.updateMap=function(t){var n;if(!!this.scene){var e=t.style,i=t.center,o=t.zoom,u=t.rotation,s=t.pitch;(0,Z.o8)(s)||this.scene.setPitch(s),(0,Z.o8)(u)||this.scene.setRotation(u),e&&e!==((n=this.lastOptions.map)===null||n===void 0?void 0:n.style)&&this.scene.setMapStyle(e),o&&i&&this.scene.setZoomAndCenter(o,i)}},a.prototype.changeSize=function(t,n){this.options.width===t&&this.options.height===n||(this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(n,"px"),this.options=Object.assign(this.options,{width:t,height:n}))},a.prototype.on=function(t,n,e){return this.proxyEventHander("on",t,n,e),this},a.prototype.once=function(t,n){return this.proxyEventHander("once",t,n),this},a.prototype.off=function(t,n){return this.proxyEventHander("off",t,n),this},a.prototype.proxyEventHander=function(t,n,e,i){var o=T5.find(function(f){return f.adaptation===n});if(o)this.scene[t](o.original,e);else if(M5.indexOf(n)!==-1)this.scene[t](n,e);else if(n.includes("Layer:")){var u=(0,Y.CR)(n.split(":"),2),s=u[0],l=u[1],c=this[s]&&this[s][t];if(c&&wr.indexOf(l)!==-1)this[s][t](l,e);else throw new Error('No event name "'.concat(n,'"'))}else r.prototype[t].call(this,n,e,i)},a.prototype.getScene=function(){return this.scene},a.prototype.getMap=function(){var t,n;return((t=this.options.map)===null||t===void 0?void 0:t.type)===ln.Amap?this.scene.map:((n=this.options.map)===null||n===void 0?void 0:n.type)===ln.Mapbox?this.scene.map:this.scene.map},a.prototype.addLayer=function(t){this.layerGroup.addLayer(t)},a.prototype.getLayes=function(){return console.warn("Replace to use getLayers()"),this.getLayers()},a.prototype.getLayers=function(){return this.layerGroup.getLayers()},a.prototype.getLayerByName=function(t){return this.layerGroup.getLayerByName(t)},a.prototype.removeLayer=function(t){return this.layerGroup.removeLayer(t)},a.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},a.prototype.zoomIn=function(){this.scene.zoomIn()},a.prototype.zoomOut=function(){this.scene.zoomOut()},a.prototype.setPitch=function(t){this.scene.setPitch(t)},a.prototype.fitBounds=function(t){this.scene.fitBounds(t)},a.prototype.setMapStatus=function(t){this.scene.setMapStatus(t)},a.prototype.setBgColor=function(t){this.scene.setBgColor(t)},a.prototype.initComponents=function(){this.initControls(),this.initTooltip()},a.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},a.prototype.initControls=function(){var t=this,n=this.options,e=n.zoom,i=n.scale,o=n.layerMenu,u=n.legend;i&&this.addScaleControl(i),e&&this.addZoomControl(e),o&&this.addLayerMenuControl(o),u&&setTimeout(function(){t.addLegendControl(u),t.emit("add-legend")},1e3)},a.prototype.updateControls=function(){var t=this.options,n=t.zoom,e=t.scale,i=t.layerMenu,o=t.legend;(0,Z.Xy)(this.lastOptions.zoom,n)||(n?this.updateZoomControl(n):this.removeZoomControl()),(0,Z.Xy)(this.lastOptions.scale,e)||(e?this.updateScaleControl(e):this.removeScaleControl()),(0,Z.Xy)(this.lastOptions.layerMenu,i)||(i?this.updateLayerMenuControl(i):this.removeLayerMenuControl()),(0,Z.Xy)(this.lastOptions.legend,o)||(o?this.updateLegendControl(o):this.removeLegendControl())},a.prototype.addZoomControl=function(t){this.zoomControl||(this.zoomControl=new Ay(t),this.scene.addControl(this.zoomControl))},a.prototype.updateZoomControl=function(t){if(!this.zoomControl){this.addZoomControl(t);return}this.removeZoomControl(),this.addZoomControl(t)},a.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},a.prototype.addScaleControl=function(t){this.scaleControl||(this.scaleControl=new Cy(t),this.scene.addControl(this.scaleControl))},a.prototype.updateScaleControl=function(t){if(!this.scaleControl){this.addScaleControl(t);return}this.removeScaleControl(),this.addScaleControl(t)},a.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},a.prototype.addLayerMenuControl=function(t){var n={},e={};this.layerGroup.getLayers().forEach(function(i){var o=i.name,u=i.layer;e[o]=u})},a.prototype.updateLayerMenuControl=function(t){this.removeLayerMenuControl(),this.addLayerMenuControl(t)},a.prototype.removeLayerMenuControl=function(){},a.prototype.getLegendOptions=function(){return{}},a.prototype.addLegendControl=function(t){if(!this.legendControl){var n=this.theme.components.legend,e=je({},this.getLegendOptions(),t),i=e.type,o=e.position,u=(0,Y._T)(e,["type","position"]),s=[];if(i==="category"){var l=je({},{domStyles:n.category.domStyles},u);s.push({type:i,options:l})}else if(i==="continue"){var c=je({},{domStyles:n.continue.domStyles},u);s.push({type:i,options:c})}s.length&&(this.legendControl=new A5({position:o,items:s}),this.scene.addControl(this.legendControl))}},a.prototype.updateLegendControl=function(t){if(!this.legendControl){this.addLegendControl(t);return}this.removeLegendControl(),this.addLegendControl(t)},a.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},a.prototype.initTooltip=function(){var t=this;this.tooltip&&this.tooltip.destroy();var n=this.options.tooltip;if(n){var e=je({},{domStyles:this.theme.components.tooltip.domStyles},n),i=this.layerGroup.getInteractionLayers();this.tooltip=new y5(this.scene,i,e),this.tooltip.on("*",function(o){return t.emit(o.type,o)})}},a.prototype.exportPng=function(t){return this.scene.exportPng(t)},a.prototype.destroy=function(){var t;r.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.scene.destroy()},a.DefaultOptions=z0,a}(Fr.Z),U0;(function(r){r[r.solid=0]="solid",r[r.dash=1]="dash"})(U0||(U0={}));var ya;(function(r){r.TextLayer="textLayer",r.DotLayer="dotLayer",r.IconLayer="iconLayer",r.DotDensity="dotDensityLayer",r.ColumnLayer="columnLayer",r.HeatmapLayer="heatmapLayer",r.GridLayer="gridLayer",r.HexbinLayer="hexbinLayer",r.LinesLayer="linesLayer",r.PathLayer="pathLayer",r.ArcLayer="arcLayer",r.AreaLayer="areaLayer",r.PrismLayer="prismLayer"})(ya||(ya={}));var _a=function(){function r(){}return r.aggregation=function(a,t){var n=t.type,e=n===void 0?"grid":n,i=t.radius,o=t.method,u=t.field,s={type:e,size:i,method:o,field:u};a.transforms?(a.transforms=a.transforms.filter(function(l){return l.type!==s.type}),a.transforms.push(s)):a.transforms=[s]},r}(),H0=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],pn=function(r){(0,Y.ZT)(a,r);function a(t){var n=r.call(this)||this;return n.options=je({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return a.prototype.getDefaultOptions=function(){return{}},a.prototype.pickLayerConfig=function(t){var n=(0,Z.ei)(t,H0);return n},a.prototype.addTo=function(t){t.addLayer(this.layer)},a.prototype.remove=function(t){t.removeLayer(this.layer)},a.prototype.update=function(t){this.updateOption(t),this.updateConfig(t)},a.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=je({},this.options,t)},a.prototype.updateConfig=function(t){!(0,Z.o8)(t.zIndex)&&!(0,Z.Xy)(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(t.zIndex),!(0,Z.o8)(t.blend)&&!(0,Z.Xy)(this.lastOptions.blend,this.options.blend)&&this.setBlend(t.blend),!(0,Z.o8)(t.minZoom)&&!(0,Z.Xy)(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(t.minZoom),!(0,Z.o8)(t.maxZoom)&&!(0,Z.Xy)(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMinZoom(t.maxZoom),!(0,Z.o8)(t.visible)&&!(0,Z.Xy)(this.lastOptions.visible,this.options.visible)&&(t.visible?this.show():this.hide())},a.prototype.render=function(){this.layer.renderLayers()},a.prototype.setSource=function(t){if(t instanceof On)this.layer.setSource(t);else{var n=t.data,e=t.aggregation,i=(0,Y._T)(t,["data","aggregation"]);e&&_a.aggregation(i,e);var o=this.layer.getSource();o?this.layer.setData(n,i):this.layer.source(n,i)}},a.prototype.changeData=function(t){this.setSource(t)},a.prototype.setIndex=function(t){this.layer.setIndex(t)},a.prototype.setBlend=function(t){this.layer.setBlend(t)},a.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},a.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},a.prototype.show=function(){this.layer.inited&&this.layer.show()},a.prototype.hide=function(){this.layer.inited&&this.layer.hide()},a.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},a.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},a.prototype.fitBounds=function(t){this.layer.fitBounds(t)},a.prototype.on=function(t,n){return wr.indexOf(t)!==-1?this.layer.on(t,n):r.prototype.on.call(this,t,n),this},a.prototype.once=function(t,n){return wr.indexOf(t)!==-1?this.layer.once(t,n):r.prototype.once.call(this,t,n),this},a.prototype.off=function(t,n){return wr.indexOf(t)!==-1?this.layer.off(t,n):r.prototype.off.call(this,t,n),this},a.LayerType=ya,a.LayerConfigkeys=H0,a}(Fr.Z);function Wt(r,a){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e={};return r.forEach(function(i,o){e[i]=t[o]}),delete e.undefined,a(e)}}var de=function(){function r(){}return r.shape=function(a,t){if((0,Z.HD)(t))a.shape(t);else if((0,Z.mf)(t)){var n=[];a.shape(n.join("*"),Wt(n,t))}else if((0,Z.Kn)(t)){var e=t.field?t.field:"";if((0,Z.mf)(t.value)){var n=(0,Z.kJ)(e)?e:e.split("*");a.shape(e,Wt(n,t.value))}else a.shape(e,t.value);(0,Z.HD)(e)&&t.scale&&r.scale(a,e,t.scale)}},r.size=function(a,t){if((0,Z.hj)(t))a.size(t);else if((0,Z.kJ)(t))a.size(t);else if((0,Z.mf)(t)){var n=[];a.size(n.join("*"),Wt(n,t))}else if((0,Z.Kn)(t)){var e=t.field?t.field:"";if((0,Z.mf)(t.value)){var n=(0,Z.kJ)(e)?e:e.split("*");a.size(e,Wt(n,t.value))}else a.size(e,t.value);(0,Z.HD)(e)&&t.scale&&r.scale(a,e,t.scale)}},r.color=function(a,t){if((0,Z.HD)(t))a.color(t);else if((0,Z.mf)(t)){var n=[];a.color(n.join("*"),Wt(n,t))}else if((0,Z.Kn)(t)){var e=t.field?t.field:"";if((0,Z.mf)(t.value)){var n=(0,Z.kJ)(e)?e:e.split("*");a.color(e,Wt(n,t.value))}else a.color(e,t.value);(0,Z.HD)(e)&&t.scale&&r.scale(a,e,t.scale)}},r.style=function(a,t){t&&a.style(t)},r.state=function(a,t){var n=t.active,e=t.select;n&&a.active(n),e&&a.select(e)},r.rotate=function(a,t){(0,Z.HD)(t)||(0,Z.mf)(t)||(0,Z.Kn)(t)},r.texture=function(a,t){(0,Z.HD)(t)&&a.texture(t)},r.animate=function(a,t){((0,Z.jn)(t)||(0,Z.Kn)(t))&&a.animate(t)},r.scale=function(a,t,n){a.scale(t,n)},r.filter=function(a,t){var n=t.field?t.field:"",e=(0,Z.kJ)(n)?n:n.split("*");a.filter(e.join("*"),Wt(e,t.value))},r}();function N5(r,a){var t=a.field,n=a.content,e=a.style,i=e===void 0?{}:e,o=a.state,u=i.fontSize,s=i.fill,l=t||n||"",c={field:l,value:"text"};de.shape(r,c),u&&de.size(r,u),s&&de.color(r,s),i&&de.style(r,i),o&&de.state(r,o)}var j0={style:{fontSize:12}},Z5=[],z5=function(r){(0,Y.ZT)(a,r);function a(t){var n=r.call(this,t)||this;n.type=pn.LayerType.TextLayer,n.interaction=!1;var e=n.options,i=e.name,o=e.source,u=n.pickLayerConfig(n.options);return n.name=i||(0,Z.EL)(n.type),n.layer=new Cr((0,Y.pi)((0,Y.pi)({},u),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return a.prototype.getDefaultOptions=function(){return j0},a.prototype.mappingLayer=function(t,n){N5(t,n)},a.prototype.update=function(t){r.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},a.DefaultOptions=j0,a.LayerOptionsKeys=pn.LayerConfigkeys.concat(Z5),a}(pn),Ea;(function(r){r.Dot="dot",r.DotDensity="dotDensity",r.Heatmap="heatmap",r.Grid="grid",r.Hexbin="hexbin",r.Path="path",r.Flow="flow",r.Area="area",r.Choropleth="choropleth"})(Ea||(Ea={}));var U5={autoFit:!1},xa=function(r){(0,Y.ZT)(a,r);function a(t,n){var e=this;if(typeof t=="string"||t instanceof Element){if(n===void 0)throw new Error("options is undefined");e=r.call(this,n)||this,e.container=e.createContainer(t),e.theme=e.createTheme(),e.scene=e.createScene(),e.registerResources(),e.initSource()}else e=r.call(this,t)||this;return e}return a.prototype.initSource=function(){this.source=this.createSource(),this.render(),this.inited=!0},a.prototype.initLayersEvent=function(){},a.prototype.getDefaultOptions=function(){return a.DefaultOptions},a.prototype.createSource=function(){var t=this.options.source,n=t.data,e=t.aggregation,i=(0,Y._T)(t,["data","aggregation"]);e&&_a.aggregation(i,e);var o=new On(n,i);return o},a.prototype.createLabelLayer=function(t,n,e){var i=e||{},o=i.visible,u=i.minZoom,s=i.maxZoom,l=i.zIndex,c=l===void 0?0:l,f=new z5((0,Y.pi)({name:"labelLayer",visible:o,minZoom:u,maxZoom:s,zIndex:c+.1,source:t},n));return f},a.prototype.updateLabelLayer=function(t,n,e,i){n?i?i.update((0,Y.pi)({},n)):(i=this.createLabelLayer(t,n,e),this.layerGroup.addLayer(i)):n===!1&&i&&this.layerGroup.removeLayer(i)},a.prototype.render=function(){var t=this,n=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),n.addTo(this.scene),this.layerGroup=n):(this.layerGroup=n,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",function(){t.onSceneLoaded()})),this.initLayersEvent()},a.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",function(){t.onLayersLoaded()}),this.layerGroup.addTo(this.scene)},a.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")},a.prototype.attachToScene=function(t,n){this.scene=t,this.theme=n||ma("default"),this.registerResources(),this.initSource()},a.prototype.unattachFromScene=function(){var t;this.removeAllLayer(),(t=this.tooltip)===null||t===void 0||t.destroy()},a.prototype.addToScene=function(t){this.attachToScene(t)},a.prototype.removeFromScene=function(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy()},a.prototype.update=function(t){if(this.updateOption(t),t.map&&!(0,Z.Xy)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!(0,Z.Xy)(this.lastOptions.source,this.options.source)){var n=t.source,e=n.data,i=(0,Y._T)(n,["data"]);this.changeData(e,i)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},a.prototype.changeData=function(t,n){var e=this;this.options.source=je({},this.options.source,(0,Y.pi)({data:t},n));var i=this.options.source,o=i.aggregation,u=(0,Y._T)(i,["aggregation"]);o&&_a.aggregation(u,o),this.source.setData(this.options.source.data,u);var s=this.options.legend;s&&setTimeout(function(){e.updateLegendControl(s)}),this.emit("change-data")},a.DefaultOptions=U5,a.PlotType=Ea,a}(B5),H5=je({},xa.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}}),V0="#2f54eb",Te={active:{fill:!1,stroke:V0,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:V0,lineWidth:1.5,lineOpacity:.8}},$n=function(r){return(0,Z.o8)(r)||(r.active===!1?Te.active=Object.assign(Te.active,{fill:!1,stroke:!1}):typeof r.active=="object"&&(r.active.fill===!1?Te.active.fill=!1:typeof r.active.fill=="string"&&(Te.active.fill=r.active.fill),r.active.stroke===!1?Te.active.stroke=!1:typeof r.active.stroke=="string"&&(Te.active.stroke=r.active.stroke),typeof r.active.lineWidth=="number"&&(Te.active.lineWidth=r.active.lineWidth),typeof r.active.lineOpacity=="number"&&(Te.active.lineOpacity=r.active.lineOpacity)),r.select===!1?Te.select=Object.assign(Te.select,{fill:!1,stroke:!1}):typeof r.select=="object"&&(r.select.fill===!1?Te.select.fill=!1:typeof r.select.fill=="string"&&(Te.select.fill=r.select.fill),r.select.stroke===!1?Te.select.stroke=!1:typeof r.select.stroke=="string"&&(Te.select.stroke=r.select.stroke),typeof r.select.lineWidth=="number"&&(Te.select.lineWidth=r.select.lineWidth),typeof r.select.lineOpacity=="number"&&(Te.select.lineOpacity=r.select.lineOpacity))),Te};function j5(r,a,t,n,e,i){var o=i.color,u=i.style,s=i.state,l=$n(s),c={active:l.active.fill===!1?!1:{color:l.active.fill},select:!1},f={opacity:u==null?void 0:u.opacity},p=u==null?void 0:u.fillBottomColor,h=u==null?void 0:u.lineWidth,g=u==null?void 0:u.stroke,v={opacity:u==null?void 0:u.lineOpacity,dashArray:u==null?void 0:u.lineDash,lineType:u==null?void 0:u.lineType};if(de.shape(r,"fill"),o&&de.color(r,o),f&&de.style(r,f),c&&de.state(r,c),p&&r.setBottomColor(p),de.shape(a,"line"),h&&de.size(a,h),g&&de.color(a,g),v&&de.style(a,v),l.active.stroke){var _=l.active.stroke,x=l.active.lineWidth||h,C={opacity:l.active.lineOpacity};de.shape(t,"line"),x&&de.size(t,x),_&&de.color(t,_),C&&de.style(t,C)}if(l.select.fill){var S=l.select.fill;de.shape(n,"fill"),S&&de.color(n,S),f&&de.style(n,f),de.state(n,{select:!1,active:!1})}if(l.select.stroke){var M=l.select.stroke,x=l.select.lineWidth||h,L={opacity:l.select.lineOpacity};de.shape(e,"line"),x&&de.size(e,x),M&&de.color(e,M),L&&de.style(e,L)}}var V5=z(56169),G5=z(98392),W5=z(66279),G0=z(13633),$5=V5.Z.isFinite,X5=Math.min;function Y5(r){var a=Math[r];return function(t,n){if(t=(0,W5.Z)(t),n=n==null?0:X5((0,G5.Z)(n),292),n&&$5(t)){var e=((0,G0.Z)(t)+"e").split("e"),i=a(e[0]+"e"+(+e[1]+n));return e=((0,G0.Z)(i)+"e").split("e"),+(e[0]+"e"+(+e[1]-n))}return a(t)}}var K5=Y5,Q5=K5("round"),W0=Q5,q5=function(r){return!Array.isArray(r[0].value)},J5=function(r){if(q5(r))return r;var a=r.map(function(t){return(0,Y.pi)((0,Y.pi)({},t),{value:[W0(t.value[0],2),W0(t.value[1],2)]})});return a},$0={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},eS=["color","style","state","enabledMultiSelect"],Ca=function(r){(0,Y.ZT)(a,r);function a(t){var n=r.call(this,t)||this;n.selectData=[],n.type=pn.LayerType.AreaLayer,n.interaction=!0,n.onHighlighHandle=function(g){var v=g.feature,_=g.featureId;n.setHighlightLayerSource(v,_)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(g){var v=n.options.enabledMultiSelect,_=g.feature,x=g.featureId,C=(0,Z.d9)(n.selectData),S=C.findIndex(function(L){return L.featureId===x});if(S===-1)v?C.push({feature:_,featureId:x}):C=[{feature:_,featureId:x}],n.emit("select",_,(0,Z.d9)(C));else{var M=C[S];v?C.splice(S,1):C=[],n.emit("unselect",M,(0,Z.d9)(C))}n.setSelectLayerSource(C)};var e=n.options,i=e.name,o=e.source,u=e.visible,s=e.minZoom,l=e.maxZoom,c=e.zIndex,f=c===void 0?0:c,p=n.pickLayerConfig(n.options),h=$n(n.options.state);return n.name=i||(0,Z.EL)(n.type),n.layer=new Sr((0,Y.pi)((0,Y.pi)({},p),{name:n.name})),n.strokeLayer=new Nn({name:"strokeLayer",visible:u,zIndex:f,minZoom:s,maxZoom:l}),n.highlightLayer=new Nn({name:"highlightLayer",visible:u&&Boolean(h.active.stroke),zIndex:f+.1,minZoom:s,maxZoom:l}),n.selectFillLayer=new Sr({name:"selectFillLayer",visible:u&&Boolean(h.select.fill),zIndex:f+.1,minZoom:s,maxZoom:l}),n.selectStrokeLayer=new Nn({name:"selectStrokeLayer",visible:u&&Boolean(h.select.stroke),zIndex:f+.1,minZoom:s,maxZoom:l}),n.mappingLayer(n.options),n.setSource(o),n.initEvent(),n}return a.prototype.getDefaultOptions=function(){return $0},a.prototype.mappingLayer=function(t){j5(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)},a.prototype.setSource=function(t){r.prototype.setSource.call(this,t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})},a.prototype.setStrokeLayerSource=function(){var t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{var n=this.layer.sourceOption,e=n.data,i=n.options;this.strokeLayer.source(e,i)}},a.prototype.setHighlightLayerSource=function(t,n){if(n===void 0&&(n=-999),this.highlightLayerData!==n){var e=t?[t]:[];this.highlightLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.highlightLayerData=n}},a.prototype.setSelectLayerSource=function(t){if(t===void 0&&(t=[]),!(this.selectData.length===t.length&&(0,Z.Xy)(this.selectData.map(function(e){var i=e.featureId;return i}),t.map(function(e){var i=e.featureId;return i})))){var n=t.map(function(e){var i=e.feature;return i});this.selectFillLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.selectData=t}},a.prototype.initEvent=function(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,!!this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))},a.prototype.addTo=function(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)},a.prototype.remove=function(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)},a.prototype.update=function(t){if(r.prototype.update.call(this,t),this.mappingLayer(this.options),this.options.visible){!(0,Z.o8)(t.state)&&!(0,Z.Xy)(this.lastOptions.state,this.options.state)&&this.updateHighlightLayer();var n=$n(this.options.state);n.active.stroke&&this.setHighlightLayerSource(),(n.select.fill||n.select.stroke)&&this.setSelectLayerSource()}this.initEvent()},a.prototype.updateHighlightLayer=function(){var t=$n(this.options.state),n=$n(this.lastOptions.state);n.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),n.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),n.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},a.prototype.setIndex=function(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)},a.prototype.setMinZoom=function(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)},a.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)},a.prototype.show=function(){!this.layer.inited||(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())},a.prototype.hide=function(){!this.layer.inited||(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())},a.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");if(Array.isArray(t)&&t.length!==0){var n=J5(t);return n}return[]},a.prototype.setActive=function(t){},a.prototype.setSelect=function(t){},a.DefaultOptions=$0,a.LayerOptionsKeys=pn.LayerConfigkeys.concat(eS),a}(pn),tS=function(r){(0,Y.ZT)(a,r);function a(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=xa.PlotType.Area,t}return a.prototype.getDefaultOptions=function(){return a.DefaultOptions},a.prototype.createLayers=function(t){this.areaLayer=new Ca((0,Y.pi)({source:t},(0,Z.ei)(this.options,Ca.LayerOptionsKeys)));var n=new O0([this.areaLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),n.addLayer(this.labelLayer)),n},a.prototype.updateLayers=function(t){var n=(0,Z.ei)(t,Ca.LayerOptionsKeys);this.areaLayer.update(n),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},a.prototype.initLayersEvent=function(){},a.prototype.getLegendOptions=function(){var t=this.areaLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}},a.DefaultOptions=H5,a}(xa),lA=function(r,a){var t={}.toString;return t.call(r)==="[object ".concat(a,"]")},cA=function(r){return Object.prototype.toString.call(r).slice(8,-1)},Sa=function(r){if(!r||typeof r!="object")return r;var a;return Array.isArray(r)?a=r.map(function(t){return Sa(t)}):(a={},Object.keys(r).forEach(function(t){return a[t]=Sa(r[t])})),a},fA=function(r){if(!r)return r;var a={};for(var t in r)a[t]=r[t];return a},Xn=function(){return Xn=Object.assign||function(r){for(var a,t=1,n=arguments.length;t<n;t++){a=arguments[t];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(r[e]=a[e])}return r},Xn.apply(this,arguments)},nS=function(r,a){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&a.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,n=Object.getOwnPropertySymbols(r);e<n.length;e++)a.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(r,n[e])&&(t[n[e]]=r[n[e]]);return t},X0=function(r){var a=r.source,t=nS(r,["source"]),n=Xn(Xn({},Sa(t)),{source:Xn({},a)});return n},ba=function(){return ba=Object.assign||function(r){for(var a,t=1,n=arguments.length;t<n;t++){a=arguments[t];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(r[e]=a[e])}return r},ba.apply(this,arguments)},Dr=function(r,a){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&a.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,n=Object.getOwnPropertySymbols(r);e<n.length;e++)a.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(r,n[e])&&(t[n[e]]=r[n[e]]);return t};function rS(r,a){var t=(0,ae.useRef)(),n=(0,ae.useRef)(),e=(0,ae.useRef)(null),i=a.onReady;return(0,ae.useEffect)(function(){if(!(!t.current||!n.current||(0,Z.Xy)(n.current,a))){var o=!1,u=!1,s=!1,l=n.current,c=l.onReady,f=l.map,p=l.source,h=p.data,g=Dr(p,["data"]),v=Dr(l,["onReady","map","source"]),_=a.onReady,x=a.map,C=a.source,S=C.data,M=Dr(C,["data"]),L=Dr(a,["onReady","map","source"]);if(u=!(0,Z.Xy)(f,x),o=!(0,Z.Xy)(g,M)||h!==S,s=!(0,Z.Xy)(v,L),n.current=X0(a),u){var D=(0,Z.ei)(x,["center","pitch","rotation","zoom","style"]);t.current.updateMap(D)}o&&(t.current.loaded?t.current.changeData(S,M):t.current.once("loaded",function(){var B;(B=t.current)===null||B===void 0||B.changeData(S,M)})),s&&(t.current.loaded?t.current.update(L):t.current.once("loaded",function(){var B;(B=t.current)===null||B===void 0||B.update(L)}))}},[a]),(0,ae.useEffect)(function(){return e.current?(n.current||(n.current=X0(a)),t.current=new r(e.current,ba({},a)),i&&t.current.once("loaded",function(){i(t.current)}),function(){t.current&&(t.current.destroy(),t.current=void 0)}):function(){return null}},[]),{plotRef:t,containerRef:e}}var iS=function(r,a){!r||((0,Z.mf)(r)?r(a):r.current=a)},aS=function(){var r=function(a,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])},r(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(a,t);function n(){this.constructor=a}a.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),oS=function(r){aS(a,r);function a(){var t=r!==null&&r.apply(this,arguments)||this;return t.state={hasError:!1},t.renderError=function(n){var e=t.props.errorTemplate;switch(n){default:return typeof e=="function"?e(n):e||ae.createElement("h5",null,"\u7EC4\u4EF6\u51FA\u9519\u4E86\uFF0C\u8BF7\u6838\u67E5\u540E\u91CD\u8BD5\uFF1A ",n.message)}},t}return a.getDerivedStateFromError=function(t){return{hasError:!0,error:t}},a.getDerivedStateFromProps=function(t,n){return n.children!==t.children?{children:t.children,hasError:!1,error:void 0}:null},a.prototype.render=function(){return this.state.hasError?this.renderError(this.state.error):ae.createElement(ae.Fragment,null,this.props.children)},a}(ae.Component),uS=oS,sS=z(24561),lS=function(r){var a=r.loadingTemplate,t=function(){return a||ae.createElement(sS.ZP,{viewBox:"0 0 400 180",width:200,height:90,speed:1},ae.createElement("rect",{x:"20",y:"5",rx:"0",ry:"0",width:"1",height:"170"}),ae.createElement("rect",{x:"20",y:"175",rx:"0",ry:"0",width:"360",height:"1"}),ae.createElement("rect",{x:"40",y:"75",rx:"0",ry:"0",width:"35",height:"100"}),ae.createElement("rect",{x:"80",y:"125",rx:"0",ry:"0",width:"35",height:"50"}),ae.createElement("rect",{x:"120",y:"105",rx:"0",ry:"0",width:"35",height:"70"}),ae.createElement("rect",{x:"160",y:"35",rx:"0",ry:"0",width:"35",height:"140"}),ae.createElement("rect",{x:"200",y:"55",rx:"0",ry:"0",width:"35",height:"120"}),ae.createElement("rect",{x:"240",y:"15",rx:"0",ry:"0",width:"35",height:"160"}),ae.createElement("rect",{x:"280",y:"135",rx:"0",ry:"0",width:"35",height:"40"}),ae.createElement("rect",{x:"320",y:"85",rx:"0",ry:"0",width:"35",height:"90"}))};return ae.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",left:0,top:0,zIndex:99,backgroundColor:"#fff"}},t())},cS=lS,fS=function(r,a){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&a.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,n=Object.getOwnPropertySymbols(r);e<n.length;e++)a.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(r,n[e])&&(t[n[e]]=r[n[e]]);return t},pS=(0,ae.forwardRef)(function(r,a){var t=r.chartRef,n=r.containerStyle,e=n===void 0?{height:"inherit"}:n,i=r.className,o=r.loading,u=r.loadingTemplate,s=r.errorTemplate,l=fS(r,["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"]),c=rS(tS,l),f=c.plotRef,p=c.containerRef;return(0,ae.useEffect)(function(){iS(t,f.current)},[f.current]),(0,ae.useImperativeHandle)(a,function(){return{getChart:function(){return f.current}}}),ae.createElement(uS,{errorTemplate:s},o&&ae.createElement(cS,{loadingTemplate:u}),ae.createElement("div",{className:i,style:e,ref:p}))}),hS=pS},69498:function(Ie){"use strict";(function($,z){Ie.exports=z()})(this,function(){function $(T){var ne=[];return T.AMapUI&&ne.push(z(T.AMapUI)),T.Loca&&ne.push(ae(T.Loca)),Promise.all(ne)}function z(T){return new Promise(function(ne,y){var E=[];if(T.plugins)for(var F=0;F<T.plugins.length;F+=1)Z.AMapUI.plugins.indexOf(T.plugins[F])==-1&&E.push(T.plugins[F]);if(A.AMapUI===Y.failed)y("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(A.AMapUI===Y.notload){A.AMapUI=Y.loading,Z.AMapUI.version=T.version||Z.AMapUI.version,F=Z.AMapUI.version;var O=document.body||document.head,b=document.createElement("script");b.type="text/javascript",b.src="https://webapi.amap.com/ui/"+F+"/main.js",b.onerror=function(d){A.AMapUI=Y.failed,y("\u8BF7\u6C42 AMapUI \u5931\u8D25")},b.onload=function(){if(A.AMapUI=Y.loaded,E.length)window.AMapUI.loadUI(E,function(){for(var d=0,Ee=E.length;d<Ee;d++){var pe=E[d].split("/").slice(-1)[0];window.AMapUI[pe]=arguments[d]}for(ne();W.AMapUI.length;)W.AMapUI.splice(0,1)[0]()});else for(ne();W.AMapUI.length;)W.AMapUI.splice(0,1)[0]()},O.appendChild(b)}else A.AMapUI===Y.loaded?T.version&&T.version!==Z.AMapUI.version?y("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):E.length?window.AMapUI.loadUI(E,function(){for(var d=0,Ee=E.length;d<Ee;d++){var pe=E[d].split("/").slice(-1)[0];window.AMapUI[pe]=arguments[d]}ne()}):ne():T.version&&T.version!==Z.AMapUI.version?y("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):W.AMapUI.push(function(d){d?y(d):E.length?window.AMapUI.loadUI(E,function(){for(var Ee=0,pe=E.length;Ee<pe;Ee++){var Qe=E[Ee].split("/").slice(-1)[0];window.AMapUI[Qe]=arguments[Ee]}ne()}):ne()})})}function ae(T){return new Promise(function(ne,y){if(A.Loca===Y.failed)y("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(A.Loca===Y.notload){A.Loca=Y.loading,Z.Loca.version=T.version||Z.Loca.version;var E=Z.Loca.version,F=Z.AMap.version.startsWith("2"),O=E.startsWith("2");if(F&&!O||!F&&O)y("JSAPI \u4E0E Loca \u7248\u672C\u4E0D\u5BF9\u5E94\uFF01\uFF01");else{F=Z.key,O=document.body||document.head;var b=document.createElement("script");b.type="text/javascript",b.src="https://webapi.amap.com/loca?v="+E+"&key="+F,b.onerror=function(d){A.Loca=Y.failed,y("\u8BF7\u6C42 AMapUI \u5931\u8D25")},b.onload=function(){for(A.Loca=Y.loaded,ne();W.Loca.length;)W.Loca.splice(0,1)[0]()},O.appendChild(b)}}else A.Loca===Y.loaded?T.version&&T.version!==Z.Loca.version?y("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):ne():T.version&&T.version!==Z.Loca.version?y("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):W.Loca.push(function(d){d?y(d):y()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var Y;(function(T){T.notload="notload",T.loading="loading",T.loaded="loaded",T.failed="failed"})(Y||(Y={}));var Z={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},A={AMap:Y.notload,AMapUI:Y.notload,Loca:Y.notload},W={AMap:[],AMapUI:[],Loca:[]},k=[],R=function(T){typeof T=="function"&&(A.AMap===Y.loaded?T(window.AMap):k.push(T))};return{load:function(T){return new Promise(function(ne,y){if(A.AMap==Y.failed)y("");else if(A.AMap==Y.notload){var E=T.key,F=T.version,O=T.plugins;E?(window.AMap&&location.host!=="lbs.amap.com"&&y("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),Z.key=E,Z.AMap.version=F||Z.AMap.version,Z.AMap.plugins=O||Z.AMap.plugins,A.AMap=Y.loading,F=document.body||document.head,window.___onAPILoaded=function(d){if(delete window.___onAPILoaded,d)A.AMap=Y.failed,y(d);else for(A.AMap=Y.loaded,$(T).then(function(){ne(window.AMap)}).catch(y);k.length;)k.splice(0,1)[0]()},O=document.createElement("script"),O.type="text/javascript",O.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+Z.AMap.version+"&key="+E+"&plugin="+Z.AMap.plugins.join(","),O.onerror=function(d){A.AMap=Y.failed,y(d)},F.appendChild(O)):y("\u8BF7\u586B\u5199key")}else if(A.AMap==Y.loaded)if(T.key&&T.key!==Z.key)y("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(T.version&&T.version!==Z.AMap.version)y("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(E=[],T.plugins)for(F=0;F<T.plugins.length;F+=1)Z.AMap.plugins.indexOf(T.plugins[F])==-1&&E.push(T.plugins[F]);E.length?window.AMap.plugin(E,function(){$(T).then(function(){ne(window.AMap)}).catch(y)}):$(T).then(function(){ne(window.AMap)}).catch(y)}else if(T.key&&T.key!==Z.key)y("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(T.version&&T.version!==Z.AMap.version)y("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var b=[];if(T.plugins)for(F=0;F<T.plugins.length;F+=1)Z.AMap.plugins.indexOf(T.plugins[F])==-1&&b.push(T.plugins[F]);R(function(){b.length?window.AMap.plugin(b,function(){$(T).then(function(){ne(window.AMap)}).catch(y)}):$(T).then(function(){ne(window.AMap)}).catch(y)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,Z={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},A={AMap:Y.notload,AMapUI:Y.notload,Loca:Y.notload},W={AMap:[],AMapUI:[],Loca:[]}}}})},23620:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Ie){try{let ne=function(){W||(W=!0,Z())},y=function(){try{A.documentElement.doScroll("left")}catch(E){return void setTimeout(y,50)}ne()};var R=ne,T=y,$=($=document.getElementsByTagName("script"))[$.length-1],z=$.getAttribute("data-injectcss"),$=$.getAttribute("data-disable-injectsvg");if(!$){var ae,Y,Z,A,W,k=function(F,O){O.parentNode.insertBefore(F,O)};if(z&&!Ie.__iconfont__svg__cssinject__){Ie.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(E){console&&console.log(E)}}ae=function(){var F,O=document.createElement("div");O.innerHTML=Ie._iconfont_svg_string_3580659,(O=O.getElementsByTagName("svg")[0])&&(O.setAttribute("aria-hidden","true"),O.style.position="absolute",O.style.width=0,O.style.height=0,O.style.overflow="hidden",O=O,(F=document.body).firstChild?k(O,F.firstChild):F.appendChild(O))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ae,0):(Y=function(){document.removeEventListener("DOMContentLoaded",Y,!1),ae()},document.addEventListener("DOMContentLoaded",Y,!1)):document.attachEvent&&(Z=ae,A=Ie.document,W=!1,y(),A.onreadystatechange=function(){A.readyState=="complete"&&(A.onreadystatechange=null,ne())})}}catch(ne){}}(window)},99653:function(Ie){"use strict";Ie.exports=z,Ie.exports.default=z;var $=1e20;function z(W,k,R,T,ne,y){this.fontSize=W||24,this.buffer=k===void 0?3:k,this.cutoff=T||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=y||"normal",this.radius=R||8;var E=this.size=this.fontSize+this.buffer*2,F=E+this.buffer*2,O=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;O?this.canvas=my.createOffscreenCanvas(E,E,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=E),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Uint16Array(F),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,O?this.middle=Math.round(E/2*1):this.middle=Math.round(E/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ae(W,k,R,T,ne,y,E){y.fill($,0,k*R),E.fill(0,0,k*R);for(var F=(k-T)/2,O=0;O<ne;O++)for(var b=0;b<T;b++){var d=(O+F)*k+b+F,Ee=W.data[4*(O*T+b)+3]/255;if(Ee===1)y[d]=0,E[d]=$;else if(Ee===0)y[d]=$,E[d]=0;else{var pe=Math.max(0,.5-Ee),Qe=Math.max(0,Ee-.5);y[d]=pe*pe,E[d]=Qe*Qe}}}function Y(W,k,R,T,ne,y,E){for(var F=0;F<k*R;F++){var O=Math.sqrt(T[F])-Math.sqrt(ne[F]);W[F]=Math.round(255-255*(O/y+E))}}z.prototype._draw=function(W,k){var R=this.ctx.measureText(W),T=R.width,ne=2*this.buffer,y,E,F,O,b,d,Ee,pe;k&&this.useMetrics?(b=Math.floor(R.actualBoundingBoxAscent),pe=this.buffer+Math.ceil(R.actualBoundingBoxAscent),d=this.buffer,Ee=this.buffer,E=Math.min(this.size,Math.ceil(R.actualBoundingBoxRight-R.actualBoundingBoxLeft)),O=Math.min(this.size-d,Math.ceil(R.actualBoundingBoxAscent+R.actualBoundingBoxDescent)),y=E+ne,F=O+ne,this.ctx.textBaseline="alphabetic"):(y=E=this.size,F=O=this.size,b=19*this.fontSize/24,d=Ee=0,pe=this.middle,this.ctx.textBaseline="middle");var Qe;E&&O&&(this.ctx.clearRect(Ee,d,E,O),this.ctx.fillText(W,this.buffer,pe),Qe=this.ctx.getImageData(Ee,d,E,O));var j=new Uint8ClampedArray(y*F);return ae(Qe,y,F,E,O,this.gridOuter,this.gridInner),Z(this.gridOuter,y,F,this.f,this.v,this.z),Z(this.gridInner,y,F,this.f,this.v,this.z),Y(j,y,F,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:j,metrics:{width:E,height:O,sdfWidth:y,sdfHeight:F,top:b,left:0,advance:T}}},z.prototype.draw=function(W){return this._draw(W,!1).data},z.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function Z(W,k,R,T,ne,y){for(var E=0;E<k;E++)A(W,E,k,R,T,ne,y);for(var F=0;F<R;F++)A(W,F*k,1,k,T,ne,y)}function A(W,k,R,T,ne,y,E){var F,O,b,d;for(y[0]=0,E[0]=-$,E[1]=$,F=0;F<T;F++)ne[F]=W[k+F*R];for(F=1,O=0,b=0;F<T;F++){do d=y[O],b=(ne[F]-ne[d]+F*F-d*d)/(F-d)/2;while(b<=E[O]&&--O>-1);O++,y[O]=F,E[O]=b,E[O+1]=$}for(F=0,O=0;F<T;F++){for(;E[O+1]<F;)O++;d=y[O],W[k+F*R]=ne[d]+(F-d)*(F-d)}}},3876:function(Ie,$){"use strict";var z;z={value:!0},z=z=$.Tf=$.Bc=$.jp=$.fL=$.O6=$.rC=void 0,$.rC="l7plot-legend l7plot-legend__category",$.O6="l7plot-legend__title",$.fL="l7plot-legend__category-list",$.jp="l7plot-legend__list-item",$.Bc="l7plot-legend__category-marker",$.Tf="l7plot-legend__category-value",z='<div class="'.concat($.rC,`">
  <div class="`).concat($.O6,`"></div>
  <ul class="`).concat($.fL,`"></ul>
</div>`),z='<li class="'.concat($.jp,`" data-index={index}>
  <span class="`).concat($.Bc,`" style="background:{color}"></span>
  <span class="`).concat($.Tf,`">{value}</span>
</li>`)},56992:function(Ie,$){"use strict";var z;z={value:!0},z=z=$.VI=$.bl=$.el=$.I8=$.O6=$.rC=void 0,$.rC="l7plot-legend l7plot-legend__continue",$.O6="l7plot-legend__title",$.I8="l7plot-legend__ribbon-container",$.el="l7plot-legend__ribbon",$.bl="l7plot-legend__gradient-bar",$.VI="l7plot-legend__value-range",z='<div class="'.concat($.rC,`">
  <div class="`).concat($.O6,`"></div>
  <div class="`).concat($.I8,`"></div>
</div>`),z='<div class="'.concat($.el,`">
  <span class="`).concat($.VI,`">{min}</span>
  <div class="`).concat($.bl,`" style="background-image: {backgroundImage}"></div>
  <span class="`).concat($.VI,`">{max}</span>
</div>`)},77972:function(Ie,$){"use strict";var z;z={value:!0},z=z=$.Tf=$.bX=$.jp=$.fL=$.O6=$.rC=void 0,$.rC="l7plot-tooltip",$.O6="l7plot-tooltip__title",$.fL="l7plot-tooltip__list",$.jp="l7plot-tooltip__list-item",$.bX="l7plot-tooltip__name",$.Tf="l7plot-tooltip__value",z='<div class="'.concat($.rC,`">
  <div class="`).concat($.O6,`"></div>
  <ul class="`).concat($.fL,`"></ul>
</div>`),z='<li class="'.concat($.jp,`" data-index={index}>
  <span class="`).concat($.bX,`">{name}</span>
  <span class="`).concat($.Tf,`">{value}</span>
</li>`)}}]);
