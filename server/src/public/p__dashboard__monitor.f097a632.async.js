(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{35099:function(Se,pe,O){"use strict";var q=O(67294),he=O(14547),be=O(29640),Ce=O(79360),ce=O(24770),ee=O(80803),de=function(B,K){var Y={};for(var D in B)Object.prototype.hasOwnProperty.call(B,D)&&K.indexOf(D)<0&&(Y[D]=B[D]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,D=Object.getOwnPropertySymbols(B);V<D.length;V++)K.indexOf(D[V])<0&&Object.prototype.propertyIsEnumerable.call(B,D[V])&&(Y[D[V]]=B[D[V]]);return Y},fe=(0,q.forwardRef)(function(B,K){var Y=B.chartRef,D=B.style,V=D===void 0?{height:"inherit"}:D,Ae=B.className,ve=B.loading,Me=B.loadingTemplate,ke=B.errorTemplate,Ie=de(B,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pe=(0,be.Z)(he.aC,Ie),Te=Pe.chart,We=Pe.container;return(0,q.useEffect)(function(){(0,Ce.J)(Y,Te.current)},[Te.current]),(0,q.useImperativeHandle)(K,function(){return{getChart:function(){return Te.current}}}),q.createElement(ce.Z,{errorTemplate:ke},ve&&q.createElement(ee.Z,{loadingTemplate:Me,theme:B.theme}),q.createElement("div",{className:Ae,style:V,ref:We}))});pe.Z=fe},65337:function(Se,pe,O){"use strict";var q=O(67294),he=O(14547),be=O(29640),Ce=O(79360),ce=O(24770),ee=O(80803),de=function(B,K){var Y={};for(var D in B)Object.prototype.hasOwnProperty.call(B,D)&&K.indexOf(D)<0&&(Y[D]=B[D]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,D=Object.getOwnPropertySymbols(B);V<D.length;V++)K.indexOf(D[V])<0&&Object.prototype.propertyIsEnumerable.call(B,D[V])&&(Y[D[V]]=B[D[V]]);return Y},fe=(0,q.forwardRef)(function(B,K){var Y=B.chartRef,D=B.style,V=D===void 0?{height:"inherit"}:D,Ae=B.className,ve=B.loading,Me=B.loadingTemplate,ke=B.errorTemplate,Ie=de(B,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pe=(0,be.Z)(he.Kj,Ie),Te=Pe.chart,We=Pe.container;return(0,q.useEffect)(function(){(0,Ce.J)(Y,Te.current)},[Te.current]),(0,q.useImperativeHandle)(K,function(){return{getChart:function(){return Te.current}}}),q.createElement(ce.Z,{errorTemplate:ke},ve&&q.createElement(ee.Z,{loadingTemplate:Me,theme:B.theme}),q.createElement("div",{className:Ae,style:V,ref:We}))});pe.Z=fe},11231:function(Se,pe,O){"use strict";var q=O(67294),he=O(14547),be=O(29640),Ce=O(79360),ce=O(24770),ee=O(80803),de=function(B,K){var Y={};for(var D in B)Object.prototype.hasOwnProperty.call(B,D)&&K.indexOf(D)<0&&(Y[D]=B[D]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,D=Object.getOwnPropertySymbols(B);V<D.length;V++)K.indexOf(D[V])<0&&Object.prototype.propertyIsEnumerable.call(B,D[V])&&(Y[D[V]]=B[D[V]]);return Y},fe=(0,q.forwardRef)(function(B,K){var Y=B.chartRef,D=B.style,V=D===void 0?{height:"inherit"}:D,Ae=B.className,ve=B.loading,Me=B.loadingTemplate,ke=B.errorTemplate,Ie=de(B,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pe=(0,be.Z)(he.TZ,Ie),Te=Pe.chart,We=Pe.container;return(0,q.useEffect)(function(){(0,Ce.J)(Y,Te.current)},[Te.current]),(0,q.useImperativeHandle)(K,function(){return{getChart:function(){return Te.current}}}),q.createElement(ce.Z,{errorTemplate:ke},ve&&q.createElement(ee.Z,{loadingTemplate:Me,theme:B.theme}),q.createElement("div",{className:Ae,style:V,ref:We}))});pe.Z=fe},64926:function(Se,pe,O){"use strict";var q=O(67294),he=O(14547),be=O(29640),Ce=O(79360),ce=O(24770),ee=O(80803),de=function(B,K){var Y={};for(var D in B)Object.prototype.hasOwnProperty.call(B,D)&&K.indexOf(D)<0&&(Y[D]=B[D]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,D=Object.getOwnPropertySymbols(B);V<D.length;V++)K.indexOf(D[V])<0&&Object.prototype.propertyIsEnumerable.call(B,D[V])&&(Y[D[V]]=B[D[V]]);return Y},fe=(0,q.forwardRef)(function(B,K){var Y=B.chartRef,D=B.style,V=D===void 0?{height:"inherit"}:D,Ae=B.className,ve=B.loading,Me=B.loadingTemplate,ke=B.errorTemplate,Ie=de(B,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pe=(0,be.Z)(he.m,Ie),Te=Pe.chart,We=Pe.container;return(0,q.useEffect)(function(){(0,Ce.J)(Y,Te.current)},[Te.current]),(0,q.useImperativeHandle)(K,function(){return{getChart:function(){return Te.current}}}),q.createElement(ce.Z,{errorTemplate:ke},ve&&q.createElement(ee.Z,{loadingTemplate:Me,theme:B.theme}),q.createElement("div",{className:Ae,style:V,ref:We}))});pe.Z=fe},81138:function(Se,pe,O){"use strict";var q=O(67294),he=O(14547),be=O(29640),Ce=O(79360),ce=O(24770),ee=O(80803),de=function(B,K){var Y={};for(var D in B)Object.prototype.hasOwnProperty.call(B,D)&&K.indexOf(D)<0&&(Y[D]=B[D]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,D=Object.getOwnPropertySymbols(B);V<D.length;V++)K.indexOf(D[V])<0&&Object.prototype.propertyIsEnumerable.call(B,D[V])&&(Y[D[V]]=B[D[V]]);return Y},fe=(0,q.forwardRef)(function(B,K){var Y=B.chartRef,D=B.style,V=D===void 0?{height:"inherit"}:D,Ae=B.className,ve=B.loading,Me=B.loadingTemplate,ke=B.errorTemplate,Ie=de(B,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pe=(0,be.Z)(he.kB,Ie),Te=Pe.chart,We=Pe.container;return(0,q.useEffect)(function(){(0,Ce.J)(Y,Te.current)},[Te.current]),(0,q.useImperativeHandle)(K,function(){return{getChart:function(){return Te.current}}}),q.createElement(ce.Z,{errorTemplate:ke},ve&&q.createElement(ee.Z,{loadingTemplate:Me,theme:B.theme}),q.createElement("div",{className:Ae,style:V,ref:We}))});pe.Z=fe},64335:function(Se,pe,O){"use strict";var q=O(67294),he=(0,q.createContext)({});pe.Z=he},21349:function(Se,pe,O){"use strict";var q=O(84305),he=O(88182),be=O(85893),Ce=O(94184),ce=O.n(Ce),ee=O(67294),de=O(64335),fe=O(53645),B=O.n(fe),K=function(D){var V=(0,ee.useContext)(de.Z),Ae=D.children,ve=D.contentWidth,Me=D.className,ke=D.style,Ie=(0,ee.useContext)(he.ZP.ConfigContext),Pe=Ie.getPrefixCls,Te=D.prefixCls||Pe("pro"),We=ve||V.contentWidth,Kn="".concat(Te,"-grid-content");return(0,be.jsx)("div",{className:ce()(Kn,Me,{wide:We==="Fixed"}),style:ke,children:(0,be.jsx)("div",{className:"".concat(Te,"-grid-content-children"),children:Ae})})};pe.Z=K},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Se){try{let B=function(){ce||(ce=!0,be())},K=function(){try{Ce.documentElement.doScroll("left")}catch(Y){return void setTimeout(K,50)}B()};var de=B,fe=K,pe=(pe=document.getElementsByTagName("script"))[pe.length-1],O=pe.getAttribute("data-injectcss"),pe=pe.getAttribute("data-disable-injectsvg");if(!pe){var q,he,be,Ce,ce,ee=function(D,V){V.parentNode.insertBefore(D,V)};if(O&&!Se.__iconfont__svg__cssinject__){Se.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(Y){console&&console.log(Y)}}q=function(){var D,V=document.createElement("div");V.innerHTML=Se._iconfont_svg_string_3580659,(V=V.getElementsByTagName("svg")[0])&&(V.setAttribute("aria-hidden","true"),V.style.position="absolute",V.style.width=0,V.style.height=0,V.style.overflow="hidden",V=V,(D=document.body).firstChild?ee(V,D.firstChild):D.appendChild(V))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(q,0):(he=function(){document.removeEventListener("DOMContentLoaded",he,!1),q()},document.addEventListener("DOMContentLoaded",he,!1)):document.attachEvent&&(be=q,Ce=Se.document,ce=!1,K(),Ce.onreadystatechange=function(){Ce.readyState=="complete"&&(Ce.onreadystatechange=null,B())})}}catch(B){}}(window)},70499:function(Se){Se.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Se){Se.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},38287:function(Se,pe,O){"use strict";O.r(pe),O.d(pe,{default:function(){return NA}});var q=O(58024),he=O(91894),be=O(13062),Ce=O(71230),ce=O(89032),ee=O(15746),de=O(95300),fe=O(7277),B=O(38563),K=O(35099),Y=O(11231),D=O(81138),V=O(65337),Ae=O(21349),ve=O(92077),Me=O.n(ve),ke=O(39428),Ie=O(2824),Pe=O(3182),Te=O(69610),We=O(54941),Kn=O(81306),ca=O(59206),J=O(67294),Qn=(0,J.createContext)({});function A0(){return(0,J.useContext)(Qn)}var fa={},pa={},da=function(a){return pa[a]},ht=function(a,n){pa[a]=n},T0=function(a){return fa[a]},nn=function(a,n){fa[a]=n},M0=O(18904),G=O(85061),T=O(28991),R0=O(38163),jr=O.n(R0),va=O(92322),An=O(83996);function ha(t,a){var n=a.x,r=a.y,e=a.x1,i=a.y1,o=a.coordinates,u=a.geometry,s=[];if(!Array.isArray(t))return{dataArray:[]};if(u)return t.filter(function(x){return x[u]&&x[u].type&&x[u].coordinates&&x[u].coordinates.length>0}).forEach(function(x,E){var b=(0,T.Z)({},x[u]),A=jr()(b,!0);(0,va.nG)(A,function(F){var I=(0,An.r7)(F),k=(0,T.Z)((0,T.Z)({},x),{},{_id:E,coordinates:I});s.push(k)})}),{dataArray:s};for(var l=0;l<t.length;l++){var c=t[l],f=[];if(o){var p="Polygon";Array.isArray(o[0])||(p="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(p="LineString");var d={type:p,coordinates:(0,G.Z)(c[o])},g=jr()(d,!0);f=g.coordinates}else if(n&&r&&e&&i){var m=[parseFloat(c[n]),parseFloat(c[r])],_=[parseFloat(c[e]),parseFloat(c[i])];f=[m,_]}else n&&r&&(f=[parseFloat(c[n]),parseFloat(c[r])]);var y=(0,T.Z)((0,T.Z)({},c),{},{_id:l,coordinates:f});s.push(y)}return{dataArray:s}}function L0(t,a){var n=(0,M0.ue)(t);return ha(n,a)}function O0(t){for(var a=t.toString(),n=5381,r=a.length;r;)n=n*33^a.charCodeAt(--r);return n>>>0}function k0(t,a){return a===void 0?null:a==="id"&&t.id?t.id:t[a]?t[a]:t.properties&&t.properties[a]?O0(t.properties[a]+"")%1000019:null}function F0(t,a){var n=[],r={};return t.features?(t.features=t.features.filter(function(e){var i=e.geometry;return e!=null&&i&&i.type&&i.coordinates&&i.coordinates.length>0}),jr()(t,!0),t.features.length===0?{dataArray:[],featureKeys:r}:((0,va.nG)(t,function(e,i){var o=k0(e,a==null?void 0:a.featureId);o===null&&(o=i);var u=o,s=(0,An.r7)(e),l=(0,T.Z)((0,T.Z)({},e.properties),{},{coordinates:s,_id:u});n.push(l)}),{dataArray:n,featureKeys:r})):(t.features=[],{dataArray:[]})}function GA(t){var a=131,n=137,r=0;t+="x";for(var e=Math.floor(9007199254740991/n),i=0;i<t.length;i++)r>e&&(r=Math.floor(r/n)),r=r*a+t.charCodeAt(i);return r}function WA(t){t=t.toString();for(var a=5381,n=t.length;n;)a=a*33^t.charCodeAt(--n);return a>>>0}var re=O(28481),P=O(96486),Tn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Hr(t){this.message=t}Hr.prototype=new Error,Hr.prototype.name="InvalidCharacterError";function P0(t){var a=String(t).replace(/=+$/,"");if(a.length%4==1)throw new Hr("'atob' failed: The string to be decoded is not correctly encoded.");for(var n="",r=0,e,i,o=0;i=a.charAt(o++);~i&&(e=r%4?e*64+i:i,r++%4)?n+=String.fromCharCode(255&e>>(-2*r&6)):0)i=Tn.indexOf(i);return n}function ga(t){t=String(t);for(var a,n,r,e,i="",o=0,u=t.length%3;o<t.length;){if((n=t.charCodeAt(o++))>255||(r=t.charCodeAt(o++))>255||(e=t.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=n<<16|r<<8|e,i+=Tn.charAt(a>>18&63)+Tn.charAt(a>>12&63)+Tn.charAt(a>>6&63)+Tn.charAt(a&63)}return u?i.slice(0,u-3)+"===".substring(u):i}var R=O(6610),L=O(5991),D0=function(){function t(a,n){(0,R.Z)(this,t),this.buffers=a,this.type=n}return(0,L.Z)(t,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(n,r,e){throw new Error("not implemented")}}]),t}(),Vr,w0=function(){return Vr||(Vr=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof O.g!="undefined"?O.g:{})};Vr=w0();var rt;typeof window=="undefined"?rt={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,n,r){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,n){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:rt=window;var I0=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,B0=I0?my.getSystemInfoSync().pixelRatio:rt.devicePixelRatio,N=O(10379),Z=O(46070),S=O(77608),Mn=(0,L.Z)(function t(a,n){(0,R.Z)(this,t),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()}),C=O(63349);function N0(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Z0(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function Z0(t,a){if(!!t){if(typeof t=="string")return ma(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ma(t,a)}}function ma(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var Rn=new WeakMap,Gr=function(){function t(){(0,R.Z)(this,t),Rn.set(this,{})}return(0,L.Z)(t,[{key:"addEventListener",value:function(n,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=Rn.get(this);i||(i={}),i[n]||(i[n]=[]),i[n].push(r),Rn.set(this,i),e.capture,e.once,e.passive}},{key:"removeEventListener",value:function(n,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=Rn.get(this);if(i){var o=i[n];if(o&&o.length>0){for(var u=o.length;u--;u>0)if(o[u]===r){o.splice(u,1);break}}}}},{key:"dispatchEvent",value:function(n){var r=Rn.get(this)[n.type];if(r){var e=N0(r),i;try{for(e.s();!(i=e.n()).done;){var o=i.value;o(n)}}catch(u){e.e(u)}finally{e.f()}}}}]),t}();function z0(t){var a=U0();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function U0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var _a=function(t){(0,N.Z)(n,t);var a=z0(n);function n(){var r;return(0,R.Z)(this,n),r=a.call(this),r.childNodes=[],r}return(0,L.Z)(n,[{key:"appendChild",value:function(e){this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var i=this.childNodes.findIndex(function(o){return o===e});return i>-1?this.childNodes.splice(i,1):null}}]),n}(Gr);function j0(t){var a=H0();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function H0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var ya=function(t){(0,N.Z)(n,t);var a=j0(n);function n(){var r;return(0,R.Z)(this,n),r=a.call(this),r.className="",r.children=[],r}return(0,L.Z)(n,[{key:"setAttribute",value:function(e,i){this[e]=i}},{key:"getAttribute",value:function(e){return this[e]}},{key:"setAttributeNS",value:function(e,i){this[e]=i}},{key:"getAttributeNS",value:function(e){return this[e]}}]),n}(_a),V0=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Wr,$r,Xr,Yr;if(V0){var qn=my.getSystemInfoSync();Wr=qn.screenWidth,$r=qn.screenHeight,Xr=qn.windowWidth,Yr=qn.windowHeight}else{var xa=rt.innerWidth,Ea=rt.innerHeight;Wr=xa,$r=Ea,Xr=xa,Yr=Ea}var Ln={width:Wr,height:$r,availWidth:Xr,availHeight:Yr,availLeft:0,availTop:0},Jn=Ln.availWidth,er=Ln.availHeight,Ca={style:[]};function Sa(t,a){if(!("parentNode"in t)){var n;a===0?n=function(){return null}:a===1?n=function(){return Ca}:n=function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:n})}if(!("parentElement"in t)){var r;a===0?r=function(){return null}:a===1?r=function(){return Ca}:r=function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:r})}}function G0(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:Jn+"px",height:er+"px",margin:"0px",padding:"0px"})}function W0(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=Jn,t.clientHeight=er),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function $0(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=Jn,t.offsetHeight=er)}function X0(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=Jn,t.scrollHeight=er)}function ba(t){var a=function(){return!0};t.classList=[],t.classList.add=a,t.classList.remove=a,t.classList.contains=a,t.classList.toggle=a}function Y0(t){var a=K0();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function K0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function rn(){}var an=function(t){(0,N.Z)(n,t);var a=Y0(n);function n(){var r,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return(0,R.Z)(this,n),r=a.call(this),r.className="",r.children=[],r.focus=rn,r.blur=rn,r.insertBefore=rn,r.appendChild=rn,r.removeChild=rn,r.remove=rn,r.innerHTML="",r.tagName=e.toUpperCase(),Sa((0,C.Z)(r),i),G0((0,C.Z)(r)),ba((0,C.Z)(r)),W0((0,C.Z)(r)),$0((0,C.Z)(r)),X0((0,C.Z)(r)),r}return(0,L.Z)(n)}(ya);function Q0(t){var a=q0();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function q0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Aa=function(t){(0,N.Z)(n,t);var a=Q0(n);function n(r){return(0,R.Z)(this,n),a.call(this,r)}return(0,L.Z)(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(an);function J0(t){var a=ep();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ep(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Ta=function(t){(0,N.Z)(n,t);var a=J0(n);function n(){return(0,R.Z)(this,n),a.call(this,"video")}return(0,L.Z)(n)}(Aa),Ye={},it={};function $A(t,a){Ye=t,Ye.id=a,"tagName"in Ye||(Ye.tagName="CANVAS"),Ye.type="canvas",Mixin.parentNode(Ye),Mixin.style(Ye),Mixin.classList(Ye),Mixin.clientRegion(Ye),Mixin.offsetRegion(Ye),Ye.focus=function(){},Ye.blur=function(){}}function XA(t,a){var n=1024,r=1024;it={width:n,height:r,clientWidth:n/devicePixelRatio,clientHeight:r/devicePixelRatio,id:a,type:"canvas"},"tagName"in it||(it.tagName="CANVAS"),Mixin.parentNode(it),Mixin.style(it),Mixin.classList(it),Mixin.clientRegion(it),Mixin.offsetRegion(it),it.getContext=function(e){if(e==="2d")return t},it.focus=function(){},it.blur=function(){}}function xt(){return Ye}function YA(){return it}var Ma=(0,L.Z)(function t(){(0,R.Z)(this,t);var a=xt(),n=a.createImage&&a.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=t.prototype),Sa(n),ba(n),Object.assign(n,{addEventListener:function(e,i){n["on".concat(e)]=i.bind(n)},removeEventListener:function(e){n["on".concat(e)]=null}}),n}),Ra={href:"",protocol:"",host:""};function La(t){var a=tp();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function tp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var np=function(t){(0,N.Z)(n,t);var a=La(n);function n(){return(0,R.Z)(this,n),a.call(this,"body",0)}return(0,L.Z)(n,[{key:"addEventListener",value:function(e,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(e,i,o){}},{key:"dispatchEvent",value:function(e){}}]),n}(an),rp=function(t){(0,N.Z)(n,t);var a=La(n);function n(){return(0,R.Z)(this,n),a.call(this,"html",0)}return(0,L.Z)(n,[{key:"addEventListener",value:function(e,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(e,i){}},{key:"dispatchEvent",value:function(e){}}]),n}(an),On={},ft={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ra,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new Ma:a==="video"?new Ta:new an(a)},createElementNS:function(a,n){return this.createElement(n)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,n){return this.getElementsByTagName(n)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,n,r){On[a]||(On[a]=[]),On[a].push(n)},removeEventListener:function(a,n){var r=On[a];if(r&&r.length>0){for(var e=r.length;e--;e>0)if(r[e]===n){r.splice(e,1);break}}},dispatchEvent:function(a){var n=a.type,r=On[n];if(r)for(var e=0;e<r.length;e++)r[e](a);a.target&&typeof a.target["on"+n]=="function"&&a.target["on"+n](a)},createEvent:function(a){return new Mn(a)}};ft.documentElement=new rp,ft.head=new an("head"),ft.body=new np;var ip=Object,Kr=O(90484),ap=function(){function t(){(0,R.Z)(this,t);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,Kr.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,L.Z)(t,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),t}(),op=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Qr,$e,tr;if(op){var qr=my.getSystemInfoSync();Qr=qr.system,$e=qr.platform,tr=qr.language}else{var Ke={versions:function(){var t=rt.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")===-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")===-1,weixin:t.indexOf("MicroMessenger")>-1,qq:t.match(/\sQQ/i)===" qq"}}(),language:(rt.navigator.browserLanguage||rt.navigator.language).toLowerCase()};Ke.versions.android?$e="android":Ke.versions.trident?$e="IE":Ke.versions.presto?$e="Opera":Ke.versions.webKit?$e="webKit":Ke.versions.gecko?$e="Firefox":Ke.versions.mobile?$e="mobile":Ke.versions.ios?$e="ios":Ke.versions.iPhone?$e="iPhone":Ke.versions.iPad?$e="ipad":Ke.versions.webApp?$e="webApp":Ke.versions.weixin?$e="weixin":Ke.versions.qq&&($e="qq"),Qr=rt.navigator.userAgent,tr=Ke.language}var up=Qr.toLowerCase().indexOf("android")!==-1,Oa=up?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",sp="Mozilla/5.0 (".concat(Oa,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(tr),lp={platform:$e,language:tr,appVersion:"5.0 (".concat(Oa,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:sp},cp={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,n,r){return{duration:0}},now:function(){}},ka=0,Fa=0;function fp(t){var a=Date.now(),n=Math.max(ka+23,a);return Fa=setTimeout(function(){t(ka=n)},n-a),Fa}function pp(t){var a=xt();return a.requestAnimationFrame?a.requestAnimationFrame(t):fp(t)}function dp(t){var a=xt();return a.cancelAnimationFrame?a.cancelAnimationFrame(t):clearTimeout(t)}var vp=function(){function t(a){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,R.Z)(this,t),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=n+a}return(0,L.Z)(t,null,[{key:"createObjectURL",value:function(n){var r=n.buffers[0],e=n.type,i=hp(r),o="data:".concat(e,";base64, ");return o+i}}]),t}();function hp(t){for(var a="",n=new Uint8Array(t),r=n.byteLength,e=0;e<r;e++)a+=String.fromCharCode(n[e]);return ga(a)}var gp={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},mp={};function _p(t){var a=yp();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function yp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Jr=new Map,Pa=new Map,xp=new Map,KA={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Ep(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(t)]=="function"&&this["on".concat(t)].call(this,a)}function QA(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:t};this.readyState=t,Ep.call(this,"readystatechange",a)}var Ht=function(t){(0,N.Z)(n,t);var a=_p(n);function n(){var r;return(0,R.Z)(this,n),r=a.call(this),r.onabort=null,r.onerror=null,r.onload=null,r.onloadstart=null,r.onprogress=null,r.ontimeout=null,r.onloadend=null,r.onreadystatechange=null,r.readyState=0,r.response=null,r.responseText=null,r._responseType="text",r.responseXML=null,r.status=0,r.statusText="",r.upload={},r.withCredentials=!1,Jr.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),r}return(0,L.Z)(n,[{key:"responseType",set:function(e){this._responseType=e}},{key:"abort",value:function(){var e=xp.get("requestTask");e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=Pa.get("responseHeader");return Object.keys(e).map(function(i){return"".concat(i,": ").concat(e[i])}).join(`
`)}},{key:"getResponseHeader",value:function(e){return Pa.get("responseHeader")[e]}},{key:"open",value:function(e,i,o){this._method=e,this._url=i}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(e,i){var o=Jr.get("requestHeader");o[e]=i,Jr.set("requestHeader",o)}},{key:"addEventListener",value:function(e,i){var o=this;typeof i=="function"&&(this["on"+e]=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};u.target=u.target||o,i.call(o,u)})}},{key:"removeEventListener",value:function(e,i){this["on"+e]===i&&(this["on"+e]=null)}}]),n}(Gr);Ht.UNSEND=0,Ht.OPENED=1,Ht.HEADERS_RECEIVED=2,Ht.LOADING=3,Ht.DONE=4;function Cp(t){var a=Sp();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var bp=function(t){(0,N.Z)(n,t);var a=Cp(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.touches=[],e.targetTouches=[],e.changedTouches=[],e.target=xt(),e.currentTarget=xt(),e}return(0,L.Z)(n)}(Mn);function ei(t){var a=t||{},n=a.x,r=n===void 0?0:n,e=a.y,i=e===void 0?0:e,o=a.clientX,u=o===void 0?0:o,s=a.clientY,l=s===void 0?0:s;Object.keys(t).indexOf("x")!==-1?(t.pageX=t.clientX=r,t.pageY=t.clientY=i):(t.x=u,t.y=l)}function ti(t){return function(a){var n=new bp(t);n.changedTouches=a.changedTouches,n.touches=a.touches,n.targetTouches=Array.prototype.slice.call(a.touches),n.timeStamp=a.timeStamp,n.changedTouches.forEach(function(r){return ei(r)}),n.touches.forEach(function(r){return ei(r)}),n.targetTouches.forEach(function(r){return ei(r)}),ft.dispatchEvent(n)}}function Ap(t){return function(a){a.type=t,ft.dispatchEvent(a)}}var qA=ti("touchstart"),JA=ti("touchmove"),e5=ti("touchend"),t5=Ap("mapCameaParams");function Tp(t){var a=Mp();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Mp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Rp=function(t){(0,N.Z)(n,t);var a=Tp(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.target=xt(),e.currentTarget=xt(),e}return(0,L.Z)(n)}(Mn),Da=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Lp=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Op="touch";function kp(t,a,n){for(var r=new Rp(t),e=0;e<Da.length;e++){var i=Da[e];r[i]=a[i]||Lp[e]}return r.type=t,r.target=xt(),r.currentTarget=xt(),r.buttons=Fp(t),r.which=r.buttons,r.pointerId=(a.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=(a.radiusX||.5)*2,r.height=(a.radiusY||.5)*2,r.pressure=a.force||.5,r.isPrimary=Pp(a),r.pointerType=Op,r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}function Fp(t){var a=0;return(t==="touchstart"||t==="touchmove"||t==="pointerdown"||t==="pointermove")&&(a=1),a}var kn=null;function Pp(t){return kn===t.identifier}function Dp(t){kn===null&&(kn=t.identifier)}function wp(t){kn===t.identifier&&(kn=null)}function ni(t){return function(a){for(var n=a.changedTouches,r=0;r<n.length;r++){var e=n[r];r===0&&t==="pointerdown"?Dp(e):(t==="pointerup"||t==="pointercancel")&&wp(e);var i=kp(t,e,a);ft.dispatchEvent(i)}}}var n5=ni("pointerdown"),r5=ni("pointermove"),i5=ni("pointerup");function Ip(t){var a=Bp();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Bp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var a5=function(t){(0,N.Z)(n,t);var a=Ip(n);function n(r){return(0,R.Z)(this,n),a.call(this,r)}return(0,L.Z)(n)}(Mn);function ri(t){return function(a){a.type=t,ft.dispatchEvent(a)}}var o5=ri("mousedown"),u5=ri("mousemove"),s5=ri("mouseup"),Np=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Zp=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Qe=Np||Zp,zp={atob:P0,btoa:ga,devicePixelRatio:B0,Blob:D0,document:ft,Element:ya,Event:Mn,EventTarget:Gr,HTMLCanvasElement:ip,HTMLElement:an,HTMLMediaElement:Aa,HTMLVideoElement:Ta,Image:Ma,ImageData:ap,navigator:lp,Node:_a,requestAnimationFrame:pp,cancelAnimationFrame:dp,screen:Ln,XMLHttpRequest:Ht,performance:cp,URL:vp,WebGLRenderingContext:gp,WebGL2RenderingContext:mp,addEventListener:function(a,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ft.addEventListener(a,n,r)},removeEventListener:function(a,n,r){ft.removeEventListener(a,n)},dispatchEvent:function(a){ft.dispatchEvent(a)},innerWidth:Ln.availWidth,innerHeight:Ln.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},_e=Qe?zp:rt,Up=Qe?Ht:rt.XMLHttpRequest,l5=Qe?Ra:rt.location;function wa(t){var a=t;return typeof t=="string"&&(a=_e.document.getElementById(t)),a}function Ia(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function jp(t){return Ia(t).split(/\s+/)}function Hp(t){var a,n,r=_e==null||(a=_e.document)===null||a===void 0||(n=a.documentElement)===null||n===void 0?void 0:n.style;if(!r)return t[0];for(var e in t)if(t[e]&&t[e]in r)return t[e];return t[0]}function le(t,a,n){var r=_e.document.createElement(t);return a&&(r.className=a||""),n&&n.appendChild(r),r}function at(t){var a=t.parentNode;a&&a.removeChild(t)}function pt(t,a){if(t.classList!==void 0)for(var n=jp(a),r=0,e=n.length;r<e;r++)t.classList.add(n[r]);else if(!Vp(t,a)){var i=ii(t);Ba(t,(i?i+" ":"")+a)}}function Vt(t,a){t.classList!==void 0?t.classList.remove(a):Ba(t,Ia((" "+ii(t)+" ").replace(" "+a+" "," ")))}function Vp(t,a){if(t.classList!==void 0)return t.classList.contains(a);var n=ii(t);return n.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(n)}function Ba(t,a){t instanceof HTMLElement?t.className=a:t.className.baseVal=a}function ii(t){return t instanceof SVGElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function c5(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}var Gp=Hp(["transform","WebkitTransform"]);function Na(t,a){t.style[Gp]=a}function Wp(){if(typeof Event=="function")_e.dispatchEvent(new Event("resize"));else{var t=_e.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,_e,0),_e.dispatchEvent(t)}}function f5(t){var a=["padding: "+(t.height/2-8)+"px "+t.width/2+"px;","line-height: "+t.height+"px;","background-image: url("+t.toDataURL()+");"];console.log(`%c
`,a.join(""))}function $p(){var t,a=_e.document.querySelector('meta[name="viewport"]');if(!a)return 1;var n=(t=a.content)===null||t===void 0?void 0:t.split(","),r=n.find(function(e){var i=e.split("="),o=(0,re.Z)(i,1),u=o[0];return u==="initial-scale"});return r?r.split("=")[1]*1:1}var Fe=$p()<1?1:_e.devicePixelRatio;function Za(t,a){t.setAttribute("style","".concat(t.style.cssText).concat(a))}function za(t){return t.split(";").map(function(a){return a.trim()}).filter(function(a){return a})}function p5(t,a){var n,r=za((n=t.getAttribute("style"))!==null&&n!==void 0?n:""),e=za(a),i=P.pull.apply(void 0,[r].concat((0,G.Z)(e)));t.setAttribute("style",i.join(";"))}function Xp(t){return Object.entries(t).map(function(a){var n=(0,re.Z)(a,2),r=n[0],e=n[1];return"".concat(r,": ").concat(e)}).join(";")}function Yp(t,a){return{left:t.left-a.left,top:t.top-a.top,right:a.left+a.width-t.left-t.width,bottom:a.top+a.height-t.top-t.height}}function ai(t,a){t.checked=a,a?t.setAttribute("checked","true"):t.removeAttribute("checked")}function nr(t){t.innerHTML=""}function Ua(t){t.setAttribute("draggable","false")}function Kp(t){if(t.length===0)throw new Error("max requires at least one data point");for(var a=t[0],n=1;n<t.length;n++)t[n]>a&&(a=t[n]);return a*1}function Qp(t){if(t.length===0)throw new Error("min requires at least one data point");for(var a=t[0],n=1;n<t.length;n++)t[n]<a&&(a=t[n]);return a*1}function ja(t){if(t.length===0)return 0;for(var a=t[0]*1,n=1;n<t.length;n++)a+=t[n]*1;return a}function qp(t){if(t.length===0)throw new Error("mean requires at least one data point");return ja(t)/t.length}function Jp(t){if(t.length===0)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var a=t[0],n=NaN,r=0,e=1,i=1;i<t.length+1;i++)t[i]!==a?(e>r&&(r=e,n=a),e=1,a=t[i]):e++;return n*1}var oi={min:Qp,max:Kp,mean:qp,sum:ja,mode:Jp};function ui(t,a){return t.map(function(n){return n[a]})}function ed(t,a){return oi[t](a)}var td=O(57869);function nd(t){return typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap}function rd(){return typeof importScripts=="function"}var d5=rd()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function id(t){var a=ad();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ad(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Ha=function(t){(0,N.Z)(n,t);var a=id(n);function n(r,e,i,o){var u;return(0,R.Z)(this,n),u=a.call(this,"AJAXError: ".concat(e," (").concat(r,"): ").concat(i)),u.status=r,u.statusText=e,u.url=i,u.body=o,u}return(0,L.Z)(n)}((0,td.Z)(Error));function v5(t,a){var n=Array.isArray(t.url)?t.url[0]:t.url,r=new Request(n,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:getReferrer(),signal:t==null?void 0:t.signal});return t.type==="json"&&r.headers.set("Accept","application/json"),fetch(r).then(function(e){return e.ok?(t.type==="arrayBuffer"?e.arrayBuffer():t.type==="json"?e.json():e.text()).then(function(i){a(null,i,e.headers.get("Cache-Control"),e.headers.get("Expires"))}).catch(function(i){a(new Error(i.message))}):e.blob().then(function(i){return a(new Ha(e.status,e.statusText,n.toString(),i))})}).catch(function(e){a(new Error(e.message))})}function Va(t,a){var n=new Up,r=Array.isArray(t.url)?t.url[0]:t.url;n.open(t.method||"GET",r,!0),t.type==="arrayBuffer"&&(n.responseType="arraybuffer");for(var e in t.headers)t.headers.hasOwnProperty(e)&&n.setRequestHeader(e,t.headers[e]);return t.type==="json"&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials=t.credentials==="include",n.onerror=function(){a(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||n.status===0)&&n.response!==null){var i=n.response;if(t.type==="json")try{i=JSON.parse(n.response)}catch(u){return a(u)}a(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});a(new Ha(n.status,n.statusText,r.toString(),o))}},n.send(t.body),n}function od(t){return new Promise(function(a,n){Va(t,function(r,e,i,o,u){r?n({err:r,data:null,xhr:u}):a({err:null,data:e,cacheControl:i,expires:o,xhr:u})})})}function si(t,a){return Va(t,a)}var h5=function(a,n){return si(_objectSpread(_objectSpread({},a),{},{type:"json"}),n)},li=function(a,n){return si((0,T.Z)((0,T.Z)({},a),{},{type:"arrayBuffer"}),n)},g5=function(a,n){return si(_objectSpread(_objectSpread({},a),{},{method:"POST"}),n)};function m5(t){var a=$window.document.createElement("a");return a.href=t,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var Ga="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ud(t,a){var n=new _e.Image,r=_e.URL||_e.webkitURL;n.crossOrigin="anonymous",n.onload=function(){a(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(function(){n.src=Ga})},n.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var e=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(e):Ga}function sd(t,a){var n=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(n).then(function(r){a(null,r)}).catch(function(r){a(new Error("Could not load image because of ".concat(r.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ci=function(a,n){return li(a,function(r,e){if(r)n(r);else if(e){var i=typeof createImageBitmap=="function";i?sd(e,n):ud(e,n)}})},dt=O(40271);function fi(t){return typeof t=="number"}var ld=O(41672),rr=2*Math.PI*6378137/2;function cd(t){var a=[Infinity,Infinity,-Infinity,-Infinity];return t.forEach(function(n){var r=n.coordinates;Wa(a,r)}),a}function Wa(t,a){return Array.isArray(a[0])?a.forEach(function(n){Wa(t,n)}):(t[0]>a[0]&&(t[0]=a[0]),t[1]>a[1]&&(t[1]=a[1]),t[2]<a[0]&&(t[2]=a[0]),t[3]<a[1]&&(t[3]=a[1])),t}function _5(t,a){return $a(t,a)}function $a(t,a){return Array.isArray(t[0])?t.map(function(n){return $a(n,a)}):a(t)}function pi(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};t=dd(t,a);var r=t[0],e=t[1],i=r*rr/180,o=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return o=o*rr/180,n.enable&&(i=Number(i.toFixed(n.decimal)),o=Number(o.toFixed(n.decimal))),t.length===3?[i,o,t[2]]:[i,o]}function y5(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,n=t[0],r=t[1],e=n/rr*180,i=r/rr*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),a!=null&&(e=Number(e.toFixed(a)),i=Number(i.toFixed(a))),t.length===3?[e,i,t[2]]:[e,i]}function fd(t){if(t==null)throw new Error("lng is required");return(t>180||t<-180)&&(t=t%360,t>180&&(t=-360+t),t<-180&&(t=360+t),t===0&&(t=0)),t}function pd(t){if(t==null)throw new Error("lat is required");return(t>90||t<-90)&&(t=t%180,t>90&&(t=-180+t),t<-90&&(t=180+t),t===0&&(t=0)),t}function dd(t,a){if(a===!1)return t;var n=fd(t[0]),r=pd(t[1]);return r>85&&(r=85),r<-85&&(r=-85),t.length===3?[n,r,t[2]]:[n,r]}function Ne(t){var a=85.0511287798,n=Math.max(Math.min(a,t[1]),-a),r=256<<20,e=Math.PI/180,i=t[0]*e,o=n*e;o=Math.log(Math.tan(Math.PI/4+o/2));var u=.5/Math.PI,s=.5,l=-.5/Math.PI;return e=.5,i=r*(u*i+s),o=r*(l*o+e),[Math.floor(i),Math.floor(o)]}function x5(t){var a=.5/Math.PI,n=.5,r=-.5/Math.PI,e=.5,i=256<<20,o=_slicedToArray(t,2),u=o[0],s=o[1];u=(u/i-n)/a,s=(s/i-e)/r,s=(Math.atan(Math.pow(Math.E,s))-Math.PI/4)*2,e=Math.PI/180;var l=s/e,c=u/e;return[c,l]}function E5(t,a){var n=85.0511287798,r=Math.PI/180,e=6378137;return a=Math.max(Math.min(n,a),-n),t*=r,a*=r,a=Math.log(Math.tan(Math.PI/4+a/2)),[t*e,a*e]}function C5(t,a){var n=Math.PI/180,r=6378137,e=t/r/n,i=2*(Math.atan(Math.exp(a/r))-Math.PI/4)/n;return[e,i]}function vd(t,a,n){var r=(0,dt.Ht)(a[1]-t[1]),e=(0,dt.Ht)(a[0]-t[0]),i=(0,dt.Ht)(t[1]),o=(0,dt.Ht)(a[1]),u=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(e/2),2)*Math.cos(i)*Math.cos(o);return(0,dt.DL)(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),n="meters")}function S5(t){var a=Math.PI/180,n=85.0511287798,r=6378137,e=Math.max(Math.min(n,t[1]),-n),i=Math.sin(e*a),o=r*t[0]*a,u=r*Math.log((1+i)/(1-i))/2;return[o,u]}function on(t,a){var n=Math.abs(t[1][1]-t[0][1])*a,r=Math.abs(t[1][0]-t[0][0])*a;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function di(t,a){return t[0][0]<=a[0][0]&&t[0][1]<=a[0][1]&&t[1][0]>=a[1][0]&&t[1][1]>=a[1][1]}function ir(t){return[[t[0],t[1]],[t[2],t[3]]]}function Xa(t){var a=Ya(t,[0,0]);return[t[0]/a,t[1]/a]}function Ya(t,a){return Math.sqrt(Math.pow(t[0]-a[0],2)+Math.pow(t[1]-a[1],2))}function hd(t,a){return t[0]*a[0]+t[1]*a[1]}function Ka(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function b5(t,a){return Math.acos(hd(t,a)/(Ka(t)*Ka(a)))*180/Math.PI}function gd(t,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function A5(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!t||t.length<2)){for(var n=[0,1],r=0,e=[],i=0;i<t.length-1;i++){var o=t[i],u=t[i+1],s=Ya(o,u);r+=s;var l=[o[0]-u[0],o[1]-u[1]],c=gd(n,l);if(i>0){var f=e[i-1].rotation;f-c>360-f+c&&(c=c+360)}e.push({start:o,end:u,dis:s,rotation:c,duration:0})}return e.map(function(p){p.duration=a*(p.dis/r)}),e}}function ot(t){if(fi(t[0]))return t;if(fi(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(fi(t[0][0][0])){var a=t,n=0,r=0,e=0;return a.forEach(function(i){i.forEach(function(o){n+=o[0],r+=o[1],e++})}),[n/e,r/e,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function md(t){for(var a=t[0],n=t[1],r=t[0],e=t[1],i=0,o=0,u=0,s=0;s<t.length;s+=2){var l=t[s],c=t[s+1];l&&c&&(a=Math.max(l,a),n=Math.max(c,n),r=Math.min(l,r),e=Math.min(c,e),i+=l,o+=c,u++)}return{center:[i/u,o/u],radius:Math.sqrt(Math.pow(a-r,2)+Math.pow(n-e,2))/2}}function _d(t){return(0,ld.Z)((0,dt.uf)([(0,dt.Tu)(t)]))}var yd=function(){function t(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;(0,R.Z)(this,t),this.limit=a,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return(0,L.Z)(t,[{key:"clear",value:function(){var n=this;this.order.forEach(function(r){n.delete(r)}),this.cache={},this.order=[]}},{key:"get",value:function(n){var r=this.cache[n];return r&&(this.deleteOrder(n),this.appendOrder(n)),r}},{key:"set",value:function(n,r){this.cache[n]?(this.delete(n),this.cache[n]=r,this.appendOrder(n)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[n]=r,this.appendOrder(n))}},{key:"delete",value:function(n){var r=this.cache[n];r&&(this.deleteCache(n),this.deleteOrder(n),this.destroy(r,n))}},{key:"deleteCache",value:function(n){delete this.cache[n]}},{key:"deleteOrder",value:function(n){var r=this.order.findIndex(function(e){return e===n});r>=0&&this.order.splice(r,1)}},{key:"appendOrder",value:function(n){this.order.push(n)}},{key:"defaultDestroy",value:function(n,r){return null}}]),t}();function Qa(t,a){t.forEach(function(n){!a[n]||(a[n]=a[n].bind(a))})}var T5=null,vi=O(2650);function qa(t){return typeof t=="string"?!!vi.ZP(t):!1}function oe(t){var a=vi.ZP(t),n=[0,0,0,0];return a!=null&&(n[0]=a.r/255,n[1]=a.g/255,n[2]=a.b/255,n[3]=a.opacity),n}function Lt(t){var a=t&&t[0],n=t&&t[1],r=t&&t[2],e=a+n*256+r*65536-1;return e}function Ot(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function kt(t){var a=_e.document.createElement("canvas"),n=a.getContext("2d");a.width=256,a.height=1;var r=null;if(t.weights){var e=0;t.weights.map(function(p,d){var g=t.colors[d]||"rgba(0, 0, 0, 0)",m=e+p;n.fillStyle=g,n.fillRect(e*256,0,m*256,1),e=m})}else{for(var i=n.createLinearGradient(0,0,256,1),o=t.positions[0],u=t.positions[t.positions.length-1],s=0;s<t.colors.length;++s){var l=(t.positions[s]-o)/(u-o);i.addColorStop(l,t.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1)}if(Qe)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),a=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var c=n.createImageData(256,1),f=0;f<c.data.length;f+=4)c.data[f+0]=r[f+0],c.data[f+1]=r[f+1],c.data[f+2]=r[f+2],c.data[f+3]=r[f+3];return a=null,n=null,c}var ar;(function(t){t.CENTER="center",t.TOP="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t.BOTTOM="bottom",t["BOTTOM-LEFT"]="bottom-left",t["BOTTOM-RIGHT"]="bottom-right",t.LEFT="left",t.RIGHT="right"})(ar||(ar={}));var or={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ja(t,a,n){var r=t.classList;for(var e in or)or.hasOwnProperty(e)&&r.remove("l7-".concat(n,"-anchor-").concat(e));r.add("l7-".concat(n,"-anchor-").concat(a))}function me(t,a){return{enable:t,mask:255,func:{cmp:514,ref:a?1:0,mask:255}}}var te=O(92137),xd=O(87757),H=O.n(xd),eo=O(63797);function hi(t){var a=t.color;return!a||!a.length?[1,1,1,1]:a}function gi(t,a,n){return n.length===2?[n[0],n[1],0]:[n[0],n[1],n[2]]}function mi(t){var a=t.filter;return a?[1]:[0]}function _i(t,a){return[a]}var Ed=O(9187),ut=O.n(Ed),h=O(96156),U=O(31437),ur=U.Ue(),M5=U.Ue(),De=U.Ue(),Ft=U.Ue(),un=U.Ue();function yi(t,a,n,r,e){U.IH(t,n,r),U.Fv(t,t),a=U.al(-t[1],t[0]);var i=U.al(-n[1],n[0]);return[e/U.AK(a,i),a]}function Pt(t,a){return U.t8(t,-a[1],a[0])}function sn(t,a,n){return U.lu(t,a,n),U.Fv(t,t),t}function xi(t,a){return t[0]===a[0]&&t[1]===a[1]}function R5(t){for(var a=new Map,n=0;n<t.length;n++){var r=t[0].toString()+"-"+t[1].toString();a.get(r)?(t.splice(n,1),n++):a.set(r,r)}return t}var Cd=function(){function t(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,R.Z)(this,t),(0,h.Z)(this,"lastFlip",-1),(0,h.Z)(this,"miter",U.al(0,0)),(0,h.Z)(this,"started",!1),(0,h.Z)(this,"dash",!1),(0,h.Z)(this,"totalDistance",0),(0,h.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,L.Z)(t,[{key:"extrude_gaode2",value:function(n,r){var e=this.complex;if(n.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=n.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=n[u-1];f.push((s=r[u-1][2])!==null&&s!==void 0?s:0);var p=r[u-1],d=n[u];d.push((l=r[u][2])!==null&&l!==void 0?l:0);var g=r[u],m=u<n.length-1?[].concat((0,G.Z)(n[u+1]),[(c=r[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<r.length-1?r[u+1]:null,y=this.segment_gaode2(e,o,f,d,m,p,g,_);o+=y}if(this.dash)for(var x=0;x<e.positions.length/6;x++)e.positions[x*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(n,r){var e=this.complex;if(n.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=n.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=n[u-1];f.push((s=r[u-1][2])!==null&&s!==void 0?s:0);var p=r[u-1],d=n[u];d.push((l=r[u][2])!==null&&l!==void 0?l:0);var g=r[u],m=u<n.length-1?[].concat((0,G.Z)(n[u+1]),[(c=r[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<r.length-1?r[u+1]:null,y=this.simpleSegment(e,o,f,d,m,p,g,_);o+=y}if(this.dash)for(var x=0;x<e.positions.length/6;x++)e.positions[x*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"extrude",value:function(n){var r=this.complex;if(n.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=n.length,i=r.startIndex,o=1;o<e;o++){var u=n[o-1],s=n[o],l=o<n.length-1?n[o+1]:null,c=this.segment(r,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<r.positions.length/6;f++)r.positions[f*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude",value:function(n){var r=this.complex;if(n.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=n.length,i=r.startIndex,o=1;o<e;o++){var u=n[o-1],s=n[o],l=o<n.length-1?n[o+1]:null,c=this.simpleSegment(r,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<r.positions.length/6;f++)r.positions[f*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"segment_gaode2",value:function(n,r,e,i,o,u,s,l){var c=0,f=n.indices,p=n.positions,d=n.normals,g=this.cap==="square",m=this.join==="bevel",_=Ne([s[0],s[1]]),y=Ne([u[0],u[1]]);sn(De,i,e);var x=0;if(this.dash&&(x=this.lineSegmentDistance(_,y),this.totalDistance+=x),this.normal||(this.normal=U.Ue(),Pt(this.normal,De)),!this.started)if(this.started=!0,g){var E=U.Ue(),b=U.Ue();U.IH(E,this.normal,De),U.IH(b,this.normal,De),d.push(b[0],b[1],0),d.push(E[0],E[1],0),p.push(e[0],e[1],e[2]|0,this.totalDistance-x,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),p.push(e[0],e[1],e[2]|0,this.totalDistance-x,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,e,this.normal,this.thickness,this.totalDistance-x);if(f.push(r+0,r+1,r+2),o){xi(i,o)&&U.IH(o,i,U.Fv(o,U.$X(o,i,e))),sn(Ft,o,i);var I=yi(un,U.Ue(),De,Ft,this.thickness),k=(0,re.Z)(I,2),w=k[0],z=k[1],$=U.AK(un,this.normal)<0?-1:1,X=m;if(!X&&this.join==="miter"){var ne=w;ne>this.miterLimit&&(X=!0)}X?(d.push(this.normal[0],this.normal[1],0),d.push(z[0],z[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*$,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*$,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,G.Z)(this.lastFlip!==-$?[r,r+2,r+3]:[r+2,r+1,r+3])),f.push(r+2,r+3,r+4),Pt(ur,Ft),U.JG(this.normal,ur),d.push(this.normal[0],this.normal[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*$,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(p,d,i,z,w,this.totalDistance),f.push.apply(f,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),$=-1,U.JG(this.normal,z),c+=2),this.lastFlip=$}else{if(Pt(this.normal,De),g){var A=U.Ue(),F=U.Ue();U.lu(F,De,this.normal),U.IH(A,De,this.normal),d.push(F[0],F[1],0),d.push(A[0],A[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,i,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),c+=2}return c}},{key:"simpleSegment",value:function(n,r,e,i,o){var u=0,s=n.indices,l=n.positions,c=n.normals,f=Ne([i[0],i[1]]),p=Ne([e[0],e[1]]);sn(De,f,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(f,p),this.totalDistance+=d),this.normal||(this.normal=U.Ue(),Pt(this.normal,De)),this.started||(this.started=!0,this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-d)),s.push(r+0,r+1,r+2),!o)Pt(this.normal,De),this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),u+=2;else{var g=Ne([o[0],o[1]]);xi(f,g)&&U.IH(g,f,U.Fv(g,U.$X(g,f,p))),sn(Ft,g,f);var m=yi(un,U.Ue(),De,Ft,this.thickness),_=(0,re.Z)(m,2),y=_[0],x=_[1],E=U.AK(un,this.normal)<0?-1:1;this.extrusions(l,c,i,x,y,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),E=-1,U.JG(this.normal,x),u+=2,this.lastFlip=E}return u}},{key:"segment",value:function(n,r,e,i,o){var u=0,s=n.indices,l=n.positions,c=n.normals,f=this.cap==="square",p=this.join==="bevel",d=Ne([i[0],i[1]]),g=Ne([e[0],e[1]]);sn(De,d,g);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,g),this.totalDistance+=m),this.normal||(this.normal=U.Ue(),Pt(this.normal,De)),!this.started)if(this.started=!0,f){var _=U.Ue(),y=U.Ue();U.IH(_,this.normal,De),U.IH(y,this.normal,De),c.push(y[0],y[1],0),c.push(_[0],_[1],0),l.push(e[0],e[1],e[2]|0,this.totalDistance-m,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),l.push(e[0],e[1],e[2]|0,this.totalDistance-m,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-m);if(s.push(r+0,r+1,r+2),o){var b=Ne([o[0],o[1]]);xi(d,b)&&U.IH(b,d,U.Fv(b,U.$X(b,d,g))),sn(Ft,b,d);var A=yi(un,U.Ue(),De,Ft,this.thickness),F=(0,re.Z)(A,2),I=F[0],k=F[1],w=U.AK(un,this.normal)<0?-1:1,z=p;if(!z&&this.join==="miter"){var $=I;$>this.miterLimit&&(z=!0)}z?(c.push(this.normal[0],this.normal[1],0),c.push(k[0],k[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*w,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*w,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push.apply(s,(0,G.Z)(this.lastFlip!==-w?[r,r+2,r+3]:[r+2,r+1,r+3])),s.push(r+2,r+3,r+4),Pt(ur,Ft),U.JG(this.normal,ur),c.push(this.normal[0],this.normal[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*w,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,c,i,k,I,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),w=-1,U.JG(this.normal,k),u+=2),this.lastFlip=w}else{if(Pt(this.normal,De),f){var x=U.Ue(),E=U.Ue();U.lu(E,De,this.normal),U.IH(x,De,this.normal),c.push(E[0],E[1],0),c.push(x[0],x[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance);s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),u+=2}return u}},{key:"extrusions",value:function(n,r,e,i,o,u){r.push(i[0],i[1],0),r.push(i[0],i[1],0),n.push(e[0],e[1],e[2]|0,u,-o,e[2]|0),this.complex.indexes.push(this.currentIndex),n.push(e[0],e[1],e[2]|0,u,o,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(n,r){var e=r[0]-n[0],i=r[1]-n[1];return Math.sqrt(e*e+i*i)}}]),t}();function Ei(t){var a=t.coordinates,n=t.originCoordinates,r=t.version,e=new Cd({dash:!0,join:"bevel"});if(r==="GAODE2.x"){var i=a;Array.isArray(i[0][0])||(i=[a]);var o=n;Array.isArray(o[0][0])||(o=[n]);for(var u=0;u<i.length;u++){var s=i[u],l=o[u];e.extrude_gaode2(s,l)}}else{var c=a;c[0]&&!Array.isArray(c[0][0])&&(c=[a]),c.forEach(function(p){e.extrude(p)})}var f=e.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function sr(t){var a=ot(t.coordinates);return{vertices:[].concat((0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function to(t){var a=t.coordinates,n=ut().flatten(a),r=n.vertices,e=n.dimensions,i=n.holes;return{indices:ut()(r,i,e),vertices:r,size:e}}var Sd=function(){var t=(0,te.Z)(H().mark(function a(n){var r,e,i,o,u,s,l,c,f;return H().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return r=n.descriptors,e=n.features,i=n.enablePicking,o=n.iconMap,u={a_Color:hi,a_Position:gi,filter:mi,a_vertexId:_i,a_PickingColor:function(m){var _=m.id;return i?Ot(_):[0,0,0]},a_DistanceAndIndex:function(m,_,y,x,E,b){return b===void 0?[y[3],10]:[y[3],b]},a_Total_Distance:function(m,_,y){return[y[5]]},a_Size:function(m){var _=m.size,y=_===void 0?1:_;return Array.isArray(y)?[y[0],y[1]]:[y,0]},a_Normal:function(m,_,y,x,E){return E},a_Miter:function(m,_,y){return[y[4]]},a_iconMapUV:function(m){var _=m.texture,y=o[_]||{x:0,y:0},x=y.x,E=y.y;return[x,E]}},s={sizePerElement:0,elements:[]},l=0,c=[],f=3,e.forEach(function(g,m){var _=Ei(g),y=_.indices,x=_.vertices,E=_.normals,b=_.size,A=_.indexes;y.forEach(function(w){c.push(w+l)}),f=b;var F=x.length/b;s.sizePerElement=f,s.elements.push({featureIdx:m,vertices:x,normals:E,offset:l}),l+=F;for(var I=function(z){var $=(E==null?void 0:E.slice(z*3,z*3+3))||[],X=x.slice(z*b,z*b+b),ne=0;A&&A[z]!==void 0&&(ne=A[z]),r.forEach(function(se){if(se&&u[se.name]){var Ee;(Ee=se.buffer.data).push.apply(Ee,(0,G.Z)(u[se.name](g,m,X,z,$,ne)))}})},k=0;k<F;k++)I(k)}),d.abrupt("return",{descriptors:r,featureLayout:s,indices:c});case 8:case"end":return d.stop()}},a)}));return function(n){return t.apply(this,arguments)}}(),bd=function(){var t=(0,te.Z)(H().mark(function a(n){var r,e,i,o,u,s,l,c,f;return H().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return r=n.descriptors,e=n.features,i=n.enablePicking,o=n.shape2d,u={a_Color:hi,a_Position:gi,filter:mi,a_vertexId:_i,a_PickingColor:function(m){var _=m.id;return i?Ot(_):[0,0,0]},a_Shape:function(m){var _=m.shape,y=_===void 0?2:_,x=o.indexOf(y);return[x]},a_Extrude:function(m,_,y,x){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=x%4*3;return[E[b],E[b+1],E[b+2]]},a_Size:function(m){var _=m.size,y=_===void 0?5:_;return Array.isArray(y)?[y[0]]:[y]}},s={sizePerElement:0,elements:[]},l=0,c=[],f=3,e.forEach(function(g,m){var _=sr(g),y=_.indices,x=_.vertices,E=_.normals,b=_.size,A=_.indexes;y.forEach(function(w){c.push(w+l)}),f=b;var F=x.length/b;s.sizePerElement=f,s.elements.push({featureIdx:m,vertices:x,normals:E,offset:l}),l+=F;for(var I=function(z){var $=(E==null?void 0:E.slice(z*3,z*3+3))||[],X=x.slice(z*b,z*b+b),ne=0;A&&A[z]!==void 0&&(ne=A[z]),r.forEach(function(se){if(se&&u[se.name]){var Ee;(Ee=se.buffer.data).push.apply(Ee,(0,G.Z)(u[se.name](g,m,X,z,$,ne)))}})},k=0;k<F;k++)I(k)}),d.abrupt("return",{descriptors:r,featureLayout:s,indices:c});case 8:case"end":return d.stop()}},a)}));return function(n){return t.apply(this,arguments)}}(),Ad=function(){var t=(0,te.Z)(H().mark(function a(n){var r,e,i,o,u,s,l,c;return H().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return r=n.descriptors,e=n.features,i=n.enablePicking,o={a_Color:hi,a_Position:gi,filter:mi,a_vertexId:_i,a_PickingColor:function(g){var m=g.id;return i?Ot(m):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,l=[],c=3,e.forEach(function(d,g){var m=to(d),_=m.indices,y=m.vertices,x=m.normals,E=m.size,b=m.indexes;_.forEach(function(k){l.push(k+s)}),c=E;var A=y.length/E;u.sizePerElement=c,u.elements.push({featureIdx:g,vertices:y,normals:x,offset:s}),s+=A;for(var F=function(w){var z=(x==null?void 0:x.slice(w*3,w*3+3))||[],$=y.slice(w*E,w*E+E),X=0;b&&b[w]!==void 0&&(X=b[w]),r.forEach(function(ne){if(ne&&o[ne.name]){var se;(se=ne.buffer.data).push.apply(se,(0,G.Z)(o[ne.name](d,g,$,w,z,X)))}})},I=0;I<A;I++)F(I)}),p.abrupt("return",{descriptors:r,featureLayout:u,indices:l});case 8:case"end":return p.stop()}},a)}));return function(n){return t.apply(this,arguments)}}(),no={pointFill:bd,line:Sd,polygonFill:Ad},ro=(0,T.Z)({},no);function Td(t){return Ci.apply(this,arguments)}function Ci(){return Ci=(0,te.Z)(H().mark(function t(a){var n,r;return H().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(n=a.workerType,r=a.data,!ro[n]){i.next=3;break}return i.abrupt("return",ro[n](r));case 3:return i.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return i.stop()}},t)})),Ci.apply(this,arguments)}(0,eo.ez)(Td);var io=new Map;function Md(t,a){io.set(t,a)}function Rd(t){var a=io.get(t);return a}var Ld=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=f(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function p(){}function v(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&n.call(g,i)&&(d=g);var m=v.prototype=h.prototype=Object.create(d);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=f(t[o],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=f(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,s(m,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,u,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=function(t){return P?L(t):function(){return M.apply(t,arguments)}},C=R({}.toString),N=R("".slice),D=function(t){return N(C(t),8,-1)},F=function(t){if("Function"===D(t))return R(t)},W=function(t){return null==t},z=TypeError,B=function(t){if(W(t))throw z("Can't call method on "+t);return t},U=Object,G=function(t){return U(B(t))},H=F({}.hasOwnProperty),V=Object.hasOwn||function(t,e){return H(G(t),e)},q=0,Z=Math.random(),Y=F(1..toString),$=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Y(++q+Z,36)},K="object"==typeof document&&document.all,Q={all:K,IS_HTMLDDA:void 0===K&&void 0!==K},X=Q.all,J=Q.IS_HTMLDDA?function(t){return"function"==typeof t||t===X}:function(t){return"function"==typeof t},tt=function(t){return J(t)?t:void 0},et=function(t,e){return arguments.length<2?tt(O[t]):O[t]&&O[t][e]},rt=et("navigator","userAgent")||"",nt=O.process,ot=O.Deno,it=nt&&nt.versions||ot&&ot.version,at=it&&it.v8;at&&(E=(w=at.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&rt&&(!(w=rt.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=rt.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var ut=E,st=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ut&&ut<41})),ct=st&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ft=I("wks"),lt=O.Symbol,ht=lt&&lt.for,pt=ct?lt:lt&&lt.withoutSetter||$,vt=function(t){if(!V(ft,t)||!st&&"string"!=typeof ft[t]){var e="Symbol."+t;st&&V(lt,t)?ft[t]=lt[t]:ft[t]=ct&&ht?ht(e):pt(e)}return ft[t]},dt={};dt[vt("toStringTag")]="z";var yt="[object z]"===String(dt),gt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),mt=Q.all,xt=Q.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:J(t)||t===mt}:function(t){return"object"==typeof t?null!==t:J(t)},bt=O.document,wt=xt(bt)&&xt(bt.createElement),Et=function(t){return wt?bt.createElement(t):{}},At=!gt&&!j((function(){return 7!=Object.defineProperty(Et("div"),"a",{get:function(){return 7}}).a})),Ot=gt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),St=String,Tt=TypeError,kt=function(t){if(xt(t))return t;throw Tt(St(t)+" is not an object")},It=Function.prototype.call,jt=P?It.bind(It):function(){return It.apply(It,arguments)},Pt=F({}.isPrototypeOf),_t=Object,Mt=ct?function(t){return"symbol"==typeof t}:function(t){var e=et("Symbol");return J(e)&&Pt(e.prototype,_t(t))},Lt=String,Rt=function(t){try{return Lt(t)}catch(t){return"Object"}},Ct=TypeError,Nt=function(t){if(J(t))return t;throw Ct(Rt(t)+" is not a function")},Dt=function(t,e){var r=t[e];return W(r)?void 0:Nt(r)},Ft=TypeError,Wt=TypeError,zt=vt("toPrimitive"),Bt=function(t,e){if(!xt(t)||Mt(t))return t;var r,n=Dt(t,zt);if(n){if(void 0===e&&(e="default"),r=jt(n,t,e),!xt(r)||Mt(r))return r;throw Wt("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;if(J(r=t.valueOf)&&!xt(n=jt(r,t)))return n;if("string"!==e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;throw Ft("Can't convert object to primitive value")}(t,e)},Ut=function(t){var e=Bt(t,"string");return Mt(e)?e:e+""},Gt=TypeError,Ht=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,qt={f:gt?Ot?function(t,e,r){if(kt(t),e=Ut(e),kt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Vt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ht(t,e,r)}:Ht:function(t,e,r){if(kt(t),e=Ut(e),kt(r),At)try{return Ht(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Gt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Zt=Function.prototype,Yt=gt&&Object.getOwnPropertyDescriptor,$t=V(Zt,"name"),Kt={EXISTS:$t,PROPER:$t&&"something"===function(){}.name,CONFIGURABLE:$t&&(!gt||gt&&Yt(Zt,"name").configurable)},Qt=F(Function.toString);J(k.inspectSource)||(k.inspectSource=function(t){return Qt(t)});var Xt,Jt,te,ee=k.inspectSource,re=O.WeakMap,ne=J(re)&&/native code/.test(String(re)),oe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ie=gt?function(t,e,r){return qt.f(t,e,oe(1,r))}:function(t,e,r){return t[e]=r,t},ae=I("keys"),ue=function(t){return ae[t]||(ae[t]=$(t))},se={},ce=O.TypeError,fe=O.WeakMap;if(ne||k.state){var le=k.state||(k.state=new fe);le.get=le.get,le.has=le.has,le.set=le.set,Xt=function(t,e){if(le.has(t))throw ce("Object already initialized");return e.facade=t,le.set(t,e),e},Jt=function(t){return le.get(t)||{}},te=function(t){return le.has(t)}}else{var he=ue("state");se[he]=!0,Xt=function(t,e){if(V(t,he))throw ce("Object already initialized");return e.facade=t,ie(t,he,e),e},Jt=function(t){return V(t,he)?t[he]:{}},te=function(t){return V(t,he)}}var pe={set:Xt,get:Jt,has:te,enforce:function(t){return te(t)?Jt(t):Xt(t,{})},getterFor:function(t){return function(e){var r;if(!xt(e)||(r=Jt(e)).type!==t)throw ce("Incompatible receiver, "+t+" required");return r}}},ve=b((function(t){var e=Kt.CONFIGURABLE,r=pe.enforce,n=pe.get,o=Object.defineProperty,i=gt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!V(t,"name")||e&&t.name!==n)&&(gt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&V(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&V(u,"constructor")&&u.constructor?gt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return V(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return J(this)&&n(this).source||ee(this)}),"toString")})),de=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(J(r)&&ve(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:qt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},ye=vt("toStringTag"),ge=Object,me="Arguments"==D(function(){return arguments}()),xe=yt?D:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?D(e):"Object"==(n=D(e))&&J(e.callee)?"Arguments":n},be=yt?{}.toString:function(){return"[object "+xe(this)+"]"};yt||de(Object.prototype,"toString",be,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=F("".split),Te=j((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==D(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(B(t))},Ie=Object.getOwnPropertyDescriptor,je={f:gt?Ie:function(t,e){if(t=ke(t),e=Ut(e),At)try{return Ie(t,e)}catch(t){}if(V(t,e))return oe(!jt(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ce=Math.min,Ne=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ce(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ne(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=F([].push),He=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!V(se,r)&&V(n,r)&&Ge(i,r);for(;e.length>o;)V(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},Ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=Ve.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return He(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=F([].concat),Ke=et("Reflect","ownKeys")||function(t){var e=Ze.f(kt(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=qt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];V(t,u)||r&&V(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(J(e)?j(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&ie(i,"sham",!0),de(r,n,i,t)}},ur="process"==D(O.process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=F(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return kt(r),function(t){if("object"==typeof t||J(t))return t;throw cr("Can't set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=qt.f,hr=vt("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!V(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=vt("species"),dr=function(t){var e=et(t),r=qt.f;gt&&e&&!e[vr]&&r(e,vr,{configurable:!0,get:function(){return this}})},yr=TypeError,gr=function(t,e){if(Pt(e,t))return t;throw yr("Incorrect invocation")},mr=function(){},xr=[],br=et("Reflect","construct"),wr=/^\\s*(?:class|function)\\b/,Er=F(wr.exec),Ar=!wr.exec(mr),Or=function(t){if(!J(t))return!1;try{return br(mr,xr,t),!0}catch(t){return!1}},Sr=function(t){if(!J(t))return!1;switch(xe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ar||!!Er(wr,ee(t))}catch(t){return!0}};Sr.sham=!0;var Tr,kr,Ir,jr,Pr=!br||j((function(){var t;return Or(Or.call)||!Or(Object)||!Or((function(){t=!0}))||t}))?Sr:Or,_r=TypeError,Mr=function(t){if(Pr(t))return t;throw _r(Rt(t)+" is not a constructor")},Lr=vt("species"),Rr=function(t,e){var r,n=kt(t).constructor;return void 0===n||W(r=kt(n)[Lr])?e:Mr(r)},Cr=Function.prototype,Nr=Cr.apply,Dr=Cr.call,Fr="object"==typeof Reflect&&Reflect.apply||(P?Dr.bind(Nr):function(){return Dr.apply(Nr,arguments)}),Wr=F(F.bind),zr=function(t,e){return Nt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=et("document","documentElement"),Ur=F([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(rt),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Tr=O.location}catch(t){}var en=function(t){if(V(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Tr.protocol+"//"+Tr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=J(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Fr(e,void 0,r)},kr(Jr),Jr},Zr=function(t){delete tn[t]},ur?kr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?kr=function(t){$r.now(rn(t))}:Qr&&!Vr?(jr=(Ir=new Qr).port2,Ir.port1.onmessage=nn,kr=zr(jr.postMessage,jr)):O.addEventListener&&J(O.postMessage)&&!O.importScripts&&Tr&&"file:"!==Tr.protocol&&!j(on)?(kr=on,O.addEventListener("message",nn,!1)):kr="onreadystatechange"in Et("script")?function(t){Br.appendChild(Et("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(rt)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(rt),gn=je.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ur&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ur||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ur?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,vt("species")),Nn=!1,Dn=J(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:or("Promise",(function(){var t=ee(Mn),e=t!==String(Mn);if(!e&&66===ut)return!0;if(!ut||ut<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Nt(e),this.reject=Nt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=pe.getterFor("Promise"),Zn=pe.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!xt(t)||!J(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?jt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){jt(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ur?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ur||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){jt(Un,O,(function(){var e=t.facade;ur?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{jt(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){gr(this,Kn),Nt(t),jt(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=de(Kn,"then",(function(t,e){var r=qn(this),n=to(Rr(this,$n));return r.parent=!0,n.ok=!J(t)||t,n.fail=J(e)&&e,n.domain=ur?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},J(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||de(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){jt(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}fr&&fr(Yn,Kn)}ar({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),pr($n,"Promise",!1),dr("Promise");var po={},vo=vt("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=vt("iterator"),xo=function(t){if(!W(t))return Dt(t,mo)||Dt(t,"@@iterator")||po[xe(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Nt(r))return kt(jt(r,t));throw bo(Rt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;kt(t);try{if(!(n=Dt(t,"return"))){if("throw"===e)throw r;return r}n=jt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return kt(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(kt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Rt(t)+" is not iterable");if(go(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&Pt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=jt(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Pt(So,u))return u}return new Oo(!1)},ko=vt("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Nt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,jt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ar({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),J(Mn)){var Co=et("Promise").prototype.catch;Ro.catch!==Co&&de(Ro,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Nt(e.resolve);To(t,(function(t){jt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return jt(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;et("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(kt(t),xt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=Et("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==D(t)},gi=vt("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(Pr(e)&&(e===mi||yi(e.prototype))||xt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=F([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=G(s),d=Te(v),y=zr(c,f),g=We(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ie(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ut(e);n in t?qt.f(t,n,oe(0,r)):t[n]=r},ji=vt("species"),Pi=function(t){return ut>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=vt("species"),Li=Array,Ri=Math.max;ar({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ne(t,a),s=Ne(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(Pr(r)&&(r===Li||yi(r.prototype))||xt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=Kt.EXISTS,Ni=qt.f,Di=Function.prototype,Fi=F(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=F(Wi.exec);gt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ar({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return He(t,Ve)},Vi={f:gt&&!Ot?Object.defineProperties:function(t,e){kt(t);for(var r,n=ke(e),o=Hi(e),i=o.length,a=0;i>a;)qt.f(t,r=o[a++],n[r]);return t}},qi=ue("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=Et("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=Ve.length;r--;)delete Ki.prototype[Ve[r]];return Ki()};se[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=kt(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=qt.f,Ji=vt("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ue("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=G(t);if(V(e,aa))return e[aa];var r=e.constructor;return J(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=vt("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!xt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),J(ea[fa])||de(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=Kt.PROPER,ya=Kt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=vt("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:oe(+!n,r)}),pr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(fr?fr(u,ga):J(u[xa])||de(u,xa,ba)),pr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ie(p,"name","values"):(h=!0,d=function(){return jt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&de(p,c,s[c]);else ar({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&de(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=qt.f,Oa=pe.set,Sa=pe.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),gt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=qt.f,La=pe.enforce,Ra=pe.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=vt("toStringTag"),Ha=$("TYPED_ARRAY_TAG"),Va=_a&&!!fr&&"Opera"!==xe(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(xt(e)){var r=Ra(e);return r&&V(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!xt(t))return!1;var e=xe(t);return V(Za,e)||V(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!J(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&fr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&fr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&fr(Fa,za),gt&&!V(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return xt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ie(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if(J(t)&&(!fr||Pt(Wa,t)))return t;throw Ua(Rt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(gt){if(r)for(var o in Za){var i=O[o];if(i&&V(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||de(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(gt){if(fr){if(r)for(n in Za)if((o=O[n])&&V(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return de(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||de(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!xt(t))return!1;var e=xe(t);return"DataView"===e||V(Za,e)||V(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)de(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=G(this),r=We(e),n=arguments.length,o=Ne(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ne(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=We(t),o=Ne(e,n),i=Ne(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=Ze.f,mu=qt.f,xu=Kt.PROPER,bu=Kt.CONFIGURABLE,wu=pe.get,Eu=pe.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=F(pu),Mu=F([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ie(Au,"name","ArrayBuffer");else{(Ou=function(t){return gr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ie(Ou,Vu,Au[Vu]);Su.constructor=Ou}fr&&ca(ku)!==Iu&&fr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=F(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){gr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),gt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){gr(this,ku),gr(t,Su);var n=wu(t).byteLength,o=Le(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:Fe(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),gt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,gt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});pr(Ou,"ArrayBuffer"),pr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!xt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ju("The argument can't be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=F("".slice),ns=function(t){return"Big"===rs(xe(t),0,3)},os=TypeError,is=function(t){var e=Bt(t,"number");if("number"==typeof e)throw os("Can't convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=Mr(this),f=G(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=jt(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=We(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return fr&&J(n=e.constructor)&&n!==r&&xt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},cs=b((function(t){var e=Ze.f,r=Ei.forEach,n=pe.get,o=pe.set,i=pe.enforce,a=qt.f,u=je.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Pt(l,t)||"ArrayBuffer"==(e=xe(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Mt(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ut(e),E(t,e)?oe(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ut(e),!(E(t,e)&&xt(r)&&V(r,"value"))||V(r,"get")||V(r,"set")||r.configurable||V(r,"writable")&&!r.writable||V(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};gt?(p||(je.f=A,qt.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return gr(t,k),ss(xt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):jt(us,T,e):new S(ou(e)),t,T)})),fr&&fr(T,d),r(e(S),(function(t){t in T||ie(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){gr(t,k);var i,a,u,s=0,l=0;if(xt(e)){if(!w(e))return m(e)?x(T,e):jt(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ie(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ie(k,v,b);var P=T!=S;I[b]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ie(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ie(k,"BYTES_PER_ELEMENT",g),dr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Rt(e)+" of "+Rt(t))},hs=Math.min,ps=F([].copyWithin||function(t,e){var r=G(this),n=We(r),o=Ne(t,n),i=Ne(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ne(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=F("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(xe(this),0,3)?is(t):+t;return jt(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Rr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=Be.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=Be.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=vt("iterator"),Ds=O.Uint8Array,Fs=F(Ta.values),Ws=F(Ta.keys),zs=F(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=F([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Fr(Qs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Fr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Nt(r);var i=G(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return jt(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=G(t);if(bc)return jt(gc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=rt.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(rt),Lc=rt.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&F(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(ut)return ut<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Nt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ne(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ne(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Fr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=F([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===xe(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=kt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=pe.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=F("".charAt),mf=F("".indexOf),xf=F("".replace),bf=F("".slice),wf=(tf=/b*/g,jt(df,Jc=/a/,"a"),jt(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=jt(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=jt(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=jt(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&jt(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ar({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=vt("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=vt(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=F(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=F(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));de(String.prototype,t,s[0]),de(kf,o,s[1])}n&&ie(kf[o],"sham",!0)},jf=F("".charAt),Pf=F("".charCodeAt),_f=F("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(B(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=F("".charAt),Ff=F("".replace),Wf=F("".slice),zf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&'\`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=G(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"\`":return Wf(e,0,r);case"'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if(J(r)){var n=jt(r,t,e);return null!==n&&kt(n),n}if("RegExp"===D(t))return jt(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=vt("replace"),qf=Math.max,Zf=Math.min,Yf=F([].concat),$f=F([].push),Kf=F("".indexOf),Qf=F("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=B(this),o=W(t)?void 0:Dt(t,Vf);return o?jt(o,t,n,r):jt(e,rf(n),t,r)},function(t,o){var i=kt(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=J(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Le(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Fr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ar({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=gt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ar({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=G(this),c=We(s),f=Ne(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Le(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=F([].concat),pl=!fl||j((function(){if(gt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=G(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],gt&&!jt(a,s,u)||(r[u]=s[u]);return r}:fl;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ar({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=pe.set,ml=pe.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=Ze.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==D(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(ke(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!xt(t)&&((!El||"ArrayBuffer"!=D(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=qt.f,r=!1,n=$("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=F([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!xt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!V(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!V(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!V(t,n)&&i(t),t}};se[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=F(u[t]);de(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!xt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!J(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){gr(t,u);var r=ss(new a,t,s);return W(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=pe.set,Pl=pe.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=F([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(kt(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&V(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&V(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(xt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=pe.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(ne&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=F(Hl.delete),ql=F(Hl.has),Zl=F(Hl.get),Yl=F(Hl.set);ru(Hl,{delete:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(xt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=vt("iterator"),Kl=vt("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ie(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ie(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ie(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=B(this),n=W(e)?void 0:Dt(e,t);return n?jt(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=kt(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=vt("isConcatSpreadable"),Rh=ut>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!xt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ar({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=G(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=We(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=qt.f,zh=Tl.fastKey,Bh=pe.set,Uh=pe.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),gt||(t.size=0),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),gt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,gt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),gt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),gt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),dr(e)}});var Gh=F([].join),Hh=Te!=Object,Vh=Ai("join",",");ar({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(ke(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ar({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(G(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ar({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=F(1..valueOf),Np=F("".replace),Dp="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(B(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=Ze.f,Gp=je.f,Hp=qt.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=F("".slice),Kp=F("".charCodeAt),Qp=function(t){var e=Bt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Bt(t,"number");if(Mt(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(or("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Pt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=gt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)V(qp,Jp=ev[rv])&&!V(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,de(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=F((function(t){var e=rf(B(this)),r="",n=Le(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=F("".slice),cv=F(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=F("".replace);ar({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(B(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+xv(rf(r),mv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=Kt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&de(RegExp.prototype,"toString",(function(){var t=kt(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||V(t,"flags")||!Pt(bv,t)?e:jt(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});
`,Fn="l7-worker",Od=3,kd=!0;function Fd(t){Md(Fn,t)}function Pd(){var t=Rd(Fn);if(!t)throw new Error("get worker failed by workerName: ".concat(Fn,"."));return t}function Dd(t,a){return Si.apply(this,arguments)}function Si(){return Si=(0,te.Z)(H().mark(function t(a,n){var r,e,i,o,u;return H().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r=Pd(),e=eo.qH.getWorkerFarm({maxConcurrency:Od,reuseWorkers:kd}),i=e.getWorkerPool({name:Fn,source:r}),l.next=5,i.startJob(Fn,function(c,f,p){return c.done(p)});case 5:return o=l.sent,o.postMessage("process",{input:{workerType:a,data:n}}),l.next=9,o.result;case 9:return u=l.sent,l.abrupt("return",u.result);case 11:case"end":return l.stop()}},t)})),Si.apply(this,arguments)}Fd(Ld);var Gt={BACK:1029,FRONT:1028};function Pn(t){switch(t){case"GAODE1.x":return Gt.BACK;case"GAODE2.x":return Gt.BACK;case"MAPBOX":return Gt.FRONT;case"SIMPLE":return Gt.FRONT;case"GLOBEL":return Gt.BACK;case"L7MAP":return Gt.FRONT;default:return Gt.FRONT}}function L5(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function wd(t){var a=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r=n[1].charCodeAt(0),e=n[2].charCodeAt(0),i;for(i=r;i<=e;++i)a.push(t.replace(n[0],String.fromCharCode(i)));return a}if(n=/\{(\d+)-(\d+)\}/.exec(t),n){for(var o=parseInt(n[2],10),u=parseInt(n[1],10);u<=o;u++)a.push(t.replace(n[0],u.toString()));return a}return a.push(t),a}function Dn(t,a){if(!t||!t.length)throw new Error("url is not allowed to be empty");var n=a.x,r=a.y,e=a.z,i=wd(t),o=Math.abs(n+r)%i.length,u=i[o];return u.replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,e.toString()).replace(/\{-y\}/g,(Math.pow(2,e)-r-1).toString())}var ln;(function(t){t.Realtime="realtime",t.Overlap="overlap",t.Replace="replace"})(ln||(ln={}));var qe;(function(t){t.Loading="Loading",t.Loaded="Loaded",t.Failure="Failure",t.Cancelled="Cancelled"})(qe||(qe={}));var Id=O(38159),ao=0,oo=1,lr=2;function Bd(t){t.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function Nd(t){t.forEach(function(a){a.properties.state=ao}),t.forEach(function(a){a.isCurrent&&!uo(a)&&bi(a)}),t.forEach(function(a){a.isVisible=Boolean(a.properties.state&lr)})}function Zd(t){t.forEach(function(n){n.properties.state=ao}),t.forEach(function(n){n.isCurrent&&uo(n)});var a=t.slice().sort(function(n,r){return n.z-r.z});a.forEach(function(n){n.isVisible=Boolean(n.properties.state&lr),n.children.length&&(n.isVisible||n.properties.state&oo)?n.children.forEach(function(r){r.properties.state=oo}):n.isCurrent&&bi(n)})}function uo(t){for(;t;){if(t.isLoaded)return t.properties.state|=lr,!0;t=t.parent}return!1}function bi(t){t.children.forEach(function(a){a.isLoaded?a.properties.state|=lr:bi(a)})}var wn,O5=256,so=[-Infinity,-Infinity,Infinity,Infinity],zd=.2,Ud=5,jd=(wn={},(0,h.Z)(wn,ln.Realtime,Bd),(0,h.Z)(wn,ln.Overlap,Nd),(0,h.Z)(wn,ln.Replace,Zd),wn),Hd=function(){};function Ai(t,a,n){var r=Math.floor((t+180)/360*Math.pow(2,n)),e=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,n));return[r,e]}function lo(t,a,n){var r=t/Math.pow(2,n)*360-180,e=Math.PI-2*Math.PI*a/Math.pow(2,n),i=180/Math.PI*Math.atan(.5*(Math.exp(e)-Math.exp(-e)));return[r,i]}var Vd=function(a,n,r){var e=lo(a,n,r),i=(0,re.Z)(e,2),o=i[0],u=i[1],s=lo(a+1,n+1,r),l=(0,re.Z)(s,2),c=l[0],f=l[1];return[o,f,c,u]};function Gd(t){var a=t.zoom,n=t.latLonBounds,r=t.maxZoom,e=r===void 0?Infinity:r,i=t.minZoom,o=i===void 0?0:i,u=t.zoomOffset,s=u===void 0?0:u,l=t.extent,c=l===void 0?so:l,f=Math.ceil(a)+s;if(Number.isFinite(o)&&f<o)return[];Number.isFinite(e)&&f>e&&(f=e);for(var p=(0,re.Z)(n,4),d=p[0],g=p[1],m=p[2],_=p[3],y=[Math.max(d,c[0]),Math.max(g,c[1]),Math.min(m,c[2]),Math.min(_,c[3])],x=[],E=Ai(y[0],y[1],f),b=(0,re.Z)(E,2),A=b[0],F=b[1],I=Ai(y[2],y[3],f),k=(0,re.Z)(I,2),w=k[0],z=k[1],$=A;$<=w;$++)for(var X=z;X<=F;X++)x.push({x:$,y:X,z:f});var ne=(w+A)/2,se=(F+z)/2,Ee=function(Ze,Be){return Math.abs(Ze-ne)+Math.abs(Be-se)};return x.sort(function(Oe,Ze){return Ee(Oe.x,Oe.y)-Ee(Ze.x,Ze.y)}),x}var Wd=function(a,n,r){var e=Math.pow(2,r),i=e-1,o=e,u=a,s=n;return u<0?u=u+o:u>i&&(u=u%o),{warpX:u,warpY:s}},He=O(26729),cr=O.n(He);function $d(t){var a=Xd();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Xd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Yd=function(t){(0,N.Z)(n,t);var a=$d(n);function n(r){var e;(0,R.Z)(this,n),e=a.call(this),(0,h.Z)((0,C.Z)(e),"tileSize",256),(0,h.Z)((0,C.Z)(e),"isVisible",!1),(0,h.Z)((0,C.Z)(e),"isCurrent",!1),(0,h.Z)((0,C.Z)(e),"isVisibleChange",!1),(0,h.Z)((0,C.Z)(e),"layerIDList",[]),(0,h.Z)((0,C.Z)(e),"loadedLayers",0),(0,h.Z)((0,C.Z)(e),"parent",null),(0,h.Z)((0,C.Z)(e),"children",[]),(0,h.Z)((0,C.Z)(e),"loadedChilds",0),(0,h.Z)((0,C.Z)(e),"data",null),(0,h.Z)((0,C.Z)(e),"properties",{}),(0,h.Z)((0,C.Z)(e),"loadDataId",0);var i=r.x,o=r.y,u=r.z,s=r.tileSize;return e.x=i,e.y=o,e.z=u,e.tileSize=s,e}return(0,L.Z)(n,[{key:"isLoading",get:function(){return this.loadStatus===qe.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===qe.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===qe.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===qe.Cancelled}},{key:"isDone",get:function(){return[qe.Loaded,qe.Cancelled,qe.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Vd(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=(0,re.Z)(this.bounds,4),i=e[0],o=e[1],u=e[2],s=e[3],l=[(u-i)/2,(s-o)/2],c=(0,Id.Z)(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:l,meta:`
      `.concat(this.key,`
      `)}});return c}},{key:"key",get:function(){var e="".concat(this.x,",").concat(this.y,",").concat(this.z);return e}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g,m,_,y,x,E,b,A,F;return H().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=o.getData,s=o.onLoad,l=o.onError,this.loadDataId++,c=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=qe.Loading,f=null,k.prev=7,d=this.x,g=this.y,m=this.z,_=this.bounds,y=this.tileSize,x=Wd(d,g,m),E=x.warpX,b=x.warpY,A=this.abortController.signal,F={x:E,y:b,z:m,bounds:_,tileSize:y,signal:A},k.next=14,u(F,this);case 14:f=k.sent,k.next=20;break;case 17:k.prev=17,k.t0=k.catch(7),p=k.t0;case 20:if(c===this.loadDataId){k.next=22;break}return k.abrupt("return");case 22:if(!(this.isCancelled&&!f)){k.next=24;break}return k.abrupt("return");case 24:if(!(p||!f)){k.next=28;break}return this.loadStatus=qe.Failure,l(p,this),k.abrupt("return");case 28:this.loadStatus=qe.Loaded,this.data=f,s(this);case 31:case"end":return k.stop()}},i,this,[[7,17]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=qe.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),n}(He.EventEmitter),Kd=function(a,n){var r=ir(a),e=on(r,n),i=360*3-180,o=85.0511287798065,u=[Math.max(e[0][0],-i),Math.max(e[0][1],-o),Math.min(e[1][0],i),Math.min(e[1][1],o)];return u},Qd=function(a,n){var r=ir(a),e=ir(n),i=di(r,e);return i};function Dt(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=qd(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function qd(t,a){if(!!t){if(typeof t=="string")return co(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return co(t,a)}}function co(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function Jd(t){var a=ev();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ev(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var tv=function(t){(0,N.Z)(n,t);var a=Jd(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this),(0,h.Z)((0,C.Z)(e),"currentTiles",[]),(0,h.Z)((0,C.Z)(e),"cacheTiles",new Map),(0,h.Z)((0,C.Z)(e),"throttleUpdate",(0,P.throttle)(function(i,o){e.update(i,o)},16)),(0,h.Z)((0,C.Z)(e),"onTileLoad",function(i){e.emit("tile-loaded",i),e.updateTileVisible()}),(0,h.Z)((0,C.Z)(e),"onTileError",function(i,o){e.emit("tile-error",{error:i,tile:o}),e.updateTileVisible()}),(0,h.Z)((0,C.Z)(e),"onTileUnload",function(i){e.emit("tile-unload",i)}),e.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:so,getTileData:Hd,updateStrategy:ln.Replace},e.updateOptions(r),e}return(0,L.Z)(n,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(e){return e.isDone})}},{key:"tiles",get:function(){var e=Array.from(this.cacheTiles.values()).sort(function(i,o){return i.z-o.z});return e}},{key:"updateOptions",value:function(e){var i=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),o=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=(0,T.Z)((0,T.Z)((0,T.Z)({},this.options),e),{},{minZoom:i,maxZoom:o})}},{key:"update",value:function(e,i){var o=this,u=Math.ceil(e);if(!(this.lastViewStates&&this.lastViewStates.zoom===u&&Qd(this.lastViewStates.latLonBoundsBuffer,i))){var s=Kd(i,zd);this.lastViewStates={zoom:u,latLonBounds:i,latLonBoundsBuffer:s};var l=!1,c=this.getTileIndices(u,s);this.currentTiles=c.map(function(f){var p=f.x,d=f.y,g=f.z,m=o.getTile(p,d,g);if(m){var _,y,x=((_=m)===null||_===void 0?void 0:_.isFailure)||((y=m)===null||y===void 0?void 0:y.isCancelled);return x&&m.loadData({getData:o.options.getTileData,onLoad:o.onTileLoad,onError:o.onTileError}),m}return m=o.createTile(p,d,g),l=!0,m}),l&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e=Dt(this.cacheTiles),i;try{for(e.s();!(i=e.n()).done;){var o=(0,re.Z)(i.value,2),u=o[0],s=o[1];this.currentTiles.includes(s)||(this.cacheTiles.delete(u),this.onTileUnload(s)),this.onTileUnload(s),s.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(l){e.e(l)}finally{e.f()}}},{key:"pruneRequests",value:function(){var e=[],i=Dt(this.cacheTiles.values()),o;try{for(i.s();!(o=i.n()).done;){var u=o.value;u.isLoading&&!u.isCurrent&&!u.isVisible&&e.push(u)}}catch(l){i.e(l)}finally{i.f()}for(;e.length>0;){var s=e.shift();s.abortLoad()}}},{key:"getTileByLngLat",value:function(e,i,o){var u=this.options.zoomOffset,s=Math.ceil(o)+u,l=Ai(e,i,s),c=this.tiles.filter(function(f){return f.key==="".concat(l[0],",").concat(l[1],",").concat(s)});return c[0]}},{key:"destroy",value:function(){var e=Dt(this.cacheTiles.values()),i;try{for(e.s();!(i=e.n()).done;){var o=i.value;o.isLoading&&o.abortLoad()}}catch(u){e.e(u)}finally{e.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e=this.options.updateStrategy,i=new Map,o=Dt(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var s=u.value;i.set(s.key,s.isVisible),s.isCurrent=!1,s.isVisible=!1}}catch(g){o.e(g)}finally{o.f()}var l=Dt(this.currentTiles),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.isCurrent=!0,f.isVisible=!0}}catch(g){l.e(g)}finally{l.f()}var p=Array.from(this.cacheTiles.values());typeof e=="function"?e(p):jd[e](p);var d=!1;Array.from(this.cacheTiles.values()).forEach(function(g){g.isVisible!==i.get(g.key)?(g.isVisibleChange=!0,d=!0):g.isVisibleChange=!1}),d&&this.emit("tile-update")}},{key:"getTileIndices",value:function(e,i){var o=this.options,u=o.tileSize,s=o.extent,l=o.zoomOffset,c=Math.floor(this.options.maxZoom),f=Math.ceil(this.options.minZoom),p=Gd({maxZoom:c,minZoom:f,zoomOffset:l,tileSize:u,zoom:e,latLonBounds:i,extent:s});return p}},{key:"getTileId",value:function(e,i,o){var u="".concat(e,",").concat(i,",").concat(o);return u}},{key:"getTile",value:function(e,i,o){var u=this.getTileId(e,i,o),s=this.cacheTiles.get(u);return s}},{key:"createTile",value:function(e,i,o){var u=this.getTileId(e,i,o),s=new Yd({x:e,y:i,z:o,tileSize:this.options.tileSize});return this.cacheTiles.set(u,s),s.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),s}},{key:"resizeCacheTiles",value:function(){var e=Ud*this.currentTiles.length,i=this.cacheTiles.size>e;if(i){var o=Dt(this.cacheTiles),u;try{for(o.s();!(u=o.n()).done;){var s=(0,re.Z)(u.value,2),l=s[0],c=s[1];if(!c.isVisible&&!this.currentTiles.includes(c)&&(this.cacheTiles.delete(l),this.onTileUnload(c)),this.cacheTiles.size<=e)break}}catch(f){o.e(f)}finally{o.f()}}}},{key:"rebuildTileTree",value:function(){var e=Dt(this.cacheTiles.values()),i;try{for(e.s();!(i=e.n()).done;){var o=i.value;o.parent=null,o.children.length=0}}catch(f){e.e(f)}finally{e.f()}var u=Dt(this.cacheTiles.values()),s;try{for(u.s();!(s=u.n()).done;){var l=s.value,c=this.getNearestAncestor(l.x,l.y,l.z);l.parent=c,c!=null&&c.children&&c.children.push(l)}}catch(f){u.e(f)}finally{u.f()}}},{key:"getNearestAncestor",value:function(e,i,o){for(;o>this.options.minZoom;){e=Math.floor(e/2),i=Math.floor(i/2),o=o-1;var u=this.getTile(e,i,o);if(u)return u}return null}}]),n}(cr()),fo;(function(t){t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.L7MAP="L7MAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL"})(fo||(fo={}));function k5(t,a,n,r,e){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,u=n;return o&&(u=Math.round(n*(i-1))/(i-1)),r?vo(t,a,u,r,e):vo(t,a,u,.314,e)}function fr(t,a){var n=1-a;return(t[0]*n+t[1]*a)*n+(t[1]*n+t[2]*a)*a}function nv(t,a){return Math.sqrt(Math.pow(t[0]-a[0],2)+Math.pow(t[1]-a[1],2))}function po(t,a,n){var r=[a[0]-t[0],a[1]-t[1]],e=nv(r,[0,0]),i=Math.atan2(r[1],r[0]),o=e/2/Math.cos(n),u=i+n,s=[o*Math.cos(u)+t[0],o*Math.sin(u)+t[1]];return s}function vo(t,a,n,r,e){if(e===Version["GAODE2.x"]){var i=amap2Project(t[0],t[1]),o=amap2Project(a[0],a[1]),u=po(i,o,r),s=[i[0],u[0],o[0]],l=[i[1],u[1],o[1]];return[].concat(_toConsumableArray(amap2UnProject(fr(s,n),fr(l,n))),[0])}else{var c=po(t,a,r),f=[t[0],c[0],a[0]],p=[t[1],c[1],a[1]];return[fr(f,n),fr(p,n),0]}}function F5(t,a,n,r,e){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,u=n;return o&&(u=Math.round(n*29)/29),av(t,a,u,e)}function rv(t,a){var n=[a[0]-t[0],a[1]-t[1]],r=calDistance(n,[0,0]),e=Math.atan2(n[1],n[0]),i=.314,o=r/2/Math.cos(i),u=e+i,s=[o*Math.cos(u)+t[0],o*Math.sin(u)+t[1]];return s}function ho(t,a){var n=1-a;return(t[0]*n+t[1]*a)*n+(t[1]*n+t[2]*a)*a}function iv(t,a){var n=[t[0]-a[0],t[1]-a[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],e=r[1]*r[1]+Math.cos(t[1])*Math.cos(a[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e))}function av(t,a,n,r){var e=[degreesToRadians(t[0]),degreesToRadians(t[1])],i=[degreesToRadians(a[0]),degreesToRadians(a[1])];if(r==="GAODE2.x"){var o=rv(e,i),u=[e[0],o[0],i[0]],s=[e[1],o[1],i[1]];return[ho(u,n),ho(s,n),0]}else{var l=iv(e,i);if(Math.abs(l-Math.PI)<.001)return[(1-n)*e[0]+n*i[0],(1-n)*e[1]+n*i[1]];var c=Math.sin((1-n)*l)/Math.sin(l),f=Math.sin(n*l)/Math.sin(l),p=[Math.sin(e[0]),Math.sin(e[1])],d=[Math.cos(e[0]),Math.cos(e[1])],g=[Math.sin(i[0]),Math.sin(i[1])],m=[Math.cos(i[0]),Math.cos(i[1])],_=c*d[1]*d[0]+f*m[1]*m[0],y=c*d[1]*p[0]+f*m[1]*g[0],x=c*p[1]+f*g[1];return[radiansToDegrees(Math.atan2(y,_)),radiansToDegrees(Math.atan2(x,Math.sqrt(_*_+y*y)))]}}function P5(t,a){for(var n=0,r=[],e=0;e<t.length-1;e++){var i=t[e],o=t[e+1],u=uv(i,o),s=n;n+=u,r.push({p1:i,p2:o,totalDistance:n,distance:u,lastTotalDistance:s})}for(var l=n*a,c,f,p=0;p<r.length;p++){var d=r[p].totalDistance;if(d>l){var g=r[p].p1,m=r[p].p2,_=(l-r[p].lastTotalDistance)/r[p].distance,y=ov(m,g,_);c=y[0],f=y[1];break}}return{_lng:c,_lat:f,_height:0}}function ov(t,a,n){return[t[0]*n+a[0]*(1-n),t[1]*n+a[1]*(1-n)]}function uv(t,a){return Math.sqrt(Math.pow(t[0]-a[0],2)+Math.pow(t[1]-a[1],2))}function go(t,a){var n=a.featureId,r=t.data.dataArray;return typeof n=="number"&&(r=r.filter(function(e){var i=e._id;return i===n})),r.map(function(e){var i=sv(e,a);return _objectSpread(_objectSpread({},e),i)})}function D5(t,a){return new Promise(function(n){t.inited?n(go(t,a)):t.once("update",function(){n(go(t,a))})})}function sv(t,a){var n=a.offset,r=a.shape,e=a.thetaOffset,i=a.mapVersion,o=a.segmentNumber,u=o===void 0?30:o,s=a.autoFit,l=s===void 0?!0:s,c=t.coordinates;if(r==="line")return pathLineAtOffset(c,n);var f=c[0],p=c[1],d;typeof e=="string"?d=t[e]||0:d=e;var g;switch(r){case"arc":g=arcLineAtOffset;break;case"greatcircle":g=greatCircleLineAtOffset;break;default:g=arcLineAtOffset}var m=g(f,p,n,d,i,u,l),_=_slicedToArray(m,3),y=_[0],x=_[1],E=_[2];return{_lng:y,_lat:x,_height:E}}function mo(t,a){var n=a.extent,r=n===void 0?[121.168,30.2828,121.384,30.4219]:n,e=new Promise(function(o){t instanceof HTMLImageElement||nd(t)?o([t]):lv(t,function(u){o(u)})}),i={originData:t,images:e,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return i}function lv(t,a){var n=t,r=[];if(typeof n=="string")ci({url:n},function(o,u){u&&(r.push(u),a(r))});else{var e=n.length,i=0;n.forEach(function(o){ci({url:o},function(u,s){i++,s&&r.push(s),i===e&&a(r)})})}return mo}var cv=O(38929),fv=O(3614),pv=O.n(fv),dv={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function w5(t,a,n){var r=t/Math.pow(2,n)*360-180,e=Math.PI-2*Math.PI*a/Math.pow(2,n),i=180/Math.PI*Math.atan(.5*(Math.exp(e)-Math.exp(-e)));return[r,i]}var vv=function(){var t=(0,te.Z)(H().mark(function a(n,r,e){var i;return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=Dn(n,r),u.abrupt("return",new Promise(function(s){var l=li({url:i},function(c,f){if(c||!f)s({layers:{}});else{for(var p=new cv.VectorTile(new(pv())(f)),d=0,g=Object.keys(p.layers);d<g.length;d++){for(var m=g[d],_=[],y=p.layers[m],x=0;x<p.layers[m].length;x++){var E=p.layers[m].feature(x),b=E.toGeoJSON(r.x,r.y,r.z);_.push(b)}y.features=_}s(p)}});e.xhrCancel=function(){return l.abort()}}));case 2:case"end":return u.stop()}},a)}));return function(n,r,e){return t.apply(this,arguments)}}();function hv(t,a){var n=Array.isArray(t)?t[0]:t,r=function(o,u){return vv(n,o,u)},e=(0,T.Z)((0,T.Z)((0,T.Z)({},dv),a),{},{getTileData:r});return{data:n,dataArray:[],tilesetOptions:e,isTile:!0}}var gv=O(98592),mv={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function _v(t){for(var a=0,n=0,r=t.length,e=r-1,i,o;n<r;e=n++)i=t[n],o=t[e],a+=(o.x-i.x)*(i.y+o.y);return a}function yv(t){var a=t.length;if(a<=1)return[t];for(var n=[],r,e,i=0;i<a;i++){var o=_v(t[i]);o!==0&&(e===void 0&&(e=o<0),e===o<0?(r&&n.push(r),r=[t[i]]):r.push(t[i]))}return r&&n.push(r),n}var xv=["Unknown","Point","LineString","Polygon"];function Ev(t,a,n,r,e){var i=e.geometry,o=e.type,u=e.tags,s=e.id,l=t*Math.pow(2,r),c=t*a,f=t*n,p=xv[o],d,g;function m(x){for(var E=0;E<x.length;E++){var b=x[E];if(b[3])break;var A=180-(b[1]+f)*360/l,F=(b[0]+c)*360/l-180,I=360/Math.PI*Math.atan(Math.exp(A*Math.PI/180))-90;x[E]=[F,I,0,1]}}switch(o){case 1:var _=[];for(d=0;d<i.length;d++)_[d]=i[d][0];i=_,m(i);break;case 2:for(d=0;d<i.length;d++)m(i[d]);break;case 3:for(i=yv(i),d=0;d<i.length;d++)for(g=0;g<i[d].length;g++)m(i[d][g]);break}i.length===1?i=i[0]:p="Multi"+p;var y={type:"Feature",geometry:{type:p,coordinates:i},properties:u,id:s,tileOrigin:[0,0],coord:""};return y}var Cv=function(){var t=(0,te.Z)(H().mark(function a(n,r,e,i){return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(s){var l=r.getTile(n.z,n.x,n.y),c=[];l.features.map(function(p){var d=Ev(i,e.x,e.y,e.z,p);c.push(d)});var f={layers:{geojsonvt:{features:c}}};s(f)}));case 1:case"end":return u.stop()}},a)}));return function(n,r,e,i){return t.apply(this,arguments)}}();function Sv(t){var a={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return t===void 0||typeof t.geojsonvtOptions=="undefined"||(t.geojsonvtOptions.maxZoom&&(a.maxZoom=t.geojsonvtOptions.maxZoom),t.geojsonvtOptions.indexMaxZoom&&(a.indexMaxZoom=t.geojsonvtOptions.indexMaxZoom),t.geojsonvtOptions.indexMaxPoints&&(a.indexMaxPoints=t.geojsonvtOptions.indexMaxPoints),t.geojsonvtOptions.tolerance&&(a.tolerance=t.geojsonvtOptions.tolerance),t.geojsonvtOptions.extent&&(a.extent=t.geojsonvtOptions.extent),t.geojsonvtOptions.buffer&&(a.buffer=t.geojsonvtOptions.buffer),t.geojsonvtOptions.lineMetrics&&(a.lineMetrics=t.geojsonvtOptions.lineMetrics),t.geojsonvtOptions.promoteId&&(a.promoteId=t.geojsonvtOptions.promoteId),t.geojsonvtOptions.generateId&&(a.generateId=t.geojsonvtOptions.generateId),t.geojsonvtOptions.debug&&(a.debug=t.geojsonvtOptions.debug)),a}function bv(t,a){var n=Sv(a),r=n.extent||4096,e=(0,gv.Z)(t,n),i=function(s,l){return Cv(l,e,s,r)},o=(0,T.Z)((0,T.Z)((0,T.Z)({},mv),a),{},{getTileData:i});return{data:t,dataArray:[],tilesetOptions:o,isTile:!0}}function Av(t,a,n){switch(t){case"+":return a+n;case"-":return a-n;case"*":return a*n;case"/":return a/n;case"%":return a%n;case"^":return Math.pow(a,n);case"abs":return Math.abs(a);case"floor":return Math.floor(a);case"round":return Math.round(a);case"ceil":return Math.ceil(a);case"sin":return Math.sin(a);case"cos":return Math.cos(a);case"atan":return n===-1?Math.atan(a):Math.atan2(a,n);default:return console.warn("Calculate symbol err! Return default 0"),0}}function pr(t,a){for(var n=a[0],r=n.width,e=n.height,i=a.map(function(d){return d.rasterData}),o=r*e,u=[],s=JSON.stringify(t),l=0;l<o;l++){var c=JSON.parse(s),f=_o(c,i,l);if(typeof f=="number")u.push(f);else{var p=Ti(c);u.push(p)}}return u}function _o(t,a,n){if(t.length===2&&t[0]==="band"&&typeof t[1]=="number")try{return a[t[1]][n]}catch(r){return console.warn("Raster Data err!"),0}t.map(function(r,e){if(Array.isArray(r)&&r.length>0)switch(r[0]){case"band":try{t[e]=a[r[1]][n]}catch(i){console.warn("Raster Data err!"),t[e]=0}break;default:_o(r,a,n)}})}function Tv(t){var a=(0,re.Z)(t,3),n=a[0],r=a[1],e=r===void 0?-1:r,i=a[2],o=i===void 0?-1:i;if(n===void 0)return console.warn("Express err!"),["+",0,0];var u=n.replace(/\s+/g,"");return[u,e,o]}function Ti(t){var a=Tv(t),n=a[0],r=a[1],e=a[2];return Array.isArray(r)&&(r=Ti(t[1])),Array.isArray(e)&&(e=Ti(t[2])),Av(n,r,e)}function Mi(t,a,n){return Ri.apply(this,arguments)}function Ri(){return Ri=(0,te.Z)(H().mark(function t(a,n,r){var e,i,o,u,s,l,c,f,p,d,g,m,_,y;return H().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(a.length!==0){E.next=2;break}return E.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return E.next=4,Promise.all(a.map(function(b){var A=b.data,F=b.bands,I=F===void 0?[0]:F;return n(A,I)}));case 4:e=E.sent,e=e.flat(),i=e[0],o=i.width,u=i.height,l=void 0,c=void 0,f=void 0,E.t0=(0,Kr.Z)(r),E.next=E.t0==="function"?13:E.t0==="object"?15:17;break;case 13:return s=r(e),E.abrupt("break",18);case 15:return Array.isArray(r)?s=pr(r,e):(p=Mv(r,e),d=Rv(p),g=d.data,m=d.channelRMax,_=d.channelGMax,y=d.channelBMax,s=g,l=m,c=_,f=y),E.abrupt("break",18);case 17:s=e[0].rasterData;case 18:return E.abrupt("return",{rasterData:s,width:o,height:u,channelR:l,channelG:c,channelB:f});case 19:case"end":return E.stop()}},t)})),Ri.apply(this,arguments)}function Mv(t,a){t.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),t.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),t.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=pr(t.r||["band",0],a),r=pr(t.g||["band",0],a),e=pr(t.b||["band",0],a);return[n,r,e]}function Rv(t){for(var a=t[0],n=t[1],r=t[2],e=[],i=-Infinity,o=-Infinity,u=-Infinity,s=0;s<a.length;s++)e.push(a[s]),i=Math.max(i,a[s]),e.push(n[s]),o=Math.max(o,a[s]),e.push(r[s]),u=Math.max(u,a[s]);return{data:e,channelRMax:i,channelGMax:o,channelBMax:u}}function yo(t,a,n,r){return Li.apply(this,arguments)}function Li(){return Li=(0,te.Z)(H().mark(function t(a,n,r,e){var i,o,u,s,l,c;return H().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Mi(a,n,r);case 2:i=p.sent,o=i.rasterData,u=i.width,s=i.height,l=0,c=8e3,e(null,{data:o,width:u,height:s,min:l,max:c});case 9:case"end":return p.stop()}},t)})),Li.apply(this,arguments)}function Lv(t,a){return t.map(function(n){return n[a]*1})}function Ov(t){return t===void 0?!1:!Array.isArray(t)&&t.data!==void 0}function I5(t){return Array.isArray(t)?t.length===0?!1:!!Ov(t[0]):!1}function xo(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function kv(t,a){var n=a.extent,r=a.width,e=a.height,i=a.min,o=a.max,u=a.format,s=a.operation,l,c,f;if(u===void 0||xo(t))l=Array.from(t),c=r,f=e;else{var p=Array.isArray(t)?t:[t];l=Mi(p,u,s)}var d={_id:1,dataArray:[{_id:1,data:l,width:c,height:f,min:i,max:o,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return d}function Fv(t,a){var n=a.extent,r=a.width,e=a.height,i=a.min,o=a.max,u=a.format,s=a.operation,l,c,f;if(u===void 0||xo(t))l=Array.from(t),c=r,f=e;else{var p=Array.isArray(t)?t:[t];l=Mi(p,u,s)}var d={_id:1,dataArray:[{_id:1,data:l,width:c,height:f,min:i,max:o,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return d}var Et;(function(t){t.IMAGE="image",t.ARRAYBUFFER="arraybuffer",t.RGB="rgb"})(Et||(Et={}));function Pv(t,a){return Array.isArray(t)?typeof t[0]=="string"?t.map(function(n){return Dn(n,a)}):t.map(function(n){return{url:Dn(n.url,a),bands:n.bands||[0]}}):Dn(t,a)}function Dv(t){return typeof t=="string"?[{url:t,bands:[0]}]:typeof t[0]=="string"?t.map(function(a){return{url:a,bands:[0]}}):t}function Eo(t,a){t.xhrCancel=function(){a.map(function(n){n.abort()})}}var wv=function(){var t=(0,te.Z)(H().mark(function a(n,r,e,i,o){var u,s,l,c,f,p;return H().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=Dv(r.url),!(u.length>1)){g.next=15;break}return g.next=4,Iv(u,r);case 4:if(s=g.sent,l=s.rasterFiles,c=s.xhrList,f=s.errList,Eo(n,c),!(f.length>0)){g.next=12;break}return e(f,null),g.abrupt("return");case 12:yo(l,i,o,e),g.next=17;break;case 15:p=li(r,function(m,_){if(m)e(m);else if(_){var y=[{data:_,bands:u[0].bands}];yo(y,i,o,e)}}),Eo(n,[p]);case 17:case"end":return g.stop()}},a)}));return function(n,r,e,i,o){return t.apply(this,arguments)}}();function Iv(t,a){return Oi.apply(this,arguments)}function Oi(){return Oi=(0,te.Z)(H().mark(function t(a,n){var r,e,i,o,u,s,l,c,f,p,d;return H().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:r=[],e=[],i=[],o=0;case 4:if(!(o<a.length)){m.next=20;break}return u=a[o],s=(0,T.Z)((0,T.Z)({},n),{},{url:u.url}),l=u.bands,m.next=10,od((0,T.Z)((0,T.Z)({},s),{},{type:"arrayBuffer"}));case 10:c=m.sent,f=c.err,p=c.data,d=c.xhr,f&&i.push(f),e.push(d),r.push({data:p,bands:l});case 17:o++,m.next=4;break;case 20:return m.abrupt("return",{rasterFiles:r,xhrList:e,errList:i});case 21:case"end":return m.stop()}},t)})),Oi.apply(this,arguments)}var Bv=function(){var t=(0,te.Z)(H().mark(function a(n,r,e,i,o){var u;return H().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return u={url:Pv(n,r)},l.abrupt("return",new Promise(function(c,f){wv(e,u,function(p,d){p?f(p):d&&c(d)},i,o)}));case 2:case"end":return l.stop()}},a)}));return function(n,r,e,i,o){return t.apply(this,arguments)}}(),Co=function(){var t=(0,te.Z)(H().mark(function a(n,r,e){var i;return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=Dn(Array.isArray(n)?n[0]:n,r),u.abrupt("return",new Promise(function(s,l){var c=ci({url:i},function(f,p){f?l(f):p&&s(p)});e.xhrCancel=function(){return c.abort()}}));case 2:case"end":return u.stop()}},a)}));return function(n,r,e){return t.apply(this,arguments)}}(),Nv=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Zv={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},zv=[Et.ARRAYBUFFER,Et.RGB];function Uv(t){return!!(Array.isArray(t)&&t.length===0||!Array.isArray(t)&&typeof t!="string")}function jv(t,a){if(Uv(t))throw new Error("tile server url is error");var n=(a==null?void 0:a.dataType)||Et.IMAGE;n===Et.RGB&&(n=Et.ARRAYBUFFER);var r=function(o,u){switch(n){case Et.IMAGE:return Co(t,o,u);case Et.ARRAYBUFFER:return Bv(t,o,u,(a==null?void 0:a.format)||Nv,a==null?void 0:a.operation);default:return Co(t,o,u)}},e=(0,T.Z)((0,T.Z)((0,T.Z)({},Zv),a),{},{getTileData:r});return{data:t,dataArray:[],tilesetOptions:e,isTile:!0}}var Hv={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Vv=function(){var t=(0,te.Z)(H().mark(function a(n){return H().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(i){var o=(0,re.Z)(n.bounds,4),u=o[0],s=o[1],l=o[2],c=o[3],f={layers:{testTile:{features:[{type:"Feature",properties:{key:n.x+"/"+n.y+"/"+n.z,textLng:(u+l)/2,textLat:(s+c)/2},geometry:{type:"LineString",coordinates:[[l,c],[l,s],[u,s],[u,s]]}}]}}};i(f)}));case 1:case"end":return e.stop()}},a)}));return function(n){return t.apply(this,arguments)}}();function Gv(t,a){var n=function(i){return Vv(i)},r=(0,T.Z)((0,T.Z)((0,T.Z)({},Hv),a),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:r,isTile:!0}}var Ve=O(46343),Wv=O(69848),So=O.n(Wv);function bo(t,a){var n=a.radius,r=n===void 0?40:n,e=a.maxZoom,i=e===void 0?18:e,o=a.minZoom,u=o===void 0?0:o,s=a.zoom,l=s===void 0?2:s;if(t.pointIndex){var c=t.pointIndex.getClusters(t.extent,Math.floor(l));return t.dataArray=$v(c),t}var f=new(So())({radius:r,minZoom:u,maxZoom:i}),p={type:"FeatureCollection",features:[]};return p.features=t.dataArray.map(function(d){return{type:"Feature",geometry:{type:"Point",coordinates:d.coordinates},properties:(0,T.Z)({},d)}}),f.load(p.features),f}function $v(t){return t.map(function(a,n){return(0,T.Z)({coordinates:a.geometry.coordinates,_id:n+1},a.properties)})}function Xv(t){if(t.length===0)throw new Error("max requires at least one data point");for(var a=t[0],n=1;n<t.length;n++)t[n]>a&&(a=t[n]);return a}function Yv(t){if(t.length===0)throw new Error("min requires at least one data point");for(var a=t[0],n=1;n<t.length;n++)t[n]<a&&(a=t[n]);return a}function Ao(t){if(t.length===0)return 0;for(var a=t[0],n=0,r,e=1;e<t.length;e++)r=a+t[e]*1,Math.abs(a)>=Math.abs(t[e])?n+=a-r+t[e]:n+=t[e]-r+a,a=r;return a+n*1}function Kv(t){if(t.length===0)throw new Error("mean requires at least one data point");return Ao(t)/t.length}var Qv={min:Yv,max:Xv,mean:Kv,sum:Ao};function qv(t){var a=Jv();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Jv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function eh(t,a){if(Array.isArray(a))return a}var th=function(t){(0,N.Z)(n,t);var a=qv(n);function n(r,e){var i;return(0,R.Z)(this,n),i=a.call(this),(0,h.Z)((0,C.Z)(i),"type","source"),(0,h.Z)((0,C.Z)(i),"inited",!1),(0,h.Z)((0,C.Z)(i),"hooks",{init:new Ve.ni}),(0,h.Z)((0,C.Z)(i),"parser",{type:"geojson"}),(0,h.Z)((0,C.Z)(i),"transforms",[]),(0,h.Z)((0,C.Z)(i),"cluster",!1),(0,h.Z)((0,C.Z)(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,h.Z)((0,C.Z)(i),"invalidExtent",!1),(0,h.Z)((0,C.Z)(i),"dataArrayChanged",!1),(0,h.Z)((0,C.Z)(i),"cfg",{}),i.originData=r,i.initCfg(e),i.init(),i}return(0,L.Z)(n,[{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var i=this,o=this.clusterOptions,u=o.method,s=u===void 0?"sum":u,l=o.field,c=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,c.forEach(function(f){f.id||(f.properties.point_count=1)}),(l||(0,P.isFunction)(s))&&(c=c.map(function(f){var p=f.id;if(p){var d=i.clusterIndex.getLeaves(p,Infinity),g=d.map(function(y){return y.properties}),m;if((0,P.isString)(s)&&l){var _=Lv(g,l);m=Qv[s](_)}(0,P.isFunction)(s)&&(m=s(g)),f.properties.stat=m}else f.properties.point_count=1;return f})),this.data=da("geojson")({type:"FeatureCollection",features:c}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var i=this.parser,o=i.type,u=o===void 0?"geojson":o,s=i.geometry;if(u==="geojson"&&!this.cluster){var l=e<this.originData.features.length?this.originData.features[e]:"null",c=(0,P.cloneDeep)(l);if(c!=null&&c.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var f=this.data.dataArray.find(function(p){return p._id===e});c.properties=f}return c}else return u==="json"&&s?this.data.dataArray.find(function(p){return p._id===e}):e<this.data.dataArray.length?this.data.dataArray[e]:"null"}},{key:"updateFeaturePropertiesById",value:function(e,i){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===e?(0,T.Z)((0,T.Z)({},o),i):o}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(e,i){var o=this.data.dataArray.find(function(u){return u[e]===i});return o==null?void 0:o._id}},{key:"setData",value:function(e,i){this.originData=e,this.dataArrayChanged=!1,this.initCfg(i),this.init()}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)===null||e===void 0||e.destroy()}},{key:"handleData",value:function(){var e=this;return new Promise(function(i,o){try{e.excuteParser(),e.initCluster(),e.executeTrans(),i({})}catch(u){o(u)}})}},{key:"initCfg",value:function(e){this.cfg=(0,P.mergeWith)(this.cfg,e,eh);var i=this.cfg;i&&(i.parser&&(this.parser=i.parser),i.transforms&&(this.transforms=i.transforms),this.cluster=i.cluster||!1,i.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,T.Z)((0,T.Z)({},this.clusterOptions),i.clusterOptions)))}},{key:"init",value:function(){var e=this;this.inited=!1,this.handleData().then(function(){e.inited=!0,e.emit("update")})}},{key:"excuteParser",value:function(){var e=this.parser,i=e.type||"geojson",o=da(i);this.data=o(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=cd(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(!!e){if(this.tileset)return this.tileset.updateOptions(e),this.tileset;var i=new tv((0,T.Z)({},e));return i}}},{key:"executeTrans",value:function(){var e=this,i=this.transforms;i.forEach(function(o){var u=o.type,s=T0(u)(e.data,o);Object.assign(e.data,s)})}},{key:"initCluster",value:function(){if(!!this.cluster){var e=this.clusterOptions||{};this.clusterIndex=bo(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var i=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(i=on(ir(this.extent),e)),i[0].concat(i[1])}}]),n}(He.EventEmitter);function nh(t,a){var n=a.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t}function To(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=rh(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function rh(t,a){if(!!t){if(typeof t=="string")return Mo(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mo(t,a)}}function Mo(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var ki=6378e3;function ih(t,a){var n=t.dataArray,r=a.size,e=r===void 0?10:r,i=e/(2*Math.PI*ki)*(256<<20)/2,o=ah(n,e),u=o.gridHash,s=o.gridOffset,l=lh(u,s,a);return{yOffset:i,xOffset:i,radius:i,type:"grid",dataArray:l}}function ah(t,a){var n=Infinity,r=-Infinity,e,i=To(t),o;try{for(i.s();!(o=i.n()).done;){var u=o.value;e=u.coordinates[1],Number.isFinite(e)&&(n=e<n?e:n,r=e>r?e:r)}}catch(E){i.e(E)}finally{i.f()}var s=(n+r)/2,l=oh(a,s);if(l.xOffset<=0||l.yOffset<=0)return{gridHash:{},gridOffset:l};var c={},f=To(t),p;try{for(f.s();!(p=f.n()).done;){var d=p.value,g=d.coordinates[1],m=d.coordinates[0];if(Number.isFinite(g)&&Number.isFinite(m)){var _=Math.floor((g+90)/l.yOffset),y=Math.floor((m+180)/l.xOffset),x="".concat(_,"-").concat(y);c[x]=c[x]||{count:0,points:[]},c[x].count+=1,c[x].points.push(d)}}}catch(E){f.e(E)}finally{f.f()}return{gridHash:c,gridOffset:l}}function oh(t,a){var n=uh(t),r=sh(a,t);return{yOffset:n,xOffset:r}}function uh(t){return t/ki*(180/Math.PI)}function sh(t,a){return a/ki*(180/Math.PI)/Math.cos(t*Math.PI/180)}function lh(t,a,n){return Object.keys(t).reduce(function(r,e,i){var o=e.split("-"),u=parseInt(o[0],10),s=parseInt(o[1],10),l={};if(n.field&&n.method){var c=ui(t[e].points,n.field);l[n.method]=oi[n.method](c)}return Object.assign(l,{_id:i,coordinates:Ne([-180+a.xOffset*(s+.5),-90+a.yOffset*(u+.5)]),rawData:t[e].points,count:t[e].count}),r.push(l),r},[])}var ch=O(43774),fh=6378e3;function ph(t,a){var n=t.dataArray,r=a.size,e=r===void 0?10:r,i=a.method,o=i===void 0?"sum":i,u=e/(2*Math.PI*fh)*(256<<20)/2,s=n.map(function(p){var d=Ne(p.coordinates),g=(0,re.Z)(d,2),m=g[0],_=g[1];return(0,T.Z)((0,T.Z)({},p),{},{coordinates:[m,_]})}),l=(0,ch.g)().radius(u).x(function(p){return p.coordinates[0]}).y(function(p){return p.coordinates[1]}),c=l(s),f={dataArray:c.map(function(p,d){var g;if(a.field&&o){var m=ui(p,a.field);p[o]=oi[o](m)}return g={},(0,h.Z)(g,a.method,p[o]),(0,h.Z)(g,"count",p.length),(0,h.Z)(g,"rawData",p),(0,h.Z)(g,"coordinates",[p.x,p.y]),(0,h.Z)(g,"_id",d),g}),radius:u,xOffset:u,yOffset:u,type:"hexagon"};return f}function dh(t,a){var n=a.sourceField,r=a.targetField,e=a.data,i={};return e.forEach(function(o){i[o[n]]=o}),t.dataArray=t.dataArray.map(function(o){var u=o[r];return(0,T.Z)((0,T.Z)({},o),i[u])}),t}function vh(t,a){var n=a.callback;return n&&(t.dataArray=t.dataArray.map(n)),t}ht("rasterTile",jv),ht("mvt",hv),ht("geojsonvt",bv),ht("testTile",Gv),ht("geojson",F0),ht("image",mo),ht("csv",L0),ht("json",ha),ht("raster",kv),ht("rasterRgb",Fv),nn("cluster",bo),nn("filter",nh),nn("join",dh),nn("map",vh),nn("grid",ih),nn("hexagon",ph);var In=th,B5=O(28660),W=O(86700),hh=O(84879),M={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},gh=O(31745),mh=O.n(gh);function Ro(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_h(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function _h(t,a){if(!!t){if(typeof t=="string")return Lo(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lo(t,a)}}function Lo(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var Bn=30;function yh(t){var a=t.characterSet,n=t.getFontWidth,r=t.fontHeight,e=t.buffer,i=t.maxCanvasWidth,o=t.mapping,u=o===void 0?{}:o,s=t.xOffset,l=s===void 0?0:s,c=t.yOffset,f=c===void 0?0:c,p=0,d=l;Array.from(a).forEach(function(m,_){if(!u[m]){var y=n(m,_);d+Bn>i&&(d=0,p++),u[m]={x:d,y:f+p*Bn,width:Bn,height:Bn,advance:y},d+=Bn}});var g=r+e*2;return{mapping:u,xOffset:d,yOffset:f+p*g,canvasHeight:ko(f+(p+1)*g)}}function xh(t,a,n){var r=0,e=0,i=0,o=[],u={},s=Ro(t),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;if(!u[c.id]){var f=c.size;r+f+a>n&&(Oo(u,o,e),r=0,e=i+e+a,i=0,o=[]),o.push({icon:c,xOffset:r}),r=r+f+a,i=Math.max(i,f)}}}catch(d){s.e(d)}finally{s.f()}o.length>0&&Oo(u,o,e);var p=ko(i+e+a);return{mapping:u,canvasHeight:p}}function Oo(t,a,n){var r=Ro(a),e;try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.icon,u=i.xOffset;t[o.id]=(0,T.Z)((0,T.Z)({},o),{},{x:u,y:n,image:o.image,width:o.width,height:o.height})}}catch(s){r.e(s)}finally{r.f()}}function ko(t){return Math.pow(2,Math.ceil(Math.log2(t)))}var Fo,Po;function Do(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Eh(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function Eh(t,a){if(!!t){if(typeof t=="string")return wo(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wo(t,a)}}function wo(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function Ch(t){var a=Sh();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Sh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var bh=Ph(),Ah="sans-serif",Th="normal",Mh=24,Rh=3,Lh=.25,Oh=8,Io=1024,kh=1,Bo=1,Fh=3,N5=null;function Ph(){for(var t=[],a=32;a<128;a++)t.push(String.fromCharCode(a));return t}function No(t,a,n,r){t.font="".concat(r," ").concat(n,"px ").concat(a),t.fillStyle="black",t.textBaseline="middle"}function Zo(t,a){for(var n=0;n<t.length;n++)a.data[4*n+3]=t[n]}var Dh=(Fo=(0,W.b2)(),Fo(Po=function(t){(0,N.Z)(n,t);var a=Ch(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"fontAtlas",void 0),(0,h.Z)((0,C.Z)(r),"iconFontMap",void 0),(0,h.Z)((0,C.Z)(r),"iconFontGlyphs",{}),(0,h.Z)((0,C.Z)(r),"fontOptions",void 0),(0,h.Z)((0,C.Z)(r),"key",void 0),(0,h.Z)((0,C.Z)(r),"cache",new yd(Fh)),r}return(0,L.Z)(n,[{key:"scale",get:function(){return Bo}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ah,fontWeight:Th,characterSet:bh,fontSize:Mh,buffer:Rh,sdf:!0,cutoff:Lh,radius:Oh,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var i=this;e.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(e,i){this.iconFontMap.set(e,i)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=(0,T.Z)((0,T.Z)({},this.fontOptions),e),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var u=this.generateFontAtlas(this.key,i,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"addFontFace",value:function(e,i){var o=this,u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(e,`';
            src: url('`).concat(i,`') format('woff2'),
            url('`).concat(i,`') format('woff'),
            url('`).concat(i,`') format('truetype');
        }`),u.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then(function(){o.emit("fontloaded",{fontFamily:e})})}catch(s){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(s)}},document.getElementsByTagName("head")[0].appendChild(u)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,i,o){var u=this.fontOptions,s=u.fontFamily,l=u.fontWeight,c=u.fontSize,f=u.buffer,p=u.sdf,d=u.radius,g=u.cutoff,m=u.iconfont,_=o&&o.data;_||(_=_e.document.createElement("canvas"),_.width=Io);var y=_.getContext("2d");No(y,s,c,l);var x=yh((0,T.Z)({getFontWidth:function(ct){return y.measureText(ct).width},fontHeight:c*Bo,buffer:f,characterSet:i,maxCanvasWidth:Io},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),E=x.mapping,b=x.canvasHeight,A=x.xOffset,F=x.yOffset,I=y.getImageData(0,0,_.width,_.height);if(_.height=b,y.putImageData(I,0,0),No(y,s,c,l),p){var k=new(mh())(c,f,d,g,s,l),w=y.getImageData(0,0,k.size,k.size),z=Do(i),$;try{for(z.s();!($=z.n()).done;){var X=$.value;if(m){var ne=String.fromCharCode(parseInt(X.replace("&#x","").replace(";",""),16)),se=k.draw(ne);Zo(se,w)}else Zo(k.draw(X),w);y.putImageData(w,E[X].x,E[X].y)}}catch(Be){z.e(Be)}finally{z.f()}}else{var Ee=Do(i),Oe;try{for(Ee.s();!(Oe=Ee.n()).done;){var Ze=Oe.value;y.fillText(Ze,E[Ze].x,E[Ze].y+c*kh)}}catch(Be){Ee.e(Be)}finally{Ee.f()}}return{xOffset:A,yOffset:F,mapping:E,data:_,width:_.width,height:_.height}}},{key:"getKey",value:function(){return"key";var e,i,o,u,s,l,c,f}},{key:"getNewChars",value:function(e,i){var o=this.cache.get(e);if(!o)return i;var u=[],s=o.mapping,l=new Set(Object.keys(s)),c=new Set(i);return c.forEach(function(f){l.has(f)||u.push(f)}),u}}]),n}(He.EventEmitter))||Po),zo,Uo;function wh(t){var a=Ih();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Ih(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Bh=3,jo=1024,Nn=64,Nh=(zo=(0,W.b2)(),zo(Uo=function(t){(0,N.Z)(n,t);var a=wh(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"canvasHeight",128),(0,h.Z)((0,C.Z)(r),"texture",void 0),(0,h.Z)((0,C.Z)(r),"canvas",void 0),(0,h.Z)((0,C.Z)(r),"iconData",void 0),(0,h.Z)((0,C.Z)(r),"iconMap",void 0),(0,h.Z)((0,C.Z)(r),"ctx",void 0),(0,h.Z)((0,C.Z)(r),"loadingImageCount",0),r}return(0,L.Z)(n,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=_e.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(e,i){var o=this,u=new Image;if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:Nn}),this.updateIconMap(),this.loadImage(i).then(function(s){u=s;var l=o.iconData.find(function(c){return c.id===e});l&&(l.image=u,l.width=u.width,l.height=u.height),o.update()})}},{key:"addImageMini",value:function(e,i,o){var u=this,s=o.getSceneConfig().canvas,l=s.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:Nn}),this.updateIconMap(),this.loadImageMini(i,s).then(function(c){l=c;var f=u.iconData.find(function(p){return p.id===e});f&&(f.image=l,f.width=l.width,f.height=l.height),u.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter(function(i){return i.id!==e}),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise(function(i,o){if(e instanceof HTMLImageElement){i(e);return}var u=new Image;u.crossOrigin="anonymous",u.onload=function(){i(u)},u.onerror=function(){o(new Error("Could not load image at "+e))},u.src=e instanceof File?URL.createObjectURL(e):e})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=jo,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(i){var o=e.iconMap[i],u=o.x,s=o.y,l=o.image,c=o.width,f=c===void 0?64:c,p=o.height,d=p===void 0?64:p,g=Math.max(f,d),m=g/Nn,_=d/m,y=f/m;l&&e.ctx.drawImage(l,u+(Nn-y)/2,s+(Nn-_)/2,y,_)})}},{key:"updateIconMap",value:function(){var e=xh(this.iconData,Bh,jo),i=e.mapping,o=e.canvasHeight;this.iconMap=i,this.canvasHeight=o}},{key:"loadImageMini",value:function(e,i){return new Promise(function(o,u){var s=i.createImage();s.crossOrigin="anonymous",s.onload=function(){o(s)},s.onerror=function(){u(new Error("Could not load image at "+e))},s.src=e})}}]),n}(He.EventEmitter))||Uo),Re=O(85975),Ho,Vo,Zh=(Ho=(0,W.b2)(),Ho(Vo=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"viewport",void 0),(0,h.Z)(this,"overridedViewProjectionMatrix",void 0),(0,h.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,h.Z)(this,"jitteredProjectionMatrix",void 0),(0,h.Z)(this,"viewMatrixInverse",void 0),(0,h.Z)(this,"cameraPosition",void 0)}return(0,L.Z)(t,[{key:"init",value:function(){}},{key:"update",value:function(n){this.viewport=n,this.viewMatrixInverse=Re.create(),Re.invert(this.viewMatrixInverse,n.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var n=this.viewport.getCenter(),r=(0,re.Z)(n,2),e=r[0],i=r[1];return[e,i]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(n,r){return this.viewport.projectFlat(n,r)}},{key:"setViewProjectionMatrix",value:function(n){this.overridedViewProjectionMatrix=n}},{key:"jitterProjectionMatrix",value:function(n,r){var e=Re.fromTranslation(Re.create(),[n,r,0]);this.jitteredProjectionMatrix=Re.multiply(Re.create(),e,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Re.multiply(Re.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||Vo),Ct;(function(t){t.TOPRIGHT="topright",t.TOPLEFT="topleft",t.BOTTOMRIGHT="bottomright",t.BOTTOMLEFT="bottomleft",t.TOPCENTER="topcenter",t.BOTTOMCENTER="bottomcenter",t.LEFTCENTER="leftcenter",t.RIGHTCENTER="rightcenter",t.LEFTTOP="lefttop",t.RIGHTTOP="righttop",t.LEFTBOTTOM="leftbottom",t.RIGHTBOTTOM="rightbottom"})(Ct||(Ct={}));var Go,Wo;function zh(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Uh(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function Uh(t,a){if(!!t){if(typeof t=="string")return $o(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $o(t,a)}}function $o(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var jh={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Hh=(Go=(0,W.b2)(),Go(Wo=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"container",void 0),(0,h.Z)(this,"controlCorners",void 0),(0,h.Z)(this,"controlContainer",void 0),(0,h.Z)(this,"scene",void 0),(0,h.Z)(this,"mapsService",void 0),(0,h.Z)(this,"controls",[]),(0,h.Z)(this,"unAddControls",[])}return(0,L.Z)(t,[{key:"init",value:function(n,r){this.container=n.container,this.scene=r,this.mapsService=r.get(M.IMapService),this.initControlPos()}},{key:"addControl",value:function(n,r){var e=r.get(M.IMapService);e.map?(n.addTo(this.scene),this.controls.push(n)):this.unAddControls.push(n)}},{key:"getControlByName",value:function(n){return this.controls.find(function(r){return r.controlOption.name===n})}},{key:"removeControl",value:function(n){var r=this.controls.indexOf(n);return r>-1&&this.controls.splice(r,1),n.remove(),this}},{key:"addControls",value:function(){var n=this;this.unAddControls.forEach(function(r){r.addTo(n.scene),n.controls.push(r)}),this.unAddControls=[]}},{key:"destroy",value:function(){var n=zh(this.controls),r;try{for(n.s();!(r=n.n()).done;){var e=r.value;e.remove()}}catch(i){n.e(i)}finally{n.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var n=this.controlCorners={},r="l7-",e=this.controlContainer=le("div",r+"control-container",this.container);function i(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=u.map(function(l){return r+l}).join(" ");n[u.filter(function(l){return!["row","column"].includes(l)}).join("")]=le("div",s,e)}function o(u){var s=u.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,G.Z)(s),[jh[u]])}Object.values(Ct).forEach(function(u){i(o(u))})}},{key:"clearControlPos",value:function(){for(var n in this.controlCorners)this.controlCorners[n]&&at(this.controlCorners[n]);this.controlContainer&&at(this.controlContainer)}}]),t}())||Wo),Xo,Yo,Vh=(Xo=(0,W.b2)(),Xo(Yo=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"container",void 0),(0,h.Z)(this,"scene",void 0),(0,h.Z)(this,"mapsService",void 0),(0,h.Z)(this,"markers",[]),(0,h.Z)(this,"markerLayers",[]),(0,h.Z)(this,"unAddMarkers",[]),(0,h.Z)(this,"unAddMarkerLayers",[])}return(0,L.Z)(t,[{key:"addMarkerLayer",value:function(n){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(n),n.addTo(this.scene)):this.unAddMarkerLayers.push(n)}},{key:"removeMarkerLayer",value:function(n){n.destroy(),this.markerLayers.indexOf(n);var r=this.markerLayers.indexOf(n);r>-1&&this.markerLayers.splice(r,1)}},{key:"addMarker",value:function(n){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(n),n.addTo(this.scene)):this.unAddMarkers.push(n)}},{key:"addMarkers",value:function(){var n=this;this.unAddMarkers.forEach(function(r){r.addTo(n.scene),n.markers.push(r)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var n=this;this.unAddMarkerLayers.forEach(function(r){n.markerLayers.push(r),r.addTo(n.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(n){n.remove(),this.markers.indexOf(n);var r=this.markers.indexOf(n);r>-1&&this.markers.splice(r,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(n){this.scene=n,this.mapsService=n.get(M.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(n){n.remove()}),this.markers=[],this.markerLayers.forEach(function(n){n.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(n){n.destroy()}}]),t}())||Yo),Ko,Qo,Gh=(Ko=(0,W.b2)(),Ko(Qo=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"scene",void 0),(0,h.Z)(this,"mapsService",void 0),(0,h.Z)(this,"popups",[]),(0,h.Z)(this,"unAddPopups",[])}return(0,L.Z)(t,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(n){n.isOpen()&&n.remove();var r=this.popups.indexOf(n);r>-1&&this.popups.splice(r,1);var e=this.unAddPopups.indexOf(n);e>-1&&this.unAddPopups.splice(e,1)}},{key:"destroy",value:function(){this.popups.forEach(function(n){return n.remove()})}},{key:"addPopup",value:function(n){var r=this;n&&n.getOptions().autoClose&&[].concat((0,G.Z)(this.popups),(0,G.Z)(this.unAddPopups)).forEach(function(e){e.getOptions().autoClose&&r.removePopup(e)}),this.isMarkerReady?(n.addTo(this.scene),this.popups.push(n)):this.unAddPopups.push(n),n.on("close",function(){r.removePopup(n)})}},{key:"initPopup",value:function(){var n=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(r){n.addPopup(r),n.unAddPopups=[]})}},{key:"init",value:function(n){this.scene=n,this.mapsService=n.get(M.IMapService)}}]),t}())||Qo),Wh={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},$h=Wh,qo,Jo,Xh={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Yh={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Kh=(qo=(0,W.b2)(),qo(Jo=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"sceneConfigCache",{}),(0,h.Z)(this,"layerConfigCache",{})}return(0,L.Z)(t,[{key:"getSceneConfig",value:function(n){return this.sceneConfigCache[n]}},{key:"getSceneWarninfo",value:function(n){return $h[n]}},{key:"setSceneConfig",value:function(n,r){this.sceneConfigCache[n]=(0,T.Z)((0,T.Z)({},Xh),r)}},{key:"getLayerConfig",value:function(n){return this.layerConfigCache[n]}},{key:"setLayerConfig",value:function(n,r,e){this.layerConfigCache[r]=(0,T.Z)({},(0,P.merge)({},this.sceneConfigCache[n],Yh,e))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||Jo),ae=O(55770),ie=O(3473),dr=O(98333),Fi=Math.PI/180,Qh=512,eu=4003e4;function tu(t){var a=t.latitude,n=a===void 0?0:a,r=t.zoom,e=r===void 0?0:r,i=t.scale,o=t.highPrecision,u=o===void 0?!1:o,s=t.flipY,l=s===void 0?!1:s;i=i!==void 0?i:Math.pow(2,e);var c={},f=Qh*i,p=Math.cos(n*Fi),d=f/360,g=d/p,m=f/eu/p;if(c.pixelsPerMeter=[m,-m,m],c.metersPerPixel=[1/m,-1/m,1/m],c.pixelsPerDegree=[d,-g,m],c.degreesPerPixel=[1/d,-1/g,1/m],u){var _=Fi*Math.tan(n*Fi)/p,y=d*_/2,x=f/eu*_,E=x/g*m;c.pixelsPerDegree2=[0,-y,x],c.pixelsPerMeter2=[E,0,E],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var wt;(function(t){t[t.LNGLAT=1]="LNGLAT",t[t.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",t[t.VECTOR_TILE=3]="VECTOR_TILE",t[t.IDENTITY=4]="IDENTITY",t[t.P20=5]="P20",t[t.P20_OFFSET=6]="P20_OFFSET",t[t.METER_OFFSET=7]="METER_OFFSET",t[t.P20_2=8]="P20_2"})(wt||(wt={}));var Wt={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},nu,ru,iu,Pi,au,qh=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Jh=(nu=(0,W.b2)(),ru=(0,W.f3)(M.ICameraService),nu(iu=(Pi=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"needRefresh",!0),(0,ae.Z)(this,"cameraService",au,this),(0,h.Z)(this,"coordinateSystem",void 0),(0,h.Z)(this,"viewportCenter",void 0),(0,h.Z)(this,"viewportCenterProjection",void 0),(0,h.Z)(this,"pixelsPerDegree",void 0),(0,h.Z)(this,"pixelsPerDegree2",void 0),(0,h.Z)(this,"pixelsPerMeter",void 0)}return(0,L.Z)(t,[{key:"refresh",value:function(n){var r=this.cameraService.getZoom(),e=this.cameraService.getZoomScale(),i=n||this.cameraService.getCenter(),o=tu({latitude:i[1],zoom:r}),u=o.pixelsPerMeter,s=o.pixelsPerDegree;this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=u,this.pixelsPerDegree=s,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===wt.LNGLAT||this.coordinateSystem===wt.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===wt.LNGLAT_OFFSET?this.calculateLnglatOffset(i,r):this.coordinateSystem===wt.P20_OFFSET&&this.calculateLnglatOffset(i,r,e,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(n){this.coordinateSystem=n}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(n,r,e,i){var o=tu({latitude:n[1],zoom:r,scale:e,flipY:i,highPrecision:!0}),u=o.pixelsPerMeter,s=o.pixelsPerDegree,l=o.pixelsPerDegree2,c=this.cameraService.getViewMatrix(),f=this.cameraService.getProjectionMatrix(),p=Re.multiply([],f,c),d=this.cameraService.projectFlat([Math.fround(n[0]),Math.fround(n[1])],Math.pow(2,r));this.viewportCenterProjection=dr.fF([],[d[0],d[1],0,1],p),c=this.cameraService.getViewMatrixUncentered()||c,p=Re.multiply([],f,c),p=Re.multiply([],p,qh),this.cameraService.setViewProjectionMatrix(p),this.pixelsPerMeter=u,this.pixelsPerDegree=s,this.pixelsPerDegree2=l}}]),t}(),au=(0,ie.Z)(Pi.prototype,"cameraService",[ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi))||iu),eg=O(20396),Zn=O.n(eg),ze;(function(t){t.Hover="hover",t.Click="click",t.Select="select",t.Active="active",t.Drag="drag"})(ze||(ze={}));var ou,uu,su,Di,lu;function tg(t){var a=ng();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ng(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var rg={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},ig=(ou=(0,W.b2)(),uu=(0,W.f3)(M.IMapService),ou(su=(Di=function(t){(0,N.Z)(n,t);var a=tg(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"indragging",!1),(0,ae.Z)((0,C.Z)(r),"mapService",lu,(0,C.Z)(r)),(0,h.Z)((0,C.Z)(r),"hammertime",void 0),(0,h.Z)((0,C.Z)(r),"lastClickTime",0),(0,h.Z)((0,C.Z)(r),"lastClickXY",[-1,-1]),(0,h.Z)((0,C.Z)(r),"clickTimer",void 0),(0,h.Z)((0,C.Z)(r),"$containter",void 0),(0,h.Z)((0,C.Z)(r),"onDrag",function(u){var s=r.interactionEvent(u);s.type=rg[s.type],s.type==="dragging"?r.indragging=!0:r.indragging=!1,r.emit(ze.Drag,s)}),(0,h.Z)((0,C.Z)(r),"onHammer",function(u){u.srcEvent.stopPropagation();var s=r.interactionEvent(u);r.emit(ze.Hover,s)}),(0,h.Z)((0,C.Z)(r),"onTouch",function(u){var s=u.touches[0];r.onHover({x:s.pageX,y:s.pageY,type:"touch"})}),(0,h.Z)((0,C.Z)(r),"onHover",function(u){var s=u.clientX,l=u.clientY,c=s,f=l,p=u.type,d=r.mapService.getMapContainer();if(d)if(Qe)c=c-d.left-0,f=f-d.top-0;else{var g=d.getBoundingClientRect(),m=g.top,_=g.left;c=c-_-d.clientLeft,f=f-m-d.clientTop}var y=r.mapService.containerToLngLat([c,f]);if(p==="click"){if(!Qe&&"ontouchstart"in document.documentElement)return;r.isDoubleTap(c,f,y);return}if(p==="touch"){r.isDoubleTap(c,f,y);return}p!=="click"&&p!=="dblclick"&&r.emit(ze.Hover,{x:c,y:f,lngLat:y,type:p,target:u})}),r}return(0,L.Z)(n,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ze.Hover)}},{key:"triggerHover",value:function(e){var i=e.x,o=e.y;this.emit(ze.Hover,{x:i,y:o})}},{key:"triggerSelect",value:function(e){this.emit(ze.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(ze.Active,{featureId:e})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e)if(Qe)_e.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=new(Zn()).Manager(e);i.add(new(Zn()).Tap({event:"dblclick",taps:2})),i.add(new(Zn()).Tap({event:"click"})),i.add(new(Zn()).Pan({threshold:0,pointers:0})),i.add(new(Zn()).Press({})),i.on("dblclick click",this.onHammer),i.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=i}}},{key:"removeEventListenerOnMap",value:function(){if(Qe)_e.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(e){var i=e.type,o=e.pointerType,u,s;o==="touch"?(s=Math.floor(e.pointers[0].clientY),u=Math.floor(e.pointers[0].clientX)):(s=Math.floor(e.srcEvent.y),u=Math.floor(e.srcEvent.x));var l=this.mapService.getMapContainer();if(l){var c=l.getBoundingClientRect(),f=c.top,p=c.left;u-=p,s-=f}var d=this.mapService.containerToLngLat([u,s]);return{x:u,y:s,lngLat:d,type:i,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,i,o){var u=this,s=new Date().getTime(),l="click";s-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-i)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),l="dblclick",this.emit(ze.Hover,{x:e,y:i,lngLat:o,type:l})):(this.lastClickTime=s,this.lastClickXY=[e,i],this.clickTimer=setTimeout(function(){l="click",u.emit(ze.Hover,{x:e,y:i,lngLat:o,type:l})},400))}}]),n}(cr()),lu=(0,ie.Z)(Di.prototype,"mapService",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di))||su),ag=0;function og(t){if(Qe)return null;var a=t;if(typeof t=="string"&&(a=document.getElementById(t)),a){var n=document.createElement("div");return n.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,n.id="l7-scene-".concat(ag++),n.classList.add("l7-scene"),a.appendChild(n),n}return null}function ug(t){var a,n,r=!0;return t==null||(a=t.target)===null||a===void 0||(n=a.path)===null||n===void 0||n.map(function(e){if(e!=null&&e.classList){var i;e==null||(i=e.classList)===null||i===void 0||i.forEach(function(o){(o==="l7-marker"||o==="l7-popup")&&(r=!1)})}}),r}var v;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(v||(v={}));var cu,fu,pu,du,vu,hu,gu,$t,mu,_u,yu,xu,Eu,sg=(cu=(0,W.b2)(),fu=(0,W.f3)(M.IMapService),pu=(0,W.f3)(M.IRendererService),du=(0,W.f3)(M.IGlobalConfigService),vu=(0,W.f3)(M.IInteractionService),hu=(0,W.f3)(M.ILayerService),cu(gu=($t=function(){function t(){var a=this;(0,R.Z)(this,t),(0,h.Z)(this,"pickedColors",void 0),(0,h.Z)(this,"pickedTileLayers",[]),(0,ae.Z)(this,"mapService",mu,this),(0,ae.Z)(this,"rendererService",_u,this),(0,ae.Z)(this,"configService",yu,this),(0,ae.Z)(this,"interactionService",xu,this),(0,ae.Z)(this,"layerService",Eu,this),(0,h.Z)(this,"pickingFBO",void 0),(0,h.Z)(this,"width",0),(0,h.Z)(this,"height",0),(0,h.Z)(this,"alreadyInPicking",!1),(0,h.Z)(this,"pickBufferScale",1),(0,h.Z)(this,"pickFromPickingFBO",function(n,r){var e=r.x,i=r.y,o=r.lngLat,u=r.type,s=r.target,l=!1,c=a.rendererService,f=c.readPixels,p=c.getContainer,d=a.getContainerSize(p()),g=d.width,m=d.height;g*=Fe,m*=Fe;var _=n.getLayerConfig(),y=_.enableHighlight,x=_.enableSelect,E=e*Fe,b=i*Fe;if(E>g-1*Fe||E<0||b>m-1*Fe||b<0)return!1;var A=f({x:Math.floor(E/a.pickBufferScale),y:Math.floor((m-(i+1)*Fe)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=A,A[0]!==0||A[1]!==0||A[2]!==0){var F=Lt(A),I=n.getSource().getFeatureById(F);F!==n.getCurrentPickId()&&u==="mousemove"&&(u="mouseenter");var k={x:e,y:i,type:u,lngLat:o,featureId:F,feature:I,target:s};I&&(l=!0,n.setCurrentPickId(F),a.triggerHoverOnLayer(n,k))}else{var w={x:e,y:i,lngLat:o,type:n.getCurrentPickId()!==null&&u==="mousemove"?"mouseout":"un"+u,featureId:null,target:s,feature:null};a.triggerHoverOnLayer(n,(0,T.Z)((0,T.Z)({},w),{},{type:"unpick"})),a.triggerHoverOnLayer(n,w),n.setCurrentPickId(null)}if(y&&a.highlightPickedFeature(n,A),x&&u==="click"&&(A==null?void 0:A.toString())!==[0,0,0,0].toString()){var z=Lt(A);n.getCurrentSelectedId()===null||z!==n.getCurrentSelectedId()?(a.selectFeature(n,A),n.setCurrentSelectedId(z)):(a.selectFeature(n,new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null)),n.isVector||a.layerService.getLayers().filter(function($){return $.tileLayer}).map(function($){$.tileLayer.clearPickState()})}return l})}return(0,L.Z)(t,[{key:"init",value:function(n){var r=this.rendererService,e=r.createTexture2D,i=r.createFramebuffer,o=r.getContainer,u=this.getContainerSize(o()),s=u.width,l=u.height;s*=Fe,l*=Fe,this.pickBufferScale=this.configService.getSceneConfig(n).pickBufferScale||1,this.pickingFBO=i({color:e({width:Math.round(s/this.pickBufferScale),height:Math.round(l/this.pickBufferScale),wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.interactionService.on(ze.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,te.Z)(H().mark(function r(e,i,o){var u=this,s,l,c;return H().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:s=this.rendererService,l=s.useFramebuffer,c=s.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){c({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(),e.hooks.afterPickingEncode.call();var d=u.pickBox(e,i);o(d)});case 3:case"end":return p.stop()}},r,this)}));function n(r,e,i){return a.apply(this,arguments)}return n}()},{key:"pickBox",value:function(n,r){var e=this,i=r.map(function(z){var $=z<0?0:z;return Math.floor($*Fe/e.pickBufferScale)}),o=(0,re.Z)(i,4),u=o[0],s=o[1],l=o[2],c=o[3],f=this.rendererService,p=f.readPixels,d=f.getContainer,g=this.getContainerSize(d()),m=g.width,_=g.height;if(m*=Fe,_*=Fe,u>(m-1)*Fe/this.pickBufferScale||l<0||s>(_-1)*Fe/this.pickBufferScale||c<0)return[];for(var y=Math.min(m/this.pickBufferScale,l)-u,x=Math.min(_/this.pickBufferScale,c)-s,E=p({x:u,y:Math.floor(_/this.pickBufferScale-(c+1)),width:y,height:x,data:new Uint8Array(y*x*4),framebuffer:this.pickingFBO}),b=[],A={},F=0;F<E.length/4;F=F+1){var I=E.slice(F*4,F*4+4),k=Lt(I);if(k!==-1&&!A[k]){var w=n.getSource().getFeatureById(k);b.push((0,T.Z)((0,T.Z)({},w),{},{pickedFeatureIdx:k})),A[k]=!0}}return b}},{key:"handleCursor",value:function(n,r){var e=n.getLayerConfig(),i=e.cursor,o=i===void 0?"":i,u=e.cursorEnabled;if(u){var s=this.mapService.version,l=s==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),c=l==null?void 0:l.style.getPropertyValue("cursor");r==="unmousemove"&&c!==""?l==null||l.style.setProperty("cursor",""):r==="mousemove"&&(l==null||l.style.setProperty("cursor",o))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(n){return n.getContext?{width:n.width/Fe,height:n.height/Fe}:n.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,te.Z)(H().mark(function r(e){return H().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.isPickingAllLayer()){o.next=2;break}return o.abrupt("return");case 2:return this.alreadyInPicking=!0,o.next=5,this.pickingLayers(e);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return o.stop()}},r,this)}));function n(r){return a.apply(this,arguments)}return n}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var n=this.rendererService.getContainer,r=this.getContainerSize(n()),e=r.width,i=r.height;e*=Fe,i*=Fe,(this.width!==e||this.height!==i)&&(this.pickingFBO.resize({width:Math.round(e/this.pickBufferScale),height:Math.round(i/this.pickBufferScale)}),this.width=e,this.height=i)}},{key:"pickingLayers",value:function(){var a=(0,te.Z)(H().mark(function r(e){var i=this,o,u,s;return H().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=this.rendererService,u=o.useFramebuffer,s=o.clear,this.resizePickingFBO(),u(this.pickingFBO,function(){var f=i.layerService.getRenderList();f.filter(function(p){return p.needPick(e.type)}).reverse().some(function(p){if(s({framebuffer:i.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.pickedTileLayers.map(function(g){var m;return(m=g.tileLayer)===null||m===void 0?void 0:m.clearPick(e.type)}),p.tileLayer&&p.tileLayer.pickLayers)return p.tileLayer.pickLayers(e);p.hooks.beforePickingEncode.call(),p.masks.length>0&&p.masks.map(function(g){g.hooks.beforeRenderData.call(),g.hooks.beforeRender.call(),g.render(),g.hooks.afterRender.call()}),p.renderModels(!0),p.hooks.afterPickingEncode.call();var d=i.pickFromPickingFBO(p,e);return i.layerService.pickedLayerId=d?+p.id:-1,d&&!p.getLayerConfig().enablePropagation})});case 3:case"end":return c.stop()}},r,this)}));function n(r){return a.apply(this,arguments)}return n}()},{key:"triggerHoverOnLayer",value:function(n,r){ug(r)&&(this.handleCursor(n,r.type),n.emit(r.type,r))}},{key:"highlightPickedFeature",value:function(n,r){var e=(0,re.Z)(r,3),i=e[0],o=e[1],u=e[2];n.hooks.beforeHighlight.call([i,o,u])}},{key:"selectFeature",value:function(n,r){var e=(0,re.Z)(r,3),i=e[0],o=e[1],u=e[2];n.hooks.beforeSelect.call([i,o,u])}}]),t}(),mu=(0,ie.Z)($t.prototype,"mapService",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_u=(0,ie.Z)($t.prototype,"rendererService",[pu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yu=(0,ie.Z)($t.prototype,"configService",[du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xu=(0,ie.Z)($t.prototype,"interactionService",[vu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eu=(0,ie.Z)($t.prototype,"layerService",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$t))||gu),lg=function(){function t(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,R.Z)(this,t),(0,h.Z)(this,"autoStart",void 0),(0,h.Z)(this,"startTime",0),(0,h.Z)(this,"oldTime",0),(0,h.Z)(this,"running",!1),(0,h.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,L.Z)(t,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var r=(typeof performance=="undefined"?Date:performance).now();n=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=n}return n}}]),t}(),Cu,Su,bu,Au,vr,Tu,Mu;function cg(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=fg(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function fg(t,a){if(!!t){if(typeof t=="string")return Ru(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ru(t,a)}}function Ru(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function pg(t){var a=dg();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function dg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var vg=(Cu=(0,W.b2)(),Su=(0,W.f3)(M.IRendererService),bu=(0,W.f3)(M.IMapService),Cu(Au=(vr=function(t){(0,N.Z)(n,t);var a=pg(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"pickedLayerId",-1),(0,h.Z)((0,C.Z)(r),"clock",new lg),(0,h.Z)((0,C.Z)(r),"alreadyInRendering",!1),(0,h.Z)((0,C.Z)(r),"layers",[]),(0,h.Z)((0,C.Z)(r),"layerList",[]),(0,h.Z)((0,C.Z)(r),"layerRenderID",void 0),(0,h.Z)((0,C.Z)(r),"sceneInited",!1),(0,h.Z)((0,C.Z)(r),"animateInstanceCount",0),(0,h.Z)((0,C.Z)(r),"shaderPicking",!0),(0,h.Z)((0,C.Z)(r),"enableRender",!0),(0,ae.Z)((0,C.Z)(r),"renderService",Tu,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"mapService",Mu,(0,C.Z)(r)),(0,h.Z)((0,C.Z)(r),"reRender",(0,P.throttle)(function(){r.updateLayerRenderList(),r.renderLayers()},32)),(0,h.Z)((0,C.Z)(r),"throttleRenderLayers",(0,P.throttle)(function(){r.renderLayers()},16)),r}return(0,L.Z)(n,[{key:"add",value:function(e){this.sceneInited&&e.init(),this.layers.push(e),this.updateLayerRenderList(),this.emit("layerChange",this.layers)}},{key:"addMask",value:function(e){this.sceneInited&&e.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(e){e.inited||e.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find(function(i){return i.id===e})}},{key:"getLayerByName",value:function(e){return this.layers.find(function(i){return i.name===e})}},{key:"cleanRemove",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,o=this.layers.indexOf(e);o>-1&&this.layers.splice(o,1),i&&this.throttleRenderLayers()}},{key:"remove",value:function(e,i){if(i){var o=i.layerChildren.indexOf(e);o>-1&&i.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(e);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),e.destroy(),this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:function(){var r=(0,te.Z)(H().mark(function i(){var o,u,s;return H().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){c.next=2;break}return c.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),o=cg(this.layerList),c.prev=5,o.s();case 7:if((u=o.n()).done){c.next=21;break}if(s=u.value,s.hooks.beforeRenderData.call(),s.hooks.beforeRender.call(),s.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),s.masks.map(function(f){f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),f.render(),f.hooks.afterRender.call()})),!s.getLayerConfig().enableMultiPassRenderer){c.next=17;break}return c.next=15,s.renderMultiPass();case 15:c.next=18;break;case 17:s.render();case 18:s.hooks.afterRender.call();case 19:c.next=7;break;case 21:c.next=26;break;case 23:c.prev=23,c.t0=c.catch(5),o.e(c.t0);case 26:return c.prev=26,o.f(),c.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return c.stop()}},i,this,[[5,23,26,29]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).sort(function(i,o){return i.zIndex-o.zIndex}).forEach(function(i){e.layerList.push(i)})}},{key:"destroy",value:function(){this.layers.forEach(function(e){e.destroy()}),this.layers=[],this.layerList=[],this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=oe(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=_e.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){_e.cancelAnimationFrame(this.layerRenderID)}}]),n}(He.EventEmitter),Tu=(0,ie.Z)(vr.prototype,"renderService",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu=(0,ie.Z)(vr.prototype,"mapService",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vr))||Au),It=O(81253),hg=function(){function t(a){var n=this;(0,R.Z)(this,t),(0,h.Z)(this,"name",void 0),(0,h.Z)(this,"type",void 0),(0,h.Z)(this,"scale",void 0),(0,h.Z)(this,"descriptor",void 0),(0,h.Z)(this,"featureBufferLayout",[]),(0,h.Z)(this,"needRescale",!1),(0,h.Z)(this,"needRemapping",!1),(0,h.Z)(this,"needRegenerateVertices",!1),(0,h.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,h.Z)(this,"vertexAttribute",void 0),(0,h.Z)(this,"defaultCallback",function(r){if(r.length===0){var e;return((e=n.scale)===null||e===void 0?void 0:e.defaultValues)||[]}return r.map(function(i,o){var u,s=(u=n.scale)===null||u===void 0?void 0:u.scalers[o].func,l=s(i);return l})}),this.setProps(a)}return(0,L.Z)(t,[{key:"setProps",value:function(n){Object.assign(this,n)}},{key:"mapping",value:function(n){var r;if((r=this.scale)!==null&&r!==void 0&&r.callback){var e,i=(e=this.scale)===null||e===void 0?void 0:e.callback.apply(e,(0,G.Z)(n));if(!(0,P.isNil)(i))return[i]}return this.defaultCallback(n)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),gg=["modelType"],mg=["buffer","update","name"],_g=["buffer","update","name"],yg=["buffer","update","name"],zn,Lu,Ou,ku,wi,Fu,xg=(zn={},(0,h.Z)(zn,v.FLOAT,4),(0,h.Z)(zn,v.UNSIGNED_BYTE,1),(0,h.Z)(zn,v.UNSIGNED_SHORT,2),zn),Eg=(Lu=(0,W.b2)(),Ou=(0,W.f3)(M.IRendererService),Lu(ku=(wi=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"attributesAndIndices",void 0),(0,ae.Z)(this,"rendererService",Fu,this),(0,h.Z)(this,"attributes",[]),(0,h.Z)(this,"triangulation",void 0),(0,h.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,L.Z)(t,[{key:"registerStyleAttribute",value:function(n){var r=this.getLayerStyleAttribute(n.name||"");return r?r.setProps(n):(r=new hg(n),this.attributes.push(r)),r}},{key:"updateStyleAttribute",value:function(n,r,e){var i=this.getLayerStyleAttribute(n);i||(i=this.registerStyleAttribute((0,T.Z)((0,T.Z)({},r),{},{name:n})));var o=r.scale;o&&i&&(i.scale=o,i.needRescale=!0,i.needRemapping=!0,i.needRegenerateVertices=!0,e&&e.featureRange&&(i.featureRange=e.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(n){return this.attributes.find(function(r){return r.name===n})}},{key:"getLayerAttributeScale",value:function(n){var r,e=this.getLayerStyleAttribute(n),i=e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers;return i&&i[0]?i[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(n,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,u=this.attributes.find(function(A){return A.name===n});if(u&&u.descriptor){var s=u.descriptor,l=s.update,c=s.buffer,f=s.size,p=f===void 0?0:f,d=xg[c.type||v.FLOAT];if(l){var g=this.featureLayout,m=g.elements,_=g.sizePerElement,y=m.slice(e,i);if(!y.length)return;var x=y[0].offset,E=x*p*d,b=y.map(function(A,F){for(var I=A.featureIdx,k=A.vertices,w=A.normals,z=k.length/_,$=[],X=0;X<z;X++){var ne=w?w.slice(X*3,X*3+3):[];$.push.apply($,(0,G.Z)(l(r[I],I,k.slice(X*_,X*_+_),F,ne)))}return $}).reduce(function(A,F){return A.push.apply(A,(0,G.Z)(F)),A},[]);u.vertexAttribute.updateBuffer({data:b,offset:E}),o==null||o.emit("legend:".concat(n),{type:n,attr:u})}}}},{key:"createAttributesAndIndicesAscy",value:function(n,r,e){var i=this;this.featureLayout={sizePerElement:0,elements:[]};var o=this.attributes.map(function(g){return g.resetDescriptor(),g.descriptor}).filter(function(g){return g}),u=e.modelType,s=(0,It.Z)(e,gg),l=this.rendererService,c=l.createAttribute,f=l.createBuffer,p=l.createElements,d={};return new Promise(function(g,m){Dd(u,(0,T.Z)({descriptors:i.getDescriptorsWithOutFunc(o),features:n,segmentNumber:r},s)).then(function(_){_.descriptors.forEach(function(x,E){if(x){var b=x.buffer,A=x.update,F=x.name,I=(0,It.Z)(x,mg),k=c((0,T.Z)({buffer:f(b)},I));d[x.name||""]=k,i.attributes[E].vertexAttribute=k}}),i.featureLayout=_.featureLayout;var y=p({data:_.indices,type:v.UNSIGNED_INT,count:_.indices.length});i.attributesAndIndices={attributes:d,elements:y,count:null},g(i.attributesAndIndices)}).catch(function(_){console.warn(_),m(_)})})}},{key:"createAttributesAndIndices",value:function(n,r,e){var i=this;this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);var o=this.attributes.map(function(E){return E.resetDescriptor(),E.descriptor}),u=0,s=0,l=[],c=[],f=[],p=3;n.forEach(function(E,b){var A=i.triangulation(E,e),F=A.indices,I=A.vertices,k=A.normals,w=A.size,z=A.indexes,$=A.count;typeof $=="number"&&(s+=$),F.forEach(function(Ee){c.push(Ee+u)}),p=w;var X=I.length/w;i.featureLayout.sizePerElement=p,i.featureLayout.elements.push({featureIdx:b,vertices:I,normals:k,offset:u}),u+=X;for(var ne=function(Oe){var Ze=(k==null?void 0:k.slice(Oe*3,Oe*3+3))||[],Be=I.slice(Oe*w,Oe*w+w),ct=0;z&&z[Oe]!==void 0&&(ct=z[Oe]),o.forEach(function(Xe,Cn){if(Xe&&Xe.update){var Sn;(Sn=Xe.buffer.data).push.apply(Sn,(0,G.Z)(Xe.update(E,b,Be,Oe,Ze,ct)))}})},se=0;se<X;se++)ne(se)});var d=this.rendererService,g=d.createAttribute,m=d.createBuffer,_=d.createElements,y={};o.forEach(function(E,b){if(E){var A=E.buffer,F=E.update,I=E.name,k=(0,It.Z)(E,_g),w=g((0,T.Z)({buffer:m(A)},k));y[E.name||""]=w,i.attributes[b].vertexAttribute=w}});var x=_({data:c,type:v.UNSIGNED_INT,count:c.length});return this.attributesAndIndices={attributes:y,elements:x,count:s},this.attributesAndIndices}},{key:"createAttributes",value:function(n,r){var e=this;this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);var i=this.attributes.map(function(d){return d.resetDescriptor(),d.descriptor}),o=0,u=[],s=3;n.forEach(function(d,g){var m=e.triangulation(d),_=m.indices,y=m.vertices,x=m.normals,E=m.size,b=m.indexes;_.forEach(function(k){u.push(k+o)}),s=E;var A=y.length/E;e.featureLayout.sizePerElement=s,e.featureLayout.elements.push({featureIdx:g,vertices:y,normals:x,offset:o}),o+=A;for(var F=function(w){var z=(x==null?void 0:x.slice(w*3,w*3+3))||[],$=y.slice(w*E,w*E+E),X=0;b&&b[w]!==void 0&&(X=b[w]),i.forEach(function(ne,se){if(ne&&ne.update){var Ee;(Ee=ne.buffer.data).push.apply(Ee,(0,G.Z)(ne.update(d,g,$,w,z,X)))}})},I=0;I<A;I++)F(I)});var l=this.rendererService,c=l.createAttribute,f=l.createBuffer,p={};return i.forEach(function(d,g){if(d){var m=d.buffer,_=d.update,y=d.name,x=(0,It.Z)(d,yg),E=c((0,T.Z)({buffer:f(m)},x));p[d.name||""]=E,e.attributes[g].vertexAttribute=E}}),{attributes:p}}},{key:"clearAllAttributes",value:function(){var n;this.attributes.forEach(function(r){r.vertexAttribute&&r.vertexAttribute.destroy()}),(n=this.attributesAndIndices)===null||n===void 0||n.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(n){return n.map(function(r){return{buffer:r.buffer,name:r.name,size:r.size}})}}]),t}(),Fu=(0,ie.Z)(wi.prototype,"rendererService",[Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi))||ku),Pu=O(67709),Cg=O.n(Pu),Du,wu,Iu,Bu,Nu,Zu,zu,Uu,ju,Hu,Vu,Gu,Wu,$u,Xu,Yu,Ku,Ue,Qu,qu,Ju,es,ts,ns,rs,is,as,os,us,ss,ls,cs,fs;function Sg(t){var a=bg();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function bg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Ag=(Du=(0,W.b2)(),wu=(0,W.f3)(M.SceneID),Iu=(0,W.f3)(M.IIconService),Bu=(0,W.f3)(M.IFontService),Nu=(0,W.f3)(M.IControlService),Zu=(0,W.f3)(M.IGlobalConfigService),zu=(0,W.f3)(M.IMapService),Uu=(0,W.f3)(M.ICoordinateSystemService),ju=(0,W.f3)(M.IRendererService),Hu=(0,W.f3)(M.ILayerService),Vu=(0,W.f3)(M.ICameraService),Gu=(0,W.f3)(M.IInteractionService),Wu=(0,W.f3)(M.IPickingService),$u=(0,W.f3)(M.IShaderModuleService),Xu=(0,W.f3)(M.IMarkerService),Yu=(0,W.f3)(M.IPopupService),Du(Ku=(Ue=function(t){(0,N.Z)(n,t);var a=Sg(n);function n(){var r;return(0,R.Z)(this,n),r=a.call(this),(0,h.Z)((0,C.Z)(r),"destroyed",!1),(0,h.Z)((0,C.Z)(r),"loaded",!1),(0,ae.Z)((0,C.Z)(r),"id",Qu,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"iconService",qu,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"fontService",Ju,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"controlService",es,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"configService",ts,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"map",ns,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"coordinateSystemService",rs,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"rendererService",is,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"layerService",as,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"cameraService",os,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"interactionService",us,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"pickingService",ss,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"shaderModuleService",ls,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"markerService",cs,(0,C.Z)(r)),(0,ae.Z)((0,C.Z)(r),"popupService",fs,(0,C.Z)(r)),(0,h.Z)((0,C.Z)(r),"inited",!1),(0,h.Z)((0,C.Z)(r),"initPromise",void 0),(0,h.Z)((0,C.Z)(r),"rendering",!1),(0,h.Z)((0,C.Z)(r),"$container",void 0),(0,h.Z)((0,C.Z)(r),"canvas",void 0),(0,h.Z)((0,C.Z)(r),"markerContainer",void 0),(0,h.Z)((0,C.Z)(r),"hooks",void 0),(0,h.Z)((0,C.Z)(r),"handleWindowResized",function(){r.emit("resize"),r.$container&&(r.initContainer(),Wp(),r.coordinateSystemService.needRefresh=!0,r.render())}),(0,h.Z)((0,C.Z)(r),"handleMapCameraChanged",function(e){r.cameraService.update(e),r.render()}),r.hooks={init:new Ve.sX},r}return(0,L.Z)(n,[{key:"init",value:function(e){var i=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return i.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,te.Z)(H().mark(function o(){return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,new Promise(function(l){i.map.onCameraChanged(function(c){i.cameraService.init(),i.cameraService.update(c),l()}),i.map.init()});case 2:i.map.onCameraChanged(i.handleMapCameraChanged),i.map.addMarkerContainer(),i.markerService.addMarkers(),i.markerService.addMarkerLayers(),i.popupService.initPopup(),i.interactionService.init(),i.interactionService.on(ze.Drag,i.addSceneEvent.bind(i));case 9:case"end":return s.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",(0,te.Z)(H().mark(function o(){var u,s;return H().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(u=i.map.getOverlayContainer(),u?i.$container=u:i.$container=og(i.configService.getSceneConfig(i.id).id||""),!i.$container){c.next=12;break}return i.canvas=le("canvas","",i.$container),i.setCanvas(),c.next=7,i.rendererService.init(i.canvas,i.configService.getSceneConfig(i.id),e.gl);case 7:i.initContainer(),Cg()(i.$container,i.handleWindowResized),_e.matchMedia&&((s=_e.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||s===void 0||s.addListener(i.handleWindowResized)),c.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:i.pickingService.init(i.id);case 14:case"end":return c.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(e){var i=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return i.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,te.Z)(H().mark(function o(){return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,new Promise(function(l){i.map.onCameraChanged(function(c){i.cameraService.init(),i.cameraService.update(c),i.map.version!=="GAODE2.x"&&l()}),i.map.initMiniMap()});case 2:i.map.onCameraChanged(i.handleMapCameraChanged),i.interactionService.init(),i.interactionService.on(ze.Drag,i.addSceneEvent.bind(i));case 5:case"end":return s.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",(0,te.Z)(H().mark(function o(){var u;return H().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(u=e.canvas,i.$container=u||null,!i.$container){l.next=7;break}return l.next=5,i.rendererService.init(e.canvas,i.configService.getSceneConfig(i.id),void 0);case 5:l.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:i.pickingService.init(i.id);case 9:case"end":return l.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:function(){var r=(0,te.Z)(H().mark(function i(){return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.rendering||this.destroyed)){u.next=2;break}return u.abrupt("return");case 2:if(this.rendering=!0,this.inited){u.next=12;break}return u.next=6,this.initPromise;case 6:this.destroyed&&this.destroy(),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 12:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 15:case"end":return u.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"addFontFace",value:function(e,i){this.fontService.addFontFace(e,i)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(e){var i,o=(i=this.$container)===null||i===void 0?void 0:i.getElementsByTagName("canvas")[0];this.render();var u=e==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;e!==null&&(this.markerContainer=le("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e=this,i,o;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var s;(s=e.$container)===null||s===void 0||s.removeChild(e.canvas),e.canvas=null,e.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(i=this.$container)===null||i===void 0||(o=i.parentNode)===null||o===void 0||o.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Pu.unbind)(this.$container,this.handleWindowResized),_e.matchMedia){var u;(u=_e.matchMedia("screen and (min-resolution: 2dppx)"))===null||u===void 0||u.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var e,i,o=Fe,u=((e=this.$container)===null||e===void 0?void 0:e.clientWidth)||400,s=((i=this.$container)===null||i===void 0?void 0:i.clientHeight)||300,l=this.canvas;l&&(l.width=u*o,l.height=s*o),this.rendererService.viewport({x:0,y:0,width:o*u,height:o*s})}},{key:"setCanvas",value:function(){var e,i,o=Fe,u=((e=this.$container)===null||e===void 0?void 0:e.clientWidth)||400,s=((i=this.$container)===null||i===void 0?void 0:i.clientHeight)||300,l=this.canvas;l.width=u*o,l.height=s*o,l.style.width="100%",l.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),n}(He.EventEmitter),Qu=(0,ie.Z)(Ue.prototype,"id",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qu=(0,ie.Z)(Ue.prototype,"iconService",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju=(0,ie.Z)(Ue.prototype,"fontService",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),es=(0,ie.Z)(Ue.prototype,"controlService",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ts=(0,ie.Z)(Ue.prototype,"configService",[Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ns=(0,ie.Z)(Ue.prototype,"map",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rs=(0,ie.Z)(Ue.prototype,"coordinateSystemService",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),is=(0,ie.Z)(Ue.prototype,"rendererService",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),as=(0,ie.Z)(Ue.prototype,"layerService",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=(0,ie.Z)(Ue.prototype,"cameraService",[Vu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),us=(0,ie.Z)(Ue.prototype,"interactionService",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ss=(0,ie.Z)(Ue.prototype,"pickingService",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ls=(0,ie.Z)(Ue.prototype,"shaderModuleService",[$u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs=(0,ie.Z)(Ue.prototype,"markerService",[Xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs=(0,ie.Z)(Ue.prototype,"popupService",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ue))||Ku);function Tg(t){var a=0;switch(t){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var Mg=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ps(t){var a={};return t=t.replace(Mg,function(n,r,e){var i=e.split(":"),o=i[0].trim(),u="";switch(i.length>1&&(u=i[1].trim()),r){case"bool":u=u==="true";break;case"float":case"int":u=Number(u);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":u?u=u.replace("[","").replace("]","").split(",").reduce(function(s,l){return s.push(Number(l.trim())),s},[]):u=new Array(Tg(r)).fill(0);break;default:}return a[o]=u,"uniform ".concat(r," ").concat(o,`;
`)}),{content:t,uniforms:a}}var ds,vs,hs="#define PI 3.14159265359",Rg=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Lg=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Og=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,kg=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Fg=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Pg=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Dg=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,wg=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Ig=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Bg=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Ng=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Zg=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,zg=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Ug=/precision\s+(high|low|medium)p\s+float/,jg=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Hg=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,Vg=(ds=(0,W.b2)(),ds(vs=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"moduleCache",{}),(0,h.Z)(this,"rawContentCache",{})}return(0,L.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:hs,fs:hs}),this.registerModule("decode",{vs:Rg,fs:""}),this.registerModule("projection",{vs:Dg,fs:""}),this.registerModule("project",{vs:Pg,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:wg}),this.registerModule("lighting",{vs:Og,fs:""}),this.registerModule("light",{vs:Lg,fs:""}),this.registerModule("picking",{vs:Fg,fs:kg}),this.registerModule("styleMapping",{vs:Ig,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:zg,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Bg,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Ng,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Zg,fs:""})}},{key:"registerModule",value:function(n,r){if(!this.rawContentCache[n]){var e=r.vs,i=r.fs,o=r.uniforms,u=ps(e),s=u.content,l=u.uniforms,c=ps(i),f=c.content,p=c.uniforms;this.rawContentCache[n]={fs:f,uniforms:(0,T.Z)((0,T.Z)((0,T.Z)({},l),p),o),vs:s}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(n){var r=this;if(this.moduleCache[n])return this.moduleCache[n];var e=this.rawContentCache[n].vs,i=this.rawContentCache[n].fs,o=this.processModule(e,[],"vs"),u=o.content,s=o.includeList,l=this.processModule(i,[],"fs"),c=l.content,f=l.includeList,p=c,d=(0,P.uniq)(s.concat(f).concat(n)).reduce(function(g,m){return(0,T.Z)((0,T.Z)({},g),r.rawContentCache[m].uniforms)},{});return Ug.test(c)||(p=jg+c),this.moduleCache[n]={fs:p.trim(),uniforms:d,vs:u.trim()},this.moduleCache[n]}},{key:"processModule",value:function(n,r,e){var i=this,o=n.replace(Hg,function(u,s){var l=s.split(" "),c=l[0].replace(/"/g,"");if(r.indexOf(c)>-1)return"";var f=i.rawContentCache[c][e];r.push(c);var p=i.processModule(f,r,e),d=p.content;return d});return{content:o,includeList:r}}}]),t}())||vs),ge=O(66213),Bt;(function(t){t.Normal="normal",t.PostProcessing="post-processing"})(Bt||(Bt={}));var gs,ms,hr=(gs=(0,W.b2)(),gs(ms=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"shaderModuleService",void 0),(0,h.Z)(this,"rendererService",void 0),(0,h.Z)(this,"cameraService",void 0),(0,h.Z)(this,"mapService",void 0),(0,h.Z)(this,"interactionService",void 0),(0,h.Z)(this,"layerService",void 0),(0,h.Z)(this,"config",void 0)}return(0,L.Z)(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Bt.Normal}},{key:"init",value:function(n,r){this.config=r,this.rendererService=n.getContainer().get(M.IRendererService),this.cameraService=n.getContainer().get(M.ICameraService),this.mapService=n.getContainer().get(M.IMapService),this.interactionService=n.getContainer().get(M.IInteractionService),this.layerService=n.getContainer().get(M.ILayerService),this.shaderModuleService=n.getContainer().get(M.IShaderModuleService)}},{key:"render",value:function(n){}}]),t}())||ms),_s,ys;function Gg(t){var a=Wg();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Wg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var $g=(_s=(0,W.b2)(),_s(ys=function(t){(0,N.Z)(n,t);var a=Gg(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,i){(0,ge.Z)((0,S.Z)(n.prototype),"init",this).call(this,e,i)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(hr))||ys),xs,Es,Cs,Ii,Ss;function Xg(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Yg(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function Yg(t,a){if(!!t){if(typeof t=="string")return bs(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bs(t,a)}}function bs(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var Kg=(xs=(0,W.b2)(),Es=(0,W.f3)(M.IPostProcessor),xs(Cs=(Ii=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"passes",[]),(0,ae.Z)(this,"postProcessor",Ss,this),(0,h.Z)(this,"layer",void 0),(0,h.Z)(this,"renderFlag",void 0),(0,h.Z)(this,"width",0),(0,h.Z)(this,"height",0)}return(0,L.Z)(t,[{key:"setLayer",value:function(n){this.layer=n}},{key:"setRenderFlag",value:function(n){this.renderFlag=n}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,te.Z)(H().mark(function r(){var e,i,o;return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=Xg(this.passes),s.prev=1,e.s();case 3:if((i=e.n()).done){s.next=9;break}return o=i.value,s.next=7,o.render(this.layer);case 7:s.next=3;break;case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(1),e.e(s.t0);case 14:return s.prev=14,e.f(),s.finish(14);case 17:return s.next=19,this.postProcessor.render(this.layer);case 19:case"end":return s.stop()}},r,this,[[1,11,14,17]])}));function n(){return a.apply(this,arguments)}return n}()},{key:"resize",value:function(n,r){(this.width!==n||this.height!==r)&&(this.postProcessor.resize(n,r),this.width=n,this.height=r)}},{key:"add",value:function(n,r){n.getType()===Bt.PostProcessing?this.postProcessor.add(n,this.layer,r):(n.init(this.layer,r),this.passes.push(n))}},{key:"insert",value:function(n,r,e){n.init(this.layer,r),this.passes.splice(e,0,n)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}(),Ss=(0,ie.Z)(Ii.prototype,"postProcessor",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii))||Cs),As,Ts;function Qg(t){var a=qg();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function qg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Jg=(As=(0,W.b2)(),As(Ts=function(t){(0,N.Z)(n,t);var a=Qg(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"pickingFBO",void 0),(0,h.Z)((0,C.Z)(r),"layer",void 0),(0,h.Z)((0,C.Z)(r),"width",0),(0,h.Z)((0,C.Z)(r),"height",0),(0,h.Z)((0,C.Z)(r),"alreadyInRendering",!1),(0,h.Z)((0,C.Z)(r),"pickFromPickingFBO",function(u){var s=u.x,l=u.y,c=u.lngLat,f=u.type;if(!(!r.layer.isVisible()||!r.layer.needPick(f))){var p=r.rendererService,d=p.getViewportSize,g=p.readPixels,m=p.useFramebuffer,_=d(),y=_.width,x=_.height,E=r.layer.getLayerConfig(),b=E.enableHighlight,A=E.enableSelect,F=s*Fe,I=l*Fe;if(!(F>y||F<0||I>x||I<0)){var k;m(r.pickingFBO,function(){var w;if(k=g({x:Math.round(F),y:Math.round(x-(l+1)*Fe),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),k[0]!==0||k[1]!==0||k[2]!==0){var z=Lt(k),$=r.layer.getSource().getFeatureById(z),X={x:s,y:l,type:f,lngLat:c,featureId:z,feature:$};$&&(r.layer.setCurrentPickId(z),r.triggerHoverOnLayer(X))}else{var ne={x:s,y:l,lngLat:c,type:r.layer.getCurrentPickId()===null?"un"+f:"mouseout",featureId:null,feature:null};r.triggerHoverOnLayer((0,T.Z)((0,T.Z)({},ne),{},{type:"unpick"})),r.triggerHoverOnLayer(ne),r.layer.setCurrentPickId(null)}b&&r.highlightPickedFeature(k),A&&f==="click"&&((w=k)===null||w===void 0?void 0:w.toString())!==[0,0,0,0].toString()&&r.selectFeature(k)})}}}),r}return(0,L.Z)(n,[{key:"getType",value:function(){return Bt.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,i){(0,ge.Z)((0,S.Z)(n.prototype),"init",this).call(this,e,i),this.layer=e;var o=this.rendererService,u=o.createTexture2D,s=o.createFramebuffer,l=o.getViewportSize,c=l(),f=c.width,p=c.height;this.pickingFBO=s({color:u({width:f,height:p,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.interactionService.on(ze.Hover,this.pickFromPickingFBO),this.interactionService.on(ze.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ze.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var i=this;if(!this.alreadyInRendering){var o=this.rendererService,u=o.getViewportSize,s=o.useFramebuffer,l=o.clear,c=u(),f=c.width,p=c.height;this.alreadyInRendering=!0,(this.width!==f||this.height!==p)&&(this.pickingFBO.resize({width:f,height:p}),this.width=f,this.height=p),s(this.pickingFBO,function(){l({framebuffer:i.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var d=i.layer.multiPassRenderer.getRenderFlag();i.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),i.layer.multiPassRenderer.setRenderFlag(d),i.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var i=(0,re.Z)(e,3),o=i[0],u=i[1],s=i[2];this.layer.hooks.beforeHighlight.call([o,u,s]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var i=(0,re.Z)(e,3),o=i[0],u=i[1],s=i[2];this.layer.hooks.beforeSelect.call([o,u,s]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var i=e.featureId,o=Ot(i);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(e){var i=e.featureId,o=Ot(i);this.highlightPickedFeature(new Uint8Array(o))}}]),n}(hr))||Ts),Ms,Rs,Ls,Bi,Os,em=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,St=(Ms=(0,W.b2)(),Rs=(0,W.f3)(M.IShaderModuleService),Ms(Ls=(Bi=function(){function t(){(0,R.Z)(this,t),(0,ae.Z)(this,"shaderModuleService",Os,this),(0,h.Z)(this,"rendererService",void 0),(0,h.Z)(this,"config",void 0),(0,h.Z)(this,"quad",em),(0,h.Z)(this,"enabled",!0),(0,h.Z)(this,"renderToScreen",!1),(0,h.Z)(this,"model",void 0),(0,h.Z)(this,"name",void 0),(0,h.Z)(this,"optionsToUpdate",{})}return(0,L.Z)(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(n){this.name=n}},{key:"getType",value:function(){return Bt.PostProcessing}},{key:"init",value:function(n,r){this.config=r,this.rendererService=n.getContainer().get(M.IRendererService),this.shaderModuleService=n.getContainer().get(M.IShaderModuleService);var e=this.rendererService,i=e.createAttribute,o=e.createBuffer,u=e.createModel,s=this.setupShaders(),l=s.vs,c=s.fs,f=s.uniforms;this.model=u({vs:l,fs:c,attributes:{a_Position:i({buffer:o({data:[-4,-4,4,-4,0,4],type:v.FLOAT}),size:2})},uniforms:(0,T.Z)((0,T.Z)({u_Texture:null},f),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(n,r){var e=this,i=n.multiPassRenderer.getPostProcessor(),o=this.rendererService,u=o.useFramebuffer,s=o.getViewportSize,l=o.clear,c=s(),f=c.width,p=c.height;u(this.renderToScreen?null:i.getWriteFBO(),function(){l({framebuffer:i.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var d=(0,T.Z)({u_BloomFinal:0,u_Texture:i.getReadFBO(),u_ViewportSize:[f,p]},e.convertOptionsToUniforms(e.optionsToUpdate));r&&(d.u_BloomFinal=1,d.u_Texture2=r),e.model.draw({uniforms:d})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(n){this.enabled=n}},{key:"setRenderToScreen",value:function(n){this.renderToScreen=n}},{key:"updateOptions",value:function(n){this.optionsToUpdate=(0,T.Z)((0,T.Z)({},this.optionsToUpdate),n)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(n){var r={};return Object.keys(n).forEach(function(e){(0,P.isNil)(n[e])||(r["u_".concat((0,P.upperFirst)((0,P.camelCase)(e)))]=n[e])}),r}}]),t}(),Os=(0,ie.Z)(Bi.prototype,"shaderModuleService",[Rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bi))||Ls),ks,Fs;function tm(t){var a=nm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function nm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var rm=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,im=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,am=(ks=(0,W.b2)(),ks(Fs=function(t){(0,N.Z)(n,t);var a=tm(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:im,fs:rm});var e=this.shaderModuleService.getModule("blur-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,T.Z)((0,T.Z)({},u),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(e){var i={};return(0,P.isNil)(e.bloomRadius)||(i.u_radius=e.bloomRadius),(0,P.isNil)(e.bloomIntensity)||(i.u_intensity=e.bloomIntensity),(0,P.isNil)(e.bloomBaseRadio)||(i.u_baseRadio=e.bloomBaseRadio),i}}]),n}(St))||Fs),Ps,Ds;function om(t){var a=um();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function um(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var sm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,lm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cm=(Ps=(0,W.b2)(),Ps(Ds=function(t){(0,N.Z)(n,t);var a=om(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:lm,fs:sm});var e=this.shaderModuleService.getModule("blur-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,T.Z)((0,T.Z)({},u),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(e){var i={};return(0,P.isNil)(e.blurRadius)||(i.u_BlurDir=[e.blurRadius,0]),i}}]),n}(St))||Ds),ws,Is;function fm(t){var a=pm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function pm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var dm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,vm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hm=(ws=(0,W.b2)(),ws(Is=function(t){(0,N.Z)(n,t);var a=fm(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:vm,fs:dm});var e=this.shaderModuleService.getModule("blur-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,T.Z)((0,T.Z)({},u),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(e){var i={};return(0,P.isNil)(e.blurRadius)||(i.u_BlurDir=[0,e.blurRadius]),i}}]),n}(St))||Is),Bs,Ns;function gm(t){var a=mm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function mm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var _m=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ym=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xm=(Bs=(0,W.b2)(),Bs(Ns=function(t){(0,N.Z)(n,t);var a=gm(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ym,fs:_m});var e=this.shaderModuleService.getModule("colorhalftone-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,T.Z)((0,T.Z)({},u),{},{u_ViewportSize:[l,c]})}}}]),n}(St))||Ns),Zs,zs;function Em(t){var a=Cm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Cm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Sm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,bm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Am=(Zs=(0,W.b2)(),Zs(zs=function(t){(0,N.Z)(n,t);var a=Em(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:bm,fs:Sm}),this.shaderModuleService.getModule("copy-pass")}}]),n}(St))||zs),Us,js;function Tm(t){var a=Mm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Mm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Rm=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Lm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Om=(Us=(0,W.b2)(),Us(js=function(t){(0,N.Z)(n,t);var a=Tm(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Lm,fs:Rm});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,T.Z)((0,T.Z)({},u),{},{u_ViewportSize:[l,c]})}}}]),n}(St))||js),Hs,Vs;function km(t){var a=Fm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Fm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Pm=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Dm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wm=(Hs=(0,W.b2)(),Hs(Vs=function(t){(0,N.Z)(n,t);var a=km(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Dm,fs:Pm});var e=this.shaderModuleService.getModule("ink-pass"),i=e.vs,o=e.fs,u=e.uniforms,s=this.rendererService.getViewportSize(),l=s.width,c=s.height;return{vs:i,fs:o,uniforms:(0,T.Z)((0,T.Z)({},u),{},{u_ViewportSize:[l,c]})}}}]),n}(St))||Vs),Gs,Ws;function Im(t){var a=Bm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Bm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Nm=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Zm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zm=(Gs=(0,W.b2)(),Gs(Ws=function(t){(0,N.Z)(n,t);var a=Im(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Zm,fs:Nm}),this.shaderModuleService.getModule("noise-pass")}}]),n}(St))||Ws),$s,Xs;function Um(t){var a=jm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function jm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Hm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Vm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Gm=($s=(0,W.b2)(),$s(Xs=function(t){(0,N.Z)(n,t);var a=Um(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Hm,fs:Vm}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(St))||Xs),Ys,Ks,Qs,qs,cn,Js,Wm=(Ys=(0,W.b2)(),Ks=(0,W.f3)(M.IRendererService),Qs=(0,W.zY)(),Ys(qs=(cn=function(){function t(){(0,R.Z)(this,t),(0,ae.Z)(this,"rendererService",Js,this),(0,h.Z)(this,"passes",[]),(0,h.Z)(this,"readFBO",void 0),(0,h.Z)(this,"writeFBO",void 0)}return(0,L.Z)(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var n=this.rendererService,r=n.getViewportSize,e=n.createTexture2D,i=r(),o=i.width,u=i.height;return e({x:0,y:0,width:o,height:u,copy:!0})}},{key:"getReadFBOTex",value:function(){var n=this,r=this.rendererService.useFramebuffer;return new Promise(function(e){r(n.readFBO,(0,te.Z)(H().mark(function i(){return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e(n.getCurrentFBOTex());case 1:case"end":return u.stop()}},i)})))})}},{key:"renderBloomPass",value:function(){var a=(0,te.Z)(H().mark(function r(e,i){var o,u;return H().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.getReadFBOTex();case 2:o=l.sent,u=0;case 4:if(!(u<4)){l.next=11;break}return l.next=7,i.render(e,o);case 7:this.swap(),u++,l.next=4;break;case 11:case"end":return l.stop()}},r,this)}));function n(r,e){return a.apply(this,arguments)}return n}()},{key:"render",value:function(){var a=(0,te.Z)(H().mark(function r(e){var i,o;return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i=0;case 1:if(!(i<this.passes.length)){s.next=15;break}if(o=this.passes[i],o.setRenderToScreen(this.isLastEnabledPass(i)),o.getName()!=="bloom"){s.next=9;break}return s.next=7,this.renderBloomPass(e,o);case 7:s.next=12;break;case 9:return s.next=11,o.render(e);case 11:i!==this.passes.length-1&&this.swap();case 12:i++,s.next=1;break;case 15:case"end":return s.stop()}},r,this)}));function n(r){return a.apply(this,arguments)}return n}()},{key:"resize",value:function(n,r){this.readFBO.resize({width:n,height:r}),this.writeFBO.resize({width:n,height:r})}},{key:"add",value:function(n,r,e){n.init(r,e),this.passes.push(n)}},{key:"insert",value:function(n,r,e,i){n.init(e,i),this.passes.splice(r,0,n)}},{key:"getPostProcessingPassByName",value:function(n){return this.passes.find(function(r){return r.getName()===n})}},{key:"init",value:function(){var n=this.rendererService,r=n.createFramebuffer,e=n.createTexture2D;this.readFBO=r({color:e({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.writeFBO=r({color:e({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(n){for(var r=n+1;r<this.passes.length;r++)if(this.passes[r].isEnabled())return!1;return!0}},{key:"swap",value:function(){var n=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=n}}]),t}(),Js=(0,ie.Z)(cn.prototype,"rendererService",[Ks],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,ie.Z)(cn.prototype,"init",[Qs],Object.getOwnPropertyDescriptor(cn.prototype,"init"),cn.prototype),cn))||qs),el,tl;function $m(t){var a=Xm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Xm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Ym=(el=(0,W.b2)(),el(tl=function(t){(0,N.Z)(n,t);var a=$m(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getType",value:function(){return Bt.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,i){(0,ge.Z)((0,S.Z)(n.prototype),"init",this).call(this,e,i)}},{key:"render",value:function(e){var i=this.rendererService,o=i.useFramebuffer,u=i.clear,s=e.multiPassRenderer.getPostProcessor().getReadFBO();o(s,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach(function(l){l.draw({uniforms:e.layerModel.getUninforms()})}),e.multiPassRenderer.setRenderFlag(!0)})}}]),n}(hr))||tl),nl,rl,il,Ni,al;function Km(t){var a=Qm();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Qm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var qm=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,ol=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Jm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function ul(t,a){for(var n=0,r=1/a,e=t;e>0;)n=n+r*(e%a),e=Math.floor(e/a),r=r/a;return n}var e_=1,t_=(nl=(0,W.b2)(),rl=(0,W.f3)(M.IShaderModuleService),nl(il=(Ni=function(t){(0,N.Z)(n,t);var a=Km(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,ae.Z)((0,C.Z)(r),"shaderModuleService",al,(0,C.Z)(r)),(0,h.Z)((0,C.Z)(r),"haltonSequence",[]),(0,h.Z)((0,C.Z)(r),"accumulatingId",0),(0,h.Z)((0,C.Z)(r),"frame",0),(0,h.Z)((0,C.Z)(r),"timer",void 0),(0,h.Z)((0,C.Z)(r),"sampleRenderTarget",void 0),(0,h.Z)((0,C.Z)(r),"prevRenderTarget",void 0),(0,h.Z)((0,C.Z)(r),"outputRenderTarget",void 0),(0,h.Z)((0,C.Z)(r),"copyRenderTarget",void 0),(0,h.Z)((0,C.Z)(r),"blendModel",void 0),(0,h.Z)((0,C.Z)(r),"outputModel",void 0),(0,h.Z)((0,C.Z)(r),"copyModel",void 0),r}return(0,L.Z)(n,[{key:"getType",value:function(){return Bt.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,i){(0,ge.Z)((0,S.Z)(n.prototype),"init",this).call(this,e,i);var o=this.rendererService,u=o.createFramebuffer,s=o.createTexture2D;this.sampleRenderTarget=u({color:s({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.prevRenderTarget=u({color:s({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.outputRenderTarget=u({color:s({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})}),this.copyRenderTarget=u({color:s({width:1,height:1,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE})});for(var l=0;l<30;l++)this.haltonSequence.push([ul(l,2),ul(l,3)]);this.blendModel=this.createTriangleModel("blend-pass",qm),this.outputModel=this.createTriangleModel("copy-pass",ol,{blend:{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE_MINUS_SRC_ALPHA,srcAlpha:v.ONE,dstAlpha:v.ONE_MINUS_SRC_ALPHA},equation:{rgb:v.FUNC_ADD,alpha:v.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",ol)}},{key:"render",value:function(e){var i=this,o=this.rendererService,u=o.clear,s=o.getViewportSize,l=o.useFramebuffer,c=s(),f=c.width,p=c.height;this.sampleRenderTarget.resize({width:f,height:p}),this.prevRenderTarget.resize({width:f,height:p}),this.outputRenderTarget.resize({width:f,height:p}),this.copyRenderTarget.resize({width:f,height:p}),this.resetFrame(),this.stopAccumulating();var d=e.multiPassRenderer.getPostProcessor().getReadFBO();l(d,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:d}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)});var g=function m(_){!i.accumulatingId||_!==i.accumulatingId||i.isFinished()||(i.doRender(e),_e.requestAnimationFrame(function(){m(_)}))};this.accumulatingId=e_++,this.timer=_e.setTimeout(function(){g(i.accumulatingId)},50)}},{key:"doRender",value:function(e){var i=this,o=this.rendererService,u=o.clear,s=o.getViewportSize,l=o.useFramebuffer,c=s(),f=c.width,p=c.height,d=e.getLayerConfig(),g=d.jitterScale,m=g===void 0?1:g,_=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((_[0]*2-1)/f*m,(_[1]*2-1)/p*m),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),l(this.sampleRenderTarget,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.sampleRenderTarget}),e.render()}),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var y=e.getLayerConfig();l(this.outputRenderTarget,function(){i.blendModel.draw({uniforms:{u_opacity:y.opacity||1,u_MixRatio:i.frame===0?1:.9,u_Diffuse1:i.sampleRenderTarget,u_Diffuse2:i.frame===0?e.multiPassRenderer.getPostProcessor().getReadFBO():i.prevRenderTarget}})}),this.frame===0&&u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(l(this.copyRenderTarget,function(){i.outputModel.draw({uniforms:{u_Texture:i.outputRenderTarget}})}),l(e.multiPassRenderer.getPostProcessor().getReadFBO(),function(){i.copyModel.draw({uniforms:{u_Texture:i.copyRenderTarget}})}),e.multiPassRenderer.getPostProcessor().render(e));var x=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=x,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,_e.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,i,o){this.shaderModuleService.registerModule(e,{vs:Jm,fs:i});var u=this.shaderModuleService.getModule(e),s=u.vs,l=u.fs,c=u.uniforms,f=this.rendererService,p=f.createAttribute,d=f.createBuffer,g=f.createModel;return g((0,T.Z)({vs:s,fs:l,attributes:{a_Position:p({buffer:d({data:[-4,-4,4,-4,0,4],type:v.FLOAT}),size:2})},uniforms:(0,T.Z)({},c),depth:{enable:!1},count:3},o))}}]),n}(hr),al=(0,ie.Z)(Ni.prototype,"shaderModuleService",[rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ni))||il),Un=new W.W2;Un.bind(M.IGlobalConfigService).to(Kh).inSingletonScope(),(0,W.GW)((0,W.b2)(),He.EventEmitter),Un.bind(M.IEventEmitter).to(He.EventEmitter);var sl=(0,hh.Z)(Un,!1),Zi=function(a){var n=sl.lazyInject(a);return function(r,e,i){n.call(this,r,e),i&&(i.initializer=function(){return r[e]})}},Z5=function(a){var n=sl.lazyMultiInject(a);return function(r,e,i){n.call(this,r,e),i&&(i.initializer=function(){return r[e]})}},Je=Un,n_=0;function r_(){var t=new W.W2;return t.parent=Un,t.bind(M.SceneID).toConstantValue("".concat(n_++)),t.bind(M.IShaderModuleService).to(Vg).inSingletonScope(),t.bind(M.ILayerService).to(vg).inSingletonScope(),t.bind(M.ISceneService).to(Ag).inSingletonScope(),t.bind(M.ICameraService).to(Zh).inSingletonScope(),t.bind(M.ICoordinateSystemService).to(Jh).inSingletonScope(),t.bind(M.IInteractionService).to(ig).inSingletonScope(),t.bind(M.IPickingService).to(sg).inSingletonScope(),t.bind(M.IControlService).to(Hh).inSingletonScope(),t.bind(M.IMarkerService).to(Vh).inSingletonScope(),t.bind(M.IIconService).to(Nh).inSingletonScope(),t.bind(M.IFontService).to(Dh).inSingletonScope(),t.bind(M.IPopupService).to(Gh).inSingletonScope(),t.bind(M.INormalPass).to($g).whenTargetNamed("clear"),t.bind(M.INormalPass).to(Jg).whenTargetNamed("pixelPicking"),t.bind(M.INormalPass).to(Ym).whenTargetNamed("render"),t.bind(M.INormalPass).to(t_).whenTargetNamed("taa"),t.bind(M.IFactoryNormalPass).toFactory(function(a){return function(n){return a.container.getNamed(M.INormalPass,n)}}),t.bind(M.IPostProcessingPass).to(Am).whenTargetNamed("copy"),t.bind(M.IPostProcessingPass).to(am).whenTargetNamed("bloom"),t.bind(M.IPostProcessingPass).to(cm).whenTargetNamed("blurH"),t.bind(M.IPostProcessingPass).to(hm).whenTargetNamed("blurV"),t.bind(M.IPostProcessingPass).to(zm).whenTargetNamed("noise"),t.bind(M.IPostProcessingPass).to(Gm).whenTargetNamed("sepia"),t.bind(M.IPostProcessingPass).to(xm).whenTargetNamed("colorHalftone"),t.bind(M.IPostProcessingPass).to(Om).whenTargetNamed("hexagonalPixelate"),t.bind(M.IPostProcessingPass).to(wm).whenTargetNamed("ink"),t.bind(M.IFactoryPostProcessingPass).toFactory(function(a){return function(n){var r=a.container.getNamed(M.IPostProcessingPass,n);return r.setName(n),r}}),t}function zi(t){var a=new W.W2;return a.parent=t,a.bind(M.IStyleAttributeService).to(Eg).inSingletonScope(),a.bind(M.IMultiPassRenderer).to(Kg).inSingletonScope(),a.bind(M.IPostProcessor).to(Wm).inSingletonScope(),a}var i_=null;function z5(t){return i_.indexOf(t)}var a_=2,U5=4,o_=64,j5=128,u_=256,s_=512,H5=8192,V5=16384,G5=32768,l_=null,ll=131072,W5=262144,c_=524288,$5=1048576,f_=2097152,X5=4194304,p_=8388608,d_=16777216,v_=null;function gr(t,a){return t=clamp(Math.floor(t),0,255),a=clamp(Math.floor(a),0,255),256*t+a}function Y5(t){var a=t.color,n=t.radius,r=t.tileX,e=t.tileY,i=t.shape,o=t.opacity,u=t.stroke,s=t.strokeWidth,l=t.strokeOpacity,c=[],f=[],p=[],d=[gr(a[0],a[1]),gr(a[2],a[3])],g=[gr(u[0],u[1]),gr(u[2],u[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(m){var _=_slicedToArray(m,2),y=_[0],x=_[1];c.push([].concat(d,[(y+1)*p_+(x+1)*f_+getShapeIndex(i)*ll+n,(r+512)*c_+(e+512)*o_])),f.push([].concat(g,[s,l])),p.push([o,0,0,0])}),{packedBuffer:c,packedBuffer2:f,packedBuffer3:p}}function K5(t,a){if(t===0&&!a)return 0;if(t===1&&a)return 4294967295;var n=a?1:0,r=Math.floor(t*127);return r*v_+n*d_+r*ll+n*l_+r*s_+n*u_+r*a_+n}var vt;(function(t){t.normal="normal",t.additive="additive",t.subtractive="subtractive",t.min="min",t.max="max",t.none="none"})(vt||(vt={}));var ye;(function(t){t.LINEAR="linear",t.SEQUENTIAL="sequential",t.POWER="power",t.LOG="log",t.IDENTITY="identity",t.TIME="time",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.CAT="cat",t.DIVERGING="diverging"})(ye||(ye={}));var Nt;(function(t){t.CONSTANT="constant",t.VARIABLE="variable"})(Nt||(Nt={}));var j;(function(t){t[t.Attribute=0]="Attribute",t[t.InstancedAttribute=1]="InstancedAttribute",t[t.Uniform=2]="Uniform"})(j||(j={}));var h_=["mapload","mapchange","mapAfterFrameChange"],Xt={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},mr=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];function g_(t){var a=m_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function m_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var cl=function(t){(0,N.Z)(n,t);var a=g_(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this),(0,h.Z)((0,C.Z)(e),"added",!1),(0,h.Z)((0,C.Z)(e),"eventHandle",function(i){e.emit(i.type,{target:i,data:e.markerOption.extData,lngLat:e.lngLat})}),e.markerOption=(0,T.Z)((0,T.Z)({},e.getDefault()),r),Qa(["update","onMove","onUp","addDragHandler","onMapClick"],(0,C.Z)(e)),e.init(),e}return(0,L.Z)(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ar.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(M.IMapService),this.sceneSerive=e.get(M.ISceneService);var i=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&at(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var i=this;if(!this.added)return this.once("added",function(){i.setElement(e)}),this;var o=this.markerOption.element;return o&&at(o),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",function(){e.openPopup()}),this;var i=this.popup;return i?(i.isOpen()||i.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",function(){e.closePopup()});var i=this.popup;return i&&i.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;if(e)e.isOpen()?e.remove():e.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(!!this.mapsService){var e=this.markerOption,i=e.element,o=e.anchor;this.updatePosition(),Na(i,"".concat(or[o]))}}},{key:"onMapClick",value:function(e){var i=this.markerOption.element;this.popup&&i&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(e==null?void 0:e.scrollHeight)||0,containerWidth:(e==null?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var e=this.markerOption,i=e.element,o=e.offsets,u=this.lngLat,s=u.lng,l=u.lat,c=this.mapsService.lngLatToContainer([s,l]);if(i){i.style.display="block",i.style.whiteSpace="nowrap";var f=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),p=f.containerHeight,d=f.containerWidth,g=f.bounds;if(!g)return;if(Math.abs(g[0][0])>180||Math.abs(g[1][0])>180){if(c.x>d){var m=this.mapsService.lngLatToContainer([s-360,l]);c.x=m.x}if(c.x<0){var _=this.mapsService.lngLatToContainer([s+360,l]);c.x=_.x}}(c.x>d||c.x<0||c.y>p||c.y<0)&&(i.style.display="none"),i.style.left=c.x+o[0]+"px",i.style.top=c.y-o[1]+"px"}}}},{key:"init",value:function(){var e=this,i=this.markerOption.element,o=this.markerOption,u=o.color,s=o.anchor;if(!i){this.defaultMarker=!0,i=le("div"),this.markerOption.element=i;var l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height","48px"),l.setAttributeNS(null,"width","48px"),l.setAttributeNS(null,"viewBox","0 0 1024 1024");var c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),c.setAttributeNS(null,"fill",u),l.appendChild(c),i.appendChild(l)}pt(i,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(f){var p,d,g=((p=e.markerOption)===null||p===void 0?void 0:p.style)&&((d=e.markerOption)===null||d===void 0?void 0:d.style[f]);i&&(i.style[f]=g)}),i.addEventListener("click",function(f){e.onMapClick(f)}),i.addEventListener("click",this.eventHandle),Ja(i,s,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(e){throw new Error("Method not implemented.")}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),n}(He.EventEmitter);function __(t){var a=y_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function y_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Q5=function(t){(0,N.Z)(n,t);var a=__(n);function n(r){var e,i;return(0,R.Z)(this,n),i=a.call(this),(0,h.Z)((0,C.Z)(i),"markers",[]),(0,h.Z)((0,C.Z)(i),"points",[]),(0,h.Z)((0,C.Z)(i),"clusterMarkers",[]),i.markerLayerOption=(0,P.merge)(i.getDefault(),r),Qa(["update"],(0,C.Z)(i)),i.zoom=((e=i.markerLayerOption.clusterOption)===null||e===void 0?void 0:e.zoom)||-99,i}return(0,L.Z)(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(M.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(e==null?void 0:e.scrollWidth)||0,containerHeight:(e==null?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var i=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),i&&(this.addPoint(e,this.markers.length),this.mapsService)){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();this.bbox=on(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var i=this.markers.indexOf(e);i>-1&&this.markers.splice(i,1)}},{key:"hide",value:function(){this.markers.map(function(e){e.getElement().style.opacity="0"}),this.clusterMarkers.map(function(e){e.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(e){e.getElement().style.opacity="1"}),this.clusterMarkers.map(function(e){e.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var e=this.markerLayerOption.cluster;return e?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach(function(i){i.addTo(e.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(e){e.remove()}),this.clusterMarkers.forEach(function(e){e.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,i){var o=e.getLnglat(),u=o.lng,s=o.lat,l={geometry:{type:"Point",coordinates:[u,s]},properties:(0,T.Z)((0,T.Z)({},e.getExtData()),{},{marker_id:i})};this.points.push(l),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,i=e.radius,o=e.minZoom,u=o===void 0?0:o,s=e.maxZoom;this.clusterIndex=new(So())({radius:i,minZoom:u,maxZoom:s}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,i){var o=this,u=e[0].concat(e[1]),s=this.clusterIndex.getClusters(u,i);this.clusterMarkers.forEach(function(l){l.remove()}),this.clusterMarkers=[],s.forEach(function(l){var c,f=o.markerLayerOption.clusterOption,p=f.field,d=f.method;if((c=l.properties)!==null&&c!==void 0&&c.cluster_id){var g,m=o.getLeaves((g=l.properties)===null||g===void 0?void 0:g.cluster_id);if(l.properties.clusterData=m,p&&d){var _=m==null?void 0:m.map(function(A){var F=(0,h.Z)({},p,A.properties[p]);return F}),y=ui(_,p),x=ed(d,y),E="point_"+d;l.properties[E]=x.toFixed(2)}}var b=o.clusterMarker(l);o.clusterMarkers.push(b),b.addTo(o.scene)})}},{key:"getLeaves",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,i,o):null}},{key:"clusterMarker",value:function(e){var i=this.markerLayerOption.clusterOption,o=i,u=o.element,s=u===void 0?this.generateElement.bind(this):u,l=new cl({element:s(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]});return l}},{key:"normalMarker",value:function(e){var i=e.properties.marker_id;return this.markers[i]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var e=this.mapsService.getZoom(),i=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!di(this.bbox,i))&&(this.bbox=on(i,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var i=le("div","l7-marker-cluster"),o=le("div","",i),u=le("span","",o),s=this.markerLayerOption.clusterOption,l=s.field,c=s.method;e.properties.point_count=e.properties.point_count||1;var f=l&&c?e.properties["point_"+c]||e.properties[l]:e.properties.point_count;return u.textContent=f,i}}]),n}(He.EventEmitter),q5=O(4157);function x_(t){var a=E_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function E_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var fn=function(t){(0,N.Z)(n,t);var a=x_(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this),n.controlCount++,e.controlOption=(0,T.Z)((0,T.Z)({},e.getDefault(r)),r||{}),e}return(0,L.Z)(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var i=this.getDefault(e);Object.entries(e).forEach(function(o){var u=(0,re.Z)(o,2),s=u[0],l=u[1];l===void 0&&(e[s]=i[s])}),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=(0,T.Z)((0,T.Z)({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(M.IMapService),this.renderService=e.get(M.IRendererService),this.layerService=e.get(M.ILayerService),this.controlService=e.get(M.IControlService),this.configService=e.get(M.IGlobalConfigService),this.scene=e.get(M.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),pt(this.container,"l7-control");var i=this.controlOption,o=i.className,u=i.style;return o&&this.setClassName(o),u&&this.setStyle(u),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;at(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return le("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var e=this.container;Vt(e,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e=this.container;pt(e,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:Ct.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var i=this.mapsService.getContainer();i!==null&&i.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ct.TOPLEFT,i=this.controlService;return i&&i.removeControl(this),this.controlOption.position=e,i&&i.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var i=this.container,o=this.controlOption.className;o&&Vt(i,o),e&&pt(i,e)}},{key:"setStyle",value:function(e){var i=this.container;e?i.setAttribute("style",e):i.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.container,i=this.controlOption.position,o=this.controlService.controlCorners[i];i.indexOf("bottom")!==-1?o.insertBefore(e,o.firstChild):o.appendChild(e)}},{key:"checkUpdateOption",value:function(e,i){return i.some(function(o){return o in e})}}]),n}(cr());(0,h.Z)(fn,"controlCount",0);function C_(t){var a=S_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function S_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var _r=function(t){(0,N.Z)(n,t);var a=C_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"isDisable",!1),r}return(0,L.Z)(n,[{key:"setIsDisable",value:function(e){if(this.isDisable=e,e){var i;(i=this.button)===null||i===void 0||i.setAttribute("disabled","true")}else{var o;(o=this.button)===null||o===void 0||o.removeAttribute("disabled")}}},{key:"createButton",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return le("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,i=e.title,o=e.btnText,u=e.btnIcon;return this.setBtnTitle(i),this.setBtnText(o),this.setBtnIcon(u),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var i=e.title,o=e.btnText,u=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(i),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(o),(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var i;(i=this.button)===null||i===void 0||i.setAttribute("title",e!=null?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&at(this.buttonIcon),e){var i,o=(i=this.button)===null||i===void 0?void 0:i.firstChild;if(o){var u;(u=this.button)===null||u===void 0||u.insertBefore(e,o)}else{var s;(s=this.button)===null||s===void 0||s.appendChild(e)}this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(!!this.button)if(Vt(this.button,"l7-button-control--row"),Vt(this.button,"l7-button-control--column"),e){var i=this.buttonText;if(!i){var o;i=le("div","l7-button-control__text"),(o=this.button)===null||o===void 0||o.appendChild(i),this.buttonText=i}i.innerText=e,pt(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(at(this.buttonText),this.buttonText=void 0)}}]),n}(fn);function b_(t){var a=A_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function A_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var fl=function(t){(0,N.Z)(n,t);var a=b_(n);function n(r,e){var i;return(0,R.Z)(this,n),i=a.call(this),(0,h.Z)((0,C.Z)(i),"isShow",!1),(0,h.Z)((0,C.Z)(i),"timeout",null),(0,h.Z)((0,C.Z)(i),"show",function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),Vt(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach(function(o){o!==(0,C.Z)(i)&&o.isShow&&o.hide()}),i.emit("show")),(0,C.Z)(i)}),(0,h.Z)((0,C.Z)(i),"hide",function(){return i.isShow&&(pt(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide")),(0,C.Z)(i)}),(0,h.Z)((0,C.Z)(i),"setHideTimeout",function(){i.timeout||(i.timeout=window.setTimeout(function(){!i.isShow||(i.hide(),i.timeout=null)},300))}),(0,h.Z)((0,C.Z)(i),"clearHideTimeout",function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)}),(0,h.Z)((0,C.Z)(i),"onBtnClick",function(){i.isShow?i.hide():i.show()}),(0,h.Z)((0,C.Z)(i),"onBtnMouseLeave",function(){i.setHideTimeout()}),(0,h.Z)((0,C.Z)(i),"onBtnMouseMove",function(){i.clearHideTimeout(),!i.isShow&&i.show()}),i.button=r,i.option=e,i.init(),e.unique&&n.conflictPopperList.push((0,C.Z)(i)),i}return(0,L.Z)(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){typeof e=="string"?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(nr(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),e==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),at(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},i=this.option,o=i.container,u=i.offset,s=u===void 0?[0,0]:u,l=i.placement,c=(0,re.Z)(s,2),f=c[0],p=c[1],d=this.button.getBoundingClientRect(),g=o.getBoundingClientRect(),m=Yp(d,g),_=m.left,y=m.right,x=m.top,E=m.bottom,b=!1,A=!1;/^(left|right)/.test(l)?(l.includes("left")?e.right="".concat(d.width+y,"px"):l.includes("right")&&(e.left="".concat(d.width+_,"px")),l.includes("start")?e.top="".concat(x,"px"):l.includes("end")?e.bottom="".concat(E,"px"):(e.top="".concat(x+d.height/2,"px"),A=!0,e.transform="translate(".concat(f,"px, calc(").concat(p,"px - 50%))"))):/^(top|bottom)/.test(l)&&(l.includes("top")?e.bottom="".concat(d.height+E,"px"):l.includes("bottom")&&(e.top="".concat(d.height+x,"px")),l.includes("start")?e.left="".concat(_,"px"):l.includes("end")?e.right="".concat(y,"px"):(e.left="".concat(_+d.width/2,"px"),b=!0,e.transform="translate(calc(".concat(f,"px - 50%), ").concat(p,"px)"))),e.transform="translate(calc(".concat(f,"px - ").concat(b?"50%":"0%","), calc(").concat(p,"px - ").concat(A?"50%":"0%",")");var F=l.split("-");F.length&&pt(this.popperDOM,F.map(function(I){return"l7-popper-".concat(I)}).join(" ")),Za(this.popperDOM,Xp(e))}},{key:"createPopper",value:function(){var e=this.option,i=e.container,o=e.className,u=o===void 0?"":o,s=e.content,l=le("div","l7-popper l7-popper-hide ".concat(u)),c=le("div","l7-popper-content"),f=le("div","l7-popper-arrow");return l.appendChild(c),l.appendChild(f),i.appendChild(l),this.popperDOM=l,this.contentDOM=c,s&&this.setContent(s),l}}]),n}(He.EventEmitter);(0,h.Z)(fl,"conflictPopperList",[]);function T_(t){var a=M_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function M_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var R_={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},L_=function(t){(0,N.Z)(n,t);var a=T_(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,ge.Z)((0,S.Z)(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var i,o=(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e),u=(i=e==null?void 0:e.position)!==null&&i!==void 0?i:o.position;return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:R_[u],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,i=this.controlOption,o=i.popperClassName,u=i.popperPlacement,s=i.popperTrigger,l=this.mapsService.getMapContainer();return this.popper=new fl(this.button,{className:o,placement:u,trigger:s,container:l,unique:!0}),this.popper.on("show",function(){e.emit("popperShow",e)}).on("hide",function(){e.emit("popperHide",e)}),this.popper}},{key:"setOptions",value:function(e){if((0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var i=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(i)}}}]),n}(_r);function O_(t){var a=k_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function k_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var bt;(function(t){t.ActiveOptionClassName="l7-select-control-item-active",t.OptionValueAttrKey="data-option-value",t.OptionIndexAttrKey="data-option-index"})(bt||(bt={}));var pl=function(t){(0,N.Z)(n,t);var a=O_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"selectValue",[]),(0,h.Z)((0,C.Z)(r),"createNormalOption",function(u){var s=r.selectValue.includes(u.value),l=le("div","l7-select-control-item ".concat(s?bt.ActiveOptionClassName:""));r.getIsMultiple()&&l.appendChild(r.createCheckbox(s)),u.icon&&l.appendChild(u.icon);var c=le("span");return c.innerText=u.text,l.appendChild(c),l}),(0,h.Z)((0,C.Z)(r),"onItemClick",function(u){if(r.getIsMultiple()){var s=r.selectValue.findIndex(function(l){return l===u.value});s>-1?r.selectValue.splice(s,1):r.selectValue=[].concat((0,G.Z)(r.selectValue),[u.value])}else r.selectValue=[u.value];r.setSelectValue(r.selectValue)}),r}return(0,L.Z)(n,[{key:"setOptions",value:function(e){(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e);var i=e.options;i&&this.popper.setContent(this.getPopperContent(i))}},{key:"onAdd",value:function(){var e=(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this),i=this.controlOption.defaultValue;return i&&(this.selectValue=this.transSelectValue(i)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=this.transSelectValue(e);this.optionDOMList.forEach(function(s){var l=s.getAttribute(bt.OptionValueAttrKey),c=i.getIsMultiple()?s.querySelector("input[type=checkbox]"):void 0;u.includes(l)?(pt(s,bt.ActiveOptionClassName),c&&ai(c,!0)):(Vt(s,bt.ActiveOptionClassName),c&&ai(c,!1))}),this.selectValue=u,o&&this.emit("selectChange",this.getIsMultiple()?u:u[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var i=this,o=this.isImageOptions(),u=le("div",o?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&pt(u,"l7-select-control--multiple");var s=e.map(function(l,c){var f=o?i.createImageOption(l):i.createNormalOption(l);return f.setAttribute(bt.OptionValueAttrKey,l.value),f.setAttribute(bt.OptionIndexAttrKey,window.String(c)),f.addEventListener("click",i.onItemClick.bind(i,l)),f});return u.append.apply(u,(0,G.Z)(s)),this.optionDOMList=s,u}},{key:"createImageOption",value:function(e){var i=this.selectValue.includes(e.value),o=le("div","l7-select-control-item ".concat(i?bt.ActiveOptionClassName:"")),u=le("img");u.setAttribute("src",e.img),Ua(u),o.appendChild(u);var s=le("div","l7-select-control-item-row");this.getIsMultiple()&&o.appendChild(this.createCheckbox(i));var l=le("span");return l.innerText=e.text,s.appendChild(l),o.appendChild(s),o}},{key:"createCheckbox",value:function(e){var i=le("input");return i.setAttribute("type","checkbox"),e&&ai(i,!0),i}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(e){return e.img})}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(L_);function F_(t){var a=P_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function P_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var D_=function(t){(0,N.Z)(n,t);var a=F_(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getDefault",value:function(){return{position:Ct.BOTTOMLEFT,name:"logo",href:"https://l7.antv.vision/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=le("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(nr(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var i=this.controlOption,o=i.href,u=i.img,s=le("img");if(s.setAttribute("src",u),s.setAttribute("aria-label","AntV logo"),Ua(s),o){var l=le("a","l7-control-logo-link");l.target="_blank",l.href=o,l.rel="noopener nofollow",l.setAttribute("rel","noopener nofollow"),l.appendChild(s),e.appendChild(l)}else e.appendChild(s)}}]),n}(fn),At=function(a){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("l7-iconfont"),n.setAttribute("aria-hidden","true");var r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(a)),n.appendChild(r),n};function dl(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=w_(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function w_(t,a){if(!!t){if(typeof t=="string")return vl(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vl(t,a)}}function vl(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var hl=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Tt=function(){if(typeof document=="undefined")return!1;var t=hl[0],a={},n=dl(hl),r;try{for(n.s();!(r=n.n()).done;){var e=r.value,i=e==null?void 0:e[1];if(i in document){var o=dl(e.entries()),u;try{for(o.s();!(u=o.n()).done;){var s=(0,re.Z)(u.value,2),l=s[0],c=s[1];a[t[l]]=c}}catch(f){o.e(f)}finally{o.f()}return a}}}catch(f){n.e(f)}finally{n.f()}return!1}(),gl={change:Tt.fullscreenchange,error:Tt.fullscreenerror},et={request:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,n=arguments.length>1?arguments[1]:void 0;return new Promise(function(r,e){var i=function u(){et.off("change",u),r()};et.on("change",i);var o=a[Tt.requestFullscreen](n);o instanceof Promise&&o.then(i).catch(e)})},exit:function(){return new Promise(function(a,n){if(!et.isFullscreen){a();return}var r=function i(){et.off("change",i),a()};et.on("change",r);var e=document[Tt.exitFullscreen]();e instanceof Promise&&e.then(r).catch(n)})},toggle:function(a,n){return et.isFullscreen?et.exit():et.request(a,n)},onchange:function(a){et.on("change",a)},onerror:function(a){et.on("error",a)},on:function(a,n){var r=gl[a];r&&document.addEventListener(r,n,!1)},off:function(a,n){var r=gl[a];r&&document.removeEventListener(r,n,!1)},raw:Tt};Object.defineProperties(et,{isFullscreen:{get:function(){return Boolean(document[Tt.fullscreenElement])}},element:{enumerable:!0,get:function(){var a;return(a=document[Tt.fullscreenElement])!==null&&a!==void 0?a:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Tt.fullscreenEnabled])}}}),Tt||(et={isEnabled:!1});var Ui=et;function I_(t){var a=B_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function B_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var J5=function(t){(0,N.Z)(n,t);var a=I_(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),(0,h.Z)((0,C.Z)(e),"isFullscreen",!1),(0,h.Z)((0,C.Z)(e),"toggleFullscreen",(0,te.Z)(H().mark(function i(){return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Ui.isEnabled){u.next=3;break}return u.next=3,Ui.toggle(e.mapContainer);case 3:case"end":return u.stop()}},i)}))),(0,h.Z)((0,C.Z)(e),"onClick",function(){e.toggleFullscreen()}),(0,h.Z)((0,C.Z)(e),"onFullscreenChange",function(){e.isFullscreen=!!document.fullscreenElement;var i=e.controlOption,o=i.btnText,u=i.btnIcon,s=i.title,l=i.exitBtnText,c=i.exitBtnIcon,f=i.exitTitle;e.isFullscreen?(e.setBtnTitle(f),e.setBtnText(l),e.setBtnIcon(c)):(e.setBtnTitle(s),e.setBtnText(o),e.setBtnIcon(u)),e.emit("fullscreenChange",e.isFullscreen)}),Ui.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),e}return(0,L.Z)(n,[{key:"setOptions",value:function(e){var i=e.exitBtnText,o=e.exitBtnIcon,u=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(o),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(i),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(u)),(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=wa(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){(0,ge.Z)((0,S.Z)(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5168\u5C4F",btnIcon:At("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:At("l7-icon-exit-fullscreen")})}}]),n}(_r);function N_(t){var a=Z_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Z_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var e4=function(t){(0,N.Z)(n,t);var a=N_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"onClick",(0,te.Z)(H().mark(function u(){var s;return H().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s=r.controlOption.onExport,s!=null){c.next=5;break}c.next=10;break;case 5:return c.t0=s,c.next=8,r.getImage();case 8:c.t1=c.sent,(0,c.t0)(c.t1);case 10:case"end":return c.stop()}},u)}))),(0,h.Z)((0,C.Z)(r),"mergeImage",(0,te.Z)(H().mark(function u(){var s,l,c,f,p,d,g,m,_,y,x,E,b,A,F=arguments;return H().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:for(c=r.controlOption.imageType,f=(s=(l=r.mapsService.getContainer())===null||l===void 0?void 0:l.getBoundingClientRect())!==null&&s!==void 0?s:{},p=f.width,d=p===void 0?0:p,g=f.height,m=g===void 0?0:g,_=document.createElement("canvas"),_.width=d,_.height=m,y=_.getContext("2d"),x=F.length,E=new Array(x),b=0;b<x;b++)E[b]=F[b];return k.next=9,Promise.all(E.map(function(w){return new Promise(function(z){var $=new Image;$.onload=function(){z($)},$.src=w})}));case 9:return A=k.sent,A.forEach(function(w){y==null||y.drawImage(w,0,0,d,m)}),k.abrupt("return",_.toDataURL("image/".concat(c)));case 12:case"end":return k.stop()}},u)}))),r}return(0,L.Z)(n,[{key:"onAdd",value:function(){var e=(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:At("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var e=this.mapsService.exportMap("png"),i=this.scene.exportPng("png");return this.mergeImage(e,i)}}]),n}(_r);function z_(t){var a=U_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function U_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var t4=function(t){(0,N.Z)(n,t);var a=z_(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),(0,h.Z)((0,C.Z)(e),"getGeoLocation",function(){return new Promise(function(i,o){window.navigator.geolocation.getCurrentPosition(function(u){var s=u.coords,l=s!=null?s:{},c=l.longitude,f=l.latitude;!(0,P.isNaN)(c)&&!(0,P.isNaN)(f)?i([c,f]):o()},function(u){o(u)})})}),(0,h.Z)((0,C.Z)(e),"onClick",(0,te.Z)(H().mark(function i(){var o,u,s;return H().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(window.navigator.geolocation){c.next=2;break}return c.abrupt("return");case 2:return o=e.controlOption.transform,c.next=5,e.getGeoLocation();case 5:if(u=c.sent,s=e.mapsService.getZoom(),c.t0=e.mapsService,c.t1=s>15?s:15,!o){c.next=15;break}return c.next=12,o(u);case 12:c.t2=c.sent,c.next=16;break;case 15:c.t2=u;case 16:c.t3=c.t2,c.t0.setZoomAndCenter.call(c.t0,c.t1,c.t3);case 18:case"end":return c.stop()}},i)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),e}return(0,L.Z)(n,[{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5B9A\u4F4D",btnIcon:At("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(_r),j_={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-nqiT6Vu948AAAAAAAAAAAAAARQnAQ"},light:{text:"\u6708\u5149\u94F6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*J_wYQL_PaUEAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*U7M9QI1yat4AAAAAAAAAAAAAARQnAQ"},fresh:{text:"\u8349\u8272\u9752",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*T-oBT4hB5ucAAAAAAAAAAAAAARQnAQ"},grey:{text:"\u96C5\u58EB\u7070",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OREXQ4vgQRIAAAAAAAAAAAAAARQnAQ"},graffiti:{text:"\u6D82\u9E26",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*4UApTKmeiy4AAAAAAAAAAAAAARQnAQ"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*0GrCQLtDjNcAAAAAAAAAAAAAARQnAQ"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*uWxqSZQlPkkAAAAAAAAAAAAAARQnAQ"},wine:{text:"\u9171\u7C7D",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OFPrTbg3an0AAAAAAAAAAAAAARQnAQ"}},H_={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*AnfJTbIBJOkAAAAAAAAAAAAAARQnAQ"},light:{text:"\u4EAE",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gnuiQIok9qIAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u6697",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*NwG-TbOlBH0AAAAAAAAAAAAAARQnAQ"},satellite:{text:"\u536B\u661F",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*2X5EQLKul3IAAAAAAAAAAAAAARQnAQ"},outdoors:{text:"\u6237\u5916",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gXFLRIaBUI0AAAAAAAAAAAAAARQnAQ"}};function V_(t){var a=G_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function G_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var n4=function(t){(0,N.Z)(n,t);var a=V_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"onMapThemeChange",function(){r.mapsService.setMapStyle(r.selectValue[0])}),r}return(0,L.Z)(n,[{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:At("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e=this.mapsService.getType()==="mapbox"?H_:j_;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(i){var o=(0,re.Z)(i,2),u=o[0],s=o[1];return typeof s=="string"&&u!=="blank"}).map(function(i){var o,u=(0,re.Z)(i,2),s=u[0],l=u[1],c=(o=e[s])!==null&&o!==void 0?o:{},f=c.text,p=c.img;return{text:f!=null?f:s,value:l,img:p,key:s}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,i=this;if((e=this.controlOption.options)!==null&&e!==void 0&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var o,u,s=this.controlOption.defaultValue;this.controlOption.defaultValue=(o=(u=this.controlOption.options.find(function(c){return c.key===s}))===null||u===void 0?void 0:u.value)!==null&&o!==void 0?o:s}else{var l=this.getMapStyle();l?this.controlOption.defaultValue=l:this.mapsService.map.once("styledata",function(){var c=i.mapsService.getMapStyle();i.controlOption.defaultValue=c,i.setSelectValue(c,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(pl);function W_(t){var a=$_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function $_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var r4=function(t){(0,N.Z)(n,t);var a=W_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"onLayerChange",function(){var u;(u=r.controlOption.layers)!==null&&u!==void 0&&u.length||(r.selectValue=r.getLayerVisible(),r.setOptions({options:r.getLayerOptions()}))}),(0,h.Z)((0,C.Z)(r),"onLayerVisibleChane",function(){r.setSelectValue(r.getLayerVisible())}),(0,h.Z)((0,C.Z)(r),"onSelectChange",function(){r.layers.forEach(function(u){var s=r.selectValue.includes(u.name),l=u.isVisible();s&&!l&&u.show(),!s&&l&&u.hide()})}),r}return(0,L.Z)(n,[{key:"layers",get:function(){var e=this.layerService,i=this.controlOption.layers;if(Array.isArray(i)&&i.length){var o=[];return i.forEach(function(u){if(u instanceof Object&&o.push(u),typeof u=="string"){var s=e.getLayer(u)||e.getLayerByName(u);s&&o.push(s)}}),o}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:At("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(e){return e.isVisible()}).map(function(e){return e.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(e){return{text:e.name,value:e.name}})}},{key:"setOptions",value:function(e){var i=this.checkUpdateOption(e,["layers"]);(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e),i&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return(e=this.controlOption.options)!==null&&e!==void 0&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,ge.Z)((0,S.Z)(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),n}(pl);function X_(t){var a=Y_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Y_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var i4=function(t){(0,N.Z)(n,t);var a=X_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"location",[0,0]),(0,h.Z)((0,C.Z)(r),"onMouseMove",function(u){var s=r.location,l=u.lngLat||u.lnglat,c=r.controlOption.transform;l&&(s=[l.lng,l.lat]),r.location=s,c&&(s=c(s)),r.insertLocation2HTML(s),r.emit("locationChange",s)}),r}return(0,L.Z)(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{position:Ct.BOTTOMLEFT,transform:function(o){var u=(0,re.Z)(o,2),s=u[0],l=u[1];return[+(+s).toFixed(6),+(+l).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=le("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),n}(fn);function K_(t){var a=Q_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Q_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var a4=function(t){(0,N.Z)(n,t);var a=K_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"zoomIn",function(){!r.disabled&&r.mapsService.getZoom()<r.mapsService.getMaxZoom()&&r.mapsService.zoomIn()}),(0,h.Z)((0,C.Z)(r),"zoomOut",function(){!r.disabled&&r.mapsService.getZoom()>r.mapsService.getMinZoom()&&r.mapsService.zoomOut()}),(0,h.Z)((0,C.Z)(r),"updateDisabled",function(){var u=r.mapsService;r.zoomInButton.removeAttribute("disabled"),r.zoomOutButton.removeAttribute("disabled"),(r.disabled||u.getZoom()<=u.getMinZoom())&&r.zoomOutButton.setAttribute("disabled","true"),(r.disabled||u.getZoom()>=u.getMaxZoom())&&r.zoomInButton.setAttribute("disabled","true")}),r}return(0,L.Z)(n,[{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{position:Ct.BOTTOMRIGHT,name:"zoom",zoomInText:At("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:At("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(e){(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=le("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){nr(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,i,o,u,s){var l=le("button",o,u);return typeof e=="string"?l.innerHTML=e:l.append(e),l.title=i,l.addEventListener("click",s),l}}]),n}(fn);function q_(t){var a=J_();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function J_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var o4=function(t){(0,N.Z)(n,t);var a=q_(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"update",function(){var u=r.mapsService,s=r.controlOption.maxWidth,l=u.getSize()[1]/2,c=u.containerToLngLat([0,l]),f=u.containerToLngLat([s,l]),p=vd([c.lng,c.lat],[f.lng,f.lat]);r.updateScales(p)}),r}return(0,L.Z)(n,[{key:"getDefault",value:function(e){return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:Ct.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e="l7-control-scale",i=le("div",e);this.resetScaleLines(i);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),i}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var i=this.controlOption,o=i.metric,u=i.imperial;o&&e&&this.updateMetric(e),u&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){nr(e);var i=this.controlOption,o=i.metric,u=i.imperial,s=i.maxWidth,l=i.lockWidth;l&&Za(e,"width: ".concat(s,"px")),o&&(this.mScale=le("div","l7-control-scale-line",e)),u&&(this.iScale=le("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,i,o){var u=this.controlOption.maxWidth;e.style.width=Math.round(u*o)+"px",e.innerHTML=i}},{key:"getRoundNum",value:function(e){var i=Math.pow(10,(Math.floor(e)+"").length-1),o=e/i;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,i*o}},{key:"updateMetric",value:function(e){var i=this.getRoundNum(e),o=i<1e3?i+" m":i/1e3+" km";this.updateScale(this.mScale,o,i/e)}},{key:"updateImperial",value:function(e){var i=e*3.2808399,o,u,s;i>5280?(o=i/5280,u=this.getRoundNum(o),this.updateScale(this.iScale,u+" mi",u/o)):(s=this.getRoundNum(i),this.updateScale(this.iScale,s+" ft",s/i))}}]),n}(fn);function ey(t){var a=ty();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ty(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var ji=function(t){(0,N.Z)(n,t);var a=ey(n);function n(r){var e;(0,R.Z)(this,n),e=a.call(this),(0,h.Z)((0,C.Z)(e),"isShow",!0),(0,h.Z)((0,C.Z)(e),"onMouseMove",function(o){var u,s=e.mapsService.getMapContainer(),l=(u=s==null?void 0:s.getBoundingClientRect())!==null&&u!==void 0?u:{},c=l.left,f=c===void 0?0:c,p=l.top,d=p===void 0?0:p;e.setPopupPosition(o.clientX-f,o.clientY-d)}),(0,h.Z)((0,C.Z)(e),"updateLngLatPosition",function(){if(!(!e.mapsService||e.popupOption.followCursor)){var o=e.lngLat,u=o.lng,s=o.lat,l=e.mapsService.lngLatToContainer([u,s]),c=l.x,f=l.y;e.setPopupPosition(c,f)}}),(0,h.Z)((0,C.Z)(e),"onKeyDown",function(o){o.keyCode===27&&e.remove()}),(0,h.Z)((0,C.Z)(e),"onCloseButtonClick",function(o){o.stopPropagation&&o.stopPropagation(),e.remove()}),(0,h.Z)((0,C.Z)(e),"update",function(){var o=!!e.lngLat,u=e.popupOption,s=u.className,l=u.style,c=u.maxWidth,f=u.anchor,p=u.stopPropagation;if(!(!e.mapsService||!o||!e.content)){var d=e.mapsService.getMarkerContainer();!e.container&&d&&(e.container=le("div","l7-popup ".concat(s!=null?s:""," ").concat(e.isShow?"":"l7-popup-hide"),d),l&&e.container.setAttribute("style",l),e.tip=le("div","l7-popup-tip",e.container),e.container.appendChild(e.content),p&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(g){e.container.addEventListener(g,function(m){m.stopPropagation()})}),e.container.style.whiteSpace="nowrap"),c&&e.container.style.maxWidth!==c&&(e.container.style.maxWidth=c),e.updateLngLatPosition(),Na(e.container,"".concat(or[f])),Ja(e.container,f,"popup")}}),e.popupOption=(0,T.Z)((0,T.Z)({},e.getDefault(r!=null?r:{})),r);var i=e.popupOption.lngLat;return i&&(e.lngLat=i),e}return(0,L.Z)(n,[{key:"lngLat",get:function(){var e;return(e=this.popupOption.lngLat)!==null&&e!==void 0?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(M.IMapService),this.sceneService=e.get(M.ISceneService),this.layerService=e.get(M.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var i=this.popupOption,o=i.html,u=i.text;return o?this.setHTML(o):u&&this.setText(u),this.emit("open"),this}},{key:"remove",value:function(){if(!!this.isOpen())return this.content&&at(this.content),this.container&&(at(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.popupOption=(0,T.Z)((0,T.Z)({},this.popupOption),e),this.checkUpdateOption(e,["closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets","title"])&&(this.container&&(at(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Vt(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&pt(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(this.getPopupHTMLFragment(e))}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"panToPopup",value:function(){var e=this.lngLat,i=e.lng,o=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([i,o]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var i=this;return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){i.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:ar.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.createContent(),this.contentPanel.appendChild(e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){this.mapsService.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&this.mapsService.on("click",this.onCloseButtonClick)}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var i=this.mapsService.getContainer();i.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&i.addEventListener("mousemove",this.onMouseMove)}},{key:"createContent",value:function(){if(this.content&&at(this.content),this.content=le("div","l7-popup-content",this.container),this.popupOption.title){var e;this.contentTitle=le("div","l7-popup-content__title",this.content),(e=this.contentTitle)===null||e===void 0||e.append(this.getPopupHTMLFragment(this.popupOption.title))}else this.contentTitle=void 0;if(this.popupOption.closeButton){var i=At("l7-icon-guanbi");pt(i,"l7-popup-close-button"),this.content.appendChild(i),this.popupOption.closeButtonOffsets&&(i.style.right=this.popupOption.closeButtonOffsets[0]+"px",i.style.top=this.popupOption.closeButtonOffsets[1]+"px"),i.setAttribute("aria-label","Close popup"),i.addEventListener("click",this.onCloseButtonClick),this.closeButton=i}else this.closeButton=void 0;this.contentPanel=le("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,i){if(this.container){var o=this.popupOption.offsets;this.container.style.left=e+o[0]+"px",this.container.style.top=i-o[1]+"px"}}},{key:"checkUpdateOption",value:function(e,i){return i.some(function(o){return o in e})}},{key:"getPopupHTMLFragment",value:function(e){var i=window.document.createDocumentFragment(),o=window.document.createElement("body"),u;for(typeof e=="string"?o.innerHTML=e:Array.isArray(e)?o.append.apply(o,(0,G.Z)(e)):e instanceof HTMLElement&&o.append(e);u=o.firstChild,!!u;)i.appendChild(u);return i}}]),n}(He.EventEmitter);function ny(t){var a=ry();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ry(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var u4=function(t){(0,N.Z)(n,t);var a=ny(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"layerConfigMap",new WeakMap),r}return(0,L.Z)(n,[{key:"addTo",value:function(e){return(0,ge.Z)((0,S.Z)(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,ge.Z)((0,S.Z)(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),(0,ge.Z)((0,S.Z)(n.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var i=e.trigger==="click";return(0,T.Z)((0,T.Z)({},(0,ge.Z)((0,S.Z)(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!i,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,i=this.popupOption,o=i.config,u=i.trigger;o.forEach(function(s){var l=e.getLayerByConfig(s);if(!!l){var c=(0,T.Z)({},s);if(u==="hover"){var f=e.onLayerMouseMove.bind(e,l),p=e.onLayerMouseOut.bind(e,l);c.onMouseMove=f,c.onMouseOut=p,l==null||l.on("mousemove",f),l==null||l.on("mouseout",p)}else{var d=e.onLayerClick.bind(e,l);c.onClick=d,l==null||l.on("click",d)}var g=l.getSource(),m=e.onSourceUpdate.bind(e,l);g==null||g.on("update",m),c.onSourceUpdate=m,e.layerConfigMap.set(l,c)}})}},{key:"unbindLayerEvent",value:function(){var e=this,i=this.popupOption.config;i.forEach(function(o){var u=e.getLayerByConfig(o),s=u&&e.layerConfigMap.get(u);if(!!s){var l=s.onMouseMove,c=s.onMouseOut,f=s.onClick,p=s.onSourceUpdate;if(l&&u.off("mousemove",l),c&&u.off("mouseout",c),f&&u.off("click",f),p){var d;u==null||(d=u.getSource())===null||d===void 0||d.off("update",p)}}})}},{key:"onLayerMouseMove",value:function(e,i){if(!this.isSameFeature(e,i.featureId)){var o=this.getLayerInfoFrag(e,i);this.setDOMContent(o),this.displayFeatureInfo={layer:e,featureId:i.featureId}}this.isShow||this.show()}},{key:"onLayerMouseOut",value:function(e,i){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,i){if(this.isShow&&this.isSameFeature(e,i.featureId))this.hide();else{var o=this.getLayerInfoFrag(e,i);this.setDOMContent(o),this.setLnglat(i.lngLat),this.show(),this.displayFeatureInfo={layer:e,featureId:i.featureId}}}},{key:"onSourceUpdate",value:function(e){var i;((i=this.displayFeatureInfo)===null||i===void 0?void 0:i.layer)===e&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(e,i){var o=this.layerConfigMap.get(e),u=document.createDocumentFragment();if(o){var s=i.feature;s.type==="Feature"&&"properties"in s&&"geometry"in s&&(s=s.properties);var l=o.fields;l==null||l.forEach(function(c){var f=typeof c=="string"?{field:c}:c,p=f.field,d=f.formatField,g=f.formatValue,m=f.getValue,_=le("div","l7-layer-popup__row"),y=m?m(i.feature):(0,P.get)(s,p);_.innerHTML="".concat(d?d(p):p,": ").concat(g?g(y):y),u.appendChild(_)})}return u}},{key:"getLayerByConfig",value:function(e){var i=e.layer;if(i instanceof Object)return i;if(typeof i=="string")return this.layerService.getLayer(i)||this.layerService.getLayerByName(i)}},{key:"isSameFeature",value:function(e,i){var o=this.displayFeatureInfo;return o&&e===o.layer&&i===o.featureId}}]),n}(ji);function iy(t,a){var n=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,r=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(n||r)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(a.createTextNode(t)),e.appendChild(o),o}}iy(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  pointer-events: none;
  will-change: transform;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  pointer-events: auto;
  font-size: 14px;
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  font-weight: bold;
  margin-bottom: 8px;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  line-height: 18px;
  text-align: center;
  padding: 0;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  font-size: 14px;
}
.l7-popup .l7-popup-tip {
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Zt,Hi=(Zt={},(0,h.Z)(Zt,vt.additive,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE,srcAlpha:1,dstAlpha:1}}),(0,h.Z)(Zt,vt.none,{enable:!1}),(0,h.Z)(Zt,vt.normal,{enable:!0,func:{srcRGB:v.SRC_ALPHA,dstRGB:v.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,h.Z)(Zt,vt.subtractive,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE,srcAlpha:v.ZERO,dstAlpha:v.ONE_MINUS_SRC_COLOR},equation:{rgb:v.FUNC_SUBTRACT,alpha:v.FUNC_SUBTRACT}}),(0,h.Z)(Zt,vt.max,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE},equation:{rgb:v.MAX_EXT}}),(0,h.Z)(Zt,vt.min,{enable:!0,func:{srcRGB:v.ONE,dstRGB:v.ONE},equation:{rgb:v.MIN_EXT}}),Zt);function Ge(t,a,n,r,e){a.updateStyleAttribute(t,n,r,e)}function ay(t,a){a.tileLayer||a.isTileLayer||(t.opacity&&yr("opacity",a,t.opacity),t.strokeWidth&&yr("strokeWidth",a,t.strokeWidth),t.strokeOpacity&&yr("strokeOpacity",a,t.strokeOpacity),t.stroke&&oy("stroke",a,t.stroke),t.offsets&&ml("offsets",a,t.offsets),t.textOffset&&ml("textOffset",a,t.textOffset),t.thetaOffset&&yr("thetaOffset",a,t.thetaOffset))}function yr(t,a,n){(0,P.isString)(n)?Ge(t,a,n,function(r){return r}):(0,P.isNumber)(n)?Ge(t,a,[n],void 0):Array.isArray(n)&&n.length===2?(0,P.isString)(n[0])&&(0,P.isFunction)(n[1])||(0,P.isString)(n[0])&&Array.isArray(n[1])&&(0,P.isNumber)(n[1][0])&&(0,P.isNumber)(n[1][1])?Ge(t,a,n[0],n[1]):Ge(t,a,[1],void 0):Ge(t,a,[1],void 0)}function ml(t,a,n){(0,P.isString)(n)?Ge(t,a,n,function(r){return r}):Array.isArray(n)&&n.length===2&&(0,P.isString)(n[0])&&(0,P.isFunction)(n[1])?Ge(t,a,n[0],n[1]):Array.isArray(n)&&n.length===2&&(0,P.isNumber)(n[0])&&(0,P.isNumber)(n[1])?Ge(t,a,n,void 0):Ge(t,a,[0,0],void 0)}function oy(t,a,n){(0,P.isString)(n)?Ge(t,a,n,void 0):Array.isArray(n)&&n.length===2&&((0,P.isString)(n[0])&&(0,P.isFunction)(n[1])||(0,P.isString)(n[0])&&Array.isArray(n[1])&&n[1].length>0)?Ge(t,a,n[0],n[1]):Ge(t,a,"#fff",void 0)}var Le;(function(t){t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.L7MAP="L7MAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL"})(Le||(Le={}));function uy(t,a){var n=[a[0]-t[0],a[1]-t[1]],r=Xa(n),e=[t[0]+r[0]*1e-4,t[1]+r[1]*1e-4];return e}function sy(t,a,n){if(t.length>0&&a.version===Le["GAODE2.x"]){var r=n.coordCenter;typeof t[0].coordinates[0]=="number"?t.filter(function(e){return!e.originCoordinates}).map(function(e){e.version=Le["GAODE2.x"],e.originCoordinates=(0,P.cloneDeep)(e.coordinates),e.coordinates=a.lngLatToCoordByLayer(e.coordinates,r)}):t.filter(function(e){return!e.originCoordinates}).map(function(e){e.version=Le["GAODE2.x"],e.originCoordinates=(0,P.cloneDeep)(e.coordinates),e.coordinates=a.lngLatToCoordsByLayer(e.coordinates,r)})}}function ly(t,a){t.length>0&&a.version===Le.SIMPLE&&t.map(function(n){n.simpleCoordinate||(n.coordinates=cy(n.coordinates,a),n.simpleCoordinate=!0)})}function cy(t,a){if(typeof t[0]=="number")return a.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map(function(e){var i=[];e.map(function(o){i.push(a.simpleMapCoord.unproject(o))}),n.push(i)}),n}else{var r=[];return t.map(function(e){r.push(a.simpleMapCoord.unproject(e))}),r}}function fy(t,a,n){var r;if(!t.scale)return[];var e=(t==null||(r=t.scale)===null||r===void 0?void 0:r.scalers)||[],i=[];e.forEach(function(u){var s,l=u.field;(a.hasOwnProperty(l)||((s=t.scale)===null||s===void 0?void 0:s.type)==="variable")&&i.push(a[l])});var o=t.mapping?t.mapping(i):[];return t.name==="color"&&!qa(o[0])?[n]:o}function py(t,a,n,r,e,i){var o=i==null?void 0:i.getLayerConfig(),u=o.arrow,s=u===void 0?{enable:!1}:u,l=a.map(function(c){var f={id:c._id,coordinates:c.coordinates};if(t.filter(function(g){return g.scale!==void 0}).forEach(function(g){var m=fy(g,c,e);g.needRemapping=!1,g.name==="color"&&(m=m.map(function(_){return oe(_)})),f[g.name]=Array.isArray(m)&&m.length===1?m[0]:m,g.name==="shape"&&(f.shape=n.getIconFontKey(f[g.name]))}),f.shape==="line"&&s.enable){var p=f.coordinates,d=uy(p[0],p[1]);f.coordinates.splice(1,0,d,d)}return f});return sy(l,r,i),ly(l,r),l}function dy(t,a,n,r,e,i){var o=new In(e,i),u=t.getBottomColor(),s=r.getLayerStyleAttributes()||[],l=o.data.dataArray,c=l,f=py(s,c,a,n,u,t);return o.destroy(),f}function _l(t){return t.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function yl(t,a,n,r){var e=t.multiPassRenderer,i=t.getLayerConfig(),o=i.enableTAA;return o?e.add(r("taa")):e.add(r("render")),_l(a).forEach(function(u){var s=(0,re.Z)(u,2),l=s[0],c=s[1];e.add(n(l),c)}),e.add(n("copy")),e}var vy=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function hy(t,a,n){if(typeof a=="string"&&typeof n=="string"&&a!==n){if(t.type==="PointLayer"){t.dataState.dataSourceNeedUpdate=!0;return}vy.map(function(r){if(r.includes(a)&&r.includes(n)){t.dataState.dataSourceNeedUpdate=!0;return}})}}var gy=["passes"],_y=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],xl,Vi,El;function yy(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=xy(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function xy(t,a){if(!!t){if(typeof t=="string")return Cl(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cl(t,a)}}function Cl(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function Ey(t){var a=Cy();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Cy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Sl=0,gt=(xl=Zi(M.IGlobalConfigService),Vi=function(t){(0,N.Z)(n,t);var a=Ey(n);function n(){var r,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,R.Z)(this,n),r=a.call(this),(0,h.Z)((0,C.Z)(r),"id","".concat(Sl++)),(0,h.Z)((0,C.Z)(r),"name","".concat(Sl)),(0,h.Z)((0,C.Z)(r),"visible",!0),(0,h.Z)((0,C.Z)(r),"zIndex",0),(0,h.Z)((0,C.Z)(r),"inited",!1),(0,h.Z)((0,C.Z)(r),"layerModelNeedUpdate",!1),(0,h.Z)((0,C.Z)(r),"pickedFeatureID",null),(0,h.Z)((0,C.Z)(r),"selectedFeatureID",null),(0,h.Z)((0,C.Z)(r),"styleNeedUpdate",!1),(0,h.Z)((0,C.Z)(r),"forceRender",!1),(0,h.Z)((0,C.Z)(r),"clusterZoom",0),(0,h.Z)((0,C.Z)(r),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,h.Z)((0,C.Z)(r),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,h.Z)((0,C.Z)(r),"hooks",{init:new Ve.oI,afterInit:new Ve.oI,beforeRender:new Ve.oI,beforeRenderData:new Ve.gg,afterRender:new Ve.ni,beforePickingEncode:new Ve.ni,afterPickingEncode:new Ve.ni,beforeHighlight:new Ve.ni(["pickedColor"]),afterHighlight:new Ve.ni,beforeSelect:new Ve.ni(["pickedColor"]),afterSelect:new Ve.ni,beforeDestroy:new Ve.ni,afterDestroy:new Ve.ni}),(0,h.Z)((0,C.Z)(r),"models",[]),(0,h.Z)((0,C.Z)(r),"modelLoaded",!1),(0,h.Z)((0,C.Z)(r),"layerChildren",[]),(0,h.Z)((0,C.Z)(r),"masks",[]),(0,h.Z)((0,C.Z)(r),"isVector",!1),(0,ae.Z)((0,C.Z)(r),"configService",El,(0,C.Z)(r)),(0,h.Z)((0,C.Z)(r),"animateOptions",{enable:!1}),(0,h.Z)((0,C.Z)(r),"currentPickId",null),(0,h.Z)((0,C.Z)(r),"pendingStyleAttributes",[]),(0,h.Z)((0,C.Z)(r),"scaleOptions",{}),(0,h.Z)((0,C.Z)(r),"animateStatus",!1),(0,h.Z)((0,C.Z)(r),"bottomColor","rgba(0, 0, 0, 0)"),(0,h.Z)((0,C.Z)(r),"isDestroyed",!1),(0,h.Z)((0,C.Z)(r),"encodeDataLength",0),(0,h.Z)((0,C.Z)(r),"sourceEvent",function(){r.dataState.dataSourceNeedUpdate=!0;var i=r.getLayerConfig();i&&i.autoFit&&r.fitBounds(i.fitBoundsOptions),r.reRender()}),r.name=e.name||r.id,r.zIndex=e.zIndex||0,r.rawConfig=e,r}return(0,L.Z)(n,[{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var i=this.masks.indexOf(e);i>-1&&this.masks.splice(i,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var i=this;if(Object.keys(e).map(function(u){u in i.rawConfig&&(i.rawConfig[u]=e[u])}),!this.inited)this.needUpdateConfig=(0,T.Z)((0,T.Z)({},this.needUpdateConfig),e);else{var o=this.container.get(M.SceneID);ay(e,this),this.configService.setLayerConfig(o,this.id,(0,T.Z)((0,T.Z)((0,T.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(e,i){this.container=e,this.sceneContainer=i}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(e){this.bottomColor=e}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var e=this,i=this.container.get(M.SceneID);this.configService.setLayerConfig(i,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(M.IIconService),this.fontService=this.container.get(M.IFontService),this.rendererService=this.container.get(M.IRendererService),this.layerService=this.container.get(M.ILayerService),this.interactionService=this.container.get(M.IInteractionService),this.pickingService=this.container.get(M.IPickingService),this.mapService=this.container.get(M.IMapService);var o=this.getLayerConfig(),u=o.enableMultiPassRenderer,s=o.passes;u&&s!==null&&s!==void 0&&s.length&&s.length>0&&this.mapService.on("mapAfterFrameChange",function(){e.renderLayers()}),this.cameraService=this.container.get(M.ICameraService),this.coordinateService=this.container.get(M.ICoordinateSystemService),this.shaderModuleService=this.container.get(M.IShaderModuleService),this.postProcessingPassFactory=this.container.get(M.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(M.IFactoryNormalPass),this.styleAttributeService=this.container.get(M.IStyleAttributeService),this.multiPassRenderer=this.container.get(M.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(p){var d=p.attributeName,g=p.attributeField,m=p.attributeValues,_=p.updateOptions;e.styleAttributeService.updateStyleAttribute(d,{scale:(0,T.Z)({field:g},e.splitValuesAndCallbackInAttribute(m,e.getLayerConfig()[d]))},_)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(M.ILayerPlugin);var l=yy(this.plugins),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(p){l.e(p)}finally{l.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map(function(i){i.updateAttributesAndElements(e.attributes,e.elements)}):console.warn("data error")}},{key:"createModelData",value:function(e,i){var o;if((o=this.layerModel)!==null&&o!==void 0&&o.createModelData)return this.layerModel.createModelData(i);var u=this.calculateEncodeData(e,i),s=this.triangulation;return u&&s?this.styleAttributeService.createAttributesAndIndices(u,s):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(e,i){return this.inited?dy(this,this.fontService,this.mapService,this.styleAttributeService,e,i):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,T.Z)((0,T.Z)({},this.getDefaultConfig()),this.rawConfig));var e=this.getLayerConfig(),i=e.animateOption;i!=null&&i.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,i,o){return this.updateStyleAttribute("color",e,i,o),this}},{key:"texture",value:function(e,i,o){return this.updateStyleAttribute("texture",e,i,o),this}},{key:"rotate",value:function(e,i,o){return this.updateStyleAttribute("rotate",e,i,o),this}},{key:"size",value:function(e,i,o){return this.updateStyleAttribute("size",e,i,o),this}},{key:"filter",value:function(e,i,o){return this.updateStyleAttribute("filter",e,i,o),this}},{key:"shape",value:function(e,i,o){var u,s,l,c=(u=this.styleAttributeService)===null||u===void 0||(s=u.getLayerStyleAttribute("shape"))===null||s===void 0||(l=s.scale)===null||l===void 0?void 0:l.field,f=e;return this.shapeOption={field:e,values:i},this.updateStyleAttribute("shape",e,i,o),this.tileLayer||hy(this,c,f),this}},{key:"label",value:function(e,i,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:i,updateOptions:o}),this}},{key:"animate",value:function(e){var i={};return(0,P.isObject)(e)?(i.enable=!0,i=(0,T.Z)((0,T.Z)({},i),e)):i.enable=e,this.updateLayerConfig({animateOption:i}),this}},{key:"source",value:function(e,i){return(e==null?void 0:e.type)==="source"?(this.setSource(e),this):(this.sourceOption={data:e,options:i},this.clusterZoom=0,this)}},{key:"setData",value:function(e,i){var o=this;return this.inited?this.layerSource.setData(e,i):this.on("inited",function(){var u=o.getSource();u?o.layerSource.setData(e,i):(o.source(new In(e,i)),o.sourceEvent())}),this}},{key:"style",value:function(e){var i=this,o=this.getLayerConfig(),u=e.passes,s=(0,It.Z)(e,gy);return u&&_l(u).forEach(function(l){var c=i.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(l[0]);c&&c.updateOptions(l[1])}),this.rawConfig=(0,T.Z)((0,T.Z)({},this.rawConfig),s),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),o&&o.mask===!0&&e.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(l){i.models=l})),this}},{key:"scale",value:function(e,i){return(0,P.isObject)(e)?this.scaleOptions=(0,T.Z)((0,T.Z)({},this.scaleOptions),e):this.scaleOptions[e]=i,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var r=(0,te.Z)(H().mark(function i(){return H().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){u.next=2;break}return u.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){u.next=7;break}return u.next=5,this.multiPassRenderer.render();case 5:u.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return u.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"active",value:function(e){var i={};return i.enableHighlight=(0,P.isObject)(e)?!0:e,(0,P.isObject)(e)?(i.enableHighlight=!0,e.color&&(i.highlightColor=e.color),e.mix&&(i.activeMix=e.mix)):i.enableHighlight=!!e,this.updateLayerConfig(i),this}},{key:"setActive",value:function(e,i){var o=this;if((0,P.isObject)(e)){var u=e.x,s=u===void 0?0:u,l=e.y,c=l===void 0?0:l;this.updateLayerConfig({highlightColor:(0,P.isObject)(i)?i.color:this.getLayerConfig().highlightColor,activeMix:(0,P.isObject)(i)?i.mix:this.getLayerConfig().activeMix}),this.pick({x:s,y:c})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:(0,P.isObject)(i)?i.color:this.getLayerConfig().highlightColor,activeMix:(0,P.isObject)(i)?i.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ot(e)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(e){var i={};return i.enableSelect=(0,P.isObject)(e)?!0:e,(0,P.isObject)(e)?(i.enableSelect=!0,e.color&&(i.selectColor=e.color),e.mix&&(i.selectMix=e.mix)):i.enableSelect=!!e,this.updateLayerConfig(i),this}},{key:"setSelect",value:function(e,i){var o=this;if((0,P.isObject)(e)){var u=e.x,s=u===void 0?0:u,l=e.y,c=l===void 0?0:l;this.updateLayerConfig({selectColor:(0,P.isObject)(i)?i.color:this.getLayerConfig().selectColor,selectMix:(0,P.isObject)(i)?i.mix:this.getLayerConfig().selectMix}),this.pick({x:s,y:c})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:(0,P.isObject)(i)?i.color:this.getLayerConfig().selectColor,selectMix:(0,P.isObject)(i)?i.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ot(e)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),i=this.getLayerConfig(),o=i.visible,u=i.minZoom,s=u===void 0?-Infinity:u,l=i.maxZoom,c=l===void 0?Infinity:l;return!!o&&e>=s&&e<=c}},{key:"setMultiPass",value:function(e,i){if(this.updateLayerConfig({enableMultiPassRenderer:e}),i&&this.updateLayerConfig({passes:i}),e){var o=this.getLayerConfig(),u=o.passes,s=u===void 0?[]:u;this.multiPassRenderer=yl(this,s,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var l=this.rendererService.getViewportSize(),c=l.width,f=l.height;this.multiPassRenderer.resize(c,f)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){var e=this.getLayerConfig(),i=e.minZoom;return i}},{key:"getMaxZoom",value:function(){var e=this.getLayerConfig(),i=e.maxZoom;return i}},{key:"get",value:function(e){var i=this.getLayerConfig();return i[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var i=this.getSource(),o=i.extent,u=o.some(function(s){return Math.abs(s)===Infinity});return u?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],e),this)}},{key:"destroy",value:function(){var e,i,o,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(s){return s.destroy(!1)}),this.layerChildren=[],this.masks.map(function(s){return s.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(e=this.multiPassRenderer)===null||e===void 0||e.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(i=this.layerModel)===null||i===void 0||i.clearModels(u),(o=this.tileLayer)===null||o===void 0||o.destroy(),this.models=[],this.layerService.cleanRemove(this,u),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach(function(i){return i.destroy()}),(e=this.layerModel)===null||e===void 0||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices}).length}},{key:"setSource",value:function(e){var i=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var o=this.mapService.getZoom();this.layerSource.updateClusterData(o)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(){if(i.coordCenter===void 0){var u,s=i.layerSource.center;i.coordCenter=s,((u=i.mapService)===null||u===void 0?void 0:u.setCoordCenter)&&i.mapService.setCoordCenter(s)}i.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var i,o,u,s=this.styleAttributeService.getLayerStyleAttribute(e),l=(s==null||(i=s.scale)===null||i===void 0?void 0:i.scalers)||[];return{type:(o=l[0].option)===null||o===void 0?void 0:o.type,field:s==null||(u=s.scale)===null||u===void 0?void 0:u.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var i=this.styleAttributeService.getLayerAttributeScale(e);if(!i)return[];if(i.invertExtent){var o=i.range().map(function(l){return(0,h.Z)({value:i.invertExtent(l)},e,l)});return o}else if(i.ticks){var u=i.ticks().map(function(l){return(0,h.Z)({value:l},e,i(l))});return u}else if(i!=null&&i.domain){var s=i.domain().filter(function(l){return!(0,P.isUndefined)(l)}).map(function(l){return(0,h.Z)({value:l},e,i(l))});return s}return[]}},{key:"pick",value:function(e){var i=e.x,o=e.y;this.interactionService.triggerHover({x:i,y:o})}},{key:"boxSelect",value:function(e,i){this.pickingService.boxPickLayer(this,e,i)}},{key:"buildLayerModel",value:function(e){var i=this,o=e.moduleName,u=e.vertexShader,s=e.fragmentShader,l=e.triangulation,c=e.segmentNumber,f=e.workerEnabled,p=f===void 0?!1:f,d=e.workerOptions,g=(0,It.Z)(e,_y);this.shaderModuleService.registerModule(o,{vs:u,fs:s});var m=this.shaderModuleService.getModule(o),_=m.vs,y=m.fs,x=m.uniforms,E=this.rendererService.createModel;return new Promise(function(b,A){setTimeout(function(){if(d&&d.modelType in no&&p)i.styleAttributeService.createAttributesAndIndicesAscy(i.encodedData,c,d).then(function(X){var ne=X.attributes,se=X.elements,Ee=E((0,T.Z)({attributes:ne,uniforms:x,fs:y,vs:_,elements:se,blend:Hi[vt.normal]},g));b(Ee)}).catch(function(X){return A(X)});else{var F=i.styleAttributeService.createAttributesAndIndices(i.encodedData,l,c),I=F.attributes,k=F.elements,w=F.count,z=(0,T.Z)({attributes:I,uniforms:x,fs:y,vs:_,elements:k,blend:Hi[vt.normal]},g);w&&(z.count=w);var $=E(z);b($)}})})}},{key:"createAttributes",value:function(e){var i=e.triangulation,o=this.styleAttributeService.createAttributes(this.encodedData,i),u=o.attributes;return u}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){if(this.rawConfig.usage==="basemap")return!1;var i=this.getLayerConfig(),o=i.enableHighlight,u=o===void 0?!0:o,s=i.enableSelect,l=s===void 0?!0:s,c=this.eventNames().indexOf(e)!==-1||this.eventNames().indexOf("un"+e)!==-1;return(e==="click"||e==="dblclick")&&l&&(c=!0),e==="mousemove"&&(u||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(c=!0),this.isVisible()&&c}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var r=(0,te.Z)(H().mark(function i(o){return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,o.render();case 2:case"end":return s.stop()}},i)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"renderModels",value:function(e){var i=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(o){i.models=o,i.hooks.beforeRender.call(),i.layerModelNeedUpdate=!1}),this.models.forEach(function(o){o.draw({uniforms:i.layerModel.getUninforms()},e)}),this)}},{key:"updateStyleAttribute",value:function(e,i,o,u){this.inited?this.styleAttributeService.updateStyleAttribute(e,{scale:(0,T.Z)({field:i},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[i]))},u):this.pendingStyleAttributes.push({attributeName:e,attributeField:i,attributeValues:o,updateOptions:u})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"dispatchModelLoad",value:function(e){var i=this;this.models.forEach(function(o){return o.destroy()}),this.models=[],this.models=e,this.emit("modelLoaded",null),this.modelLoaded=!0,setTimeout(function(){i.layerService.renderLayers()},32)}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,i){return{values:(0,P.isFunction)(e)?void 0:e||i,callback:(0,P.isFunction)(e)?e:void 0}}}]),n}(He.EventEmitter),El=(0,ie.Z)(Vi.prototype,"configService",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vi),bl,Gi,Al;function Sy(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=by(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function by(t,a){if(!!t){if(typeof t=="string")return Tl(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tl(t,a)}}function Tl(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var ue=(bl=Zi(M.IGlobalConfigService),Gi=function(){function t(a){(0,R.Z)(this,t),(0,ae.Z)(this,"configService",Al,this),this.layer=a,this.rendererService=a.getContainer().get(M.IRendererService),this.pickingService=a.getContainer().get(M.IPickingService),this.shaderModuleService=a.getContainer().get(M.IShaderModuleService),this.styleAttributeService=a.getContainer().get(M.IStyleAttributeService),this.mapService=a.getContainer().get(M.IMapService),this.iconService=a.getContainer().get(M.IIconService),this.fontService=a.getContainer().get(M.IFontService),this.cameraService=a.getContainer().get(M.ICameraService),this.layerService=a.getContainer().get(M.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:v.NEAREST,min:v.NEAREST,width:1,height:1}))}return(0,L.Z)(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(n){var r=!1;return(0,P.isEqual)(n.thetaOffset,this.cacheStyleProperties.thetaOffset)||(r=!0,this.cacheStyleProperties.thetaOffset=n.thetaOffset),(0,P.isEqual)(n.opacity,this.cacheStyleProperties.opacity)||(r=!0,this.cacheStyleProperties.opacity=n.opacity),(0,P.isEqual)(n.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(r=!0,this.cacheStyleProperties.strokeOpacity=n.strokeOpacity),(0,P.isEqual)(n.strokeWidth,this.cacheStyleProperties.strokeWidth)||(r=!0,this.cacheStyleProperties.strokeWidth=n.strokeWidth),(0,P.isEqual)(n.stroke,this.cacheStyleProperties.stroke)||(r=!0,this.cacheStyleProperties.stroke=n.stroke),(0,P.isEqual)(n.offsets,this.cacheStyleProperties.offsets)||(r=!0,this.cacheStyleProperties.offsets=n.offsets),this.dataTexture===void 0&&(r=!0),r}},{key:"judgeStyleAttributes",value:function(n){this.clearLastCalRes(),n.opacity!==void 0&&!(0,P.isNumber)(n.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),n.strokeOpacity!==void 0&&!(0,P.isNumber)(n.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),n.strokeWidth!==void 0&&!(0,P.isNumber)(n.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),n.stroke!==void 0&&!this.isStaticColor(n.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),n.offsets!==void 0&&!this.isOffsetStatic(n.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),n.thetaOffset!==void 0&&!(0,P.isNumber)(n.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(n){return(0,P.isString)(n)?!!(0,vi.ZP)(n):!1}},{key:"getStrokeColor",value:function(n){if(this.isStaticColor(n)){var r=oe(n);return r[0]=r[0]?r[0]:0,r[1]=r[1]?r[1]:0,r[2]=r[2]?r[2]:0,r[3]=r[3]?r[3]:0,r}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(n){return!!(Array.isArray(n)&&n.length===2&&(0,P.isNumber)(n[0])&&(0,P.isNumber)(n[1]))}},{key:"patchMod",value:function(n,r){for(var e=0;e<r;e++)n.push(-1)}},{key:"patchData",value:function(n,r,e){var i=Sy(e),o;try{for(i.s();!(o=i.n()).done;){var u=o.value,s=u.attr,l=u.count,c=r[s];c!==void 0?s==="stroke"?n.push.apply(n,(0,G.Z)(oe(c))):s==="offsets"?this.isOffsetStatic(c)?n.push(-c[0],c[1]):n.push(0,0):n.push((0,P.isNumber)(c)?c:1):this.patchMod(n,l)}}catch(f){i.e(f)}finally{i.f()}}},{key:"calDataFrame",value:function(n,r,e){for(var i=r.length,o=Math.ceil(i*n/this.DATA_TEXTURE_WIDTH),u=o*this.DATA_TEXTURE_WIDTH,s=[],l=0;l<i;l++){var c=r[l];this.patchData(s,c,e)}for(var f=s.length;f<u;f++)s.push(-1);return{data:s,width:this.DATA_TEXTURE_WIDTH,height:o}}},{key:"getBlend",value:function(){var n=this.layer.getLayerConfig(),r=n.blend,e=r===void 0?"normal":r;return Hi[vt[e]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(n){throw new Error("Method not implemented.")}},{key:"initModels",value:function(n){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(n){return[n.enable?0:1,n.duration||4,n.interval||.2,n.trailLength||.1]}},{key:"startModelAnimate",value:function(){var n=this.layer.getLayerConfig(),r=n.animateOption;r.enable&&this.layer.setAnimateStartTime()}}]),t}(),Al=(0,ie.Z)(Gi.prototype,"configService",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gi),Wi=100,s4=36,l4=40;function Ml(t){return t/180*Math.acos(-1)}function Rl(t){var a=Ml(t[0])+Math.PI/2,n=Ml(t[1]),r=Wi+Math.random()*.4,e=r*Math.cos(n)*Math.cos(a),i=r*Math.cos(n)*Math.sin(a),o=r*Math.sin(n);return[i,o,e]}function c4(t,a){var n=mat4.create(),r=mat4.create(),e=vec3.fromValues(0,1,0),i=vec3.fromValues(0,0,0);a=a||{},t=typeof t!="undefined"?t:1;for(var o=typeof a.segments!="undefined"?a.segments:32,u=2+o,s=2*u,l=[],c=[],f=[],p=[],d=[],g=[],m=0;m<=u;m++){for(var _=m/u,y=_*Math.PI,x=0;x<=s;x++){var E=x/s,b=E*Math.PI*2;mat4.identity(r),mat4.rotateZ(r,r,-y),mat4.identity(n),mat4.rotateY(n,n,b),vec3.transformMat4(i,e,r),vec3.transformMat4(i,i,n),vec3.scale(i,i,-t),f.push(i.slice()),p.push.apply(p,_toConsumableArray(i.slice())),vec3.normalize(i,i),d.push.apply(d,_toConsumableArray(i.slice())),g.push([E,1-_]),p.push(E,1-_)}if(m>0)for(var A=f.length,F=A-2*(s+1);F+s+2<A;F++)l.push([F,F+1,F+s+1]),c.push(F,F+1,F+s+1),l.push([F+s+1,F+1,F+s+2]),c.push(F+s+1,F+1,F+s+2)}return{cells:l,positions:f,uvs:g,positionsArr:p,indicesArr:c,normalArr:d}}var xr=U.Ue(),f4=U.Ue(),we=U.Ue(),zt=U.Ue(),pn=U.Ue();function $i(t,a,n,r,e){U.IH(t,n,r),U.Fv(t,t),a=U.al(-t[1],t[0]);var i=U.al(-n[1],n[0]);return[e/U.AK(a,i),a]}function Ut(t,a){return U.t8(t,-a[1],a[0])}function dn(t,a,n){return U.lu(t,a,n),U.Fv(t,t),t}function Xi(t,a){return t[0]===a[0]&&t[1]===a[1]}function p4(t){for(var a=new Map,n=0;n<t.length;n++){var r=t[0].toString()+"-"+t[1].toString();a.get(r)?(t.splice(n,1),n++):a.set(r,r)}return t}var Ay=function(){function t(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,R.Z)(this,t),(0,h.Z)(this,"lastFlip",-1),(0,h.Z)(this,"miter",U.al(0,0)),(0,h.Z)(this,"started",!1),(0,h.Z)(this,"dash",!1),(0,h.Z)(this,"totalDistance",0),(0,h.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,L.Z)(t,[{key:"simpleExtrude",value:function(n){var r=this.complex;if(n.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=n.length,i=r.startIndex,o=1;o<e;o++){var u=n[o-1],s=n[o],l=o<n.length-1?n[o+1]:null,c=this.simpleSegment(r,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<r.positions.length/6;f++)r.positions[f*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(n,r){var e=this.complex;if(n.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=n.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=n[u-1];f.push((s=r[u-1][2])!==null&&s!==void 0?s:0);var p=r[u-1],d=n[u];d.push((l=r[u][2])!==null&&l!==void 0?l:0);var g=r[u],m=u<n.length-1?[].concat((0,G.Z)(n[u+1]),[(c=r[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<r.length-1?r[u+1]:null,y=this.simpleSegment(e,o,f,d,m,p,g,_);o+=y}if(this.dash)for(var x=0;x<e.positions.length/6;x++)e.positions[x*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"extrude_gaode2",value:function(n,r){var e=this.complex;if(n.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=n.length,o=e.startIndex,u=1;u<i;u++){var s,l,c,f=n[u-1];f.push((s=r[u-1][2])!==null&&s!==void 0?s:0);var p=r[u-1],d=n[u];d.push((l=r[u][2])!==null&&l!==void 0?l:0);var g=r[u],m=u<n.length-1?[].concat((0,G.Z)(n[u+1]),[(c=r[u+1][2])!==null&&c!==void 0?c:0]):null,_=u<r.length-1?r[u+1]:null,y=this.segment_gaode2(e,o,f,d,m,p,g,_);o+=y}if(this.dash)for(var x=0;x<e.positions.length/6;x++)e.positions[x*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"extrude",value:function(n){var r=this.complex;if(n.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var e=n.length,i=r.startIndex,o=1;o<e;o++){var u=n[o-1],s=n[o],l=o<n.length-1?n[o+1]:null,c=this.segment(r,i,u,s,l);i+=c}if(this.dash)for(var f=0;f<r.positions.length/6;f++)r.positions[f*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleSegment",value:function(n,r,e,i,o){var u=0,s=n.indices,l=n.positions,c=n.normals,f=Ne([i[0],i[1]]),p=Ne([e[0],e[1]]);dn(we,f,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(f,p),this.totalDistance+=d),this.normal||(this.normal=U.Ue(),Ut(this.normal,we)),this.started||(this.started=!0,this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-d)),s.push(r+0,r+1,r+2),!o)Ut(this.normal,we),this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),u+=2;else{var g=Ne([o[0],o[1]]);Xi(f,g)&&U.IH(g,f,U.Fv(g,U.$X(g,f,p))),dn(zt,g,f);var m=$i(pn,U.Ue(),we,zt,this.thickness),_=(0,re.Z)(m,2),y=_[0],x=_[1],E=U.AK(pn,this.normal)<0?-1:1;this.extrusions(l,c,i,x,y,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),E=-1,U.JG(this.normal,x),u+=2,this.lastFlip=E}return u}},{key:"segment_gaode2",value:function(n,r,e,i,o,u,s,l){var c=0,f=n.indices,p=n.positions,d=n.normals,g=this.cap==="square",m=this.join==="bevel",_=Ne([s[0],s[1]]),y=Ne([u[0],u[1]]);dn(we,i,e);var x=0;if(this.dash&&(x=this.lineSegmentDistance(_,y),this.totalDistance+=x),this.normal||(this.normal=U.Ue(),Ut(this.normal,we)),!this.started)if(this.started=!0,g){var E=U.Ue(),b=U.Ue();U.IH(E,this.normal,we),U.IH(b,this.normal,we),d.push(b[0],b[1],0),d.push(E[0],E[1],0),p.push(e[0],e[1],e[2]|0,this.totalDistance-x,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),p.push(e[0],e[1],e[2]|0,this.totalDistance-x,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,e,this.normal,this.thickness,this.totalDistance-x);if(f.push(r+0,r+1,r+2),o){Xi(i,o)&&U.IH(o,i,U.Fv(o,U.$X(o,i,e))),dn(zt,o,i);var I=$i(pn,U.Ue(),we,zt,this.thickness),k=(0,re.Z)(I,2),w=k[0],z=k[1],$=U.AK(pn,this.normal)<0?-1:1,X=m;if(!X&&this.join==="miter"){var ne=w;ne>this.miterLimit&&(X=!0)}X?(d.push(this.normal[0],this.normal[1],0),d.push(z[0],z[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*$,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*$,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,G.Z)(this.lastFlip!==-$?[r,r+2,r+3]:[r+2,r+1,r+3])),f.push(r+2,r+3,r+4),Ut(xr,zt),U.JG(this.normal,xr),d.push(this.normal[0],this.normal[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*$,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(p,d,i,z,w,this.totalDistance),f.push.apply(f,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),$=-1,U.JG(this.normal,z),c+=2),this.lastFlip=$}else{if(Ut(this.normal,we),g){var A=U.Ue(),F=U.Ue();U.lu(F,we,this.normal),U.IH(A,we,this.normal),d.push(F[0],F[1],0),d.push(A[0],A[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,i,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),c+=2}return c}},{key:"segment",value:function(n,r,e,i,o){var u=0,s=n.indices,l=n.positions,c=n.normals,f=this.cap==="square",p=this.join==="bevel",d=Ne([i[0],i[1]]),g=Ne([e[0],e[1]]);dn(we,d,g);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,g),this.totalDistance+=m),this.normal||(this.normal=U.Ue(),Ut(this.normal,we)),!this.started)if(this.started=!0,f){var _=U.Ue(),y=U.Ue();U.IH(_,this.normal,we),U.IH(y,this.normal,we),c.push(y[0],y[1],0),c.push(_[0],_[1],0),l.push(e[0],e[1],e[2]|0,this.totalDistance-m,-this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),l.push(e[0],e[1],e[2]|0,this.totalDistance-m,this.thickness,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,e,this.normal,this.thickness,this.totalDistance-m);if(s.push(r+0,r+1,r+2),o){var b=Ne([o[0],o[1]]);Xi(d,b)&&U.IH(b,d,U.Fv(b,U.$X(b,d,g))),dn(zt,b,d);var A=$i(pn,U.Ue(),we,zt,this.thickness),F=(0,re.Z)(A,2),I=F[0],k=F[1],w=U.AK(pn,this.normal)<0?-1:1,z=p;if(!z&&this.join==="miter"){var $=I;$>this.miterLimit&&(z=!0)}z?(c.push(this.normal[0],this.normal[1],0),c.push(k[0],k[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*w,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*w,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push.apply(s,(0,G.Z)(this.lastFlip!==-w?[r,r+2,r+3]:[r+2,r+1,r+3])),s.push(r+2,r+3,r+4),Ut(xr,zt),U.JG(this.normal,xr),c.push(this.normal[0],this.normal[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*w,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,c,i,k,I,this.totalDistance),s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),w=-1,U.JG(this.normal,k),u+=2),this.lastFlip=w}else{if(Ut(this.normal,we),f){var x=U.Ue(),E=U.Ue();U.lu(E,we,this.normal),U.IH(x,we,this.normal),c.push(E[0],E[1],0),c.push(x[0],x[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance);s.push.apply(s,(0,G.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),u+=2}return u}},{key:"extrusions",value:function(n,r,e,i,o,u){r.push(i[0],i[1],0),r.push(i[0],i[1],0),n.push(e[0],e[1],e[2]|0,u,-o,e[2]|0),this.complex.indexes.push(this.currentIndex),n.push(e[0],e[1],e[2]|0,u,o,e[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(n,r){var e=r[0]-n[0],i=r[1]-n[1];return Math.sqrt(e*e+i*i)}}]),t}(),xe=O(77160);function Ty(t){var a=t[0][0],n=t[0][t[0].length-1];a[0]===n[0]&&a[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,e=ut().flatten(t),i=e.vertices,o=e.dimensions,u=[],s=[],l=0;l<i.length/o;l++)o===2?u.push(i[l*2],i[l*2+1],1):u.push(i[l*3],i[l*3+1],1);var c=ut()(e.vertices,e.holes,e.dimensions);s.push.apply(s,(0,G.Z)(c));for(var f=function(g){var m=e.vertices.slice(g*o,(g+1)*o),_=e.vertices.slice((g+1)*o,(g+2)*o);_.length===0&&(_=e.vertices.slice(0,o));var y=u.length/3;u.push(m[0],m[1],1,_[0],_[1],1,m[0],m[1],0,_[0],_[1],0),s.push.apply(s,(0,G.Z)([0,2,1,2,3,1].map(function(x){return x+y})))},p=0;p<r;p++)f(p);return{positions:u,index:s}}function My(t){var a=ut().flatten(t),n=ut()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:n}}function Ll(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var e=t[0].length,i=ut().flatten(t),o=i.vertices,u=i.dimensions,s=[],l=[],c=[],f=0;f<o.length/u;f++)u===2?s.push(o[f*2],o[f*2+1],1,-1,-1):s.push(o[f*3],o[f*3+1],1,-1,-1),c.push(0,0,1);var p=ut()(i.vertices,i.holes,i.dimensions);l.push.apply(l,(0,G.Z)(p));for(var d=function(_){var y=i.vertices.slice(_*u,(_+1)*u),x=i.vertices.slice((_+1)*u,(_+2)*u);x.length===0&&(x=i.vertices.slice(0,u));var E=s.length/5;s.push(y[0],y[1],1,0,0,x[0],x[1],1,.1,0,y[0],y[1],0,0,.8,x[0],x[1],0,.1,.8);var b=Ry([x[0],x[1],1],[y[0],y[1],0],[y[0],y[1],1],a);c.push.apply(c,(0,G.Z)(b).concat((0,G.Z)(b),(0,G.Z)(b),(0,G.Z)(b))),l.push.apply(l,(0,G.Z)([1,2,0,3,2,1].map(function(A){return A+E})))},g=0;g<e;g++)d(g);return{positions:s,index:l,normals:c}}function Ry(t,a,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,e=xe.create(),i=xe.create(),o=xe.create();r&&(t=pi(t),a=pi(a),n=pi(n));var u=xe.fromValues.apply(xe,(0,G.Z)(t)),s=xe.fromValues.apply(xe,(0,G.Z)(a)),l=xe.fromValues.apply(xe,(0,G.Z)(n));xe.sub(e,l,s),xe.sub(i,u,s),xe.cross(o,e,i);var c=xe.create();return xe.normalize(c,o),c}var st,Yt;(function(t){t.CYLINDER="cylinder",t.SQUARECOLUMN="squareColumn",t.TRIANGLECOLUMN="triangleColumn",t.HEXAGONCOLUMN="hexagonColumn",t.PENTAGONCOLUMN="pentagonColumn"})(Yt||(Yt={}));var Kt;(function(t){t.CIRCLE="circle",t.SQUARE="square",t.TRIANGLE="triangle",t.HEXAGON="hexagon",t.PENTAGON="pentagon"})(Kt||(Kt={}));function jn(t){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=Math.PI*2/t,r=[],e=0;e<t;e++)r.push(n*e+a*Math.PI/12);var i=r.map(function(o){var u=Math.sin(o+Math.PI/4),s=Math.cos(o+Math.PI/4);return[u,s,0]});return i}function Ol(){return jn(30)}function kl(){return jn(4)}function Fl(){return jn(3)}function Pl(){return jn(6,1)}function Dl(){return jn(5)}var vn=(st={},(0,h.Z)(st,Kt.CIRCLE,Ol),(0,h.Z)(st,Kt.HEXAGON,Pl),(0,h.Z)(st,Kt.TRIANGLE,Fl),(0,h.Z)(st,Kt.SQUARE,kl),(0,h.Z)(st,Kt.PENTAGON,Dl),(0,h.Z)(st,Yt.CYLINDER,Ol),(0,h.Z)(st,Yt.HEXAGONCOLUMN,Pl),(0,h.Z)(st,Yt.TRIANGLECOLUMN,Fl),(0,h.Z)(st,Yt.SQUARECOLUMN,kl),(0,h.Z)(st,Yt.PENTAGONCOLUMN,Dl),st),Er={};function Qt(t){var a=ot(t.coordinates);return{vertices:[].concat((0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a),(0,G.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function wl(t){var a=ot(t.coordinates),n=Rl(a);return{vertices:[].concat((0,G.Z)(n),(0,G.Z)(n),(0,G.Z)(n),(0,G.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function Yi(t){var a=t.shape,n=Iy(a,!1),r=n.positions,e=n.index,i=n.normals;return{vertices:r,indices:e,normals:i,size:5}}function Ly(t){var a=ot(t.coordinates);return{vertices:(0,G.Z)(a),indices:[0],size:a.length}}function qt(t){var a=t.coordinates,n=t.originCoordinates,r=t.version,e=new Ay({dash:!0,join:"bevel"});if(r==="GAODE2.x"){var i=a;Array.isArray(i[0][0])||(i=[a]);var o=n;Array.isArray(o[0][0])||(o=[n]);for(var u=0;u<i.length;u++){var s=i[u],l=o[u];e.extrude_gaode2(s,l)}}else{var c=a;c[0]&&!Array.isArray(c[0][0])&&(c=[a]),c.forEach(function(p){e.extrude(p)})}var f=e.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function Oy(t){var a=t.coordinates,n=[];if(!Array.isArray(a[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=Fy(a),e=r.results,i=r.totalDistance;return e.map(function(o){n.push(o[0],o[1],o[2],o[3],0,i)}),{vertices:n,indices:[],normals:[],size:6,count:e.length}}function ky(t){var a=t.coordinates,n=[];if(!Array.isArray(a[0]))return{vertices:[],indices:[],size:4,count:0};var r=Py(a),e=r.results;return e.map(function(i){n.push(i[0],i[1],i[2],i[3])}),{vertices:n,indices:[],size:4,count:e.length}}function Il(t,a){var n=a[0]-t[0],r=a[1]-t[1];return Math.sqrt(n*n+r*r)}function hn(t,a){return t.length<3&&t.push(0),a!==void 0&&t.push(a),t}function Fy(t){var a=0;if(t.length<2)return{results:t,totalDistance:0};var n=[],r=hn(t[0],a);n.push(r);for(var e=1;e<t.length-1;e++){var i=Il(t[e-1],t[e]);a+=i;var o=hn(t[e],a);n.push(o),n.push(o)}var u=Il(t[t.length-2],t[t.length-1]);return a+=u,n.push(hn(t[t.length-1],a)),{results:n,totalDistance:a}}function Py(t){if(t.length<2)return{results:t};var a=[],n=hn(t[0]);a.push(n);for(var r=1;r<t.length-1;r++){var e=hn(t[r]);a.push(e),a.push(e)}return a.push(hn(t[t.length-1])),{results:a}}function Hn(t){var a=t.coordinates,n=ut().flatten(a),r=n.vertices,e=n.dimensions,i=n.holes;return{indices:ut()(r,i,e),vertices:r,size:e}}function Dy(t){var a=t.coordinates,n=ut().flatten(a),r=n.vertices,e=n.dimensions,i=n.holes;return{indices:ut()(r,i,e),vertices:wy(r),size:e+4}}function wy(t){for(var a=[],n=md(t),r=n.center,e=n.radius,i=0;i<t.length;i+=2){var o=t[i],u=t[i+1];a.push.apply(a,[o,u,0].concat((0,G.Z)(r),[e]))}return a}function Bl(t){var a=t.coordinates,n=Ll(a,!0),r=n.positions,e=n.index,i=n.normals;return{vertices:r,indices:e,normals:i,size:5}}function Nl(t){var a=t.shape,n=Ny(a),r=n.positions,e=n.index;return{vertices:r,indices:e,size:3}}function gn(t){var a=t.coordinates,n=[].concat((0,G.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,G.Z)(a[1]),[0,1,0],(0,G.Z)(a[0]),[0,0,1],(0,G.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),r=[0,1,2,3,4,5];return{vertices:n,indices:r,size:5}}function Cr(t,a){for(var n=a||30,r=t.coordinates,e=[],i=[],o=function(l){e.push(l,1,l,r[0][0],r[0][1],r[1][0],r[1][1],l,-1,l,r[0][0],r[0][1],r[1][0],r[1][1]),l!==n-1&&i.push.apply(i,(0,G.Z)([0,1,2,1,3,2].map(function(c){return l*2+c})))},u=0;u<n;u++)o(u);return{vertices:e,indices:i,size:7}}function Zl(t){var a=t.coordinates;a.length===2&&a.push(0);var n=Sr(-1,1),r=Sr(1,1),e=Sr(-1,-1),i=Sr(1,-1),o=[].concat((0,G.Z)(a),(0,G.Z)(n),(0,G.Z)(a),(0,G.Z)(e),(0,G.Z)(a),(0,G.Z)(i),(0,G.Z)(a),(0,G.Z)(r)),u=[0,1,2,3,0,2];return{vertices:o,indices:u,size:5}}function Iy(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Er&&Er[t])return Er[t];var n=vn[t]?vn[t]():vn.cylinder(),r=Ll([n],a);return Er[t]=r,r}function d4(t,a){for(var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,e=new Float32Array(t.length/n*3),i,o,u,s=vec3.create(),l=vec3.create(),c=vec3.create(),f=0,p=a.length;f<p;f+=3){i=a[f+0]*3,o=a[f+1]*3,u=a[f+2]*3;var d=[t[i],t[i+1]],g=[t[o],t[o+1]],m=[t[u],t[u+1]];r&&(d=lngLatToMeters(d),g=lngLatToMeters(g),m=lngLatToMeters(m));var _=d,y=_slicedToArray(_,2),x=y[0],E=y[1],b=vec3.fromValues(x,E,t[i+2]),A=g,F=_slicedToArray(A,2),I=F[0],k=F[1],w=vec3.fromValues(I,k,t[o+2]),z=m,$=_slicedToArray(z,2),X=$[0],ne=$[1],se=vec3.fromValues(X,ne,t[u+2]);vec3.sub(s,se,w),vec3.sub(l,b,w),vec3.cross(c,s,l),e[i]+=s[0],e[i+1]+=s[1],e[i+2]+=s[2],e[o]+=s[0],e[o+1]+=s[1],e[o+2]+=s[2],e[u]+=s[0],e[u+1]+=s[1],e[u+2]+=s[2]}return By(e),e}function By(t){for(var a=0,n=t.length;a<n;a+=3){var r=vec3.fromValues(t[a],t[a+1],t[a+2]),e=vec3.create();vec3.normalize(e,r),t.set(e,a)}}function v4(t){var a=t[0][0],n=t[0][t[0].length-1];return a[0]===n[0]&&a[1]===n[1]}function Ny(t){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=vn[t]?vn[t]():vn.circle(),r=a.indexOf(t)===-1?My([n]):Ty([n]);return r}function Sr(t,a){var n=(t+1)/2,r=(a+1)/2;return[n,r]}function h4(){var t=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=t.positionsArr,n=t.indicesArr,r=t.normalArr;return{vertices:a,indices:n,size:5,normals:r}}function g4(){var t=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=t.positionsArr,n=t.indicesArr,r=t.normalArr;return{vertices:a,indices:n,size:5,normals:r}}function Zy(t){var a=zy();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function zy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Uy=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jy=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Hy=function(t){(0,N.Z)(n,t);var a=Zy(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.baseColor,s=u===void 0?"rgb(16,16,16)":u,l=e.brightColor,c=l===void 0?"rgb(255,176,38)":l,f=e.windowColor,p=f===void 0?"rgb(30,60,89)":f,d=e.time,g=d===void 0?0:d,m=e.sweep,_=m===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:m;return{u_cityCenter:_.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*_.sweepRadius,u_circleSweep:_.enable?1:0,u_circleSweepColor:oe(_.sweepColor).slice(0,3),u_circleSweepSpeed:_.sweepSpeed,u_opacity:o,u_baseColor:oe(s),u_brightColor:oe(c),u_windowColor:oe(p),u_time:this.layer.getLayerAnimateTime()||g}}},{key:"calCityGeo",value:function(){var e=(0,re.Z)(this.layer.getSource().extent,4),i=e[0],o=e[1],u=e[2],s=e[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(u+i)/2,(s+o)/2]);var l=this.mapService.lngLatToCoord([u,s]),c=this.mapService.lngLatToCoord([i,o]);this.cityMinSize=Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2))/4}else{var f=u-i,p=s-o;this.cityCenter=[(u+i)/2,(s+o)/2],this.cityMinSize=Math.sqrt(Math.pow(f,2)+Math.pow(p,2))/4}}},{key:"initModels",value:function(e){this.calCityGeo(),this.startModelAnimate(),this.buildModels(e)}},{key:"buildModels",value:function(e){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:jy,fragmentShader:Uy,triangulation:Bl,depth:{enable:!0},cull:{enable:!0,face:v.BACK}}).then(function(i){e([i])}).catch(function(i){console.warn(i),e([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?10:o;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),n}(ue);function Vy(t){var a=Gy();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Gy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Wy=function(t){(0,N.Z)(n,t);var a=Vy(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","CityBuildingLayer"),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this;this.layerModel=new Hy(this),this.layerModel.initModels(function(i){e.dispatchModelLoad(i)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(gt);function $y(t){var a=Xy();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Xy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Yy=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Ky=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Qy=function(t){(0,N.Z)(n,t);var a=$y(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=e.coverage,u=e.angle;return{u_opacity:i||1,u_coverage:o||.9,u_angle:u||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:Yy,fragmentShader:Ky,triangulation:Nl,primitive:v.TRIANGLES,depth:{enable:!1},stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:j.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=i.version==="GAODE2.x"?i.originCoordinates:i.coordinates;return[o[0],o[1],0]}}})}}]),n}(ue);function qy(t){var a=Jy();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Jy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var e1=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,t1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,n1=function(t){(0,N.Z)(n,t);var a=qy(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=e.coverage,u=e.angle;return{u_opacity:i||1,u_coverage:o||1,u_angle:u||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:e1,fragmentShader:t1,triangulation:Yi,primitive:v.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.size;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:j.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=i.version==="GAODE2.x"?i.originCoordinates:i.coordinates;return[o[0],o[1],0]}}})}}]),n}(ue);function r1(t,a){for(var n=[],r=[],e=[],i=t+1,o=a+1,u=t/2,s=a/2,l=0;l<o;l++)for(var c=l-s,f=0;f<i;f++){var p=f-u;r.push(p/u,-c/s,0),e.push(f/t),e.push(1-l/a)}for(var d=0;d<a;d++)for(var g=0;g<t;g++){var m=g+i*d,_=g+i*(d+1),y=g+1+i*(d+1),x=g+1+i*d;n.push(m,_,x),n.push(_,y,x)}return{vertices:r,indices:n,uvs:e}}var zl,Ul;function i1(t){var a=a1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function a1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var o1=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,u1=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,s1=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,l1=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,c1=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,f1=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,jl=(zl=(0,W.b2)(),zl(Ul=function(t){(0,N.Z)(n,t);var a=i1(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"render",value:function(){var e=this,i=this.rendererService,o=i.clear,u=i.useFramebuffer;u(this.heatmapFramerBuffer,function(){o({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g,m,_;return H().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.rendererService,l=s.createFramebuffer,c=s.getViewportSize,f=s.createTexture2D,p=this.styleAttributeService.getLayerStyleAttribute("shape"),d=(p==null||(u=p.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=d,x.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=x.sent,this.colorModel=d==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),g=c(),m=g.width,_=g.height,this.heatmapFramerBuffer=l({color:f({width:Math.floor(m/4),height:Math.floor(_/4),wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,min:v.LINEAR,mag:v.LINEAR}),depth:!1}),this.updateColorTexture(),o([this.intensityModel,this.colorModel]);case 12:case"end":return x.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:j.Attribute,descriptor:{name:"a_Dir",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?1:o;return[u]}}})}},{key:"buildHeatMapIntensity",value:function(){var r=(0,te.Z)(H().mark(function i(){var o;return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.layer.triangulation=Zl,s.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:f1,fragmentShader:c1,triangulation:Zl,depth:{enable:!1},cull:{enable:!0,face:Pn(this.mapService.version)},blend:{enable:!0,func:{srcRGB:v.ONE,srcAlpha:1,dstRGB:v.ONE,dstAlpha:1}}});case 3:return o=s.sent,s.abrupt("return",o);case 5:case"end":return s.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"buildHeatmapColor",value:function(){var e=this.layer.getLayerConfig(),i=e.mask,o=i===void 0?!1:i,u=e.maskInside,s=u===void 0?!0:u;this.shaderModuleService.registerModule("heatmapColor",{vs:l1,fs:s1});var l=this.shaderModuleService.getModule("heatmapColor"),c=l.vs,f=l.fs,p=l.uniforms,d=this.rendererService,g=d.createAttribute,m=d.createElements,_=d.createBuffer,y=d.createModel;return y({vs:c,fs:f,attributes:{a_Position:g({buffer:_({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:v.FLOAT}),size:3}),a_Uv:g({buffer:_({data:[0,1,1,1,0,0,1,0],type:v.FLOAT}),size:2})},uniforms:(0,T.Z)({},p),depth:{enable:!1},blend:this.getBlend(),elements:m({data:[0,2,1,2,3,1],type:v.UNSIGNED_INT,count:6}),stencil:me(o,s)})}},{key:"drawIntensityMode",value:function(){var e,i=this.layer.getLayerConfig(),o=i.opacity,u=i.intensity,s=u===void 0?10:u,l=i.radius,c=l===void 0?5:l;(e=this.intensityModel)===null||e===void 0||e.draw({uniforms:{u_opacity:o||1,u_radius:c,u_intensity:s}})}},{key:"drawColorMode",value:function(){var e,i=this.layer.getLayerConfig(),o=i.opacity;(e=this.colorModel)===null||e===void 0||e.draw({uniforms:{u_opacity:o||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var e,i=this.layer.getLayerConfig(),o=i.opacity,u=Re.create();Re.invert(u,this.cameraService.getViewProjectionMatrixUncentered()),(e=this.colorModel)===null||e===void 0||e.draw({uniforms:{u_opacity:o||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,G.Z)(u)}})}},{key:"build3dHeatMap",value:function(){var e=this.layer.getLayerConfig(),i=e.mask,o=i===void 0?!1:i,u=e.maskInside,s=u===void 0?!0:u,l=this.rendererService.getViewportSize,c=l(),f=c.width,p=c.height,d=r1(f/4,p/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:u1,fs:o1});var g=this.shaderModuleService.getModule("heatmap3dColor"),m=g.vs,_=g.fs,y=g.uniforms,x=this.rendererService,E=x.createAttribute,b=x.createElements,A=x.createBuffer,F=x.createModel;return F({vs:m,fs:_,attributes:{a_Position:E({buffer:A({data:d.vertices,type:v.FLOAT}),size:3}),a_Uv:E({buffer:A({data:d.uvs,type:v.FLOAT}),size:2})},primitive:v.TRIANGLES,uniforms:(0,T.Z)({},y),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:v.SRC_ALPHA,srcAlpha:1,dstRGB:v.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:b({data:d.indices,type:v.UNSIGNED_INT,count:d.indices.length}),stencil:me(o,s)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var i=this.layer.getLayerConfig(),o=i.rampColors,u=kt(o);this.colorTexture=e({data:new Uint8Array(u.data),width:u.width,height:u.height,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,min:v.NEAREST,mag:v.NEAREST,flipY:!1})}}]),n}(ue))||Ul);function p1(t){var a=d1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function d1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var v1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,h1=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,g1=function(t){(0,N.Z)(n,t);var a=p1(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=e.coverage,u=e.angle;return{u_opacity:i||1,u_coverage:o||.9,u_angle:u||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:h1,fragmentShader:v1,triangulation:Nl,depth:{enable:!1},primitive:v.TRIANGLES,blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:j.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=i.version==="GAODE2.x"?i.originCoordinates:i.coordinates;return[o[0],o[1],0]}}})}}]),n}(ue),m1={heatmap:jl,heatmap3d:jl,grid:Qy,grid3d:n1,hexagon:g1},_1=m1;function y1(t){var a=x1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function x1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var E1=function(t){(0,N.Z)(n,t);var a=y1(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","HeatMapLayer"),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new _1[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"renderModels",value:function(){var e=this,i=this.getModelType();return i==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(o){return e.models=o}),this.layerModelNeedUpdate=!1),this.models.forEach(function(o){return o.draw({uniforms:e.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,i=this.styleAttributeService.getLayerStyleAttribute("shape"),o=this.getLayerConfig(),u=o.shape3d,s=this.getSource(),l=s.data.type,c=(i==null||(e=i.scale)===null||e===void 0?void 0:e.field)||"heatmap";return c==="heatmap"||c==="heatmap3d"?"heatmap":l==="hexagon"?(u==null?void 0:u.indexOf(c))===-1?"hexagon":"grid3d":l==="grid"?(u==null?void 0:u.indexOf(c))===-1?"grid":"grid3d":"heatmap"}}]),n}(gt);function C1(t){var a=S1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function S1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var b1=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,A1=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,T1=function(t){(0,N.Z)(n,t);var a=C1(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=e.clampLow,u=o===void 0?!0:o,s=e.clampHigh,l=s===void 0?!0:s,c=e.noDataValue,f=c===void 0?-9999999:c,p=e.domain,d=p===void 0?[0,1]:p,g=e.rampColors,m=e.pixelConstant,_=m===void 0?0:m,y=e.pixelConstantR,x=y===void 0?256*256:y,E=e.pixelConstantG,b=E===void 0?256:E,A=e.pixelConstantB,F=A===void 0?1:A,I=e.pixelConstantRGB,k=I===void 0?.1:I;return(0,P.isEqual)(this.rampColors,g)||(this.updateColorTexture(),this.rampColors=g),{u_opacity:i||1,u_texture:this.texture,u_pixelConstant:_,u_pixelConstantR:x,u_pixelConstantG:b,u_pixelConstantB:F,u_pixelConstantRGB:k,u_domain:d,u_clampLow:u,u_clampHigh:typeof l!="undefined"?l:u,u_noDataValue:f,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(e){var i=this,o=this.layer.getLayerConfig(),u=o.mask,s=u===void 0?!1:u,l=o.maskInside,c=l===void 0?!0:l,f=o.rampColorsData,p=o.rampColors,d=this.layer.getSource(),g=this.rendererService.createTexture2D;this.texture=g({height:0,width:0}),d.data.images.then(function(_){i.texture=g({data:_[0],width:_[0].width,height:_[0].height}),i.layerService.reRender()});var m=f||kt(p);this.colorTexture=g({data:m.data,width:m.width,height:m.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:A1,fragmentShader:b1,triangulation:gn,primitive:v.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:me(s,c)}).then(function(_){e([_])}).catch(function(_){console.warn(_),e([])})}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D,i=this.layer.getLayerConfig(),o=i.rampColors,u=kt(o);this.colorTexture=e({data:u.data,width:u.width,height:u.height,flipY:!1})}}]),n}(ue);function M1(t){var a=R1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function R1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var L1=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,O1=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,k1=function(t){(0,N.Z)(n,t);var a=M1(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity;return{u_opacity:i||1,u_texture:this.texture}}},{key:"initModels",value:function(e){var i=this,o=this.layer.getLayerConfig(),u=o.mask,s=u===void 0?!1:u,l=o.maskInside,c=l===void 0?!0:l,f=this.layer.getSource(),p=this.rendererService.createTexture2D;if(this.texture=p({height:0,width:0}),Qe){var d=this.layerService.sceneService.getSceneConfig().canvas,g=d.createImage();g.crossOrigin="anonymous",g.src=f.data.originData,g.onload=function(){i.texture=p({data:g,width:g.width,height:g.height}),i.layerService.reRender()}}else f.data.images.then(function(m){i.texture=p({data:m[0],width:m[0].width,height:m[0].height,mag:v.LINEAR,min:v.LINEAR}),i.layerService.reRender()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:O1,fragmentShader:L1,triangulation:gn,primitive:v.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:me(s,c)}).then(function(m){e([m])}).catch(function(m){console.warn(m),e([])})}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),n}(ue);function F1(t){var a=P1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function P1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var D1=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,w1=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,I1=function(t){(0,N.Z)(n,t);var a=F1(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.rendererService.createTexture2D,i=this.layer.getLayerConfig(),o=i.opacity,u=i.clampLow,s=u===void 0?!0:u,l=i.clampHigh,c=l===void 0?!0:l,f=i.noDataValue,p=f===void 0?-9999999:f,d=i.domain,g=d===void 0?[0,1]:d,m=i.colorTexture,_=m===void 0?e({height:0,width:0}):m,y=i.pixelConstant,x=y===void 0?0:y,E=i.pixelConstantR,b=E===void 0?256*256:E,A=i.pixelConstantG,F=A===void 0?256:A,I=i.pixelConstantB,k=I===void 0?1:I,w=i.pixelConstantRGB,z=w===void 0?.1:w;return{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:x,u_pixelConstantR:b,u_pixelConstantG:F,u_pixelConstantB:k,u_pixelConstantRGB:z,u_domain:g,u_clampLow:s,u_clampHigh:typeof c!="undefined"?c:s,u_noDataValue:p,u_colorTexture:_}}},{key:"initModels",value:function(e){var i=this,o=this.layer.getLayerConfig(),u=o.mask,s=u===void 0?!1:u,l=o.maskInside,c=l===void 0?!0:l,f=this.layer.getSource(),p=this.rendererService.createTexture2D;this.texture=p({height:0,width:0}),f.data.images.then(function(d){i.texture=p({data:d[0],width:d[0].width,height:d[0].height}),i.layerService.reRender()}),this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:w1,fragmentShader:D1,triangulation:gn,primitive:v.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:me(s,c)}).then(function(d){e([d])}).catch(function(d){console.warn(d),e([])})}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),n}(ue),B1={image:k1,dataImage:T1,tileDataImage:I1},N1=B1;function Z1(t){var a=z1();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function z1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Hl=function(t){(0,N.Z)(n,t);var a=Z1(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","ImageLayer"),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new N1[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={image:{},dataImage:{},tileDataImage:{}};return i[e]}},{key:"getModelType",value:function(){var e,i=this.styleAttributeService.getLayerStyleAttribute("shape"),o=i==null||(e=i.scale)===null||e===void 0?void 0:e.field;return o==="dataImage"?"dataImage":o==="image"?"image":o==="tileDataImage"?"tileDataImage":"image"}}]),n}(gt);function U1(t,a,n){var r=n.createTexture2D,e=kt(t),i=r({data:e.data,width:e.width,height:e.height,flipY:!1});return a.map(function(o){o.updateLayerConfig({colorTexture:i})}),i}function Ki(t,a,n){t.map(function(r){a==="mask"?r.style({mask:n}):r.updateLayerConfig((0,h.Z)({},a,n))})}function br(t,a,n,r){if(Array.isArray(r)){t[n].apply(t,(0,G.Z)(r));return}if(typeof r=="string"){t[n](r);return}var e=j1(t,a.type,n);if(!r)return t[n](e),t;var i=V1(r,n);i.length===0?t[n](e):t[n].apply(t,(0,G.Z)(i))}function j1(t,a,n){switch(n){case"size":return 1;case"color":return"#fff";case"shape":return H1(a,t);default:return""}}function H1(t,a){var n,r=a.getAttribute("shape");if(r&&(n=r.scale)!==null&&n!==void 0&&n.field){var e;return((e=r.scale)===null||e===void 0?void 0:e.values)==="text"?[r.scale.field,r.scale.values]:r.scale.field}switch(t){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function V1(t,a){if(a==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var n=t,r=n.field,e=n.values,i=n.callback;return r&&e&&Array.isArray(e)?[r,e]:r&&i?[r,i]:r?[r]:[]}function G1(t,a){var n=a.tileLayer.scaleField,r=Object.keys(n);r.map(function(e){t.scale(e,n[e])})}var Vl=["mvt","geojsonvt","testTile"];function W1(t){var a=t.getSource();return Vl.includes(a.parser.type)}function Ar(t){return Vl.indexOf(t)>=0}function Gl(t,a){a.map(function(n){var r=zi(t.sceneContainer);n.setContainer(r,t.sceneContainer),n.init()})}function Wl(t,a){var n,r=a.getAttribute("shape");if(r&&(n=r.scale)!==null&&n!==void 0&&n.field){var e;return((e=r.scale)===null||e===void 0?void 0:e.values)==="text"?[r.scale.field,r.scale.values]:r.scale.field}switch(t){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function $l(t,a){switch(t){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return a;default:return a}}function m4(t){return t.getContext?{width:t.width/DOM.DPR,height:t.height/DOM.DPR}:t.getBoundingClientRect()}function Qi(t){return t.layerIDList.length===t.loadedLayers}function $1(t){var a=t.children;return a.filter(function(n){return Qi(n)}).length===a.length}function X1(t){var a=t.parent;return a?Qi(a):!0}function Y1(t,a){var n=window.setInterval(function(){var r=Qi(t),e=$1(t),i=X1(t);r&&e&&i&&(a(),window.clearInterval(n))},36)}function K1(t,a){t.isVisible?a():Y1(t,function(){a()})}function Q1(t){var a=!0;return t.map(function(n){n.type!=="PointLayer"&&(a=!1)}),a}function q1(t,a,n){if(a.length!==0){if(Q1(a)){Ki(a,"visible",t.isVisible),n.reRender();return}K1(t,function(){Ki(a,"visible",t.isVisible),n.reRender()})}}function J1(t,a,n,r){var e,i,o,u,s=(t==null||(e=t.bboxPolygon)===null||e===void 0?void 0:e.bbox)||[0,0,10,-10],l=(0,re.Z)(s,4),c=l[0],f=c===void 0?0:c,p=l[1],d=p===void 0?0:p,g=l[2],m=g===void 0?10:g,_=l[3],y=_===void 0?-10:_,x=a.lngLatToContainer([f,d]),E=a.lngLatToContainer([m,y]),b=E.x-x.x,A=x.y-E.y,F=[(n-x.x)/b,(r-E.y)/A],I=(t==null||(i=t.data)===null||i===void 0?void 0:i.width)||1,k=(t==null||(o=t.data)===null||o===void 0?void 0:o.height)||1,w=Math.floor(F[0]*I),z=Math.floor(F[1]*k),$=Math.max(0,z-1)*I+w,X=t==null||(u=t.data)===null||u===void 0?void 0:u.data[$];return X}function _4(t,a,n){var r=n.readPixels,e=n.getContainer,i=t*DOM.DPR,o=a*DOM.DPR,u=e2(e()),s=u.width,l=u.height;if(s*=DOM.DPR,l*=DOM.DPR,i>s-1*DOM.DPR||i<0||o>l-1*DOM.DPR||o<0)return!1;var c=r({x:Math.floor(i),y:Math.floor(l-(a+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return c}function e2(t){return t.getContext?{width:t.width/DOM.DPR,height:t.height/DOM.DPR}:t.getBoundingClientRect()}function t2(t){var a=n2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var r2=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,i2=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;


#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

void main() {
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // if(u_coord > 0.0) { // \u4F7F\u7528\u7ECF\u7EAC\u5EA6\u5750\u6807
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
  // } else { // \u4F7F\u7528\u504F\u79FB\u5750\u6807
  //   vec2 pointPos = a_Position.xy;
  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   tileWorld.xy += pointOffset;

  //   tileWorld.xy += offset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     tileWorld.w *= u_PixelsPerMeter.z;
  //   }
  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}
`,a2=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,o2=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_size;

#pragma include "projection"

void main() {

  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
}
`,qi=function(t){(0,N.Z)(n,t);var a=t2(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.usage,s=e.color,l=s===void 0?"#fff":s,c=e.size,f=c===void 0?1:c;return{u_opacity:Number(o),u_color:u==="basemap"?oe(l):[0,0,0,0],u_size:u==="basemap"?f:1}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g;return H().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:u=this.layer.getLayerConfig(),s=u.mask,l=s===void 0?!1:s,c=u.maskInside,f=c===void 0?!0:c,p=u.depth,d=p===void 0?!1:p,g=u.usage,this.layer.triangulation=qt,this.layer.buildLayerModel({moduleName:"lineTile_"+g,vertexShader:g==="basemap"?o2:i2,fragmentShader:g==="basemap"?a2:r2,triangulation:qt,blend:this.getBlend(),depth:{enable:d},stencil:me(l,f),pick:g!=="basemap"}).then(function(y){o([y])}).catch(function(y){console.warn(y),o([])});case 3:case"end":return _.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig(),i=e.usage;i!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u){var s=u.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(u,s,l,c,f){return f}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:j.Attribute,descriptor:{name:"a_Miter",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u,s,l){return[l[4]]}}})}}]),n}(ue);function u2(t){var a=s2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var l2=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,c2=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

varying vec4 v_color;

void main() {
  v_color = a_Color; 

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}
`,f2=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,p2=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}`,d2=function(t){(0,N.Z)(n,t);var a=u2(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.usage,s=e.color,l=s===void 0?"#fff":s;return{u_opacity:(0,P.isNumber)(o)?o:1,u_color:u==="basemap"?oe(l):[0,0,0,0]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=i.usage;this.layer.buildLayerModel({moduleName:"lineTileSimpleNormal_"+c,vertexShader:c==="basemap"?p2:c2,fragmentShader:c==="basemap"?f2:l2,triangulation:ky,primitive:v.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l),pick:!1}).then(function(f){e([f])}).catch(function(f){console.warn(f),e([])})}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(ue);function v2(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h2(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function h2(t,a){if(!!t){if(typeof t=="string")return Xl(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xl(t,a)}}function Xl(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}var g2=function(){function t(a,n,r){(0,R.Z)(this,t),(0,h.Z)(this,"boxCells",[]);var e=this.boxCells;this.xCellCount=Math.ceil(a/r),this.yCellCount=Math.ceil(n/r);for(var i=0;i<this.xCellCount*this.yCellCount;i++)e.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=n,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/n,this.boxUid=0}return(0,L.Z)(t,[{key:"insert",value:function(n,r,e,i,o){this.forEachCell(r,e,i,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(r),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o)}},{key:"query",value:function(n,r,e,i,o){return this.queryHitTest(n,r,e,i,!1,o)}},{key:"hitTest",value:function(n,r,e,i,o){return this.queryHitTest(n,r,e,i,!0,o)}},{key:"insertBoxCell",value:function(n,r,e,i,o,u){this.boxCells[o].push(u)}},{key:"queryHitTest",value:function(n,r,e,i,o,u){if(e<0||n>this.width||i<0||r>this.height)return o?!1:[];var s=[];if(n<=0&&r<=0&&this.width<=e&&this.height<=i){if(o)return!0;for(var l=0;l<this.boxKeys.length;l++)s.push({key:this.boxKeys[l],x1:this.bboxes[l*4],y1:this.bboxes[l*4+1],x2:this.bboxes[l*4+2],y2:this.bboxes[l*4+3]});return u?s.filter(u):s}var c={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(n,r,e,i,this.queryCell,s,c,u),o?s.length>0:s}},{key:"queryCell",value:function(n,r,e,i,o,u,s,l){var c=s.seenUids,f=this.boxCells[o];if(f!==null){var p=this.bboxes,d=v2(f),g;try{for(d.s();!(g=d.n()).done;){var m=g.value;if(!c.box[m]){c.box[m]=!0;var _=m*4;if(n<=p[_+2]&&r<=p[_+3]&&e>=p[_+0]&&i>=p[_+1]&&(!l||l(this.boxKeys[m]))){if(s.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[m],x1:p[_],y1:p[_+1],x2:p[_+2],y2:p[_+3]})}}}}catch(y){d.e(y)}finally{d.f()}}return!1}},{key:"forEachCell",value:function(n,r,e,i,o,u,s,l){for(var c=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),p=this.convertToXCellCoord(e),d=this.convertToYCellCoord(i),g=c;g<=p;g++)for(var m=f;m<=d;m++){var _=this.xCellCount*m+g;if(o.call(this,n,r,e,i,_,u,s,l))return}}},{key:"convertToXCellCoord",value:function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}},{key:"convertToYCellCoord",value:function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}}]),t}(),m2=g2,Yl=function(){function t(a,n){(0,R.Z)(this,t),(0,h.Z)(this,"viewportPadding",100),this.width=a,this.height=n,this.viewportPadding=Math.max(a,n),this.grid=new m2(a+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return(0,L.Z)(t,[{key:"placeCollisionBox",value:function(n){var r=n.x1+n.anchorPointX+this.viewportPadding,e=n.y1+n.anchorPointY+this.viewportPadding,i=n.x2+n.anchorPointX+this.viewportPadding,o=n.y2+n.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,e,i,o)||this.grid.hitTest(r,e,i,o)?{box:[]}:{box:[r,e,i,o]}}},{key:"insertCollisionBox",value:function(n,r){var e={featureIndex:r};this.grid.insert(e,n[0],n[1],n[2],n[3])}},{key:"project",value:function(n,r,e){var i=dr.al(r,e,0,1),o=dr.Ue(),u=Re.fromValues.apply(Re,(0,G.Z)(n));return dr.fF(o,i,u),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(n,r,e,i){return e>=0&&n<this.gridRightBoundary&&i>=0&&r<this.gridBottomBoundary}}]),t}();function Kl(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_2(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function _2(t,a){if(!!t){if(typeof t=="string")return Ql(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ql(t,a)}}function Ql(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function ql(t){var a=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:a,verticalAlign:n}}function Jl(t,a,n,r,e){if(!!e){var i=t[r],o=i.glyph;if(o)for(var u=a[o].advance*i.scale,s=(t[r].x+u)*e,l=n;l<=r;l++)t[l].x-=s}}function ec(t,a,n,r,e,i,o){var u=(a-n)*e,s=(-r*o+.5)*i,l=Kl(t),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.x+=u,f.y+=s}}catch(p){l.e(p)}finally{l.f()}}function y2(t,a,n,r,e,i,o){var u=-8,s=0,l=u,c=0,f=t.positionedGlyphs,p=i==="right"?1:i==="left"?0:.5,d=f.length;n.forEach(function(x){if(x.split("").forEach(function(b){var A=a[b],F=0;A&&(f.push({glyph:b,x:s,y:l+F,vertical:!1,scale:1,metrics:A}),s+=A.advance+o)}),f.length!==d){var E=s-o;c=Math.max(E,c),Jl(f,a,d,f.length-1,p)}s=0,l-=r+5});var g=ql(e),m=g.horizontalAlign,_=g.verticalAlign;ec(f,p,m,_,c,r,n.length);var y=l-u;t.top+=-_*y,t.bottom=t.top-y,t.left+=-m*c,t.right=t.left+c}function x2(t,a,n,r,e,i,o){var u=-8,s=0,l=u,c=0,f=t.positionedGlyphs,p=i==="right"?1:i==="left"?0:.5,d=f.length;n.forEach(function(x){var E=a[x],b=0;if(E&&(f.push({glyph:x,x:E.advance/2,y:l+b,vertical:!1,scale:1,metrics:E}),s+=E.advance+o),f.length!==d){var A=s-o;c=Math.max(A,c),Jl(f,a,d,f.length-1,p)}s=0,l-=r+5});var g=ql(e),m=g.horizontalAlign,_=g.verticalAlign;ec(f,p,m,_,c,r,n.length);var y=l-u;t.top+=-_*y,t.bottom=t.top-y,t.left+=-m*c,t.right=t.left+c}function tc(t,a,n,r,e,i){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],u=arguments.length>7?arguments[7]:void 0,s=t.split(`
`),l=[],c={positionedGlyphs:l,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:s.length,text:t};return u?x2(c,a,s,n,r,e,i):y2(c,a,s,n,r,e,i),l.length?c:!1}function nc(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],n=arguments.length>2?arguments[2]:void 0,r=t.positionedGlyphs,e=r===void 0?[]:r,i=[],o=Kl(e),u;try{for(o.s();!(u=o.n()).done;){var s=u.value,l=s.metrics,c=4,f=l.advance*s.scale/2,p=n?[s.x+f,s.y]:[0,0],d=n?[0,0]:[s.x+f+a[0],s.y+a[1]],g=(0-c)*s.scale-f+d[0],m=(0-c)*s.scale+d[1],_=g+l.width*s.scale,y=m+l.height*s.scale,x={x:g,y:m},E={x:_,y:m},b={x:g,y},A={x:_,y};i.push({tl:x,tr:E,bl:b,br:A,tex:l,glyphOffset:p})}}catch(F){o.e(F)}finally{o.f()}return i}function E2(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=C2(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function C2(t,a){if(!!t){if(typeof t=="string")return rc(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rc(t,a)}}function rc(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function S2(t){var a=b2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var ic=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ac=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,oc=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;

uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;
uniform vec4 u_color;

void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
}
`,uc=`#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_size;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "projection"

void main() {
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = u_size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;

}
`;function sc(t){var a=this,n=t.id,r=[],e=[];if(!a.glyphInfoMap||!a.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var i=a.glyphInfoMap[n].centroid,o=i.length===2?[i[0],i[1],0]:i;return a.glyphInfoMap[n].glyphQuads.forEach(function(u,s){r.push.apply(r,(0,G.Z)(o).concat([u.tex.x,u.tex.y+u.tex.height,u.tl.x,u.tl.y],(0,G.Z)(o),[u.tex.x+u.tex.width,u.tex.y+u.tex.height,u.tr.x,u.tr.y],(0,G.Z)(o),[u.tex.x+u.tex.width,u.tex.y,u.br.x,u.br.y],(0,G.Z)(o),[u.tex.x,u.tex.y,u.bl.x,u.bl.y])),e.push(0+s*4,1+s*4,2+s*4,2+s*4,3+s*4,0+s*4)}),{vertices:r,indices:e,size:7}}var lc=function(t){(0,N.Z)(n,t);var a=S2(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"glyphInfoMap",{}),(0,h.Z)((0,C.Z)(r),"currentZoom",-1),(0,h.Z)((0,C.Z)(r),"textureHeight",0),(0,h.Z)((0,C.Z)(r),"textCount",0),(0,h.Z)((0,C.Z)(r),"preTextStyle",{}),(0,h.Z)((0,C.Z)(r),"buildModels",function(){var u=(0,te.Z)(H().mark(function s(l){var c,f;return H().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:r.mapping(),c=r.layer.getLayerConfig(),f=c.usage,r.layer.buildLayerModel({moduleName:"pointTileText_"+f,vertexShader:f==="basemap"?uc:ac,fragmentShader:f==="basemap"?oc:ic,triangulation:sc.bind((0,C.Z)(r)),depth:{enable:!1},blend:r.getBlend(),pick:f!=="basemap"}).then(function(g){l([g])}).catch(function(g){console.warn(g),l([])});case 3:case"end":return d.stop()}},s)}));return function(s){return u.apply(this,arguments)}}()),(0,h.Z)((0,C.Z)(r),"mapping",function(){r.initGlyph(),r.updateTexture(),r.filterGlyphs(),r.reBuildModel()}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.stroke,s=u===void 0?"#fff":u,l=e.strokeWidth,c=l===void 0?0:l,f=e.textAnchor,p=f===void 0?"center":f,d=e.textAllowOverlap,g=d===void 0?!1:d,m=e.halo,_=m===void 0?.5:m,y=e.gamma,x=y===void 0?2:y,E=e.usage,b=e.color,A=b===void 0?"#fff":b,F=e.size,I=F===void 0?1:F,k=this.fontService,w=k.canvas,z=k.mapping;return Object.keys(z).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(z).length),this.preTextStyle={textAnchor:p,textAllowOverlap:g},{u_opacity:(0,P.isNumber)(o)?o:1,u_stroke_width:(0,P.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(s),u_sdf_map:this.texture,u_halo_blur:_,u_gamma_scale:x,u_sdf_map_size:[w.width,w.height],u_color:E==="basemap"?oe(A):[0,0,0,0],u_size:E==="basemap"?I:1}}},{key:"initModels",value:function(e){this.extent=this.textExtent();var i=this.layer.getLayerConfig(),o=i.textAnchor,u=o===void 0?"center":o,s=i.textAllowOverlap,l=s===void 0?!0:s;this.preTextStyle={textAnchor:u,textAllowOverlap:l},this.buildModels(e)}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig(),i=e.usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:j.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,s,l){return[l[5],l[6]]}}}),i!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(u){var s=u.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:j.Attribute,descriptor:{name:"a_tex",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(u,s,l){return[l[3],l[4]]}}})}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return on(e,.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),i=e.fontWeight,o=i===void 0?"400":i,u=e.fontFamily,s=u===void 0?"sans-serif":u,l=this.layer.getEncodedData(),c=[];l.forEach(function(f){var p=f.shape,d=p===void 0?"":p;d=d.toString();var g=E2(d),m;try{for(g.s();!(m=g.n()).done;){var _=m.value;c.indexOf(_)===-1&&c.push(_)}}catch(y){g.e(y)}finally{g.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:s,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var e=this,i=this.fontService.mapping,o=this.layer.getLayerConfig(),u=o.spacing,s=u===void 0?2:u,l=o.textAnchor,c=l===void 0?"center":l,f=this.layer.getEncodedData();this.glyphInfo=f.map(function(p){var d=p.shape,g=d===void 0?"":d,m=p.id,_=p.size,y=_===void 0?1:_,x=p.textOffset,E=x===void 0?[0,0]:x,b=tc(g.toString(),i,y,c,"left",s,E,!1),A=nc(b,E,!1);return p.shaping=b,p.glyphQuads=A,p.centroid=ot(p.coordinates),p.originCentroid=p.version==="GAODE2.x"?ot(p.originCoordinates):p.originCentroid=p.centroid,e.glyphInfoMap[m]={shaping:b,glyphQuads:A,centroid:ot(p.coordinates)},p})}},{key:"filterGlyphs",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.padding,u=o===void 0?[4,4]:o,s=i.textAllowOverlap,l=s===void 0?!1:s;if(!l){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var c=this.rendererService.getViewportSize(),f=c.width,p=c.height,d=new Yl(f,p),g=this.glyphInfo.filter(function(m){var _=m.shaping,y=m.id,x=y===void 0?0:y,E=m.version==="GAODE2.x"?m.originCentroid:m.centroid,b=m.size,A=b/24,F=e.mapService.lngLatToContainer(E),I=d.placeCollisionBox({x1:_.left*A-u[0],x2:_.right*A+u[0],y1:_.top*A-u[1],y2:_.bottom*A+u[1],anchorPointX:F.x,anchorPointY:F.y}),k=I.box;return k&&k.length?(d.insertCollisionBox(k,x),!0):!1});g.forEach(function(m){e.glyphInfoMap[m.id]=m})}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,i=this.fontService.canvas;this.textureHeight=i.height,this.texture&&this.texture.destroy(),this.texture=e({data:i,mag:v.LINEAR,min:v.LINEAR,width:i.width,height:i.height})}},{key:"reBuildModel",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.usage;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText_"+o,vertexShader:o==="basemap"?uc:ac,fragmentShader:o==="basemap"?oc:ic,triangulation:sc.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:o!=="basemap"}).then(function(u){e.layer.models=[u],e.layerService.throttleRenderLayers()}).catch(function(u){console.warn(u),e.layer.models=[]})}}]),n}(ue);function A2(t){var a=T2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function T2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var M2=`uniform float u_additive;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));


  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,R2=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width));
  offset = project_pixel(offset);

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

// if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
// } else {

  // vec2 pointPos = a_Position.xy;
  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  // world.xy += offset;
  // world.xy += pointOffset;

  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   // Needs to be divided with project_uCommonUnitsPerMeter
  //   world.w *= u_PixelsPerMeter.z;
  // }

  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
// }

 
  setPickingColor(a_PickingColor);


}
`,Tr=function(t){(0,N.Z)(n,t);var a=A2(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.strokeOpacity,s=u===void 0?1:u,l=e.strokeWidth,c=l===void 0?0:l,f=e.stroke,p=f===void 0?"rgba(0,0,0,0)":f,d=e.blend;return{u_additive:d==="additive"?1:0,u_opacity:Number(o),u_stroke_opacity:Number(s),u_stroke_width:Number(c),u_stroke_color:this.getStrokeColor(p)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qt)}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.workerEnabled,u=o===void 0?!1:o,s=i.usage;this.layer.triangulation=Qt,this.layer.buildLayerModel({moduleName:"pointTile_"+s,vertexShader:R2,fragmentShader:M2,triangulation:Qt,depth:{enable:!1},cull:{enable:!0,face:Pn(this.mapService.version)},blend:this.getBlend(),workerEnabled:u,workerOptions:{modelType:"pointTile"},pick:s!=="basemap"}).then(function(l){e([l])}).catch(function(l){console.warn(l),e([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:j.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:j.Attribute,descriptor:{name:"a_Shape",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.shape,s=u===void 0?2:u,l=e.layer.getLayerConfig().shape2d,c=l.indexOf(s);return[c]}}})}}]),n}(ue);function L2(t){var a=O2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function O2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var k2=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,F2=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  // if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
    }
  // } else {
  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   world.xy += pointOffset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     world.w *= u_PixelsPerMeter.z;
  //   }

  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}

`,P2=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,D2=`attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}`,cc=function(t){(0,N.Z)(n,t);var a=L2(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.usage,s=e.color,l=s===void 0?"#fff":s;return{u_opacity:o,u_color:u==="basemap"?oe(l):[0,0,0,0]}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=i.usage;this.layer.triangulation=Hn,this.layer.buildLayerModel({moduleName:"polygonTile_"+c,vertexShader:c==="basemap"?D2:F2,fragmentShader:c==="basemap"?P2:k2,triangulation:Hn,depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l),pick:c!=="basemap"}).then(function(f){e([f])}).catch(function(f){console.warn(f),e([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(ue);function w2(t){var a=I2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function I2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var B2=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,N2=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,fc=function(t){(0,N.Z)(n,t);var a=w2(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?0:i,u=e.color,s=u===void 0?"#000":u;return{u_opacity:(0,P.isNumber)(o)?o:0,u_color:oe(s)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){return H().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:N2,fragmentShader:B2,triangulation:Hn,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:v.ALWAYS,ref:1,mask:255},opFront:{fail:v.REPLACE,zfail:v.REPLACE,zpass:v.REPLACE}},pick:!1}).then(function(l){o([l])}).catch(function(l){console.warn(l),o([])});case 1:case"end":return s.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(ue);function Z2(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=z2(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function z2(t,a){if(!!t){if(typeof t=="string")return pc(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pc(t,a)}}function pc(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function U2(t){var a=j2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function j2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Mr=function(t){(0,N.Z)(n,t);var a=U2(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"needListen",!0),(0,h.Z)((0,C.Z)(r),"isVector",!0),(0,h.Z)((0,C.Z)(r),"isTileLayer",!0),(0,h.Z)((0,C.Z)(r),"type",r.layerType||"vectorLayer"),(0,h.Z)((0,C.Z)(r),"pickedID",null),(0,h.Z)((0,C.Z)(r),"sourceEvent",function(){r.dataState.dataSourceNeedUpdate=!0,r.reRender()}),r}return(0,L.Z)(n,[{key:"init",value:function(){var e=this,i=this.container.get(M.SceneID);this.configService.setLayerConfig(i,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.type==="PointLayer"&&(this.iconService=this.container.get(M.IIconService),this.fontService=this.container.get(M.IFontService)),this.rendererService=this.container.get(M.IRendererService),this.layerService=this.container.get(M.ILayerService),this.mapService=this.container.get(M.IMapService),this.cameraService=this.container.get(M.ICameraService),this.coordinateService=this.container.get(M.ICoordinateSystemService),this.shaderModuleService=this.container.get(M.IShaderModuleService),this.postProcessingPassFactory=this.container.get(M.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(M.IFactoryNormalPass),this.styleAttributeService=this.container.get(M.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(l){var c=l.attributeName,f=l.attributeField,p=l.attributeValues,d=l.updateOptions;e.styleAttributeService.updateStyleAttribute(c,{scale:(0,T.Z)({field:f},e.splitValuesAndCallbackInAttribute(p,e.getLayerConfig()[c]))},d)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(M.ILayerPlugin);var o=Z2(this.plugins),u;try{for(o.s();!(u=o.n()).done;){var s=u.value;s.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(l){o.e(l)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"renderModels",value:function(e){var i=this;return this.models.forEach(function(o){o.draw({uniforms:i.layerModel.getUninforms()},e)}),this}},{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new i(this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return cc;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();case"MaskLayer":return fc;default:return Tr}}},{key:"getLineModel",value:function(){var e,i=this.styleAttributeService.getLayerStyleAttribute("shape"),o=i==null||(e=i.scale)===null||e===void 0?void 0:e.field;switch(o){case"tileline":case"line":return qi;case"simple":return d2;default:return qi}}},{key:"getPointModel",value:function(){var e=this.getEncodedData(),i=this.getLayerConfig(),o=i.shape2d,u=e.find(function(l){return l.hasOwnProperty("shape")});if(u){var s=u.shape;return(o==null?void 0:o.indexOf(s))!==-1?Tr:lc}else return Tr}},{key:"getDefaultConfig",value:function(){return{}}}]),n}(gt),H2=O(95335);function V2(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return dc(t);case"FeatureCollection":return G2(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ji(t);default:throw new Error("unknown GeoJSON type")}}function dc(t){var a={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:a[n]=t[n]}}),a.properties=vc(t.properties),a.geometry=Ji(t.geometry),a}function vc(t){var a={};return t&&Object.keys(t).forEach(function(n){var r=t[n];typeof r=="object"?r===null?a[n]=null:Array.isArray(r)?a[n]=r.map(function(e){return e}):a[n]=vc(r):a[n]=r}),a}function G2(t){var a={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:a[n]=t[n]}}),a.features=t.features.map(function(n){return dc(n)}),a}function Ji(t){var a={type:t.type};return t.bbox&&(a.bbox=t.bbox),t.type==="GeometryCollection"?(a.geometries=t.geometries.map(function(n){return Ji(n)}),a):(a.coordinates=hc(t.coordinates),a)}function hc(t){var a=t;return typeof a[0]!="object"?a.slice():a.map(function(n){return hc(n)})}var W2=V2;function $2(t,a){a===void 0&&(a={});var n=(0,An.wA)(t);switch(!a.properties&&t.type==="Feature"&&(a.properties=t.properties),n.type){case"Polygon":return X2(n,a);case"MultiPolygon":return Y2(n,a);default:throw new Error("invalid poly")}}function X2(t,a){a===void 0&&(a={});var n=(0,An.wA)(t),r=n.coordinates,e=a.properties?a.properties:t.type==="Feature"?t.properties:{};return gc(r,e)}function Y2(t,a){a===void 0&&(a={});var n=(0,An.wA)(t),r=n.coordinates,e=a.properties?a.properties:t.type==="Feature"?t.properties:{},i=[];return r.forEach(function(o){i.push(gc(o,e))}),(0,dt.uf)(i)}function gc(t,a){return t.length>1?(0,dt._R)(t,a):(0,dt.Tu)(t[0],a)}var mc={features:[],featureId:null,vectorTileLayer:null,source:null},Jt=function(){function t(a){(0,R.Z)(this,t),(0,h.Z)(this,"outSideEventTimer",null),(0,h.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=a.parent,this.mapService=a.mapService,this.rendererService=a.rendererService;var n=this.parentLayer.getSource();this.zoomOffset=n.parser.zoomOffset||0,this.tilesetManager=n.tileset}return(0,L.Z)(t,[{key:"createTile",value:function(n,r){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(n,r){var e=r.sourceLayer,i=r.featureId,o=r.transforms,u=o===void 0?[]:o,s=r.layerType,l=r.shape;if(!e)return mc;var c=n.data.layers[e],f=c==null?void 0:c.features;if(Array.isArray(f)&&f.length>0){var p=[];s==="LineLayer"&&l==="simple"?f.map(function(g){var m=W2(g);if(m.geometry.type==="MultiPolygon"){var _,y=$2(m).features;(_=p).push.apply(_,(0,G.Z)(y))}else m.geometry.type==="Polygon"&&(m.geometry.type="MultiLineString"),p.push(m)}):p=f;var d=new In({type:"FeatureCollection",features:p},{parser:{type:"geojson",featureId:i,cancelExtent:!0},transforms:u});return{features:p,featureId:i,vectorTileLayer:c,source:d}}else return mc}},{key:"createLayer",value:function(n){var r=n.L7Layer,e=n.tile,i=n.initOptions,o=n.vectorTileLayer,u=n.source,s=n.needListen,l=s===void 0?!0:s,c=i.mask,f=i.color,p=i.layerType,d=i.size,g=i.shape,m=i.usage,_=i.basemapColor,y=i.basemapSize,x=r||Mr,E=new x((0,T.Z)({visible:e.isVisible,tileOrigin:o==null?void 0:o.l7TileOrigin,coord:o==null?void 0:o.l7TileCoord,needListen:l},this.getLayerInitOption(i)));if(p&&(E.type=p),E.isTileLayer=!0,E.isVector&&m!=="basemap"&&(this.emitEvent([E]),E.select(!0)),E.source(u),br(E,this.parentLayer,"shape",g),m!=="basemap"?(G1(E,this.parentLayer),br(E,this.parentLayer,"color",f),br(E,this.parentLayer,"size",d)):E.style({color:_,size:y}),c&&E.isVector){var b=new Mr({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[e.bboxPolygon]},{parser:{type:"geojson",cancelExtent:!0}});Gl(this.parentLayer,[b]),E.addMaskLayer(b)}return this.layers=[E],E}},{key:"updateStyle",value:function(n){return""}},{key:"getTile",value:function(n,r){var e=this.mapService.getZoom();return this.tilesetManager.getTileByLngLat(n,r,e)}},{key:"bindVectorEvent",value:function(n){var r=this;n.on("click",function(e){r.eventCache.click=1,r.getFeatureAndEmitEvent("subLayerClick",e)}),n.on("mousemove",function(e){r.eventCache.mousemove=1,r.getFeatureAndEmitEvent("subLayerMouseMove",e)}),n.on("mouseenter",function(e){r.getFeatureAndEmitEvent("subLayerMouseEnter",e)})}},{key:"readRasterTile",value:function(n,r){var e=n.lngLat,i=e.lng,o=e.lat,u=this.getTile(i,o);if(!!u){var s=J1(u,this.mapService,n.x,n.y);n.value=s,this.parentLayer.emit(r,n)}}},{key:"bindRasterEvent",value:function(n){var r=this;n.on("click",function(e){r.eventCache.click=1,r.readRasterTile(e,"subLayerClick")}),n.on("mousemove",function(e){r.eventCache.mousemove=1,r.readRasterTile(e,"subLayerMouseMove")}),n.on("mouseenter",function(e){r.readRasterTile(e,"subLayerMouseMove")})}},{key:"bindCommonEvent",value:function(n){var r=this;n.on("mouseup",function(e){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent("subLayerMouseUp",e)}),n.on("mouseout",function(e){r.getFeatureAndEmitEvent("subLayerMouseOut",e)}),n.on("mousedown",function(e){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent("subLayerMouseDown",e)}),n.on("contextmenu",function(e){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent("subLayerContextmenu",e)}),n.on("unclick",function(e){return r.handleOutsideEvent("click","subLayerUnClick",n,e)}),n.on("unmouseup",function(e){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",n,e)}),n.on("unmousedown",function(e){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",n,e)}),n.on("uncontextmenu",function(e){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",n,e)})}},{key:"emitEvent",value:function(n){var r=this;n.map(function(e){e.once("modelLoaded",function(){r.bindVectorEvent(e),r.bindCommonEvent(e)})})}},{key:"emitRasterEvent",value:function(n){var r=this;n.map(function(e){e.once("modelLoaded",function(){r.bindRasterEvent(e),r.bindCommonEvent(e)})})}},{key:"getCombineFeature",value:function(n){var r=null,e=n[0];return n.map(function(i){var o=dt.yu(i.coordinates);r===null&&(r=o),r=(0,H2.Z)(r,o)}),e&&(r.properties=(0,T.Z)({},e)),r}},{key:"getFeatureAndEmitEvent",value:function(n,r){var e=r.featureId,i=this.getAllFeatures(e);try{r.feature=this.getCombineFeature(i)}catch(o){console.warn("Combine Featuer Err! Return First Feature!"),r.feature=i[0]}this.parentLayer.emit(n,r)}},{key:"getAllFeatures",value:function(n){var r=this.parentLayer.tileLayer.children,e=[];return r.map(function(i){var o=i.getSource();o.data.dataArray.map(function(u){u._id===n&&e.push(u)})}),e}},{key:"getLayerInitOption",value:function(n){var r=(0,T.Z)({},n);return delete r.color,delete r.shape,delete r.size,delete r.coords,delete r.sourceLayer,delete r.coords,r}},{key:"handleOutsideEvent",value:function(n,r,e,i){var o=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){o.eventCache[n]>0?o.eventCache[n]=0:o.getFeatureAndEmitEvent(r,i)},64)}}]),t}();function K2(t){var a=Q2();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var q2=function(t){(0,N.Z)(n,t);var a=K2(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o=this.getFeatureData(e,i),u=o.features,s=o.vectorTileLayer,l=o.source;if(u.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:e,initOptions:i,vectorTileLayer:s,source:l});return{layers:[c],layerIDList:[c.id]}}}]),n}(Jt);function J2(t){var a=ex();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ex(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var tx=function(t){(0,N.Z)(n,t);var a=J2(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o=this.getFeatureData(e,i),u=o.features,s=o.vectorTileLayer,l=o.source;if(u.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:e,initOptions:i,vectorTileLayer:s,source:l,needListen:!1});return{layers:[c],layerIDList:[c.id]}}}]),n}(Jt);function nx(t){var a=rx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function rx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var ix=function(t){(0,N.Z)(n,t);var a=nx(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o=this.getFeatureData(e,i),u=o.features,s=o.vectorTileLayer,l=o.source;if(u.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:e,initOptions:i,vectorTileLayer:s,source:l});return{layers:[c],layerIDList:[c.id]}}}]),n}(Jt);function ax(t){var a=ox();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ox(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var ux=function(t){(0,N.Z)(n,t);var a=ax(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o=this.getFeatureData(e,i),u=o.features,s=o.vectorTileLayer,l=o.source;if(u.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:e,initOptions:i,vectorTileLayer:s,source:l,needListen:!1});return{layers:[c],layerIDList:[c.id]}}}]),n}(Jt);function sx(t){var a=lx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function lx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var _c=function(t){(0,N.Z)(n,t);var a=sx(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o=new In(e.data,{parser:{type:"image",extent:e.bounds}}),u=this.createLayer({L7Layer:Hl,tile:e,initOptions:i,source:o});return{layers:[u],layerIDList:[u.id]}}}]),n}(Jt);function cx(t){var a=fx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function fx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var px=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,dx=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,vx=function(t){(0,N.Z)(n,t);var a=cx(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.rendererService.createTexture2D,i=this.layer.getLayerConfig(),o=i.colorTexture,u=o===void 0?e({data:[],width:0,height:0,flipY:!1}):o,s=i.opacity,l=s===void 0?1:s,c=i.clampLow,f=c===void 0?!0:c,p=i.clampHigh,d=p===void 0?!0:p,g=i.noDataValue,m=g===void 0?-9999999:g,_=i.domain,y=_===void 0?[0,1]:_;return{u_opacity:l||1,u_texture:this.texture,u_domain:y,u_clampLow:f,u_clampHigh:typeof d!="undefined"?d:f,u_noDataValue:m,u_colorTexture:u}}},{key:"initModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=this.layer.getSource(),f=this.rendererService.createTexture2D,p=c.data.dataArray[0];this.texture=f({data:p.data,width:p.width,height:p.height,format:v.LUMINANCE,type:v.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterTileImageData",vertexShader:dx,fragmentShader:px,triangulation:gn,depth:{enable:!1},stencil:me(u,l)}).then(function(d){e([d])}).catch(function(d){console.warn(d),e([])})}},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),n}(ue);function hx(t){var a=gx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var mx=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_channelRMax: 256.;
uniform float u_channelGMax: 256.;
uniform float u_channelBMax: 256.;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  gl_FragColor = vec4(rgb.r/u_channelRMax, rgb.g/u_channelGMax, rgb.b/u_channelBMax, u_opacity);
}`,_x=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,yc=function(t){(0,N.Z)(n,t);var a=hx(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"channelRMax",256),(0,h.Z)((0,C.Z)(r),"channelGMax",256),(0,h.Z)((0,C.Z)(r),"channelBMax",256),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.channelRMax,s=e.channelGMax,l=e.channelBMax;return{u_opacity:o||1,u_texture:this.texture,u_channelRMax:u!==void 0?u:this.channelRMax,u_channelGMax:s!==void 0?s:this.channelGMax,u_channelBMax:l!==void 0?l:this.channelBMax}}},{key:"getRasterData",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d;return H().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!Array.isArray(o.data)){m.next=4;break}return m.abrupt("return",{data:o.data,width:o.width,height:o.height});case 4:return m.next=6,o.data;case 6:return u=m.sent,s=u.rasterData,l=u.width,c=u.height,f=u.channelR,p=u.channelG,d=u.channelB,this.channelRMax=f,this.channelGMax=p,this.channelBMax=d,m.abrupt("return",{data:Array.from(s),width:l,height:c});case 17:case"end":return m.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g,m,_,y,x;return H().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return u=this.layer.getLayerConfig(),s=u.mask,l=s===void 0?!1:s,c=u.maskInside,f=c===void 0?!0:c,p=this.layer.getSource(),d=this.rendererService.createTexture2D,g=p.data.dataArray[0],b.next=6,this.getRasterData(g);case 6:m=b.sent,_=m.data,y=m.width,x=m.height,this.texture=d({data:_,width:y,height:x,format:v.RGB,type:v.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:_x,fragmentShader:mx,triangulation:gn,primitive:v.TRIANGLES,depth:{enable:!1},stencil:me(l,f)}).then(function(A){o([A])}).catch(function(A){console.warn(A),o([])});case 12:case"end":return b.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}}]),n}(ue);function yx(t){var a=xx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function xx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Ex=function(t){(0,N.Z)(n,t);var a=yx(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type",r.layerType),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new i(this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getModelType",value:function(){return this.layerSource.parser.type==="rasterRgb"?yc:vx}},{key:"getDefaultConfig",value:function(){return{}}}]),n}(gt);function Cx(t){var a=Sx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Sx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var bx=function(t){(0,N.Z)(n,t);var a=Cx(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o,u,s,l=i.colorTexture,c=i.opacity,f=i.domain,p=i.clampHigh,d=i.clampLow,g=i.mask,m=e.data;if(!m.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var _=(o=this.parentLayer)===null||o===void 0||(u=o.getSource())===null||u===void 0||(s=u.parser)===null||s===void 0?void 0:s.dataType,y=new Ex({visible:e.isVisible,mask:g}).source(m.data,{parser:{type:_==="rgb"?"rasterRgb":"raster",width:m.width,height:m.height,extent:e.bboxPolygon.bbox}}).style({colorTexture:l,opacity:c,domain:f,clampHigh:p,clampLow:d});return this.emitRasterEvent([y]),{layers:[y],layerIDList:[y.id]}}}]),n}(Jt);function Ax(t){var a=Tx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Tx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Mx=function(t){(0,N.Z)(n,t);var a=Ax(n);function n(r){var e;return(0,R.Z)(this,n),e=a.call(this,r),e.parentLayer=r.parent,e}return(0,L.Z)(n,[{key:"createTile",value:function(e,i){var o=i.sourceLayer;if(!o)return{layers:[],layerIDList:[]};var u=e.data.layers[o],s=u==null?void 0:u.features;if(s.length===0)return{layers:[],layerIDList:[]};var l=s[0].properties,c=new Mr({layerType:"PointLayer",usage:"basemap",needListen:!1}).source([l],{parser:{type:"json",x:"textLng",y:"textLat",cancelExtent:!0}}).shape("key","text").style({size:20,color:"#000",stroke:"#fff",strokeWidth:2}),f=new Mr({layerType:"LineLayer",usage:"basemap",needListen:!1}).source({type:"FeatureCollection",features:s},{parser:{type:"geojson",cancelExtent:!0}}).shape("simple").style({color:"#000"});return{layers:[f,c],layerIDList:[f.id,c.id]}}}]),n}(Jt);function Rx(t,a){switch(t){case"PolygonLayer":return ix;case"LineLayer":return q2;case"PointLayer":return tx;case"MaskLayer":return ux;case"TileDebugLayer":return Mx;case"RasterLayer":return zv.includes(a.dataType)?bx:_c;default:return console.warn("Current Tile Not Exist!"),_c}}var xc=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"tileCache",new Map)}return(0,L.Z)(t,[{key:"hasTile",value:function(n){return!!this.tileCache.has(n.key)}},{key:"addTile",value:function(n){var r;if(this.hasTile(n))return{layers:[],layerIDList:[]};this.tileCache.set(n.key,n);var e=this.tileFactory.createTile(n,this.initOptions);return Gl(this.parent,e.layers),(r=n.layerIDList).push.apply(r,(0,G.Z)(e.layerIDList)),this.addChildren(e.layers),e.layers.map(function(i){i.once("modelLoaded",function(){n.layerLoad()})}),e}},{key:"removeTile",value:function(n){this.tileCache.delete(n.key),this.removeChildren(n.layerIDList,!1)}},{key:"addChild",value:function(n){this.children.push(n)}},{key:"addChildren",value:function(n){var r;(r=this.children).push.apply(r,(0,G.Z)(n))}},{key:"removeChildren",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=[],i=[];this.children.filter(function(o){n.includes(o.id)?e.push(o):i.push(o)}),e.map(function(o){return o.destroy(r)}),this.children=i}},{key:"removeChild",value:function(n){var r=this.children.indexOf(n);r>-1&&this.children.splice(r,1),n.destroy()}},{key:"getChildren",value:function(n){return this.children.filter(function(r){return n.includes(r.id)})}},{key:"getChild",value:function(n){return this.children.filter(function(r){return r.id===n})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(n){n.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(n){return this.children.includes(n)}},{key:"initTileFactory",value:function(){var n=this.parent.getSource(),r=Rx(this.parent.type,n.parser);this.tileFactory=new r({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}},{key:"getSourceLayer",value:function(n,r){return n==="geojsonvt"?"geojsonvt":n==="testTile"?"testTile":r}},{key:"destroy",value:function(){}}]),t}();function Lx(t){var a=Ox();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Ox(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var kx=function(t){(0,N.Z)(n,t);var a=Lx(n);function n(){var r;return(0,R.Z)(this,n),r=a.call(this),(0,h.Z)((0,C.Z)(r),"checkConfigList",[]),r.cacheConfig=new Map,r}return(0,L.Z)(n,[{key:"setConfig",value:function(e,i){this.checkConfigList.includes(e)||this.checkConfigList.push(e),this.cacheConfig.set(e,i)}},{key:"removeConfig",value:function(e){var i=this.checkConfigList.indexOf(e);i>-1&&(this.cacheConfig.delete(e),this.checkConfigList.splice(i,1))}},{key:"checkConfig",value:function(e){var i=this;if(!!e.inited){var o=e.getLayerConfig(),u=[];this.checkConfigList.map(function(s){var l=i.cacheConfig.get(s),c;if(["color","size","shape"].includes(s)){var f;c=(f=e.getAttribute(s))===null||f===void 0?void 0:f.scale}else{if(!(s in o))return;c=o[s]}(0,P.isEqual)(l,c)||(u.push(s),i.setConfig(s,c))}),u.length>0&&(console.warn("tile config cache update!",u),this.emit("updateConfig",u))}}},{key:"getAttributeScale",value:function(e,i){var o=e.getAttribute(i),u={field:void 0,values:void 0,callback:void 0};if(o&&o.scale){var s=o.scale,l=s.field,c=s.values,f=s.callback;u.field=l,u.values=c,u.callback=f}return u}}]),n}(cr());function Fx(t){var a=Px();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Px(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Dx=function(t){(0,N.Z)(n,t);var a=Fx(n);function n(r,e,i,o,u){var s;return(0,R.Z)(this,n),s=a.call(this),(0,h.Z)((0,C.Z)(s),"isLastPicked",!1),s.parent=r,s.rendererService=e,s.pickingService=i,s.children=o,s.tileRenderService=u,s}return(0,L.Z)(n,[{key:"pick",value:function(e,i){var o=this;this.tileRenderService.renderMask(this.parent);var u=e.filter(function(s){return o.parent.needPick(i.type)&&s.inited&&s.isVisible()}).some(function(s){s.hooks.beforePickingEncode.call(),s.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),s.masks.map(function(c){c.hooks.beforeRender.call(),c.render(),c.hooks.afterRender.call()})),s.renderModels(!0),s.hooks.afterPickingEncode.call();var l=o.pickingService.pickFromPickingFBO(s,i);return l&&o.parent.type!=="RasterLayer"&&(o.emit("pick",{type:i.type,pickedColors:o.pickingService.pickedColors,layer:s}),o.pickingService.pickedTileLayers=[o.parent]),l});return this.parent.type!=="RasterLayer"&&!u&&this.isLastPicked&&i.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=u,u}},{key:"clearPick",value:function(){this.children.filter(function(e){return e.inited&&e.isVisible()}).map(function(e){e.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(e){this.children.filter(function(i){return i.inited&&i.isVisible()}).map(function(i){i.hooks.beforeHighlight.call(e)})}},{key:"beforeSelect",value:function(e){this.children.filter(function(i){return i.inited&&i.isVisible()}).map(function(i){i.hooks.beforeSelect.call(e)})}},{key:"destroy",value:function(){this.removeAllListeners()}}]),n}(He.EventEmitter),Ix=function(){function t(a){(0,R.Z)(this,t),this.rendererService=a}return(0,L.Z)(t,[{key:"render",value:function(n){var r=this;n.filter(function(e){return e.inited}).filter(function(e){return e.isVisible()}).map(function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.masks.length>0&&(r.rendererService.clear({stencil:0,depth:1,framebuffer:null}),e.masks.map(function(i){i.hooks.beforeRenderData.call(),i.hooks.beforeRender.call(),i.render(),i.hooks.afterRender.call()})),e.render(),e.hooks.afterRender.call()})}},{key:"renderMask",value:function(n){n.inited&&n.isVisible()&&n.masks.length>0&&(n.hooks.beforeRender.call(),this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),n.masks.map(function(r){r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),n.hooks.afterRender.call())}}]),t}(),Ec=["size","color","shape"],Rr=["opacity","zIndex"],Bx=["mask","rampColors","domain","clampHigh","clampLow","pixelConstant","pixelConstantR","pixelConstantG","pixelConstantB","pixelConstantRGB"].concat(Rr),Nx=["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(Rr),Zx=["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(Rr),zx=["color","shape"].concat(Rr),Ux={PointLayer:Nx,LineLayer:Zx,PolygonLayer:zx,RasterLayer:Bx,MaskLayer:[],TileDebugLayer:[]};function jx(t){var a=Hx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Hx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Vx=function(t){(0,N.Z)(n,t);var a=jx(n);function n(r,e,i,o,u){var s;return(0,R.Z)(this,n),s=a.call(this),s.parent=r,s.children=r.layerChildren,s.mapService=e,s.rendererService=i,s.transforms=u,s.tileRenderService=new Ix(i),s.tilePickService=new Dx(r,i,o,s.children,s.tileRenderService),s.tileStyleService=new kx,s.setSubLayerInitOption(),s.setConfigListener(),s.initTileFactory(),s}return(0,L.Z)(n,[{key:"render",value:function(){this.tileStyleService.checkConfig(this.parent),this.tileRenderService.render(this.children)}},{key:"pickLayers",value:function(e){return this.tilePickService.pick(this.children,e)}},{key:"setSubLayerInitOption",value:function(){var e,i=this.parent.getLayerConfig(),o=i.zIndex,u=o===void 0?0:o,s=i.opacity,l=s===void 0?1:s,c=i.mask,f=c===void 0?!1:c,p=i.stroke,d=p===void 0?"#fff":p,g=i.strokeWidth,m=g===void 0?0:g,_=i.strokeOpacity,y=_===void 0?1:_,x=i.clampLow,E=x===void 0?!0:x,b=i.clampHigh,A=b===void 0?!0:b,F=i.domain,I=F===void 0?[0,1]:F,k=i.rampColors,w=k===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:k,z=i.featureId,$=z===void 0?"id":z,X=i.workerEnabled,ne=X===void 0?!1:X,se=i.sourceLayer,Ee=i.pixelConstant,Oe=Ee===void 0?0:Ee,Ze=i.pixelConstantR,Be=Ze===void 0?256*256:Ze,ct=i.pixelConstantG,Xe=ct===void 0?256:ct,Cn=i.pixelConstantB,Sn=Cn===void 0?1:Cn,bn=i.pixelConstantRGB,Zr=bn===void 0?.1:bn,sa=this.tileStyleService.getAttributeScale(this.parent,"color"),zr=this.tileStyleService.getAttributeScale(this.parent,"size"),Ur=this.parent.getSource(),ZA=(Ur==null||(e=Ur.data)===null||e===void 0?void 0:e.tilesetOptions)||{},zA=ZA.coords,UA=Ur.getParserType(),jA=Wl(this.parent.type,this.parent);if(this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:jA,zIndex:u,opacity:l,sourceLayer:this.getSourceLayer(UA,se),coords:zA,featureId:$,color:sa,size:zr,mask:$l(this.parent.type,f),stroke:d,strokeWidth:m,strokeOpacity:y,clampLow:E,clampHigh:A,domain:I,rampColors:w,workerEnabled:ne,pixelConstant:Oe,pixelConstantR:Be,pixelConstantG:Xe,pixelConstantB:Sn,pixelConstantRGB:Zr},w){var HA=this.rendererService.createTexture2D,la=kt(w),VA=HA({data:la.data,width:la.width,height:la.height,flipY:!1});this.initOptions.colorTexture=VA}}},{key:"getInitOptionValue",value:function(e){var i,o,u;switch(e){case"color":return(i=this.parent.getAttribute("color"))===null||i===void 0?void 0:i.scale;case"shape":return(o=this.parent.getAttribute("shape"))===null||o===void 0?void 0:o.scale;case"size":return(u=this.parent.getAttribute("size"))===null||u===void 0?void 0:u.scale;default:return this.initOptions[e]}}},{key:"setInitOptionValue",value:function(e,i){this.initOptions[e]=i}},{key:"setConfigListener",value:function(){var e=this,i=Ux[this.parent.type]||[];i.map(function(o){e.tileStyleService.setConfig(o,e.getInitOptionValue(o))}),this.tileStyleService.on("updateConfig",function(o){o.map(function(u){return e.updateStyle(u)})})}},{key:"updateAttribute",value:function(e){var i=this;if(Ec.includes(e)){var o,u=(o=this.parent.getAttribute(e))===null||o===void 0?void 0:o.scale;if(!u)return;this.children.map(function(s){return br(s,i.parent,e,u)})}}},{key:"updateStyle",value:function(e){var i=null;if(Ec.includes(e))this.updateAttribute(e);else{var o=this.parent.getLayerConfig();if(!(e in o))return;var u=o[e];switch(i=u,e){case"rampColors":var s=U1(u,this.children,this.rendererService);this.initOptions.colorTexture=s;break;default:Ki(this.children,e,u)}}this.setInitOptionValue(e,i)}},{key:"destroy",value:function(){this.tilePickService.destroy()}}]),n}(xc),Cc=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"initedTileset",!1),(0,h.Z)(this,"viewchange",(0,P.debounce)(this.mapchange,200))}return(0,L.Z)(t,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"mapchange",value:function(){var n,r=this.getCurrentView(),e=r.latLonBounds,i=r.zoom;if(this.mapService.version==="GAODE1.x"){var o=this.parent.getLayerConfig(),u=o.visible;i<3&&u?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):i>=3&&!u&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===i&&this.lastViewStates.latLonBounds.toString()===e.toString()||(this.lastViewStates={zoom:i,latLonBounds:e},(n=this.tilesetManager)===null||n===void 0||n.throttleUpdate(i,e))}},{key:"getCurrentView",value:function(){var n=this.mapService.getBounds(),r=[n[0][0],n[0][1],n[1][0],n[1][1]],e=this.mapService.getZoom();return{latLonBounds:r,zoom:e}}},{key:"initTileSetManager",value:function(){var n,r=this.parent.getSource();this.tilesetManager=r.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var e=this.getCurrentView(),i=e.latLonBounds,o=e.zoom;(n=this.tilesetManager)===null||n===void 0||n.update(o,i)}},{key:"bindTilesetEvent",value:function(){var n=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(r){}),this.tilesetManager.on("tile-unload",function(r){n.tileUnLoad(r)}),this.tilesetManager.on("tile-error",function(r,e){n.tileError(r)}),this.tilesetManager.on("tile-update",function(){n.tileUpdate()}),this.mapService.on("zoomend",function(){return n.viewchange()}),this.mapService.on("moveend",function(){return n.viewchange()}))}},{key:"render",value:function(){this.tileLayerManager.render()}},{key:"tileLoaded",value:function(n){}},{key:"tileError",value:function(n){console.warn("error:",n)}},{key:"destroy",value:function(){var n;(n=this.tilesetManager)===null||n===void 0||n.destroy(),this.tileLayerManager.destroy()}},{key:"tileUnLoad",value:function(n){this.tileLayerManager.removeTile(n)}},{key:"tileUpdate",value:function(){var n=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(r){return r.isLoaded}).map(function(r){if(!!n.isTileReady(r))if(n.tileLayerManager.hasTile(r)){if(!r.isVisibleChange)return;var o=n.tileLayerManager.getChildren(r.layerIDList);q1(r,o,n.layerService),n.setPickState(o)}else{var e=n.tileLayerManager.addTile(r),i=e.layers;n.setPickState(i)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"isTileReady",value:function(n){var r;if((r=n.data)!==null&&r!==void 0&&r.layers&&this.sourceLayer){var e=n.data.layers[this.sourceLayer],i=e==null?void 0:e.features;if(!(Array.isArray(i)&&i.length>0))return!1}return!0}},{key:"setPickState",value:function(n){}}]),t}();function Gx(t){t.filter(function(a){return a.inited&&a.isVisible()}).filter(function(a){return a.getCurrentSelectedId()!==null}).map(function(a){mn(a,new Uint8Array([0,0,0,0])),a.setCurrentSelectedId(null)})}function Wx(t,a,n){var r=Lt(a),e;return t.map(function(i){i.getCurrentSelectedId()===null||r!==i.getCurrentSelectedId()?(mn(i,a),i.setCurrentSelectedId(r),e=a):(mn(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null),e=null)}),n.filter(function(i){return i.inited&&!i.isVector&&i.isVisible()&&i.needPick("click")}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){mn(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)}),e}function $x(t,a){var n=Lt(a);t.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==n}).map(function(r){r.setPickID(n),r.hooks.beforeHighlight.call(a)})}function Xx(t,a){a.select&&t.map(function(n){mn(n,a.select)}),a.active&&t.filter(function(n){return n.inited&&n.isVisible()}).map(function(n){n.hooks.beforeHighlight.call(a.active)})}function mn(t,a){var n=(0,re.Z)(a,3),r=n[0],e=n[1],i=n[2];t.hooks.beforeSelect.call([r,e,i])}function y4(t,a){var n=decodePickingColor(t);a.map(function(r){mn(r,t),r.setCurrentSelectedId(n)})}function x4(t,a){var n=decodePickingColor(t);a.map(function(r){r.hooks.beforeHighlight.call(t),r.setCurrentPickId(n)})}function Yx(t){var a=Kx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Qx=function(t){(0,N.Z)(n,t);var a=Yx(n);function n(r){var e,i,o=r.parent,u=r.rendererService,s=r.mapService,l=r.layerService,c=r.pickingService,f=r.transforms;(0,R.Z)(this,n),i=a.call(this),(0,h.Z)((0,C.Z)(i),"pickColors",{select:null,active:null});var p=o.getSource(),d=(p==null||(e=p.data)===null||e===void 0?void 0:e.tilesetOptions)||{},g=d.sourceLayer;return i.sourceLayer=g,i.parent=o,i.mapService=s,i.layerService=l,i.tileLayerManager=new Vx(o,s,u,c,f),i.initTileSetManager(),i.bindSubLayerEvent(),i.bindSubLayerPick(),i.scaleField=i.parent.getScaleOptions(),i}return(0,L.Z)(n,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"clearPick",value:function(e){e==="mousemove"&&this.tileLayerManager.tilePickService.clearPick()}},{key:"clearPickState",value:function(){Gx(this.children)}},{key:"pickLayers",value:function(e){return this.tileLayerManager.pickLayers(e)}},{key:"setPickState",value:function(e){Xx(e,this.pickColors)}},{key:"bindSubLayerPick",value:function(){var e=this;this.tileLayerManager.tilePickService.on("pick",function(i){var o=(0,re.Z)(i.pickedColors,3),u=o[0],s=o[1],l=o[2];if(i.type==="click"){var c=e.children.filter(function(d){return d.inited&&d.isVisible()&&d.isVector}).filter(function(d){return d!==i.layer}),f=e.layerService.getRenderList(),p=Wx(c,[u,s,l],f);e.pickColors.select=p}else $x(e.children,[u,s,l]),e.pickColors.active=[u,s,l]}),this.tileLayerManager.tilePickService.on("unpick",function(){e.pickColors.active=null})}},{key:"bindSubLayerEvent",value:function(){var e=this;this.parent.on("subLayerClick",function(i){e.parent.emit("click",(0,T.Z)({},i))}),this.parent.on("subLayerMouseMove",function(i){return e.parent.emit("mousemove",(0,T.Z)({},i))}),this.parent.on("subLayerMouseUp",function(i){return e.parent.emit("mouseup",(0,T.Z)({},i))}),this.parent.on("subLayerMouseEnter",function(i){return e.parent.emit("mouseenter",(0,T.Z)({},i))}),this.parent.on("subLayerMouseOut",function(i){return e.parent.emit("mouseout",(0,T.Z)({},i))}),this.parent.on("subLayerMouseDown",function(i){return e.parent.emit("mousedown",(0,T.Z)({},i))}),this.parent.on("subLayerContextmenu",function(i){return e.parent.emit("contextmenu",(0,T.Z)({},i))}),this.parent.on("subLayerUnClick",function(i){return e.parent.emit("unclick",(0,T.Z)({},i))}),this.parent.on("subLayerUnMouseMove",function(i){return e.parent.emit("unmousemove",(0,T.Z)({},i))}),this.parent.on("subLayerUnMouseUp",function(i){return e.parent.emit("unmouseup",(0,T.Z)({},i))}),this.parent.on("subLayerUnMouseDown",function(i){return e.parent.emit("unmousedown",(0,T.Z)({},i))}),this.parent.on("subLayerUnContextmenu",function(i){return e.parent.emit("uncontextmenu",(0,T.Z)({},i))})}}]),n}(Cc);function qx(t){var a=Jx();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function Jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var eE=function(t){(0,N.Z)(n,t);var a=qx(n);function n(r,e,i){var o;return(0,R.Z)(this,n),o=a.call(this),o.parent=r,o.children=r.layerChildren,o.mapService=e,o.rendererService=i,o.setSubLayerInitOption(),o.initTileFactory(),o}return(0,L.Z)(n,[{key:"render",value:function(){var e=this;this.children.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).map(function(i){i.hooks.beforeRenderData.call(),i.hooks.beforeRender.call(),i.masks.length>0&&(e.rendererService.clear({stencil:0,depth:1,framebuffer:null}),i.masks.map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),i.render(),i.hooks.afterRender.call()})}},{key:"setSubLayerInitOption",value:function(){var e,i,o=this.parent.getLayerConfig(),u=o.zIndex,s=u===void 0?0:u,l=o.opacity,c=l===void 0?1:l,f=o.mask,p=f===void 0?!1:f,d=o.stroke,g=d===void 0?"#fff":d,m=o.strokeWidth,_=m===void 0?0:m,y=o.strokeOpacity,x=y===void 0?1:y,E=o.workerEnabled,b=E===void 0?!1:E,A=o.sourceLayer,F=this.parent.getSource(),I=F.getParserType(),k=this.parent.getAttribute("color"),w=(k==null||(e=k.scale)===null||e===void 0?void 0:e.field)||"#fff",z=this.parent.getAttribute("size"),$=(z==null||(i=z.scale)===null||i===void 0?void 0:i.field)||1,X=Wl(this.parent.type,this.parent);this.initOptions={usage:"basemap",layerType:this.parent.type,shape:X,zIndex:s,opacity:c,sourceLayer:this.getSourceLayer(I,A),basemapColor:w,basemapSize:$,mask:$l(this.parent.type,p),stroke:g,strokeWidth:_,strokeOpacity:x,workerEnabled:b}}}]),n}(xc);function tE(t){var a=nE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function nE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var rE=function(t){(0,N.Z)(n,t);var a=tE(n);function n(r){var e,i,o=r.parent,u=r.rendererService,s=r.mapService,l=r.layerService;(0,R.Z)(this,n),i=a.call(this);var c=o.getSource(),f=(c==null||(e=c.data)===null||e===void 0?void 0:e.tilesetOptions)||{},p=f.sourceLayer;return i.sourceLayer=p,i.parent=o,i.mapService=s,i.layerService=l,i.tileLayerManager=new eE(o,s,u),i.initTileSetManager(),i}return(0,L.Z)(n)}(Cc);function iE(t){var a=aE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function aE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Vn=function(t){(0,N.Z)(n,t);var a=iE(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){return{}}},{key:"getTileLayer",value:function(e){switch(e){case"basemap":return rE;default:return Qx}}},{key:"initModels",value:function(){var e=this.layer.getSource(),i=this.layer.getLayerConfig(),o=i.usage;if(e!=null&&e.data.isTile&&!this.layer.tileLayer){var u=this.getTileLayer(o);this.layer.tileLayer=new u({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:e.transforms})}return this.buildModels()}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(ue);function oE(t){var a=uE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function uE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var sE=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,lE=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,cE=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,fE=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,pE=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,dE=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,vE={solid:0,dash:1},hE=function(t){(0,N.Z)(n,t);var a=oE(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,d=e.dashArray,g=d===void 0?[10,5]:d,m=e.forward,_=m===void 0?!0:m,y=e.lineTexture,x=y===void 0?!1:y,E=e.iconStep,b=E===void 0?100:E,A=e.segmentNumber,F=A===void 0?30:A,I=e.thetaOffset,k=I===void 0?.314:I;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,thetaOffset:k})){this.judgeStyleAttributes({opacity:o,thetaOffset:k});var w=this.layer.getEncodedData(),z=this.calDataFrame(this.cellLength,w,this.cellProperties),$=z.data,X=z.width,ne=z.height;this.rowCount=ne,this.dataTexture=this.cellLength>0&&$.length>0?this.createTexture2D({flipY:!0,data:$,format:v.LUMINANCE,type:v.FLOAT,width:X,height:ne}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}g.length===2&&g.push(0,0);var se=0,Ee=[0,0,0,0],Oe=[0,0,0,0];return u&&s&&(Ee=oe(u),Oe=oe(s),se=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,P.isNumber)(k)?k:0,u_opacity:(0,P.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:F,u_line_type:vE[p||"solid"],u_dash_array:g,u_blur:.9,u_lineDir:_?1:-1,u_texture:this.texture,u_line_texture:x?1:0,u_icon_step:b,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:se,u_sourceColor:Ee,u_targetColor:Oe}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor,u=e.lineType;return u==="dash"?{frag:sE,vert:lE,type:"Dash"}:i&&o?{frag:pE,vert:dE,type:"Linear"}:{frag:cE,vert:fE,type:""}}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.segmentNumber,u=o===void 0?30:o,s=i.mask,l=s===void 0?!1:s,c=i.maskInside,f=c===void 0?!0:c,p=this.getShaders(),d=p.frag,g=p.vert,m=p.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+m,vertexShader:g,fragmentShader:d,triangulation:Cr,depth:{enable:!1},blend:this.getBlend(),segmentNumber:u,stencil:me(l,f)}).then(function(_){e([_])}).catch(function(_){console.warn(_),e([])})}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:j.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue);function gE(t){var a=mE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function mE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var _E=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,yE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,xE=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,EE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,CE={solid:0,dash:1},SE=function(t){(0,N.Z)(n,t);var a=gE(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,d=e.dashArray,g=d===void 0?[10,5]:d,m=e.lineTexture,_=m===void 0?!1:m,y=e.iconStep,x=y===void 0?100:y,E=e.segmentNumber,b=E===void 0?30:E,A=e.globalArcHeight,F=A===void 0?10:A;g.length===2&&g.push(0,0);var I=0,k=[0,0,0,0],w=[0,0,0,0];if(u&&s&&(k=oe(u),w=oe(s),I=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var z=this.layer.getEncodedData(),$=this.calDataFrame(this.cellLength,z,this.cellProperties),X=$.data,ne=$.width,se=$.height;this.rowCount=se,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:v.LUMINANCE,type:v.FLOAT,width:ne,height:se}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Wi,u_global_height:F,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:b,u_line_type:CE[p]||0,u_dash_array:g,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:x,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:I,u_sourceColor:k,u_targetColor:w}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor;return i&&o?{frag:xE,vert:EE,type:"Linear"}:{frag:_E,vert:yE,type:""}}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.segmentNumber,u=o===void 0?30:o,s=i.mask,l=s===void 0?!1:s,c=i.maskInside,f=c===void 0?!0:c,p=this.getShaders(),d=p.frag,g=p.vert,m=p.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+m,vertexShader:g,fragmentShader:d,triangulation:Cr,blend:this.getBlend(),segmentNumber:u,stencil:me(l,f)}).then(function(_){e([_])}).catch(function(_){console.warn(_),e([])})}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:j.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue);function bE(t){var a=AE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function AE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var TE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ME=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,RE=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,LE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,OE={solid:0,dash:1},kE=function(t){(0,N.Z)(n,t);var a=bE(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,d=e.dashArray,g=d===void 0?[10,5]:d,m=e.lineTexture,_=m===void 0?!1:m,y=e.iconStep,x=y===void 0?100:y,E=e.segmentNumber,b=E===void 0?30:E,A=e.globalArcHeight,F=A===void 0?10:A;g.length===2&&g.push(0,0);var I=0,k=[0,0,0,0],w=[0,0,0,0];if(u&&s&&(k=oe(u),w=oe(s),I=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var z=this.layer.getEncodedData(),$=this.calDataFrame(this.cellLength,z,this.cellProperties),X=$.data,ne=$.width,se=$.height;this.rowCount=se,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:v.LUMINANCE,type:v.FLOAT,width:ne,height:se}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:Wi,u_global_height:F,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:b,u_line_type:OE[p]||0,u_dash_array:g,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:x,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:I,u_sourceColor:k,u_targetColor:w}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor;return i&&o?{frag:RE,vert:LE,type:"Linear"}:{frag:TE,vert:ME,type:""}}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.segmentNumber,u=o===void 0?30:o,s=i.mask,l=s===void 0?!1:s,c=i.maskInside,f=c===void 0?!0:c,p=this.getShaders(),d=p.frag,g=p.vert,m=p.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+m,vertexShader:g,fragmentShader:d,triangulation:Cr,depth:{enable:!0},blend:this.getBlend(),segmentNumber:u,stencil:me(l,f)}).then(function(_){e([_])}).catch(function(_){console.warn(_),e([])})}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:j.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue);function FE(t){var a=PE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function PE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var DE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,wE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,IE={solid:0,dash:1},BE=function(t){(0,N.Z)(n,t);var a=FE(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,d=e.dashArray,g=d===void 0?[10,5]:d,m=e.lineTexture,_=m===void 0?!1:m,y=e.iconStep,x=y===void 0?100:y,E=e.segmentNumber,b=E===void 0?30:E;g.length===2&&g.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var A=0,F=[0,0,0,0],I=[0,0,0,0];if(u&&s&&(F=oe(u),I=oe(s),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var k=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,k,this.cellProperties),z=w.data,$=w.width,X=w.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:v.LUMINANCE,type:v.FLOAT,width:$,height:X}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:b,u_line_type:IE[p]||0,u_dash_array:g,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:x,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:A,u_sourceColor:F,u_targetColor:I}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:wE,fragmentShader:DE,triangulation:Cr,depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:j.Attribute,descriptor:{name:"a_Instance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(o,u,s){return[s[3],s[4],s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue);function NE(t){var a=ZE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ZE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var zE=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,UE=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,jE=function(t){(0,N.Z)(n,t);var a=NE(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.arrow,c=l===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:l,f=0,p=[0,0,0,0],d=[0,0,0,0];if(u&&s&&(p=oe(u),d=oe(s),f=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),m=this.calDataFrame(this.cellLength,g,this.cellProperties),_=m.data,y=m.width,x=m.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:v.LUMINANCE,type:v.FLOAT,width:y,height:x}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_linearColor:f,u_sourceColor:p,u_targetColor:d,u_arrow:Number(c.enable),u_arrowHeight:c.arrowHeight||3,u_arrowWidth:c.arrowWidth||2,u_tailWidth:c.tailWidth===void 0?1:c.tailWidth}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"buildModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g,m,_;return H().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.layer.getLayerConfig(),s=u.mask,l=s===void 0?!1:s,c=u.maskInside,f=c===void 0?!0:c,p=u.depth,d=p===void 0?!1:p,g=this.getShaders(),m=g.frag,_=g.vert,this.layer.triangulation=qt,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:_,fragmentShader:m,triangulation:qt,depth:{enable:d},blend:this.getBlend(),stencil:me(l,f)}).then(function(E){o([E])}).catch(function(E){console.warn(E),o([])});case 4:case"end":return x.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){return{frag:zE,vert:UE,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:j.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l,c){return c===void 0?[u[3],10,u[5]]:[u[3],c,u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:j.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(i){var o=i.coordinates[0]||[0,0],u=i.coordinates[3]||[0,0];return[o[0],o[1],u[0],u[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:j.Attribute,descriptor:{name:"a_Miter",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i,o,u){return[u[4]]}}})}}]),n}(ue),Sc;(function(t){t[t.solid=0]="solid",t[t.dash=1]="dash"})(Sc||(Sc={}));var _n;(function(t){t.VERTICAL="vertical",t.HORIZONTAL="horizontal"})(_n||(_n={}));var ea;(function(t){t.NORMAL="normal",t.REPLACE="replace"})(ea||(ea={}));var bc;(function(t){t.ALWAYS="always",t.DRAGEND="dragend"})(bc||(bc={}));function HE(t){var a=VE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function VE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var GE=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,WE=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$E=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ac=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,XE=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,YE={solid:0,dash:1},Tc=function(t){(0,N.Z)(n,t);var a=HE(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.lineType,p=f===void 0?"solid":f,d=e.dashArray,g=d===void 0?[10,5,0,0]:d,m=e.lineTexture,_=m===void 0?!1:m,y=e.iconStep,x=y===void 0?100:y,E=e.vertexHeightScale,b=E===void 0?20:E,A=e.borderWidth,F=A===void 0?0:A,I=e.borderColor,k=I===void 0?"#ccc":I,w=e.raisingHeight,z=w===void 0?0:w,$=e.heightfixed,X=$===void 0?!1:$,ne=e.linearDir,se=ne===void 0?_n.VERTICAL:ne,Ee=e.blur,Oe=Ee===void 0?[1,1,1]:Ee,Ze=e.arrow,Be=Ze===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ze;g.length===2&&g.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ct=0,Xe=[0,0,0,0],Cn=[0,0,0,0];if(u&&s&&(Xe=oe(u),Cn=oe(s),ct=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var Sn=this.layer.getEncodedData(),bn=this.calDataFrame(this.cellLength,Sn,this.cellProperties),Zr=bn.data,sa=bn.width,zr=bn.height;this.rowCount=zr,this.dataTexture=this.cellLength>0&&Zr.length>0?this.createTexture2D({flipY:!0,data:Zr,format:v.LUMINANCE,type:v.FLOAT,width:sa,height:zr}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_textureBlend:c===ea.NORMAL?0:1,u_line_type:YE[p],u_dash_array:g,u_blur:Oe,u_texture:this.texture,u_line_texture:_?1:0,u_icon_step:x,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:F,u_borderColor:oe(k),u_linearDir:se===_n.VERTICAL?1:0,u_linearColor:ct,u_sourceColor:Xe,u_targetColor:Cn,u_heightfixed:Number(X),u_vertexScale:b,u_raisingHeight:Number(z),u_arrow:Number(Be.enable),u_arrowHeight:Be.arrowHeight||3,u_arrowWidth:Be.arrowWidth||2,u_tailWidth:Be.tailWidth===void 0?1:Be.tailWidth}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=i.depth,f=c===void 0?!1:c,p=i.workerEnabled,d=p===void 0?!1:p,g=i.enablePicking,m=this.getShaders(),_=m.frag,y=m.vert,x=m.type;this.layer.triangulation=Ei,this.layer.buildLayerModel({moduleName:"line"+x,vertexShader:y,fragmentShader:_,triangulation:Ei,depth:{enable:f},blend:this.getBlend(),stencil:me(u,l),workerEnabled:d,workerOptions:{modelType:"line"+x,enablePicking:g,iconMap:this.iconService.getIconMap()}}).then(function(E){e([E])}).catch(function(E){console.warn(E),e([])})}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor,u=e.lineType;return u==="dash"?{frag:GE,vert:WE,type:"Dash"}:i&&o?{frag:XE,vert:Ac,type:"Linear"}:{frag:$E,vert:Ac,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:j.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o,u,s,l,c,f){return f===void 0?[s[3],10]:[s[3],f]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:j.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u,s){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l,c){return c}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:j.Attribute,descriptor:{name:"a_Miter",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u,s){return[s[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue);function KE(t){var a=QE();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var qE=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,JE=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,eC=function(t){(0,N.Z)(n,t);var a=KE(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;r.colorTexture&&r.colorTexture.destroy();var s=r.layer.getLayerConfig(),l=s.rampColors,c=kt(l);r.colorTexture=u({data:new Uint8Array(c.data),width:c.width,height:c.height,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,min:v.NEAREST,mag:v.NEAREST,flipY:!1})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.vertexHeightScale,s=u===void 0?20:u,l=e.raisingHeight,c=l===void 0?0:l,f=e.heightfixed,p=f===void 0?!1:f,d=e.linearDir,g=d===void 0?_n.VERTICAL:d;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var m=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,m,this.cellProperties),y=_.data,x=_.width,E=_.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:v.LUMINANCE,type:v.FLOAT,width:x,height:E}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:g===_n.VERTICAL?1:0,u_opacity:(0,P.isNumber)(o)?o:1,u_texture:this.colorTexture,u_heightfixed:Number(p),u_vertexScale:s,u_raisingHeight:Number(c)}}},{key:"initModels",value:function(e){this.updateTexture(),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.colorTexture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=i.depth,f=c===void 0?!1:c;this.layer.triangulation=qt,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:JE,fragmentShader:qE,triangulation:qt,depth:{enable:f},blend:this.getBlend(),stencil:me(u,l)}).then(function(p){e([p])}).catch(function(p){console.warn(p),e([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:j.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u,s,l,c){return c===void 0?[u[3],10]:[u[3],c]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:j.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i,o,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:j.Attribute,descriptor:{name:"a_Miter",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i,o,u){return[u[4]]}}})}}]),n}(ue);function tC(t){var a=nC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var rC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,iC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Mc=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,aC=function(t){(0,N.Z)(n,t);var a=tC(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.vertexHeightScale,c=l===void 0?20:l,f=0,p=[0,0,0,0],d=[0,0,0,0];if(u&&s&&(p=oe(u),d=oe(s),f=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),m=this.calDataFrame(this.cellLength,g,this.cellProperties),_=m.data,y=m.width,x=m.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:v.LUMINANCE,type:v.FLOAT,width:y,height:x}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_linearColor:f,u_sourceColor:p,u_targetColor:d,u_vertexScale:c}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.sourceColor,o=e.targetColor;return i&&o?{frag:iC,vert:Mc,type:"lineSimpleLinear"}:{frag:rC,vert:Mc,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=this.getShaders(),f=c.frag,p=c.vert,d=c.type;this.layer.buildLayerModel({moduleName:d,vertexShader:p,fragmentShader:f,triangulation:Oy,primitive:v.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l),pick:!1}).then(function(g){e([g])}).catch(function(g){console.warn(g),e([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:j.Attribute,descriptor:{name:"a_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i,o,u){return[u[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:j.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i,o,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}})}}]),n}(ue);function oC(t){var a=uC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function uC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var sC=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,lC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,cC=function(t){(0,N.Z)(n,t);var a=oC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.NEAREST,min:v.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.sourceColor,s=e.targetColor,l=e.textureBlend,c=l===void 0?"normal":l,f=e.heightfixed,p=f===void 0?!1:f,d=e.lineTexture,g=d===void 0?!1:d,m=e.iconStep,_=m===void 0?100:m,y=e.iconStepCount,x=y===void 0?1:y;this.rendererService.getDirty()&&this.texture.bind();var E=0,b=[0,0,0,0],A=[0,0,0,0];return u&&s&&(b=oe(u),A=oe(s),E=1),{u_heightfixed:Number(p),u_opacity:(0,P.isNumber)(o)?o:1,u_textureBlend:c==="normal"?0:1,u_texture:this.texture,u_line_texture:g?1:0,u_iconStepCount:x,u_icon_step:_,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:E,u_sourceColor:b,u_targetColor:A}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption;return{u_animate:this.animateOption2Array(i),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:lC,fragmentShader:sC,triangulation:qt,depth:{enable:!1},blend:this.getBlend()}).then(function(i){e([i])}).catch(function(i){console.warn(i),e([])})}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:j.Attribute,descriptor:{name:"a_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u,s){return[s[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:j.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u,s){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=o.size,s=u===void 0?1:u;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l,c){return c}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:j.Attribute,descriptor:{name:"a_Miter",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o,u,s){return[s[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.texture,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue),fC={arc:hE,arc3d:SE,greatcircle:BE,wall:cC,line:Tc,halfLine:jE,simple:aC,linearline:eC,vectorline:Vn,tileLine:qi,earthArc3d:kE},pC=fC;function dC(t){var a=vC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var hC=function(t){(0,N.Z)(n,t);var a=dC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","LineLayer"),(0,h.Z)((0,C.Z)(r),"arrowInsertCount",0),(0,h.Z)((0,C.Z)(r),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new pC[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return i[e]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var i=this.layerSource.getParserType();if(Ar(i))return"vectorline";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(e=o.scale)===null||e===void 0?void 0:e.field;return u||"line"}}]),n}(gt);function gC(t){var a=mC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var _C=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,yC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,xC=function(t){(0,N.Z)(n,t);var a=gC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"raiseCount",0),(0,h.Z)((0,C.Z)(r),"raiseRepeat",0),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1,speed:.01,repeat:!1}:i,u=e.opacity,s=u===void 0?1:u,l=e.sourceColor,c=e.targetColor,f=e.pickLight,p=f===void 0?!1:f,d=e.heightfixed,g=d===void 0?!1:d,m=e.opacityLinear,_=m===void 0?{enable:!1,dir:"up"}:m,y=e.lightEnable,x=y===void 0?!0:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var E=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,E,this.cellProperties),A=b.data,F=b.width,I=b.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:v.LUMINANCE,type:v.FLOAT,width:F,height:I}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}var k=0,w=[0,0,0,0],z=[0,0,0,0];if(l&&c&&(w=oe(l),z=oe(c),k=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var $=o.speed,X=$===void 0?.01:$;this.raiseCount+=X,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(p),u_heightfixed:Number(g),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(s)?s:1,u_linearColor:k,u_sourceColor:w,u_targetColor:z,u_opacitylinear:Number(_.enable),u_opacitylinear_dir:_.dir==="up"?1:0,u_lightEnable:Number(x)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.animateOption.repeat,u=o===void 0?1:o;this.raiseRepeat=u,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:yC,fragmentShader:_C,triangulation:Yi,depth:{enable:!0},cull:{enable:!0,face:Pn(this.mapService.version)},blend:this.getBlend()}).then(function(s){e([s])}).catch(function(s){console.warn(s),e([])})}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=i.size;if(o){var u=[];return Array.isArray(o)&&(u=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(u=[o,o,o]),u}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:j.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=ot(i.coordinates);return Rl([o[0],o[1]])}}})}}]),n}(ue);function EC(t){var a=CC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var SC=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,bC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,AC=function(t){(0,N.Z)(n,t);var a=EC(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.strokeOpacity,s=u===void 0?1:u,l=e.strokeWidth,c=l===void 0?0:l,f=e.stroke,p=f===void 0?"rgba(0,0,0,0)":f,d=e.offsets,g=d===void 0?[0,0]:d,m=e.blend,_=e.blur,y=_===void 0?0:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g})){this.judgeStyleAttributes({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g});var x=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,x,this.cellProperties),b=E.data,A=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:v.LUMINANCE,type:v.FLOAT,width:A,height:F}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_blur:y,u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_stroke_opacity:(0,P.isNumber)(s)?s:1,u_stroke_width:(0,P.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(p),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1}:i;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){this.layer.triangulation=wl,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:bC,fragmentShader:SC,triangulation:wl,depth:{enable:!0},blend:this.getBlend()}).then(function(i){e([i])}).catch(function(i){console.warn(i),e([])})}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:j.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l){var c=(0,re.Z)(s,3),f=c[0],p=c[1],d=c[2],g=xe.fromValues(0,0,1),m=xe.fromValues(f,0,d),_=f>=0?xe.angle(g,m):Math.PI*2-xe.angle(g,m),y=Math.PI*2-Math.asin(p/100),x=Re.create();Re.rotateY(x,x,_),Re.rotateX(x,x,y);var E=xe.fromValues(1,1,0);xe.transformMat4(E,E,x),xe.normalize(E,E);var b=xe.fromValues(-1,1,0);xe.transformMat4(b,b,x),xe.normalize(b,b);var A=xe.fromValues(-1,-1,0);xe.transformMat4(A,A,x),xe.normalize(A,A);var F=xe.fromValues(1,-1,0);xe.transformMat4(F,F,x),xe.normalize(F,F);var I=[].concat((0,G.Z)(E),(0,G.Z)(b),(0,G.Z)(A),(0,G.Z)(F)),k=l%4*3;return[I[k],I[k+1],I[k+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:j.Attribute,descriptor:{name:"a_Shape",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.shape,s=u===void 0?2:u,l=e.layer.getLayerConfig().shape2d,c=l.indexOf(s);return[c]}}})}}]),n}(ue);function TC(t){var a=MC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var RC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,LC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,Rc=function(t){(0,N.Z)(n,t);var a=TC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"raiseCount",0),(0,h.Z)((0,C.Z)(r),"raiseRepeat",0),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1,speed:.01,repeat:!1}:i,u=e.opacity,s=u===void 0?1:u,l=e.sourceColor,c=e.targetColor,f=e.pickLight,p=f===void 0?!1:f,d=e.heightfixed,g=d===void 0?!1:d,m=e.opacityLinear,_=m===void 0?{enable:!1,dir:"up"}:m,y=e.lightEnable,x=y===void 0?!0:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var E=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,E,this.cellProperties),A=b.data,F=b.width,I=b.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:v.LUMINANCE,type:v.FLOAT,width:F,height:I}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}var k=0,w=[0,0,0,0],z=[0,0,0,0];if(l&&c&&(w=oe(l),z=oe(c),k=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var $=o.speed,X=$===void 0?.01:$;this.raiseCount+=X,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(p),u_heightfixed:Number(g),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(s)?s:1,u_linearColor:k,u_sourceColor:w,u_targetColor:z,u_opacitylinear:Number(_.enable),u_opacitylinear_dir:_.dir==="up"?1:0,u_lightEnable:Number(x)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f;return H().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:u=this.layer.getLayerConfig(),s=u.depth,l=s===void 0?!0:s,c=u.animateOption.repeat,f=c===void 0?1:c,this.raiseRepeat=f,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:LC,fragmentShader:RC,triangulation:Yi,blend:this.getBlend(),cull:{enable:!0,face:Pn(this.mapService.version)},depth:{enable:l}}).then(function(g){o([g])}).catch(function(g){console.warn(g),o([])});case 3:case"end":return d.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=i.size;if(o){var u=[];return Array.isArray(o)&&(u=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(u=[o,o,o]),u}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i,o,u,s,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:j.Attribute,descriptor:{name:"a_Pos",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(i){var o=ot(i.coordinates);return[o[0],o[1],0]}}})}}]),n}(ue);function OC(t){var a=kC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Lc=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,FC=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ta=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Oc=function(t){(0,N.Z)(n,t);var a=OC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"meter2coord",1),(0,h.Z)((0,C.Z)(r),"meterYScale",1),(0,h.Z)((0,C.Z)(r),"isMeter",!1),(0,h.Z)((0,C.Z)(r),"unit","l7size"),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.strokeOpacity,s=u===void 0?1:u,l=e.strokeWidth,c=l===void 0?0:l,f=e.stroke,p=f===void 0?"rgba(0,0,0,0)":f,d=e.offsets,g=d===void 0?[0,0]:d,m=e.blend,_=e.blur,y=_===void 0?0:_,x=e.raisingHeight,E=x===void 0?0:x,b=e.heightfixed,A=b===void 0?!1:b,F=e.unit,I=F===void 0?"l7size":F;if(this.updateUnit(I),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g})){this.judgeStyleAttributes({opacity:o,strokeOpacity:s,strokeWidth:c,stroke:p,offsets:g});var k=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,k,this.cellProperties),z=w.data,$=w.width,X=w.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:v.LUMINANCE,type:v.FLOAT,width:$,height:X}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(A),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:y,u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_stroke_opacity:(0,P.isNumber)(s)?s:1,u_stroke_width:(0,P.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(p),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1}:i;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),sr)}},{key:"initModels",value:function(e){this.updateUnit("l7size"),this.buildModels(e)}},{key:"calMeter2Coord",value:function(){var e=(0,re.Z)(this.layer.getSource().extent,4),i=e[0],o=e[1],u=e[2],s=e[3],l=[(i+u)/2,(o+s)/2],c=this.mapService.version,f=_e==null?void 0:_e.mapboxgl;if(c===Le.MAPBOX&&f!==null&&f!==void 0&&f.MercatorCoordinate){var p=f.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},0),d=p.meterInMercatorCoordinateUnits(),g=new f.MercatorCoordinate(p.x-d,p.y,p.z),m=g.toLngLat(),_=new f.MercatorCoordinate(p.x,p.y-d,p.z),y=_.toLngLat();this.meter2coord=l[0]-m.lng,this.meterYScale=(y.lat-l[1])/this.meter2coord;return}var x=this.mapService.meterToCoord(l,[i,o]),E=this.mapService.meterToCoord(l,[u===i?u+.1:u,s===o?o+.1:s]);this.meter2coord=(x+E)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g,m,_,y,x,E,b,A;return H().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:u=this.layer.getLayerConfig(),s=u.mask,l=s===void 0?!1:s,c=u.maskInside,f=c===void 0?!0:c,p=u.animateOption,d=p===void 0?{enable:!1}:p,g=u.workerEnabled,m=g===void 0?!1:g,_=u.enablePicking,y=u.shape2d,x=this.getShaders(d),E=x.frag,b=x.vert,A=x.type,this.layer.triangulation=sr,this.layer.buildLayerModel({moduleName:A,vertexShader:b,fragmentShader:E,triangulation:sr,depth:{enable:!1},blend:this.getBlend(),stencil:me(l,f),workerEnabled:m,workerOptions:{modelType:A,enablePicking:_,shape2d:y}}).then(function(k){o([k])}).catch(function(k){console.warn(k),o([])});case 4:case"end":return I.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"getShaders",value:function(e){if(e.enable)switch(e.type){case"wave":return{frag:Lc,vert:ta,type:"pointWave"};default:return{frag:Lc,vert:ta,type:"pointWave"}}else return{frag:FC,vert:ta,type:"pointFill"}}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:j.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:j.Attribute,descriptor:{name:"a_Shape",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.shape,s=u===void 0?2:u,l=e.indexOf(s);return[l]}}})}},{key:"updateUnit",value:function(e){var i=this.mapService.version;this.unit!==e&&(this.unit!=="meter"&&e==="meter"&&i!==Le.L7MAP&&i!==Le.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&e!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=e)}}]),n}(ue);function PC(t){var a=DC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var wC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,IC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,BC=function(t){(0,N.Z)(n,t);var a=PC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"meter2coord",1),(0,h.Z)((0,C.Z)(r),"isMeter",!1),(0,h.Z)((0,C.Z)(r),"radian",0),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),r.layerService.throttleRenderLayers();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.LINEAR,min:v.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128,mipmap:!0})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.offsets,s=u===void 0?[0,0]:u,l=e.rotation,c=e.raisingHeight,f=c===void 0?0:c,p=e.heightfixed,d=p===void 0?!1:p;this.rendererService.getDirty()&&this.texture.bind();var g=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(g=-1),this.radian=l!==void 0?g*Math.PI*l/180:g*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:s})){this.judgeStyleAttributes({opacity:o,offsets:s});var m=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,m,this.cellProperties),y=_.data,x=_.width,E=_.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:v.LUMINANCE,type:v.FLOAT,width:x,height:E}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(f),u_heightfixed:Number(d),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,P.isNumber)(o)?o:1,u_offsets:this.isOffsetStatic(s)?s:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qt)}},{key:"initModels",value:function(e){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var i=this.layer.getLayerConfig(),o=i.unit,u=o===void 0?"l7size":o,s=this.mapService.version;u==="meter"&&s!==Le.L7MAP&&s!==Le.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(e)}},{key:"calMeter2Coord",value:function(){var e=(0,re.Z)(this.layer.getSource().extent,4),i=e[0],o=e[1],u=e[2],s=e[3],l=[(i+u)/2,(o+s)/2],c=this.mapService.version;if(c===Le.MAPBOX&&window.mapboxgl.MercatorCoordinate){var f=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},0),p=1,d=p*f.meterInMercatorCoordinateUnits(),g=new window.mapboxgl.MercatorCoordinate(f.x-d,f.y,f.z),m=g.toLngLat();this.meter2coord=l[0]-m.lng;return}var _=this.mapService.meterToCoord(l,[i,o]),y=this.mapService.meterToCoord(l,[u===i?u+.1:u,s===o?o+.1:s]);this.meter2coord=(_+y)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:IC,fragmentShader:wC,triangulation:Qt,depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l),cull:{enable:!0,face:Pn(this.mapService.version)}}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"clearModels",value:function(){var e,i;this.iconService.off("imageUpdate",this.updateTexture),(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:j.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.rotate,s=u===void 0?0:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.shape,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:j.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]*e.meter2coord]:[s*e.meter2coord]}}})}}]),n}(ue);function NC(t){var a=ZC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var zC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,UC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,kc=function(t){(0,N.Z)(n,t);var a=NC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"updateTexture",function(){var u=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),r.layerService.throttleRenderLayers();return}r.texture=u({data:r.iconService.getCanvas(),mag:v.LINEAR,min:v.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128,mipmap:!0})}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.offsets,s=u===void 0?[0,0]:u,l=e.raisingHeight,c=l===void 0?0:l,f=e.heightfixed,p=f===void 0?!1:f;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:s})){this.judgeStyleAttributes({opacity:o,offsets:s});var d=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,d,this.cellProperties),m=g.data,_=g.width,y=g.height;this.rowCount=y,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:v.LUMINANCE,type:v.FLOAT,width:_,height:y}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(c),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,P.isNumber)(o)?o:1,u_offsets:this.isOffsetStatic(s)?s:[0,0]}}},{key:"initModels",value:function(e){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:UC,fragmentShader:zC,triangulation:Ly,depth:{enable:!1},primitive:v.POINTS,blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(o){var u=e.iconService.getIconMap(),s=o.shape,l=u[s]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),n}(ue);function jC(t){var a=HC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var VC=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,GC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function Fc(t){var a=t.coordinates;return{vertices:(0,G.Z)(a),indices:[0],size:a.length}}var Pc=function(t){(0,N.Z)(n,t);var a=jC(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i;return{u_opacity:(0,P.isNumber)(o)?o:1}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.triangulation=Fc,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:GC,fragmentShader:VC,triangulation:Fc,depth:{enable:!1},primitive:v.POINTS,blend:this.getBlend(),stencil:me(u,l),pick:!1}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0]]:[u]}}})}}]),n}(ue);function WC(t){var a=$C();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var XC=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,YC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,KC=function(t){(0,N.Z)(n,t);var a=WC(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"meter2coord",1),(0,h.Z)((0,C.Z)(r),"isMeter",!1),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.blend,s=e.speed,l=s===void 0?1:s;return{u_isMeter:Number(this.isMeter),u_speed:l,u_additive:u==="additive"?1:0,u_opacity:(0,P.isNumber)(o)?o:1}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig(),i=e.animateOption,o=i===void 0?{enable:!1}:i;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Qt)}},{key:"initModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.unit,u=o===void 0?"l7size":o,s=this.mapService.version;u==="meter"&&s!==Le.L7MAP&&s!==Le.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(e)}},{key:"calMeter2Coord",value:function(){var e=(0,re.Z)(this.layer.getSource().extent,4),i=e[0],o=e[1],u=e[2],s=e[3],l=[(i+u)/2,(o+s)/2],c=this.mapService.version;if(c===Le.MAPBOX&&window.mapboxgl.MercatorCoordinate){var f=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},0),p=1,d=p*f.meterInMercatorCoordinateUnits(),g=new window.mapboxgl.MercatorCoordinate(f.x-d,f.y,f.z),m=g.toLngLat();this.meter2coord=l[0]-m.lng;return}var _=this.mapService.meterToCoord(l,[i,o]),y=this.mapService.meterToCoord(l,[u===i?u+.1:u,s===o?o+.1:s]);this.meter2coord=(_+y)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:YC,fragmentShader:XC,triangulation:Qt,depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:j.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(o,u,s,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(o){var u=o.size,s=u===void 0?5:u;return Array.isArray(s)?[s[0]*e.meter2coord]:[s*e.meter2coord]}}})}}]),n}(ue);function QC(t){var a=qC();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function qC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var JC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,e3=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Dc(t){var a=t.coordinates;return{vertices:(0,G.Z)(a),indices:[0],size:a.length}}var t3=function(t){(0,N.Z)(n,t);var a=QC(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.offsets,s=u===void 0?[0,0]:u,l=e.blend,c=e.strokeOpacity,f=c===void 0?1:c,p=e.strokeWidth,d=p===void 0?0:p,g=e.stroke,m=g===void 0?"#fff":g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:s})){this.judgeStyleAttributes({opacity:o,offsets:s});var _=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,_,this.cellProperties),x=y.data,E=y.width,b=y.height;this.rowCount=b,this.dataTexture=this.cellLength>0&&x.length>0?this.createTexture2D({flipY:!0,data:x,format:v.LUMINANCE,type:v.FLOAT,width:E,height:b}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_additive:l==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,P.isNumber)(o)?o:1,u_offsets:this.isOffsetStatic(s)?s:[0,0],u_stroke_opacity:(0,P.isNumber)(f)?f:1,u_stroke_width:(0,P.isNumber)(d)?d:1,u_stroke_color:this.getStrokeColor(m)}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.triangulation=Dc,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:e3,fragmentShader:JC,triangulation:Dc,depth:{enable:!1},primitive:v.POINTS,blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?1:o;return Array.isArray(u)?[u[0]]:[u]}}})}}]),n}(ue);function n3(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r3(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function r3(t,a){if(!!t){if(typeof t=="string")return wc(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wc(t,a)}}function wc(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function i3(t){var a=a3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function a3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Ic=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bc=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Nc(t){var a=this,n=t.id,r=[],e=[];if(!a.glyphInfoMap||!a.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var i=a.glyphInfoMap[n].centroid,o=i.length===2?[i[0],i[1],0]:i;return a.glyphInfoMap[n].glyphQuads.forEach(function(u,s){r.push.apply(r,(0,G.Z)(o).concat([u.tex.x,u.tex.y+u.tex.height,u.tl.x,u.tl.y],(0,G.Z)(o),[u.tex.x+u.tex.width,u.tex.y+u.tex.height,u.tr.x,u.tr.y],(0,G.Z)(o),[u.tex.x+u.tex.width,u.tex.y,u.br.x,u.br.y],(0,G.Z)(o),[u.tex.x,u.tex.y,u.bl.x,u.bl.y])),e.push(0+s*4,1+s*4,2+s*4,2+s*4,3+s*4,0+s*4)}),{vertices:r,indices:e,size:7}}var Zc=function(t){(0,N.Z)(n,t);var a=i3(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"glyphInfoMap",{}),(0,h.Z)((0,C.Z)(r),"currentZoom",-1),(0,h.Z)((0,C.Z)(r),"textureHeight",0),(0,h.Z)((0,C.Z)(r),"textCount",0),(0,h.Z)((0,C.Z)(r),"preTextStyle",{}),(0,h.Z)((0,C.Z)(r),"buildModels",function(){var u=(0,te.Z)(H().mark(function s(l){var c,f,p,d,g;return H().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:c=r.layer.getLayerConfig(),f=c.mask,p=f===void 0?!1:f,d=c.maskInside,g=d===void 0?!0:d,r.mapping(),r.layer.buildLayerModel({moduleName:"pointText",vertexShader:Bc,fragmentShader:Ic,triangulation:Nc.bind((0,C.Z)(r)),depth:{enable:!1},blend:r.getBlend(),stencil:me(p,g)}).then(function(y){l([y])}).catch(function(y){console.warn(y),l([])});case 3:case"end":return _.stop()}},s)}));return function(s){return u.apply(this,arguments)}}()),(0,h.Z)((0,C.Z)(r),"mapping",function(){r.initGlyph(),r.updateTexture(),r.filterGlyphs(),r.reBuildModel()}),r}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.stroke,s=u===void 0?"#fff":u,l=e.strokeWidth,c=l===void 0?0:l,f=e.textAnchor,p=f===void 0?"center":f,d=e.textAllowOverlap,g=d===void 0?!1:d,m=e.halo,_=m===void 0?.5:m,y=e.gamma,x=y===void 0?2:y,E=e.raisingHeight,b=E===void 0?0:E,A=this.fontService,F=A.canvas,I=A.mapping;if(Object.keys(I).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(I).length),this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeWidth:c,stroke:s})){this.judgeStyleAttributes({opacity:o,strokeWidth:c,stroke:s});var k=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,k,this.cellProperties),z=w.data,$=w.width,X=w.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:v.LUMINANCE,type:v.FLOAT,width:$,height:X}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(b),u_opacity:(0,P.isNumber)(o)?o:1,u_stroke_width:(0,P.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(s),u_sdf_map:this.texture,u_halo_blur:_,u_gamma_scale:x,u_sdf_map_size:[F.width,F.height]}}},{key:"initModels",value:function(e){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var i=this.layer.getLayerConfig(),o=i.textAnchor,u=o===void 0?"center":o,s=i.textAllowOverlap,l=s===void 0?!0:s;this.preTextStyle={textAnchor:u,textAllowOverlap:l},this.buildModels(e)}},{key:"needUpdate",value:function(){var e=this.layer.getLayerConfig(),i=e.textAllowOverlap,o=i===void 0?!1:i,u=this.mapService.getZoom(),s=this.mapService.getBounds(),l=di(this.extent,s);return!o&&(Math.abs(this.currentZoom-u)>1||!l)||o!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:j.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.rotate,u=o===void 0?0:o;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:j.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(i){var o=i.size,u=o===void 0?12:o;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:j.Attribute,descriptor:{name:"a_tex",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return on(e,.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),i=e.fontWeight,o=i===void 0?"400":i,u=e.fontFamily,s=u===void 0?"sans-serif":u,l=this.layer.getEncodedData(),c=[];l.forEach(function(f){var p=f.shape,d=p===void 0?"":p;d=d.toString();var g=n3(d),m;try{for(g.s();!(m=g.n()).done;){var _=m.value;c.indexOf(_)===-1&&c.push(_)}}catch(y){g.e(y)}finally{g.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.layer.getLayerConfig(),i=e.fontWeight,o=i===void 0?"400":i,u=e.fontFamily,s=u===void 0?"sans-serif":u,l=this.layer.getEncodedData(),c=[];l.forEach(function(f){var p=f.shape,d=p===void 0?"":p;d="".concat(d),c.indexOf(d)===-1&&c.push(d)}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:s,iconfont:!0})}},{key:"generateGlyphLayout",value:function(e){var i=this,o=this.fontService.mapping,u=this.layer.getLayerConfig(),s=u.spacing,l=s===void 0?2:s,c=u.textAnchor,f=c===void 0?"center":c,p=this.layer.getEncodedData();this.glyphInfo=p.map(function(d){var g=d.shape,m=g===void 0?"":g,_=d.id,y=d.size,x=y===void 0?1:y,E=d.textOffset,b=E===void 0?[0,0]:E,A=tc(m.toString(),o,x,f,"left",l,b,e),F=nc(A,b,!1);return d.shaping=A,d.glyphQuads=F,d.centroid=ot(d.coordinates),d.originCentroid=d.version==="GAODE2.x"?ot(d.originCoordinates):d.originCentroid=d.centroid,i.glyphInfoMap[_]={shaping:A,glyphQuads:F,centroid:ot(d.coordinates)},d})}},{key:"filterGlyphs",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.padding,u=o===void 0?[4,4]:o,s=i.textAllowOverlap,l=s===void 0?!1:s;if(!l){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var c=this.rendererService.getViewportSize(),f=c.width,p=c.height,d=new Yl(f,p),g=this.glyphInfo.filter(function(m){var _=m.shaping,y=m.id,x=y===void 0?0:y,E=m.version==="GAODE2.x"?m.originCentroid:m.centroid,b=m.size,A=b/24,F=e.mapService.lngLatToContainer(E),I=d.placeCollisionBox({x1:_.left*A-u[0],x2:_.right*A+u[0],y1:_.top*A-u[1],y2:_.bottom*A+u[1],anchorPointX:F.x,anchorPointY:F.y}),k=I.box;return k&&k.length?(d.insertCollisionBox(k,x),!0):!1});g.forEach(function(m){e.glyphInfoMap[m.id]=m})}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig(),i=e.iconfont,o=i===void 0?!1:i;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,i=this.fontService.canvas;this.textureHeight=i.height,this.texture&&this.texture.destroy(),this.texture=e({data:i,mag:v.LINEAR,min:v.LINEAR,width:i.width,height:i.height})}},{key:"reBuildModel",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Bc,fragmentShader:Ic,triangulation:Nc.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:me(u,l)}).then(function(c){e.layer.models=[c],e.layerService.throttleRenderLayers()}).catch(function(c){console.warn(c),e.layer.models=[]})}}]),n}(ue),o3={fillImage:BC,fill:Oc,radar:KC,image:kc,normal:Pc,simplePoint:t3,extrude:Rc,text:Zc,vectorPoint:Vn,tile:Tr,tileText:lc,earthFill:AC,earthExtrude:xC},u3=o3;function s3(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l3(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function l3(t,a){if(!!t){if(typeof t=="string")return zc(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zc(t,a)}}function zc(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function c3(t){var a=f3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function f3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var p3=function(t){(0,N.Z)(n,t);var a=c3(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","PointLayer"),(0,h.Z)((0,C.Z)(r),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new u3[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,i=e.field,o=e.values,u=this.getLayerConfig(),s=u.shape2d,l=this.iconService.getIconMap();if(i&&(s==null?void 0:s.indexOf(i))!==-1)return"fill";if(o&&o instanceof Array){var c=s3(o),f;try{for(c.s();!(f=c.n()).done;){var p=f.value;if(typeof p=="string"&&l.hasOwnProperty(p))return"image"}}catch(d){c.e(d)}finally{c.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorPoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return i[e]}},{key:"getModelType",value:function(){var e=this.layerSource.getParserType();if(Ar(e))return"vectorPoint";var i=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,s=o.shape3d,l=this.iconService.getIconMap(),c=i.find(function(p){return p.hasOwnProperty("shape")});if(c){var f=c.shape;return f==="dot"?"normal":f==="simple"?"simplePoint":f==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(u==null?void 0:u.indexOf(f))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(s==null?void 0:s.indexOf(f))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":l.hasOwnProperty(f)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),n}(gt);function d3(t){var a=v3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var h3=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,g3=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,m3=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,_3=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,y3=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,x3=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,E3=function(t){(0,N.Z)(n,t);var a=d3(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.heightfixed,s=u===void 0?!1:u,l=e.raisingHeight,c=l===void 0?0:l,f=e.topsurface,p=f===void 0?!0:f,d=e.sidesurface,g=d===void 0?!0:d,m=e.sourceColor,_=e.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var y=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,y,this.cellProperties),E=x.data,b=x.width,A=x.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:v.LUMINANCE,type:v.FLOAT,width:b,height:A}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}var F=0,I=[1,1,1,1],k=[1,1,1,1];return m&&_&&(I=oe(m),k=oe(_),F=1),{u_topsurface:Number(p),u_sidesurface:Number(g),u_heightfixed:Number(s),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(c),u_opacity:(0,P.isNumber)(o)?o:1,u_linearColor:F,u_sourceColor:I,u_targetColor:k,u_texture:this.texture}}},{key:"initModels",value:function(e){this.loadTexture(),this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s,c=this.getShaders(),f=c.frag,p=c.vert,d=c.type;this.layer.buildLayerModel({moduleName:d,vertexShader:p,fragmentShader:f,triangulation:Bl,stencil:me(u,l)}).then(function(g){e([g])}).catch(function(g){console.warn(g),e([])})}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),i=e.pickLight,o=e.mapTexture;return o?{frag:m3,vert:_3,type:"polygonExtrudeTexture"}:i?{frag:y3,vert:x3,type:"polygonExtrudePickLight"}:{frag:h3,vert:g3,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e,i;(e=this.dataTexture)===null||e===void 0||e.destroy(),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,i=(0,re.Z)(e,4),o=i[0],u=i[1],s=i[2],l=i[3],c=s-o,f=l-u;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:j.Attribute,descriptor:{name:"a_uvs",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(d,g,m){var _=m[0],y=m[1];return[(_-o)/c,(y-u)/f,m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:j.Attribute,descriptor:{name:"a_Normal",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(d,g,m,_,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:j.Attribute,descriptor:{name:"a_Size",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(d){var g=d.size,m=g===void 0?10:g;return Array.isArray(m)?[m[0]]:[m]}}})}},{key:"loadTexture",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.mapTexture,u=this.rendererService.createTexture2D;if(this.texture=u({height:0,width:0}),o){var s=new Image;s.crossOrigin="",s.src=o,s.onload=function(){e.texture=u({data:s,width:s.width,height:s.height,wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,min:v.LINEAR,mag:v.LINEAR}),e.layerService.reRender()}}}}]),n}(ue);function C3(t){var a=S3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var b3=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,A3=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,T3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,M3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,R3=function(t){(0,N.Z)(n,t);var a=C3(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.raisingHeight,o=i===void 0?0:i,u=e.opacity,s=u===void 0?1:u,l=e.opacityLinear,c=l===void 0?{enable:!1,dir:"in"}:l;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var f=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,f,this.cellProperties),d=p.data,g=p.width,m=p.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:v.LUMINANCE,type:v.FLOAT,width:g,height:m}):this.createTexture2D({flipY:!0,data:[1],format:v.LUMINANCE,type:v.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(o),u_opacity:(0,P.isNumber)(s)?s:1,u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0}}},{key:"initModels",value:function(e){this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.getModelParams(),o=i.frag,u=i.vert,s=i.triangulation,l=i.type,c=this.layer.getLayerConfig(),f=c.mask,p=f===void 0?!1:f,d=c.maskInside,g=d===void 0?!0:d,m=c.workerEnabled,_=m===void 0?!1:m,y=c.enablePicking;this.layer.triangulation=s,this.layer.buildLayerModel({moduleName:l,vertexShader:u,fragmentShader:o,triangulation:s,primitive:v.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:me(p,g),workerEnabled:_,workerOptions:{modelType:l,enablePicking:y}}).then(function(x){e([x])}).catch(function(x){console.warn(x),e([])})}},{key:"clearModels",value:function(){var e;(e=this.dataTexture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig(),i=e.opacityLinear,o=i===void 0?{enable:!1,dir:"in"}:i;o.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:j.Attribute,descriptor:{name:"a_linear",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:3,update:function(s,l,c){return[c[3],c[4],c[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig(),i=e.opacityLinear,o=i===void 0?{enable:!1}:i;return o.enable?{frag:A3,vert:T3,type:"polygonLinear",triangulation:Dy}:{frag:b3,vert:M3,type:"polygonFill",triangulation:to}}}]),n}(ue);function L3(t){var a=O3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function O3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var k3=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,F3=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,P3=function(t){(0,N.Z)(n,t);var a=L3(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.watercolor,s=u===void 0?"#6D99A8":u,l=e.watercolor2,c=l===void 0?"#0F121C":l;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:oe(s),u_watercolor2:oe(c),u_opacity:(0,P.isNumber)(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.loadTexture(),this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:F3,fragmentShader:k3,triangulation:Hn,primitive:v.TRIANGLES,depth:{enable:!1},stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"clearModels",value:function(){var e,i,o;(e=this.texture1)===null||e===void 0||e.destroy(),(i=this.texture2)===null||i===void 0||i.destroy(),(o=this.texture3)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,i=(0,re.Z)(e,4),o=i[0],u=i[1],s=i[2],l=i[3],c=s-o,f=l-u;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:j.Attribute,descriptor:{name:"a_uv",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,g,m,_){var y=d.version===Le["GAODE2.x"]?d.originCoordinates[0][_]:m,x=(0,re.Z)(y,2),E=x[0],b=x[1];return[(E-o)/c,(b-u)/f]}}})}},{key:"loadTexture",value:function(){var e=this,i=this.rendererService.createTexture2D,o={height:0,width:0};this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),u(function(l){e.texture1=s(l[0]),e.texture2=s(l[1]),e.texture3=s(l[2]),e.layerService.reRender()});function u(l){var c=0,f=[],p=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];p.map(function(d){var g=new Image;g.crossOrigin="",g.src=d,f.push(g),g.onload=function(){c++,c===3&&l(f)}})}function s(l){return i({data:l,width:l.width,height:l.height,wrapS:v.MIRRORED_REPEAT,wrapT:v.MIRRORED_REPEAT,min:v.LINEAR,mag:v.LINEAR})}}}]),n}(ue);function D3(t){var a=w3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function w3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var I3=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,B3=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,N3=function(t){(0,N.Z)(n,t);var a=D3(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.speed,s=u===void 0?.5:u;return{u_texture:this.texture,u_speed:s,u_opacity:(0,P.isNumber)(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(e){this.loadTexture(),this.buildModels(e)}},{key:"buildModels",value:function(e){var i=this.layer.getLayerConfig(),o=i.mask,u=o===void 0?!1:o,s=i.maskInside,l=s===void 0?!0:s;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:B3,fragmentShader:I3,triangulation:Hn,primitive:v.TRIANGLES,depth:{enable:!1},stencil:me(u,l)}).then(function(c){e([c])}).catch(function(c){console.warn(c),e([])})}},{key:"clearModels",value:function(){var e;(e=this.texture)===null||e===void 0||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,i=(0,re.Z)(e,4),o=i[0],u=i[1],s=i[2],l=i[3],c=s-o,f=l-u;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:j.Attribute,descriptor:{name:"a_uv",buffer:{usage:v.STATIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(d,g,m,_){var y=d.version===Le["GAODE2.x"]?d.originCoordinates[0][_]:m,x=(0,re.Z)(y,2),E=x[0],b=x[1];return[(E-o)/c,(b-u)/f]}}})}},{key:"loadTexture",value:function(){var e=this,i=this.layer.getLayerConfig(),o=i.waterTexture,u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0});var s=new Image;s.crossOrigin="",o?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),s.src=o):s.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",s.onload=function(){e.texture=u({data:s,width:s.width,height:s.height,wrapS:v.MIRRORED_REPEAT,wrapT:v.MIRRORED_REPEAT,min:v.LINEAR,mag:v.LINEAR}),e.layerService.reRender()}}}]),n}(ue),Z3={fill:R3,line:Tc,extrude:E3,text:Zc,point_fill:Oc,point_image:kc,point_normal:Pc,point_extrude:Rc,water:N3,ocean:P3,vectorpolygon:Vn,tile:cc},z3=Z3;function U3(t){var a=j3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function j3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Uc=function(t){(0,N.Z)(n,t);var a=U3(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","PolygonLayer"),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new z3[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getModelType",value:function(){var e,i=this.layerSource.getParserType();if(Ar(i))return"vectorpolygon";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(e=o.scale)===null||e===void 0?void 0:e.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":u==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),i=this.getLayerConfig(),o=i.shape2d,u=i.shape3d,s=this.iconService.getIconMap(),l=e.find(function(f){return f.hasOwnProperty("shape")});if(l){var c=l.shape;return c==="dot"?"point_normal":(o==null?void 0:o.indexOf(c))!==-1?"point_fill":(u==null?void 0:u.indexOf(c))!==-1?"point_extrude":s.hasOwnProperty(c)?"point_image":"text"}else return"fill"}}]),n}(gt);function H3(t){var a=V3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var G3=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,W3=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,jc=function(t){(0,N.Z)(n,t);var a=H3(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),i=e.opacity,o=i===void 0?1:i,u=e.clampLow,s=u===void 0?!0:u,l=e.clampHigh,c=l===void 0?!0:l,f=e.noDataValue,p=f===void 0?-9999999:f,d=e.domain,g=d===void 0?[0,1]:d,m=e.rampColors;return(0,P.isEqual)(this.rampColors,m)||(this.updateColorTexture(),this.rampColors=m),{u_opacity:o||1,u_texture:this.texture,u_domain:g,u_clampLow:s,u_clampHigh:typeof c!="undefined"?c:s,u_noDataValue:p,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c;return H().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!Array.isArray(o.data)){p.next=4;break}return p.abrupt("return",{data:o.data,width:o.width,height:o.height});case 4:return p.next=6,o.data;case 6:return u=p.sent,s=u.rasterData,l=u.width,c=u.height,p.abrupt("return",{data:Array.from(s),width:l,height:c});case 11:case"end":return p.stop()}},i)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var r=(0,te.Z)(H().mark(function i(o){var u,s,l,c,f,p,d,g,m,_,y,x,E,b,A;return H().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return u=this.layer.getLayerConfig(),s=u.mask,l=s===void 0?!1:s,c=u.maskInside,f=c===void 0?!0:c,p=u.rampColorsData,d=u.rampColors,g=this.layer.getSource(),m=this.rendererService.createTexture2D,_=g.data.dataArray[0],I.next=6,this.getRasterData(_);case 6:y=I.sent,x=y.data,E=y.width,b=y.height,this.texture=m({data:x,width:E,height:b,format:v.LUMINANCE,type:v.FLOAT}),A=p||kt(d),this.colorTexture=m({data:A.data,width:A.width,height:A.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:W3,fragmentShader:G3,triangulation:gn,primitive:v.TRIANGLES,depth:{enable:!1},stencil:me(l,f)}).then(function(k){o([k])}).catch(function(k){console.warn(k),o([])});case 14:case"end":return I.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"buildModels",value:function(e){this.initModels(e)}},{key:"clearModels",value:function(){var e,i;(e=this.texture)===null||e===void 0||e.destroy(),(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:j.Attribute,descriptor:{name:"a_Uv",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:2,update:function(i,o,u){return[u[3],u[4]]}}})}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D,i=this.layer.getLayerConfig(),o=i.rampColors,u=kt(o);this.colorTexture=e({data:u.data,width:u.width,height:u.height,flipY:!1})}}]),n}(ue),$3={raster:jc,rasterRgb:yc,raster3d:jc,rasterTile:Vn},X3=$3;function Y3(t){var a=K3();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var Q3=function(t){(0,N.Z)(n,t);var a=Y3(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","RasterLayer"),r}return(0,L.Z)(n,[{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new X3[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getDefaultConfig",value:function(){var e=this.getModelType(),i={raster:{},rasterRgb:{},raster3d:{},rasterTile:{}};return i[e]}},{key:"getModelType",value:function(){var e=this.layerSource.getParserType();switch(e){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rasterTile":return"rasterTile";default:return"raster"}}}]),n}(gt),q3={fill:fc,vectorMask:Vn},J3=q3;function eS(t,a){var n=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=tS(t))||a&&t&&typeof t.length=="number"){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(o)throw u}}}}function tS(t,a){if(!!t){if(typeof t=="string")return Hc(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hc(t,a)}}function Hc(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function nS(t){var a=rS();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var iS=function(t){(0,N.Z)(n,t);var a=nS(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"type","MaskLayer"),r}return(0,L.Z)(n,[{key:"init",value:function(){var e=this,i=this.container.get(M.SceneID);this.configService.setLayerConfig(i,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.rendererService=this.container.get(M.IRendererService),this.layerService=this.container.get(M.ILayerService),this.mapService=this.container.get(M.IMapService),this.cameraService=this.container.get(M.ICameraService),this.coordinateService=this.container.get(M.ICoordinateSystemService),this.shaderModuleService=this.container.get(M.IShaderModuleService),this.postProcessingPassFactory=this.container.get(M.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(M.IFactoryNormalPass),this.styleAttributeService=this.container.get(M.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(l){var c=l.attributeName,f=l.attributeField,p=l.attributeValues,d=l.updateOptions;e.styleAttributeService.updateStyleAttribute(c,{scale:(0,T.Z)({field:f},e.splitValuesAndCallbackInAttribute(p,e.getLayerConfig()[c]))},d)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(M.ILayerPlugin);var o=eS(this.plugins),u;try{for(o.s();!(u=o.n()).done;){var s=u.value;s.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(l){o.e(l)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"buildModels",value:function(){var e=this,i=this.getModelType();this.layerModel=new J3[i](this),this.layerModel.initModels(function(o){e.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var e=this;this.layerModel.buildModels(function(i){e.dispatchModelLoad(i)})}},{key:"getModelType",value:function(){var e=this.layerSource.getParserType();return Ar(e)?"vectorMask":"fill"}}]),n}(gt),Vc,Gc,Wc,$c,Lr,Xc,Yc,aS=(Vc=(0,W.b2)(),Gc=(0,W.f3)(M.IMapService),Wc=(0,W.f3)(M.IFontService),Vc($c=(Lr=function(){function t(){(0,R.Z)(this,t),(0,ae.Z)(this,"mapService",Xc,this),(0,ae.Z)(this,"fontService",Yc,this)}return(0,L.Z)(t,[{key:"apply",value:function(n,r){var e=this,i=r.styleAttributeService;n.hooks.init.tap("DataMappingPlugin",function(){var o=n.getSource();o.inited?e.generateMaping(n,{styleAttributeService:i}):o.once("update",function(){e.generateMaping(n,{styleAttributeService:i})})}),n.hooks.beforeRenderData.tap("DataMappingPlugin",function(){n.dataState.dataMappingNeedUpdate=!1;var o=n.getSource();return o.inited?e.generateMaping(n,{styleAttributeService:i}):o.once("update",function(){e.generateMaping(n,{styleAttributeService:i})}),!0}),n.hooks.beforeRender.tap("DataMappingPlugin",function(){var o=n.getLayerConfig(),u=o.usage;if(u!=="basemap"){var s=n.getSource();if(!(n.layerModelNeedUpdate||!s||!s.inited)){var l=n.getBottomColor(),c=i.getLayerStyleAttributes()||[],f=i.getLayerStyleAttribute("filter"),p=s.data.dataArray,d=c.filter(function(y){return y.needRemapping}),g=p;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(g=p.filter(function(y){return e.applyAttributeMapping(f,y,l)[0]})),d.length){if(f!=null&&f.needRemapping){var m=e.mapping(n,c,g,void 0,l);n.setEncodedData(m),f.needRemapping=!1}else{var _=e.mapping(n,d,g,n.getEncodedData(),l);n.setEncodedData(_)}n.emit("remapping",null)}}}})}},{key:"generateMaping",value:function(n,r){var e=this,i=r.styleAttributeService,o=n.getBottomColor(),u=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter"),l=n.getSource().data.dataArray,c=l;s!=null&&s.scale&&(c=l.filter(function(p){return e.applyAttributeMapping(s,p,o)[0]}));var f=this.mapping(n,u,c,void 0,o);n.setEncodedData(f),n.emit("dataUpdate",null)}},{key:"mapping",value:function(n,r,e,i,o){var u=this,s=n.getLayerConfig(),l=s.arrow,c=l===void 0?{enable:!1}:l,f=s.usage;if(f==="basemap")return this.mapLayerMapping(n,r,e,i);var p=r.filter(function(g){return g.scale!==void 0}),d=e.map(function(g,m){var _=i?i[m]:{},y=(0,T.Z)({id:g._id,coordinates:g.coordinates},_);if(p.forEach(function(b){var A=u.applyAttributeMapping(b,g,o);b.needRemapping=!1,b.name==="color"&&(A=A.map(function(F){return oe(F)})),y[b.name]=Array.isArray(A)&&A.length===1?A[0]:A,b.name==="shape"&&(y.shape=u.fontService.getIconFontKey(y[b.name]))}),c.enable&&(y.shape==="line"||y.shape==="halfLine")){var x=y.coordinates;if(n.arrowInsertCount<n.encodeDataLength){var E=u.getArrowPoints(x[0],x[1]);y.coordinates.splice(1,0,E,E),n.arrowInsertCount++}}return y});return this.adjustData2Amap2Coordinates(d,n),this.adjustData2SimpleCoordinates(d),d}},{key:"mapLayerMapping",value:function(n,r,e,i){var o=this,u=r.filter(function(l){return l.scale!==void 0}),s=e.map(function(l,c){var f=i?i[c]:{},p=(0,T.Z)({id:l._id,coordinates:l.coordinates},f);return u.forEach(function(d){var g;if(d.name==="shape"&&((g=n.shapeOption)===null||g===void 0?void 0:g.field)==="simple")p[d.name]="simple",d.needRemapping=!1;else{var m=o.applyMapLayerAttributeMapping(d,l);d.needRemapping=!1,p[d.name]=Array.isArray(m)&&m.length===1?m[0]:m,d.name==="shape"&&(p.shape=o.fontService.getIconFontKey(p[d.name]))}}),p.size===void 0&&(p.size=1),p});return this.adjustData2Amap2Coordinates(s,n),s}},{key:"adjustData2Amap2Coordinates",value:function(n,r){var e=this;if(n.length>0&&this.mapService.version===Le["GAODE2.x"]){var i=r.coordCenter||r.getSource().center;typeof n[0].coordinates[0]=="number"?n.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=Le["GAODE2.x"],o.originCoordinates=(0,P.cloneDeep)(o.coordinates),o.coordinates=e.mapService.lngLatToCoordByLayer(o.coordinates,i)}):n.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=Le["GAODE2.x"],o.originCoordinates=(0,P.cloneDeep)(o.coordinates),o.coordinates=e.mapService.lngLatToCoordsByLayer(o.coordinates,i)})}}},{key:"adjustData2SimpleCoordinates",value:function(n){var r=this;n.length>0&&this.mapService.version===Le.SIMPLE&&n.map(function(e){e.simpleCoordinate||(e.coordinates=r.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(n){var r=this;if(typeof n[0]=="number")return this.mapService.simpleMapCoord.unproject(n);if(n[0]&&n[0][0]instanceof Array){var e=[];return n.map(function(o){var u=[];o.map(function(s){u.push(r.mapService.simpleMapCoord.unproject(s))}),e.push(u)}),e}else{var i=[];return n.map(function(o){i.push(r.mapService.simpleMapCoord.unproject(o))}),i}}},{key:"applyAttributeMapping",value:function(n,r,e){var i;if(!n.scale)return[];var o=(n==null||(i=n.scale)===null||i===void 0?void 0:i.scalers)||[],u=[];o.forEach(function(l){var c,f=l.field;(r.hasOwnProperty(f)||((c=n.scale)===null||c===void 0?void 0:c.type)==="variable")&&u.push(r[f])});var s=n.mapping?n.mapping(u):[];return n.name==="color"&&!qa(s[0])?[e]:s}},{key:"applyMapLayerAttributeMapping",value:function(n,r){var e;if(!n.scale)return[];var i=(n==null||(e=n.scale)===null||e===void 0?void 0:e.scalers)||[],o=[];i.forEach(function(s){var l,c=s.field;(r.hasOwnProperty(c)||((l=n.scale)===null||l===void 0?void 0:l.type)==="variable")&&o.push(r[c])});var u=n.mapping?n.mapping(o):[];return u}},{key:"getArrowPoints",value:function(n,r){var e=[r[0]-n[0],r[1]-n[1]],i=Xa(e),o=[n[0]+i[0]*1e-4,n[1]+i[1]*1e-4];return o}}]),t}(),Xc=(0,ie.Z)(Lr.prototype,"mapService",[Gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc=(0,ie.Z)(Lr.prototype,"fontService",[Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr))||$c),Kc,Qc,oS=(Kc=(0,W.b2)(),Kc(Qc=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n){var r=this;this.mapService=n.getContainer().get(M.IMapService),n.hooks.init.tap("DataSourcePlugin",function(){var e=n.getSource();if(!e){var i=n.sourceOption||n.defaultSourceConfig,o=i.data,u=i.options;e=new In(o,u),n.setSource(e)}e.inited?r.updateClusterData(n):e.once("update",function(){r.updateClusterData(n)})}),n.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var e=r.updateClusterData(n),i=n.dataState.dataSourceNeedUpdate;return n.dataState.dataSourceNeedUpdate=!1,e||i})}},{key:"updateClusterData",value:function(n){if(n.isTileLayer||n.tileLayer)return!1;var r=n.getSource(),e=r.cluster,i=r.clusterOptions.zoom,o=i===void 0?0:i,u=this.mapService.getZoom()-1,s=n.dataState.dataSourceNeedUpdate;return e&&s&&r.updateClusterData(Math.floor(u)),e&&Math.abs(n.clusterZoom-u)>=1?(o!==Math.floor(u)&&r.updateClusterData(Math.floor(u)),n.clusterZoom=u,!0):!1}}]),t}())||Qc),qc=O(94587),uS=O(87765),tt=O(16050),nt,Jc,ef,sS=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,lS=(nt={},(0,h.Z)(nt,ye.LINEAR,tt.BY),(0,h.Z)(nt,ye.POWER,tt.vY),(0,h.Z)(nt,ye.LOG,tt.p2),(0,h.Z)(nt,ye.IDENTITY,tt.ez),(0,h.Z)(nt,ye.SEQUENTIAL,tt.cJ),(0,h.Z)(nt,ye.TIME,tt.Xf),(0,h.Z)(nt,ye.QUANTILE,tt.FT),(0,h.Z)(nt,ye.QUANTIZE,tt.aE),(0,h.Z)(nt,ye.THRESHOLD,tt.ut),(0,h.Z)(nt,ye.CAT,tt.PK),(0,h.Z)(nt,ye.DIVERGING,tt.AB),nt),cS=(Jc=(0,W.b2)(),Jc(ef=function(){function t(){(0,R.Z)(this,t),(0,h.Z)(this,"scaleOptions",{})}return(0,L.Z)(t,[{key:"getSourceData",value:function(n,r){var e=n.getSource();e.inited?r(e.data):e.once("update",function(){r(e.data)})}},{key:"apply",value:function(n,r){var e=this,i=r.styleAttributeService;n.hooks.init.tap("FeatureScalePlugin",function(){e.scaleOptions=n.getScaleOptions();var o=i.getLayerStyleAttributes();e.getSourceData(n,function(u){var s=u.dataArray;Array.isArray(s)&&s.length===0||e.caculateScalesForAttributes(o||[],s)})}),n.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){e.scaleOptions=n.getScaleOptions();var o=i.getLayerStyleAttributes();return e.getSourceData(n,function(u){var s=u.dataArray;Array.isArray(s)&&s.length===0||(e.caculateScalesForAttributes(o||[],s),n.layerModelNeedUpdate=!0)}),!0}),n.hooks.beforeRender.tap("FeatureScalePlugin",function(){var o=n.getLayerConfig(),u=o.usage;if(!(n.layerModelNeedUpdate||u==="basemap")){e.scaleOptions=n.getScaleOptions();var s=i.getLayerStyleAttributes();s&&e.getSourceData(n,function(l){var c=l.dataArray;if(c.length!==0){var f=s.filter(function(p){return p.needRescale});f.length&&e.caculateScalesForAttributes(f,c)}})}})}},{key:"isNumber",value:function(n){return!isNaN(parseFloat(n))&&isFinite(n)}},{key:"caculateScalesForAttributes",value:function(n,r){var e=this;n.forEach(function(i){if(i.scale){var o=i.scale;o.names=e.parseFields(i.scale.field||[]);var u=[];o.names.forEach(function(s){var l;u.push(e.createScale(s,i.name,(l=i.scale)===null||l===void 0?void 0:l.values,r))}),u.some(function(s){return s.type===Nt.VARIABLE})?(o.type=Nt.VARIABLE,u.forEach(function(s){var l;if(!o.callback&&o.values!=="text")switch((l=s.option)===null||l===void 0?void 0:l.type){case ye.LOG:case ye.LINEAR:case ye.POWER:if(o.values&&o.values.length>2){var c=s.scale.ticks(o.values.length);s.scale.domain(c)}o.values?s.scale.range(o.values):s.scale.range(s.option.domain);break;case ye.QUANTILE:case ye.QUANTIZE:case ye.THRESHOLD:s.scale.range(o.values);break;case ye.CAT:o.values?s.scale.range(o.values):s.scale.range(s.option.domain);break;case ye.DIVERGING:case ye.SEQUENTIAL:s.scale.interpolator(uS.hD(o.values));break}if(o.values==="text"){var f;s.scale.range((f=s.option)===null||f===void 0?void 0:f.domain)}})):(o.type=Nt.CONSTANT,o.defaultValues=u.map(function(s,l){return s.scale(o.names[l])})),o.scalers=u.map(function(s){return{field:s.field,func:s.scale,option:s.option}}),i.needRescale=!1}})}},{key:"parseFields",value:function(n){return Array.isArray(n)?n:(0,P.isString)(n)?n.split("*"):[n]}},{key:"createScale",value:function(n,r,e,i){var o,u,s=this.scaleOptions[r]&&((o=this.scaleOptions[r])===null||o===void 0?void 0:o.field)===n?this.scaleOptions[r]:this.scaleOptions[n],l={field:n,scale:void 0,type:Nt.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?l.scale=this.createDefaultScale(s):(l.scale=tt.PK([n]),l.type=Nt.CONSTANT),l;var c=(u=i.find(function(d){return!(0,P.isNil)(d[n])}))===null||u===void 0?void 0:u[n];if(this.isNumber(n)||(0,P.isNil)(c)&&!s)l.scale=tt.PK([n]),l.type=Nt.CONSTANT;else{var f=s&&s.type||this.getDefaultType(c);e==="text"&&(f=ye.CAT);var p=this.createScaleConfig(f,n,s,i);l.scale=this.createDefaultScale(p),l.option=p}return l}},{key:"getDefaultType",value:function(n){var r=ye.LINEAR;return typeof n=="string"&&(r=sS.test(n)?ye.TIME:ye.CAT),r}},{key:"createScaleConfig",value:function(n,r,e,i){var o={type:n},u=(i==null?void 0:i.map(function(c){return c[r]}))||[];if(e!=null&&e.domain)o.domain=e==null?void 0:e.domain;else if(n!==ye.CAT&&n!==ye.QUANTILE&&n!==ye.DIVERGING)o.domain=(0,qc.We)(u);else if(n===ye.CAT)o.domain=(0,P.uniq)(u);else if(n===ye.QUANTILE)o.domain=u;else if(n===ye.DIVERGING){var s=(0,qc.We)(u),l=(e==null?void 0:e.neutral)!==void 0?e==null?void 0:e.neutral:(s[0]+s[1])/2;o.domain=[s[0],l,s[1]]}return(0,T.Z)((0,T.Z)({},o),e)}},{key:"createDefaultScale",value:function(n){var r=n.type,e=n.domain,i=n.unknown,o=n.clamp,u=n.nice,s=lS[r]();return e&&s.domain&&s.domain(e),i&&s.unknown(i),o!==void 0&&s.clamp&&s.clamp(o),u!==void 0&&s.nice&&s.nice(u),s}}]),t}())||ef),tf,nf,fS=(tf=(0,W.b2)(),tf(nf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n){n.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var r=n.animateStatus;r&&n.models.forEach(function(e){e.addUniforms((0,T.Z)({},n.layerModel.getAnimateUniforms()))})})}}]),t}())||nf),rf,af,pS=(rf=(0,W.b2)(),rf(af=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"initLayerModel",value:function(n){n.prepareBuildModel(),n.buildModels(),n.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(n){var r;n.prepareBuildModel(),(r=n.layerModel)===null||r===void 0||r.clearModels(),n.buildModels(),n.layerModelNeedUpdate=!1}},{key:"apply",value:function(n){var r=this;n.hooks.init.tap("LayerModelPlugin",function(){n.inited=!0,n.modelLoaded=!1;var e=n.getSource();e.inited&&r.initLayerModel(n)}),n.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var e=n.getSource();return n.modelLoaded=!1,e.inited?r.prepareLayerModel(n):e.once("update",function(){r.prepareLayerModel(n)}),!1})}}]),t}())||af),of,uf,dS=(of=(0,W.b2)(),of(uf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n){n.hooks.afterInit.tap("LayerStylePlugin",function(){n.updateLayerConfig({});var r=n.getLayerConfig(),e=r.autoFit,i=r.fitBoundsOptions;e&&setTimeout(function(){n.fitBounds(i)},100)})}}]),t}())||uf),sf,lf,vS=["type"],cf={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},hS={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},gS={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},mS={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function _S(t){var a={u_DirectionalLights:new Array(3).fill((0,T.Z)({},gS)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,T.Z)({},mS)),u_NumOfSpotLights:0};return(!t||!t.length)&&(t=[hS]),t.forEach(function(n){var r=n.type,e=r===void 0?"directional":r,i=(0,It.Z)(n,vS),o=cf[e].lights,u=cf[e].num,s=a[u];a[o][s]=(0,T.Z)((0,T.Z)({},a[o][s]),i),a[u]++}),a}var yS=(sf=(0,W.b2)(),sf(lf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n){n.hooks.beforeRender.tap("LightingPlugin",function(){var r=n.getLayerConfig(),e=r.enableLighting;e&&n.models.forEach(function(i){return i.addUniforms((0,T.Z)({},_S()))})})}}]),t}())||lf),ff,pf,xS=(ff=(0,W.b2)(),ff(pf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n,r){var e=this,i=r.rendererService,o=r.postProcessingPassFactory,u=r.normalPassFactory;n.hooks.init.tap("MultiPassRendererPlugin",function(){var s=n.getLayerConfig(),l=s.enableMultiPassRenderer,c=s.passes,f=c===void 0?[]:c;e.enabled=!!l&&n.getLayerConfig().enableMultiPassRenderer!==!1,e.enabled&&(n.multiPassRenderer=yl(n,f,o,u),n.multiPassRenderer.setRenderFlag(!0))}),n.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(e.enabled){var s=i.getViewportSize(),l=s.width,c=s.height;n.multiPassRenderer.resize(l,c)}})}}]),t}())||pf),df,vf,Or={NONE:0,ENCODE:1,HIGHLIGHT:2},ES=(df=(0,W.b2)(),df(vf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n,r){var e=r.styleAttributeService;n.hooks.init.tap("PixelPickingPlugin",function(){var i=n.getLayerConfig(),o=i.enablePicking;e.registerStyleAttribute({name:"pickingColor",type:j.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:v.FLOAT},size:3,update:function(s){var l=s.id;return o?Ot(l):[0,0,0]}}})}),n.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var i=n.getLayerConfig(),o=i.enablePicking;o&&n.isVisible()&&n.models.forEach(function(u){return u.addUniforms({u_PickingStage:Or.ENCODE})})}),n.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var i=n.getLayerConfig(),o=i.enablePicking;o&&n.isVisible()&&n.models.forEach(function(u){return u.addUniforms({u_PickingStage:Or.HIGHLIGHT})})}),n.hooks.beforeHighlight.tap("PixelPickingPlugin",function(i){var o=n.getLayerConfig(),u=o.highlightColor,s=o.activeMix,l=s===void 0?0:s,c=typeof u=="string"?oe(u):u||[1,0,0,1];n.updateLayerConfig({pickedFeatureID:Lt(new Uint8Array(i))}),n.models.forEach(function(f){return f.addUniforms({u_PickingStage:Or.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:c.map(function(p){return p*255}),u_activeMix:l})})}),n.hooks.beforeSelect.tap("PixelPickingPlugin",function(i){var o=n.getLayerConfig(),u=o.selectColor,s=o.selectMix,l=s===void 0?0:s,c=typeof u=="string"?oe(u):u||[1,0,0,1];n.updateLayerConfig({pickedFeatureID:Lt(new Uint8Array(i))}),n.models.forEach(function(f){return f.addUniforms({u_PickingStage:Or.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:c.map(function(p){return p*255}),u_activeMix:l,u_CurrentSelectedId:i,u_SelectColor:c.map(function(p){return p*255}),u_EnableSelect:1})})})}}]),t}())||vf),hf,gf,CS=(hf=(0,W.b2)(),hf(gf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n,r){var e=this,i=r.styleAttributeService;n.hooks.init.tap("RegisterStyleAttributePlugin",function(){W1(n)||e.registerBuiltinAttributes(i,n)})}},{key:"registerBuiltinAttributes",value:function(n,r){if(r.type==="MaskLayer"){this.registerPositionAttribute(n);return}var e=r.getLayerConfig(),i=e.usage;if(i==="basemap"){this.registerPositionAttribute(n);return}if(r.isTileLayer){this.registerPositionAttribute(n),this.registerColorAttribute(n);return}this.registerPositionAttribute(n),this.registerFilterAttribute(n),this.registerColorAttribute(n),this.registerVertexIdAttribute(n)}},{key:"registerPositionAttribute",value:function(n){n.registerStyleAttribute({name:"position",type:j.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:v.FLOAT},size:3,update:function(e,i,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}})}},{key:"registerFilterAttribute",value:function(n){n.registerStyleAttribute({name:"filter",type:j.Attribute,descriptor:{name:"filter",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(e){var i=e.filter;return i?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(n){n.registerStyleAttribute({name:"color",type:j.Attribute,descriptor:{name:"a_Color",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:4,update:function(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}}})}},{key:"registerVertexIdAttribute",value:function(n){n.registerStyleAttribute({name:"vertexId",type:j.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:v.DYNAMIC_DRAW,data:[],type:v.FLOAT},size:1,update:function(e,i){return[i]}}})}}]),t}())||gf),mf,_f,yf,xf,Ef,Cf,yn,Sf,bf,Af,Tf,SS=(mf=(0,W.b2)(),_f=(0,W.f3)(M.ICameraService),yf=(0,W.f3)(M.ICoordinateSystemService),xf=(0,W.f3)(M.IRendererService),Ef=(0,W.f3)(M.IMapService),mf(Cf=(yn=function(){function t(){(0,R.Z)(this,t),(0,ae.Z)(this,"cameraService",Sf,this),(0,ae.Z)(this,"coordinateSystemService",bf,this),(0,ae.Z)(this,"rendererService",Af,this),(0,ae.Z)(this,"mapService",Tf,this)}return(0,L.Z)(t,[{key:"apply",value:function(n){var r=this,e=this.mapService.version,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];n.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var u=n.getLayerConfig().tileOrigin;r.coordinateSystemService.refresh(u),e==="GAODE2.x"&&(r.setLayerCenter(n),i=r.mapService.map.customCoords.getMVPMatrix(),o=r.mapService.getCustomCoordCenter());var s=r.rendererService.getViewportSize(),l=s.width,c=s.height;n.models.forEach(function(f){var p;f.addUniforms((p={},(0,h.Z)(p,Xt.ProjectionMatrix,r.cameraService.getProjectionMatrix()),(0,h.Z)(p,Xt.ViewMatrix,r.cameraService.getViewMatrix()),(0,h.Z)(p,Xt.ViewProjectionMatrix,r.cameraService.getViewProjectionMatrix()),(0,h.Z)(p,Xt.Zoom,r.cameraService.getZoom()),(0,h.Z)(p,Xt.ZoomScale,r.cameraService.getZoomScale()),(0,h.Z)(p,Xt.FocalDistance,r.cameraService.getFocalDistance()),(0,h.Z)(p,Xt.CameraPosition,r.cameraService.getCameraPosition()),(0,h.Z)(p,Wt.CoordinateSystem,r.coordinateSystemService.getCoordinateSystem()),(0,h.Z)(p,Wt.ViewportCenter,r.coordinateSystemService.getViewportCenter()),(0,h.Z)(p,Wt.ViewportCenterProjection,r.coordinateSystemService.getViewportCenterProjection()),(0,h.Z)(p,Wt.PixelsPerDegree,r.coordinateSystemService.getPixelsPerDegree()),(0,h.Z)(p,Wt.PixelsPerDegree2,r.coordinateSystemService.getPixelsPerDegree2()),(0,h.Z)(p,Wt.PixelsPerMeter,r.coordinateSystemService.getPixelsPerMeter()),(0,h.Z)(p,Wt.Mvp,i),(0,h.Z)(p,"u_SceneCenterMKT",o),(0,h.Z)(p,"u_ViewportSize",[l,c]),(0,h.Z)(p,"u_ModelMatrix",r.cameraService.getModelMatrix()),(0,h.Z)(p,"u_DevicePixelRatio",_e.devicePixelRatio),(0,h.Z)(p,"u_PickingBuffer",n.getLayerConfig().pickingBuffer||0),(0,h.Z)(p,"u_shaderPick",Number(n.getShaderPickStat())),p))})})}},{key:"setLayerCenter",value:function(n){n.coordCenter===void 0&&(n.coordCenter=n.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(n.coordCenter)}}]),t}(),Sf=(0,ie.Z)(yn.prototype,"cameraService",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bf=(0,ie.Z)(yn.prototype,"coordinateSystemService",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af=(0,ie.Z)(yn.prototype,"rendererService",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tf=(0,ie.Z)(yn.prototype,"mapService",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yn))||Cf),Mf,Rf,bS=(Mf=(0,W.b2)(),Mf(Rf=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n){n.hooks.beforeRender.tap("UpdateModelPlugin",function(){n.layerModel&&n.layerModel.needUpdate()})}}]),t}())||Rf),Lf,Of,AS=(Lf=(0,W.b2)(),Lf(Of=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"apply",value:function(n,r){var e=this,i=r.styleAttributeService;n.hooks.init.tap("UpdateStyleAttributePlugin",function(){e.initStyleAttribute(n,{styleAttributeService:i})}),n.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){var o=n.getLayerConfig(),u=o.usage;n.layerModelNeedUpdate||n.tileLayer||u==="basemap"||n.modelLoaded&&e.updateStyleAttribute(n,{styleAttributeService:i})})}},{key:"updateStyleAttribute",value:function(n,r){var e=r.styleAttributeService,i=e.getLayerStyleAttributes()||[],o=e.getLayerStyleAttribute("filter");if(o&&o.needRegenerateVertices){n.layerModelNeedUpdate=!0,i.forEach(function(u){return u.needRegenerateVertices=!1});return}i.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){e.updateAttributeByFeatureRange(u.name,n.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex,n),u.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(n,r){var e=r.styleAttributeService,i=e.getLayerStyleAttributes()||[];i.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){e.updateAttributeByFeatureRange(o.name,n.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),t}())||Of);Je.bind(M.ILayerPlugin).to(oS).inRequestScope(),Je.bind(M.ILayerPlugin).to(CS).inRequestScope(),Je.bind(M.ILayerPlugin).to(cS).inRequestScope(),Je.bind(M.ILayerPlugin).to(aS).inRequestScope(),Je.bind(M.ILayerPlugin).to(dS).inRequestScope(),Je.bind(M.ILayerPlugin).to(AS).inRequestScope(),Je.bind(M.ILayerPlugin).to(bS).inRequestScope(),Je.bind(M.ILayerPlugin).to(xS).inRequestScope(),Je.bind(M.ILayerPlugin).to(SS).inRequestScope(),Je.bind(M.ILayerPlugin).to(fS).inRequestScope(),Je.bind(M.ILayerPlugin).to(yS).inRequestScope(),Je.bind(M.ILayerPlugin).to(ES).inRequestScope(),Je.bind(M.ILayerPlugin).to(pS).inRequestScope();var TS=O(88307),MS=O.n(TS),RS=function(){function t(a,n){(0,R.Z)(this,t);var r=n.buffer,e=n.offset,i=n.stride,o=n.normalized,u=n.size,s=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:e||0,stride:i||0,normalized:o||!1,divisor:s||0},u&&(this.attribute.size=u)}return(0,L.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(n){this.buffer.subData(n)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),Mt,Gn,Rt,lt,Wn,jt,$n,kr,mt,en,je,_t,yt,Fr,LS=(Mt={},(0,h.Z)(Mt,v.POINTS,"points"),(0,h.Z)(Mt,v.LINES,"lines"),(0,h.Z)(Mt,v.LINE_LOOP,"line loop"),(0,h.Z)(Mt,v.LINE_STRIP,"line strip"),(0,h.Z)(Mt,v.TRIANGLES,"triangles"),(0,h.Z)(Mt,v.TRIANGLE_FAN,"triangle fan"),(0,h.Z)(Mt,v.TRIANGLE_STRIP,"triangle strip"),Mt),kf=(Gn={},(0,h.Z)(Gn,v.STATIC_DRAW,"static"),(0,h.Z)(Gn,v.DYNAMIC_DRAW,"dynamic"),(0,h.Z)(Gn,v.STREAM_DRAW,"stream"),Gn),na=(Rt={},(0,h.Z)(Rt,v.BYTE,"int8"),(0,h.Z)(Rt,v.UNSIGNED_INT,"int16"),(0,h.Z)(Rt,v.INT,"int32"),(0,h.Z)(Rt,v.UNSIGNED_BYTE,"uint8"),(0,h.Z)(Rt,v.UNSIGNED_SHORT,"uint16"),(0,h.Z)(Rt,v.UNSIGNED_INT,"uint32"),(0,h.Z)(Rt,v.FLOAT,"float"),Rt),OS=(lt={},(0,h.Z)(lt,v.ALPHA,"alpha"),(0,h.Z)(lt,v.LUMINANCE,"luminance"),(0,h.Z)(lt,v.LUMINANCE_ALPHA,"luminance alpha"),(0,h.Z)(lt,v.RGB,"rgb"),(0,h.Z)(lt,v.RGBA,"rgba"),(0,h.Z)(lt,v.RGBA4,"rgba4"),(0,h.Z)(lt,v.RGB5_A1,"rgb5 a1"),(0,h.Z)(lt,v.RGB565,"rgb565"),(0,h.Z)(lt,v.DEPTH_COMPONENT,"depth"),(0,h.Z)(lt,v.DEPTH_STENCIL,"depth stencil"),lt),kS=(Wn={},(0,h.Z)(Wn,v.DONT_CARE,"dont care"),(0,h.Z)(Wn,v.NICEST,"nice"),(0,h.Z)(Wn,v.FASTEST,"fast"),Wn),Ff=(jt={},(0,h.Z)(jt,v.NEAREST,"nearest"),(0,h.Z)(jt,v.LINEAR,"linear"),(0,h.Z)(jt,v.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,h.Z)(jt,v.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,h.Z)(jt,v.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,h.Z)(jt,v.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),jt),Pf=($n={},(0,h.Z)($n,v.REPEAT,"repeat"),(0,h.Z)($n,v.CLAMP_TO_EDGE,"clamp"),(0,h.Z)($n,v.MIRRORED_REPEAT,"mirror"),$n),FS=(kr={},(0,h.Z)(kr,v.NONE,"none"),(0,h.Z)(kr,v.BROWSER_DEFAULT_WEBGL,"browser"),kr),PS=(mt={},(0,h.Z)(mt,v.NEVER,"never"),(0,h.Z)(mt,v.ALWAYS,"always"),(0,h.Z)(mt,v.LESS,"less"),(0,h.Z)(mt,v.LEQUAL,"lequal"),(0,h.Z)(mt,v.GREATER,"greater"),(0,h.Z)(mt,v.GEQUAL,"gequal"),(0,h.Z)(mt,v.EQUAL,"equal"),(0,h.Z)(mt,v.NOTEQUAL,"notequal"),mt),Df=(en={},(0,h.Z)(en,v.FUNC_ADD,"add"),(0,h.Z)(en,v.MIN_EXT,"min"),(0,h.Z)(en,v.MAX_EXT,"max"),(0,h.Z)(en,v.FUNC_SUBTRACT,"subtract"),(0,h.Z)(en,v.FUNC_REVERSE_SUBTRACT,"reverse subtract"),en),Pr=(je={},(0,h.Z)(je,v.ZERO,"zero"),(0,h.Z)(je,v.ONE,"one"),(0,h.Z)(je,v.SRC_COLOR,"src color"),(0,h.Z)(je,v.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,h.Z)(je,v.SRC_ALPHA,"src alpha"),(0,h.Z)(je,v.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,h.Z)(je,v.DST_COLOR,"dst color"),(0,h.Z)(je,v.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,h.Z)(je,v.DST_ALPHA,"dst alpha"),(0,h.Z)(je,v.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,h.Z)(je,v.CONSTANT_COLOR,"constant color"),(0,h.Z)(je,v.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,h.Z)(je,v.CONSTANT_ALPHA,"constant alpha"),(0,h.Z)(je,v.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,h.Z)(je,v.SRC_ALPHA_SATURATE,"src alpha saturate"),je),DS=(_t={},(0,h.Z)(_t,v.NEVER,"never"),(0,h.Z)(_t,v.ALWAYS,"always"),(0,h.Z)(_t,v.LESS,"less"),(0,h.Z)(_t,v.LEQUAL,"lequal"),(0,h.Z)(_t,v.GREATER,"greater"),(0,h.Z)(_t,v.GEQUAL,"gequal"),(0,h.Z)(_t,v.EQUAL,"equal"),(0,h.Z)(_t,v.NOTEQUAL,"notequal"),_t),xn=(yt={},(0,h.Z)(yt,v.ZERO,"zero"),(0,h.Z)(yt,v.KEEP,"keep"),(0,h.Z)(yt,v.REPLACE,"replace"),(0,h.Z)(yt,v.INVERT,"invert"),(0,h.Z)(yt,v.INCR,"increment"),(0,h.Z)(yt,v.DECR,"decrement"),(0,h.Z)(yt,v.INCR_WRAP,"increment wrap"),(0,h.Z)(yt,v.DECR_WRAP,"decrement wrap"),yt),wS=(Fr={},(0,h.Z)(Fr,v.FRONT,"front"),(0,h.Z)(Fr,v.BACK,"back"),Fr),IS=function(){function t(a,n){(0,R.Z)(this,t);var r=n.data,e=n.usage,i=n.type;this.buffer=a.buffer({data:r,usage:kf[e||v.STATIC_DRAW],type:na[i||v.UNSIGNED_BYTE]})}return(0,L.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(n){var r=n.data,e=n.offset;this.buffer.subdata(r,e)}}]),t}(),BS=function(){function t(a,n){(0,R.Z)(this,t);var r=n.data,e=n.usage,i=n.type,o=n.count;this.elements=a.elements({data:r,usage:kf[e||v.STATIC_DRAW],type:na[i||v.UNSIGNED_BYTE],count:o})}return(0,L.Z)(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(n){var r=n.data;this.elements.subdata(r)}},{key:"destroy",value:function(){}}]),t}(),NS=function(){function t(a,n){(0,R.Z)(this,t);var r=n.width,e=n.height,i=n.color,o=n.colors,u={width:r,height:e};Array.isArray(o)&&(u.colors=o.map(function(s){return s.get()})),i&&typeof i!="boolean"&&(u.color=i.get()),this.framebuffer=a.framebuffer(u)}return(0,L.Z)(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(n){var r=n.width,e=n.height;this.framebuffer.resize(r,e)}}]),t}(),ZS=function(){function t(a,n){(0,R.Z)(this,t),(0,h.Z)(this,"destroyed",!1),(0,h.Z)(this,"uniforms",{}),this.reGl=a;var r=n.pick,e=r===void 0?!0:r,i=n.vs,o=n.fs,u=n.attributes,s=n.uniforms,l=n.primitive,c=n.count,f=n.elements,p=n.depth,d=n.blend,g=n.stencil,m=n.cull,_=n.instances,y={};this.options=n,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(A){y[A]=a.prop(A)}));var x={};Object.keys(u).forEach(function(A){x[A]=u[A].get()});var E={attributes:x,frag:o,uniforms:y,vert:i,blend:{},primitive:LS[l===void 0?v.TRIANGLES:l]};if(_&&(E.instances=_),c?E.count=c:f&&(E.elements=f.get()),this.initDepthDrawParams({depth:p},E),this.initBlendDrawParams({blend:d},E),this.initStencilDrawParams({stencil:g},E),this.initCullDrawParams({cull:m},E),this.drawCommand=a(E),e){var b=(0,P.cloneDeep)(E);b.blend=(0,T.Z)((0,T.Z)({},b.blend),{},{enable:!1}),this.drawPickCommand=a(b)}this.drawParams=E}return(0,L.Z)(t,[{key:"updateAttributesAndElements",value:function(n,r){var e={};if(Object.keys(n).forEach(function(o){e[o]=n[o].get()}),this.drawParams.attributes=e,this.drawParams.elements=r.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var i=(0,P.cloneDeep)(this.drawParams);i.blend=(0,T.Z)((0,T.Z)({},i.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(i)}}},{key:"updateAttributes",value:function(n){var r={};if(Object.keys(n).forEach(function(i){r[i]=n[i].get()}),this.drawParams.attributes=r,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var e=(0,P.cloneDeep)(this.drawParams);e.blend=(0,T.Z)((0,T.Z)({},e.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(e)}}},{key:"addUniforms",value:function(n){this.uniforms=(0,T.Z)((0,T.Z)({},this.uniforms),this.extractUniforms(n))}},{key:"draw",value:function(n,r){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var e=(0,T.Z)((0,T.Z)({},this.uniforms),this.extractUniforms(n.uniforms||{})),i={};Object.keys(e).forEach(function(o){var u=(0,Kr.Z)(e[o]);u==="boolean"||u==="number"||Array.isArray(e[o])||e[o].BYTES_PER_ELEMENT?i[o]=e[o]:i[o]=e[o].get()}),r?this.drawPickCommand&&this.drawPickCommand(i):this.drawCommand(i)}}},{key:"destroy",value:function(){var n,r;(n=this.drawParams)===null||n===void 0||(r=n.elements)===null||r===void 0||r.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(e){e==null||e.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(n,r){var e=n.depth;e&&(r.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:PS[e.func||v.LESS],range:e.range||[0,1]})}},{key:"initBlendDrawParams",value:function(n,r){var e=n.blend;if(e){var i=e.enable,o=e.func,u=e.equation,s=e.color,l=s===void 0?[0,0,0,0]:s;r.blend={enable:!!i,func:{srcRGB:Pr[o&&o.srcRGB||v.SRC_ALPHA],srcAlpha:Pr[o&&o.srcAlpha||v.SRC_ALPHA],dstRGB:Pr[o&&o.dstRGB||v.ONE_MINUS_SRC_ALPHA],dstAlpha:Pr[o&&o.dstAlpha||v.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Df[u&&u.rgb||v.FUNC_ADD],alpha:Df[u&&u.alpha||v.FUNC_ADD]},color:l}}}},{key:"initStencilDrawParams",value:function(n,r){var e=n.stencil;if(e){var i=e.enable,o=e.mask,u=o===void 0?-1:o,s=e.func,l=s===void 0?{cmp:v.ALWAYS,ref:0,mask:-1}:s,c=e.opFront,f=c===void 0?{fail:v.KEEP,zfail:v.KEEP,zpass:v.KEEP}:c,p=e.opBack,d=p===void 0?{fail:v.KEEP,zfail:v.KEEP,zpass:v.KEEP}:p;r.stencil={enable:!!i,mask:u,func:(0,T.Z)((0,T.Z)({},l),{},{cmp:DS[l.cmp]}),opFront:{fail:xn[f.fail],zfail:xn[f.zfail],zpass:xn[f.zpass]},opBack:{fail:xn[d.fail],zfail:xn[d.zfail],zpass:xn[d.zpass]}}}}},{key:"initCullDrawParams",value:function(n,r){var e=n.cull;if(e){var i=e.enable,o=e.face,u=o===void 0?v.BACK:o;r.cull={enable:!!i,face:wS[u]}}}},{key:"extractUniforms",value:function(n){var r=this,e={};return Object.keys(n).forEach(function(i){r.extractUniformsRecursively(i,n[i],e,"")}),e}},{key:"extractUniformsRecursively",value:function(n,r,e,i){var o=this;if(r===null||typeof r=="number"||typeof r=="boolean"||Array.isArray(r)&&typeof r[0]=="number"||(0,P.isTypedArray)(r)||r===""||"resize"in r){e["".concat(i&&i+".").concat(n)]=r;return}(0,P.isPlainObject)(r)&&Object.keys(r).forEach(function(u){o.extractUniformsRecursively(u,r[u],e,"".concat(i&&i+".").concat(n))}),Array.isArray(r)&&r.forEach(function(u,s){Object.keys(u).forEach(function(l){o.extractUniformsRecursively(l,u[l],e,"".concat(i&&i+".").concat(n,"[").concat(s,"]"))})})}}]),t}(),zS=function(){function t(a,n){(0,R.Z)(this,t),(0,h.Z)(this,"isDistroy",!1);var r=n.data,e=n.type,i=e===void 0?v.UNSIGNED_BYTE:e,o=n.width,u=n.height,s=n.flipY,l=s===void 0?!1:s,c=n.format,f=c===void 0?v.RGBA:c,p=n.mipmap,d=p===void 0?!1:p,g=n.wrapS,m=g===void 0?v.CLAMP_TO_EDGE:g,_=n.wrapT,y=_===void 0?v.CLAMP_TO_EDGE:_,x=n.aniso,E=x===void 0?0:x,b=n.alignment,A=b===void 0?1:b,F=n.premultiplyAlpha,I=F===void 0?!1:F,k=n.mag,w=k===void 0?v.NEAREST:k,z=n.min,$=z===void 0?v.NEAREST:z,X=n.colorSpace,ne=X===void 0?v.BROWSER_DEFAULT_WEBGL:X,se=n.x,Ee=se===void 0?0:se,Oe=n.y,Ze=Oe===void 0?0:Oe,Be=n.copy,ct=Be===void 0?!1:Be;this.width=o,this.height=u;var Xe={width:o,height:u,type:na[i],format:OS[f],wrapS:Pf[m],wrapT:Pf[y],mag:Ff[w],min:Ff[$],alignment:A,flipY:l,colorSpace:FS[ne],premultiplyAlpha:I,aniso:E,x:Ee,y:Ze,copy:ct};r&&(Xe.data=r),typeof d=="number"?Xe.mipmap=kS[d]:typeof d=="boolean"&&(Xe.mipmap=d),this.texture=a.texture(Xe)}return(0,L.Z)(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(n)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(n){var r=n.width,e=n.height;this.texture.resize(r,e),this.width=r,this.height=e}},{key:"destroy",value:function(){if(!this.isDistroy){var n;(n=this.texture)===null||n===void 0||n.destroy()}this.isDistroy=!0}}]),t}(),wf,If,US=(wf=(0,W.b2)(),wf(If=function(){function t(){var a=this;(0,R.Z)(this,t),(0,h.Z)(this,"createModel",function(n){return new ZS(a.gl,n)}),(0,h.Z)(this,"createAttribute",function(n){return new RS(a.gl,n)}),(0,h.Z)(this,"createBuffer",function(n){return new IS(a.gl,n)}),(0,h.Z)(this,"createElements",function(n){return new BS(a.gl,n)}),(0,h.Z)(this,"createTexture2D",function(n){return new zS(a.gl,n)}),(0,h.Z)(this,"createFramebuffer",function(n){return new NS(a.gl,n)}),(0,h.Z)(this,"useFramebuffer",function(n,r){a.gl({framebuffer:n?n.get():null})(r)}),(0,h.Z)(this,"clear",function(n){var r,e=n.color,i=n.depth,o=n.stencil,u=n.framebuffer,s=u===void 0?null:u,l={color:e,depth:i,stencil:o};l.framebuffer=s===null?s:s.get(),(r=a.gl)===null||r===void 0||r.clear(l)}),(0,h.Z)(this,"viewport",function(n){var r=n.x,e=n.y,i=n.width,o=n.height;a.gl._gl.viewport(r,e,i,o),a.width=i,a.height=o,a.gl._refresh()}),(0,h.Z)(this,"readPixels",function(n){var r=n.framebuffer,e=n.x,i=n.y,o=n.width,u=n.height,s={x:e,y:i,width:o,height:u};return r&&(s.framebuffer=r.get()),a.gl.read(s)}),(0,h.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,h.Z)(this,"getContainer",function(){if(Qe)return a.canvas;var n;return(n=a.canvas)===null||n===void 0?void 0:n.parentElement}),(0,h.Z)(this,"getCanvas",function(){return a.canvas}),(0,h.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,h.Z)(this,"destroy",function(){var n,r,e;a.canvas=null,(n=a.gl)===null||n===void 0||(r=n._gl)===null||r===void 0||(e=r.getExtension("WEBGL_lose_context"))===null||e===void 0||e.loseContext(),a.gl.destroy(),a.gl=null})}return(0,L.Z)(t,[{key:"init",value:function(){var a=(0,te.Z)(H().mark(function r(e,i,o){var u=this;return H().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.canvas=e,!o){l.next=5;break}this.gl=o,l.next=8;break;case 5:return l.next=7,new Promise(function(c,f){MS()({canvas:u.canvas,attributes:{alpha:!0,antialias:i.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,stencil:i.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(d,g){(d||!g)&&f(d),c(g)}})});case 7:this.gl=l.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return l.stop()}},r,this)}));function n(r,e,i){return a.apply(this,arguments)}return n}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(n){return!!this.getGLContext().getExtension(n)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var n=this.getGLContext();n.disable(n.CULL_FACE)}},{key:"setDirty",value:function(n){this.isDirty=n}},{key:"getDirty",value:function(){return this.isDirty}}]),t}())||If);function jS(t){var a=HS();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}var ra=["selectstart","selecting","selectend"],VS=function(t){(0,N.Z)(n,t);var a=jS(n);function n(r){var e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,R.Z)(this,n),e=a.call(this),(0,h.Z)((0,C.Z)(e),"isEnable",!1),(0,h.Z)((0,C.Z)(e),"onDragStart",function(o){e.box.style.display="block",e.startEvent=e.endEvent=o,e.syncBoxBound(),e.emit("selectstart",e.getLngLatBox(),e.startEvent,e.endEvent)}),(0,h.Z)((0,C.Z)(e),"onDragging",function(o){e.endEvent=o,e.syncBoxBound(),e.emit("selecting",e.getLngLatBox(),e.startEvent,e.endEvent)}),(0,h.Z)((0,C.Z)(e),"onDragEnd",function(o){e.endEvent=o,e.box.style.display="none",e.emit("selectend",e.getLngLatBox(),e.startEvent,e.endEvent)}),e.scene=r,e.options=i,e}return(0,L.Z)(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var i=le("div",void 0,this.container);i.classList.add("l7-select-box"),e&&i.classList.add(e),i.style.display="none",this.box=i}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,i=e.x,o=e.y,u=this.endEvent,s=u.x,l=u.y,c=Math.min(i,s),f=Math.min(o,l),p=Math.abs(i-s),d=Math.abs(o-l);this.box.style.top="".concat(f,"px"),this.box.style.left="".concat(c,"px"),this.box.style.width="".concat(p,"px"),this.box.style.height="".concat(d,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,i=e.lng,o=e.lat,u=this.endEvent.lngLat,s=u.lng,l=u.lat;return _d([[i,o],[s,l]])}}]),n}(He.EventEmitter),GS=function(){function t(a){(0,R.Z)(this,t);var n=a.id,r=a.map,e=a.canvas,i=a.hasBaseMap,o=r_();this.container=o,r.setContainer(o,n,e,i),o.bind(M.IRendererService).to(US).inSingletonScope(),this.sceneService=o.get(M.ISceneService),this.mapService=o.get(M.IMapService),this.iconService=o.get(M.IIconService),this.fontService=o.get(M.IFontService),this.controlService=o.get(M.IControlService),this.layerService=o.get(M.ILayerService),this.markerService=o.get(M.IMarkerService),this.interactionService=o.get(M.IInteractionService),this.popupService=o.get(M.IPopupService),this.boxSelect=new VS(this,{}),Qe?this.sceneService.initMiniScene(a):(this.initComponent(n),this.sceneService.init(a),this.initControl())}return(0,L.Z)(t,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(n){return this.sceneService.exportPng(n)}},{key:"exportMap",value:function(n){return this.sceneService.exportPng(n)}},{key:"registerRenderService",value:function(n){var r=this;if(this.sceneService.loaded){var e=new n(this);e.init()}else this.on("loaded",function(){var i=new n(r);i.init()})}},{key:"setBgColor",value:function(n){this.mapService.setBgColor(n)}},{key:"addLayer",value:function(n){var r=this,e=zi(this.container);if(n.setContainer(e,this.container),this.sceneService.addLayer(n),n.inited){var i=this.initMask(n);this.addMask(i,n.id)}else n.on("inited",function(){var o=r.initMask(n);r.addMask(o,n.id)})}},{key:"initMask",value:function(n){var r=n.getLayerConfig(),e=r.mask,i=r.maskfence,o=r.maskColor,u=o===void 0?"#000":o,s=r.maskOpacity,l=s===void 0?0:s;if(!!e){var c=new iS().source(i).shape("fill").style({color:u,opacity:l});return c}}},{key:"addMask",value:function(n,r){if(!!n){var e=this.getLayer(r);if(e){var i=zi(this.container);n.setContainer(i,this.container),e.addMaskLayer(n),this.sceneService.addLayer(n)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(n){return this.layerService.getLayer(n)}},{key:"getLayerByName",value:function(n){return this.layerService.getLayerByName(n)}},{key:"removeLayer",value:function(n,r){this.layerService.remove(n,r)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(n){this.layerService.setEnableRender(n)}},{key:"addIconFont",value:function(n,r){this.fontService.addIconFont(n,r)}},{key:"addIconFonts",value:function(n){var r=this;n.forEach(function(e){var i=(0,re.Z)(e,2),o=i[0],u=i[1];r.fontService.addIconFont(o,u)})}},{key:"addFontFace",value:function(n,r){var e=this;this.fontService.once("fontloaded",function(i){e.emit("fontloaded",i)}),this.fontService.addFontFace(n,r)}},{key:"addImage",value:function(n,r){Qe?this.iconService.addImageMini(n,r,this.sceneService):this.iconService.addImage(n,r)}},{key:"hasImage",value:function(n){return this.iconService.hasImage(n)}},{key:"removeImage",value:function(n){this.iconService.removeImage(n)}},{key:"addIconFontGlyphs",value:function(n,r){this.fontService.addIconGlyphs(r)}},{key:"addControl",value:function(n){this.controlService.addControl(n,this.container)}},{key:"removeControl",value:function(n){this.controlService.removeControl(n)}},{key:"getControlByName",value:function(n){return this.controlService.getControlByName(n)}},{key:"addMarker",value:function(n){this.markerService.addMarker(n)}},{key:"addMarkerLayer",value:function(n){this.markerService.addMarkerLayer(n)}},{key:"removeMarkerLayer",value:function(n){this.markerService.removeMarkerLayer(n)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(n){this.popupService.addPopup(n)}},{key:"removePopup",value:function(n){this.popupService.removePopup(n)}},{key:"on",value:function(n,r){if(ra.includes(n)){var e;(e=this.boxSelect)===null||e===void 0||e.on(n,r)}else mr.includes(n)?this.sceneService.on(n,r):this.mapService.on(n,r)}},{key:"once",value:function(n,r){if(ra.includes(n)){var e;(e=this.boxSelect)===null||e===void 0||e.once(n,r)}else mr.includes(n)?this.sceneService.once(n,r):this.mapService.once(n,r)}},{key:"emit",value:function(n,r){mr.indexOf(n)===-1?this.mapService.on(n,r):this.sceneService.emit(n,r)}},{key:"off",value:function(n,r){if(ra.includes(n)){var e;(e=this.boxSelect)===null||e===void 0||e.off(n,r)}else mr.includes(n)?this.sceneService.off(n,r):this.mapService.off(n,r)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(n){return this.mapService.getCenter(n)}},{key:"setCenter",value:function(n,r){return this.mapService.setCenter(n,r)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(n){return this.mapService.setPitch(n)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(n){this.mapService.setRotation(n)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(n){this.mapService.panTo(n)}},{key:"panBy",value:function(n,r){this.mapService.panBy(n,r)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(n){this.mapService.setZoom(n)}},{key:"fitBounds",value:function(n,r){var e=this.sceneService.getSceneConfig(),i=e.fitBoundsOptions,o=e.animate;this.mapService.fitBounds(n,r||(0,T.Z)((0,T.Z)({},i),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(n,r){this.mapService.setZoomAndCenter(n,r)}},{key:"setMapStyle",value:function(n){this.mapService.setMapStyle(n)}},{key:"setMapStatus",value:function(n){this.mapService.setMapStatus(n)}},{key:"pixelToLngLat",value:function(n){return this.mapService.pixelToLngLat(n)}},{key:"lngLatToPixel",value:function(n){return this.mapService.lngLatToPixel(n)}},{key:"containerToLngLat",value:function(n){return this.mapService.containerToLngLat(n)}},{key:"lngLatToContainer",value:function(n){return this.mapService.lngLatToContainer(n)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(n,r){this.container.bind(M.IPostProcessingPass).to(n).whenTargetNamed(r)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),r&&this.boxSelect.once("selectend",function(){n.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(n){this.controlService.init({container:wa(n)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var n=this.sceneService.getSceneConfig(),r=n.logoVisible,e=n.logoPosition;r&&this.addControl(new D_({position:e}))}}]),t}(),E4="2.10.1";function Bf(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function C4(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?Bf(Object(n),!0).forEach(function(r){WS(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bf(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function WS(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}function S4(t,a){return KS(t)||YS(t,a)||XS(t,a)||$S()}function $S(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XS(t,a){if(!!t){if(typeof t=="string")return Nf(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nf(t,a)}}function Nf(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function YS(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function KS(t){if(Array.isArray(t))return t}var b4=null,A4=null,Zf,ia,zf,QS=(Zf=Zi(M.IGlobalConfigService),ia=function(){function t(a){(0,R.Z)(this,t),(0,ae.Z)(this,"configService",zf,this),this.config=a}return(0,L.Z)(t,[{key:"setContainer",value:function(n,r,e,i){n.bind(M.MapConfig).toConstantValue((0,T.Z)((0,T.Z)({},this.config),{},{id:r,canvas:e,hasBaseMap:i})),n.bind(M.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),t}(),zf=(0,ie.Z)(ia.prototype,"configService",[Zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ia),qS=O(6158),Xn=O.n(qS),JS=O(81458),eb=function(){function t(){(0,R.Z)(this,t)}return(0,L.Z)(t,[{key:"syncWithMapCamera",value:function(n){var r=n.center,e=n.zoom,i=n.pitch,o=n.bearing,u=n.viewportHeight,s=n.viewportWidth;this.viewport=new JS.Z({width:s,height:u,longitude:r&&r[0],latitude:r&&r[1],zoom:e,pitch:i,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(n,r){return this.viewport.projectFlat(n,r)}}]),t}(),tb=function(){function t(a){(0,R.Z)(this,t),(0,h.Z)(this,"size",1e4),this.size=a||1e4}return(0,L.Z)(t,[{key:"setSize",value:function(n){this.size=n}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(n){return(180+n)/360*this.size}},{key:"mercatorYfromLat",value:function(n){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(n){return n/this.size*360-180}},{key:"latFromMercatorY",value:function(n){var r=180-(1-n/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}},{key:"project",value:function(n){var r=this.mercatorXfromLng(n[0]),e=this.mercatorYfromLat(n[1]);return[r,e]}},{key:"unproject",value:function(n){var r=this.lngFromMercatorX(n[0]),e=this.latFromMercatorY(n[1]);return[r,e]}}]),t}(),nb={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Uf,jf,Hf,Vf,Gf,Wf,En,$f,Xf,Yf,Kf,Qf={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},rb=12,ib=(Uf=(0,W.b2)(),jf=(0,W.f3)(M.MapConfig),Hf=(0,W.f3)(M.IGlobalConfigService),Vf=(0,W.f3)(M.ICoordinateSystemService),Gf=(0,W.f3)(M.IEventEmitter),Uf(Wf=(En=function(){function t(){var a=this;(0,R.Z)(this,t),(0,h.Z)(this,"version",Le.L7MAP),(0,h.Z)(this,"simpleMapCoord",new tb),(0,h.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,ae.Z)(this,"config",$f,this),(0,ae.Z)(this,"configService",Xf,this),(0,ae.Z)(this,"coordinateSystemService",Yf,this),(0,ae.Z)(this,"eventEmitter",Kf,this),(0,h.Z)(this,"handleCameraChanged",function(n){var r=a.map.getCenter(),e=r.lat,i=r.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[i,e],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0}),a.updateCoordinateSystemService(),a.cameraChangedCallback(a.viewport)})}return(0,L.Z)(t,[{key:"setBgColor",value:function(n){this.bgColor=n}},{key:"addMarkerContainer",value:function(){var n=this.map.getCanvasContainer();this.markerContainer=le("div","l7-marker-container",n),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(n,r){h_.indexOf(n)!==-1?this.eventEmitter.on(n,r):this.map.on(Qf[n]||n,r)}},{key:"off",value:function(n,r){this.map.off(Qf[n]||n,r),this.eventEmitter.off(n,r)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===Le.SIMPLE)return this.simpleMapCoord.getSize();var n=this.map.transform;return[n.width,n.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(n){return this.map.setZoom(n)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(n){this.map.setCenter(n)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(n){this.map.setBearing(n)}},{key:"zoomIn",value:function(n,r){this.map.zoomIn(n,r)}},{key:"zoomOut",value:function(n,r){this.map.zoomOut(n,r)}},{key:"setPitch",value:function(n){return this.map.setPitch(n)}},{key:"panTo",value:function(n){this.map.panTo(n)}},{key:"panBy",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([n,r])}},{key:"fitBounds",value:function(n,r){this.map.fitBounds(n,r)}},{key:"setMaxZoom",value:function(n){this.map.setMaxZoom(n)}},{key:"setMinZoom",value:function(n){this.map.setMinZoom(n)}},{key:"setMapStatus",value:function(n){n.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),n.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),n.dragEnable===!1&&this.map.dragPan.disable(),n.dragEnable===!0&&this.map.dragPan.enable(),n.rotateEnable===!1&&this.map.dragRotate.disable(),n.dragEnable===!0&&this.map.dragRotate.enable(),n.keyboardEnable===!1&&this.map.keyboard.disable(),n.keyboardEnable===!0&&this.map.keyboard.enable(),n.zoomEnable===!1&&this.map.scrollZoom.disable(),n.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(n,r){this.map.flyTo({zoom:n,center:r})}},{key:"setMapStyle",value:function(n){this.map.setStyle(this.getMapStyleValue(n))}},{key:"meterToCoord",value:function(n,r){return 1}},{key:"pixelToLngLat",value:function(n){return this.map.unproject(n)}},{key:"lngLatToPixel",value:function(n){return this.map.project(n)}},{key:"containerToLngLat",value:function(n){return this.map.unproject(n)}},{key:"lngLatToContainer",value:function(n){return this.map.project(n)}},{key:"getMapStyle",value:function(){try{var n,r=(n=this.map.getStyle().sprite)!==null&&n!==void 0?n:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(r)?r==null?void 0:r.replace(/\/\w+$/,"").replace(/sprites/,"styles"):r}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return nb}},{key:"getMapStyleValue",value:function(n){var r;return(r=this.getMapStyleConfig()[n])!==null&&r!==void 0?r:n}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(n){for(var r,e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];(r=this.eventEmitter).emit.apply(r,[n].concat(i))}},{key:"once",value:function(n){for(var r,e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];(r=this.eventEmitter).once.apply(r,[n].concat(i))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(n){var r=this.map.getCanvas(),e=n==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png");return e}},{key:"onCameraChanged",value:function(n){this.cameraChangedCallback=n}},{key:"creatMapContainer",value:function(n){var r=n;return typeof n=="string"&&(r=document.getElementById(n)),r}},{key:"updateView",value:function(n){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:n.bearing,center:n.center,viewportHeight:n.viewportHeight,pitch:n.pitch,viewportWidth:n.viewportWidth,zoom:n.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var n=this.config.offsetCoordinate,r=n===void 0?!0:n;this.viewport.getZoom()>rb&&r?this.coordinateSystemService.setCoordinateSystem(wt.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(wt.LNGLAT)}}]),t}(),$f=(0,ie.Z)(En.prototype,"config",[jf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=(0,ie.Z)(En.prototype,"configService",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=(0,ie.Z)(En.prototype,"coordinateSystemService",[Vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=(0,ie.Z)(En.prototype,"eventEmitter",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En))||Wf),ab=["id","attributionControl","style","token","rotation","mapInstance"],qf,Jf;function ob(t){var a=ub();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function sb(t,a){var n=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,r=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(n||r)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(a.createTextNode(t)),e.appendChild(o),o}}sb(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Xn();var lb=0,e0="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",cb=(qf=(0,W.b2)(),qf(Jf=function(t){(0,N.Z)(n,t);var a=ob(n);function n(){var r;(0,R.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),(0,h.Z)((0,C.Z)(r),"version",Le.MAPBOX),r}return(0,L.Z)(n,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(e,0),u=o.x,s=o.y;return[u-i.x,s-i.y]}},{key:"lngLatToMercator",value:function(e,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,i),u=o.x,s=u===void 0?0:u,l=o.y,c=l===void 0?0:l,f=o.z,p=f===void 0?0:f;return{x:s,y:c,z:p}}},{key:"getModelMatrix",value:function(e,i,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=window.mapboxgl.MercatorCoordinate.fromLngLat(e,i),c=l.meterInMercatorCoordinateUnits(),f=Re.create();return Re.translate(f,f,xe.fromValues(l.x-s.x,l.y-s.y,l.z||0-s.z)),Re.scale(f,f,xe.fromValues(c*u[0],-c*u[1],c*u[2])),Re.rotateX(f,f,o[0]),Re.rotateY(f,f,o[1]),Re.rotateZ(f,f,o[2]),f}},{key:"init",value:function(){var r=(0,te.Z)(H().mark(function i(){var o,u,s,l,c,f,p,d,g,m,_,y,x;return H().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:o=this.config,u=o.id,s=u===void 0?"map":u,l=o.attributionControl,c=l===void 0?!1:l,f=o.style,p=f===void 0?"light":f,d=o.token,g=d===void 0?e0:d,m=o.rotation,_=m===void 0?0:m,y=o.mapInstance,x=(0,It.Z)(o,ab),this.viewport=new eb,!y&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),g===e0&&p!=="blank"&&!window.mapboxgl.accessToken&&!y&&console.warn(this.configService.getSceneWarninfo("MapToken")),!y&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=g),y?(this.map=y,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(s),this.map=new window.mapboxgl.Map((0,T.Z)({container:this.$mapContainer,style:this.getMapStyleValue(p),attributionControl:c,bearing:_},x))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return b.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var e,i;(e=this.$mapContainer)===null||e===void 0||(i=e.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];(i=this.eventEmitter).emit.apply(i,[e].concat(u))}},{key:"once",value:function(e){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),s=1;s<o;s++)u[s-1]=arguments[s];(i=this.eventEmitter).once.apply(i,[e].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,i){var o=new(Xn()).LngLat(e[0],e[1]),u=new(Xn()).LngLat(i[0],i[1]),s=o.distanceTo(u),l=Xn().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),c=Xn().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),f=l.x,p=l.y,d=c.x,g=c.y,m=Math.sqrt(Math.pow(f-d,2)+Math.pow(p-g,2))*4194304*2;return m/s}},{key:"exportMap",value:function(e){var i=this.map.getCanvas(),o=e==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"creatMapContainer",value:function(e){var i=e;typeof e=="string"&&(i=document.getElementById(e));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+lb++,i.appendChild(o),o}}]),n}(ib))||Jf);function fb(t){var a=pb();return function(){var r=(0,S.Z)(t),e;if(a){var i=(0,S.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,Z.Z)(this,e)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function db(t,a){var n=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,r=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(n||r)&&(a||(a=document),!!a)){var e=a.head||a.getElementsByTagName("head")[0];if(!e){e=a.createElement("head");var i=a.body||a.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(e,i):a.documentElement.appendChild(e)}var o=a.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(a.createTextNode(t)),e.appendChild(o),o}}db(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var vb=function(t){(0,N.Z)(n,t);var a=fb(n);function n(){return(0,R.Z)(this,n),a.apply(this,arguments)}return(0,L.Z)(n,[{key:"getServiceConstructor",value:function(){return cb}}]),n}(QS);function t0(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function n0(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?t0(Object(n),!0).forEach(function(r){hb(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):t0(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function hb(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}function gb(t,a){return xb(t)||yb(t,a)||_b(t,a)||mb()}function mb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _b(t,a){if(!!t){if(typeof t=="string")return r0(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r0(t,a)}}function r0(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function yb(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function xb(t){if(Array.isArray(t))return t}var Eb=J.memo(function(t){var a=t.style,n=t.className,r=t.map,e=t.option,i=t.onSceneLoaded,o=(0,J.createRef)(),u=(0,J.useState)(),s=gb(u,2),l=s[0],c=s[1];return(0,J.useEffect)(function(){var f=new GS(n0(n0({id:o.current},e),{},{map:new vb(r)}));return f.on("loaded",function(){c(f),i&&i(f)}),function(){f.destroy()}},[]),(0,J.useEffect)(function(){l&&r.style&&l.setMapStyle(r.style)},[JSON.stringify(r.style)]),(0,J.useEffect)(function(){l&&r.zoom&&l.setZoom(r.zoom)},[r.zoom]),(0,J.useEffect)(function(){l&&r.center&&l.setCenter(r.center)},[JSON.stringify(r.center)]),(0,J.useEffect)(function(){l&&r.pitch!==void 0&&l.setPitch(r.pitch||0)},[r.pitch]),(0,J.useEffect)(function(){l&&r.rotation&&l.setRotation(r.rotation)},[r.rotation]),J.createElement(Qn.Provider,{value:l},(0,J.createElement)("div",{ref:o,style:a,className:n},l&&t.children))}),Cb=Eb;function i0(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function T4(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?i0(Object(n),!0).forEach(function(r){Sb(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i0(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Sb(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}function M4(t,a){return Mb(t)||Tb(t,a)||Ab(t,a)||bb()}function bb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ab(t,a){if(!!t){if(typeof t=="string")return a0(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a0(t,a)}}function a0(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function Tb(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function Mb(t){if(Array.isArray(t))return t}var R4=null,L4=null;function o0(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function O4(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?o0(Object(n),!0).forEach(function(r){Rb(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o0(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Rb(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}function k4(t,a){return Fb(t)||kb(t,a)||Ob(t,a)||Lb()}function Lb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ob(t,a){if(!!t){if(typeof t=="string")return u0(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u0(t,a)}}function u0(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function kb(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function Fb(t){if(Array.isArray(t))return t}var F4=null,P4=null;function D4(t,a){return Ib(t)||wb(t,a)||Db(t,a)||Pb()}function Pb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Db(t,a){if(!!t){if(typeof t=="string")return s0(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s0(t,a)}}function s0(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function wb(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function Ib(t){if(Array.isArray(t))return t}var w4=null,I4=null;function l0(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function B4(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?l0(Object(n),!0).forEach(function(r){Bb(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l0(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Bb(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}function N4(t,a){if(t==null)return{};var n=Nb(t,a),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(e=0;e<i.length;e++)r=i[e],!(a.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,r)||(n[r]=t[r]))}return n}function Nb(t,a){if(t==null)return{};var n={},r=Object.keys(t),e,i;for(i=0;i<r.length;i++)e=r[i],!(a.indexOf(e)>=0)&&(n[e]=t[e]);return n}var Z4=null,c0=O(73935);function f0(t,a){return jb(t)||Ub(t,a)||zb(t,a)||Zb()}function Zb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zb(t,a){if(!!t){if(typeof t=="string")return p0(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p0(t,a)}}function p0(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function Ub(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function jb(t){if(Array.isArray(t))return t}var d0=J.useEffect,v0=J.useState,Hb=/\B([A-Z])/g,Vb=function(a){return a.replace(Hb,"-$1").toLowerCase()};function z4(t){var a=t.className,n=t.style,r=t.children,e=t.position,i=v0(),o=f0(i,2),u=o[0],s=o[1],l=useSceneValue(),c=v0(function(){return document.createElement("div")}),f=f0(c,1),p=f[0];return d0(function(){var d=new Control({position:e});return d.onAdd=function(){if(a&&(p.className=a),n){var g=Object.keys(n).map(function(m){return"".concat(Vb(m),":").concat(n[m])}).join(";");p.style.cssText=g}return p},d.onRemove=function(){},s(d),l.addControl(d),function(){l.removeControl(d)}},[]),d0(function(){u&&u.setPosition(e||"bottomleft")},[e]),createPortal(r,p)}var h0=(0,J.createContext)({});function U4(){return useContext(h0)}var j4=J.useEffect,Gb=J.memo(function(a){var n=a.layer,r=a.active;return n.active(r.option),null},P.isEqual),H4=J.useEffect,Wb=J.memo(function(a){var n=a.layer,r=a.animate;return n.animate(r),null},P.isEqual),V4=J.useEffect,$b=J.memo(function(a){var n=a.layer,r=a.color;return r.field?n.color(r.field,r.values):n.color(r.values),null},P.isEqual),Xb=J.memo(function(a){var n=a.layer,r=a.filter;return r.field&&n.filter(r.field,r.values),null},P.isEqual),Yb=J.memo(function(a){var n=a.layer,r=a.scale;return n.scale(r.values),null},P.isEqual),G4=J.useEffect,Kb=J.memo(function(a){var n=a.layer,r=a.select;return n.select(r.option),null},P.isEqual),Qb=J.memo(function(a){var n=a.layer,r=a.shape;return r.field?n.shape(r.field,r.values):n.shape(r.values),null},P.isEqual),qb=J.memo(function(a){var n=a.layer,r=a.size;return r.field?n.size(r.field,r.values):n.size(r.values),null},P.isEqual),Jb=["data"];function eA(t,a){if(t==null)return{};var n=tA(t,a),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(e=0;e<i.length;e++)r=i[e],!(a.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,r)||(n[r]=t[r]))}return n}function tA(t,a){if(t==null)return{};var n={},r=Object.keys(t),e,i;for(i=0;i<r.length;i++)e=r[i],!(a.indexOf(e)>=0)&&(n[e]=t[e]);return n}var nA=J.memo(function(a){var n=a.layer,r=a.source,e=r.data,i=eA(r,Jb);return n.inited?n.setData(e,i):n.source(e,i),i.autoFit&&n.fitBounds(i&&i.fitBoundsOptions),null},P.isEqual),W4=J.useEffect,rA=J.memo(function(a){var n=a.layer,r=a.style;return n.style(r),null},P.isEqual);function iA(t,a){return sA(t)||uA(t,a)||oA(t,a)||aA()}function aA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oA(t,a){if(!!t){if(typeof t=="string")return g0(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g0(t,a)}}function g0(t,a){(a==null||a>t.length)&&(a=t.length);for(var n=0,r=new Array(a);n<a;n++)r[n]=t[n];return r}function uA(t,a){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],e=!0,i=!1,o,u;try{for(n=n.call(t);!(e=(o=n.next()).done)&&(r.push(o.value),!(a&&r.length===a));e=!0);}catch(s){i=!0,u=s}finally{try{!e&&n.return!=null&&n.return()}finally{if(i)throw u}}return r}}function sA(t){if(Array.isArray(t))return t}var Yn=J.useEffect,lA=J.useState;function m0(t,a){var n=a.source,r=a.color,e=a.shape,i=a.style,o=a.size,u=a.scale,s=a.active,l=a.select,c=a.filter,f=a.animate,p=a.options,d=a.onLayerLoaded,g=A0(),m=lA(function(){var x;switch(t){case"polygonLayer":x=new Uc(p);break;case"lineLayer":x=new hC(p);break;case"pointLayer":x=new p3(p);break;case"heatmapLayer":x=new E1(p);break;case"rasterLayer":x=new Q3(p);break;case"imageLayer":x=new Hl(p);break;case"citybuildingLayer":x=new Wy(p);break;default:x=new Uc(p)}return x.on("inited",function(){d&&d(x,g)}),x}),_=iA(m,1),y=_[0];return Yn(function(){return g.addLayer(y),function(){g.removeLayer(y)}},[]),Yn(function(){y.inited&&p&&y.updateLayerConfig(p)},[p==null?void 0:p.minZoom,p==null?void 0:p.maxZoom,p==null?void 0:p.visible]),Yn(function(){y.inited&&(p==null?void 0:p.zIndex)&&y.setIndex(p.zIndex)},[p==null?void 0:p.zIndex]),Yn(function(){y.inited&&(p==null?void 0:p.blend)&&y.setBlend(p.blend)},[p==null?void 0:p.blend]),Yn(function(){g.render()}),J.createElement(h0.Provider,{value:y},J.createElement(nA,{layer:y,source:n}),u&&J.createElement(Yb,{layer:y,scale:u}),r&&J.createElement($b,{layer:y,color:r}),o&&J.createElement(qb,{layer:y,size:o}),e&&J.createElement(Qb,{layer:y,shape:e}),i&&J.createElement(rA,{layer:y,style:i}),s&&J.createElement(Gb,{layer:y,active:s}),l&&J.createElement(Kb,{layer:y,select:l}),c&&J.createElement(Xb,{layer:y,filter:c}),f&&J.createElement(Wb,{layer:y,animate:f}),a.children)}var $4=null,X4=null,_0=J.memo(function(a){return m0("pointLayer",a)}),cA=J.memo(function(a){return m0("heatmapLayer",a)}),Y4=null,K4=null,Q4=null,q4=J.useEffect,J4=null,e7=null;function Dr(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Dr=function(n){return typeof n}:Dr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Dr(t)}function y0(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function wr(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?y0(Object(n),!0).forEach(function(r){fA(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y0(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function fA(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}function pA(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function x0(t,a){for(var n=0;n<a.length;n++){var r=a[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dA(t,a,n){return a&&x0(t.prototype,a),n&&x0(t,n),t}function vA(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&aa(t,a)}function aa(t,a){return aa=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},aa(t,a)}function hA(t){var a=_A();return function(){var r=Ir(t),e;if(a){var i=Ir(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return gA(this,e)}}function gA(t,a){if(a&&(Dr(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mA(t)}function mA(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function Ir(t){return Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Ir(t)}var t7=function(t){vA(n,t);var a=hA(n);function n(r){var e;return pA(this,n),e=a.call(this,r),e.el=void 0,e.scene=void 0,e.popup=void 0,e.el=document.createElement("div"),e}return dA(n,[{key:"componentDidMount",value:function(){var e,i=this.props,o=i.lnglat,u=i.children,s=i.option,l=i.lngLat,c=new ji(wr(wr({},s),{},{stopPropagation:(e=this.props.option)===null||e===void 0?void 0:e.stopPropagation}));o&&c.setLnglat(o),l&&c.setLnglat(l),u&&c.setDOMContent(this.el),this.popup=c,this.scene.addPopup(c)}},{key:"componentDidUpdate",value:function(e){var i,o,u,s,l,c,f=Array.isArray(e.lnglat)?e.lnglat:[e==null||(i=e.lnglat)===null||i===void 0?void 0:i.lng,e==null||(o=e.lnglat)===null||o===void 0?void 0:o.lat],p=Array.isArray(this.props.lnglat)?this.props.lnglat:[(u=this.props)===null||u===void 0||(s=u.lnglat)===null||s===void 0?void 0:s.lng,(l=this.props)===null||l===void 0||(c=l.lnglat)===null||c===void 0?void 0:c.lat],d=f.toString()!==p.toString();if(d){var g;this.popup.remove(),this.popup=new ji(wr(wr({},this.props.option),{},{stopPropagation:(g=this.props.option)===null||g===void 0?void 0:g.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var e=this;return J.createElement(Qn.Consumer,{},function(i){return i&&(e.scene=i),(0,c0.createPortal)(e.props.children,e.el)})}}]),n}(J.PureComponent);function Br(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Br=function(n){return typeof n}:Br=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Br(t)}function yA(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function E0(t,a){for(var n=0;n<a.length;n++){var r=a[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function xA(t,a,n){return a&&E0(t.prototype,a),n&&E0(t,n),t}function EA(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&oa(t,a)}function oa(t,a){return oa=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},oa(t,a)}function CA(t){var a=AA();return function(){var r=Nr(t),e;if(a){var i=Nr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return SA(this,e)}}function SA(t,a){if(a&&(Br(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bA(t)}function bA(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function Nr(t){return Nr=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Nr(t)}var n7=function(t){EA(n,t);var a=CA(n);function n(r){var e;return yA(this,n),e=a.call(this,r),e.el=void 0,e.scene=void 0,e.marker=void 0,e.el=document.createElement("div"),e}return xA(n,[{key:"componentDidMount",value:function(){var e=this.props,i=e.lnglat,o=e.children,u=e.option,s=e.onMarkerLoaded,l=new cl(u);i&&l.setLnglat(i),o&&l.setElement(this.el),this.marker=l,s&&s(l),this.scene.addMarker(l)}},{key:"componentDidUpdate",value:function(e){var i,o=(e==null?void 0:e.lnglat.toString())!==((i=this.props)===null||i===void 0?void 0:i.lnglat.toString());o&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var e=this;return J.createElement(Qn.Consumer,{},function(i){return i&&(e.scene=i),(0,c0.createPortal)(e.props.children,e.el)})}}]),n}(J.PureComponent),r7=J.useEffect,i7=null,a7=null,o7=J.useEffect,u7=null,TA=O(83832),Q=O(85893),MA=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],RA=function(t){(0,Kn.Z)(n,t);var a=(0,ca.Z)(n);function n(){var r;(0,Te.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),r.state={data:null,grid:null,loading:!1},r}return(0,We.Z)(n,[{key:"componentDidMount",value:function(){var r=(0,Pe.Z)((0,ke.Z)().mark(function i(){var o,u,s,l;return(0,ke.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(p){return p.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(p){return p.json()})]);case 2:o=f.sent,u=(0,Ie.Z)(o,2),s=u[0],l=u[1],this.setState({data:s,grid:l,loading:!0});case 7:case"end":return f.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"render",value:function(){var e=this.state,i=e.data,o=e.grid,u=e.loading;return u===!1?(0,Q.jsx)(TA.Z,{}):(0,Q.jsxs)(Cb,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[o&&(0,Q.jsx)(cA,{source:{data:o,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),i&&[(0,Q.jsx)(_0,{options:{autoFit:!0},source:{data:i},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:MA},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,Q.jsx)(_0,{source:{data:i},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(l){return l>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),n}(J.Component),C0=O(86582),LA=O(64926),OA=O(70499),tn=O.n(OA);function kA(t){return t*1<10?"0".concat(t):t}function S0(){for(var t=[],a=0;a<24;a+=1)t.push({x:"".concat(kA(a),":00"),y:Math.floor(Math.random()*200)+a*50});return t}var FA=function(t){(0,Kn.Z)(n,t);var a=(0,ca.Z)(n);function n(){var r;(0,Te.Z)(this,n);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=a.call.apply(a,[this].concat(i)),r.state={activeData:S0()},r.timer=void 0,r.requestRef=void 0,r.loopData=function(){r.requestRef=requestAnimationFrame(function(){r.timer=window.setTimeout(function(){r.setState({activeData:S0()},function(){r.loopData()})},1e3)})},r}return(0,We.Z)(n,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var e=this.state.activeData,i=e===void 0?[]:e;return(0,Q.jsxs)("div",{className:tn().activeChart,children:[(0,Q.jsx)(fe.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,Q.jsx)("div",{style:{marginTop:32},children:(0,Q.jsx)(LA.Z,{data:i,xField:"x",forceFit:!0,yField:"y",height:84})}),i&&(0,Q.jsxs)("div",{children:[(0,Q.jsxs)("div",{className:tn().activeChartGrid,children:[(0,Q.jsxs)("p",{children:[(0,C0.Z)(i).sort()[i.length-1].y+200," \u4EBF\u5143"]}),(0,Q.jsxs)("p",{children:[(0,C0.Z)(i).sort()[Math.floor(i.length/2)].y," \u4EBF\u5143"]})]}),(0,Q.jsx)("div",{className:tn().dashedLine,children:(0,Q.jsx)("div",{className:tn().line})}),(0,Q.jsx)("div",{className:tn().dashedLine,children:(0,Q.jsx)("div",{className:tn().line})})]}),i&&(0,Q.jsxs)("div",{className:tn().activeChartLegend,children:[(0,Q.jsx)("span",{children:"00:00"}),(0,Q.jsx)("span",{children:i[Math.floor(i.length/2)].x}),(0,Q.jsx)("span",{children:i[i.length-1].x})]})]})}}]),n}(J.Component);function PA(){return ua.apply(this,arguments)}function ua(){return ua=(0,Pe.Z)((0,ke.Z)().mark(function t(){return(0,ke.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,B.WY)("/api/tags"));case 1:case"end":return n.stop()}},t)})),ua.apply(this,arguments)}var DA=O(19134),b0=O.n(DA),wA=fe.Z.Countdown,IA=Date.now()+1e3*60*60*24*2+1e3*30,BA=function(){var a=(0,B.QT)(PA),n=a.loading,r=a.data,e=((r==null?void 0:r.list)||[]).map(function(i){return{id:+Date.now(),word:i.name,weight:i.value}});return(0,Q.jsx)(Ae.Z,{children:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)(Ce.Z,{gutter:24,children:[(0,Q.jsx)(ee.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,Q.jsxs)(he.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,Q.jsxs)(Ce.Z,{children:[(0,Q.jsx)(ee.Z,{md:6,sm:12,xs:24,children:(0,Q.jsx)(fe.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Me()(124543233).format("0,0")})}),(0,Q.jsx)(ee.Z,{md:6,sm:12,xs:24,children:(0,Q.jsx)(fe.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,Q.jsx)(ee.Z,{md:6,sm:12,xs:24,children:(0,Q.jsx)(wA,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:IA,format:"HH:mm:ss:SSS"})}),(0,Q.jsx)(ee.Z,{md:6,sm:12,xs:24,children:(0,Q.jsx)(fe.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Me()(234).format("0,0")})})]}),(0,Q.jsx)("div",{className:b0().mapChart,children:(0,Q.jsx)(RA,{})})]})}),(0,Q.jsxs)(ee.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,Q.jsx)(he.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,Q.jsx)(FA,{})}),(0,Q.jsx)(he.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,Q.jsx)(K.Z,{height:180,min:0,max:100,forceFit:!0,value:87,range:[0,25,50,75,100],statistic:{visible:!0,text:"\u4F18",color:"#30bf78"}})})]})]}),(0,Q.jsxs)(Ce.Z,{gutter:24,children:[(0,Q.jsx)(ee.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,Q.jsx)(he.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:b0().pieCard,children:(0,Q.jsxs)(Ce.Z,{style:{padding:"16px 0"},children:[(0,Q.jsx)(ee.Z,{span:8,children:(0,Q.jsx)(Y.Z,{forceFit:!0,height:128,percent:.28})}),(0,Q.jsx)(ee.Z,{span:8,children:(0,Q.jsx)(Y.Z,{color:"#5DDECF",forceFit:!0,height:128,percent:.22})}),(0,Q.jsx)(ee.Z,{span:8,children:(0,Q.jsx)(Y.Z,{color:"#2FC25B",forceFit:!0,height:128,percent:.32})})]})})}),(0,Q.jsx)(ee.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,Q.jsx)(he.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:n,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,Q.jsx)(D.Z,{data:e,forceFit:!0,height:162,wordStyle:{fontSize:[10,20]},shape:"triangle"})})}),(0,Q.jsx)(ee.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,Q.jsx)(he.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,Q.jsx)(V.Z,{height:161,min:0,max:1e4,value:5639,forceFit:!0,padding:[0,0,0,0],statistic:{formatter:function(o){return"".concat((100*o/1e4).toFixed(1),"%")}}})})})]})]})})},NA=BA},31745:function(Se){"use strict";Se.exports=O,Se.exports.default=O;var pe=1e20;function O(ce,ee,de,fe,B,K){this.fontSize=ce||24,this.buffer=ee===void 0?3:ee,this.cutoff=fe||.25,this.fontFamily=B||"sans-serif",this.fontWeight=K||"normal",this.radius=de||8;var Y=this.size=this.fontSize+this.buffer*2,D=Y+this.buffer*2,V=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;V?this.canvas=my.createOffscreenCanvas(Y,Y,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Y),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,V?this.middle=Math.round(Y/2*1):this.middle=Math.round(Y/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function q(ce,ee,de,fe,B,K,Y){K.fill(pe,0,ee*de),Y.fill(0,0,ee*de);for(var D=(ee-fe)/2,V=0;V<B;V++)for(var Ae=0;Ae<fe;Ae++){var ve=(V+D)*ee+Ae+D,Me=ce.data[4*(V*fe+Ae)+3]/255;if(Me===1)K[ve]=0,Y[ve]=pe;else if(Me===0)K[ve]=pe,Y[ve]=0;else{var ke=Math.max(0,.5-Me),Ie=Math.max(0,Me-.5);K[ve]=ke*ke,Y[ve]=Ie*Ie}}}function he(ce,ee,de,fe,B,K,Y){for(var D=0;D<ee*de;D++){var V=Math.sqrt(fe[D])-Math.sqrt(B[D]);ce[D]=Math.round(255-255*(V/K+Y))}}O.prototype._draw=function(ce,ee){var de=this.ctx.measureText(ce),fe=de.width,B=2*this.buffer,K,Y,D,V,Ae,ve,Me,ke;ee&&this.useMetrics?(Ae=Math.floor(de.actualBoundingBoxAscent),ke=this.buffer+Math.ceil(de.actualBoundingBoxAscent),ve=this.buffer,Me=this.buffer,Y=Math.min(this.size,Math.ceil(de.actualBoundingBoxRight-de.actualBoundingBoxLeft)),V=Math.min(this.size-ve,Math.ceil(de.actualBoundingBoxAscent+de.actualBoundingBoxDescent)),K=Y+B,D=V+B,this.ctx.textBaseline="alphabetic"):(K=Y=this.size,D=V=this.size,Ae=19*this.fontSize/24,ve=Me=0,ke=this.middle,this.ctx.textBaseline="middle");var Ie;Y&&V&&(this.ctx.clearRect(Me,ve,Y,V),this.ctx.fillText(ce,this.buffer,ke),Ie=this.ctx.getImageData(Me,ve,Y,V));var Pe=new Uint8ClampedArray(K*D);return q(Ie,K,D,Y,V,this.gridOuter,this.gridInner),be(this.gridOuter,K,D,this.f,this.v,this.z),be(this.gridInner,K,D,this.f,this.v,this.z),he(Pe,K,D,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Pe,metrics:{width:Y,height:V,sdfWidth:K,sdfHeight:D,top:Ae,left:0,advance:fe}}},O.prototype.draw=function(ce){return this._draw(ce,!1).data},O.prototype.drawWithMetrics=function(ce){return this._draw(ce,!0)};function be(ce,ee,de,fe,B,K){for(var Y=0;Y<ee;Y++)Ce(ce,Y,ee,de,fe,B,K);for(var D=0;D<de;D++)Ce(ce,D*ee,1,ee,fe,B,K)}function Ce(ce,ee,de,fe,B,K,Y){var D,V,Ae,ve;for(K[0]=0,Y[0]=-pe,Y[1]=pe,D=0;D<fe;D++)B[D]=ce[ee+D*de];for(D=1,V=0,Ae=0;D<fe;D++){do ve=K[V],Ae=(B[D]-B[ve]+D*D-ve*ve)/(D-ve)/2;while(Ae<=Y[V]&&--V>-1);V++,K[V]=D,Y[V]=Ae,Y[V+1]=pe}for(D=0,V=0;D<fe;D++){for(;Y[V+1]<D;)V++;ve=K[V],ce[ee+D*de]=B[ve]+(D-ve)*(D-ve)}}},29932:function(Se){function pe(O,q){for(var he=-1,be=O==null?0:O.length,Ce=Array(be);++he<be;)Ce[he]=q(O[he],he,O);return Ce}Se.exports=pe},40371:function(Se){function pe(O){return function(q){return q==null?void 0:q[O]}}Se.exports=pe},80531:function(Se,pe,O){var q=O(62705),he=O(29932),be=O(1469),Ce=O(33448),ce=1/0,ee=q?q.prototype:void 0,de=ee?ee.toString:void 0;function fe(B){if(typeof B=="string")return B;if(be(B))return he(B,fe)+"";if(Ce(B))return de?de.call(B):"";var K=B+"";return K=="0"&&1/B==-ce?"-0":K}Se.exports=fe},79833:function(Se,pe,O){var q=O(80531);function he(be){return be==null?"":q(be)}Se.exports=he}}]);
